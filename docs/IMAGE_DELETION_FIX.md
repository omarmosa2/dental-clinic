# ุฅุตูุงุญ ุญุฐู ุงูุตูุฑ ูู ุงููููุงุช ุงููุนููุฉ ๐๏ธ๐

## ๐ ุงููุดููุฉ
ูุงู ุงููุธุงู ุงูุฌุฏูุฏ ููุนูุงุฌุงุช ุงูุณููุฉ (tooth_treatment_images) ูุญุฐู ุงูุตูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุทุ ูููู ูุง ูุญุฐู ุงููููุงุช ุงููุนููุฉ ูู ูุธุงู ุงูุชุฎุฒููุ ููุง ูุคุฏู ุฅูู:
- ุชุฑุงูู ุงููููุงุช ุบูุฑ ุงููุณุชุฎุฏูุฉ
- ุงุณุชููุงู ูุณุงุญุฉ ุชุฎุฒูู ุบูุฑ ุถุฑูุฑูุฉ
- ุนุฏู ุชุทุงุจู ุจูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงููููุงุช ุงููุนููุฉ

## โ ุงูุญู ุงููุทุจู

### ๐ง **ุงูุชุญุณููุงุช ูู main.js ู main.ts**:

#### **ูุนุงูุฌ ุญุฐู ุตูุฑ ุงููุธุงู ุงูุฌุฏูุฏ**:
```javascript
ipcMain.handle('db:toothTreatmentImages:delete', async (_, id) => {
  // 1. ุงูุญุตูู ุนูู ูุนูููุงุช ุงูุตูุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  const imageRecord = databaseService.db.prepare('SELECT * FROM tooth_treatment_images WHERE id = ?').get(id)
  
  // 2. ุญุฐู ุงูููู ุงููุนูู
  if (imageRecord && imageRecord.image_path) {
    // ุญุฐู ุงููููุงุช ูู ุงููุฌูุฏุงุช ุงููุฎุชููุฉ
    // ุฏุนู ุงูุชุทููุฑ ูุงูุฅูุชุงุฌ
    // ุฏุนู ุงููุณุงุฑุงุช ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ
  }
  
  // 3. ุญุฐู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  await databaseService.deleteToothTreatmentImage(id)
})
```

### ๐ **ูุณุงุฑุงุช ุงูุจุญุซ ุนู ุงููููุงุช**:

#### **ูู ุจูุฆุฉ ุงูุชุทููุฑ**:
- `process.cwd()/dental_images/patient_id/tooth_number/image_type/`
- `__dirname/../public/upload/dental_images/patient_id/tooth_number/image_type/`

#### **ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ**:
- `app.getPath('userData')/dental_images/patient_id/tooth_number/image_type/`
- `path.dirname(process.execPath)/dental_images/patient_id/tooth_number/image_type/`

### ๐ **ุขููุฉ ุงูุจุญุซ ูุงูุญุฐู**:

#### **ูููุณุงุฑุงุช ุงูุฌุฏูุฏุฉ (ูุฌูุฏุงุช)**:
```javascript
if (imageRecord.image_path.endsWith('/')) {
  // ุงูุจุญุซ ูู ุงููุฌูุฏ ุนู ุฌููุน ุงูุตูุฑ
  const files = fs.readdirSync(searchPath)
  const imageFiles = files.filter(file => {
    const ext = path.extname(file).toLowerCase()
    return ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp'].includes(ext)
  })
  
  // ุญุฐู ุฌููุน ุงูุตูุฑ ุงูููุฌูุฏุฉ
  for (const imageFile of imageFiles) {
    fs.unlinkSync(path.join(searchPath, imageFile))
  }
}
```

#### **ูููุณุงุฑุงุช ุงููุฏููุฉ (ูููุงุช ูุจุงุดุฑุฉ)**:
```javascript
else {
  // ุงูุจุญุซ ุนู ุงูููู ุงููุจุงุดุฑ ูุญุฐูู
  for (const searchPath of searchPaths) {
    if (fs.existsSync(searchPath)) {
      fs.unlinkSync(searchPath)
      break
    }
  }
}
```

## ๐ก๏ธ **ุงูุญูุงูุฉ ูู ุงูุฃุฎุทุงุก**:

### **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**:
- **ุงุณุชูุฑุงุฑ ุงูุนูููุฉ**: ุญุชู ูู ูุดู ุญุฐู ุงููููุ ูุชู ุญุฐู ุงูุณุฌู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุชุณุฌูู ููุตู**: ุฑุณุงุฆู ูุงุถุญุฉ ููู ุฎุทูุฉ ูู ุงูุนูููุฉ
- **ุชุญูู ูู ุงููุฌูุฏ**: ูุญุต ูุฌูุฏ ุงููููุงุช ูุจู ูุญุงููุฉ ุญุฐููุง

### **ุฑุณุงุฆู ุงูุชุณุฌูู**:
```javascript
console.log('โ Physical tooth treatment image file deleted:', fullImagePath)
console.warn('โ๏ธ Physical tooth treatment image file not found:', imagePath)
console.error('โ Error deleting physical tooth treatment image file:', error.message)
```

## ๐ **ุงูุชูุงูู**:

### **ุงููุธุงู ุงููุฏูู (dental_treatment_images)**:
- โ ูุงู ูุนูู ุจุงููุนู ุจุดูู ุตุญูุญ
- โ ูุญุฐู ุงููููุงุช ุงููุนููุฉ
- โ ูุง ูุญุชุงุฌ ุชุนุฏูู

### **ุงููุธุงู ุงูุฌุฏูุฏ (tooth_treatment_images)**:
- โ ุชู ุฅุตูุงุญู ููุญุฐู ุงููููุงุช ุงููุนููุฉ
- โ ูุฏุนู ููุณ ุขููุฉ ุงููุธุงู ุงููุฏูู
- โ ูุชูุงูู ูุน ุฌููุน ุฃููุงุน ุงููุณุงุฑุงุช

## ๐ **ุฃููุงุน ุงููููุงุช ุงููุฏุนููุฉ**:
- `.jpg`, `.jpeg` - ุตูุฑ JPEG
- `.png` - ุตูุฑ PNG
- `.gif` - ุตูุฑ GIF ูุชุญุฑูุฉ
- `.bmp` - ุตูุฑ Bitmap
- `.webp` - ุตูุฑ WebP ุงูุญุฏูุซุฉ

## ๐ง **ุงูุชุญุณููุงุช ุงููุถุงูุฉ**:

### **ูู EnhancedToothDetailsDialog.tsx**:
```typescript
const handleDeleteImage = async (imageId: string) => {
  if (!window.confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูุตูุฑุฉุ')) {
    return
  }

  try {
    await deleteToothTreatmentImage(imageId)
    
    // ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุฑ ูุชุญุฏูุซ ุงูุนุฑุถ
    if (toothNumber) {
      await loadToothTreatmentImagesByTooth(patientId, toothNumber)
    }
    
    notify.success('ุชู ุญุฐู ุงูุตูุฑุฉ ุจูุฌุงุญ')
  } catch (error) {
    notify.error('ูุดู ูู ุญุฐู ุงูุตูุฑุฉ')
  }
}
```

### **ุชุญุฏูุซ ุงูุนุฏุงุฏุงุช**:
- ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุฑ ุจุนุฏ ุงูุญุฐู
- ุชุญุฏูุซ ุนุฏุงุฏ ุงูุตูุฑ ูู ุงูุฑุณู ุงูุจูุงูู
- ุชุญุฏูุซ ุงูุนุฑุถ ูู ูุงูุฐุฉ ุงูุชูุงุตูู

## ๐ฏ **ุงูููุงุฆุฏ**:

### 1. **ุชูููุฑ ุงููุณุงุญุฉ**:
- ุญุฐู ุงููููุงุช ุบูุฑ ุงููุณุชุฎุฏูุฉ
- ููุน ุชุฑุงูู ุงูุตูุฑ ุงููุญุฐููุฉ
- ุชุญุณูู ุฃุฏุงุก ุงููุธุงู

### 2. **ุงูุชุทุงุจู**:
- ุชุทุงุจู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุงููููุงุช
- ุนุฏู ูุฌูุฏ ูููุงุช ูุชููุฉ
- ูุธุงูุฉ ูุธุงู ุงูุชุฎุฒูู

### 3. **ุงูููุซูููุฉ**:
- ุญุฐู ุขูู ูุน ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ุชุฃููุฏ ุงููุณุชุฎุฏู ูุจู ุงูุญุฐู
- ุฑุณุงุฆู ูุงุถุญุฉ ูููุชุงุฆุฌ

### 4. **ุงูุฃุฏุงุก**:
- ุชุญุฏูุซ ููุฑู ููุนุฑุถ
- ุฅุนุงุฏุฉ ุชุญููู ุฐููุฉ ููุตูุฑ
- ุนุฏุงุฏุงุช ูุญุฏุซุฉ

## ๐ **ููููุฉ ุงูุชุญูู**:

### **ูุจู ุงูุญุฐู**:
1. ุชุญูู ูู ูุฌูุฏ ุงูุตูุฑ ูู ุงููุฌูุฏ
2. ุชุญูู ูู ุนุฏุงุฏ ุงูุตูุฑ ูู ุงูุฑุณู ุงูุจูุงูู

### **ุจุนุฏ ุงูุญุฐู**:
1. ุชุฃูุฏ ูู ุงุฎุชูุงุก ุงูุตูุฑ ูู ุงููุฌูุฏ
2. ุชุฃูุฏ ูู ุชุญุฏูุซ ุงูุนุฏุงุฏ
3. ุชุญูู ูู ุฑุณุงุฆู ุงูุชุณุฌูู ูู ูุญุฏุฉ ุงูุชุญูู

### **ูุณุงุฑุงุช ุงูุชุญูู**:
```
dental_images/
โโโ patient_id/
โ   โโโ tooth_number/
โ   โ   โโโ before/
โ   โ   โโโ after/
โ   โ   โโโ xray/
โ   โ   โโโ clinical/
โ   โ   โโโ other/
```

## ๐ **ููุงุญุธุงุช ูููุฉ**:

1. **ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ**: ุชุฃูุฏ ูู ูุฌูุฏ ูุณุฎ ุงุญุชูุงุทูุฉ ูุจู ุงูุญุฐู
2. **ุงูุตูุงุญูุงุช**: ุชุฃูุฏ ูู ุตูุงุญูุงุช ุงููุชุงุจุฉ ูู ูุฌูุฏุงุช ุงูุตูุฑ
3. **ุงููุณุงุญุฉ**: ุฑุงูุจ ุงุณุชุฎุฏุงู ุงููุณุงุญุฉ ุจุนุฏ ุงูุชุญุฏูุซ
4. **ุงูุฃุฏุงุก**: ุงูุญุฐู ูุฏ ูุณุชุบุฑู ููุชุงู ูููุฌูุฏุงุช ุงููุจูุฑุฉ

ูุฐุง ุงูุฅุตูุงุญ ูุถูู ุญุฐู ุงูุตูุฑ ุจุดูู ูุงูู ูุขูู ูู ุงููุธุงู! ๐ฏ
