var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=Math.pow,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,o=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))r.call(t,n)&&l(e,n,t[n]);return e},d=(e,a)=>t(e,n(a)),c=(e,t)=>{var n={};for(var i in e)s.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&a)for(var i of a(e))t.indexOf(i)<0&&r.call(e,i)&&(n[i]=e[i]);return n},u=(e,t,n)=>(l(e,"symbol"!=typeof t?t+"":t,n),n),m=(e,t,n)=>new Promise((a,s)=>{var r=e=>{try{l(n.next(e))}catch(t){s(t)}},i=e=>{try{l(n.throw(e))}catch(t){s(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,i);l((n=n.apply(e,t)).next())});import{j as p,O as h,C as x,a as g,T as f,D as v,P as y,R as b,S as j,b as w,I as N,c as _,d as k,e as S,f as D,V as $,L as C,g as E,h as T,i as A,k as F,l as P,m as O,G as R,n as M,o as L,p as I,u as z,W as B,q as Y,r as V,s as q,t as U,v as H,w as G,x as W,y as K,z as Z,A as Q,B as X,E as J,F as ee,H as te,J as ne,K as ae,M as se,N as re,Q as ie,U as le,X as oe,Y as de,Z as ce,_ as ue,$ as me,a0 as pe,a1 as he,a2 as xe,a3 as ge}from"./ui-2bbe3a97.js";import{a as fe,r as ve,c as ye,g as be,b as je,d as we}from"./vendor-65b503f8.js";import{c as Ne}from"./utils-c5eafe26.js";import{c as _e,R as ke,P as Se,a as De,C as $e,T as Ce,B as Ee,b as Te,X as Ae,Y as Fe,d as Pe,A as Oe,e as Re,L as Me,f as Le,g as Ie,_ as ze,h as Be,i as Ye,j as Ve,k as qe,l as Ue,m as He,t as Ge,n as We,o as Ke,p as Ze,q as Qe,r as Xe,s as Je,u as et,v as tt,w as nt,x as at,y as st,z as rt,D as it,E as lt,F as ot,G as dt,H as ct,I as ut,J as mt,K as pt,M as ht,N as xt}from"./charts-5d1c5485.js";import{b as gt,J as ft}from"./qr-dfa59ac9.js";import{h as vt,E as yt,_ as bt}from"./pdf-16a93edb.js";import{E as jt}from"./excel-59ffd2a7.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var wt={},Nt=fe;let _t;wt.createRoot=Nt.createRoot,wt.hydrateRoot=Nt.hydrateRoot;const kt=new Uint8Array(16);function St(){if(!_t&&(_t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_t))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _t(kt)}const Dt=[];for(let dT=0;dT<256;++dT)Dt.push((dT+256).toString(16).slice(1));const $t={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ct(e,t,n){if($t.randomUUID&&!t&&!e)return $t.randomUUID();const a=(e=e||{}).random||(e.rng||St)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=a[e];return t}return function(e,t=0){return Dt[e[t+0]]+Dt[e[t+1]]+Dt[e[t+2]]+Dt[e[t+3]]+"-"+Dt[e[t+4]]+Dt[e[t+5]]+"-"+Dt[e[t+6]]+Dt[e[t+7]]+"-"+Dt[e[t+8]]+Dt[e[t+9]]+"-"+Dt[e[t+10]]+Dt[e[t+11]]+Dt[e[t+12]]+Dt[e[t+13]]+Dt[e[t+14]]+Dt[e[t+15]]}(a)}const Et=class e{constructor(){u(this,"patients",[]),u(this,"appointments",[]),u(this,"payments",[]),u(this,"treatments",[]),u(this,"inventory",[]),u(this,"settings",[]),u(this,"labs",[]),u(this,"labOrders",[]),this.initializeMockData()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeMockData(){this.initializeSettings(),this.initializePatients(),this.initializeTreatments(),this.initializeAppointments(),this.initializePayments(),this.initializeInventory(),this.initializeLabs(),this.initializeLabOrders()}initializeSettings(){const e=(new Date).toISOString();this.settings=[{id:Ct(),clinic_name:"عيادة الأسنان التجريبية",clinic_address:"شارع الملك فهد، الرياض، المملكة العربية السعودية",clinic_phone:"+966 11 123 4567",clinic_email:"info@dentalclinic-demo.com",clinic_logo:"",currency:"SAR",language:"ar",timezone:"Asia/Riyadh",backup_frequency:"daily",auto_save_interval:300,appointment_duration:30,working_hours_start:"08:00",working_hours_end:"18:00",working_days:"السبت,الأحد,الاثنين,الثلاثاء,الأربعاء",app_password:null,password_enabled:0,created_at:e,updated_at:e}]}initializePatients(){const e=(new Date).toISOString();this.patients=[{id:Ct(),serial_number:"P001",full_name:"أحمد محمد العلي",gender:"male",age:35,patient_condition:"جيد",allergies:"لا يوجد",medical_conditions:"لا يوجد",email:"ahmed.ali@email.com",address:"الرياض، حي النخيل",notes:"مريض منتظم، يحتاج متابعة دورية",phone:"+966 50 123 4567",date_added:e,created_at:e,updated_at:e},{id:Ct(),serial_number:"P002",full_name:"فاطمة سعد الزهراني",gender:"female",age:28,patient_condition:"ممتاز",allergies:"حساسية من البنسلين",medical_conditions:"لا يوجد",email:"fatima.zahrani@email.com",address:"جدة، حي الصفا",notes:"تحتاج عناية خاصة بسبب الحساسية",phone:"+966 55 987 6543",date_added:e,created_at:e,updated_at:e},{id:Ct(),serial_number:"P003",full_name:"خالد عبدالله القحطاني",gender:"male",age:42,patient_condition:"جيد",allergies:"لا يوجد",medical_conditions:"ضغط الدم",email:"khalid.qahtani@email.com",address:"الدمام، حي الفيصلية",notes:"يتناول أدوية ضغط الدم",phone:"+966 56 456 7890",date_added:e,created_at:e,updated_at:e},{id:Ct(),serial_number:"P004",full_name:"نورا إبراهيم الشمري",gender:"female",age:31,patient_condition:"جيد",allergies:"لا يوجد",medical_conditions:"لا يوجد",email:"nora.shamri@email.com",address:"الرياض، حي العليا",notes:"مريضة جديدة، أول زيارة",phone:"+966 54 321 0987",date_added:e,created_at:e,updated_at:e},{id:Ct(),serial_number:"P005",full_name:"محمد سالم الغامدي",gender:"male",age:25,patient_condition:"ممتاز",allergies:"لا يوجد",medical_conditions:"لا يوجد",email:"mohammed.ghamdi@email.com",address:"مكة المكرمة، حي العزيزية",notes:"طالب جامعي، يحتاج مواعيد مسائية",phone:"+966 53 789 0123",date_added:e,created_at:e,updated_at:e}]}initializeTreatments(){const e=(new Date).toISOString();this.treatments=[{id:Ct(),name:"تنظيف الأسنان",description:"تنظيف شامل للأسنان وإزالة الجير",price:150,duration:30,category:"وقائي",created_at:e,updated_at:e},{id:Ct(),name:"حشو الأسنان",description:"حشو الأسنان بالمواد المركبة",price:200,duration:45,category:"علاجي",created_at:e,updated_at:e},{id:Ct(),name:"علاج العصب",description:"علاج جذور الأسنان",price:800,duration:90,category:"علاجي",created_at:e,updated_at:e},{id:Ct(),name:"تبييض الأسنان",description:"تبييض الأسنان بالليزر",price:1200,duration:60,category:"تجميلي",created_at:e,updated_at:e},{id:Ct(),name:"قلع الأسنان",description:"قلع الأسنان البسيط",price:100,duration:20,category:"جراحي",created_at:e,updated_at:e}]}initializeAppointments(){const e=new Date,t=[];for(let n=0;n<15;n++){const n=new Date(e);n.setDate(e.getDate()+Math.floor(30*Math.random()));const a=8+Math.floor(10*Math.random()),s=Math.random()>.5?0:30;n.setHours(a,s,0,0);const r=this.patients[Math.floor(Math.random()*this.patients.length)],i=this.treatments[Math.floor(Math.random()*this.treatments.length)];t.push({id:Ct(),patient_id:r.id,patient_name:r.full_name,treatment_id:i.id,treatment_name:i.name,appointment_date:n.toISOString().split("T")[0],appointment_time:`${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`,status:Math.random()>.7?"completed":Math.random()>.5?"confirmed":"pending",notes:"موعد تجريبي",created_at:e.toISOString(),updated_at:e.toISOString()})}this.appointments=t}initializePayments(){const e=(new Date).toISOString(),t=[];this.appointments.forEach((n,a)=>{if("completed"===n.status&&Math.random()>.3){const a=this.treatments.find(e=>e.id===n.treatment_id),s=a?a.price:200;t.push({id:Ct(),patient_id:n.patient_id,patient_name:n.patient_name,treatment_id:n.treatment_id,treatment_name:n.treatment_name,amount:s,payment_method:Math.random()>.5?"cash":"card",payment_date:n.appointment_date,notes:"دفعة كاملة",created_at:e,updated_at:e})}}),this.payments=t}initializeInventory(){const e=(new Date).toISOString();this.inventory=[{id:Ct(),name:"قفازات طبية",category:"مستهلكات",quantity:500,unit:"قطعة",price:.5,supplier:"شركة المستلزمات الطبية",expiry_date:"2025-12-31",minimum_stock:100,created_at:e,updated_at:e},{id:Ct(),name:"حشوات مركبة",category:"مواد علاجية",quantity:50,unit:"أنبوب",price:25,supplier:"شركة المواد السنية",expiry_date:"2026-06-30",minimum_stock:10,created_at:e,updated_at:e},{id:Ct(),name:"مخدر موضعي",category:"أدوية",quantity:20,unit:"أمبولة",price:15,supplier:"شركة الأدوية المتقدمة",expiry_date:"2025-08-15",minimum_stock:5,created_at:e,updated_at:e}]}initializeLabs(){const e=(new Date).toISOString();this.labs=[{id:Ct(),name:"مختبر الأسنان المتقدم",contact_person:"د. سعد الأحمد",phone:"+966 11 555 0001",email:"lab@advanced-dental.com",address:"الرياض، حي الملز",services:"تيجان، جسور، أطقم أسنان",created_at:e,updated_at:e},{id:Ct(),name:"مختبر الابتسامة الذهبية",contact_person:"أ. محمد الخالد",phone:"+966 11 555 0002",email:"info@golden-smile.com",address:"الرياض، حي العليا",services:"تقويم، فينير، زراعة",created_at:e,updated_at:e}]}initializeLabOrders(){const e=(new Date).toISOString();this.labOrders=[{id:Ct(),patient_id:this.patients[0].id,patient_name:this.patients[0].full_name,lab_id:this.labs[0].id,lab_name:this.labs[0].name,order_type:"تاج",description:"تاج للضرس العلوي الأيمن",order_date:e,expected_delivery:new Date(Date.now()+6048e5).toISOString(),status:"في التصنيع",cost:800,notes:"لون A2",created_at:e,updated_at:e}]}getAllPatients(){return m(this,null,function*(){return[...this.patients]})}createPatient(e){return m(this,null,function*(){const t=(new Date).toISOString(),n=d(o({},e),{id:Ct(),created_at:t,updated_at:t});return this.patients.push(n),n})}updatePatient(e,t){return m(this,null,function*(){const n=this.patients.findIndex(t=>t.id===e);return-1===n?null:(this.patients[n]=d(o(o({},this.patients[n]),t),{updated_at:(new Date).toISOString()}),this.patients[n])})}deletePatient(e){return m(this,null,function*(){const t=this.patients.findIndex(t=>t.id===e);return-1!==t&&(this.patients.splice(t,1),!0)})}getAllAppointments(){return m(this,null,function*(){return[...this.appointments]})}createAppointment(e){return m(this,null,function*(){const t=(new Date).toISOString(),n=d(o({},e),{id:Ct(),created_at:t,updated_at:t});return this.appointments.push(n),n})}updateAppointment(e,t){return m(this,null,function*(){const n=this.appointments.findIndex(t=>t.id===e);return-1===n?null:(this.appointments[n]=d(o(o({},this.appointments[n]),t),{updated_at:(new Date).toISOString()}),this.appointments[n])})}deleteAppointment(e){return m(this,null,function*(){const t=this.appointments.findIndex(t=>t.id===e);return-1!==t&&(this.appointments.splice(t,1),!0)})}getAllPayments(){return m(this,null,function*(){return[...this.payments]})}createPayment(e){return m(this,null,function*(){const t=(new Date).toISOString(),n=d(o({},e),{id:Ct(),created_at:t,updated_at:t});return this.payments.push(n),n})}getAllTreatments(){return m(this,null,function*(){return[...this.treatments]})}getAllInventory(){return m(this,null,function*(){return[...this.inventory]})}getSettings(){return m(this,null,function*(){return this.settings[0]||null})}updateSettings(e){return m(this,null,function*(){return 0===this.settings.length?null:(this.settings[0]=d(o(o({},this.settings[0]),e),{updated_at:(new Date).toISOString()}),this.settings[0])})}getAllLabs(){return m(this,null,function*(){return[...this.labs]})}getAllLabOrders(){return m(this,null,function*(){return[...this.labOrders]})}getDashboardStats(){return m(this,null,function*(){return{totalPatients:this.patients.length,totalAppointments:this.appointments.length,totalRevenue:this.payments.reduce((e,t)=>e+t.amount,0),pendingAppointments:this.appointments.filter(e=>"pending"===e.status).length,completedAppointments:this.appointments.filter(e=>"completed"===e.status).length,todayAppointments:this.appointments.filter(e=>{const t=(new Date).toISOString().split("T")[0];return e.appointment_date===t}).length}})}};u(Et,"instance");const Tt=Et.getInstance(),At=Ne((e,t)=>({patients:[],isLoading:!1,error:null,loadPatients:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const t=yield Tt.getAllPatients();e({patients:t,isLoading:!1})}catch(t){console.error("Error loading patients:",t),e({error:"Failed to load patients",isLoading:!1})}}),createPatient:t=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const n=yield Tt.createPatient(t);return e(e=>({patients:[...e.patients,n],isLoading:!1})),n}catch(n){throw console.error("Error creating patient:",n),e({error:"Failed to create patient",isLoading:!1}),n}}),updatePatient:(t,n)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield Tt.updatePatient(t,n);return a&&e(e=>({patients:e.patients.map(e=>e.id===t?a:e),isLoading:!1})),a}catch(a){return console.error("Error updating patient:",a),e({error:"Failed to update patient",isLoading:!1}),null}}),deletePatient:t=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const n=yield Tt.deletePatient(t);return n&&e(e=>({patients:e.patients.filter(e=>e.id!==t),isLoading:!1})),n}catch(n){return console.error("Error deleting patient:",n),e({error:"Failed to delete patient",isLoading:!1}),!1}}),getPatientById:e=>t().patients.find(t=>t.id===e),searchPatients:e=>{const{patients:n}=t();if(!e.trim())return n;const a=e.toLowerCase();return n.filter(e=>{var t,n;return e.full_name.toLowerCase().includes(a)||e.serial_number.toLowerCase().includes(a)||(null==(t=e.phone)?void 0:t.toLowerCase().includes(a))||(null==(n=e.email)?void 0:n.toLowerCase().includes(a))})}})),Ft=Ne((e,t)=>({appointments:[],isLoading:!1,error:null,loadAppointments:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const t=yield Tt.getAllAppointments();e({appointments:t,isLoading:!1})}catch(t){console.error("Error loading appointments:",t),e({error:"Failed to load appointments",isLoading:!1})}}),createAppointment:t=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const n=yield Tt.createAppointment(t);return e(e=>({appointments:[...e.appointments,n],isLoading:!1})),n}catch(n){throw console.error("Error creating appointment:",n),e({error:"Failed to create appointment",isLoading:!1}),n}}),updateAppointment:(t,n)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield Tt.updateAppointment(t,n);return a&&e(e=>({appointments:e.appointments.map(e=>e.id===t?a:e),isLoading:!1})),a}catch(a){return console.error("Error updating appointment:",a),e({error:"Failed to update appointment",isLoading:!1}),null}}),deleteAppointment:t=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const n=yield Tt.deleteAppointment(t);return n&&e(e=>({appointments:e.appointments.filter(e=>e.id!==t),isLoading:!1})),n}catch(n){return console.error("Error deleting appointment:",n),e({error:"Failed to delete appointment",isLoading:!1}),!1}}),getAppointmentById:e=>t().appointments.find(t=>t.id===e),getAppointmentsByDate:e=>t().appointments.filter(t=>t.appointment_date===e),getAppointmentsByPatient:e=>t().appointments.filter(t=>t.patient_id===e)})),Pt=Ne((e,t)=>({settings:null,isLoading:!1,error:null,loadSettings:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const t=yield Tt.getSettings();e({settings:t,isLoading:!1})}catch(t){console.error("Error loading settings:",t),e({error:"Failed to load settings",isLoading:!1})}}),updateSettings:t=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const n=yield Tt.updateSettings(t);return e({settings:n,isLoading:!1}),n}catch(n){return console.error("Error updating settings:",n),e({error:"Failed to update settings",isLoading:!1}),null}})})),Ot=new Map,Rt=e=>{const t=Ot.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},Mt=e=>{var t,n;if(!e)return;const a=e.split("\n"),s=a.findIndex(e=>e.includes("api.setState"));if(s<0)return;const r=(null==(t=a[s+1])?void 0:t.trim())||"";return null==(n=/.+ (.+) .+/.exec(r))?void 0:n[1]},Lt=(e,t={})=>(n,a,s)=>{const r=t,{enabled:i,anonymousActionType:l,store:u}=r,m=c(r,["enabled","anonymousActionType","store"]);let p;try{p=null!=i&&i&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(b){}if(!p)return e(n,a,s);const h=((e,t,n)=>{if(void 0===e)return{type:"untracked",connection:t.connect(n)};const a=Ot.get(n.name);if(a)return o({type:"tracked",store:e},a);const s={connection:t.connect(n),stores:{}};return Ot.set(n.name,s),o({type:"tracked",store:e},s)})(u,p,m),{connection:x}=h,g=c(h,["connection"]);let f=!0;s.setState=(e,t,r)=>{const i=n(e,t);if(!f)return i;const c=void 0===r?{type:l||Mt((new Error).stack)||"anonymous"}:"string"==typeof r?{type:r}:r;return void 0===u?(null==x||x.send(c,a()),i):(null==x||x.send(d(o({},c),{type:`${u}/${c.type}`}),d(o({},Rt(m.name)),{[u]:s.getState()})),i)},s.devtools={cleanup:()=>{x&&"function"==typeof x.unsubscribe&&x.unsubscribe(),((e,t)=>{if(void 0===t)return;const n=Ot.get(e);n&&(delete n.stores[t],0===Object.keys(n.stores).length&&Ot.delete(e))})(m.name,u)}};const v=(...e)=>{const t=f;f=!1,n(...e),f=t},y=e(s.setState,a,s);if("untracked"===g.type?null==x||x.init(y):(g.stores[g.store]=s,null==x||x.init(Object.fromEntries(Object.entries(g.stores).map(([e,t])=>[e,e===g.store?y:t.getState()])))),s.dispatchFromDevtools&&"function"==typeof s.dispatch){const e=s.dispatch;s.dispatch=(...t)=>{e(...t)}}return x.subscribe(e=>{var t;switch(e.type){case"ACTION":return"string"!=typeof e.payload?void console.error("[zustand devtools middleware] Unsupported action format"):It(e.payload,e=>{if("__setState"===e.type){if(void 0===u)return void v(e.state);1!==Object.keys(e.state).length&&console.error('\n                    [zustand devtools middleware] Unsupported __setState action format.\n                    When using \'store\' option in devtools(), the \'state\' should have only one key, which is a value of \'store\' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }\n                    ');const t=e.state[u];if(null==t)return;return void(JSON.stringify(s.getState())!==JSON.stringify(t)&&v(t))}s.dispatchFromDevtools&&"function"==typeof s.dispatch&&s.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":return v(y),void 0===u?null==x?void 0:x.init(s.getState()):null==x?void 0:x.init(Rt(m.name));case"COMMIT":return void 0===u?void(null==x||x.init(s.getState())):null==x?void 0:x.init(Rt(m.name));case"ROLLBACK":return It(e.state,e=>{if(void 0===u)return v(e),void(null==x||x.init(s.getState()));v(e[u]),null==x||x.init(Rt(m.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return It(e.state,e=>{void 0!==u?JSON.stringify(s.getState())!==JSON.stringify(e[u])&&v(e[u]):v(e)});case"IMPORT_STATE":{const{nextLiftedState:n}=e.payload,a=null==(t=n.computedStates.slice(-1)[0])?void 0:t.state;if(!a)return;return v(void 0===u?a:a[u]),void(null==x||x.send(null,n))}case"PAUSE_RECORDING":return f=!f}return}}),y},It=(e,t)=>{let n;try{n=JSON.parse(e)}catch(a){console.error("[zustand devtools middleware] Could not parse the received json",a)}void 0!==n&&t(n)};function zt(e,t){let n;try{n=e()}catch(a){return}return{getItem:e=>{var a;const s=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),r=null!=(a=n.getItem(e))?a:null;return r instanceof Promise?r.then(s):s(r)},setItem:(e,a)=>n.setItem(e,JSON.stringify(a,null==t?void 0:t.replacer)),removeItem:e=>n.removeItem(e)}}const Bt=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then:e=>Bt(e)(n),catch(e){return this}}}catch(n){return{then(e){return this},catch:e=>Bt(e)(n)}}},Yt=(e,t)=>(n,a,s)=>{let r=o({storage:zt(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>o(o({},t),e)},t),i=!1;const l=new Set,d=new Set;let c=r.storage;if(!c)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),n(...e)},a,s);const u=()=>{const e=r.partialize(o({},a()));return c.setItem(r.name,{state:e,version:r.version})},m=s.setState;s.setState=(e,t)=>{m(e,t),u()};const p=e((...e)=>{n(...e),u()},a,s);let h;s.getInitialState=()=>p;const x=()=>{var e,t;if(!c)return;i=!1,l.forEach(e=>{var t;return e(null!=(t=a())?t:p)});const s=(null==(t=r.onRehydrateStorage)?void 0:t.call(r,null!=(e=a())?e:p))||void 0;return Bt(c.getItem.bind(c))(r.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===r.version)return[!1,e.state];if(r.migrate){const t=r.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;const[s,i]=e;if(h=r.merge(i,null!=(t=a())?t:p),n(h,!0),s)return u()}).then(()=>{null==s||s(h,void 0),h=a(),i=!0,d.forEach(e=>e(h))}).catch(e=>{null==s||s(void 0,e)})};return s.persist={setOptions:e=>{r=o(o({},r),e),e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>x(),hasHydrated:()=>i,onHydrate:e=>(l.add(e),()=>{l.delete(e)}),onFinishHydration:e=>(d.add(e),()=>{d.delete(e)})},r.skipHydration||x(),h||p},Vt=e=>{if(e&&e.clinic_name&&"عيادة الأسنان"!==e.clinic_name)try{const t={clinic_name:e.clinic_name,doctor_name:e.doctor_name,clinic_logo:e.clinic_logo,clinic_phone:e.clinic_phone,clinic_email:e.clinic_email,clinic_address:e.clinic_address,timestamp:Date.now()};localStorage.setItem("dental-clinic-settings-backup",JSON.stringify(t)),console.log("Settings backup saved to localStorage")}catch(t){console.warn("Failed to save settings backup:",t)}},qt=Ne()(Lt(Yt((e,t)=>({settings:null,isLoading:!1,error:null,isDarkMode:!1,language:"en",currency:"USD",loadSettings:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const t=yield window.electronAPI.settings.get();if(!t||!t.clinic_name||"عيادة الأسنان"===t.clinic_name){const n=(()=>{try{const e=localStorage.getItem("dental-clinic-settings-backup");if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<2592e6&&t.clinic_name&&"عيادة الأسنان"!==t.clinic_name)return console.log("Restoring settings from localStorage backup"),t}}catch(e){console.warn("Failed to restore settings backup:",e)}return null})();if(n){const a=o(o({},t),n);return yield window.electronAPI.settings.update(n),e({settings:a,language:(null==t?void 0:t.language)||"ar",currency:(null==t?void 0:t.currency)||"USD",isLoading:!1}),void Vt(a)}}e({settings:t,language:(null==t?void 0:t.language)||"ar",currency:(null==t?void 0:t.currency)||"USD",isLoading:!1}),Vt(t)}catch(t){e({error:t instanceof Error?t.message:"Failed to load settings",isLoading:!1})}}),updateSettings:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield window.electronAPI.settings.update(n);e({settings:a,language:a.language,currency:a.currency,isLoading:!1}),Vt(a),setTimeout(()=>{const n=t();n.settings&&e({settings:n.settings})},10)}catch(a){e({error:a instanceof Error?a.message:"Failed to update settings",isLoading:!1})}}),toggleDarkMode:()=>{const{isDarkMode:n,settings:a}=t(),s=!n,r=a;if(e({isDarkMode:s,settings:r}),s?(document.documentElement.classList.add("dark"),localStorage.setItem("dental-clinic-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("dental-clinic-theme","light")),r)try{localStorage.setItem("dental-clinic-settings-backup",JSON.stringify({clinic_name:r.clinic_name,doctor_name:r.doctor_name,clinic_logo:r.clinic_logo,clinic_phone:r.clinic_phone,clinic_email:r.clinic_email,clinic_address:r.clinic_address,backup_timestamp:Date.now()}))}catch(i){console.warn("Failed to save settings backup:",i)}try{t().updateSettings({theme:s?"dark":"light"})}catch(i){console.warn("Failed to save theme preference to database:",i)}},initializeDarkMode:()=>{const n=localStorage.getItem("dental-clinic-theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches,s=t();let r=!1;n?r="dark"===n:(r=a,localStorage.setItem("dental-clinic-theme",r?"dark":"light"));const i=s.settings;r!==s.isDarkMode&&(e({isDarkMode:r,settings:i}),r?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")),i||t().loadSettings()},setLanguage:n=>{e({language:n}),t().updateSettings({language:n})},setCurrency:n=>{e({currency:n}),t().updateSettings({currency:n})},clearError:()=>{e({error:null})},getWorkingDays:()=>{const{settings:e}=t();return(null==e?void 0:e.working_days)?e.working_days.split(",").map(e=>e.trim()):["monday","tuesday","wednesday","thursday","friday"]},isWorkingDay:e=>{const n=t().getWorkingDays(),a=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][e.getDay()];return n.includes(a)},getWorkingHours:()=>{const{settings:e}=t();return{start:(null==e?void 0:e.working_hours_start)||"09:00",end:(null==e?void 0:e.working_hours_end)||"17:00"}},isWithinWorkingHours:e=>{const{start:n,end:a}=t().getWorkingHours();return e>=n&&e<=a}}),{name:"settings-store",partialize:e=>({language:e.language,currency:e.currency,isDarkMode:e.isDarkMode,clinicSettingsBackup:e.settings?{clinic_name:e.settings.clinic_name,doctor_name:e.settings.doctor_name,clinic_logo:e.settings.clinic_logo,clinic_phone:e.settings.clinic_phone,clinic_email:e.settings.clinic_email,clinic_address:e.settings.clinic_address,backup_timestamp:Date.now()}:null}),storage:{getItem:e=>{const t=localStorage.getItem(e);return t?JSON.parse(t):null},setItem:(e,t)=>{var n;localStorage.setItem(e,JSON.stringify(t)),(null==(n=t.state)?void 0:n.clinicSettingsBackup)&&localStorage.setItem("dental-clinic-settings-backup",JSON.stringify(t.state.clinicSettingsBackup))},removeItem:e=>localStorage.removeItem(e)}}),{name:"settings-store"})),Ut=ve.createContext(void 0);function Ht({children:e}){const{isDarkMode:t,toggleDarkMode:n,initializeDarkMode:a,loadSettings:s,settings:r}=qt();ve.useEffect(()=>{a();const e=localStorage.getItem("dental-clinic-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;let n=!1;n=e?"dark"===e:t,n?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),r||s()},[a]),ve.useEffect(()=>{t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[t]);const i={isDarkMode:t,toggleDarkMode:()=>{n()},setDarkMode:e=>{e!==t&&n()}};return p.jsx(Ut.Provider,{value:i,children:e})}function Gt(){const e=ve.useContext(Ut);if(void 0===e)throw new Error("useTheme must be used within a ThemeProvider");return e}const Wt=(e,t)=>{var n;if(0===e.length)return t.classGroupId;const a=e[0],s=t.nextPart.get(a),r=s?Wt(e.slice(1),s):void 0;if(r)return r;if(0===t.validators.length)return;const i=e.join("-");return null==(n=t.validators.find(({validator:e})=>e(i)))?void 0:n.classGroupId},Kt=/^\[(.+)\]$/,Zt=e=>{if(Kt.test(e)){const t=Kt.exec(e)[1],n=null==t?void 0:t.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},Qt=e=>{const{theme:t,classGroups:n}=e,a={nextPart:new Map,validators:[]};for(const s in n)Xt(n[s],a,s,t);return a},Xt=(e,t,n,a)=>{e.forEach(e=>{if("string"==typeof e){return void((""===e?t:Jt(t,e)).classGroupId=n)}if("function"==typeof e)return en(e)?void Xt(e(a),t,n,a):void t.validators.push({validator:e,classGroupId:n});Object.entries(e).forEach(([e,s])=>{Xt(s,Jt(t,e),n,a)})})},Jt=(e,t)=>{let n=e;return t.split("-").forEach(e=>{n.nextPart.has(e)||n.nextPart.set(e,{nextPart:new Map,validators:[]}),n=n.nextPart.get(e)}),n},en=e=>e.isThemeGetter,tn=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,a=new Map;const s=(s,r)=>{n.set(s,r),t++,t>e&&(t=0,a=n,n=new Map)};return{get(e){let t=n.get(e);return void 0!==t?t:void 0!==(t=a.get(e))?(s(e,t),t):void 0},set(e,t){n.has(e)?n.set(e,t):s(e,t)}}},nn=e=>{const{prefix:t,experimentalParseClassName:n}=e;let a=e=>{const t=[];let n,a=0,s=0,r=0;for(let o=0;o<e.length;o++){let i=e[o];if(0===a&&0===s){if(":"===i){t.push(e.slice(r,o)),r=o+1;continue}if("/"===i){n=o;continue}}"["===i?a++:"]"===i?a--:"("===i?s++:")"===i&&s--}const i=0===t.length?e:e.substring(r),l=an(i);return{modifiers:t,hasImportantModifier:l!==i,baseClassName:l,maybePostfixModifierPosition:n&&n>r?n-r:void 0}};if(t){const e=t+":",n=a;a=t=>t.startsWith(e)?n(t.substring(e.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:t,maybePostfixModifierPosition:void 0}}if(n){const e=a;a=t=>n({className:t,parseClassName:e})}return a},an=e=>e.endsWith("!")?e.substring(0,e.length-1):e.startsWith("!")?e.substring(1):e,sn=e=>{const t=Object.fromEntries(e.orderSensitiveModifiers.map(e=>[e,!0]));return e=>{if(e.length<=1)return e;const n=[];let a=[];return e.forEach(e=>{"["===e[0]||t[e]?(n.push(...a.sort(),e),a=[]):a.push(e)}),n.push(...a.sort()),n}},rn=e=>o({cache:tn(e.cacheSize),parseClassName:nn(e),sortModifiers:sn(e)},(e=>{const t=Qt(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:e=>{const n=e.split("-");return""===n[0]&&1!==n.length&&n.shift(),Wt(n,t)||Zt(e)},getConflictingClassGroupIds:(e,t)=>{const s=n[e]||[];return t&&a[e]?[...s,...a[e]]:s}}})(e)),ln=/\s+/;function on(){let e,t,n=0,a="";for(;n<arguments.length;)(e=arguments[n++])&&(t=dn(e))&&(a&&(a+=" "),a+=t);return a}const dn=e=>{if("string"==typeof e)return e;let t,n="";for(let a=0;a<e.length;a++)e[a]&&(t=dn(e[a]))&&(n&&(n+=" "),n+=t);return n};function cn(e,...t){let n,a,s,r=function(l){const o=t.reduce((e,t)=>t(e),e());return n=rn(o),a=n.cache.get,s=n.cache.set,r=i,i(l)};function i(e){const t=a(e);if(t)return t;const r=((e,t)=>{const{parseClassName:n,getClassGroupId:a,getConflictingClassGroupIds:s,sortModifiers:r}=t,i=[],l=e.trim().split(ln);let o="";for(let d=l.length-1;d>=0;d-=1){const e=l[d],{isExternal:t,modifiers:c,hasImportantModifier:u,baseClassName:m,maybePostfixModifierPosition:p}=n(e);if(t){o=e+(o.length>0?" "+o:o);continue}let h=!!p,x=a(h?m.substring(0,p):m);if(!x){if(!h){o=e+(o.length>0?" "+o:o);continue}if(x=a(m),!x){o=e+(o.length>0?" "+o:o);continue}h=!1}const g=r(c).join(":"),f=u?g+"!":g,v=f+x;if(i.includes(v))continue;i.push(v);const y=s(x,h);for(let n=0;n<y.length;++n){const e=y[n];i.push(f+e)}o=e+(o.length>0?" "+o:o)}return o})(e,n);return s(e,r),r}return function(){return r(on.apply(null,arguments))}}const un=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},mn=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,pn=/^\((?:(\w[\w-]*):)?(.+)\)$/i,hn=/^\d+\/\d+$/,xn=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,gn=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,fn=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,vn=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,yn=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,bn=e=>hn.test(e),jn=e=>!!e&&!Number.isNaN(Number(e)),wn=e=>!!e&&Number.isInteger(Number(e)),Nn=e=>e.endsWith("%")&&jn(e.slice(0,-1)),_n=e=>xn.test(e),kn=()=>!0,Sn=e=>gn.test(e)&&!fn.test(e),Dn=()=>!1,$n=e=>vn.test(e),Cn=e=>yn.test(e),En=e=>!An(e)&&!Ln(e),Tn=e=>Un(e,Kn,Dn),An=e=>mn.test(e),Fn=e=>Un(e,Zn,Sn),Pn=e=>Un(e,Qn,jn),On=e=>Un(e,Gn,Dn),Rn=e=>Un(e,Wn,Cn),Mn=e=>Un(e,Jn,$n),Ln=e=>pn.test(e),In=e=>Hn(e,Zn),zn=e=>Hn(e,Xn),Bn=e=>Hn(e,Gn),Yn=e=>Hn(e,Kn),Vn=e=>Hn(e,Wn),qn=e=>Hn(e,Jn,!0),Un=(e,t,n)=>{const a=mn.exec(e);return!!a&&(a[1]?t(a[1]):n(a[2]))},Hn=(e,t,n=!1)=>{const a=pn.exec(e);return!!a&&(a[1]?t(a[1]):n)},Gn=e=>"position"===e||"percentage"===e,Wn=e=>"image"===e||"url"===e,Kn=e=>"length"===e||"size"===e||"bg-size"===e,Zn=e=>"length"===e,Qn=e=>"number"===e,Xn=e=>"family-name"===e,Jn=e=>"shadow"===e,ea=cn(()=>{const e=un("color"),t=un("font"),n=un("text"),a=un("font-weight"),s=un("tracking"),r=un("leading"),i=un("breakpoint"),l=un("container"),o=un("spacing"),d=un("radius"),c=un("shadow"),u=un("inset-shadow"),m=un("text-shadow"),p=un("drop-shadow"),h=un("blur"),x=un("perspective"),g=un("aspect"),f=un("ease"),v=un("animate"),y=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",Ln,An],b=()=>[Ln,An,o],j=()=>[bn,"full","auto",...b()],w=()=>[wn,"none","subgrid",Ln,An],N=()=>["auto",{span:["full",wn,Ln,An]},wn,Ln,An],_=()=>[wn,"auto",Ln,An],k=()=>["auto","min","max","fr",Ln,An],S=()=>["auto",...b()],D=()=>[bn,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...b()],$=()=>[e,Ln,An],C=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",Bn,On,{position:[Ln,An]}],E=()=>["auto","cover","contain",Yn,Tn,{size:[Ln,An]}],T=()=>[Nn,In,Fn],A=()=>["","none","full",d,Ln,An],F=()=>["",jn,In,Fn],P=()=>[jn,Nn,Bn,On],O=()=>["","none",h,Ln,An],R=()=>["none",jn,Ln,An],M=()=>["none",jn,Ln,An],L=()=>[jn,Ln,An],I=()=>[bn,"full",...b()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[_n],breakpoint:[_n],color:[kn],container:[_n],"drop-shadow":[_n],ease:["in","out","in-out"],font:[En],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[_n],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[_n],shadow:[_n],spacing:["px",jn],text:[_n],"text-shadow":[_n],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",bn,An,Ln,g]}],container:["container"],columns:[{columns:[jn,An,Ln,l]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:y()}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:j()}],"inset-x":[{"inset-x":j()}],"inset-y":[{"inset-y":j()}],start:[{start:j()}],end:[{end:j()}],top:[{top:j()}],right:[{right:j()}],bottom:[{bottom:j()}],left:[{left:j()}],visibility:["visible","invisible","collapse"],z:[{z:[wn,"auto",Ln,An]}],basis:[{basis:[bn,"full","auto",l,...b()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[jn,bn,"auto","initial","none",An]}],grow:[{grow:["",jn,Ln,An]}],shrink:[{shrink:["",jn,Ln,An]}],order:[{order:[wn,"first","last","none",Ln,An]}],"grid-cols":[{"grid-cols":w()}],"col-start-end":[{col:N()}],"col-start":[{"col-start":_()}],"col-end":[{"col-end":_()}],"grid-rows":[{"grid-rows":w()}],"row-start-end":[{row:N()}],"row-start":[{"row-start":_()}],"row-end":[{"row-end":_()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":k()}],"auto-rows":[{"auto-rows":k()}],gap:[{gap:b()}],"gap-x":[{"gap-x":b()}],"gap-y":[{"gap-y":b()}],"justify-content":[{justify:["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe","normal"]}],"justify-items":[{"justify-items":["start","end","center","stretch","center-safe","end-safe","normal"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"align-items":[{items:["start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"align-self":[{self:["auto","start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"place-items":[{"place-items":["start","end","center","stretch","center-safe","end-safe","baseline"]}],"place-self":[{"place-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],p:[{p:b()}],px:[{px:b()}],py:[{py:b()}],ps:[{ps:b()}],pe:[{pe:b()}],pt:[{pt:b()}],pr:[{pr:b()}],pb:[{pb:b()}],pl:[{pl:b()}],m:[{m:S()}],mx:[{mx:S()}],my:[{my:S()}],ms:[{ms:S()}],me:[{me:S()}],mt:[{mt:S()}],mr:[{mr:S()}],mb:[{mb:S()}],ml:[{ml:S()}],"space-x":[{"space-x":b()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":b()}],"space-y-reverse":["space-y-reverse"],size:[{size:D()}],w:[{w:[l,"screen",...D()]}],"min-w":[{"min-w":[l,"screen","none",...D()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[i]},...D()]}],h:[{h:["screen","lh",...D()]}],"min-h":[{"min-h":["screen","lh","none",...D()]}],"max-h":[{"max-h":["screen","lh",...D()]}],"font-size":[{text:["base",n,In,Fn]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[a,Ln,Pn]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Nn,An]}],"font-family":[{font:[zn,An,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,Ln,An]}],"line-clamp":[{"line-clamp":[jn,"none",Ln,Pn]}],leading:[{leading:[r,...b()]}],"list-image":[{"list-image":["none",Ln,An]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Ln,An]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:$()}],"text-color":[{text:$()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","wavy"]}],"text-decoration-thickness":[{decoration:[jn,"from-font","auto",Ln,Fn]}],"text-decoration-color":[{decoration:$()}],"underline-offset":[{"underline-offset":[jn,"auto",Ln,An]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:b()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ln,An]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ln,An]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:C()}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:E()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},wn,Ln,An],radial:["",Ln,An],conic:[wn,Ln,An]},Vn,Rn]}],"bg-color":[{bg:$()}],"gradient-from-pos":[{from:T()}],"gradient-via-pos":[{via:T()}],"gradient-to-pos":[{to:T()}],"gradient-from":[{from:$()}],"gradient-via":[{via:$()}],"gradient-to":[{to:$()}],rounded:[{rounded:A()}],"rounded-s":[{"rounded-s":A()}],"rounded-e":[{"rounded-e":A()}],"rounded-t":[{"rounded-t":A()}],"rounded-r":[{"rounded-r":A()}],"rounded-b":[{"rounded-b":A()}],"rounded-l":[{"rounded-l":A()}],"rounded-ss":[{"rounded-ss":A()}],"rounded-se":[{"rounded-se":A()}],"rounded-ee":[{"rounded-ee":A()}],"rounded-es":[{"rounded-es":A()}],"rounded-tl":[{"rounded-tl":A()}],"rounded-tr":[{"rounded-tr":A()}],"rounded-br":[{"rounded-br":A()}],"rounded-bl":[{"rounded-bl":A()}],"border-w":[{border:F()}],"border-w-x":[{"border-x":F()}],"border-w-y":[{"border-y":F()}],"border-w-s":[{"border-s":F()}],"border-w-e":[{"border-e":F()}],"border-w-t":[{"border-t":F()}],"border-w-r":[{"border-r":F()}],"border-w-b":[{"border-b":F()}],"border-w-l":[{"border-l":F()}],"divide-x":[{"divide-x":F()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":F()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:["solid","dashed","dotted","double","hidden","none"]}],"divide-style":[{divide:["solid","dashed","dotted","double","hidden","none"]}],"border-color":[{border:$()}],"border-color-x":[{"border-x":$()}],"border-color-y":[{"border-y":$()}],"border-color-s":[{"border-s":$()}],"border-color-e":[{"border-e":$()}],"border-color-t":[{"border-t":$()}],"border-color-r":[{"border-r":$()}],"border-color-b":[{"border-b":$()}],"border-color-l":[{"border-l":$()}],"divide-color":[{divide:$()}],"outline-style":[{outline:["solid","dashed","dotted","double","none","hidden"]}],"outline-offset":[{"outline-offset":[jn,Ln,An]}],"outline-w":[{outline:["",jn,In,Fn]}],"outline-color":[{outline:$()}],shadow:[{shadow:["","none",c,qn,Mn]}],"shadow-color":[{shadow:$()}],"inset-shadow":[{"inset-shadow":["none",u,qn,Mn]}],"inset-shadow-color":[{"inset-shadow":$()}],"ring-w":[{ring:F()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:$()}],"ring-offset-w":[{"ring-offset":[jn,Fn]}],"ring-offset-color":[{"ring-offset":$()}],"inset-ring-w":[{"inset-ring":F()}],"inset-ring-color":[{"inset-ring":$()}],"text-shadow":[{"text-shadow":["none",m,qn,Mn]}],"text-shadow-color":[{"text-shadow":$()}],opacity:[{opacity:[jn,Ln,An]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[jn]}],"mask-image-linear-from-pos":[{"mask-linear-from":P()}],"mask-image-linear-to-pos":[{"mask-linear-to":P()}],"mask-image-linear-from-color":[{"mask-linear-from":$()}],"mask-image-linear-to-color":[{"mask-linear-to":$()}],"mask-image-t-from-pos":[{"mask-t-from":P()}],"mask-image-t-to-pos":[{"mask-t-to":P()}],"mask-image-t-from-color":[{"mask-t-from":$()}],"mask-image-t-to-color":[{"mask-t-to":$()}],"mask-image-r-from-pos":[{"mask-r-from":P()}],"mask-image-r-to-pos":[{"mask-r-to":P()}],"mask-image-r-from-color":[{"mask-r-from":$()}],"mask-image-r-to-color":[{"mask-r-to":$()}],"mask-image-b-from-pos":[{"mask-b-from":P()}],"mask-image-b-to-pos":[{"mask-b-to":P()}],"mask-image-b-from-color":[{"mask-b-from":$()}],"mask-image-b-to-color":[{"mask-b-to":$()}],"mask-image-l-from-pos":[{"mask-l-from":P()}],"mask-image-l-to-pos":[{"mask-l-to":P()}],"mask-image-l-from-color":[{"mask-l-from":$()}],"mask-image-l-to-color":[{"mask-l-to":$()}],"mask-image-x-from-pos":[{"mask-x-from":P()}],"mask-image-x-to-pos":[{"mask-x-to":P()}],"mask-image-x-from-color":[{"mask-x-from":$()}],"mask-image-x-to-color":[{"mask-x-to":$()}],"mask-image-y-from-pos":[{"mask-y-from":P()}],"mask-image-y-to-pos":[{"mask-y-to":P()}],"mask-image-y-from-color":[{"mask-y-from":$()}],"mask-image-y-to-color":[{"mask-y-to":$()}],"mask-image-radial":[{"mask-radial":[Ln,An]}],"mask-image-radial-from-pos":[{"mask-radial-from":P()}],"mask-image-radial-to-pos":[{"mask-radial-to":P()}],"mask-image-radial-from-color":[{"mask-radial-from":$()}],"mask-image-radial-to-color":[{"mask-radial-to":$()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"]}],"mask-image-conic-pos":[{"mask-conic":[jn]}],"mask-image-conic-from-pos":[{"mask-conic-from":P()}],"mask-image-conic-to-pos":[{"mask-conic-to":P()}],"mask-image-conic-from-color":[{"mask-conic-from":$()}],"mask-image-conic-to-color":[{"mask-conic-to":$()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:C()}],"mask-repeat":[{mask:["no-repeat",{repeat:["","x","y","space","round"]}]}],"mask-size":[{mask:E()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Ln,An]}],filter:[{filter:["","none",Ln,An]}],blur:[{blur:O()}],brightness:[{brightness:[jn,Ln,An]}],contrast:[{contrast:[jn,Ln,An]}],"drop-shadow":[{"drop-shadow":["","none",p,qn,Mn]}],"drop-shadow-color":[{"drop-shadow":$()}],grayscale:[{grayscale:["",jn,Ln,An]}],"hue-rotate":[{"hue-rotate":[jn,Ln,An]}],invert:[{invert:["",jn,Ln,An]}],saturate:[{saturate:[jn,Ln,An]}],sepia:[{sepia:["",jn,Ln,An]}],"backdrop-filter":[{"backdrop-filter":["","none",Ln,An]}],"backdrop-blur":[{"backdrop-blur":O()}],"backdrop-brightness":[{"backdrop-brightness":[jn,Ln,An]}],"backdrop-contrast":[{"backdrop-contrast":[jn,Ln,An]}],"backdrop-grayscale":[{"backdrop-grayscale":["",jn,Ln,An]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[jn,Ln,An]}],"backdrop-invert":[{"backdrop-invert":["",jn,Ln,An]}],"backdrop-opacity":[{"backdrop-opacity":[jn,Ln,An]}],"backdrop-saturate":[{"backdrop-saturate":[jn,Ln,An]}],"backdrop-sepia":[{"backdrop-sepia":["",jn,Ln,An]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":b()}],"border-spacing-x":[{"border-spacing-x":b()}],"border-spacing-y":[{"border-spacing-y":b()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Ln,An]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[jn,"initial",Ln,An]}],ease:[{ease:["linear","initial",f,Ln,An]}],delay:[{delay:[jn,Ln,An]}],animate:[{animate:["none",v,Ln,An]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[x,Ln,An]}],"perspective-origin":[{"perspective-origin":y()}],rotate:[{rotate:R()}],"rotate-x":[{"rotate-x":R()}],"rotate-y":[{"rotate-y":R()}],"rotate-z":[{"rotate-z":R()}],scale:[{scale:M()}],"scale-x":[{"scale-x":M()}],"scale-y":[{"scale-y":M()}],"scale-z":[{"scale-z":M()}],"scale-3d":["scale-3d"],skew:[{skew:L()}],"skew-x":[{"skew-x":L()}],"skew-y":[{"skew-y":L()}],transform:[{transform:[Ln,An,"","none","gpu","cpu"]}],"transform-origin":[{origin:y()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:I()}],"translate-x":[{"translate-x":I()}],"translate-y":[{"translate-y":I()}],"translate-z":[{"translate-z":I()}],"translate-none":["translate-none"],accent:[{accent:$()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:$()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ln,An]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":b()}],"scroll-mx":[{"scroll-mx":b()}],"scroll-my":[{"scroll-my":b()}],"scroll-ms":[{"scroll-ms":b()}],"scroll-me":[{"scroll-me":b()}],"scroll-mt":[{"scroll-mt":b()}],"scroll-mr":[{"scroll-mr":b()}],"scroll-mb":[{"scroll-mb":b()}],"scroll-ml":[{"scroll-ml":b()}],"scroll-p":[{"scroll-p":b()}],"scroll-px":[{"scroll-px":b()}],"scroll-py":[{"scroll-py":b()}],"scroll-ps":[{"scroll-ps":b()}],"scroll-pe":[{"scroll-pe":b()}],"scroll-pt":[{"scroll-pt":b()}],"scroll-pr":[{"scroll-pr":b()}],"scroll-pb":[{"scroll-pb":b()}],"scroll-pl":[{"scroll-pl":b()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ln,An]}],fill:[{fill:["none",...$()]}],"stroke-w":[{stroke:[jn,In,Fn,Pn]}],stroke:[{stroke:["none",...$()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}}),ta=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"];const na={calendar:{lastDay:"[أمس في] LT",sameDay:"[اليوم في] LT",nextDay:"[غداً في] LT",lastWeek:"dddd [الماضي في] LT",nextWeek:"dddd [في] LT",sameElse:"L"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},months:ta,monthsShort:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],weekdays:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"],weekdaysShort:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],weekdaysMin:["ح","ن","ث","ر","خ","ج","س"],week:{dow:6,doy:12}};function aa(...e){return ea(_e(e))}const sa={USD:{code:"USD",symbol:"$",name:"US Dollar",nameAr:"دولار أمريكي",decimals:2,locale:"en-US",position:"before"},SAR:{code:"SAR",symbol:"ر.س",name:"Saudi Riyal",nameAr:"ريال سعودي",decimals:2,locale:"ar-SA",position:"after"},AED:{code:"AED",symbol:"د.إ",name:"UAE Dirham",nameAr:"درهم إماراتي",decimals:2,locale:"ar-AE",position:"after"},KWD:{code:"KWD",symbol:"د.ك",name:"Kuwaiti Dinar",nameAr:"دينار كويتي",decimals:3,locale:"ar-KW",position:"after"},EUR:{code:"EUR",symbol:"€",name:"Euro",nameAr:"يورو",decimals:2,locale:"en-EU",position:"before"},EGP:{code:"EGP",symbol:"ج.م",name:"Egyptian Pound",nameAr:"جنيه مصري",decimals:2,locale:"ar-EG",position:"after"},GBP:{code:"GBP",symbol:"£",name:"British Pound",nameAr:"جنيه إسترليني",decimals:2,locale:"en-GB",position:"before"},QAR:{code:"QAR",symbol:"ر.ق",name:"Qatari Riyal",nameAr:"ريال قطري",decimals:2,locale:"ar-QA",position:"after"},BHD:{code:"BHD",symbol:"د.ب",name:"Bahraini Dinar",nameAr:"دينار بحريني",decimals:3,locale:"ar-BH",position:"after"},OMR:{code:"OMR",symbol:"ر.ع",name:"Omani Rial",nameAr:"ريال عماني",decimals:3,locale:"ar-OM",position:"after"},SYP:{code:"SYP",symbol:"ل.س",name:"Syrian Pound",nameAr:"ليرة سورية",decimals:2,locale:"ar-SY",position:"after"},TRY:{code:"TRY",symbol:"₺",name:"Turkish Lira",nameAr:"ليرة تركية",decimals:2,locale:"tr-TR",position:"after"}},ra={$:"USD","$ أمريكي":"USD","ريال":"SAR","ريال سعودي":"SAR","درهم":"AED","درهم إماراتي":"AED","دينار":"KWD","دينار كويتي":"KWD","دولار":"USD","دولار أمريكي":"USD","يورو":"EUR","جنيه":"EGP","جنيه مصري":"EGP",SAR:"SAR",AED:"AED",KWD:"KWD",USD:"USD",EUR:"EUR",EGP:"EGP",GBP:"GBP",QAR:"QAR",BHD:"BHD",OMR:"OMR","ليرة":"SYP","ليرة سورية":"SYP",SYP:"SYP","ليرة تركية":"TRY","تركية":"TRY",TRY:"TRY"};function ia(e){return sa[ra[e]||e]||sa.USD}let la="USD";function oa(e){la=e}function da(){return la}function ca(e,t){const n=Number(e);if(isNaN(n)||!isFinite(n)){console.warn("Invalid amount for currency formatting:",e);return ua(0,ia(t||da()))}return ua(n,ia(t||da()))}function ua(e,t){const n=Number(e);if(isNaN(n)||!isFinite(n))return`${t.symbol}0.${"0".repeat(t.decimals)}`;try{return new Intl.NumberFormat(t.locale,{style:"currency",currency:t.code,minimumFractionDigits:t.decimals,maximumFractionDigits:t.decimals}).format(n)}catch(a){console.warn(`Error formatting currency ${t.code}, using manual formatting`);try{const e=new Intl.NumberFormat("en-US",{minimumFractionDigits:t.decimals,maximumFractionDigits:t.decimals}).format(n);return"before"===t.position?`${t.symbol}${e}`:`${e} ${t.symbol}`}catch(s){const e=n.toFixed(t.decimals);return"before"===t.position?`${t.symbol}${e}`:`${e} ${t.symbol}`}}}function ma(e,t){if(!e)return"--";try{const t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"--";const n=t.getDate(),a=t.getMonth()+1,s=t.getFullYear(),r=n.toString().padStart(2,"0");return`${r}/${a.toString().padStart(2,"0")}/${s}`}catch(n){return console.warn("Error formatting date:",n,"Input:",e),"--"}}function pa(e){if(!e)return"--";try{const t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"--";const n=t.getDate(),a=t.getMonth()+1,s=t.getFullYear(),r=n.toString().padStart(2,"0"),i=`${r}/${a.toString().padStart(2,"0")}/${s}`;return`${i} - ${t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!0})}`}catch(t){return console.warn("Error formatting date time:",t,"Input:",e),"--"}}function ha(e){if(!e)return"--";try{const t=new Date(e);return isNaN(t.getTime())?"--":t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return console.warn("Error formatting time:",t,"Input:",e),"--"}}function xa(e=new Date){const t=new Date(e),n=t.getDay();return t.setDate(e.getDate()-n),t.setHours(0,0,0,0),t}function ga(e,t){return function(e,t){return t<0||t>11?(console.warn("Invalid month index:",t),`${e}`):`${ta[t]} ${e}`}(e,t)}function fa(e){switch(e){case"scheduled":return"bg-primary/10 text-primary border-primary/20";case"completed":return"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800";case"cancelled":return"bg-destructive/10 text-destructive border-destructive/20";default:return"bg-muted text-muted-foreground border-border"}}const va={primary:["#0ea5e9","#06b6d4","#3b82f6","#1e40af","#0284c7","#0369a1","#075985","#0c4a6e"],medical:["#10b981","#059669","#047857","#065f46","#064e3b","#22c55e","#16a34a","#15803d"],status:["#10b981","#f59e0b","#ef4444","#6b7280","#8b5cf6","#06b6d4","#f97316","#ec4899"],financial:["#059669","#dc2626","#d97706","#7c3aed","#0891b2","#be185d","#ea580c","#4338ca"],categorical:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#f97316","#ec4899","#84cc16","#6366f1"],gradients:{blue:["#dbeafe","#3b82f6"],green:["#dcfce7","#10b981"],purple:["#f3e8ff","#8b5cf6"],orange:["#fed7aa","#f97316"],red:["#fecaca","#ef4444"],cyan:["#cffafe","#06b6d4"]},inventory:["#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#f97316","#ec4899","#6b7280"],demographics:["#3b82f6","#ec4899","#10b981","#f59e0b","#8b5cf6","#06b6d4","#f97316","#6b7280"],treatments:["#10b981","#3b82f6","#8b5cf6","#f59e0b","#ef4444","#06b6d4","#f97316","#ec4899"]};function ya(e="primary",t=!1){const n=va[e];return t?n.map(e=>{const t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16),s=Math.min(255,Math.round(1.2*t)),r=Math.min(255,Math.round(1.2*n)),i=Math.min(255,Math.round(1.2*a));return`#${s.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`}):n}const ba={responsive:{mobile:{width:"100%",height:280},tablet:{width:"100%",height:320},desktop:{width:"100%",height:380},large:{width:"100%",height:420}},grid:{strokeDasharray:"3 3",stroke:"#e5e7eb",strokeOpacity:.5},darkGrid:{strokeDasharray:"3 3",stroke:"#374151",strokeOpacity:.7},axis:{light:{tick:{fontSize:12,fill:"#6b7280",fontFamily:"Inter, sans-serif"},axisLine:{stroke:"#d1d5db",strokeWidth:1},tickLine:{stroke:"#d1d5db",strokeWidth:1}},dark:{tick:{fontSize:12,fill:"#9ca3af",fontFamily:"Inter, sans-serif"},axisLine:{stroke:"#4b5563",strokeWidth:1},tickLine:{stroke:"#4b5563",strokeWidth:1}}},tooltip:{contentStyle:{backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",fontSize:"14px",fontWeight:"500",fontFamily:"Inter, sans-serif",direction:"rtl",textAlign:"right"},darkContentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.3)",fontSize:"14px",fontWeight:"500",color:"#f9fafb",fontFamily:"Inter, sans-serif",direction:"rtl",textAlign:"right"}},animation:{duration:800,easing:"ease-in-out",delay:0},pie:{outerRadius:120,innerRadius:50,paddingAngle:2,strokeWidth:2},bar:{radius:[4,4,0,0],minPointSize:5,maxBarSize:100,barCategoryGap:"20%"},line:{strokeWidth:3,dot:{strokeWidth:2,r:4},activeDot:{r:6,strokeWidth:2}},area:{strokeWidth:3,fillOpacity:.3}};function ja(e=!1){return d(o({},ba),{grid:e?ba.darkGrid:ba.grid,tooltip:e?ba.tooltip.darkContentStyle:ba.tooltip.contentStyle,axis:e?ba.axis.dark:ba.axis.light})}function wa(e="primary",t=!1,n=1){const a=ya(e,t);if(n>a.length){const e=[];for(let t=0;t<n;t++)e.push(a[t%a.length]);return e}return a.slice(0,n)}function Na(e,t="number",n){const a=Number(e);if(isNaN(a)||!isFinite(a))switch(console.warn("Invalid value for chart formatting:",e),t){case"currency":const e=ia(n||da());return`${e.symbol}0.${"0".repeat(e.decimals)}`;case"percentage":return"0%";default:return"0"}try{switch(t){case"currency":return ca(a,n||da());case"percentage":const e=Math.round(10*a)/10;return`${isNaN(e)?0:e}%`;default:try{return a.toLocaleString("ar-SA",{maximumFractionDigits:2})}catch(s){return a.toFixed(2)}}}catch(r){return console.warn("Error formatting chart value:",r),a.toString()}}const _a=ve.createContext(void 0);function ka({children:e}){const{currency:t,setCurrency:n,settings:a,loadSettings:s}=qt();ve.useEffect(()=>{a||s()},[a,s]);const r=t||(null==a?void 0:a.currency)||"USD",i=ia(r);ve.useEffect(()=>{oa(r)},[r]);const l={currentCurrency:r,currencyConfig:i,setCurrency:e=>{sa[e]?(n(e),oa(e)):console.warn(`Unsupported currency: ${e}`)},getSupportedCurrencies:()=>sa,formatAmount:(e,t)=>ca(e,t||r),formatAmountSymbol:(e,t)=>function(e,t){const n=ia(t||da()),a=Number(e);if(isNaN(a)||!isFinite(a))return n.symbol;try{const e=new Intl.NumberFormat(n.locale,{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(a));return"before"===n.position?`${n.symbol}${e}`:`${e} ${n.symbol}`}catch(s){const e=Math.round(a).toString();return"before"===n.position?`${n.symbol}${e}`:`${e} ${n.symbol}`}}(e,t||r),formatAmountWithConfig:(e,t)=>ua(e,t||i),getCurrencySymbol:e=>ia(e||r).symbol,getCurrencyName:(e,t=!1)=>{const n=ia(e||r);return t?n.nameAr:n.name},getCurrencyDecimals:e=>ia(e||r).decimals};return p.jsx(_a.Provider,{value:l,children:e})}function Sa(){const e=ve.useContext(_a);if(void 0===e)throw new Error("useCurrency must be used within a CurrencyProvider");return e}const Da={"ش":"a","س":"s","ي":"d","٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","ق":"r","ب":"f"};function $a(e){const t=e.key;var n;return{originalKey:t,mappedKey:Da[n=t]||n,isArabic:/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/.test(t),ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,preventDefault:()=>e.preventDefault()}}Object.fromEntries(Object.entries(Da).map(([e,t])=>[t,e]));var Ca=e=>"checkbox"===e.type,Ea=e=>e instanceof Date,Ta=e=>null==e;const Aa=e=>"object"==typeof e;var Fa=e=>!Ta(e)&&!Array.isArray(e)&&Aa(e)&&!Ea(e),Pa=e=>Fa(e)&&e.target?Ca(e.target)?e.target.checked:e.target.value:e,Oa=(e,t)=>e.has((e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e)(t)),Ra="undefined"!=typeof window&&void 0!==window.HTMLElement&&"undefined"!=typeof document;function Ma(e){let t;const n=Array.isArray(e),a="undefined"!=typeof FileList&&e instanceof FileList;if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else{if(Ra&&(e instanceof Blob||a)||!n&&!Fa(e))return e;if(t=n?[]:{},n||(e=>{const t=e.constructor&&e.constructor.prototype;return Fa(t)&&t.hasOwnProperty("isPrototypeOf")})(e))for(const n in e)e.hasOwnProperty(n)&&(t[n]=Ma(e[n]));else t=e}return t}var La=e=>/^\w*$/.test(e),Ia=e=>void 0===e,za=e=>Array.isArray(e)?e.filter(Boolean):[],Ba=e=>za(e.replace(/["|']|\]/g,"").split(/\.|\[/)),Ya=(e,t,n)=>{if(!t||!Fa(e))return n;const a=(La(t)?[t]:Ba(t)).reduce((e,t)=>Ta(e)?e:e[t],e);return Ia(a)||a===e?Ia(e[t])?n:e[t]:a},Va=e=>"boolean"==typeof e,qa=(e,t,n)=>{let a=-1;const s=La(t)?[t]:Ba(t),r=s.length,i=r-1;for(;++a<r;){const t=s[a];let r=n;if(a!==i){const n=e[t];r=Fa(n)||Array.isArray(n)?n:isNaN(+s[a+1])?{}:[]}if("__proto__"===t||"constructor"===t||"prototype"===t)return;e[t]=r,e=e[t]}};const Ua="blur",Ha="focusout",Ga="change",Wa="onBlur",Ka="onChange",Za="onSubmit",Qa="onTouched",Xa="all",Ja="max",es="min",ts="maxLength",ns="minLength",as="pattern",ss="required",rs="validate",is=ye.createContext(null);is.displayName="HookFormContext";const ls=()=>ye.useContext(is);var os=(e,t,n,a=!0)=>{const s={defaultValues:t._defaultValues};for(const r in e)Object.defineProperty(s,r,{get:()=>{const s=r;return t._proxyFormState[s]!==Xa&&(t._proxyFormState[s]=!a||Xa),n&&(n[s]=!0),e[s]}});return s};const ds="undefined"!=typeof window?ve.useLayoutEffect:ve.useEffect;var cs=e=>"string"==typeof e,us=(e,t,n,a,s)=>cs(e)?(a&&t.watch.add(e),Ya(n,e,s)):Array.isArray(e)?e.map(e=>(a&&t.watch.add(e),Ya(n,e))):(a&&(t.watchAll=!0),n);function ms(e){const t=ls(),{name:n,disabled:a,control:s=t.control,shouldUnregister:r}=e,i=Oa(s._names.array,n),l=function(e){const t=ls(),{control:n=t.control,name:a,defaultValue:s,disabled:r,exact:i}=e||{},l=ye.useRef(s),[o,d]=ye.useState(n._getWatch(a,l.current));return ds(()=>n._subscribe({name:a,formState:{values:!0},exact:i,callback:e=>!r&&d(us(a,n._names,e.values||n._formValues,!1,l.current))}),[a,n,r,i]),ye.useEffect(()=>n._removeUnmounted()),o}({control:s,name:n,defaultValue:Ya(s._formValues,n,Ya(s._defaultValues,n,e.defaultValue)),exact:!0}),c=function(e){const t=ls(),{control:n=t.control,disabled:a,name:s,exact:r}=e||{},[i,l]=ye.useState(n._formState),d=ye.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return ds(()=>n._subscribe({name:s,formState:d.current,exact:r,callback:e=>{!a&&l(o(o({},n._formState),e))}}),[s,a,r]),ye.useEffect(()=>{d.current.isValid&&n._setValid(!0)},[n]),ye.useMemo(()=>os(i,n,d.current,!1),[i,n])}({control:s,name:n,exact:!0}),u=ye.useRef(e),m=ye.useRef(s.register(n,o(d(o({},e.rules),{value:l}),Va(e.disabled)?{disabled:e.disabled}:{}))),p=ye.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Ya(c.errors,n)},isDirty:{enumerable:!0,get:()=>!!Ya(c.dirtyFields,n)},isTouched:{enumerable:!0,get:()=>!!Ya(c.touchedFields,n)},isValidating:{enumerable:!0,get:()=>!!Ya(c.validatingFields,n)},error:{enumerable:!0,get:()=>Ya(c.errors,n)}}),[c,n]),h=ye.useCallback(e=>m.current.onChange({target:{value:Pa(e),name:n},type:Ga}),[n]),x=ye.useCallback(()=>m.current.onBlur({target:{value:Ya(s._formValues,n),name:n},type:Ua}),[n,s._formValues]),g=ye.useCallback(e=>{const t=Ya(s._fields,n);t&&e&&(t._f.ref={focus:()=>e.focus&&e.focus(),select:()=>e.select&&e.select(),setCustomValidity:t=>e.setCustomValidity(t),reportValidity:()=>e.reportValidity()})},[s._fields,n]),f=ye.useMemo(()=>d(o({name:n,value:l},Va(a)||c.disabled?{disabled:c.disabled||a}:{}),{onChange:h,onBlur:x,ref:g}),[n,a,c.disabled,h,x,g,l]);return ye.useEffect(()=>{const e=s._options.shouldUnregister||r;s.register(n,o(o({},u.current.rules),Va(u.current.disabled)?{disabled:u.current.disabled}:{}));const t=(e,t)=>{const n=Ya(s._fields,e);n&&n._f&&(n._f.mount=t)};if(t(n,!0),e){const e=Ma(Ya(s._options.defaultValues,n));qa(s._defaultValues,n,e),Ia(Ya(s._formValues,n))&&qa(s._formValues,n,e)}return!i&&s.register(n),()=>{(i?e&&!s._state.action:e)?s.unregister(n):t(n,!1)}},[n,s,i,r]),ye.useEffect(()=>{s._setDisabledField({disabled:a,name:n})},[a,n,s]),ye.useMemo(()=>({field:f,formState:c,fieldState:p}),[f,c,p])}const ps=e=>e.render(ms(e));var hs=(e,t,n,a,s)=>t?d(o({},n[e]),{types:d(o({},n[e]&&n[e].types?n[e].types:{}),{[a]:s||!0})}):{},xs=e=>Array.isArray(e)?e:[e],gs=()=>{let e=[];return{get observers(){return e},next:t=>{for(const n of e)n.next&&n.next(t)},subscribe:t=>(e.push(t),{unsubscribe:()=>{e=e.filter(e=>e!==t)}}),unsubscribe:()=>{e=[]}}},fs=e=>Ta(e)||!Aa(e);function vs(e,t,n=new WeakSet){if(fs(e)||fs(t))return e===t;if(Ea(e)&&Ea(t))return e.getTime()===t.getTime();const a=Object.keys(e),s=Object.keys(t);if(a.length!==s.length)return!1;if(n.has(e)||n.has(t))return!0;n.add(e),n.add(t);for(const r of a){const a=e[r];if(!s.includes(r))return!1;if("ref"!==r){const e=t[r];if(Ea(a)&&Ea(e)||Fa(a)&&Fa(e)||Array.isArray(a)&&Array.isArray(e)?!vs(a,e,n):a!==e)return!1}}return!0}var ys=e=>Fa(e)&&!Object.keys(e).length,bs=e=>"file"===e.type,js=e=>"function"==typeof e,ws=e=>{if(!Ra)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},Ns=e=>"select-multiple"===e.type,_s=e=>"radio"===e.type,ks=e=>ws(e)&&e.isConnected;function Ss(e,t){const n=Array.isArray(t)?t:La(t)?[t]:Ba(t),a=1===n.length?e:function(e,t){const n=t.slice(0,-1).length;let a=0;for(;a<n;)e=Ia(e)?a++:e[t[a++]];return e}(e,n),s=n.length-1,r=n[s];return a&&delete a[r],0!==s&&(Fa(a)&&ys(a)||Array.isArray(a)&&function(e){for(const t in e)if(e.hasOwnProperty(t)&&!Ia(e[t]))return!1;return!0}(a))&&Ss(e,n.slice(0,-1)),e}var Ds=e=>{for(const t in e)if(js(e[t]))return!0;return!1};function $s(e,t={}){const n=Array.isArray(e);if(Fa(e)||n)for(const a in e)Array.isArray(e[a])||Fa(e[a])&&!Ds(e[a])?(t[a]=Array.isArray(e[a])?[]:{},$s(e[a],t[a])):Ta(e[a])||(t[a]=!0);return t}function Cs(e,t,n){const a=Array.isArray(e);if(Fa(e)||a)for(const s in e)Array.isArray(e[s])||Fa(e[s])&&!Ds(e[s])?Ia(t)||fs(n[s])?n[s]=Array.isArray(e[s])?$s(e[s],[]):o({},$s(e[s])):Cs(e[s],Ta(t)?{}:t[s],n[s]):n[s]=!vs(e[s],t[s]);return n}var Es=(e,t)=>Cs(e,t,$s(t));const Ts={value:!1,isValid:!1},As={value:!0,isValid:!0};var Fs=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(e=>e&&e.checked&&!e.disabled).map(e=>e.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Ia(e[0].attributes.value)?Ia(e[0].value)||""===e[0].value?As:{value:e[0].value,isValid:!0}:As:Ts}return Ts},Ps=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:a})=>Ia(e)?e:t?""===e?NaN:e?+e:e:n&&cs(e)?new Date(e):a?a(e):e;const Os={isValid:!1,value:null};var Rs=e=>Array.isArray(e)?e.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,Os):Os;function Ms(e){const t=e.ref;return bs(t)?t.files:_s(t)?Rs(e.refs).value:Ns(t)?[...t.selectedOptions].map(({value:e})=>e):Ca(t)?Fs(e.refs).value:Ps(Ia(t.value)?e.ref.value:t.value,e)}var Ls=e=>e instanceof RegExp,Is=e=>Ia(e)?e:Ls(e)?e.source:Fa(e)?Ls(e.value)?e.value.source:e.value:e,zs=e=>({isOnSubmit:!e||e===Za,isOnBlur:e===Wa,isOnChange:e===Ka,isOnAll:e===Xa,isOnTouch:e===Qa});const Bs="AsyncFunction";var Ys=e=>!!e&&!!e.validate&&!!(js(e.validate)&&e.validate.constructor.name===Bs||Fa(e.validate)&&Object.values(e.validate).find(e=>e.constructor.name===Bs)),Vs=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some(t=>e.startsWith(t)&&/^\.\w+/.test(e.slice(t.length))));const qs=(e,t,n,a)=>{for(const s of n||Object.keys(e)){const n=Ya(e,s);if(n){const e=n,{_f:r}=e,i=c(e,["_f"]);if(r){if(r.refs&&r.refs[0]&&t(r.refs[0],s)&&!a)return!0;if(r.ref&&t(r.ref,r.name)&&!a)return!0;if(qs(i,t))break}else if(Fa(i)&&qs(i,t))break}}};function Us(e,t,n){const a=Ya(e,n);if(a||La(n))return{error:a,name:n};const s=n.split(".");for(;s.length;){const a=s.join("."),r=Ya(t,a),i=Ya(e,a);if(r&&!Array.isArray(r)&&n!==a)return{name:n};if(i&&i.type)return{name:a,error:i};if(i&&i.root&&i.root.type)return{name:`${a}.root`,error:i.root};s.pop()}return{name:n}}var Hs=(e,t,n)=>{const a=xs(Ya(e,n));return qa(a,"root",t[n]),qa(e,n,a),e},Gs=e=>cs(e);function Ws(e,t,n="validate"){if(Gs(e)||Array.isArray(e)&&e.every(Gs)||Va(e)&&!e)return{type:n,message:Gs(e)?e:"",ref:t}}var Ks=e=>Fa(e)&&!Ls(e)?e:{value:e,message:""},Zs=(e,t,n,a,s,r)=>m(void 0,null,function*(){const{ref:i,refs:l,required:d,maxLength:c,minLength:u,min:m,max:p,pattern:h,validate:x,name:g,valueAsNumber:f,mount:v}=e._f,y=Ya(n,g);if(!v||t.has(g))return{};const b=l?l[0]:i,j=e=>{s&&b.reportValidity&&(b.setCustomValidity(Va(e)?"":e||""),b.reportValidity())},w={},N=_s(i),_=Ca(i),k=N||_,S=(f||bs(i))&&Ia(i.value)&&Ia(y)||ws(i)&&""===i.value||""===y||Array.isArray(y)&&!y.length,D=hs.bind(null,g,a,w),$=(e,t,n,a=ts,s=ns)=>{const r=e?t:n;w[g]=o({type:e?a:s,message:r,ref:i},D(e?a:s,r))};if(r?!Array.isArray(y)||!y.length:d&&(!k&&(S||Ta(y))||Va(y)&&!y||_&&!Fs(l).isValid||N&&!Rs(l).isValid)){const{value:e,message:t}=Gs(d)?{value:!!d,message:d}:Ks(d);if(e&&(w[g]=o({type:ss,message:t,ref:b},D(ss,t)),!a))return j(t),w}if(!(S||Ta(m)&&Ta(p))){let e,t;const n=Ks(p),s=Ks(m);if(Ta(y)||isNaN(y)){const a=i.valueAsDate||new Date(y),r=e=>new Date((new Date).toDateString()+" "+e),l="time"==i.type,o="week"==i.type;cs(n.value)&&y&&(e=l?r(y)>r(n.value):o?y>n.value:a>new Date(n.value)),cs(s.value)&&y&&(t=l?r(y)<r(s.value):o?y<s.value:a<new Date(s.value))}else{const a=i.valueAsNumber||(y?+y:y);Ta(n.value)||(e=a>n.value),Ta(s.value)||(t=a<s.value)}if((e||t)&&($(!!e,n.message,s.message,Ja,es),!a))return j(w[g].message),w}if((c||u)&&!S&&(cs(y)||r&&Array.isArray(y))){const e=Ks(c),t=Ks(u),n=!Ta(e.value)&&y.length>+e.value,s=!Ta(t.value)&&y.length<+t.value;if((n||s)&&($(n,e.message,t.message),!a))return j(w[g].message),w}if(h&&!S&&cs(y)){const{value:e,message:t}=Ks(h);if(Ls(e)&&!y.match(e)&&(w[g]=o({type:as,message:t,ref:i},D(as,t)),!a))return j(t),w}if(x)if(js(x)){const e=Ws(yield x(y,n),b);if(e&&(w[g]=o(o({},e),D(rs,e.message)),!a))return j(e.message),w}else if(Fa(x)){let e={};for(const t in x){if(!ys(e)&&!a)break;const s=Ws(yield x[t](y,n),b,t);s&&(e=o(o({},s),D(t,s.message)),j(s.message),a&&(w[g]=e))}if(!ys(e)&&(w[g]=o({ref:b},e),!a))return w}return j(!0),w});const Qs={mode:Za,reValidateMode:Ka,shouldFocusError:!0};function Xs(e={}){let t=o(o({},Qs),e),n={submitCount:0,isDirty:!1,isReady:!1,isLoading:js(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1};const a={};let s,r=(Fa(t.defaultValues)||Fa(t.values))&&Ma(t.defaultValues||t.values)||{},i=t.shouldUnregister?{}:Ma(r),l={action:!1,mount:!1,watch:!1},u={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},p=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let x=o({},h);const g={array:gs(),state:gs()},f=t.criteriaMode===Xa,v=e=>m(this,null,function*(){if(!t.disabled&&(h.isValid||x.isValid||e)){const e=t.resolver?ys((yield N()).errors):yield k(a,!0);e!==n.isValid&&g.state.next({isValid:e})}}),y=(e,a)=>{!t.disabled&&(h.isValidating||h.validatingFields||x.isValidating||x.validatingFields)&&((e||Array.from(u.mount)).forEach(e=>{e&&(a?qa(n.validatingFields,e,a):Ss(n.validatingFields,e))}),g.state.next({validatingFields:n.validatingFields,isValidating:!ys(n.validatingFields)}))},b=(e,t,n,s)=>{const o=Ya(a,e);if(o){const a=Ya(i,e,Ia(n)?Ya(r,e):n);Ia(a)||s&&s.defaultChecked||t?qa(i,e,t?a:Ms(o._f)):$(e,a),l.mount&&v()}},j=(e,a,s,i,l)=>{let o=!1,d=!1;const c={name:e};if(!t.disabled){if(!s||i){(h.isDirty||x.isDirty)&&(d=n.isDirty,n.isDirty=c.isDirty=S(),o=d!==c.isDirty);const t=vs(Ya(r,e),a);d=!!Ya(n.dirtyFields,e),t?Ss(n.dirtyFields,e):qa(n.dirtyFields,e,!0),c.dirtyFields=n.dirtyFields,o=o||(h.dirtyFields||x.dirtyFields)&&d!==!t}if(s){const t=Ya(n.touchedFields,e);t||(qa(n.touchedFields,e,s),c.touchedFields=n.touchedFields,o=o||(h.touchedFields||x.touchedFields)&&t!==s)}o&&l&&g.state.next(c)}return o?c:{}},w=(e,a,r,i)=>{const l=Ya(n.errors,e),c=(h.isValid||x.isValid)&&Va(a)&&n.isValid!==a;var u;if(t.delayError&&r?(u=()=>((e,t)=>{qa(n.errors,e,t),g.state.next({errors:n.errors})})(e,r),s=e=>{clearTimeout(p),p=setTimeout(u,e)},s(t.delayError)):(clearTimeout(p),s=null,r?qa(n.errors,e,r):Ss(n.errors,e)),(r?!vs(l,r):l)||!ys(i)||c){const t=d(o(o({},i),c&&Va(a)?{isValid:a}:{}),{errors:n.errors,name:e});n=o(o({},n),t),g.state.next(t)}},N=e=>m(this,null,function*(){y(e,!0);const n=yield t.resolver(i,t.context,((e,t,n,a)=>{const s={};for(const r of e){const e=Ya(t,r);e&&qa(s,r,e._f)}return{criteriaMode:n,names:[...e],fields:s,shouldUseNativeValidation:a}})(e||u.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return y(e),n}),_=e=>m(this,null,function*(){const{errors:t}=yield N(e);if(e)for(const a of e){const e=Ya(t,a);e?qa(n.errors,a,e):Ss(n.errors,a)}else n.errors=t;return t}),k=(e,a,...s)=>m(this,[e,a,...s],function*(e,a,s={valid:!0}){for(const r in e){const l=e[r];if(l){const e=l,{_f:o}=e,d=c(e,["_f"]);if(o){const e=u.array.has(o.name),d=l._f&&Ys(l._f);d&&h.validatingFields&&y([r],!0);const c=yield Zs(l,u.disabled,i,f,t.shouldUseNativeValidation&&!a,e);if(d&&h.validatingFields&&y([r]),c[o.name]&&(s.valid=!1,a))break;!a&&(Ya(c,o.name)?e?Hs(n.errors,c,o.name):qa(n.errors,o.name,c[o.name]):Ss(n.errors,o.name))}!ys(d)&&(yield k(d,a,s))}}return s.valid}),S=(e,n)=>!t.disabled&&(e&&n&&qa(i,e,n),!vs(P(),r)),D=(e,t,n)=>us(e,u,o({},l.mount?i:Ia(t)?r:cs(e)?{[e]:t}:t),n,t),$=(e,t,n={})=>{const s=Ya(a,e);let r=t;if(s){const n=s._f;n&&(!n.disabled&&qa(i,e,Ps(t,n)),r=ws(n.ref)&&Ta(t)?"":t,Ns(n.ref)?[...n.ref.options].forEach(e=>e.selected=r.includes(e.value)):n.refs?Ca(n.ref)?n.refs.forEach(e=>{e.defaultChecked&&e.disabled||(Array.isArray(r)?e.checked=!!r.find(t=>t===e.value):e.checked=r===e.value||!!r)}):n.refs.forEach(e=>e.checked=e.value===r):bs(n.ref)?n.ref.value="":(n.ref.value=r,n.ref.type||g.state.next({name:e,values:Ma(i)})))}(n.shouldDirty||n.shouldTouch)&&j(e,r,n.shouldTouch,n.shouldDirty,!0),n.shouldValidate&&F(e)},C=(e,t,n)=>{for(const s in t){if(!t.hasOwnProperty(s))return;const r=t[s],i=e+"."+s,l=Ya(a,i);(u.array.has(e)||Fa(r)||l&&!l._f)&&!Ea(r)?C(i,r,n):$(i,r,n)}},E=(e,t,s={})=>{const d=Ya(a,e),c=u.array.has(e),m=Ma(t);qa(i,e,m),c?(g.array.next({name:e,values:Ma(i)}),(h.isDirty||h.dirtyFields||x.isDirty||x.dirtyFields)&&s.shouldDirty&&g.state.next({name:e,dirtyFields:Es(r,i),isDirty:S(e,m)})):!d||d._f||Ta(m)?$(e,m,s):C(e,m,s),Vs(e,u)&&g.state.next(o({},n)),g.state.next({name:l.mount?e:void 0,values:Ma(i)})},T=e=>m(this,null,function*(){l.mount=!0;const r=e.target;let d=r.name,c=!0;const m=Ya(a,d),p=e=>{c=Number.isNaN(e)||Ea(e)&&isNaN(e.getTime())||vs(e,Ya(i,d,e))},b=zs(t.mode),_=zs(t.reValidateMode);if(m){let l,S;const D=r.type?Ms(m._f):Pa(e),$=e.type===Ua||e.type===Ha,C=!(e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate))(m._f)&&!t.resolver&&!Ya(n.errors,d)&&!m._f.deps||((e,t,n,a,s)=>!s.isOnAll&&(!n&&s.isOnTouch?!(t||e):(n?a.isOnBlur:s.isOnBlur)?!e:!(n?a.isOnChange:s.isOnChange)||e))($,Ya(n.touchedFields,d),n.isSubmitted,_,b),E=Vs(d,u,$);qa(i,d,D),$?(m._f.onBlur&&m._f.onBlur(e),s&&s(0)):m._f.onChange&&m._f.onChange(e);const T=j(d,D,$),A=!ys(T)||E;if(!$&&g.state.next({name:d,type:e.type,values:Ma(i)}),C)return(h.isValid||x.isValid)&&("onBlur"===t.mode?$&&v():$||v()),A&&g.state.next(o({name:d},E?{}:T));if(!$&&E&&g.state.next(o({},n)),t.resolver){const{errors:e}=yield N([d]);if(p(D),c){const t=Us(n.errors,a,d),s=Us(e,a,t.name||d);l=s.error,d=s.name,S=ys(e)}}else y([d],!0),l=(yield Zs(m,u.disabled,i,f,t.shouldUseNativeValidation))[d],y([d]),p(D),c&&(l?S=!1:(h.isValid||x.isValid)&&(S=yield k(a,!0)));c&&(m._f.deps&&F(m._f.deps),w(d,S,l,T))}}),A=(e,t)=>{if(Ya(n.errors,t)&&e.focus)return e.focus(),1},F=(e,...s)=>m(this,[e,...s],function*(e,s={}){let r,i;const l=xs(e);if(t.resolver){const t=yield _(Ia(e)?e:l);r=ys(t),i=e?!l.some(e=>Ya(t,e)):r}else e?(i=(yield Promise.all(l.map(e=>m(this,null,function*(){const t=Ya(a,e);return yield k(t&&t._f?{[e]:t}:t)})))).every(Boolean),(i||n.isValid)&&v()):i=r=yield k(a);return g.state.next(d(o(o({},!cs(e)||(h.isValid||x.isValid)&&r!==n.isValid?{}:{name:e}),t.resolver||!e?{isValid:r}:{}),{errors:n.errors})),s.shouldFocus&&!i&&qs(a,A,e?l:u.mount),i}),P=e=>{const t=o({},l.mount?i:r);return Ia(e)?t:cs(e)?Ya(t,e):e.map(e=>Ya(t,e))},O=(e,t)=>({invalid:!!Ya((t||n).errors,e),isDirty:!!Ya((t||n).dirtyFields,e),error:Ya((t||n).errors,e),isValidating:!!Ya(n.validatingFields,e),isTouched:!!Ya((t||n).touchedFields,e)}),R=(e,t,s)=>{const r=(Ya(a,e,{_f:{}})._f||{}).ref,i=Ya(n.errors,e)||{},{ref:l,message:u,type:m}=i,p=c(i,["ref","message","type"]);qa(n.errors,e,d(o(o({},p),t),{ref:r})),g.state.next({name:e,errors:n.errors,isValid:!1}),s&&s.shouldFocus&&r&&r.focus&&r.focus()},M=e=>g.state.subscribe({next:t=>{var a,s,r;a=e.name,s=t.name,r=e.exact,a&&s&&a!==s&&!xs(a).some(e=>e&&(r?e===s:e.startsWith(s)||s.startsWith(e)))||!((e,t,n,a)=>{n(e);const s=e,{name:r}=s,i=c(s,["name"]);return ys(i)||Object.keys(i).length>=Object.keys(t).length||Object.keys(i).find(e=>t[e]===(!a||Xa))})(t,e.formState||h,U,e.reRenderRoot)||e.callback(o(o({values:o({},i)},n),t))}}).unsubscribe,L=(e,s={})=>{for(const l of e?xs(e):u.mount)u.mount.delete(l),u.array.delete(l),s.keepValue||(Ss(a,l),Ss(i,l)),!s.keepError&&Ss(n.errors,l),!s.keepDirty&&Ss(n.dirtyFields,l),!s.keepTouched&&Ss(n.touchedFields,l),!s.keepIsValidating&&Ss(n.validatingFields,l),!t.shouldUnregister&&!s.keepDefaultValue&&Ss(r,l);g.state.next({values:Ma(i)}),g.state.next(o(o({},n),s.keepDirty?{isDirty:S()}:{})),!s.keepIsValid&&v()},I=({disabled:e,name:t})=>{(Va(e)&&l.mount||e||u.disabled.has(t))&&(e?u.disabled.add(t):u.disabled.delete(t))},z=(e,n={})=>{let s=Ya(a,e);const i=Va(n.disabled)||Va(t.disabled);return qa(a,e,d(o({},s||{}),{_f:o(d(o({},s&&s._f?s._f:{ref:{name:e}}),{name:e,mount:!0}),n)})),u.mount.add(e),s?I({disabled:Va(n.disabled)?n.disabled:t.disabled,name:e}):b(e,!0,n.value),d(o(o({},i?{disabled:n.disabled||t.disabled}:{}),t.progressive?{required:!!n.required,min:Is(n.min),max:Is(n.max),minLength:Is(n.minLength),maxLength:Is(n.maxLength),pattern:Is(n.pattern)}:{}),{name:e,onChange:T,onBlur:T,ref:i=>{if(i){z(e,n),s=Ya(a,e);const t=Ia(i.value)&&i.querySelectorAll&&i.querySelectorAll("input,select,textarea")[0]||i,l=(e=>_s(e)||Ca(e))(t),d=s._f.refs||[];if(l?d.find(e=>e===t):t===s._f.ref)return;qa(a,e,{_f:o(o({},s._f),l?{refs:[...d.filter(ks),t,...Array.isArray(Ya(r,e))?[{}]:[]],ref:{type:t.type,name:e}}:{ref:t})}),b(e,!1,void 0,t)}else s=Ya(a,e,{}),s._f&&(s._f.mount=!1),(t.shouldUnregister||n.shouldUnregister)&&(!Oa(u.array,e)||!l.action)&&u.unMount.add(e)}})},B=()=>t.shouldFocusError&&qs(a,A,u.mount),Y=(e,s)=>r=>m(this,null,function*(){let l;r&&(r.preventDefault&&r.preventDefault(),r.persist&&r.persist());let d=Ma(i);if(g.state.next({isSubmitting:!0}),t.resolver){const{errors:e,values:t}=yield N();n.errors=e,d=Ma(t)}else yield k(a);if(u.disabled.size)for(const e of u.disabled)Ss(d,e);if(Ss(n.errors,"root"),ys(n.errors)){g.state.next({errors:{}});try{yield e(d,r)}catch(c){l=c}}else s&&(yield s(o({},n.errors),r)),B(),setTimeout(B);if(g.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:ys(n.errors)&&!l,submitCount:n.submitCount+1,errors:n.errors}),l)throw l}),V=(e,s={})=>{const d=e?Ma(e):r,c=Ma(d),m=ys(e),p=m?r:c;if(s.keepDefaultValues||(r=d),!s.keepValues){if(s.keepDirtyValues){const e=new Set([...u.mount,...Object.keys(Es(r,i))]);for(const t of Array.from(e))Ya(n.dirtyFields,t)?qa(p,t,Ya(i,t)):E(t,Ya(p,t))}else{if(Ra&&Ia(e))for(const e of u.mount){const t=Ya(a,e);if(t&&t._f){const e=Array.isArray(t._f.refs)?t._f.refs[0]:t._f.ref;if(ws(e)){const t=e.closest("form");if(t){t.reset();break}}}}for(const e of u.mount){const t=Ya(p,e,Ya(r,e));Ia(t)||(qa(p,e,t),E(e,Ya(p,e)))}}i=Ma(p),g.array.next({values:o({},p)}),g.state.next({values:o({},p)})}u={mount:s.keepDirtyValues?u.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},l.mount=!h.isValid||!!s.keepIsValid||!!s.keepDirtyValues,l.watch=!!t.shouldUnregister,g.state.next({submitCount:s.keepSubmitCount?n.submitCount:0,isDirty:!m&&(s.keepDirty?n.isDirty:!(!s.keepDefaultValues||vs(e,r))),isSubmitted:!!s.keepIsSubmitted&&n.isSubmitted,dirtyFields:m?{}:s.keepDirtyValues?s.keepDefaultValues&&i?Es(r,i):n.dirtyFields:s.keepDefaultValues&&e?Es(r,e):s.keepDirty?n.dirtyFields:{},touchedFields:s.keepTouched?n.touchedFields:{},errors:s.keepErrors?n.errors:{},isSubmitSuccessful:!!s.keepIsSubmitSuccessful&&n.isSubmitSuccessful,isSubmitting:!1})},q=(e,t)=>V(js(e)?e(i):e,t),U=e=>{n=o(o({},n),e)},H={control:{register:z,unregister:L,getFieldState:O,handleSubmit:Y,setError:R,_subscribe:M,_runSchema:N,_focusError:B,_getWatch:D,_getDirty:S,_setValid:v,_setFieldArray:(e,s=[],o,d,c=!0,u=!0)=>{if(d&&o&&!t.disabled){if(l.action=!0,u&&Array.isArray(Ya(a,e))){const t=o(Ya(a,e),d.argA,d.argB);c&&qa(a,e,t)}if(u&&Array.isArray(Ya(n.errors,e))){const t=o(Ya(n.errors,e),d.argA,d.argB);c&&qa(n.errors,e,t),((e,t)=>{!za(Ya(e,t)).length&&Ss(e,t)})(n.errors,e)}if((h.touchedFields||x.touchedFields)&&u&&Array.isArray(Ya(n.touchedFields,e))){const t=o(Ya(n.touchedFields,e),d.argA,d.argB);c&&qa(n.touchedFields,e,t)}(h.dirtyFields||x.dirtyFields)&&(n.dirtyFields=Es(r,i)),g.state.next({name:e,isDirty:S(e,s),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else qa(i,e,s)},_setDisabledField:I,_setErrors:e=>{n.errors=e,g.state.next({errors:n.errors,isValid:!1})},_getFieldArray:e=>za(Ya(l.mount?i:r,e,t.shouldUnregister?Ya(r,e,[]):[])),_reset:V,_resetDefaultValues:()=>js(t.defaultValues)&&t.defaultValues().then(e=>{q(e,t.resetOptions),g.state.next({isLoading:!1})}),_removeUnmounted:()=>{for(const e of u.unMount){const t=Ya(a,e);t&&(t._f.refs?t._f.refs.every(e=>!ks(e)):!ks(t._f.ref))&&L(e)}u.unMount=new Set},_disableForm:e=>{Va(e)&&(g.state.next({disabled:e}),qs(a,(t,n)=>{const s=Ya(a,n);s&&(t.disabled=s._f.disabled||e,Array.isArray(s._f.refs)&&s._f.refs.forEach(t=>{t.disabled=s._f.disabled||e}))},0,!1))},_subjects:g,_proxyFormState:h,get _fields(){return a},get _formValues(){return i},get _state(){return l},set _state(e){l=e},get _defaultValues(){return r},get _names(){return u},set _names(e){u=e},get _formState(){return n},get _options(){return t},set _options(e){t=o(o({},t),e)}},subscribe:e=>(l.mount=!0,x=o(o({},x),e.formState),M(d(o({},e),{formState:x}))),trigger:F,register:z,handleSubmit:Y,watch:(e,t)=>js(e)?g.state.subscribe({next:n=>e(D(void 0,t),n)}):D(e,t,!0),setValue:E,getValues:P,reset:q,resetField:(e,t={})=>{Ya(a,e)&&(Ia(t.defaultValue)?E(e,Ma(Ya(r,e))):(E(e,t.defaultValue),qa(r,e,Ma(t.defaultValue))),t.keepTouched||Ss(n.touchedFields,e),t.keepDirty||(Ss(n.dirtyFields,e),n.isDirty=t.defaultValue?S(e,Ma(Ya(r,e))):S()),t.keepError||(Ss(n.errors,e),h.isValid&&v()),g.state.next(o({},n)))},clearErrors:e=>{e&&xs(e).forEach(e=>Ss(n.errors,e)),g.state.next({errors:e?n.errors:{}})},unregister:L,setError:R,setFocus:(e,t={})=>{const n=Ya(a,e),s=n&&n._f;if(s){const e=s.refs?s.refs[0]:s.ref;e.focus&&(e.focus(),t.shouldSelect&&js(e.select)&&e.select())}},getFieldState:O};return d(o({},H),{formControl:H})}function Js(e={}){const t=ye.useRef(void 0),n=ye.useRef(void 0),[a,s]=ye.useState({isDirty:!1,isValidating:!1,isLoading:js(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:js(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current=d(o({},e.formControl),{formState:a}),e.defaultValues&&!js(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const n=Xs(e),{formControl:s}=n,r=c(n,["formControl"]);t.current=d(o({},r),{formState:a})}const r=t.current.control;return r._options=e,ds(()=>{const e=r._subscribe({formState:r._proxyFormState,callback:()=>s(o({},r._formState)),reRenderRoot:!0});return s(e=>d(o({},e),{isReady:!0})),r._formState.isReady=!0,e},[r]),ye.useEffect(()=>r._disableForm(e.disabled),[r,e.disabled]),ye.useEffect(()=>{e.mode&&(r._options.mode=e.mode),e.reValidateMode&&(r._options.reValidateMode=e.reValidateMode)},[r,e.mode,e.reValidateMode]),ye.useEffect(()=>{e.errors&&(r._setErrors(e.errors),r._focusError())},[r,e.errors]),ye.useEffect(()=>{e.shouldUnregister&&r._subjects.state.next({values:r._getWatch()})},[r,e.shouldUnregister]),ye.useEffect(()=>{if(r._proxyFormState.isDirty){const e=r._getDirty();e!==a.isDirty&&r._subjects.state.next({isDirty:e})}},[r,a.isDirty]),ye.useEffect(()=>{e.values&&!vs(e.values,n.current)?(r._reset(e.values,r._options.resetOptions),n.current=e.values,s(e=>o({},e))):r._resetDefaultValues()},[r,e.values]),ye.useEffect(()=>{r._state.mount||(r._setValid(),r._state.mount=!0),r._state.watch&&(r._state.watch=!1,r._subjects.state.next(o({},r._formState))),r._removeUnmounted()}),t.current.formState=os(a,r),t.current}
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var er={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=(e,t)=>{const n=ve.forwardRef((n,a)=>{var s,r=n,{color:i="currentColor",size:l=24,strokeWidth:u=2,absoluteStrokeWidth:m,className:p="",children:h}=r,x=c(r,["color","size","strokeWidth","absoluteStrokeWidth","className","children"]);return ve.createElement("svg",o(d(o({ref:a},er),{width:l,height:l,stroke:i,strokeWidth:m?24*Number(u)/Number(l):u,className:["lucide",`lucide-${s=e,s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,p].join(" ")}),x),[...t.map(([e,t])=>ve.createElement(e,t)),...Array.isArray(h)?h:[h]])});return n.displayName=`${e}`,n},nr=tr("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),ar=tr("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),sr=tr("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),rr=tr("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),ir=tr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),lr=tr("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),or=tr("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),dr=tr("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),cr=tr("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),ur=tr("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),mr=tr("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),pr=tr("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),hr=tr("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),xr=tr("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),gr=tr("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),fr=tr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),vr=tr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),yr=tr("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),br=tr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),jr=tr("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),wr=tr("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]),Nr=tr("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]),_r=tr("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),kr=tr("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),Sr=tr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Dr=tr("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),$r=tr("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Cr=tr("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Er=tr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),Tr=tr("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Ar=tr("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Fr=tr("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Pr=tr("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),Or=tr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Rr=tr("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]),Mr=tr("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),Lr=tr("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),Ir=tr("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),zr=tr("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Br=tr("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Yr=tr("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),Vr=tr("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]),qr=tr("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),Ur=tr("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),Hr=tr("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Gr=tr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Wr=tr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Kr=tr("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Zr=tr("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),Qr=tr("Microscope",[["path",{d:"M6 18h8",key:"1borvv"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M14 22a7 7 0 1 0 0-14h-1",key:"1jwaiy"}],["path",{d:"M9 14h2",key:"197e7h"}],["path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z",key:"1bmzmy"}],["path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3",key:"1drr47"}]]),Xr=tr("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Jr=tr("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),ei=tr("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),ti=tr("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),ni=tr("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),ai=tr("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"9",x2:"9",y1:"3",y2:"21",key:"13tij5"}]]),si=tr("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),ri=tr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),ii=tr("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]),li=tr("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]),oi=tr("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),di=tr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),ci=tr("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),ui=tr("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),mi=tr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),pi=tr("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),hi=tr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),xi=tr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),gi=tr("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),fi=tr("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),vi=tr("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),yi=tr("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),bi=tr("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),ji=tr("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),wi=tr("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),Ni=tr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_i=tr("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),ki=tr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Si=tr("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Di=tr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),$i=tr("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),Ci=tr("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Ei=tr("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]),Ti=tr("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),Ai=tr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Fi=tr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Pi=tr("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Oi=tr("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Ri=tr("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Mi=tr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Li=tr("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ii=b,zi=y,Bi=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(h,o({ref:t,className:aa("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a)},s))});Bi.displayName=h.displayName;const Yi=ve.forwardRef((e,t)=>{var n=e,{className:a,children:s}=n,r=c(n,["className","children"]);return p.jsxs(zi,{children:[p.jsx(Bi,{}),p.jsxs(x,d(o({ref:t,dir:"rtl",className:aa("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border-2 border-border bg-background p-6 shadow-2xl duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a)},r),{children:[s,p.jsxs(g,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-all duration-200 hover:opacity-100 hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[p.jsx(Mi,{className:"h-4 w-4"}),p.jsx("span",{className:"sr-only",children:"إغلاق"})]})]}))]})});Yi.displayName=x.displayName;const Vi=e=>{var t=e,{className:n}=t,a=c(t,["className"]);return p.jsx("div",o({className:aa("flex flex-col space-y-1.5 text-center sm:text-right",n)},a))};Vi.displayName="DialogHeader";const qi=e=>{var t=e,{className:n}=t,a=c(t,["className"]);return p.jsx("div",o({className:aa("flex flex-col-reverse sm:flex-row sm:justify-start sm:space-x-reverse sm:space-x-2",n)},a))};qi.displayName="DialogFooter";const Ui=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(f,o({ref:t,className:aa("text-lg font-semibold leading-none tracking-tight",a)},s))});Ui.displayName=f.displayName;const Hi=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(v,o({ref:t,className:aa("text-sm text-muted-foreground",a)},s))});Hi.displayName=v.displayName;const Gi=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,Wi=_e,Ki=(e,t)=>n=>{var a;if(null==(null==t?void 0:t.variants))return Wi(e,null==n?void 0:n.class,null==n?void 0:n.className);const{variants:s,defaultVariants:r}=t,i=Object.keys(s).map(e=>{const t=null==n?void 0:n[e],a=null==r?void 0:r[e];if(null===t)return null;const i=Gi(t)||Gi(a);return s[e][i]}),l=n&&Object.entries(n).reduce((e,t)=>{let[n,a]=t;return void 0===a||(e[n]=a),e},{}),d=null==t||null===(a=t.compoundVariants)||void 0===a?void 0:a.reduce((e,t)=>{let n=t,{class:a,className:s}=n,i=c(n,["class","className"]);return Object.entries(i).every(e=>{let[t,n]=e;return Array.isArray(n)?n.includes(o(o({},r),l)[t]):o(o({},r),l)[t]===n})?[...e,a,s]:e},[]);return Wi(e,i,d,null==n?void 0:n.class,null==n?void 0:n.className)},Zi=Ki("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 relative overflow-hidden",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-md hover:bg-primary/90 hover:shadow-lg active:scale-[0.98] dark:shadow-lg dark:shadow-primary/20 before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/10 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity",destructive:"bg-destructive text-destructive-foreground shadow-md hover:bg-destructive/90 hover:shadow-lg active:scale-[0.98] dark:shadow-lg dark:shadow-destructive/20 before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/10 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity",outline:"border-2 border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground hover:border-ring/50 active:scale-[0.98] dark:border-border dark:hover:bg-accent/80 dark:shadow-md",secondary:"bg-secondary text-secondary-foreground shadow-md hover:bg-secondary/80 hover:shadow-lg active:scale-[0.98] dark:shadow-lg dark:shadow-secondary/20 before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/10 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity",ghost:"hover:bg-accent hover:text-accent-foreground active:scale-[0.98] dark:hover:bg-accent/80 transition-colors",link:"text-primary underline-offset-4 hover:underline active:scale-[0.98] dark:text-primary",success:"bg-green-600 text-white shadow-md hover:bg-green-700 hover:shadow-lg active:scale-[0.98] dark:bg-green-700 dark:hover:bg-green-600 dark:shadow-lg dark:shadow-green-700/20",warning:"bg-amber-600 text-white shadow-md hover:bg-amber-700 hover:shadow-lg active:scale-[0.98] dark:bg-amber-700 dark:hover:bg-amber-600 dark:shadow-lg dark:shadow-amber-700/20"},size:{default:"h-10 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-11 rounded-md px-8 text-base",icon:"h-10 w-10",xs:"h-6 rounded px-2 text-xs"}},defaultVariants:{variant:"default",size:"default"}}),Qi=ve.forwardRef((e,t)=>{var n=e,{className:a,variant:s,size:r,asChild:i=!1}=n,l=c(n,["className","variant","size","asChild"]);const d=i?j:"button";return p.jsx(d,o({className:aa(Zi({variant:s,size:r,className:a})),ref:t},l))});Qi.displayName="Button";const Xi=ve.forwardRef((e,t)=>{var n=e,{className:a,type:s}=n,r=c(n,["className","type"]);return p.jsx("input",o({type:s,className:aa("flex h-10 w-full rounded-md border-2 border-input bg-background px-3 py-2 text-sm shadow-sm transition-all duration-200 file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-ring hover:border-ring/50 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-background dark:border-input dark:text-foreground dark:placeholder:text-muted-foreground dark:focus-visible:ring-ring dark:hover:border-ring/50 dark:shadow-md",a),ref:t},r))});Xi.displayName="Input";const Ji=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("textarea",o({className:aa("flex min-h-[80px] w-full rounded-md border-2 border-input bg-background px-3 py-2 text-sm shadow-sm transition-all duration-200 placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-ring hover:border-ring/50 disabled:cursor-not-allowed disabled:opacity-50 resize-vertical",a),ref:t},s))});Ji.displayName="Textarea";const el=P,tl=R,nl=O,al=ve.forwardRef((e,t)=>{var n=e,{className:a,children:s}=n,r=c(n,["className","children"]);return p.jsxs(w,d(o({ref:t,className:aa("flex h-10 w-full items-center justify-between whitespace-nowrap rounded-md border-2 border-input bg-background px-3 py-2 text-sm shadow-sm ring-offset-background transition-all duration-200 data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-ring hover:border-ring/50 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a)},r),{children:[s,p.jsx(N,{asChild:!0,children:p.jsx(vr,{className:"h-4 w-4 opacity-50"})})]}))});al.displayName=w.displayName;const sl=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(_,d(o({ref:t,className:aa("flex cursor-default items-center justify-center py-1",a)},s),{children:p.jsx(jr,{className:"h-4 w-4"})}))});sl.displayName=_.displayName;const rl=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(k,d(o({ref:t,className:aa("flex cursor-default items-center justify-center py-1",a)},s),{children:p.jsx(vr,{className:"h-4 w-4"})}))});rl.displayName=k.displayName;const il=ve.forwardRef((e,t)=>{var n=e,{className:a,children:s,position:r="popper"}=n,i=c(n,["className","children","position"]);return p.jsx(S,{children:p.jsxs(D,d(o({ref:t,className:aa("relative z-50 max-h-[min(var(--radix-select-content-available-height),20rem)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:r},i),{children:[p.jsx(sl,{}),p.jsx($,{className:aa("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),p.jsx(rl,{})]}))})});il.displayName=D.displayName;const ll=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(C,o({ref:t,className:aa("px-2 py-1.5 text-sm font-semibold text-muted-foreground",a)},s))});ll.displayName=C.displayName;const ol=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(E,o({ref:t,className:aa("-mx-1 my-1 h-px bg-muted",a)},s))});ol.displayName=E.displayName;const dl=ve.forwardRef((e,t)=>{var n=e,{className:a,children:s}=n,r=c(n,["className","children"]);return p.jsxs(T,d(o({ref:t,className:aa("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a)},r),{children:[p.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:p.jsx(A,{children:p.jsx(fr,{className:"h-4 w-4"})})}),p.jsx(F,{children:s})]}))});dl.displayName=T.displayName;const cl=Ne()(Lt((e,t)=>({patients:[],selectedPatient:null,isLoading:!1,error:null,searchQuery:"",filteredPatients:[],loadPatients:()=>m(void 0,null,function*(){var t,n;e({isLoading:!0,error:null});try{const a=(yield null==(n=null==(t=window.electronAPI)?void 0:t.patients)?void 0:n.getAll())||[];e({patients:a,filteredPatients:a,isLoading:!1})}catch(a){console.error("Error loading patients:",a),e({error:a instanceof Error?a.message:"Failed to load patients",isLoading:!1})}}),createPatient:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield window.electronAPI.patients.create(n),{patients:s}=t(),r=[...s,a];e({patients:r,isLoading:!1}),t().filterPatients(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("patient-added",{detail:{patientId:a.id,patientName:a.full_name||"New Patient"}})),window.dispatchEvent(new CustomEvent("patient-changed",{detail:{type:"created",patientId:a.id,patientName:a.full_name||"New Patient"}})))}catch(a){e({error:a instanceof Error?a.message:"Failed to create patient",isLoading:!1})}}),updatePatient:(n,a)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const s=yield window.electronAPI.patients.update(n,a),{patients:r,selectedPatient:i}=t(),l=r.map(e=>e.id===n?s:e);e({patients:l,selectedPatient:(null==i?void 0:i.id)===n?s:i,isLoading:!1}),t().filterPatients(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("patient-updated",{detail:{patientId:n,patientName:s.full_name||"Updated Patient"}})),window.dispatchEvent(new CustomEvent("patient-changed",{detail:{type:"updated",patientId:n,patientName:s.full_name||"Updated Patient"}})))}catch(s){e({error:s instanceof Error?s.message:"Failed to update patient",isLoading:!1})}}),deletePatient:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const{patients:a,selectedPatient:s}=t(),r=a.find(e=>e.id===n);if(yield window.electronAPI.patients.delete(n)){const i=a.filter(e=>e.id!==n);return e({patients:i,selectedPatient:(null==s?void 0:s.id)===n?null:s,isLoading:!1}),t().filterPatients(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("patient-deleted",{detail:{patientId:n,patientName:r?r.full_name:"Unknown Patient"}})),{success:!0,patientName:r?r.full_name:"Unknown Patient"}}throw new Error("Failed to delete patient")}catch(a){throw e({error:a instanceof Error?a.message:"Failed to delete patient",isLoading:!1}),a}}),setSelectedPatient:t=>{e({selectedPatient:t})},setSearchQuery:n=>{e({searchQuery:n}),t().filterPatients()},clearError:()=>{e({error:null})},searchPatients:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{if(""===n.trim()){const{patients:a}=t();e({filteredPatients:a,searchQuery:n,isLoading:!1})}else{const t=yield window.electronAPI.patients.search(n);e({filteredPatients:t,searchQuery:n,isLoading:!1})}}catch(a){e({error:a instanceof Error?a.message:"Search failed",isLoading:!1})}}),filterPatients:()=>{const{patients:n,searchQuery:a}=t();if(""===a.trim())return void e({filteredPatients:n});const s=a.toLowerCase(),r=n.filter(e=>{var t,n,a;return e.full_name.toLowerCase().includes(s)||(null==(t=e.phone)?void 0:t.toLowerCase().includes(s))||(null==(n=e.email)?void 0:n.toLowerCase().includes(s))||(null==(a=e.serial_number)?void 0:a.toLowerCase().includes(s))});e({filteredPatients:r})},getPatientAppointments:e=>m(void 0,null,function*(){var t,n,a;try{return(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.appointments)?void 0:n.getByPatient)?void 0:a.call(n,e))||[]}catch(s){return console.error("Error fetching patient appointments:",s),[]}}),getPatientPayments:e=>m(void 0,null,function*(){var t,n,a;try{return(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.payments)?void 0:n.getByPatient)?void 0:a.call(n,e))||[]}catch(s){return console.error("Error fetching patient payments:",s),[]}}),getPatientStats:e=>m(void 0,null,function*(){try{const[a,s]=yield Promise.all([t().getPatientAppointments(e),t().getPatientPayments(e)]),r=Math.max(0,a.length),i=Math.max(0,a.filter(e=>"completed"===e.status).length),l=Math.max(0,s.length),o=s.filter(e=>"completed"===e.status).reduce((e,t)=>e+("number"==typeof t.amount?t.amount:0),0);let d,c;if(a.length>0)try{const e=a.filter(e=>e.start_time&&!isNaN(new Date(e.start_time).getTime())).sort((e,t)=>new Date(t.start_time).getTime()-new Date(e.start_time).getTime());d=e.length>0?e[0].start_time:void 0}catch(n){console.warn("Error sorting appointments by date:",n)}if(s.length>0)try{const e=s.filter(e=>e.payment_date&&!isNaN(new Date(e.payment_date).getTime())).sort((e,t)=>new Date(t.payment_date).getTime()-new Date(e.payment_date).getTime());c=e.length>0?e[0].payment_date:void 0}catch(n){console.warn("Error sorting payments by date:",n)}return{totalAppointments:r,completedAppointments:i,totalPayments:l,totalAmountPaid:Math.round(100*o)/100,lastAppointment:d,lastPayment:c}}catch(n){return console.error("Error calculating patient stats:",n),{totalAppointments:0,completedAppointments:0,totalPayments:0,totalAmountPaid:0}}})}),{name:"patient-store"}));let ul=0;const ml=new Map,pl=e=>{if(ml.has(e))return;const t=setTimeout(()=>{ml.delete(e),fl({type:"REMOVE_TOAST",toastId:e})},3e3);ml.set(e,t)},hl=(e,t)=>{switch(t.type){case"ADD_TOAST":return d(o({},e),{toasts:[t.toast,...e.toasts].slice(0,3)});case"UPDATE_TOAST":return d(o({},e),{toasts:e.toasts.map(e=>e.id===t.toast.id?o(o({},e),t.toast):e)});case"DISMISS_TOAST":{const{toastId:n}=t;return n?pl(n):e.toasts.forEach(e=>{pl(e.id)}),d(o({},e),{toasts:e.toasts.map(e=>e.id===n||void 0===n?d(o({},e),{open:!1}):e)})}case"REMOVE_TOAST":return void 0===t.toastId?d(o({},e),{toasts:[]}):d(o({},e),{toasts:e.toasts.filter(e=>e.id!==t.toastId)})}},xl=[];let gl={toasts:[]};function fl(e){gl=hl(gl,e),xl.forEach(e=>{e(gl)})}function vl(e){var t=c(e,[]);const n=(ul=(ul+1)%Number.MAX_SAFE_INTEGER,ul.toString()),a=()=>fl({type:"DISMISS_TOAST",toastId:n});return fl({type:"ADD_TOAST",toast:d(o({},t),{id:n,open:!0,onOpenChange:e=>{e||a()}})}),{id:n,dismiss:a,update:e=>fl({type:"UPDATE_TOAST",toast:d(o({},e),{id:n})})}}function yl(){const[e,t]=ve.useState(gl);return ve.useEffect(()=>(xl.push(t),()=>{const e=xl.indexOf(t);e>-1&&xl.splice(e,1)}),[e]),d(o({},e),{toast:vl,dismiss:e=>fl({type:"DISMISS_TOAST",toastId:e})})}function bl({open:e,onOpenChange:t}){const{createPatient:n,isLoading:a}=cl(),{toast:s}=yl(),[r,i]=ve.useState(!1),{register:l,handleSubmit:c,reset:u,setValue:h,watch:x,formState:{errors:g}}=Js({defaultValues:{full_name:"",gender:void 0,age:void 0,patient_condition:"",allergies:"",medical_conditions:"",email:"",address:"",notes:"",phone:"",date_added:(new Date).toISOString().slice(0,16)}}),f=()=>{u(),t(!1)};return p.jsx(Ii,{open:e,onOpenChange:f,children:p.jsxs(Yi,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsx(Ui,{children:"إضافة مريض جديد"}),p.jsx(Hi,{children:"أدخل معلومات المريض أدناه. الحقول المميزة بـ * مطلوبة."})]}),p.jsxs("form",{onSubmit:c(e=>m(this,null,function*(){if(e.gender){i(!0);try{const a=Date.now().toString().slice(-8)+Math.floor(100*Math.random()).toString().padStart(2,"0"),r=d(o({},e),{serial_number:a,age:Number(e.age),date_added:e.date_added||(new Date).toISOString()});yield n(r),s({title:"تم بنجاح",description:"تم إضافة المريض بنجاح"}),u(),t(!1)}catch(a){s({title:"خطأ",description:"فشل في إضافة المريض",variant:"destructive"})}finally{i(!1)}}else s({title:"خطأ",description:"يرجى اختيار الجنس",variant:"destructive"})})),className:"space-y-6",children:[p.jsxs("div",{className:"space-y-4",children:[p.jsx("h3",{className:"text-lg font-medium",children:"الحقول المطلوبة"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"الاسم الكامل *"}),p.jsx(Xi,d(o({},l("full_name",{required:"الاسم الكامل مطلوب"})),{placeholder:"أدخل الاسم الكامل"})),g.full_name&&p.jsx("p",{className:"text-sm text-destructive",children:g.full_name.message})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"الجنس *"}),p.jsxs(el,{onValueChange:e=>h("gender",e),children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر الجنس",className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"male",children:"ذكر"}),p.jsx(dl,{value:"female",children:"أنثى"})]})]}),g.gender&&p.jsx("p",{className:"text-sm text-destructive",children:"الجنس مطلوب"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"العمر *"}),p.jsx(Xi,d(o({type:"number",min:"1",max:"120"},l("age",{required:"العمر مطلوب",min:{value:1,message:"العمر يجب أن يكون أكبر من 0"},max:{value:120,message:"العمر يجب أن يكون أقل من 120"}})),{placeholder:"أدخل العمر"})),g.age&&p.jsx("p",{className:"text-sm text-destructive",children:g.age.message})]})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"تاريخ الإضافة *"}),p.jsx(Xi,o({type:"datetime-local"},l("date_added",{required:"تاريخ الإضافة مطلوب"}))),g.date_added&&p.jsx("p",{className:"text-sm text-destructive",children:g.date_added.message})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"رقم الهاتف"}),p.jsx(Xi,d(o({type:"tel"},l("phone",{pattern:{value:/^[0-9]{12}$/,message:"رقم الهاتف يجب أن يكون 12 رقم (مثل: 963987654321)"}})),{placeholder:"963987654321"})),p.jsx("p",{className:"text-xs text-muted-foreground",children:"يرجى إدخال رقم الهاتف مع رمز الدولة بدون + أو 00 (مثل: 963987654321)"}),g.phone&&p.jsx("p",{className:"text-sm text-destructive",children:g.phone.message})]})]})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsx("h3",{className:"text-lg font-medium",children:"الحقول الاختيارية"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"حالة المريض / التشخيص"}),p.jsx(Ji,d(o({},l("patient_condition")),{placeholder:"أدخل وصف الحالة الطبية أو التشخيص",rows:3}))]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"الحساسية"}),p.jsx(Xi,d(o({},l("allergies")),{placeholder:"أدخل معلومات الحساسية المعروفة"}))]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"الحالات الطبية / الأمراض"}),p.jsx(Ji,d(o({},l("medical_conditions")),{placeholder:"أدخل الحالات الطبية أو الأمراض المزمنة",rows:2}))]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"البريد الإلكتروني"}),p.jsx(Xi,d(o({type:"email"},l("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"البريد الإلكتروني غير صحيح"}})),{placeholder:"أدخل البريد الإلكتروني"})),g.email&&p.jsx("p",{className:"text-sm text-destructive",children:g.email.message})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"العنوان"}),p.jsx(Xi,d(o({},l("address")),{placeholder:"أدخل العنوان الكامل"}))]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sm font-medium",children:"ملاحظات / تعليقات"}),p.jsx(Ji,d(o({},l("notes")),{placeholder:"أدخل أي ملاحظات أو تعليقات إضافية",rows:3}))]})]}),p.jsxs(qi,{className:"flex justify-end space-x-4 space-x-reverse",children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:f,disabled:r,children:"إلغاء"}),p.jsx(Qi,{type:"submit",disabled:r||a,children:r?"جاري الإضافة...":"حفظ المريض"})]})]})]})})}var jl="AlertDialog",[wl,Nl]=M(jl,[L]),_l=L(),kl=e=>{const t=e,{__scopeAlertDialog:n}=t,a=c(t,["__scopeAlertDialog"]),s=_l(n);return p.jsx(b,d(o(o({},s),a),{modal:!0}))};kl.displayName=jl;ve.forwardRef((e,t)=>{const n=e,{__scopeAlertDialog:a}=n,s=c(n,["__scopeAlertDialog"]),r=_l(a);return p.jsx(I,d(o(o({},r),s),{ref:t}))}).displayName="AlertDialogTrigger";var Sl=e=>{const t=e,{__scopeAlertDialog:n}=t,a=c(t,["__scopeAlertDialog"]),s=_l(n);return p.jsx(y,o(o({},s),a))};Sl.displayName="AlertDialogPortal";var Dl=ve.forwardRef((e,t)=>{const n=e,{__scopeAlertDialog:a}=n,s=c(n,["__scopeAlertDialog"]),r=_l(a);return p.jsx(h,d(o(o({},r),s),{ref:t}))});Dl.displayName="AlertDialogOverlay";var $l="AlertDialogContent",[Cl,El]=wl($l),Tl=V("AlertDialogContent"),Al=ve.forwardRef((e,t)=>{const n=e,{__scopeAlertDialog:a,children:s}=n,r=c(n,["__scopeAlertDialog","children"]),i=_l(a),l=ve.useRef(null),u=z(t,l),m=ve.useRef(null);return p.jsx(B,{contentName:$l,titleName:Fl,docsSlug:"alert-dialog",children:p.jsx(Cl,{scope:a,cancelRef:m,children:p.jsxs(x,d(o(o({role:"alertdialog"},i),r),{ref:u,onOpenAutoFocus:Y(r.onOpenAutoFocus,e=>{var t;e.preventDefault(),null==(t=m.current)||t.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[p.jsx(Tl,{children:s}),p.jsx(zl,{contentRef:l})]}))})})});Al.displayName=$l;var Fl="AlertDialogTitle",Pl=ve.forwardRef((e,t)=>{const n=e,{__scopeAlertDialog:a}=n,s=c(n,["__scopeAlertDialog"]),r=_l(a);return p.jsx(f,d(o(o({},r),s),{ref:t}))});Pl.displayName=Fl;var Ol="AlertDialogDescription",Rl=ve.forwardRef((e,t)=>{const n=e,{__scopeAlertDialog:a}=n,s=c(n,["__scopeAlertDialog"]),r=_l(a);return p.jsx(v,d(o(o({},r),s),{ref:t}))});Rl.displayName=Ol;var Ml=ve.forwardRef((e,t)=>{const n=e,{__scopeAlertDialog:a}=n,s=c(n,["__scopeAlertDialog"]),r=_l(a);return p.jsx(g,d(o(o({},r),s),{ref:t}))});Ml.displayName="AlertDialogAction";var Ll="AlertDialogCancel",Il=ve.forwardRef((e,t)=>{const n=e,{__scopeAlertDialog:a}=n,s=c(n,["__scopeAlertDialog"]),{cancelRef:r}=El(Ll,a),i=_l(a),l=z(t,r);return p.jsx(g,d(o(o({},i),s),{ref:l}))});Il.displayName=Ll;var zl=({contentRef:e})=>{const t=`\`${$l}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${$l}\` by passing a \`${Ol}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${$l}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return ve.useEffect(()=>{var n;document.getElementById(null==(n=e.current)?void 0:n.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},Bl=Dl,Yl=Al,Vl=Ml,ql=Il,Ul=Pl,Hl=Rl;const Gl=kl,Wl=Sl,Kl=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(Bl,d(o({className:aa("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a)},s),{ref:t}))});Kl.displayName=Bl.displayName;const Zl=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsxs(Wl,{children:[p.jsx(Kl,{}),p.jsx(Yl,o({ref:t,dir:"rtl",className:aa("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border-2 border-border bg-background p-6 shadow-2xl duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a)},s))]})});Zl.displayName=Yl.displayName;const Ql=e=>{var t=e,{className:n}=t,a=c(t,["className"]);return p.jsx("div",o({className:aa("flex flex-col space-y-2 text-center sm:text-right",n)},a))};Ql.displayName="AlertDialogHeader";const Xl=e=>{var t=e,{className:n}=t,a=c(t,["className"]);return p.jsx("div",o({className:aa("flex flex-col-reverse sm:flex-row sm:justify-start sm:space-x-reverse sm:space-x-2",n)},a))};Xl.displayName="AlertDialogFooter";const Jl=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(Ul,o({ref:t,className:aa("text-lg font-semibold",a)},s))});Jl.displayName=Ul.displayName;const eo=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(Hl,o({ref:t,className:aa("text-sm text-muted-foreground",a)},s))});eo.displayName=Hl.displayName;const to=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(Vl,o({ref:t,className:aa(Zi(),a)},s))});to.displayName=Vl.displayName;const no=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(ql,o({ref:t,className:aa(Zi({variant:"outline"}),"mt-2 sm:mt-0",a)},s))});no.displayName=ql.displayName;var ao={exports:{}},so={},ro=ve;var io="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},lo=ro.useState,oo=ro.useEffect,co=ro.useLayoutEffect,uo=ro.useDebugValue;function mo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!io(e,n)}catch(a){return!0}}var po="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),a=lo({inst:{value:n,getSnapshot:t}}),s=a[0].inst,r=a[1];return co(function(){s.value=n,s.getSnapshot=t,mo(s)&&r({inst:s})},[e,n,t]),oo(function(){return mo(s)&&r({inst:s}),e(function(){mo(s)&&r({inst:s})})},[e]),uo(n),n};so.useSyncExternalStore=void 0!==ro.useSyncExternalStore?ro.useSyncExternalStore:po,ao.exports=so;var ho=ao.exports;function xo(){return()=>{}}var go="Avatar",[fo,vo]=M(go),[yo,bo]=fo(go),jo=ve.forwardRef((e,t)=>{const n=e,{__scopeAvatar:a}=n,s=c(n,["__scopeAvatar"]),[r,i]=ve.useState("idle");return p.jsx(yo,{scope:a,imageLoadingStatus:r,onImageLoadingStatusChange:i,children:p.jsx(q.span,d(o({},s),{ref:t}))})});jo.displayName=go;var wo="AvatarImage",No=ve.forwardRef((e,t)=>{const n=e,{__scopeAvatar:a,src:s,onLoadingStatusChange:r=()=>{}}=n,i=c(n,["__scopeAvatar","src","onLoadingStatusChange"]),l=bo(wo,a),u=function(e,{referrerPolicy:t,crossOrigin:n}){const a=ho.useSyncExternalStore(xo,()=>!0,()=>!1),s=ve.useRef(null),r=a?(s.current||(s.current=new window.Image),s.current):null,[i,l]=ve.useState(()=>So(r,e));return H(()=>{l(So(r,e))},[r,e]),H(()=>{const e=e=>()=>{l(e)};if(!r)return;const a=e("loaded"),s=e("error");return r.addEventListener("load",a),r.addEventListener("error",s),t&&(r.referrerPolicy=t),"string"==typeof n&&(r.crossOrigin=n),()=>{r.removeEventListener("load",a),r.removeEventListener("error",s)}},[r,n,t]),i}(s,i),m=U(e=>{r(e),l.onImageLoadingStatusChange(e)});return H(()=>{"idle"!==u&&m(u)},[u,m]),"loaded"===u?p.jsx(q.img,d(o({},i),{ref:t,src:s})):null});No.displayName=wo;var _o="AvatarFallback",ko=ve.forwardRef((e,t)=>{const n=e,{__scopeAvatar:a,delayMs:s}=n,r=c(n,["__scopeAvatar","delayMs"]),i=bo(_o,a),[l,u]=ve.useState(void 0===s);return ve.useEffect(()=>{if(void 0!==s){const e=window.setTimeout(()=>u(!0),s);return()=>window.clearTimeout(e)}},[s]),l&&"loaded"!==i.imageLoadingStatus?p.jsx(q.span,d(o({},r),{ref:t})):null});function So(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}ko.displayName=_o;var Do=jo,$o=No,Co=ko;const Eo=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(Do,o({ref:t,className:aa("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a)},s))});Eo.displayName=Do.displayName;ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx($o,o({ref:t,className:aa("aspect-square h-full w-full",a)},s))}).displayName=$o.displayName;const To=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(Co,o({ref:t,className:aa("flex h-full w-full items-center justify-center rounded-full bg-muted",a)},s))});function Ao({isOpen:e,patient:t,appointment:n,onClose:a,onConfirm:s,isLoading:r=!1,deletionProgress:i}){if(!t&&!n)return null;const l=!!t;return p.jsx(Gl,{open:e,onOpenChange:a,children:p.jsxs(Zl,{className:"max-w-md",dir:"rtl",children:[p.jsx(Ql,{children:p.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[p.jsx("div",{className:"flex-shrink-0",children:p.jsx(sr,{className:"w-8 h-8 text-destructive"})}),p.jsxs("div",{children:[p.jsx(Jl,{children:l?"هل أنت متأكد من حذف هذا المريض؟":"هل أنت متأكد من حذف هذا الموعد؟"}),p.jsx(eo,{children:"هذا الإجراء لا يمكن التراجع عنه"})]})]})}),p.jsxs("div",{className:"space-y-4",children:[p.jsx("div",{className:"bg-muted/50 rounded-lg p-4",children:p.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[p.jsx(Eo,{className:"w-10 h-10",children:p.jsx(To,{className:"bg-primary/10 text-primary",children:l?`${t.first_name.charAt(0)}${t.last_name.charAt(0)}`:"📅"})}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium",children:l?`${t.first_name} ${t.last_name}`:n.title}),p.jsx("p",{className:"text-sm text-muted-foreground",children:l?t.phone||"لا يوجد رقم هاتف":new Date(n.start_time).toLocaleString("ar-SA")})]})]})}),l&&p.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:p.jsxs("div",{className:"flex",children:[p.jsx(sr,{className:"w-5 h-5 text-destructive mt-0.5 ml-2"}),p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-medium text-destructive",children:"تحذير مهم"}),p.jsx("p",{className:"text-sm text-destructive/80 mt-1",children:"سيتم حذف جميع البيانات المرتبطة بهذا المريض بما في ذلك:"}),p.jsxs("ul",{className:"text-sm text-destructive/80 mt-2 list-disc list-inside",children:[p.jsx("li",{children:"جميع المواعيد المجدولة"}),p.jsx("li",{children:"سجل المدفوعات"}),p.jsx("li",{children:"التاريخ الطبي والملاحظات"}),p.jsx("li",{children:"الصور الطبية والأشعة"}),p.jsx("li",{children:"سجل استخدام المخزون"})]})]})]})}),r&&i&&p.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:p.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[p.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"جاري المعالجة..."}),p.jsx("p",{className:"text-sm text-blue-600 mt-1",children:i})]})]})})]}),p.jsxs(Xl,{className:"flex justify-end space-x-3 space-x-reverse",children:[p.jsx(no,{disabled:r,children:"إلغاء"}),p.jsx(to,{onClick:s,disabled:r,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:r?p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),p.jsx("span",{children:i||"جاري الحذف..."})]}):"تأكيد الحذف"})]})]})})}To.displayName=Co.displayName;var Fo=ve.forwardRef((e,t)=>p.jsx(q.label,d(o({},e),{ref:t,onMouseDown:t=>{var n;t.target.closest("button, input, select, textarea")||(null==(n=e.onMouseDown)||n.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}})));Fo.displayName="Label";var Po=Fo;const Oo=Ki("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-foreground dark:text-foreground"),Ro=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(Po,o({ref:t,className:aa(Oo(),a)},s))});function Mo({isOpen:e,onClose:t,onSave:n,patients:a,treatments:s,selectedDate:r,selectedTime:i,initialData:l,preSelectedPatientId:u}){const[h,x]=ve.useState({patient_id:"",gender:"",description:"",start_time:"",end_time:"",status:"scheduled",notes:""}),{toast:g}=yl();ve.useEffect(()=>{if(e)if(l){const e=a.find(e=>e.id===l.patient_id),t=new Date(l.start_time),n=new Date(l.end_time),s=e=>{if(isNaN(e.getTime()))return"";return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`};x({patient_id:l.patient_id||"",gender:"male"===(null==e?void 0:e.gender)?"ذكر":"female"===(null==e?void 0:e.gender)?"أنثى":"",description:l.description||"",start_time:s(t),end_time:s(n),status:l.status||"scheduled",notes:l.notes||""})}else if(r){const e=new Date(r);if(i){const[t,n]=i.split(":");e.setHours(parseInt(t),parseInt(n),0,0)}const t=new Date(e);t.setHours(e.getHours()+1);const n=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;x(a=>d(o({},a),{start_time:n(e),end_time:n(t)}))}else{const e=new Date,t=new Date(e.getTime()+36e5),n=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;x({patient_id:"",gender:"",description:"",start_time:n(e),end_time:n(t),status:"scheduled",notes:""})}},[r,i,l,e]),ve.useEffect(()=>{if(e&&u&&a.length>0){const e=a.find(e=>e.id===u);x(t=>d(o({},t),{patient_id:u,gender:"male"===(null==e?void 0:e.gender)?"ذكر":"female"===(null==e?void 0:e.gender)?"أنثى":""}))}},[e,u,a.length]);const f=e=>{const{name:t,value:n}=e.target;if("start_time"===t){const e=new Date(n);if(isNaN(e.getTime()))x(e=>d(o({},e),{[t]:n}));else{const a=new Date(e.getTime()+36e5),s=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;x(e=>d(o({},e),{[t]:n,end_time:s(a)}))}}else x(e=>d(o({},e),{[t]:n}))};return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsx(Ui,{className:"text-xl font-semibold",children:l?"تعديل الموعد":"إضافة موعد جديد"}),p.jsx(Hi,{children:l?"تعديل بيانات الموعد المحدد":"إضافة موعد جديد للمريض"})]}),p.jsxs("form",{onSubmit:e=>m(this,null,function*(){if(e.preventDefault(),!h.patient_id||!h.start_time)return void g({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});const t=new Date(h.start_time);if(isNaN(t.getTime()))return void g({title:"خطأ",description:"يرجى إدخال تاريخ ووقت بداية صحيح",variant:"destructive"});let s;if(h.end_time?(s=new Date(h.end_time),isNaN(s.getTime())&&(s=new Date(t.getTime()+36e5))):s=new Date(t.getTime()+36e5),s<=t)return void g({title:"خطأ",description:"يجب أن يكون وقت النهاية بعد وقت البداية",variant:"destructive"});try{if(yield window.electronAPI.appointments.checkConflict(t.toISOString(),s.toISOString(),null==l?void 0:l.id))return void g({title:"تعارض في المواعيد",description:"يوجد موعد آخر في نفس الوقت المحدد. يرجى اختيار وقت آخر.",variant:"destructive"})}catch(b){console.error("Error checking appointment conflict:",b)}const r=a.find(e=>e.id===h.patient_id),i=new Date(h.start_time),u=`${i.getDate().toString().padStart(2,"0")}/${(i.getMonth()+1).toString().padStart(2,"0")}/${i.getFullYear()}`,m=i.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}),p=r?`موعد ${r.full_name} - ${u} ${m}`:`موعد جديد - ${u} ${m}`,x=h,{gender:f}=x,v=c(x,["gender"]),y=d(o({},v),{title:p,start_time:t.toISOString(),end_time:s.toISOString()});console.log("📝 Submitting appointment data:",{isEdit:!!l,appointmentId:null==l?void 0:l.id,appointmentData:y}),n(y)}),className:"space-y-6",children:[p.jsxs("div",{className:"space-y-4",children:[p.jsx("h3",{className:"text-lg font-medium border-b pb-2",children:"الحقول المطلوبة"}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"flex items-center",children:[p.jsx(Ai,{className:"w-4 h-4 ml-1"}),"المريض *"]}),p.jsxs(el,{value:h.patient_id,onValueChange:e=>{x(t=>d(o({},t),{patient_id:e}));const t=a.find(t=>t.id===e);t&&x(n=>d(o({},n),{patient_id:e,gender:"male"===t.gender?"ذكر":"female"===t.gender?"أنثى":""}))},children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر المريض",className:"text-muted-foreground"})}),p.jsx(il,{children:a.map(e=>p.jsx(dl,{value:e.id,children:e.full_name},e.id))})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"الجنس"}),p.jsx(Xi,{value:h.gender,readOnly:!0,className:"bg-muted cursor-not-allowed",placeholder:"سيتم ملؤه تلقائياً"})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"flex items-center",children:[p.jsx(hr,{className:"w-4 h-4 ml-1"}),"تاريخ ووقت البداية *"]}),p.jsx(Xi,{type:"datetime-local",name:"start_time",value:h.start_time,onChange:f,required:!0})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"flex items-center",children:[p.jsx(Sr,{className:"w-4 h-4 ml-1"}),"وقت النهاية"]}),p.jsx(Xi,{type:"datetime-local",name:"end_time",value:h.end_time,onChange:f,placeholder:"سيتم حساب الوقت تلقائياً (ساعة واحدة)"}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"اتركه فارغاً لحساب ساعة واحدة تلقائياً من وقت البداية"})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"حالة الموعد *"}),p.jsxs(el,{value:h.status,onValueChange:e=>x(t=>d(o({},t),{status:e})),children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر حالة الموعد"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"scheduled",children:"مجدول"}),p.jsx(dl,{value:"cancelled",children:"ملغي"}),p.jsx(dl,{value:"completed",children:"مكتمل"}),p.jsx(dl,{value:"no_show",children:"لم يحضر"})]})]})]})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsx("h3",{className:"text-lg font-medium border-b pb-2",children:"الحقول الاختيارية"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"وصف الموعد"}),p.jsx(Ji,{name:"description",value:h.description,onChange:f,rows:3,placeholder:"أدخل وصف الموعد"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"ملاحظات إضافية"}),p.jsx(Ji,{name:"notes",value:h.notes,onChange:f,rows:2,placeholder:"أي ملاحظات إضافية"})]})]}),p.jsxs(qi,{className:"flex justify-end space-x-4 space-x-reverse",children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:t,children:"إلغاء"}),p.jsx(Qi,{type:"submit",children:"حفظ الموعد"})]})]})]})})}Ro.displayName=Po.displayName;const Lo=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,className:aa("rounded-xl border bg-card text-card-foreground shadow-sm hover:shadow-md transition-all duration-200 dark:bg-card dark:border-border dark:shadow-lg dark:shadow-black/10 dark:hover:shadow-xl",a)},s))});Lo.displayName="Card";const Io=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,className:aa("flex flex-col space-y-1.5 p-6 dark:text-card-foreground",a)},s))});Io.displayName="CardHeader";const zo=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,className:aa("font-semibold leading-none tracking-tight dark:text-card-foreground",a)},s))});zo.displayName="CardTitle";const Bo=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,className:aa("text-sm text-muted-foreground dark:text-muted-foreground",a)},s))});Bo.displayName="CardDescription";const Yo=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,className:aa("p-6 pt-0 dark:text-card-foreground",a)},s))});Yo.displayName="CardContent";ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,className:aa("flex items-center p-6 pt-0 dark:text-card-foreground",a)},s))}).displayName="CardFooter";const Vo=Ki("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80 dark:shadow-lg dark:shadow-primary/20",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80 dark:shadow-lg dark:shadow-secondary/20",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80 dark:shadow-lg dark:shadow-destructive/20",success:"border-transparent bg-green-600 text-white shadow hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 dark:shadow-lg dark:shadow-green-700/20",warning:"border-transparent bg-amber-600 text-white shadow hover:bg-amber-700 dark:bg-amber-700 dark:hover:bg-amber-600 dark:shadow-lg dark:shadow-amber-700/20",info:"border-transparent bg-blue-600 text-white shadow hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 dark:shadow-lg dark:shadow-blue-700/20",outline:"text-foreground border-border hover:bg-accent hover:text-accent-foreground dark:border-border dark:hover:bg-accent/80",ghost:"border-transparent hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/80"}},defaultVariants:{variant:"default"}});function qo(e){var t=e,{className:n,variant:a}=t,s=c(t,["className","variant"]);return p.jsx("div",o({className:aa(Vo({variant:a}),n)},s))}class Uo{static init(){this.isInitialized||(console.log("🔔 AlertsEventSystem: Initializing..."),this.isInitialized=!0,setInterval(()=>{this.cleanupListeners()},6e4))}static addEventListener(e,t){this.init(),this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),console.log(`🔔 AlertsEventSystem: Added listener for '${e}' (total: ${this.listeners.get(e).size})`)}static removeEventListener(e,t){this.listeners.has(e)&&(this.listeners.get(e).delete(t),console.log(`🔔 AlertsEventSystem: Removed listener for '${e}' (remaining: ${this.listeners.get(e).size})`),0===this.listeners.get(e).size&&this.listeners.delete(e))}static emit(e,t){if(console.log(`🔔 AlertsEventSystem: Emitting event '${e}'`,t?"with data:":"without data",t),this.listeners.has(e)){const n=Array.from(this.listeners.get(e));console.log(`🔔 AlertsEventSystem: Notifying ${n.length} listeners for '${e}'`),n.forEach((n,a)=>{try{console.log(`🔔 AlertsEventSystem: Calling listener ${a} for '${e}'`),n(t),console.log(`✅ AlertsEventSystem: Listener ${a} for '${e}' completed`)}catch(s){console.error(`❌ Error in event listener ${a} for '${e}':`,s)}})}else console.log(`🔔 AlertsEventSystem: No listeners for event '${e}'`);console.log(`🔔 AlertsEventSystem: Emitting window event for '${e}'`),this.emitWindowEvent(e,t)}static emitWindowEvent(e,t){if("undefined"!=typeof window)try{window.dispatchEvent(new CustomEvent(`alerts:${e}`,{detail:t}));[`alert:${e}`,`smart-alert:${e}`,e].forEach(e=>{try{window.dispatchEvent(new CustomEvent(e,{detail:t}))}catch(n){console.warn(`Could not dispatch compat event '${e}':`,n)}})}catch(n){console.warn("Could not dispatch window events:",n)}}static cleanupListeners(){let e=0;this.listeners.forEach((t,n)=>{e+=t.size}),e>100&&console.warn(`🔔 AlertsEventSystem: High listener count detected (${e}). Consider cleanup.`)}static removeAllListeners(){console.log("🔔 AlertsEventSystem: Removing all listeners"),this.listeners.clear()}static getListenerCount(e){var t;return(null==(t=this.listeners.get(e))?void 0:t.size)||0}static getAllListenerCounts(){const e={};return this.listeners.forEach((t,n)=>{e[n]=t.size}),e}}u(Uo,"listeners",new Map),u(Uo,"isInitialized",!1);class Ho{static formatAmount(e){var t,n,a;try{let r=da();try{const e=null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.settings)?void 0:n.getCurrency)?void 0:a.call(n);e&&(r=e)}catch(s){}return ca(e,r)}catch(r){return console.warn("Error formatting currency in alerts:",r),ca(e,da())}}static getAllAlerts(){return m(this,null,function*(){var e,t,n,a,s,r;const i=Date.now();try{console.log("🔄 Starting to load all alerts...");let o=[];try{o=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.smartAlerts)?void 0:t.getAll)?void 0:n.call(t))||[],console.log("📋 Loaded saved alerts from database:",o.length)}catch(l){console.error("❌ Error loading saved alerts:",l)}try{yield this.cleanupOutdatedAlerts()}catch(l){console.error("❌ Error during cleanup:",l)}let d=[];try{d=yield this.generateSmartAlerts(),console.log("🔄 Generated new alerts from real data:",d.length)}catch(l){console.error("❌ Error generating alerts:",l)}const c=d.filter(e=>{const t=o.find(t=>t.id===e.id);return!t||(console.log("📋 Alert already exists, skipping generation:",e.id,"isRead:",t.isRead),!1)});console.log(`📊 Filtered alerts: ${d.length} generated, ${c.length} new to save`);for(const e of c)try{if(!e.id){console.warn("⚠️ Alert missing ID, skipping:",e.title);continue}(yield null==(r=null==(s=null==(a=window.electronAPI)?void 0:a.smartAlerts)?void 0:s.create)?void 0:r.call(s,e))?console.log("💾 Saved new alert to database:",e.id,e.title):console.log("⚠️ Alert creation skipped (duplicate found):",e.title)}catch(l){console.error("Error saving alert to database:",l)}const u=[...o,...c],m=this.removeDuplicateAlerts(u);console.log(`📊 Final merge: ${o.length} saved + ${c.length} new = ${m.length} total`);try{yield this.clearExpiredSnoozedAlerts()}catch(l){console.error("❌ Error clearing expired snoozed alerts:",l)}const p=this.sortAlertsByPriority(m),h=Date.now()-i;return console.log("✅ Final alerts count:",p.length),console.log("📊 Alert breakdown:",{total:p.length,unread:p.filter(e=>!e.isRead).length,undismissed:p.filter(e=>!e.isDismissed).length,actionRequired:p.filter(e=>e.actionRequired).length,byPriority:{high:p.filter(e=>"high"===e.priority).length,medium:p.filter(e=>"medium"===e.priority).length,low:p.filter(e=>"low"===e.priority).length},byType:p.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{})}),console.log(`⏱️ Alert loading completed in ${h}ms`),p}catch(l){const e=Date.now()-i;return console.error(`❌ Error getting all alerts (${e}ms):`,l),[]}})}static generateSmartAlerts(){return m(this,null,function*(){const e=[];try{console.log("🔄 Generating alerts from real data...");const t=yield this.generateAppointmentAlerts();console.log("📅 Generated appointment alerts:",t.length),e.push(...t);const n=yield this.generatePaymentAlerts();console.log("💰 Generated payment alerts:",n.length),e.push(...n);const a=yield this.generateTreatmentAlerts();console.log("🦷 Generated treatment alerts:",a.length),e.push(...a);const s=yield this.generatePrescriptionAlerts();console.log("💊 Generated prescription alerts:",s.length),e.push(...s);const r=yield this.generateFollowUpAlerts();console.log("👤 Generated follow-up alerts:",r.length),e.push(...r);const i=yield this.generateInventoryAlerts();console.log("📦 Generated inventory alerts:",i.length),e.push(...i);const l=yield this.generateLabOrderAlerts();console.log("🧪 Generated lab order alerts:",l.length),e.push(...l);const o=yield this.generateClinicNeedsAlerts();console.log("🏥 Generated clinic needs alerts:",o.length),e.push(...o),console.log("✅ Total generated alerts:",e.length)}catch(t){console.error("❌ Error generating smart alerts:",t)}return e})}static generateAppointmentAlerts(){return m(this,null,function*(){var e,t,n;const a=[];try{const s=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.appointments)?void 0:t.getAll)?void 0:n.call(t))||[];console.log("📅 Checking appointments for alerts:",s.length);const r=new Date,i=new Date(r);i.setDate(i.getDate()+1),s.forEach(e=>{var t,n,s,l;if(!e.id)return void console.warn("Appointment missing ID, skipping");if(!e.start_time)return void console.warn("Appointment missing start_time:",e.id);const o=new Date(e.start_time);if(isNaN(o.getTime()))console.warn("Invalid appointment date:",e.start_time,"for appointment:",e.id);else{if(this.isSameDay(o,r)&&"scheduled"===e.status){const n=(null==(t=e.patient)?void 0:t.full_name)||"مريض غير محدد",s=e.patient_id||null;a.push({id:`appointment_today_${e.id}`,type:"appointment",priority:"high",title:`موعد اليوم - ${n}`,description:`موعد مجدول اليوم في ${this.formatTime(e.start_time)} - ${e.title||"موعد"}`,patientId:s,patientName:"مريض غير محدد"!==n?n:null,relatedData:{appointmentId:e.id},actionRequired:!0,dueDate:e.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(this.isSameDay(o,i)&&"scheduled"===e.status){const t=(null==(n=e.patient)?void 0:n.full_name)||"مريض غير محدد",s=e.patient_id||null;a.push({id:`appointment_tomorrow_${e.id}`,type:"appointment",priority:"medium",title:`موعد غداً - ${t}`,description:`موعد مجدول غداً في ${this.formatTime(e.start_time)} - ${e.title||"موعد"}`,patientId:s,patientName:"مريض غير محدد"!==t?t:null,relatedData:{appointmentId:e.id},actionRequired:!1,dueDate:e.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(o<r&&"scheduled"===e.status){const t=`appointment_overdue_${e.id}`,n=Math.floor((r.getTime()-o.getTime())/864e5),i=(null==(s=e.patient)?void 0:s.full_name)||"مريض غير محدد",l=e.patient_id||null;a.push({id:t,type:"appointment",priority:"high",title:`موعد متأخر - ${i}`,description:`موعد متأخر منذ ${n} يوم - ${e.title||"موعد"}`,patientId:l,patientName:"مريض غير محدد"!==i?i:null,relatedData:{appointmentId:e.id},actionRequired:!0,dueDate:e.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(("confirmed"===e.status||"scheduled"===e.status)&&this.isSameDay(o,r)){const t=new Date(e.start_time),n=new Date,s=(t.getTime()-n.getTime())/36e5;if(s<=6&&s>=2){const t=(null==(l=e.patient)?void 0:l.full_name)||"مريض غير محدد",n=e.patient_id||null;a.push({id:`appointment_reminder_${e.id}`,type:"appointment",priority:"medium",title:`تذكير موعد - ${t}`,description:`موعد خلال ${Math.round(s)} ساعة - ${e.title||"موعد"}`,patientId:n,patientName:"مريض غير محدد"!==t?t:null,relatedData:{appointmentId:e.id},actionRequired:!1,dueDate:e.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}}}})}catch(s){console.error("Error generating appointment alerts:",s)}return a})}static generatePaymentAlerts(){return m(this,null,function*(){var e,t,n;const a=[];try{const s=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.payments)?void 0:t.getAll)?void 0:n.call(t))||[],r=new Date;s.forEach(e=>{var t,n,s;if("pending"===e.status&&e.remaining_balance&&e.remaining_balance>0){if(!e.payment_date)return void console.warn("Payment missing payment_date:",e.id);const n=new Date(e.payment_date);if(isNaN(n.getTime()))return void console.warn("Invalid payment date:",e.payment_date,"for payment:",e.id);const s=Math.floor((r.getTime()-n.getTime())/864e5);if(s>0){const n=(null==(t=e.patient)?void 0:t.full_name)||"مريض غير محدد",r=e.patient_id||null;a.push({id:`payment_overdue_${e.id}`,type:"payment",priority:s>7?"high":"medium",title:`دفعة معلقة - ${n}`,description:`دفعة معلقة منذ ${s} يوم - المبلغ: ${this.formatAmount(e.remaining_balance)}`,patientId:r,patientName:"مريض غير محدد"!==n?n:null,relatedData:{paymentId:e.id,appointmentId:e.appointment_id||null},actionRequired:!0,dueDate:e.payment_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}}if("partial"===e.status&&e.remaining_balance&&e.remaining_balance>0){const t=(null==(n=e.patient)?void 0:n.full_name)||"مريض غير محدد",s=e.patient_id||null;a.push({id:`payment_partial_${e.id}`,type:"payment",priority:"medium",title:`دفعة جزئية - ${t}`,description:`تم دفع ${this.formatAmount(e.amount)} من أصل ${this.formatAmount(e.amount+e.remaining_balance)} - المتبقي: ${this.formatAmount(e.remaining_balance)}`,patientId:s,patientName:"مريض غير محدد"!==t?t:null,relatedData:{paymentId:e.id,appointmentId:e.appointment_id||null},actionRequired:!0,dueDate:e.payment_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if("failed"===e.status||"rejected"===e.status){const t=(null==(s=e.patient)?void 0:s.full_name)||"مريض غير محدد",n=e.patient_id||null;a.push({id:`payment_failed_${e.id}`,type:"payment",priority:"high",title:`دفعة مرفوضة - ${t}`,description:`دفعة بقيمة ${e.amount}$ تم رفضها - ${e.notes||"بحاجة لمراجعة"}`,patientId:n,patientName:"مريض غير محدد"!==t?t:null,relatedData:{paymentId:e.id,appointmentId:e.appointment_id||null},actionRequired:!0,dueDate:e.payment_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(s){console.error("Error generating payment alerts:",s)}return a})}static generateTreatmentAlerts(){return m(this,null,function*(){var e,t,n;const a=[];try{const s=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.toothTreatments)?void 0:t.getAll)?void 0:n.call(t))||[],r=new Date;s.forEach(e=>{var t,n,s,i,l,o;if("planned"===e.treatment_status||"in_progress"===e.treatment_status){const s=new Date(e.created_at),i=Math.floor((r.getTime()-s.getTime())/864e5);i>14&&a.push({id:`treatment_pending_${e.id}`,type:"treatment",priority:i>30?"high":"medium",title:`علاج معلق - ${(null==(t=e.patient)?void 0:t.full_name)||"مريض غير محدد"}`,description:`علاج ${e.treatment_type} للسن ${e.tooth_number} معلق منذ ${i} يوم`,patientId:e.patient_id,patientName:null==(n=e.patient)?void 0:n.full_name,relatedData:{treatmentId:e.id,appointmentId:e.appointment_id},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if("completed"===e.treatment_status&&e.notes&&e.notes.includes("متابعة")){const t=new Date(e.updated_at||e.created_at);Math.floor((r.getTime()-t.getTime())/864e5)>7&&a.push({id:`treatment_followup_${e.id}`,type:"treatment",priority:"medium",title:`متابعة علاج - ${(null==(s=e.patient)?void 0:s.full_name)||"مريض غير محدد"}`,description:`علاج ${e.treatment_type} للسن ${e.tooth_number} يحتاج متابعة`,patientId:e.patient_id,patientName:null==(i=e.patient)?void 0:i.full_name,relatedData:{treatmentId:e.id,appointmentId:e.appointment_id},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(e.treatment_type&&["تقويم","زراعة","علاج عصب","تركيب"].some(t=>e.treatment_type.includes(t))){const t=new Date(e.created_at),n=Math.floor((r.getTime()-t.getTime())/864e5);n>21&&"completed"!==e.treatment_status&&a.push({id:`treatment_complex_${e.id}`,type:"treatment",priority:"medium",title:`علاج معقد - ${(null==(l=e.patient)?void 0:l.full_name)||"مريض غير محدد"}`,description:`علاج ${e.treatment_type} للسن ${e.tooth_number} قيد التنفيذ منذ ${n} يوم`,patientId:e.patient_id,patientName:null==(o=e.patient)?void 0:o.full_name,relatedData:{treatmentId:e.id,appointmentId:e.appointment_id},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(s){console.error("Error generating treatment alerts:",s)}return a})}static generatePrescriptionAlerts(){return m(this,null,function*(){var e,t,n,a,s,r;const i=[];try{const l=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.prescriptions)?void 0:t.getAll)?void 0:n.call(t))||[],o=new Date;l.forEach(e=>{var t,n,a,s;const r=new Date(e.prescription_date),l=Math.floor((o.getTime()-r.getTime())/864e5);if(l>30){const n=(null==(t=e.patient)?void 0:t.full_name)||"مريض غير محدد",a=e.patient_id||null;i.push({id:`prescription_old_${e.id}`,type:"prescription",priority:"medium",title:`وصفة قديمة - ${n}`,description:`وصفة صادرة منذ ${l} يوم - قد تحتاج تجديد`,patientId:a,patientName:"مريض غير محدد"!==n?n:null,relatedData:{prescriptionId:e.id,appointmentId:e.appointment_id||null,treatmentId:e.tooth_treatment_id||null},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(e.notes&&e.notes.includes("متابعة")&&l>7){const t=(null==(n=e.patient)?void 0:n.full_name)||"مريض غير محدد",a=e.patient_id||null;i.push({id:`prescription_followup_${e.id}`,type:"prescription",priority:"medium",title:`متابعة وصفة - ${t}`,description:`وصفة تحتاج متابعة منذ ${l} يوم - ${e.notes}`,patientId:a,patientName:"مريض غير محدد"!==t?t:null,relatedData:{prescriptionId:e.id,appointmentId:e.appointment_id||null,treatmentId:e.tooth_treatment_id||null,daysSince:l},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(e.notes&&(e.notes.includes("مضاد حيوي")||e.notes.includes("مسكن قوي"))&&l>14){const t=(null==(a=e.patient)?void 0:a.full_name)||"مريض غير محدد",n=e.patient_id||null;i.push({id:`prescription_important_med_${e.id}`,type:"prescription",priority:"medium",title:`وصفة أدوية مهمة - ${t}`,description:`وصفة تحتوي على أدوية مهمة منذ ${l} يوم - تحتاج متابعة`,patientId:n,patientName:"مريض غير محدد"!==t?t:null,relatedData:{prescriptionId:e.id,appointmentId:e.appointment_id||null,treatmentId:e.tooth_treatment_id||null,medicationType:"important"},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(!e.notes||""===e.notes.trim()){const t=(null==(s=e.patient)?void 0:s.full_name)||"مريض غير محدد",n=e.patient_id||null;i.push({id:`prescription_no_notes_${e.id}`,type:"prescription",priority:"low",title:`وصفة بدون ملاحظات - ${t}`,description:`وصفة صادرة منذ ${l} يوم بدون ملاحظات - قد تحتاج توضيح`,patientId:n,patientName:"مريض غير محدد"!==t?t:null,relatedData:{prescriptionId:e.id,appointmentId:e.appointment_id||null,treatmentId:e.tooth_treatment_id||null},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}});((yield null==(r=null==(s=null==(a=window.electronAPI)?void 0:a.medications)?void 0:s.getAll)?void 0:r.call(s))||[]).forEach(e=>{if(e.expiry_date){const t=new Date(e.expiry_date),n=Math.floor((t.getTime()-o.getTime())/864e5);n<=30&&n>=0&&i.push({id:`medication_expiry_warning_${e.id}`,type:"prescription",priority:n<=7?"high":"medium",title:`دواء قريب الانتهاء - ${e.name}`,description:`ينتهي خلال ${n} يوم - قد يؤثر على الوصفات الجديدة`,relatedData:{medicationId:e.id,medicationName:e.name,expiryDate:e.expiry_date,daysUntilExpiry:n},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}e.quantity<=(e.min_quantity||10)&&i.push({id:`medication_low_stock_${e.id}`,type:"prescription",priority:0===e.quantity?"high":"medium",title:`دواء منخفض في المخزون - ${e.name}`,description:`الكمية المتبقية: ${e.quantity} - قد يؤثر على الوصفات`,relatedData:{medicationId:e.id,medicationName:e.name,currentQuantity:e.quantity,minimumQuantity:e.min_quantity||10},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})})}catch(l){console.error("Error generating prescription alerts:",l)}return i})}static generateFollowUpAlerts(){return m(this,null,function*(){var e,t,n,a,s,r;const i=[];try{const o=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.appointments)?void 0:t.getAll)?void 0:n.call(t))||[],d=new Date,c={};o.forEach(e=>{if("completed"===e.status&&e.patient_id){const t=new Date(e.start_time);(!c[e.patient_id]||t>c[e.patient_id])&&(c[e.patient_id]=t)}});for(const[e,t]of Object.entries(c)){const n=Math.floor((d.getTime()-t.getTime())/864e5);if(n>90)try{const t=yield null==(r=null==(s=null==(a=window.electronAPI)?void 0:a.patients)?void 0:s.getById)?void 0:r.call(s,e);t&&i.push({id:`follow_up_${e}`,type:"follow_up",priority:"low",title:`متابعة مطلوبة - ${t.full_name}`,description:`لم يزر المريض العيادة منذ ${n} يوم - قد يحتاج متابعة`,patientId:t.id,patientName:t.full_name,relatedData:{},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}catch(l){console.error("Error getting patient data for follow-up alert:",l)}}}catch(l){console.error("Error generating follow-up alerts:",l)}return i})}static createAlert(e){return m(this,null,function*(){var t,n,a;const s=d(o({},e),{id:`custom_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:(new Date).toISOString()});try{return(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.smartAlerts)?void 0:n.create)?void 0:a.call(n,s))?(Uo.emit("alert:created",{alert:s}),Uo.emit("alerts:changed"),s):(console.log("⚠️ Alert creation skipped (duplicate found):",s.title),s)}catch(r){throw console.error("Error creating alert:",r),r}})}static deleteAppointmentAlerts(e){return m(this,null,function*(){var t,n,a;try{console.log("🗑️ Deleting alerts for appointment:",e);const s=(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.smartAlerts)?void 0:n.deleteByRelatedData)?void 0:a.call(n,"appointmentId",e))||0;console.log(`🗑️ Deleted ${s} alerts for appointment ${e}`),Uo.emit("alert:deleted",{type:"appointment",relatedId:e,count:s}),Uo.emit("alerts:changed")}catch(s){console.error("Error deleting appointment alerts:",s)}})}static deletePaymentAlerts(e){return m(this,null,function*(){var t,n,a;try{console.log("🗑️ Deleting alerts for payment:",e);const s=(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.smartAlerts)?void 0:n.deleteByRelatedData)?void 0:a.call(n,"paymentId",e))||0;console.log(`🗑️ Deleted ${s} alerts for payment ${e}`),Uo.emit("alert:deleted",{type:"payment",relatedId:e,count:s}),Uo.emit("alerts:changed")}catch(s){console.error("Error deleting payment alerts:",s)}})}static deletePatientAlerts(e){return m(this,null,function*(){var t,n,a;try{console.log("🗑️ Deleting alerts for patient:",e);const s=(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.smartAlerts)?void 0:n.deleteByPatient)?void 0:a.call(n,e))||0;console.log(`🗑️ Deleted ${s} alerts for patient ${e}`),Uo.emit("alert:deleted",{type:"patient",relatedId:e,count:s}),Uo.emit("alerts:changed")}catch(s){console.error("Error deleting patient alerts:",s)}})}static deleteAlertsByType(e,t){return m(this,null,function*(){var n,a,s;try{console.log("🗑️ Deleting alerts by type:",e,"for patient:",t);const r=(yield null==(s=null==(a=null==(n=window.electronAPI)?void 0:n.smartAlerts)?void 0:a.deleteByType)?void 0:s.call(a,e,t))||0;console.log(`🗑️ Deleted ${r} alerts of type ${e}${t?` for patient ${t}`:""}`),Uo.emit("alert:deleted",{type:e,patientId:t,count:r}),Uo.emit("alerts:changed")}catch(r){console.error("Error deleting alerts by type:",r)}})}static updateAlert(e,t){return m(this,null,function*(){var n,a,s;try{console.log("🔄 SmartAlertsService: updateAlert called",{alertId:e,updates:t});const r=yield null==(s=null==(a=null==(n=window.electronAPI)?void 0:n.smartAlerts)?void 0:a.update)?void 0:s.call(a,e,t);console.log("✅ Alert updated in database:",e,t,"Result:",r),console.log("📡 Emitting alert:updated event..."),Uo.emit("alert:updated",{alertId:e,updates:t}),console.log("📡 Emitting alerts:changed event..."),Uo.emit("alerts:changed"),console.log("✅ All events emitted successfully")}catch(r){throw console.error("❌ Error updating alert:",r),r}})}static deleteAlert(e){return m(this,null,function*(){var t,n,a;try{yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.smartAlerts)?void 0:n.delete)?void 0:a.call(n,e),console.log("✅ Alert deleted from database:",e),Uo.emit("alert:deleted",{alertId:e}),Uo.emit("alerts:changed")}catch(s){throw console.error("Error deleting alert:",s),s}})}static addEventListener(e,t){Uo.addEventListener(e,t)}static removeEventListener(e,t){Uo.removeEventListener(e,t)}static emitEvent(e,t){Uo.emit(e,t)}static clearAllEventListeners(){Uo.removeAllListeners()}static generateInventoryAlerts(){return m(this,null,function*(){var e,t,n;const a=[];try{const s=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.inventory)?void 0:t.getAll)?void 0:n.call(t))||[],r=new Date;s.forEach(e=>{if(e.expiry_date){const t=new Date(e.expiry_date),n=Math.floor((t.getTime()-r.getTime())/864e5);n<=30&&n>=0?a.push({id:`inventory_expiry_${e.id}`,type:"inventory",priority:n<=7?"high":"medium",title:`انتهاء صلاحية قريب - ${e.name}`,description:`ينتهي في ${n} يوم - الكمية: ${e.quantity}`,relatedData:{inventoryId:e.id},actionRequired:!0,dueDate:e.expiry_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1}):n<0&&a.push({id:`inventory_expired_${e.id}`,type:"inventory",priority:"high",title:`منتهي الصلاحية - ${e.name}`,description:`انتهت الصلاحية منذ ${Math.abs(n)} يوم - الكمية: ${e.quantity}`,relatedData:{inventoryId:e.id},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(e.quantity<=(e.min_quantity||5)&&a.push({id:`inventory_low_${e.id}`,type:"inventory",priority:0===e.quantity?"high":"medium",title:`مخزون منخفض - ${e.name}`,description:`الكمية المتبقية: ${e.quantity} - الحد الأدنى: ${e.min_quantity||5}`,relatedData:{inventoryId:e.id,currentQuantity:e.quantity,minimumQuantity:e.min_quantity||5},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1}),e.usage_rate&&e.usage_rate>0){const t=Math.floor(e.quantity/e.usage_rate);t<=7&&t>0&&a.push({id:`inventory_high_usage_${e.id}`,type:"inventory",priority:t<=3?"high":"medium",title:`استخدام مفرط - ${e.name}`,description:`سينفد خلال ${t} يوم بمعدل الاستخدام الحالي (${e.usage_rate}/يوم)`,relatedData:{inventoryId:e.id,usageRate:e.usage_rate,daysUntilEmpty:t,currentQuantity:e.quantity},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(e.last_used_date){const t=new Date(e.last_used_date),n=Math.floor((r.getTime()-t.getTime())/864e5);n>90&&a.push({id:`inventory_unused_${e.id}`,type:"inventory",priority:"low",title:`عنصر غير مستخدم - ${e.name}`,description:`لم يستخدم منذ ${n} يوم - الكمية: ${e.quantity}`,relatedData:{inventoryId:e.id,lastUsedDate:e.last_used_date,daysSinceLastUse:n,currentQuantity:e.quantity},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(s){console.error("Error generating inventory alerts:",s)}return a})}static clearExpiredSnoozedAlerts(){return m(this,null,function*(){var e,t,n;try{yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.smartAlerts)?void 0:t.clearExpiredSnoozed)?void 0:n.call(t),console.log("✅ Cleared expired snoozed alerts")}catch(a){console.error("Error clearing expired snoozed alerts:",a)}})}static clearDismissedAlerts(){return m(this,null,function*(){var e,t,n;try{yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.smartAlerts)?void 0:t.clearDismissed)?void 0:n.call(t),console.log("✅ Cleared dismissed alerts")}catch(a){console.error("Error clearing dismissed alerts:",a)}})}static cleanupOutdatedAlerts(){return m(this,null,function*(){var e,t,n,a,s,r,i,l,o,d,c,u,m,p;try{console.log("🧹 Cleaning up outdated alerts...");const x=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.smartAlerts)?void 0:t.getAll)?void 0:n.call(t))||[],g=new Date,f=new Date(g.getTime()-2592e5);let v=0;for(const e of x){let t=!1;if(e.isDismissed&&new Date(e.createdAt)<f&&(t=!0),"appointment"===e.type&&(null==(a=e.relatedData)?void 0:a.appointmentId))try{const n=((yield null==(i=null==(r=null==(s=window.electronAPI)?void 0:s.appointments)?void 0:r.getAll)?void 0:i.call(r))||[]).find(t=>{var n;return t.id===(null==(n=e.relatedData)?void 0:n.appointmentId)});if(!n||"completed"!==n.status&&"cancelled"!==n.status||(t=!0),n&&n.start_time){const e=new Date(n.start_time);g>new Date(e.getTime()+6048e5)&&(t=!0)}}catch(h){console.warn("Error checking appointment for alert cleanup:",h)}if("payment"===e.type&&(null==(l=e.relatedData)?void 0:l.paymentId))try{const n=((yield null==(c=null==(d=null==(o=window.electronAPI)?void 0:o.payments)?void 0:d.getAll)?void 0:c.call(d))||[]).find(t=>{var n;return t.id===(null==(n=e.relatedData)?void 0:n.paymentId)});n&&("completed"===n.status||n.remaining_balance<=0)&&(t=!0)}catch(h){console.warn("Error checking payment for alert cleanup:",h)}if(t)try{yield null==(p=null==(m=null==(u=window.electronAPI)?void 0:u.smartAlerts)?void 0:m.delete)?void 0:p.call(m,e.id),v++}catch(h){console.warn("Error deleting outdated alert:",e.id,h)}}console.log(`🧹 Cleaned up ${v} outdated alerts`)}catch(h){console.error("Error during alert cleanup:",h)}})}static removeDuplicateAlerts(e){const t=new Map,n=new Map;return e.forEach(e=>{const a=t.get(e.id);if(a){if(this.isAlertMoreComplete(e,a)){t.set(e.id,e);const a=this.generateContentKey(e);n.set(a,e)}}else{const a=this.generateContentKey(e),s=n.get(a);if(s){const r=new Date(s.createdAt).getTime();(new Date(e.createdAt).getTime()>r||this.isAlertMoreComplete(e,s))&&(t.delete(s.id),t.set(e.id,e),n.set(a,e))}else t.set(e.id,e),n.set(a,e)}}),Array.from(t.values())}static generateContentKey(e){return[e.type,e.patientId||"no-patient",e.title.replace(/\s+/g,"").toLowerCase(),e.relatedData?JSON.stringify(e.relatedData):"no-data"].join("|")}static isAlertMoreComplete(e,t){const n=new Date(e.createdAt).getTime(),a=new Date(t.createdAt).getTime();if(n>a)return!0;if(n<a)return!1;return this.calculateCompletenessScore(e)>this.calculateCompletenessScore(t)}static calculateCompletenessScore(e){let t=0;return e.patientId&&(t+=2),e.patientName&&(t+=1),e.relatedData&&Object.keys(e.relatedData).length>0&&(t+=3),e.dueDate&&(t+=1),e.actionRequired&&(t+=1),void 0!==e.isRead&&(t+=1),void 0!==e.isDismissed&&(t+=1),t}static sortAlertsByPriority(e){const t={high:1,medium:2,low:3};return e.sort((e,n)=>{if(e.isRead!==n.isRead)return e.isRead?1:-1;if(e.actionRequired!==n.actionRequired)return e.actionRequired?-1:1;const a=t[e.priority]-t[n.priority];if(0!==a)return a;if(e.dueDate&&n.dueDate){const t=new Date(e.dueDate).getTime()-new Date(n.dueDate).getTime();if(0!==t)return t}else{if(e.dueDate&&!n.dueDate)return-1;if(!e.dueDate&&n.dueDate)return 1}return new Date(n.createdAt).getTime()-new Date(e.createdAt).getTime()})}static isSameDay(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}static generateLabOrderAlerts(){return m(this,null,function*(){var e,t,n;const a=[];try{const s=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.labOrders)?void 0:t.getAll)?void 0:n.call(t))||[],r=new Date;s.forEach(e=>{var t,n,s,i,l,o;if(e.expected_delivery_date&&"معلق"===e.status){const s=new Date(e.expected_delivery_date),i=Math.floor((r.getTime()-s.getTime())/864e5);i>0&&a.push({id:`lab_order_overdue_${e.id}`,type:"lab_order",priority:i>7?"high":"medium",title:`طلب مختبر متأخر - ${e.service_name}`,description:`متأخر ${i} يوم عن الموعد المتوقع${(null==(t=e.patient)?void 0:t.full_name)?` - ${e.patient.full_name}`:""}`,patientId:e.patient_id,patientName:null==(n=e.patient)?void 0:n.full_name,relatedData:{labOrderId:e.id,labId:e.lab_id,expectedDate:e.expected_delivery_date},actionRequired:!0,dueDate:e.expected_delivery_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(e.remaining_balance>0&&a.push({id:`lab_order_payment_${e.id}`,type:"payment",priority:"medium",title:`دفعة مختبر معلقة - ${e.service_name}`,description:`المبلغ المتبقي: ${this.formatAmount(e.remaining_balance)}${(null==(s=e.patient)?void 0:s.full_name)?` - ${e.patient.full_name}`:""}`,patientId:e.patient_id,patientName:null==(i=e.patient)?void 0:i.full_name,relatedData:{labOrderId:e.id,labId:e.lab_id,remainingBalance:e.remaining_balance},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1}),e.expected_delivery_date&&"معلق"===e.status){const t=new Date(e.expected_delivery_date),n=Math.floor((t.getTime()-r.getTime())/864e5);n<=2&&n>=0&&a.push({id:`lab_order_due_soon_${e.id}`,type:"lab_order",priority:"low",title:`طلب مختبر قريب التسليم - ${e.service_name}`,description:`متوقع التسليم خلال ${n} يوم${(null==(l=e.patient)?void 0:l.full_name)?` - ${e.patient.full_name}`:""}`,patientId:e.patient_id,patientName:null==(o=e.patient)?void 0:o.full_name,relatedData:{labOrderId:e.id,labId:e.lab_id,expectedDate:e.expected_delivery_date},actionRequired:!1,dueDate:e.expected_delivery_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(s){console.error("Error generating lab order alerts:",s)}return a})}static generateClinicNeedsAlerts(){return m(this,null,function*(){var e,t,n;const a=[];try{const s=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.clinicNeeds)?void 0:t.getAll)?void 0:n.call(t))||[],r=new Date;s.forEach(e=>{if("urgent"===e.priority&&"pending"===e.status){const t=new Date(e.created_at),n=Math.floor((r.getTime()-t.getTime())/864e5);a.push({id:`clinic_need_urgent_${e.id}`,type:"inventory",priority:"high",title:`احتياج عاجل معلق - ${e.need_name}`,description:`معلق منذ ${n} يوم - الكمية: ${e.quantity}`,relatedData:{clinicNeedId:e.id,needName:e.need_name,quantity:e.quantity,priority:e.priority},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if("ordered"===e.status){const t=new Date(e.created_at),n=Math.floor((r.getTime()-t.getTime())/864e5);n>14&&a.push({id:`clinic_need_delayed_${e.id}`,type:"inventory",priority:"urgent"===e.priority?"high":"medium",title:`احتياج متأخر - ${e.need_name}`,description:`مطلوب منذ ${n} يوم - الكمية: ${e.quantity}`,relatedData:{clinicNeedId:e.id,needName:e.need_name,quantity:e.quantity,supplier:e.supplier},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}e.price>1e3&&"pending"===e.status&&a.push({id:`clinic_need_expensive_${e.id}`,type:"inventory",priority:"medium",title:`احتياج عالي التكلفة - ${e.need_name}`,description:`التكلفة: $${e.price} - يحتاج موافقة`,relatedData:{clinicNeedId:e.id,needName:e.need_name,price:e.price,quantity:e.quantity},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})})}catch(s){console.error("Error generating clinic needs alerts:",s)}return a})}static formatTime(e){try{if(!e)return"--";const t=new Date(e);return isNaN(t.getTime())?"--":t.toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return console.error("Error formatting time:",t),"--"}}}const Go=Ne()(Lt((e,t)=>("undefined"!=typeof window&&window.addEventListener("patient-deleted",n=>{const{patientId:a}=n.detail,{payments:s,selectedPayment:r}=t(),i=s.filter(e=>e.patient_id!==a);e({payments:i,selectedPayment:(null==r?void 0:r.patient_id)===a?null:r}),t(),window.addEventListener("treatment-payments-deleted",n=>{const{treatmentId:a}=n.detail,{payments:s,selectedPayment:r}=t(),i=s.filter(e=>e.tooth_treatment_id!==a);e({payments:i,selectedPayment:(null==r?void 0:r.tooth_treatment_id)===a?null:r})}).calculateTotalRevenue(),t().calculatePendingAmount(),t().calculateTotalRemainingBalance(),t().calculatePartialPaymentsCount(),t().calculatePendingPaymentsCount(),t().calculateMonthlyRevenue(),t().calculatePaymentMethodStats(),t().filterPayments(),console.log(`💰 Removed ${s.length-i.length} payments for deleted patient ${a}`)}),{payments:[],filteredPayments:[],selectedPayment:null,isLoading:!1,error:null,searchQuery:"",statusFilter:"all",paymentMethodFilter:"all",totalRevenue:0,pendingAmount:0,totalRemainingBalance:0,partialPaymentsCount:0,pendingPaymentsCount:0,monthlyRevenue:{},paymentMethodStats:{},loadPayments:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const n=yield window.electronAPI.payments.getAll();e({payments:n,filteredPayments:n,isLoading:!1}),t().calculateTotalRevenue(),t().calculatePendingAmount(),t().calculateTotalRemainingBalance(),t().calculatePartialPaymentsCount(),t().calculatePendingPaymentsCount(),t().calculateMonthlyRevenue(),t().calculatePaymentMethodStats(),t().filterPayments()}catch(n){e({error:n instanceof Error?n.message:"Failed to load payments",isLoading:!1})}}),createPayment:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{console.log("💰 Creating payment in store:",n);const e=yield window.electronAPI.payments.create(n);return console.log("✅ Payment created successfully in store:",e),yield t().loadPayments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("payment-changed",{detail:{type:"created",paymentId:e.id,payment:e}})),window.dispatchEvent(new CustomEvent("payment-added",{detail:{type:"created",paymentId:e.id,payment:e}}))),e}catch(a){throw console.error("❌ Failed to create payment in store:",a),e({error:a instanceof Error?a.message:"Failed to create payment",isLoading:!1}),a}}),updatePayment:(n,a)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{console.log("🔄 Updating payment in store:",{id:n,paymentData:a});try{yield Ho.deletePaymentAlerts(n)}catch(s){console.warn("Could not delete old payment alerts:",s)}const e=yield window.electronAPI.payments.update(n,a);return console.log("✅ Payment updated successfully in store:",e),yield t().loadPayments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("payment-changed",{detail:{type:"updated",paymentId:n,payment:e}})),window.dispatchEvent(new CustomEvent("payment-updated",{detail:{type:"updated",paymentId:n,payment:e}}))),e}catch(s){throw console.error("❌ Failed to update payment in store:",s),e({error:s instanceof Error?s.message:"Failed to update payment",isLoading:!1}),s}}),deletePayment:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{yield window.electronAPI.payments.delete(n);const{payments:a,selectedPayment:s}=t(),r=a.filter(e=>e.id!==n);e({payments:r,selectedPayment:(null==s?void 0:s.id)===n?null:s,isLoading:!1}),t().calculateTotalRevenue(),t().calculatePendingAmount(),t().calculateTotalRemainingBalance(),t().calculatePartialPaymentsCount(),t().calculatePendingPaymentsCount(),t().calculateMonthlyRevenue(),t().calculatePaymentMethodStats(),t().filterPayments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("payment-changed",{detail:{type:"deleted",paymentId:n}})),window.dispatchEvent(new CustomEvent("payment-deleted",{detail:{type:"deleted",paymentId:n}})))}catch(a){e({error:a instanceof Error?a.message:"Failed to delete payment",isLoading:!1})}}),searchPayments:n=>{e({searchQuery:n}),t().filterPayments()},setSelectedPayment:t=>{e({selectedPayment:t})},setSearchQuery:n=>{e({searchQuery:n}),t().filterPayments()},setStatusFilter:n=>{e({statusFilter:n}),t().filterPayments()},setPaymentMethodFilter:n=>{e({paymentMethodFilter:n}),t().filterPayments()},filterPayments:()=>{const{payments:n,searchQuery:a,statusFilter:s,paymentMethodFilter:r}=t();let i=n;a&&(i=i.filter(e=>{var t,n;const s=e.patient?`${e.patient.first_name} ${e.patient.last_name}`:"";return(null==(t=e.receipt_number)?void 0:t.toLowerCase().includes(a.toLowerCase()))||(null==(n=e.description)?void 0:n.toLowerCase().includes(a.toLowerCase()))||s.toLowerCase().includes(a.toLowerCase())||e.amount.toString().includes(a)||e.payment_method.toLowerCase().includes(a.toLowerCase())||e.status.toLowerCase().includes(a.toLowerCase())})),"all"!==s&&(i=i.filter(e=>e.status===s)),"all"!==r&&(i=i.filter(e=>e.payment_method===r)),e({filteredPayments:i})},clearError:()=>{e({error:null})},calculateTotalRevenue:()=>{const{payments:n}=t(),a=n.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>{const n=Number(t.amount);return isNaN(n)||!isFinite(n)?(console.warn("Invalid payment amount:",t.amount,"for payment:",t.id),e):e+n},0),s=isNaN(a)||!isFinite(a)?0:Math.round(100*a)/100;e({totalRevenue:s})},calculatePendingAmount:()=>{const{payments:n}=t(),a=n.filter(e=>"pending"===e.status).reduce((e,t)=>{const n=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},a=n(t.amount),s=n(t.total_amount_due);let r=a;if(t.tooth_treatment_id){r=n(t.treatment_total_cost)||s}else if(s>0)r=s;else{const e=n(t.remaining_balance);e>0&&(r=e)}return e+r},0),s=isNaN(a)||!isFinite(a)?0:Math.round(100*a)/100;e({pendingAmount:s})},calculateTotalRemainingBalance:()=>{const{payments:n}=t();let a=0;const s=n.filter(e=>e.tooth_treatment_id&&"partial"===e.status),r={};s.forEach(e=>{r[e.tooth_treatment_id]||(r[e.tooth_treatment_id]=[]),r[e.tooth_treatment_id].push(e)}),Object.keys(r).forEach(e=>{const t=r[e],n=t[t.length-1];void 0!==n.treatment_remaining_balance&&(a+=n.treatment_remaining_balance)});const i=n.filter(e=>e.appointment_id&&!e.tooth_treatment_id&&"partial"===e.status),l={};i.forEach(e=>{l[e.appointment_id]||(l[e.appointment_id]=[]),l[e.appointment_id].push(e)}),Object.keys(l).forEach(e=>{const t=l[e],n=t[t.length-1];void 0!==n.remaining_balance&&(a+=n.remaining_balance)});n.filter(e=>!e.appointment_id&&!e.tooth_treatment_id&&"partial"===e.status).forEach(e=>{void 0!==e.remaining_balance&&e.remaining_balance>0&&(a+=e.remaining_balance)}),e({totalRemainingBalance:Math.round(100*a)/100})},calculatePartialPaymentsCount:()=>{const{payments:n}=t(),a=n.filter(e=>"partial"===e.status).length;e({partialPaymentsCount:a})},calculatePendingPaymentsCount:()=>{const{payments:n}=t(),a=n.filter(e=>"pending"===e.status).length;e({pendingPaymentsCount:a})},calculateMonthlyRevenue:()=>{const{payments:n}=t(),a={};n.filter(e=>"completed"===e.status||"partial"===e.status).forEach(e=>{try{const t=new Date(e.payment_date);if(isNaN(t.getTime()))return void console.warn("Invalid payment date:",e.payment_date);const n=t.toISOString().slice(0,7),s=Number(e.amount);if(isNaN(s)||!isFinite(s))return void console.warn("Invalid payment amount for monthly revenue:",e.amount,"for payment:",e.id);const r=(a[n]||0)+s;if(isNaN(r)||!isFinite(r))return void console.warn("Invalid monthly total calculation for month:",n);a[n]=Math.round(100*r)/100}catch(t){console.warn("Error processing payment date:",e.payment_date,t)}}),e({monthlyRevenue:a})},calculatePaymentMethodStats:()=>{const{payments:n}=t(),a={};n.filter(e=>"completed"===e.status||"partial"===e.status).forEach(e=>{const t=e.payment_method||"unknown",n="partial"===e.status&&void 0!==e.amount_paid?Number(e.amount_paid):Number(e.amount);if(isNaN(n)||!isFinite(n))return void console.warn("Invalid payment amount for method stats:",e.amount,"for payment:",e.id);const s=(a[t]||0)+n;!isNaN(s)&&isFinite(s)?a[t]=Math.round(100*s)/100:console.warn("Invalid method total calculation for method:",t)}),e({paymentMethodStats:a})},getPaymentsByPatient:e=>{const{payments:n}=t();return n.filter(t=>t.patient_id===e)},getPaymentsByAppointment:e=>{const{payments:n}=t();return n.filter(t=>t.appointment_id===e)},getPaymentsByToothTreatment:e=>{const{payments:n}=t();return n.filter(t=>t.tooth_treatment_id===e)},getPaymentsByDateRange:(e,n)=>{const{payments:a}=t();return a.filter(t=>{const a=t.payment_date;if(!a)return!1;const s=new Date(a);let r;return r=a.includes("T")||a.includes(" ")?s:new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0),r>=e&&r<=n})},getToothTreatmentPaymentSummary:e=>m(void 0,null,function*(){try{return yield window.electronAPI.payments.getToothTreatmentSummary(e)}catch(t){throw console.error("Failed to get tooth treatment payment summary:",t),t}}),markAsCompleted:e=>m(void 0,null,function*(){yield t().updatePayment(e,{status:"completed"})}),markAsPending:e=>m(void 0,null,function*(){yield t().updatePayment(e,{status:"pending"})}),markAsFailed:e=>m(void 0,null,function*(){yield t().updatePayment(e,{status:"failed"})}),markAsRefunded:e=>m(void 0,null,function*(){yield t().updatePayment(e,{status:"refunded"})})}),{name:"payment-store"})),Wo=Ne()(Lt((e,t)=>("undefined"!=typeof window&&window.addEventListener("patient-deleted",n=>{const{patientId:a}=n.detail,{appointments:s,selectedAppointment:r}=t(),i=s.filter(e=>e.patient_id!==a);e({appointments:i,selectedAppointment:(null==r?void 0:r.patient_id)===a?null:r}),t().convertToCalendarEvents(),console.log(`🗑️ Removed ${s.length-i.length} appointments for deleted patient ${a}`)}),{appointments:[],selectedAppointment:null,isLoading:!1,error:null,calendarView:"month",selectedDate:new Date,calendarEvents:[],loadAppointments:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const n=yield window.electronAPI.appointments.getAll();console.log("🏪 Store: Loaded appointments:",n.length),n.length>0&&(console.log("🏪 Store: First appointment sample:",n[0]),n.forEach((e,t)=>{t<3&&console.log(`🏪 Store: Appointment ${t+1} patient data:`,{id:e.id,patient_id:e.patient_id,patient:e.patient,patient_name:e.patient_name||e.patient_name})})),e({appointments:n,isLoading:!1}),t().convertToCalendarEvents()}catch(n){console.error("🏪 Store: Failed to load appointments:",n),e({error:n instanceof Error?n.message:"Failed to load appointments",isLoading:!1})}}),createAppointment:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield window.electronAPI.appointments.create(n),{appointments:s}=t(),r=[...s,a];e({appointments:r,isLoading:!1}),t().convertToCalendarEvents(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("appointment-added",{detail:{type:"created",appointmentId:a.id,appointment:a}})),window.dispatchEvent(new CustomEvent("appointment-changed",{detail:{type:"created",appointmentId:a.id,appointment:a}})))}catch(a){e({error:a instanceof Error?a.message:"Failed to create appointment",isLoading:!1})}}),updateAppointment:(n,a)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{console.log("🏪 Store: Updating appointment:",{id:n,appointmentData:a});try{yield Ho.deleteAppointmentAlerts(n)}catch(s){console.warn("Could not delete old appointment alerts:",s)}const r=yield window.electronAPI.appointments.update(n,a);console.log("🏪 Store: Received updated appointment:",r);const{appointments:i,selectedAppointment:l}=t(),o=i.map(e=>e.id===n?r:e);console.log("🏪 Store: Updated appointments array, found:",o.filter(e=>e.id===n).length),e({appointments:o,selectedAppointment:(null==l?void 0:l.id)===n?r:l,isLoading:!1}),t().convertToCalendarEvents(),console.log("🏪 Store: Update completed successfully"),yield t().loadAppointments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("appointment-updated",{detail:{type:"updated",appointmentId:n,appointment:r}})),window.dispatchEvent(new CustomEvent("appointment-changed",{detail:{type:"updated",appointmentId:n,appointment:r}})))}catch(s){throw console.error("🏪 Store: Update failed:",s),e({error:s instanceof Error?s.message:"Failed to update appointment",isLoading:!1}),s}}),deleteAppointment:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{if(!(yield window.electronAPI.appointments.delete(n)))throw new Error("Failed to delete appointment");{const{appointments:a,selectedAppointment:s}=t(),r=a.filter(e=>e.id!==n);e({appointments:r,selectedAppointment:(null==s?void 0:s.id)===n?null:s,isLoading:!1}),t().convertToCalendarEvents(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("appointment-deleted",{detail:{type:"deleted",appointmentId:n}})),window.dispatchEvent(new CustomEvent("appointment-changed",{detail:{type:"deleted",appointmentId:n}})))}}catch(a){e({error:a instanceof Error?a.message:"Failed to delete appointment",isLoading:!1})}}),setSelectedAppointment:t=>{e({selectedAppointment:t})},setCalendarView:t=>{e({calendarView:t})},setSelectedDate:t=>{e({selectedDate:t})},clearError:()=>{e({error:null})},convertToCalendarEvents:()=>{const{appointments:n}=t(),a=n.map(e=>{var t;const n=(null==(t=e.patient)?void 0:t.full_name)||e.patient_name||e.patient_name||"مريض غير معروف";"مريض غير معروف"===n&&console.log("🗓️ Calendar: Missing patient data for appointment:",{id:e.id,patient_id:e.patient_id,patient:e.patient,patient_name:e.patient_name});const a=`${n} - ${new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})}`;return{id:e.id,title:a,start:new Date(e.start_time),end:new Date(e.end_time),resource:e}});e({calendarEvents:a})},getAppointmentsForDate:e=>{const{appointments:n}=t(),a=e.toISOString().split("T")[0];return n.filter(e=>new Date(e.start_time).toISOString().split("T")[0]===a)},getAppointmentsForDateRange:(e,n)=>{const{appointments:a}=t();return a.filter(t=>{const a=new Date(t.start_time);return a>=e&&a<=n})},markAsCompleted:e=>m(void 0,null,function*(){yield t().updateAppointment(e,{status:"completed"})}),markAsCancelled:e=>m(void 0,null,function*(){yield t().updateAppointment(e,{status:"cancelled"})}),markAsNoShow:e=>m(void 0,null,function*(){yield t().updateAppointment(e,{status:"no_show"})})}),{name:"appointment-store"})),Ko=Ne((e,t)=>({toothTreatments:[],images:[],toothTreatmentImages:[],isLoading:!1,error:null,selectedPatientId:null,selectedToothNumber:null,loadToothTreatments:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const t=yield window.electronAPI.toothTreatments.getAll();e({toothTreatments:t,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to load tooth treatments",isLoading:!1})}}),loadToothTreatmentsByPatient:t=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{console.log("🦷 Loading treatments for patient:",t);const n=yield window.electronAPI.toothTreatments.getByPatient(t);console.log("🦷 Loaded treatments:",n.length,"treatments"),e({toothTreatments:n,isLoading:!1,selectedPatientId:t}),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("treatments-loaded",{detail:{patientId:t,treatmentsCount:n.length}}))}catch(n){console.error("🦷 Error loading treatments:",n),e({error:n instanceof Error?n.message:"Failed to load patient tooth treatments",isLoading:!1})}}),loadToothTreatmentsByTooth:(t,n)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield window.electronAPI.toothTreatments.getByTooth(t,n);e({toothTreatments:a,isLoading:!1,selectedPatientId:t,selectedToothNumber:n})}catch(a){e({error:a instanceof Error?a.message:"Failed to load tooth treatments",isLoading:!1})}}),createToothTreatment:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield window.electronAPI.toothTreatments.create(n),{toothTreatments:s,selectedPatientId:r}=t();if(e({toothTreatments:[...s,a],isLoading:!1}),r){const t=yield window.electronAPI.toothTreatments.getByPatient(r);e({toothTreatments:t})}return"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("treatment-added",{detail:{type:"created",treatmentId:a.id,treatment:a}})),window.dispatchEvent(new CustomEvent("treatment-changed",{detail:{type:"created",treatmentId:a.id,treatment:a}}))),a}catch(a){throw e({error:a instanceof Error?a.message:"Failed to create tooth treatment",isLoading:!1}),a}}),updateToothTreatment:(n,a)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{console.log("🦷 Store: Updating treatment in database:",n,a),yield window.electronAPI.toothTreatments.update(n,a),console.log("🦷 Store: Database update successful");const{toothTreatments:r,selectedPatientId:i}=t(),l=r.map(e=>e.id===n?d(o(o({},e),a),{updated_at:(new Date).toISOString()}):e);if(e({toothTreatments:l,isLoading:!1}),i)try{const t=yield window.electronAPI.toothTreatments.getByPatient(i);e({toothTreatments:t}),console.log("🦷 Store: Refreshed treatments from database")}catch(s){console.warn("🦷 Store: Failed to refresh treatments, but update was successful:",s)}"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("treatment-updated",{detail:{type:"updated",treatmentId:n,updates:a}})),window.dispatchEvent(new CustomEvent("treatment-changed",{detail:{type:"updated",treatmentId:n,updates:a}})),window.dispatchEvent(new CustomEvent("tooth-color-update",{detail:{type:"status-changed",treatmentId:n,updates:a,timestamp:Date.now()}}))),console.log("🦷 Store: Treatment update completed successfully")}catch(r){console.error("🦷 Store: Error updating treatment:",r),e({error:r instanceof Error?r.message:"Failed to update tooth treatment",isLoading:!1})}}),deleteToothTreatment:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{yield window.electronAPI.toothTreatments.delete(n);const{toothTreatments:a}=t();e({toothTreatments:a.filter(e=>e.id!==n),isLoading:!1}),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("treatment-deleted",{detail:{type:"deleted",treatmentId:n}})),window.dispatchEvent(new CustomEvent("treatment-changed",{detail:{type:"deleted",treatmentId:n}})),window.dispatchEvent(new CustomEvent("treatment-payments-deleted",{detail:{treatmentId:n}})))}catch(a){throw e({error:a instanceof Error?a.message:"Failed to delete tooth treatment",isLoading:!1}),a}}),reorderToothTreatments:(n,a,s)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{yield window.electronAPI.toothTreatments.reorder(n,a,s);const r=yield window.electronAPI.toothTreatments.getByTooth(n,a),{toothTreatments:i}=t(),l=i.map(e=>{if(e.patient_id===n&&e.tooth_number===a){return r.find(t=>t.id===e.id)||e}return e});e({toothTreatments:l,isLoading:!1})}catch(r){throw e({error:r instanceof Error?r.message:"Failed to reorder tooth treatments",isLoading:!1}),r}}),loadImages:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const t=yield window.electronAPI.dentalTreatmentImages.getAll();e({images:t,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to load images",isLoading:!1})}}),loadImagesByTreatment:t=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const n=yield window.electronAPI.dentalTreatmentImages.getByTreatment(t);e({images:n,isLoading:!1})}catch(n){e({error:n instanceof Error?n.message:"Failed to load treatment images",isLoading:!1})}}),createImage:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield window.electronAPI.dentalTreatmentImages.create(n),{images:s}=t();return e({images:[...s,a],isLoading:!1}),a}catch(a){throw e({error:a instanceof Error?a.message:"Failed to create image",isLoading:!1}),a}}),deleteImage:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{yield window.electronAPI.dentalTreatmentImages.delete(n);const{images:a}=t(),s=a.filter(e=>e.id!==n);e({images:s,isLoading:!1})}catch(a){e({error:a instanceof Error?a.message:"Failed to delete image",isLoading:!1})}}),refreshAllImages:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const t=yield window.electronAPI.dentalTreatmentImages.getAll();e({images:t,isLoading:!1}),console.log("✅ All images refreshed after backup restore")}catch(t){e({error:t instanceof Error?t.message:"Failed to refresh images",isLoading:!1})}}),clearImages:()=>{e({images:[]})},setSelectedPatient:t=>{e({selectedPatientId:t})},setSelectedTooth:t=>{e({selectedToothNumber:t})},clearError:()=>{e({error:null})},loadAllToothTreatmentImages:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const t=yield window.electronAPI.toothTreatmentImages.getAll();e({toothTreatmentImages:t,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to load all tooth treatment images",isLoading:!1})}}),loadToothTreatmentImagesByTreatment:t=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const n=yield window.electronAPI.toothTreatmentImages.getByTreatment(t);e({toothTreatmentImages:n,isLoading:!1})}catch(n){e({error:n instanceof Error?n.message:"Failed to load tooth treatment images",isLoading:!1})}}),loadToothTreatmentImagesByTooth:(n,a)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const s=yield window.electronAPI.toothTreatmentImages.getByTooth(n,a),{toothTreatmentImages:r}=t(),i=r.filter(e=>!(e.tooth_number===a&&e.patient_id===n));e({toothTreatmentImages:[...i,...s],isLoading:!1})}catch(s){e({error:s instanceof Error?s.message:"Failed to load tooth treatment images",isLoading:!1})}}),createToothTreatmentImage:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield window.electronAPI.toothTreatmentImages.create(n),{toothTreatmentImages:s}=t();return e({toothTreatmentImages:[...s,a],isLoading:!1}),a}catch(a){throw e({error:a instanceof Error?a.message:"Failed to create tooth treatment image",isLoading:!1}),a}}),deleteToothTreatmentImage:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{yield window.electronAPI.toothTreatmentImages.delete(n);const{toothTreatmentImages:a}=t();e({toothTreatmentImages:a.filter(e=>e.id!==n),isLoading:!1})}catch(a){throw e({error:a instanceof Error?a.message:"Failed to delete tooth treatment image",isLoading:!1}),a}}),clearToothTreatmentImages:()=>{e({toothTreatmentImages:[]})},loadAllToothTreatmentImagesByPatient:t=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const n=(yield window.electronAPI.toothTreatmentImages.getAll()).filter(e=>e.patient_id===t);e({toothTreatmentImages:n,isLoading:!1})}catch(n){e({error:n instanceof Error?n.message:"Failed to load all tooth treatment images",isLoading:!1})}})})),Zo=[{number:28,name:"Third Molar",arabicName:"ضرس العقل",position:"upper",side:"right",type:"molar"},{number:27,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"right",type:"molar"},{number:26,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"right",type:"molar"},{number:25,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"upper",side:"right",type:"premolar"},{number:24,name:"First Premolar",arabicName:"ضاحك أول",position:"upper",side:"right",type:"premolar"},{number:23,name:"Canine",arabicName:"ناب",position:"upper",side:"right",type:"canine"},{number:22,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"right",type:"incisor"},{number:21,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"right",type:"incisor"},{number:11,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"left",type:"incisor"},{number:12,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"left",type:"incisor"},{number:13,name:"Canine",arabicName:"ناب",position:"upper",side:"left",type:"canine"},{number:14,name:"First Premolar",arabicName:"ضاحك أول",position:"upper",side:"left",type:"premolar"},{number:15,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"upper",side:"left",type:"premolar"},{number:16,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"left",type:"molar"},{number:17,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"left",type:"molar"},{number:18,name:"Third Molar",arabicName:"ضرس العقل",position:"upper",side:"left",type:"molar"},{number:38,name:"Third Molar",arabicName:"ضرس العقل",position:"lower",side:"right",type:"molar"},{number:37,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"right",type:"molar"},{number:36,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"right",type:"molar"},{number:35,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"lower",side:"right",type:"premolar"},{number:34,name:"First Premolar",arabicName:"ضاحك أول",position:"lower",side:"right",type:"premolar"},{number:33,name:"Canine",arabicName:"ناب",position:"lower",side:"right",type:"canine"},{number:32,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"right",type:"incisor"},{number:31,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"right",type:"incisor"},{number:41,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"left",type:"incisor"},{number:42,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"left",type:"incisor"},{number:43,name:"Canine",arabicName:"ناب",position:"lower",side:"left",type:"canine"},{number:44,name:"First Premolar",arabicName:"ضاحك أول",position:"lower",side:"left",type:"premolar"},{number:45,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"lower",side:"left",type:"premolar"},{number:46,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"left",type:"molar"},{number:47,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"left",type:"molar"},{number:48,name:"Third Molar",arabicName:"ضرس العقل",position:"lower",side:"left",type:"molar"}],Qo=[{number:65,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"right",type:"molar"},{number:64,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"right",type:"molar"},{number:63,name:"Canine",arabicName:"ناب",position:"upper",side:"right",type:"canine"},{number:62,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"right",type:"incisor"},{number:61,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"right",type:"incisor"},{number:51,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"left",type:"incisor"},{number:52,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"left",type:"incisor"},{number:53,name:"Canine",arabicName:"ناب",position:"upper",side:"left",type:"canine"},{number:54,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"left",type:"molar"},{number:55,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"left",type:"molar"},{number:75,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"right",type:"molar"},{number:74,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"right",type:"molar"},{number:73,name:"Canine",arabicName:"ناب",position:"lower",side:"right",type:"canine"},{number:72,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"right",type:"incisor"},{number:71,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"right",type:"incisor"},{number:81,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"left",type:"incisor"},{number:82,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"left",type:"incisor"},{number:83,name:"Canine",arabicName:"ناب",position:"lower",side:"left",type:"canine"},{number:84,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"left",type:"molar"},{number:85,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"left",type:"molar"}],Xo=(e,t=!1)=>(t?Qo:Zo).find(t=>t.number===e),Jo=[{value:"healthy",label:"سليم",color:"#22c55e",category:"العلاجات الوقائية"},{value:"cleaning",label:"تنظيف",color:"#06b6d4",category:"العلاجات الوقائية"},{value:"fluoride",label:"فلورايد",color:"#0ea5e9",category:"العلاجات الوقائية"},{value:"sealant",label:"حشو وقائي",color:"#14b8a6",category:"العلاجات الوقائية"},{value:"scaling",label:"تقليح",color:"#06b6d4",category:"العلاجات الوقائية"},{value:"filling_metal",label:"حشو معدني",color:"#64748b",category:"الترميمية (المحافظة)"},{value:"filling_cosmetic",label:"حشو تجميلي",color:"#f97316",category:"الترميمية (المحافظة)"},{value:"filling_glass_ionomer",label:"حشو زجاجي",color:"#fb7185",category:"الترميمية (المحافظة)"},{value:"inlay",label:"حشو داخلي",color:"#a855f7",category:"الترميمية (المحافظة)"},{value:"onlay",label:"حشو خارجي",color:"#8b5cf6",category:"الترميمية (المحافظة)"},{value:"pulp_therapy",label:"مداولة لبية",color:"#dc2626",category:"علاج العصب"},{value:"direct_pulp_cap",label:"تغطية مباشرة",color:"#f87171",category:"علاج العصب"},{value:"indirect_pulp_cap",label:"تغطية غير مباشرة",color:"#fca5a5",category:"علاج العصب"},{value:"retreatment",label:"إعادة معالجة",color:"#b91c1c",category:"علاج العصب"},{value:"deep_pulp_treatment",label:"معالجة لبية عفنة",color:"#991b1b",category:"علاج العصب"},{value:"extraction_simple",label:"قلع بسيط",color:"#6b7280",category:"العلاجات الجراحية"},{value:"extraction_surgical",label:"قلع جراحي",color:"#4b5563",category:"العلاجات الجراحية"},{value:"implant",label:"زراعة",color:"#10b981",category:"العلاجات الجراحية"},{value:"bone_graft",label:"ترقيع عظم",color:"#059669",category:"العلاجات الجراحية"},{value:"sinus_lift",label:"رفع الجيب الفكي",color:"#047857",category:"العلاجات الجراحية"},{value:"gum_surgery",label:"جراحة لثة",color:"#065f46",category:"العلاجات الجراحية"},{value:"apical_resection",label:"قطع ذروة",color:"#374151",category:"العلاجات الجراحية"},{value:"veneer_porcelain",label:"قشرة خزفية",color:"#ec4899",category:"العلاجات التجميلية"},{value:"veneer_composite",label:"قشرة مركبة",color:"#f472b6",category:"العلاجات التجميلية"},{value:"whitening",label:"تبييض",color:"#fbbf24",category:"العلاجات التجميلية"},{value:"bonding",label:"ربط تجميلي",color:"#f59e0b",category:"العلاجات التجميلية"},{value:"contouring",label:"تشكيل تجميلي",color:"#d97706",category:"العلاجات التجميلية"},{value:"polish",label:"بوليش",color:"#eab308",category:"العلاجات التجميلية"},{value:"orthodontic_metal",label:"تقويم معدني",color:"#6366f1",category:"علاجات التقويم"},{value:"orthodontic_ceramic",label:"تقويم خزفي",color:"#8b5cf6",category:"علاجات التقويم"},{value:"orthodontic_clear",label:"تقويم شفاف",color:"#a855f7",category:"علاجات التقويم"},{value:"retainer",label:"مثبت",color:"#7c3aed",category:"علاجات التقويم"},{value:"space_maintainer",label:"حافظ مسافة",color:"#5b21b6",category:"علاجات التقويم"},{value:"scaling_periodontal",label:"تقليح",color:"#0891b2",category:"علاجات اللثة"},{value:"subgingival_scaling",label:"تقليح تحت لثوي",color:"#0e7490",category:"علاجات اللثة"},{value:"deep_cleaning",label:"تنظيف عميق",color:"#0891b2",category:"علاجات اللثة"},{value:"root_planing",label:"تسوية الجذور",color:"#0e7490",category:"علاجات اللثة"},{value:"gum_graft",label:"ترقيع لثة",color:"#155e75",category:"علاجات اللثة"},{value:"pocket_reduction",label:"تقليل الجيوب",color:"#164e63",category:"علاجات اللثة"},{value:"pediatric_filling",label:"حشوة",color:"#f472b6",category:"علاجات الأطفال"},{value:"pulp_amputation",label:"بتر لب",color:"#ec4899",category:"علاجات الأطفال"},{value:"pediatric_pulp_treatment",label:"معالجة لبية",color:"#db2777",category:"علاجات الأطفال"},{value:"pulp_therapy_pediatric",label:"علاج عصب لبني",color:"#f472b6",category:"علاجات الأطفال"},{value:"stainless_crown",label:"تاج ستانلس",color:"#9ca3af",category:"علاجات الأطفال"},{value:"space_maintainer_fixed",label:"حافظ مسافة ثابت",color:"#6b7280",category:"علاجات الأطفال"},{value:"space_maintainer_removable",label:"حافظ مسافة متحرك",color:"#4b5563",category:"علاجات الأطفال"},{value:"crown_metal",label:"تاج معدني",color:"#6b7280",category:"التعويضات"},{value:"crown_ceramic",label:"تاج خزفي",color:"#8b5cf6",category:"التعويضات"},{value:"crown_zirconia",label:"تاج زيركونيا",color:"#a855f7",category:"التعويضات"},{value:"bridge",label:"جسر",color:"#f59e0b",category:"التعويضات"},{value:"complete_denture_acrylic",label:"جهاز متحرك كامل أكريل",color:"#94a3b8",category:"التعويضات"},{value:"partial_denture_acrylic",label:"جهاز متحرك جزئي أكريل",color:"#64748b",category:"التعويضات"},{value:"complete_denture_vitalium",label:"جهاز متحرك كامل فيتاليوم",color:"#475569",category:"التعويضات"},{value:"partial_denture_vitalium",label:"جهاز متحرك جزئي فيتاليوم",color:"#334155",category:"التعويضات"},{value:"complete_denture_flexible",label:"جهاز متحرك كامل مرن",color:"#e879f9",category:"التعويضات"},{value:"partial_denture_flexible",label:"جهاز متحرك جزئي مرن",color:"#d946ef",category:"التعويضات"},{value:"implant_crown_zirconia",label:"تعويض زركونيا فوق زرعة",color:"#a855f7",category:"التعويضات"},{value:"implant_crown_ceramic",label:"تعويض خزف فوق زرعة",color:"#8b5cf6",category:"التعويضات"},{value:"cast_post_core",label:"قلب ووتد مصبوب معدني",color:"#6b7280",category:"التعويضات"},{value:"zirconia_post_core",label:"قلب ووتد زركونيا",color:"#a855f7",category:"التعويضات"},{value:"veneer",label:"فينير",color:"#a855f7",category:"التعويضات"}],ed=[{value:"العلاجات الوقائية",label:"العلاجات الوقائية",color:"#22c55e",icon:"🛡️"},{value:"الترميمية (المحافظة)",label:"الترميمية (المحافظة)",color:"#f97316",icon:"🔧"},{value:"علاج العصب",label:"علاج العصب",color:"#ef4444",icon:"🦷"},{value:"العلاجات الجراحية",label:"العلاجات الجراحية",color:"#6b7280",icon:"⚔️"},{value:"العلاجات التجميلية",label:"العلاجات التجميلية",color:"#ec4899",icon:"✨"},{value:"علاجات التقويم",label:"علاجات التقويم",color:"#6366f1",icon:"📐"},{value:"علاجات اللثة",label:"علاجات اللثة",color:"#0891b2",icon:"🌿"},{value:"علاجات الأطفال",label:"علاجات الأطفال",color:"#f472b6",icon:"👶"},{value:"التعويضات",label:"التعويضات",color:"#8b5cf6",icon:"👑"}],td=e=>Jo.filter(t=>t.category===e),nd=e=>Jo.find(t=>t.value===e),ad=e=>{const t=nd(e);return t?t.label:e},sd=e=>{if(e&&(e.includes("العلاجات")||e.includes("علاج")||e.includes("التعويضات")))return e;return{preventive:"العلاجات الوقائية",restorative:"الترميمية (المحافظة)",endodontic:"علاج العصب",surgical:"العلاجات الجراحية",cosmetic:"العلاجات التجميلية",orthodontic:"علاجات التقويم",periodontal:"علاجات اللثة",pediatric:"علاجات الأطفال",prosthetic:"التعويضات"}[e]||e},rd=[{value:"planned",label:"مخطط",color:"#3b82f6"},{value:"in_progress",label:"قيد التنفيذ",color:"#eab308"},{value:"completed",label:"مكتمل",color:"#22c55e"},{value:"cancelled",label:"ملغي",color:"#6b7280"}],id=[{value:"before",label:"قبل العلاج",icon:"📷"},{value:"after",label:"بعد العلاج",icon:"✨"},{value:"xray",label:"أشعة سينية",icon:"🦴"},{value:"clinical",label:"صورة سريرية",icon:"🔬"}];let ld={},od=!1;const dd=()=>m(void 0,null,function*(){var e,t;if(!od){od=!0;try{if(null==(t=null==(e=window.electronAPI)?void 0:e.treatments)?void 0:t.getAll){const e=yield window.electronAPI.treatments.getAll();e&&Array.isArray(e)&&e.forEach(e=>{e.id&&e.name&&(ld[e.id]=e.name)})}}catch(n){console.warn("خطأ في تحميل العلاجات المخصصة:",n)}finally{od=!1}}}),cd=()=>m(void 0,null,function*(){ld={},yield dd()}),ud=e=>{if(!e)return"غير محدد";const t=nd(e);return t?t.label:ld[n=e]?ld[n]:(od||0!==Object.keys(ld).length||dd(),n);var n},md=e=>{if(!e)return"غير محدد";if(e&&(e.includes("العلاجات")||e.includes("علاج")||e.includes("التعويضات")))return e;return{preventive:"العلاجات الوقائية",restorative:"الترميمية (المحافظة)",endodontic:"علاج العصب",surgical:"العلاجات الجراحية",cosmetic:"العلاجات التجميلية",orthodontic:"علاجات التقويم",periodontal:"علاجات اللثة",pediatric:"علاجات الأطفال",prosthetic:"التعويضات"}[e]||e},pd=e=>{if(!e)return"غير محدد";return{planned:"مخطط",in_progress:"قيد التنفيذ",completed:"مكتمل",cancelled:"ملغي",pending:"معلق",active:"نشط",inactive:"غير نشط"}[e]||e},hd=e=>{if(!e)return"غير محدد";return{pending:"معلق",completed:"مكتمل",partial:"جزئي",cancelled:"ملغي",refunded:"مسترد"}[e]||e};function xd({open:e,onOpenChange:t,preSelectedPatientId:n}){const{toast:a}=yl(),{createPayment:s,updatePayment:r,isLoading:i,getPaymentsByPatient:l,getPaymentsByAppointment:c,getPaymentsByToothTreatment:u}=Go(),{patients:h}=cl(),{appointments:x}=Wo(),{toothTreatments:g,loadToothTreatmentsByPatient:f}=Ko(),{formatAmount:v}=Sa(),[y,b]=ve.useState({patient_id:"",tooth_treatment_id:"none",appointment_id:"none",amount:"",payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:"",receipt_number:"",status:"completed",notes:"",discount_amount:"",tax_amount:"",total_amount_due:"",amount_paid:""}),[j,w]=ve.useState({}),[N,_]=ve.useState({previousPayments:0,suggestedReceiptNumber:"",isCalculating:!1}),k=()=>{const e=new Date;return`RCP-${e.getFullYear().toString().slice(-2)}${(e.getMonth()+1).toString().padStart(2,"0")}${e.getDate().toString().padStart(2,"0")}-${e.getTime().toString().slice(-4)}`},S=()=>parseFloat(y.total_amount_due)||0,D=()=>{const e=parseFloat(y.amount)||0;return N.previousPayments+e},$=()=>{const e=parseFloat(y.total_amount_due)||0,t=D();return Math.max(0,e-t)},C=()=>{const e=y.amount?parseFloat(y.amount):0,t=y.total_amount_due?parseFloat(y.total_amount_due):0;if(t>0){if(y.tooth_treatment_id&&"none"!==y.tooth_treatment_id){const n=N.previousPayments+e;return n>=t?"completed":n>0?"partial":"pending"}if(y.appointment_id&&"none"!==y.appointment_id){const n=N.previousPayments+e;return n>=t?"completed":n>0?"partial":"pending"}{const e=D();return e>=t?"completed":e>0?"partial":"pending"}}return e>0?"completed":"pending"};ve.useEffect(()=>{if(y.tooth_treatment_id&&"none"!==y.tooth_treatment_id){_(e=>d(o({},e),{isCalculating:!0}));const t=g.find(e=>e.id===y.tooth_treatment_id),n=(null==t?void 0:t.cost)||0,a=(e=y.tooth_treatment_id)&&"none"!==e?u(e).reduce((e,t)=>e+t.amount,0):0,s=k();_({previousPayments:a,suggestedReceiptNumber:s,isCalculating:!1}),b(e=>d(o({},e),{total_amount_due:n.toString(),amount:Math.max(0,n-a).toString(),receipt_number:e.receipt_number||s}))}var e},[y.tooth_treatment_id,g,u]),ve.useEffect(()=>{var e,t;if(y.appointment_id&&"none"!==y.appointment_id){_(e=>d(o({},e),{isCalculating:!0}));const n=(t=y.appointment_id)&&"none"!==t?c(t).reduce((e,t)=>e+t.amount,0):0,a=k(),s=null==(e=c(y.appointment_id).find(e=>e.total_amount_due))?void 0:e.total_amount_due;_({previousPayments:n,suggestedReceiptNumber:a,isCalculating:!1}),y.receipt_number||b(e=>d(o({},e),{receipt_number:a})),!y.total_amount_due&&s&&b(e=>d(o({},e),{total_amount_due:s.toString()}))}else _(e=>d(o({},e),{previousPayments:0,suggestedReceiptNumber:k()}))},[y.appointment_id]),ve.useEffect(()=>{if(y.amount&&N.previousPayments>=0){const e=D();b(t=>d(o({},t),{amount_paid:e.toString()}))}},[y.amount,N.previousPayments]),ve.useEffect(()=>{e||(b({patient_id:"",tooth_treatment_id:"none",appointment_id:"none",amount:"",payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:"",receipt_number:"",status:"completed",notes:"",discount_amount:"",tax_amount:"",total_amount_due:"",amount_paid:""}),w({}),_({previousPayments:0,suggestedReceiptNumber:"",isCalculating:!1}))},[e]),ve.useEffect(()=>{e&&n&&b(e=>d(o({},e),{patient_id:n}))},[e,n]),ve.useEffect(()=>{y.patient_id&&""!==y.patient_id&&f(y.patient_id)},[y.patient_id,f]),ve.useEffect(()=>{const e=y.amount?parseFloat(y.amount):0;if((y.total_amount_due?parseFloat(y.total_amount_due):0)>0||e>0){const e=C();b(t=>d(o({},t),{status:e}))}},[y.amount,y.total_amount_due,y.tooth_treatment_id,y.appointment_id,N.previousPayments]);const E=x.filter(e=>e.patient_id===y.patient_id),T=g.filter(e=>{if(e.patient_id!==y.patient_id)return!1;const t=u(e.id),n=e.cost||0;if(0===t.length)return!0;return t.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+t.amount,0)<n});return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-background border-border shadow-2xl",dir:"rtl",children:[p.jsxs(Vi,{className:"border-b border-border pb-4",children:[p.jsxs(Ui,{className:"flex items-center text-xl font-semibold text-foreground",children:[p.jsx($r,{className:"w-5 h-5 ml-2 text-primary"}),"تسجيل دفعة جديدة"]}),p.jsx(Hi,{className:"text-muted-foreground",children:"أدخل تفاصيل الدفعة الجديدة وتتبع المدفوعات"})]}),p.jsxs("form",{onSubmit:e=>m(this,null,function*(){if(e.preventDefault(),console.log("🚀 Starting form submission..."),console.log("📝 Current form data:",y),(()=>{const e={};y.patient_id||(e.patient_id="يرجى اختيار المريض");const t=y.amount?parseFloat(y.amount):0,n=y.total_amount_due?parseFloat(y.total_amount_due):0;if(t<0?e.amount="المبلغ لا يمكن أن يكون سالباً":0===t&&0===n&&(e.amount="يرجى إدخال مبلغ صحيح أو مبلغ إجمالي مطلوب"),y.payment_date||(e.payment_date="يرجى اختيار تاريخ الدفع"),y.total_amount_due&&parseFloat(y.total_amount_due)<=0&&(e.total_amount_due="المبلغ الإجمالي المطلوب يجب أن يكون أكبر من صفر"),console.log("🔍 Validation check:",{total_amount_due:y.total_amount_due,amount:y.amount,patient_id:y.patient_id,payment_method:y.payment_method,errors:e}),y.tooth_treatment_id&&"none"!==y.tooth_treatment_id){const a=n-N.previousPayments;n>0&&t>a&&(e.amount=`مبلغ هذه الدفعة لا يمكن أن يكون أكبر من المبلغ المتبقي (${v(a)})`),t<=0&&n>0&&(e.amount="يجب أن يكون مبلغ الدفعة أكبر من صفر")}else if(y.appointment_id&&"none"!==y.appointment_id){const a=n-N.previousPayments;n>0&&t>a&&(e.amount=`مبلغ هذه الدفعة لا يمكن أن يكون أكبر من المبلغ المتبقي (${a.toFixed(2)} $)`)}else{const t=D();n>0&&t>n&&(e.amount="إجمالي المدفوعات لا يمكن أن يتجاوز المبلغ الإجمالي المطلوب")}return w(e),0===Object.keys(e).length})()){console.log("✅ Form validation passed");try{const e=y.amount?parseFloat(y.amount):0,i=y.discount_amount?parseFloat(y.discount_amount):0,l=y.tax_amount?parseFloat(y.tax_amount):0,o=e+l-i,d=y.status,c={patient_id:y.patient_id,appointment_id:y.appointment_id&&"none"!==y.appointment_id?y.appointment_id:void 0,amount:e,payment_method:y.payment_method,payment_date:y.payment_date,description:y.description||void 0,receipt_number:y.receipt_number||N.suggestedReceiptNumber,status:d,notes:y.notes||void 0,discount_amount:i>0?i:void 0,tax_amount:l>0?l:void 0,total_amount:o},m=y.total_amount_due?parseFloat(y.total_amount_due):o;if(c.total_amount_due=m,y.tooth_treatment_id&&"none"!==y.tooth_treatment_id){c.tooth_treatment_id=y.tooth_treatment_id,c.treatment_total_cost=m;const e=D(),t=m-e;c.treatment_total_paid=e,c.treatment_remaining_balance=t}else if(y.appointment_id&&"none"!==y.appointment_id){c.appointment_total_cost=m;const e=D(),t=m-e;c.amount_paid=e,c.remaining_balance=t}else{const e=D(),t=m-e;c.amount_paid=e,c.remaining_balance=t}let p;if(console.log("💰 Submitting payment data:",c),console.log("📊 Form data before submit:",y),console.log("🔍 Total amount due being sent:",m),console.log("🔍 Payment data total_amount_due:",c.total_amount_due),y.tooth_treatment_id&&"none"!==y.tooth_treatment_id){const t=u(y.tooth_treatment_id);if(t.length>0){const n=t.find(e=>"pending"===e.status)||t[0],a=n.amount+e;let s;s=a>=m?"completed":a>0?"partial":"pending";const o={amount:a,payment_method:y.payment_method,payment_date:y.payment_date,description:y.description||n.description,receipt_number:y.receipt_number||N.suggestedReceiptNumber||n.receipt_number,status:s,notes:y.notes||n.notes,discount_amount:i>0?i:n.discount_amount,tax_amount:l>0?l:n.tax_amount,total_amount:a+(l||0)-(i||0),total_amount_due:m,treatment_total_cost:m,treatment_total_paid:a,treatment_remaining_balance:Math.max(0,m-a)};console.log("🔄 Updating existing payment for treatment:",n.id,o),p=yield r(n.id,o),console.log("✅ Payment updated successfully:",p)}else p=yield s(c),console.log("✅ Payment created successfully:",p)}else p=yield s(c),console.log("✅ Payment created successfully:",p);const h=y.tooth_treatment_id&&"none"!==y.tooth_treatment_id&&u(y.tooth_treatment_id).length>0;a({title:"تم بنجاح",description:h?"تم تحديث الدفعة الموجودة بنجاح":"تم تسجيل الدفعة بنجاح"}),b({patient_id:n||"",tooth_treatment_id:"none",appointment_id:"none",amount:"",payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:"",receipt_number:"",status:"completed",notes:"",discount_amount:"",tax_amount:"",total_amount_due:"",amount_paid:""}),t(!1)}catch(i){console.error("❌ Failed to submit payment:",i),a({title:"خطأ",description:i instanceof Error?i.message:"فشل في تسجيل الدفعة",variant:"destructive"})}}else console.log("❌ Form validation failed")}),className:"space-y-6",children:[p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(ui,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات المريض"]})}),p.jsx(Yo,{className:"space-y-4",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-foreground font-medium",children:"المريض *"}),p.jsxs(el,{value:y.patient_id,onValueChange:e=>b(t=>d(o({},t),{patient_id:e,appointment_id:"none"})),children:[p.jsx(al,{className:j.patient_id?"border-destructive bg-background text-foreground":"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر المريض",className:"text-muted-foreground"})}),p.jsx(il,{children:h.map(e=>p.jsx(dl,{value:e.id,children:e.full_name},e.id))})]}),j.patient_id&&p.jsx("p",{className:"text-sm text-destructive",children:j.patient_id})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-foreground font-medium",children:"العلاج *"}),p.jsxs(el,{value:y.tooth_treatment_id,onValueChange:e=>b(t=>d(o({},t),{tooth_treatment_id:e,appointment_id:"none"})),disabled:!y.patient_id,children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر العلاج",className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"none",children:"بدون علاج محدد"}),T.map(e=>{const t=u(e.id),n=e.cost||0,a=n-t.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+t.amount,0);return p.jsx(dl,{value:e.id,children:p.jsxs("div",{className:"flex flex-col",children:[p.jsx("span",{children:`السن ${e.tooth_number} - ${ud(e.treatment_type)}`}),p.jsxs("div",{className:"text-xs text-muted-foreground",children:[p.jsxs("span",{children:["التكلفة: ",v(n)]}),a>0&&a<n&&p.jsxs("span",{className:"text-orange-600 font-medium",children:[" • متبقي: ",v(a)]})]})]})},e.id)})]})]})]}),p.jsxs("div",{className:"space-y-2 hidden",children:[p.jsx(Ro,{className:"text-foreground font-medium",children:"الموعد (اختياري)"}),p.jsxs(el,{value:y.appointment_id,onValueChange:e=>b(t=>d(o({},t),{appointment_id:e,tooth_treatment_id:"none"!==e?"none":t.tooth_treatment_id})),disabled:!y.patient_id,children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر الموعد",className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"none",children:"بدون موعد محدد"}),E.map(e=>p.jsxs(dl,{value:e.id,children:[e.title," - ",ma(e.start_time)]},e.id))]})]})]})]})})]}),p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(Er,{className:"w-4 h-4 ml-2 text-primary"}),"تفاصيل المبالغ"]})}),p.jsx(Yo,{children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-foreground font-medium",children:"المبلغ *"}),p.jsx(Xi,{type:"number",step:"1",min:"0",placeholder:"0.00",value:y.amount,onChange:e=>b(t=>d(o({},t),{amount:e.target.value})),onBlur:e=>{const t=parseFloat(e.target.value)||0;b(e=>d(o({},e),{amount:t.toString()}))},onKeyDown:e=>{e.stopPropagation()},"data-prevent-shortcuts":"true",className:j.amount?"border-destructive bg-background text-foreground":"bg-background border-input text-foreground"}),j.amount&&p.jsx("p",{className:"text-sm text-destructive",children:j.amount})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-foreground font-medium",children:"مبلغ الخصم"}),p.jsx(Xi,{type:"number",step:"1",min:"0",placeholder:"0.00",value:y.discount_amount,onChange:e=>b(t=>d(o({},t),{discount_amount:e.target.value})),onBlur:e=>{const t=parseFloat(e.target.value)||0;b(e=>d(o({},e),{discount_amount:t.toString()}))},className:"bg-background border-input text-foreground"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-foreground font-medium",children:"مبلغ الضريبة"}),p.jsx(Xi,{type:"number",step:"1",min:"0",placeholder:"0.00",value:y.tax_amount,onChange:e=>b(t=>d(o({},t),{tax_amount:e.target.value})),onBlur:e=>{const t=parseFloat(e.target.value)||0;b(e=>d(o({},e),{tax_amount:t.toString()}))},className:"bg-background border-input text-foreground"})]})]})})]}),p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx($r,{className:"w-4 h-4 ml-2 text-primary"}),"تفاصيل الدفع"]})}),p.jsx(Yo,{children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-foreground font-medium",children:"طريقة الدفع"}),p.jsxs(el,{value:y.payment_method,onValueChange:e=>b(t=>d(o({},t),{payment_method:e})),children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر طريقة الدفع",className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"cash",children:"نقداً"}),p.jsx(dl,{value:"bank_transfer",children:"تحويل بنكي"})]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-foreground font-medium",children:"تاريخ الدفع *"}),p.jsx(Xi,{type:"date",value:y.payment_date,onChange:e=>b(t=>d(o({},t),{payment_date:e.target.value})),className:j.payment_date?"border-destructive bg-background text-foreground":"bg-background border-input text-foreground"}),j.payment_date&&p.jsx("p",{className:"text-sm text-destructive",children:j.payment_date})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"text-foreground font-medium",children:["الحالة",y.amount&&parseFloat(y.amount)>0&&p.jsxs("span",{className:"text-xs text-muted-foreground mr-2",children:["(مقترح: ","completed"===C()?"مكتمل":"partial"===C()?"جزئي":"معلق",")"]})]}),p.jsxs(el,{value:y.status,onValueChange:e=>b(t=>d(o({},t),{status:e})),children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر الحالة",className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"completed",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:"مكتمل"}),"completed"===C()&&p.jsx("span",{className:"text-xs text-green-600",children:"✓ مقترح"})]})}),p.jsx(dl,{value:"partial",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:"جزئي"}),"partial"===C()&&p.jsx("span",{className:"text-xs text-orange-600",children:"✓ مقترح"})]})}),p.jsx(dl,{value:"pending",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:"معلق"}),"pending"===C()&&p.jsx("span",{className:"text-xs text-blue-600",children:"✓ مقترح"})]})})]})]})]})]})})]}),p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(vi,{className:"w-4 h-4 ml-2 text-primary"}),"تتبع المدفوعات للموعد"]}),p.jsx(Bo,{className:"text-muted-foreground",children:"تتبع دقيق للمدفوعات والرصيد المتبقي لكل موعد على حدة"})]}),p.jsxs(Yo,{className:"space-y-4",children:[y.appointment_id&&"none"!==y.appointment_id&&p.jsx(Lo,{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/50 dark:to-blue-900/30 border-blue-200 dark:border-blue-800 shadow-sm transition-all duration-200",children:p.jsxs(Yo,{className:"p-4",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[p.jsx(vi,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),p.jsx("span",{className:"text-sm font-medium text-primary",children:"ملخص مدفوعات الموعد"})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-muted-foreground",children:"المبلغ الإجمالي المطلوب:"}),p.jsxs("span",{className:"font-medium text-foreground",children:[S().toFixed(2)," $"]})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-muted-foreground",children:"المدفوع سابقاً:"}),p.jsxs("span",{className:"font-medium text-foreground",children:[N.previousPayments.toFixed(2)," $"]})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-muted-foreground",children:"المتبقي قبل هذه الدفعة:"}),p.jsxs("span",{className:"font-medium text-emerald-600 dark:text-emerald-400",children:[(S()-N.previousPayments).toFixed(2)," $"]})]})]}),y.amount&&p.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200 dark:border-blue-700",children:p.jsxs("div",{className:"flex justify-between text-sm",children:[p.jsx("span",{className:"text-muted-foreground",children:"المتبقي بعد هذه الدفعة:"}),p.jsxs("span",{className:"font-bold text-lg text-emerald-600 dark:text-emerald-400",children:[$().toFixed(2)," $"]})]})})]})}),"none"===y.appointment_id&&p.jsx(Lo,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-950/50 dark:to-yellow-900/30 border-yellow-200 dark:border-yellow-800 shadow-sm transition-all duration-200",children:p.jsxs(Yo,{className:"p-4",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx(ar,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),p.jsx("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"دفعة عامة غير مرتبطة بموعد"})]}),p.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"هذه دفعة عامة غير مرتبطة بموعد محدد، يمكنك تحديد المبلغ المطلوب يدوياً"})]})}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"flex items-center gap-2 text-foreground font-medium",children:["المبلغ الإجمالي المطلوب",p.jsx(qo,{variant:"secondary",className:"text-xs",children:"اختياري"})]}),p.jsx(Xi,{type:"number",step:"1",placeholder:"أدخل المبلغ الإجمالي المطلوب (اختياري)",value:y.total_amount_due,onChange:e=>b(t=>d(o({},t),{total_amount_due:e.target.value})),onBlur:e=>{const t=parseFloat(e.target.value)||0;b(e=>d(o({},e),{total_amount_due:t.toString()}))},className:"bg-background border-input text-foreground "+(j.total_amount_due?"border-destructive":"")}),j.total_amount_due&&p.jsx("p",{className:"text-sm text-destructive",children:j.total_amount_due}),!j.total_amount_due&&p.jsx("p",{className:"text-xs text-muted-foreground",children:"💡 إدخال المبلغ الإجمالي يساعد في تتبع المدفوعات الجزئية"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"flex items-center gap-2 text-foreground font-medium",children:["إجمالي المبلغ المدفوع",p.jsxs(qo,{variant:"secondary",className:"text-xs",children:[p.jsx(vi,{className:"w-3 h-3 ml-1"}),"محسوب تلقائياً"]})]}),p.jsx(Xi,{type:"number",step:"1",placeholder:"0.00",value:y.amount_paid,readOnly:!0,className:"bg-muted cursor-not-allowed border-input text-foreground font-medium"}),p.jsxs("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium",children:["✓ محسوب تلقائياً: المدفوعات السابقة (",v(N.previousPayments),") + هذه الدفعة (",v(parseFloat(y.amount)||0),")"]})]})]}),y.total_amount_due&&p.jsx(Lo,{className:"shadow-sm transition-all duration-200 "+($()>0?"bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-950/50 dark:to-orange-900/30 border-orange-200 dark:border-orange-800":"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950/50 dark:to-green-900/30 border-green-200 dark:border-green-800"),children:p.jsxs(Yo,{className:"p-4",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm font-medium text-foreground",children:"المبلغ المتبقي:"}),p.jsxs(qo,{variant:$()>0?"destructive":"default",className:"text-lg px-3 py-1",children:["$",$().toFixed(2)]})]}),0===$()&&p.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium mt-2",children:"✓ تم سداد المبلغ بالكامل"})]})}),p.jsxs(Lo,{className:"bg-gradient-to-r from-muted/30 to-muted/50 border-border",children:[p.jsx(Io,{children:p.jsx(zo,{className:"text-sm text-card-foreground",children:"ملخص هذه الدفعة"})}),p.jsxs(Yo,{className:"space-y-2 text-sm",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-muted-foreground",children:"المبلغ الأساسي:"}),p.jsxs("span",{className:"font-medium text-foreground",children:["$",(parseFloat(y.amount)||0).toFixed(2)]})]}),y.tax_amount&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-muted-foreground",children:"الضريبة:"}),p.jsxs("span",{className:"text-orange-600 dark:text-orange-400 font-medium",children:["+$",(parseFloat(y.tax_amount)||0).toFixed(2)]})]}),y.discount_amount&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-muted-foreground",children:"الخصم:"}),p.jsxs("span",{className:"text-emerald-600 dark:text-emerald-400 font-medium",children:["-$",(parseFloat(y.discount_amount)||0).toFixed(2)]})]}),p.jsxs("div",{className:"flex justify-between font-medium border-t border-border pt-2",children:[p.jsx("span",{className:"text-foreground",children:"إجمالي هذه الدفعة:"}),p.jsxs(qo,{variant:"outline",className:"text-base",children:["$",((parseFloat(y.amount)||0)+(parseFloat(y.tax_amount)||0)-(parseFloat(y.discount_amount)||0)).toFixed(2)]})]})]})]})]})]}),p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{children:p.jsx(zo,{className:"text-lg text-card-foreground",children:"معلومات إضافية"})}),p.jsxs(Yo,{className:"space-y-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"flex items-center gap-2 text-foreground",children:["رقم الإيصال",p.jsxs(qo,{variant:"secondary",className:"text-xs",children:[p.jsx(vi,{className:"w-3 h-3 ml-1"}),"مولد تلقائياً"]})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(Xi,{type:"text",placeholder:"رقم الإيصال",value:y.receipt_number,onChange:e=>b(t=>d(o({},t),{receipt_number:e.target.value})),className:"flex-1 bg-background border-input text-foreground"}),p.jsx(Qi,{type:"button",variant:"outline",size:"sm",onClick:()=>b(e=>d(o({},e),{receipt_number:k()})),className:"px-3",children:p.jsx(vi,{className:"w-4 h-4"})})]}),p.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium",children:"✓ تم توليد رقم إيصال فريد تلقائياً"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-foreground",children:"الوصف"}),p.jsx(Ji,{placeholder:"وصف الدفعة (اختياري)",value:y.description,onChange:e=>b(t=>d(o({},t),{description:e.target.value})),rows:2,className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-foreground",children:"ملاحظات"}),p.jsx(Ji,{placeholder:"ملاحظات إضافية (اختياري)",value:y.notes,onChange:e=>b(t=>d(o({},t),{notes:e.target.value})),rows:2,className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})]})]})]}),p.jsxs(qi,{className:"flex justify-end space-x-2 space-x-reverse border-t border-border pt-4",children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:i,children:"إلغاء"}),p.jsx(Qi,{type:"submit",disabled:i,className:"bg-primary hover:bg-primary/90 text-primary-foreground",children:i?"جاري الحفظ...":"حفظ الدفعة"})]})]})]})})}const gd=[{key:"F1",description:"الإعدادات"},{key:"A/ش",description:"مريض جديد"},{key:"S/س",description:"موعد جديد"},{key:"D/ي",description:"دفعة جديدة"},{key:"R/ق",description:"تحديث"},{key:"F/ب",description:"بحث"},{key:"0-9",description:"تنقل سريع"}];function fd({className:e}){const{isDarkMode:t}=Gt(),[n,a]=ve.useState(0),[s,r]=ve.useState(!0),[i,l]=ve.useState(!1);if(ve.useEffect(()=>{if(!s||i)return;const e=setInterval(()=>{a(e=>(e+1)%gd.length)},3e3);return()=>clearInterval(e)},[s,i]),!s)return null;const o=gd[n];return p.jsxs("div",{className:aa("flex items-center gap-2 px-3 py-1.5 rounded-lg border transition-all duration-300",t?"bg-gradient-to-r from-blue-950/30 to-indigo-950/30 border-blue-800/50 shadow-lg shadow-blue-900/20":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200 shadow-sm",e),onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[p.jsx(Vr,{className:"w-3 h-3 "+(t?"text-blue-400":"text-blue-600")}),p.jsx("span",{className:"text-xs font-medium "+(t?"text-blue-300":"text-blue-700"),children:"نصيحة:"}),p.jsx(qo,{variant:"secondary",className:aa("text-xs px-1.5 py-0.5 font-mono",t?"bg-blue-900/50 text-blue-200 border-blue-700/50":"bg-blue-100 text-blue-800 border-blue-300"),children:o.key}),p.jsx("span",{className:"text-xs "+(t?"text-blue-300":"text-blue-700"),children:o.description}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>r(!1),className:aa("h-4 w-4 p-0 ml-1 transition-colors",t?"text-blue-400 hover:text-blue-200 hover:bg-blue-900/30":"text-blue-500 hover:text-blue-700 hover:bg-blue-100"),children:p.jsx(Mi,{className:"w-3 h-3"})})]})}const vd=e=>{const t="transition-all duration-200 hover:shadow-lg border rounded-lg";switch(e){case"green":return`${t} card-green`;case"yellow":return`${t} card-yellow`;case"orange":return`${t} card-orange`;case"red":return`${t} card-red`;case"blue":return`${t} card-blue`;case"purple":return`${t} card-purple`;case"emerald":return`${t} card-emerald`;case"cyan":return`${t} card-cyan`;case"indigo":return`${t} card-indigo`;case"pink":return`${t} bg-pink-50 dark:bg-pink-950 border-pink-200 dark:border-pink-800`;case"slate":return`${t} bg-slate-50 dark:bg-slate-950 border-slate-200 dark:border-slate-800`;default:return`${t} card-gray`}},yd=e=>{switch(e){case"green":return"text-green-700 dark:text-green-300";case"yellow":return"text-yellow-700 dark:text-yellow-300";case"orange":return"text-orange-700 dark:text-orange-300";case"red":return"text-red-700 dark:text-red-300";case"blue":return"text-blue-700 dark:text-blue-300";case"purple":return"text-purple-700 dark:text-purple-300";case"emerald":return"text-emerald-700 dark:text-emerald-300";case"cyan":return"text-cyan-700 dark:text-cyan-300";case"indigo":return"text-indigo-700 dark:text-indigo-300";case"pink":return"text-pink-700 dark:text-pink-300";case"slate":return"text-slate-700 dark:text-slate-300";default:return"text-gray-700 dark:text-gray-300"}},bd=Ne()(Lt((e,t)=>("undefined"!=typeof window&&window.addEventListener("patient-deleted",e=>m(void 0,null,function*(){console.log("📊 Dashboard: Patient deleted, refreshing stats..."),yield t().refreshStats()})),{stats:{totalPatients:0,totalAppointments:0,totalRevenue:0,pendingPayments:0,todayAppointments:0,thisMonthRevenue:0,lowStockItems:0},isLoading:!1,error:null,lastUpdated:null,loadStats:()=>m(void 0,null,function*(){var t,n;e({isLoading:!0,error:null});try{const a=(yield null==(n=null==(t=window.electronAPI)?void 0:t.dashboard)?void 0:n.getStats())||{totalPatients:0,totalAppointments:0,totalRevenue:0,pendingPayments:0,todayAppointments:0,thisMonthRevenue:0,lowStockItems:0};e({stats:a,isLoading:!1,lastUpdated:new Date})}catch(a){console.error("Error loading dashboard stats:",a),e({error:a instanceof Error?a.message:"Failed to load dashboard stats",isLoading:!1})}}),updateStats:n=>{const{stats:a}=t();e({stats:o(o({},a),n),lastUpdated:new Date})},clearError:()=>{e({error:null})},refreshStats:()=>m(void 0,null,function*(){var n,a;try{const s=(yield null==(a=null==(n=window.electronAPI)?void 0:n.dashboard)?void 0:a.getStats())||t().stats;e({stats:s,lastUpdated:new Date}),console.log("📊 Dashboard stats refreshed after patient deletion")}catch(s){console.error("Error refreshing dashboard stats:",s)}})}),{name:"dashboard-store"})),jd=Ne()(Lt((e,t)=>({items:[],filteredItems:[],usage:[],selectedItem:null,isLoading:!1,error:null,searchQuery:"",filters:{},categories:[],suppliers:[],totalItems:0,totalValue:0,lowStockCount:0,expiredCount:0,expiringSoonCount:0,loadItems:()=>m(void 0,null,function*(){var n,a;e({isLoading:!0,error:null});try{const s=(yield null==(a=null==(n=window.electronAPI)?void 0:n.inventory)?void 0:a.getAll())||[];e({items:s,filteredItems:s,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems()}catch(s){console.error("Error loading inventory items:",s),e({error:s instanceof Error?s.message:"Failed to load inventory items",isLoading:!1})}}),createItem:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield window.electronAPI.inventory.create(n),{items:s}=t(),r=[...s,a];e({items:r,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("inventory-changed",{detail:{type:"created",itemId:a.id,item:a}})),window.dispatchEvent(new CustomEvent("inventory-added",{detail:{type:"created",itemId:a.id,item:a}})))}catch(a){console.error("Error creating inventory item:",a),e({error:a instanceof Error?a.message:"Failed to create inventory item",isLoading:!1})}}),updateItem:(n,a)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const s=yield window.electronAPI.inventory.update(n,a),{items:r,selectedItem:i}=t(),l=r.map(e=>e.id===n?s:e);e({items:l,selectedItem:(null==i?void 0:i.id)===n?s:i,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("inventory-changed",{detail:{type:"updated",itemId:n,item:s}})),window.dispatchEvent(new CustomEvent("inventory-updated",{detail:{type:"updated",itemId:n,item:s}})))}catch(s){console.error("Error updating inventory item:",s),e({error:s instanceof Error?s.message:"Failed to update inventory item",isLoading:!1})}}),deleteItem:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{if(!(yield window.electronAPI.inventory.delete(n)))throw new Error("Failed to delete inventory item");{const{items:a,selectedItem:s}=t(),r=a.filter(e=>e.id!==n);e({items:r,selectedItem:(null==s?void 0:s.id)===n?null:s,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("inventory-changed",{detail:{type:"deleted",itemId:n}})),window.dispatchEvent(new CustomEvent("inventory-deleted",{detail:{type:"deleted",itemId:n}})))}}catch(a){console.error("Error deleting inventory item:",a),e({error:a instanceof Error?a.message:"Failed to delete inventory item",isLoading:!1})}}),loadUsage:()=>m(void 0,null,function*(){var t,n;try{const a=(yield null==(n=null==(t=window.electronAPI)?void 0:t.inventoryUsage)?void 0:n.getAll())||[];e({usage:a})}catch(a){console.error("Error loading inventory usage:",a)}}),recordUsage:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield window.electronAPI.inventoryUsage.create(n),{usage:s,items:r}=t(),i=[...s,a],l=r.map(e=>e.id===n.inventory_id?d(o({},e),{quantity:Math.max(0,e.quantity-n.quantity_used)}):e);e({usage:i,items:l,isLoading:!1}),t().calculateAnalytics(),t().filterItems()}catch(a){console.error("Error recording inventory usage:",a),e({error:a instanceof Error?a.message:"Failed to record inventory usage",isLoading:!1})}}),getUsageHistory:e=>{const{usage:n}=t();return n.filter(t=>t.inventory_id===e).sort((e,t)=>new Date(t.usage_date).getTime()-new Date(e.usage_date).getTime())},setSelectedItem:t=>{e({selectedItem:t})},setSearchQuery:n=>{e({searchQuery:n}),t().searchItems(n)},setFilters:n=>{e({filters:n}),t().filterItems()},clearError:()=>{e({error:null})},searchItems:n=>{e({searchQuery:n}),t().filterItems()},filterItems:()=>{const{items:n,searchQuery:a,filters:s}=t();let r=[...n];if(""!==a.trim()){const e=a.toLowerCase();r=r.filter(t=>{var n,a,s;return t.name.toLowerCase().includes(e)||(null==(n=t.description)?void 0:n.toLowerCase().includes(e))||(null==(a=t.category)?void 0:a.toLowerCase().includes(e))||(null==(s=t.supplier)?void 0:s.toLowerCase().includes(e))})}if(s.category&&"all"!==s.category&&(r=r.filter(e=>e.category===s.category)),s.supplier&&"all"!==s.supplier&&(r=r.filter(e=>e.supplier===s.supplier)),s.status&&"all"!==s.status){const e=new Date;r=r.filter(t=>{switch(s.status){case"in_stock":return t.quantity>t.minimum_stock;case"low_stock":return t.quantity<=t.minimum_stock&&t.quantity>0;case"out_of_stock":return 0===t.quantity;case"expired":return t.expiry_date&&new Date(t.expiry_date)<e;case"expiring_soon":if(!t.expiry_date)return!1;const n=new Date(t.expiry_date),a=Math.ceil((n.getTime()-e.getTime())/864e5);return a<=30&&a>0;default:return!0}})}e({filteredItems:r})},calculateAnalytics:()=>{const{items:n}=t(),a=new Date,s=n.length,r=n.reduce((e,t)=>e+("number"==typeof t.quantity?t.quantity:0)*("number"==typeof t.cost_per_unit?t.cost_per_unit:0),0),i=n.filter(e=>{const t="number"==typeof e.quantity?e.quantity:0;return t<=("number"==typeof e.minimum_stock?e.minimum_stock:0)&&t>0}).length,l=n.filter(e=>{if(!e.expiry_date)return!1;try{const t=new Date(e.expiry_date);return!isNaN(t.getTime())&&t<a}catch(t){return console.warn("Invalid expiry date:",e.expiry_date,t),!1}}).length,o=n.filter(e=>{if(!e.expiry_date)return!1;try{const t=new Date(e.expiry_date);if(isNaN(t.getTime()))return!1;const n=Math.ceil((t.getTime()-a.getTime())/864e5);return n<=30&&n>0}catch(t){return console.warn("Invalid expiry date:",e.expiry_date,t),!1}}).length;e({totalItems:s,totalValue:r,lowStockCount:i,expiredCount:l,expiringSoonCount:o})},getLowStockItems:()=>{const{items:e}=t();return e.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0)},getExpiredItems:()=>{const{items:e}=t(),n=new Date;return e.filter(e=>e.expiry_date&&new Date(e.expiry_date)<n)},getExpiringSoonItems:(e=30)=>{const{items:n}=t(),a=new Date;return n.filter(t=>{if(!t.expiry_date)return!1;const n=new Date(t.expiry_date),s=Math.ceil((n.getTime()-a.getTime())/864e5);return s<=e&&s>0})},updateCategories:()=>{const{items:n}=t(),a=[...new Set(n.map(e=>e.category).filter(Boolean))];e({categories:a})},updateSuppliers:()=>{const{items:n}=t(),a=[...new Set(n.map(e=>e.supplier).filter(Boolean))];e({suppliers:a})}}),{name:"inventory-store"})),wd=()=>{const e=cl(e=>e.loadPatients),t=Wo(e=>e.loadAppointments),n=Go(e=>e.loadPayments),a=bd(e=>e.refreshStats),s=jd(e=>e.loadItems);return ve.useEffect(()=>{const e=e=>m(void 0,null,function*(){const{patientId:t,patientName:n}=e.detail;console.log(`🔄 Real-time sync: Patient ${n} (${t}) deleted, updating all stores...`),setTimeout(()=>m(void 0,null,function*(){try{yield a(),console.log("📊 Dashboard stats refreshed via real-time sync")}catch(e){console.error("Error refreshing dashboard stats:",e)}}),200)}),t=e=>m(void 0,null,function*(){const{type:t,appointmentId:n}=e.detail;console.log(`🔄 Real-time sync: Appointment ${t} (${n})`),setTimeout(()=>m(void 0,null,function*(){try{yield a()}catch(e){console.error("Error refreshing dashboard stats after appointment change:",e)}}),100)}),n=e=>m(void 0,null,function*(){const{type:t,paymentId:n}=e.detail;console.log(`🔄 Real-time sync: Payment ${t} (${n})`),setTimeout(()=>m(void 0,null,function*(){try{yield a()}catch(e){console.error("Error refreshing dashboard stats after payment change:",e)}}),100)}),s=e=>m(void 0,null,function*(){const{type:t,itemId:n}=e.detail;console.log(`🔄 Real-time sync: Inventory ${t} (${n})`),setTimeout(()=>m(void 0,null,function*(){try{yield a()}catch(e){console.error("Error refreshing dashboard stats after inventory change:",e)}}),100)});return window.addEventListener("patient-deleted",e),window.addEventListener("appointment-changed",t),window.addEventListener("payment-changed",n),window.addEventListener("inventory-changed",s),()=>{window.removeEventListener("patient-deleted",e),window.removeEventListener("appointment-changed",t),window.removeEventListener("payment-changed",n),window.removeEventListener("inventory-changed",s)}},[a]),{syncAll:()=>m(void 0,null,function*(){console.log("🔄 Manual sync: Refreshing all stores...");try{yield Promise.all([e(),t(),n(),s(),a()]),console.log("✅ Manual sync completed successfully")}catch(r){console.error("❌ Manual sync failed:",r)}}),syncAfterPatientDeletion:(e,t)=>m(void 0,null,function*(){console.log(`🔄 Sync after patient deletion: ${t} (${e})`),window.dispatchEvent(new CustomEvent("patient-deleted",{detail:{patientId:e,patientName:t}})),setTimeout(()=>m(void 0,null,function*(){try{yield a()}catch(e){console.error("Error in backup sync after patient deletion:",e)}}),300)})}},Nd=Ne()(Lt((e,t)=>({prescriptions:[],filteredPrescriptions:[],selectedPrescription:null,isLoading:!1,error:null,searchQuery:"",patientFilter:"all",dateRangeFilter:{start:"",end:""},totalPrescriptions:0,recentPrescriptions:0,loadPrescriptions:()=>m(void 0,null,function*(){var n,a;e({isLoading:!0,error:null});try{const s=(yield null==(a=null==(n=window.electronAPI)?void 0:n.prescriptions)?void 0:a.getAll())||[];e({prescriptions:s,filteredPrescriptions:s,isLoading:!1}),t().calculateStatistics(),t().filterPrescriptions()}catch(s){console.error("Error loading prescriptions:",s),e({error:s instanceof Error?s.message:"Failed to load prescriptions",isLoading:!1})}}),createPrescription:n=>m(void 0,null,function*(){var a,s;e({isLoading:!0,error:null});try{const e=yield null==(s=null==(a=window.electronAPI)?void 0:a.prescriptions)?void 0:s.create(n);e&&(yield t().loadPrescriptions(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("prescription-added",{detail:{type:"created",prescriptionId:e.id,prescription:e}})),window.dispatchEvent(new CustomEvent("prescription-changed",{detail:{type:"created",prescriptionId:e.id,prescription:e}}))))}catch(r){throw console.error("Error creating prescription:",r),e({error:r instanceof Error?r.message:"Failed to create prescription",isLoading:!1}),r}}),updatePrescription:(n,a)=>m(void 0,null,function*(){var s,r;e({isLoading:!0,error:null});try{const e=yield null==(r=null==(s=window.electronAPI)?void 0:s.prescriptions)?void 0:r.update(n,a);e&&(yield t().loadPrescriptions(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("prescription-updated",{detail:{type:"updated",prescriptionId:n,prescription:e}})),window.dispatchEvent(new CustomEvent("prescription-changed",{detail:{type:"updated",prescriptionId:n,prescription:e}}))))}catch(i){throw console.error("Error updating prescription:",i),e({error:i instanceof Error?i.message:"Failed to update prescription",isLoading:!1}),i}}),deletePrescription:n=>m(void 0,null,function*(){var a,s,r;e({isLoading:!0,error:null});try{if(yield null==(s=null==(a=window.electronAPI)?void 0:a.prescriptions)?void 0:s.delete(n)){const a=t().prescriptions.filter(e=>e.id!==n);e({prescriptions:a,filteredPrescriptions:a,selectedPrescription:(null==(r=t().selectedPrescription)?void 0:r.id)===n?null:t().selectedPrescription,isLoading:!1}),t().calculateStatistics(),t().filterPrescriptions(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("prescription-deleted",{detail:{type:"deleted",prescriptionId:n}})),window.dispatchEvent(new CustomEvent("prescription-changed",{detail:{type:"deleted",prescriptionId:n}})))}}catch(i){throw console.error("Error deleting prescription:",i),e({error:i instanceof Error?i.message:"Failed to delete prescription",isLoading:!1}),i}}),setSearchQuery:n=>{e({searchQuery:n}),t().filterPrescriptions()},setPatientFilter:n=>{e({patientFilter:n}),t().filterPrescriptions()},setDateRangeFilter:n=>{e({dateRangeFilter:n}),t().filterPrescriptions()},clearFilters:()=>{e({searchQuery:"",patientFilter:"all",dateRangeFilter:{start:"",end:""}}),t().filterPrescriptions()},filterPrescriptions:()=>{const{prescriptions:n,searchQuery:a,patientFilter:s,dateRangeFilter:r}=t();let i=[...n];if(a.trim()&&(i=i.filter(e=>{var t,n,s,r,i,l;return(null==(n=null==(t=e.patient)?void 0:t.full_name)?void 0:n.toLowerCase().includes(a.toLowerCase()))||(null==(r=null==(s=e.appointment)?void 0:s.title)?void 0:r.toLowerCase().includes(a.toLowerCase()))||(null==(i=e.notes)?void 0:i.toLowerCase().includes(a.toLowerCase()))||(null==(l=e.medications)?void 0:l.some(e=>{var t;return null==(t=e.medication_name)?void 0:t.toLowerCase().includes(a.toLowerCase())}))})),"all"!==s&&(i=i.filter(e=>e.patient_id===s)),r.start&&r.end){const e=new Date(r.start),t=new Date(r.end);i=i.filter(n=>{const a=new Date(n.prescription_date);return a>=e&&a<=t})}e({filteredPrescriptions:i})},setSelectedPrescription:t=>{e({selectedPrescription:t})},clearError:()=>{e({error:null})},calculateStatistics:()=>{const{prescriptions:n}=t(),a=n.length,s=new Date;s.setDate(s.getDate()-30);const r=n.filter(e=>new Date(e.prescription_date)>=s).length;e({totalPrescriptions:a,recentPrescriptions:r})},getPrescriptionsByPatient:e=>t().prescriptions.filter(t=>t.patient_id===e),getPrescriptionsByDateRange:(e,n)=>t().prescriptions.filter(t=>{const a=new Date(t.prescription_date);return a>=e&&a<=n})}),{name:"prescription-store"}));function _d(){const{loadAppointments:e}=Wo(),{loadPayments:t}=Go(),{loadPatients:n}=cl(),{loadPrescriptions:a}=Nd(),{loadInventoryItems:s}=jd(),r=ve.useCallback(()=>m(this,null,function*(){console.log("🔄 Refreshing all tables...");try{yield Promise.all([e(),t(),n(),a(),s()]),console.log("✅ All tables refreshed successfully")}catch(r){console.error("❌ Error refreshing tables:",r)}}),[e,t,n,a,s]),i=ve.useCallback(r=>m(this,null,function*(){console.log(`🔄 Refreshing ${r} table...`);try{switch(r){case"appointments":yield e();break;case"payments":yield t();break;case"patients":yield n();break;case"prescriptions":yield a();break;case"inventory":yield s();break;default:console.warn("Unknown table type:",r)}console.log(`✅ ${r} table refreshed successfully`)}catch(i){console.error(`❌ Error refreshing ${r} table:`,i)}}),[e,t,n,a,s]);return ve.useEffect(()=>{console.log("🔔 Setting up real-time table sync listeners...");const e=e=>m(this,null,function*(){var t;console.log("📅 Appointment changed, refreshing appointments table...",null==(t=e.detail)?void 0:t.type),setTimeout(()=>i("appointments"),50)}),t=e=>m(this,null,function*(){var t;console.log("💰 Payment changed, refreshing payments table...",null==(t=e.detail)?void 0:t.type),setTimeout(()=>i("payments"),50)}),n=e=>m(this,null,function*(){var t;console.log("👤 Patient changed, refreshing patients table...",null==(t=e.detail)?void 0:t.type),setTimeout(()=>i("patients"),50),setTimeout(()=>{i("appointments"),i("payments")},100)}),a=e=>m(this,null,function*(){var t;console.log("💊 Prescription changed, refreshing prescriptions table...",null==(t=e.detail)?void 0:t.type),setTimeout(()=>i("prescriptions"),50)}),s=e=>m(this,null,function*(){var t;console.log("📦 Inventory changed, refreshing inventory table...",null==(t=e.detail)?void 0:t.type),setTimeout(()=>i("inventory"),50)}),r=["appointment-added","appointment-updated","appointment-deleted","appointment-changed"],l=["payment-added","payment-updated","payment-deleted","payment-changed"],o=["patient-added","patient-updated","patient-deleted","patient-changed"],d=["prescription-added","prescription-updated","prescription-deleted","prescription-changed"],c=["inventory-added","inventory-updated","inventory-deleted","inventory-changed"];return r.forEach(t=>{window.addEventListener(t,e)}),l.forEach(e=>{window.addEventListener(e,t)}),o.forEach(e=>{window.addEventListener(e,n)}),d.forEach(e=>{window.addEventListener(e,a)}),c.forEach(e=>{window.addEventListener(e,s)}),()=>{console.log("🔔 Cleaning up real-time table sync listeners..."),r.forEach(t=>{window.removeEventListener(t,e)}),l.forEach(e=>{window.removeEventListener(e,t)}),o.forEach(e=>{window.removeEventListener(e,n)}),d.forEach(e=>{window.removeEventListener(e,a)}),c.forEach(e=>{window.removeEventListener(e,s)})}},[i]),{refreshAllTables:r,refreshTable:i}}var kd="Collapsible",[Sd,Dd]=M(kd),[$d,Cd]=Sd(kd),Ed=ve.forwardRef((e,t)=>{const n=e,{__scopeCollapsible:a,open:s,defaultOpen:r,disabled:i,onOpenChange:l}=n,u=c(n,["__scopeCollapsible","open","defaultOpen","disabled","onOpenChange"]),[m,h]=G({prop:s,defaultProp:null!=r&&r,onChange:l,caller:kd});return p.jsx($d,{scope:a,disabled:i,contentId:W(),open:m,onOpenToggle:ve.useCallback(()=>h(e=>!e),[h]),children:p.jsx(q.div,d(o({"data-state":Rd(m),"data-disabled":i?"":void 0},u),{ref:t}))})});Ed.displayName=kd;var Td="CollapsibleTrigger",Ad=ve.forwardRef((e,t)=>{const n=e,{__scopeCollapsible:a}=n,s=c(n,["__scopeCollapsible"]),r=Cd(Td,a);return p.jsx(q.button,d(o({type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":Rd(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled},s),{ref:t,onClick:Y(e.onClick,r.onOpenToggle)}))});Ad.displayName=Td;var Fd="CollapsibleContent",Pd=ve.forwardRef((e,t)=>{const n=e,{forceMount:a}=n,s=c(n,["forceMount"]),r=Cd(Fd,e.__scopeCollapsible);return p.jsx(K,{present:a||r.open,children:({present:e})=>p.jsx(Od,d(o({},s),{ref:t,present:e}))})});Pd.displayName=Fd;var Od=ve.forwardRef((e,t)=>{const n=e,{__scopeCollapsible:a,present:s,children:r}=n,i=c(n,["__scopeCollapsible","present","children"]),l=Cd(Fd,a),[u,m]=ve.useState(s),h=ve.useRef(null),x=z(t,h),g=ve.useRef(0),f=g.current,v=ve.useRef(0),y=v.current,b=l.open||u,j=ve.useRef(b),w=ve.useRef(void 0);return ve.useEffect(()=>{const e=requestAnimationFrame(()=>j.current=!1);return()=>cancelAnimationFrame(e)},[]),H(()=>{const e=h.current;if(e){w.current=w.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";const t=e.getBoundingClientRect();g.current=t.height,v.current=t.width,j.current||(e.style.transitionDuration=w.current.transitionDuration,e.style.animationName=w.current.animationName),m(s)}},[l.open,s]),p.jsx(q.div,d(o({"data-state":Rd(l.open),"data-disabled":l.disabled?"":void 0,id:l.contentId,hidden:!b},i),{ref:x,style:o({"--radix-collapsible-content-height":f?`${f}px`:void 0,"--radix-collapsible-content-width":y?`${y}px`:void 0},e.style),children:b&&r}))});function Rd(e){return e?"open":"closed"}const Md=Ed,Ld=Ad,Id=Pd;function zd({value:e,onChange:t,onClear:n,className:a="",showTitle:s=!0,title:r="فلترة زمنية",defaultOpen:i=!1}){const[l,c]=ve.useState(i),u=e||{preset:"all",startDate:"",endDate:""},m=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,h=(e,n)=>{t(d(o({},u),{[e]:n,preset:"custom"}))};return p.jsx("div",{className:`${a}`,dir:"rtl",children:p.jsxs(Md,{open:l,onOpenChange:c,children:[p.jsx(Ld,{asChild:!0,children:p.jsxs(Qi,{variant:"outline",className:"w-full justify-between text-sm h-9",size:"sm",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(pr,{className:"w-4 h-4"}),p.jsx("span",{children:r})]}),p.jsx(vr,{className:"w-4 h-4 transition-transform "+(l?"rotate-180":"")})]})}),p.jsx(Id,{className:"mt-3",children:p.jsx(Lo,{className:"border-muted",dir:"rtl",children:p.jsxs(Yo,{className:"p-4 space-y-3",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-xs font-medium text-right block text-muted-foreground",children:"اختر الفترة الزمنية للفلترة"}),p.jsxs(el,{value:u.preset,onValueChange:e=>{const n=new Date;let a="",s=m(n);switch(e){case"all":a="",s="";break;case"today":a=m(n);break;case"week":const e=xa(n);a=m(e);break;case"month":const t=new Date(n.getFullYear(),n.getMonth(),1);a=m(t);break;case"year":const r=new Date(n.getFullYear(),0,1);a=m(r);break;case"custom":a=u.startDate||"",s=u.endDate||""}t({preset:e,startDate:a,endDate:s})},children:[p.jsx(al,{className:"text-right h-8 text-sm",dir:"rtl",children:p.jsx(nl,{placeholder:"اختر الفترة الزمنية"})}),p.jsxs(il,{dir:"rtl",children:[p.jsx(dl,{value:"all",children:"جميع البيانات"}),p.jsx(dl,{value:"today",children:"اليوم"}),p.jsx(dl,{value:"week",children:"هذا الأسبوع"}),p.jsx(dl,{value:"month",children:"هذا الشهر"}),p.jsx(dl,{value:"year",children:"هذه السنة"}),p.jsx(dl,{value:"custom",children:"فترة مخصصة"})]})]})]}),"custom"===u.preset&&p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[p.jsxs("div",{className:"space-y-1",children:[p.jsx("label",{className:"text-xs font-medium text-right block text-muted-foreground",children:"من تاريخ (بداية الفترة)"}),p.jsx(Xi,{type:"date",value:u.startDate||"",onChange:e=>h("startDate",e.target.value),className:"text-right h-8 text-sm",dir:"rtl"})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsx("label",{className:"text-xs font-medium text-right block text-muted-foreground",children:"إلى تاريخ (نهاية الفترة)"}),p.jsx(Xi,{type:"date",value:u.endDate||"",onChange:e=>h("endDate",e.target.value),className:"text-right h-8 text-sm",dir:"rtl"})]})]}),p.jsxs("div",{className:"bg-muted/30 p-2 rounded text-right",children:[p.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"الفترة المحددة:"}),p.jsxs("div",{className:"text-sm font-medium",children:[(e=>{switch(e){case"all":default:return"جميع البيانات";case"today":return"اليوم";case"week":return"هذا الأسبوع";case"month":return"هذا الشهر";case"year":return"هذه السنة";case"custom":return"فترة مخصصة"}})(u.preset),u.startDate&&u.endDate&&p.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["من ",new Date(u.startDate).toLocaleDateString("en-GB"),"إلى ",new Date(u.endDate).toLocaleDateString("en-GB")]})]})]}),p.jsx("div",{className:"flex justify-end",children:p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>{t({preset:"all",startDate:"",endDate:""}),null==n||n()},className:"h-7 text-xs",children:[p.jsx(Mi,{className:"w-3 h-3 ml-1"}),"إعادة تعيين"]})})]})})})]})})}function Bd({data:e,dateField:t="created_at",initialFilter:n}){const[a,s]=ve.useState(n||{preset:"all",startDate:"",endDate:""}),r=ve.useMemo(()=>{if(!e||!Array.isArray(e))return[];if(!a.startDate||!a.endDate||""===a.startDate||""===a.endDate)return e;const n=new Date(a.startDate),s=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),r=new Date(a.endDate),i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);return e.filter(e=>{const n=e[t];if(!n)return!1;const a=n,r=new Date(a);let l;return l=a.includes("T")||a.includes(" ")?r:new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0),l>=s&&l<=i})},[e,a,t]),i=ve.useMemo(()=>{const n=r.length;if(!e||!Array.isArray(e))return{total:0,filtered:0,today:0,week:0,month:0,year:0};const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate()),i=xa(a),l=new Date(a.getFullYear(),a.getMonth(),1),o=new Date(a.getFullYear(),0,1),d=e.filter(e=>{const n=e[t];if(!n)return!1;return new Date(n)>=s}).length,c=e.filter(e=>{const n=e[t];if(!n)return!1;const s=new Date(n);return s>=i&&s<=a}).length,u=e.filter(e=>{const n=e[t];if(!n)return!1;return new Date(n)>=l}).length,m=e.filter(e=>{const n=e[t];if(!n)return!1;return new Date(n)>=o}).length;return{total:n,filtered:r.length,today:d,week:c,month:u,year:m}},[e,r,t]),l=ve.useMemo(()=>{if(!r||0===r.length)return{totalRevenue:0,pendingAmount:0,overdueAmount:0,completedAmount:0};if(!r.some(e=>"amount"in e||"total_amount"in e||"cost"in e||"price"in e))return{totalRevenue:0,pendingAmount:0,overdueAmount:0,completedAmount:0};const e=r.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>{const n=t.amount||t.total_amount||t.cost||t.price||0;return e+("number"==typeof n?n:parseFloat(n)||0)},0),t=r.filter(e=>"pending"===e.status).reduce((e,t)=>{const n=t.amount||t.total_amount||t.cost||t.price||0,a=t.total_amount_due||0;let s=n;if(t.tooth_treatment_id){s=t.treatment_total_cost||a||0}else if(a>0)s=a;else{const e=t.remaining_balance||0;e>0&&(s=e)}return e+("number"==typeof s?s:parseFloat(s)||0)},0),n=r.filter(e=>{if("pending"!==e.status)return!1;const t=new Date(e.payment_date||e.date||e.created_at),n=new Date;return n.setDate(n.getDate()-30),t<n}).reduce((e,t)=>{const n=t.amount||t.total_amount||t.cost||t.price||0,a=t.total_amount_due||0,s=t.remaining_balance||0;let r=n;return a>0?r=a:s>0&&(r=s),e+("number"==typeof r?r:parseFloat(r)||0)},0),a=new Map,s=new Map;let i=0;r.forEach(e=>{if("partial"===e.status)if(e.tooth_treatment_id){const t=e.tooth_treatment_id,n=e.treatment_total_cost||e.total_amount_due||0,a=e.amount||0;s.has(t)||s.set(t,{totalDue:"number"==typeof n?n:parseFloat(n)||0,totalPaid:0});s.get(t).totalPaid+="number"==typeof a?a:parseFloat(a)||0}else if(e.appointment_id){const t=e.appointment_id,n=e.total_amount_due||e.appointment_total_cost||0,s=e.amount||0;a.has(t)||a.set(t,{totalDue:"number"==typeof n?n:parseFloat(n)||0,totalPaid:0});a.get(t).totalPaid+="number"==typeof s?s:parseFloat(s)||0}else{const t=e.total_amount_due||e.amount||0,n=e.amount_paid||e.amount||0,a="number"==typeof t?t:parseFloat(t)||0,s="number"==typeof n?n:parseFloat(n)||0;i+=Math.max(0,a-s)}});return{totalRevenue:e,pendingAmount:t,overdueAmount:n,completedAmount:e,totalRemainingBalance:Array.from(a.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0)+Array.from(s.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0)+i}},[r]),o=ve.useMemo(()=>{const e={};return r.forEach(n=>{const s=new Date(n[t]);let r="";switch(a.preset){case"today":r=s.toLocaleTimeString("ar-SA",{hour:"2-digit"});break;case"week":r=s.toLocaleDateString("ar-SA",{weekday:"short"});break;case"month":r=s.getDate().toString();break;case"year":r=s.toLocaleDateString("ar-SA",{month:"short"});break;default:r=s.toLocaleDateString("ar-SA")}e[r]||(e[r]=[]),e[r].push(n)}),e},[r,a.preset,t]),d=ve.useMemo(()=>{if(!(e&&Array.isArray(e)&&a.startDate&&a.endDate))return null;const n=new Date(a.startDate),s=new Date(a.endDate).getTime()-n.getTime(),i=new Date(n.getTime()-s),l=new Date(n.getTime()-1),o=e.filter(e=>{const n=new Date(e[t]);return n>=i&&n<=l}),d=r.length,c=o.length;if(0===c)return null;const u=(d-c)/c*100;return{current:d,previous:c,change:d-c,changePercent:Math.round(100*u)/100,isPositive:u>=0}},[e,r,a,t]);return{timeFilter:a,filteredData:r,stats:i,financialStats:l,groupedData:o,trend:d,handleFilterChange:e=>{s(e)},resetFilter:()=>{s({preset:"all",startDate:"",endDate:""})}}}function Yd({open:e,onOpenChange:t,payment:n}){const{toast:a}=yl(),{updatePayment:s,isLoading:r,getPaymentsByPatient:i,getPaymentsByAppointment:l,getPaymentsByToothTreatment:c}=Go(),{patients:u}=cl(),{appointments:h}=Wo(),{toothTreatments:x,loadToothTreatmentsByPatient:g}=Ko(),{formatAmount:f}=Sa(),[v,y]=ve.useState({patient_id:"",tooth_treatment_id:"none",appointment_id:"none",amount:"",payment_method:"cash",payment_date:"",description:"",receipt_number:"",status:"completed",notes:"",discount_amount:"",tax_amount:"",total_amount_due:"",amount_paid:""}),[b,j]=ve.useState({previousPayments:0,originalAmount:0,isCalculating:!1}),w=()=>{const e=new Date;return`RCP-${e.getFullYear().toString().slice(-2)}${(e.getMonth()+1).toString().padStart(2,"0")}${e.getDate().toString().padStart(2,"0")}-${e.getTime().toString().slice(-4)}`},N=()=>{const e=parseFloat(v.amount)||0;return b.previousPayments+e},_=()=>{const e=parseFloat(v.total_amount_due)||0,t=N();return Math.max(0,e-t)};ve.useEffect(()=>{if(v.appointment_id&&"none"!==v.appointment_id&&n){j(e=>d(o({},e),{isCalculating:!0}));const a=(e=v.appointment_id,t=n.id,e&&"none"!==e?l(e).filter(e=>e.id!==t).reduce((e,t)=>e+t.amount,0):0),s=n.amount;j({previousPayments:a,originalAmount:s,isCalculating:!1})}else n&&j({previousPayments:0,originalAmount:n.amount,isCalculating:!1});var e,t},[v.appointment_id,n]),ve.useEffect(()=>{if(v.appointment_id&&"none"!==v.appointment_id){const e=(e=>{if(!e||"none"===e)return 0;const t=h.find(t=>t.id===e);return(null==t?void 0:t.cost)||0})(v.appointment_id);e>0&&!v.total_amount_due&&y(t=>d(o({},t),{total_amount_due:e.toString()}))}},[v.appointment_id]),ve.useEffect(()=>{if(v.tooth_treatment_id&&"none"!==v.tooth_treatment_id){const e=x.find(e=>e.id===v.tooth_treatment_id);e&&e.cost&&y(t=>d(o({},t),{total_amount_due:e.cost.toString()}))}},[v.tooth_treatment_id,x]),ve.useEffect(()=>{if(v.amount&&b.previousPayments>=0){const e=N();y(t=>d(o({},t),{amount_paid:e.toString()}))}},[v.amount,b.previousPayments]),ve.useEffect(()=>{var t,a,s,r;n&&e&&(y({patient_id:n.patient_id||"",tooth_treatment_id:n.tooth_treatment_id||"none",appointment_id:n.appointment_id||"none",amount:n.amount.toString(),payment_method:n.payment_method,payment_date:n.payment_date.split("T")[0],description:n.description||"",receipt_number:n.receipt_number||"",status:n.status,notes:n.notes||"",discount_amount:(null==(t=n.discount_amount)?void 0:t.toString())||"",tax_amount:(null==(a=n.tax_amount)?void 0:a.toString())||"",total_amount_due:(null==(s=n.total_amount_due)?void 0:s.toString())||"",amount_paid:(null==(r=n.amount_paid)?void 0:r.toString())||""}),n.patient_id&&g(n.patient_id))},[n,e]);const k=(e,t)=>{y(n=>d(o({},n),{[e]:t}))},S=()=>{const e=v.amount?parseFloat(v.amount):0,t=v.total_amount_due?parseFloat(v.total_amount_due):0;if(t>0){if(v.appointment_id&&"none"!==v.appointment_id){const a=l(v.appointment_id).filter(e=>e.id!==n.id).reduce((e,t)=>e+t.amount,0)+e;return a>=t?"completed":a>0?"partial":"pending"}{const n=parseFloat(v.amount_paid)||e;return n>=t?"completed":n>0?"partial":"pending"}}return e>0?"completed":"pending"};ve.useEffect(()=>{const e=v.amount?parseFloat(v.amount):0;if((v.total_amount_due?parseFloat(v.total_amount_due):0)>0||e>0){const e=S();y(t=>d(o({},t),{status:e}))}},[v.amount,v.total_amount_due,v.appointment_id]);const D=h.filter(e=>e.patient_id===v.patient_id),$=x.filter(e=>{if(e.patient_id!==v.patient_id)return!1;if(n.tooth_treatment_id===e.id)return!0;const t=c(e.id),a=e.cost||0;if(0===t.length)return!0;return t.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+t.amount,0)<a});return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-background border-border shadow-2xl",dir:"rtl",children:[p.jsxs(Vi,{className:"border-b border-border pb-4",children:[p.jsxs(Ui,{className:"flex items-center text-xl font-semibold text-foreground",children:[p.jsx(si,{className:"w-5 h-5 ml-2 text-primary"}),"تعديل الدفعة"]}),p.jsxs(Hi,{className:"text-muted-foreground",children:["تعديل بيانات الدفعة رقم ",n.receipt_number||n.id.slice(-6)]})]}),p.jsxs("form",{onSubmit:e=>m(this,null,function*(){if(e.preventDefault(),v.patient_id&&v.payment_date)try{const e=v.amount?parseFloat(v.amount):0,r=v.discount_amount?parseFloat(v.discount_amount):0,i=v.tax_amount?parseFloat(v.tax_amount):0,l=e+i-r,o=v.total_amount_due?parseFloat(v.total_amount_due):l,d=N(),c=o-d,u=n.tooth_treatment_id&&"none"!==n.tooth_treatment_id?n.tooth_treatment_id:v.tooth_treatment_id&&"none"!==v.tooth_treatment_id?v.tooth_treatment_id:void 0,m={patient_id:v.patient_id,tooth_treatment_id:u,appointment_id:v.appointment_id&&"none"!==v.appointment_id?v.appointment_id:void 0,amount:e,payment_method:v.payment_method,payment_date:v.payment_date,description:v.description,receipt_number:v.receipt_number||w(),status:v.status,notes:v.notes,discount_amount:r>0?r:void 0,tax_amount:i>0?i:void 0,total_amount:l,total_amount_due:o,amount_paid:d,remaining_balance:c};console.log("🔄 Submitting payment update:",m),yield s(n.id,m),a({title:"تم بنجاح",description:"تم تحديث الدفعة بنجاح"}),t(!1)}catch(r){console.error("❌ Failed to update payment:",r),a({title:"خطأ",description:r instanceof Error?r.message:"فشل في تحديث الدفعة",variant:"destructive"})}else a({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"})}),className:"space-y-6",children:["none"!==v.tooth_treatment_id&&p.jsx("div",{className:"bg-orange-50 dark:bg-orange-950/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4",children:p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(ar,{className:"w-5 h-5 text-orange-600 dark:text-orange-400 mt-0.5 flex-shrink-0"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("h4",{className:"font-medium text-orange-800 dark:text-orange-200",children:"دفعة مرتبطة بعلاج"}),p.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:"هذه الدفعة مرتبطة بعلاج محدد. المبلغ الإجمالي المطلوب مرتبط بتكلفة العلاج ولا يمكن تعديله من هنا. لتعديل المبلغ، قم بتعديل تكلفة العلاج من قسم العلاجات."})]})]})}),p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(ui,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات المريض"]})}),p.jsx(Yo,{className:"space-y-4",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"patient_id",className:"text-foreground font-medium",children:"المريض *"}),p.jsxs(el,{value:v.patient_id,onValueChange:e=>k("patient_id",e),children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر المريض",className:"text-muted-foreground"})}),p.jsx(il,{children:u.map(e=>p.jsx(dl,{value:e.id,children:e.full_name},e.id))})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"tooth_treatment_id",className:"text-foreground font-medium",children:"العلاج"}),n.tooth_treatment_id&&"none"!==n.tooth_treatment_id?p.jsxs("div",{className:"space-y-2",children:[p.jsx("div",{className:"p-3 bg-muted/50 border border-border rounded-md",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("div",{className:"flex flex-col",children:(()=>{const e=x.find(e=>e.id===n.tooth_treatment_id);return e?p.jsxs(p.Fragment,{children:[p.jsxs("span",{className:"font-medium text-foreground",children:["السن ",e.tooth_number," - ",ud(e.treatment_type)]}),p.jsxs("span",{className:"text-xs text-muted-foreground",children:["التكلفة: ",f(e.cost||0)]})]}):p.jsxs("span",{className:"text-muted-foreground",children:["العلاج المرتبط (معرف: ",n.tooth_treatment_id,")"]})})()}),p.jsx(qo,{variant:"secondary",className:"text-xs",children:"مرتبط"})]})}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"⚠️ لا يمكن تغيير العلاج للمدفوعات المرتبطة بعلاج محدد"}),p.jsx("input",{type:"hidden",value:n.tooth_treatment_id})]}):p.jsxs(el,{value:v.tooth_treatment_id,onValueChange:e=>k("tooth_treatment_id",e),children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر العلاج",className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"none",children:"بدون علاج محدد"}),$.map(e=>{const t=c(e.id),n=e.cost||0,a=n-t.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+t.amount,0);return p.jsx(dl,{value:e.id,children:p.jsxs("div",{className:"flex flex-col",children:[p.jsx("span",{children:`السن ${e.tooth_number} - ${ud(e.treatment_type)}`}),p.jsxs("div",{className:"text-xs text-muted-foreground",children:[p.jsxs("span",{children:["التكلفة: ",f(n)]}),a>0&&a<n&&p.jsxs("span",{className:"text-orange-600 font-medium",children:[" • متبقي: ",f(a)]})]})]})},e.id)})]})]})]}),p.jsxs("div",{className:"space-y-2 hidden",children:[p.jsx(Ro,{htmlFor:"appointment_id",className:"text-foreground font-medium",children:"الموعد (اختياري)"}),p.jsxs(el,{value:v.appointment_id,onValueChange:e=>k("appointment_id",e),children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر الموعد",className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"none",children:"بدون موعد محدد"}),D.map(e=>p.jsxs(dl,{value:e.id,children:[e.title," - ",ma(e.start_time)]},e.id))]})]})]})]})})]}),p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(Er,{className:"w-4 h-4 ml-2 text-primary"}),"تفاصيل المبالغ والدفع"]})}),p.jsxs(Yo,{children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"amount",className:"text-foreground font-medium",children:"المبلغ"}),p.jsx(Xi,{id:"amount",type:"number",step:"1",value:v.amount,onChange:e=>k("amount",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;k("amount",t.toString())},placeholder:"0.00",className:"bg-background border-input text-foreground"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"payment_method",className:"text-foreground font-medium",children:"طريقة الدفع"}),p.jsxs(el,{value:v.payment_method,onValueChange:e=>k("payment_method",e),children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر طريقة الدفع",className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"cash",children:"نقداً"}),p.jsx(dl,{value:"bank_transfer",children:"تحويل بنكي"})]})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"payment_date",className:"text-foreground font-medium",children:"تاريخ الدفع *"}),p.jsx(Xi,{id:"payment_date",type:"date",value:v.payment_date,onChange:e=>k("payment_date",e.target.value),required:!0,className:"bg-background border-input text-foreground"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"status",className:"text-foreground font-medium",children:["الحالة",v.amount&&parseFloat(v.amount)>0&&p.jsxs("span",{className:"text-xs text-muted-foreground mr-2",children:["(مقترح: ","completed"===S()?"مكتمل":"partial"===S()?"جزئي":"معلق",")"]})]}),p.jsxs(el,{value:v.status,onValueChange:e=>k("status",e),children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر الحالة",className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"completed",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:"مكتمل"}),"completed"===S()&&p.jsx("span",{className:"text-xs text-green-600",children:"✓ مقترح"})]})}),p.jsx(dl,{value:"partial",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:"جزئي"}),"partial"===S()&&p.jsx("span",{className:"text-xs text-orange-600",children:"✓ مقترح"})]})}),p.jsx(dl,{value:"pending",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:"معلق"}),"pending"===S()&&p.jsx("span",{className:"text-xs text-blue-600",children:"✓ مقترح"})]})})]})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"discount_amount",className:"text-foreground font-medium",children:"مبلغ الخصم"}),p.jsx(Xi,{id:"discount_amount",type:"number",step:"1",value:v.discount_amount,onChange:e=>k("discount_amount",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;k("discount_amount",t.toString())},placeholder:"0.00",className:"bg-background border-input text-foreground"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"tax_amount",className:"text-foreground font-medium",children:"مبلغ الضريبة"}),p.jsx(Xi,{id:"tax_amount",type:"number",step:"1",value:v.tax_amount,onChange:e=>k("tax_amount",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;k("tax_amount",t.toString())},placeholder:"0.00",className:"bg-background border-input text-foreground"})]})]})]})]}),p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(vi,{className:"w-4 h-4 ml-2 text-primary"}),"تتبع المدفوعات التلقائي"]}),p.jsx(Bo,{className:"text-muted-foreground",children:"تتبع المبالغ المطلوبة والمدفوعة والمتبقية مع الحسابات التلقائية"})]}),p.jsxs(Yo,{className:"space-y-4",children:[v.appointment_id&&"none"!==v.appointment_id&&p.jsx(Lo,{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/50 dark:to-blue-900/30 border-blue-200 dark:border-blue-800 shadow-sm transition-all duration-200",children:p.jsxs(Yo,{className:"p-4",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[p.jsx(vi,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),p.jsx("span",{className:"text-sm font-medium text-primary",children:"الحسابات التلقائية للموعد"})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-muted-foreground",children:"المدفوعات السابقة لهذا الموعد:"}),p.jsxs("span",{className:"font-medium text-foreground",children:["$",b.previousPayments.toFixed(2)]})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-muted-foreground",children:"المبلغ الأصلي لهذه الدفعة:"}),p.jsxs("span",{className:"font-medium text-foreground",children:["$",b.originalAmount.toFixed(2)]})]})]})]})}),"none"===v.appointment_id&&p.jsx(Lo,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-950/50 dark:to-yellow-900/30 border-yellow-200 dark:border-yellow-800 shadow-sm transition-all duration-200",children:p.jsxs(Yo,{className:"p-4",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx(ar,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),p.jsx("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"دفعة بدون موعد محدد"})]}),p.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"هذه الدفعة غير مرتبطة بموعد محدد، لذلك لا توجد مدفوعات سابقة مرتبطة بها"})]})}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"flex items-center gap-2 text-foreground font-medium",htmlFor:"total_amount_due",children:["المبلغ الإجمالي المطلوب","none"!==v.tooth_treatment_id&&p.jsx(qo,{variant:"outline",className:"text-xs text-orange-600 border-orange-600",children:"🔒 مرتبط بالعلاج"}),"none"!==v.appointment_id&&"none"===v.tooth_treatment_id&&p.jsxs(qo,{variant:"secondary",className:"text-xs",children:[p.jsx(vi,{className:"w-3 h-3 ml-1"}),"تلقائي"]})]}),p.jsx(Xi,{id:"total_amount_due",type:"number",step:"1",value:v.total_amount_due,onChange:e=>k("total_amount_due",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;k("total_amount_due",t.toString())},placeholder:"0.00",className:"bg-background border-input text-foreground "+("none"!==v.tooth_treatment_id?"opacity-60 cursor-not-allowed bg-muted":""),disabled:"none"!==v.tooth_treatment_id}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"none"!==v.tooth_treatment_id?"🔒 المبلغ مرتبط بتكلفة العلاج ولا يمكن تعديله هنا. لتعديل المبلغ، قم بتعديل تكلفة العلاج من قسم العلاجات.":"none"!==v.appointment_id?"تم جلب المبلغ من الموعد المحدد تلقائياً":"المبلغ الكامل المطلوب للعلاج أو الخدمة"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"flex items-center gap-2 text-foreground font-medium",htmlFor:"amount_paid",children:["إجمالي المبلغ المدفوع",p.jsxs(qo,{variant:"secondary",className:"text-xs",children:[p.jsx(vi,{className:"w-3 h-3 ml-1"}),"محسوب تلقائياً"]})]}),p.jsx(Xi,{id:"amount_paid",type:"number",step:"1",value:v.amount_paid,readOnly:!0,className:"bg-muted cursor-not-allowed border-input text-foreground font-medium",placeholder:"0.00"}),p.jsxs("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium",children:["✓ محسوب تلقائياً: المدفوعات السابقة (",f(b.previousPayments),") + هذه الدفعة (",f(parseFloat(v.amount)||0),")"]})]})]}),v.total_amount_due&&p.jsx(Lo,{className:"shadow-sm transition-all duration-200 "+(_()>0?"bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-950/50 dark:to-orange-900/30 border-orange-200 dark:border-orange-800":"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950/50 dark:to-green-900/30 border-green-200 dark:border-green-800"),children:p.jsxs(Yo,{className:"p-4",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm font-medium text-foreground",children:"المبلغ المتبقي:"}),p.jsxs(qo,{variant:_()>0?"destructive":"default",className:"text-lg px-3 py-1",children:["$",_().toFixed(2)]})]}),0===_()&&p.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium mt-2",children:"✓ تم سداد المبلغ بالكامل"})]})}),p.jsxs(Lo,{className:"bg-gradient-to-r from-muted/30 to-muted/50 border-border",children:[p.jsx(Io,{children:p.jsx(zo,{className:"text-sm text-card-foreground",children:"ملخص هذه الدفعة"})}),p.jsxs(Yo,{className:"space-y-2 text-sm",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-muted-foreground",children:"المبلغ الأساسي:"}),p.jsxs("span",{className:"font-medium text-foreground",children:["$",(parseFloat(v.amount)||0).toFixed(2)]})]}),v.tax_amount&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-muted-foreground",children:"الضريبة:"}),p.jsxs("span",{className:"text-orange-600 dark:text-orange-400 font-medium",children:["+$",(parseFloat(v.tax_amount)||0).toFixed(2)]})]}),v.discount_amount&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-muted-foreground",children:"الخصم:"}),p.jsxs("span",{className:"text-emerald-600 dark:text-emerald-400 font-medium",children:["-$",(parseFloat(v.discount_amount)||0).toFixed(2)]})]}),p.jsxs("div",{className:"flex justify-between font-medium border-t border-border pt-2",children:[p.jsx("span",{className:"text-foreground",children:"إجمالي هذه الدفعة:"}),p.jsxs(qo,{variant:"outline",className:"text-base",children:["$",((parseFloat(v.amount)||0)+(parseFloat(v.tax_amount)||0)-(parseFloat(v.discount_amount)||0)).toFixed(2)]})]})]})]})]})]}),p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{children:p.jsx(zo,{className:"text-lg text-card-foreground",children:"معلومات إضافية"})}),p.jsxs(Yo,{className:"space-y-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"flex items-center gap-2 text-foreground",htmlFor:"receipt_number",children:["رقم الإيصال",p.jsxs(qo,{variant:"secondary",className:"text-xs",children:[p.jsx(vi,{className:"w-3 h-3 ml-1"}),"مولد تلقائياً"]})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(Xi,{id:"receipt_number",value:v.receipt_number,onChange:e=>k("receipt_number",e.target.value),placeholder:"رقم الإيصال",className:"flex-1 bg-background border-input text-foreground"}),p.jsx(Qi,{type:"button",variant:"outline",size:"sm",onClick:()=>k("receipt_number",w()),className:"px-3",children:p.jsx(vi,{className:"w-4 h-4"})})]}),p.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium",children:"✓ يمكن توليد رقم إيصال جديد تلقائياً"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"description",className:"text-foreground",children:"الوصف"}),p.jsx(Ji,{id:"description",value:v.description,onChange:e=>k("description",e.target.value),placeholder:"وصف الدفعة",rows:3,className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"notes",className:"text-foreground",children:"ملاحظات"}),p.jsx(Ji,{id:"notes",value:v.notes,onChange:e=>k("notes",e.target.value),placeholder:"ملاحظات إضافية",rows:3,className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})]})]})]}),p.jsxs(qi,{className:"flex justify-end space-x-3 space-x-reverse border-t border-border pt-4",children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:r,children:"إلغاء"}),p.jsx(Qi,{type:"submit",disabled:r,className:"bg-primary hover:bg-primary/90 text-primary-foreground",children:r?"جاري الحفظ...":"حفظ التغييرات"})]})]})]})})}function Vd({open:e,onOpenChange:t,payment:n}){const{toast:a}=yl(),{deletePayment:s,isLoading:r}=Go(),{patients:i}=cl();return p.jsx(Gl,{open:e,onOpenChange:t,children:p.jsxs(Zl,{className:"max-w-lg",dir:"rtl",children:[p.jsx(Ql,{children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-destructive/10",children:p.jsx(sr,{className:"h-6 w-6 text-destructive"})}),p.jsxs("div",{children:[p.jsx(Jl,{className:"text-lg font-semibold text-destructive",children:"تأكيد حذف الدفعة"}),p.jsx(eo,{children:"هذا الإجراء لا يمكن التراجع عنه"})]})]})}),p.jsxs("div",{className:"space-y-4",children:[p.jsx(eo,{children:"هل أنت متأكد من رغبتك في حذف هذه الدفعة؟ لا يمكن التراجع عن هذا الإجراء."}),p.jsx(Lo,{children:p.jsxs(Yo,{className:"p-4 space-y-3",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[p.jsx($r,{className:"w-4 h-4 text-muted-foreground"}),p.jsx("span",{className:"font-medium",children:"تفاصيل الدفعة"})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[p.jsxs("div",{className:"space-y-1",children:[p.jsx("span",{className:"text-muted-foreground",children:"رقم الإيصال:"}),p.jsx("div",{className:"font-medium",children:n.receipt_number||`#${n.id.slice(-6)}`})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsx("span",{className:"text-muted-foreground",children:"المبلغ:"}),p.jsx(qo,{variant:"outline",className:"font-medium",children:ca(n.amount)})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[p.jsx(Ai,{className:"w-3 h-3"}),"المريض:"]}),p.jsx("div",{className:"font-medium",children:(e=>{if(e.patient)return`${e.patient.first_name} ${e.patient.last_name}`;const t=i.find(t=>t.id===e.patient_id);return t?`${t.first_name} ${t.last_name}`:"غير محدد"})(n)})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsx("span",{className:"text-muted-foreground",children:"طريقة الدفع:"}),p.jsx(qo,{variant:"secondary",children:(o=n.payment_method,{cash:"نقداً",bank_transfer:"تحويل بنكي"}[o]||o)})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),p.jsx(qo,{variant:"outline",children:(l=n.status,{completed:"مكتمل",partial:"جزئي",pending:"معلق"}[l]||l)})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[p.jsx(hr,{className:"w-3 h-3"}),"تاريخ الدفع:"]}),p.jsx("div",{className:"font-medium",children:ma(n.payment_date)})]})]}),n.description&&p.jsx("div",{className:"border-t pt-3 mt-3 space-y-2",children:p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground text-xs",children:"الوصف:"}),p.jsx("p",{className:"text-sm",children:n.description})]})})]})})]}),p.jsxs(Xl,{className:"flex justify-end space-x-2 space-x-reverse",children:[p.jsx(no,{disabled:r,children:"إلغاء"}),p.jsx(to,{onClick:()=>m(this,null,function*(){try{yield s(n.id),a({title:"تم بنجاح",description:"تم حذف الدفعة بنجاح"}),t(!1)}catch(e){a({title:"خطأ",description:"فشل في حذف الدفعة",variant:"destructive"})}}),disabled:r,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:r?"جاري الحذف...":"حذف الدفعة"})]})]})});var l,o}function qd(){const{settings:e,isLoading:t,loadSettings:n}=qt(),[a,s]=ve.useState(null),r=ve.useRef(null),i=ve.useRef(!1);ve.useEffect(()=>{if(e){r.current=e,s(e),i.current=!0;try{localStorage.setItem("dental-clinic-settings-backup",JSON.stringify({clinic_name:e.clinic_name||"",doctor_name:e.doctor_name||"",clinic_logo:e.clinic_logo||"",clinic_phone:e.clinic_phone||"",clinic_email:e.clinic_email||"",clinic_address:e.clinic_address||"",backup_timestamp:Date.now()}))}catch(n){console.warn("Failed to save settings backup:",n)}}else if(!i.current&&!t){try{const e=localStorage.getItem("dental-clinic-settings-backup");if(e){const t=JSON.parse(e);t.clinic_name&&(s(t),r.current=t)}}catch(n){console.warn("Failed to restore settings from backup:",n)}i.current=!0}},[e,t]),ve.useEffect(()=>{e||t||a||n()},[e,t,a,n]);const l=a||r.current;return{settings:l,isLoading:t&&!l,hasValidSettings:Boolean(l),refreshSettings:n}}function Ud(){const{settings:e}=qd();return(null==e?void 0:e.clinic_name)||"عيادة الأسنان"}function Hd(){const{settings:e}=qd();return(null==e?void 0:e.doctor_name)||"د. محمد أحمد"}function Gd(){const{settings:e}=qd();return(null==e?void 0:e.clinic_logo)||""}function Wd(){const{settings:e}=qd();return{phone:(null==e?void 0:e.clinic_phone)||"",email:(null==e?void 0:e.clinic_email)||"",address:(null==e?void 0:e.clinic_address)||""}}function Kd({open:e,onOpenChange:t,payment:n}){var a;const{settings:s,loadSettings:r}=qt(),{formatAmount:i}=Sa(),l=Ud(),c=Hd(),u=Gd(),{phone:h,email:x,address:g}=Wd(),f=ve.useRef(null);ve.useEffect(()=>{e&&!s&&r()},[e,s,r]);const[v,y]=ve.useState({printerType:"80mm",includeQR:!0,includeBarcode:!0,includeLogo:!0,colorMode:"color",qrType:"text"}),[b,j]=ve.useState(!1),[w,N]=ve.useState(""),[_,k]=ve.useState("");ve.useEffect(()=>{const t=()=>m(this,null,function*(){try{const e=(()=>{var e;const t=n.receipt_number||`RCP-${n.id.slice(-6)}`,a=(null==(e=n.patient)?void 0:e.full_name)||"غير محدد",s=ma(n.payment_date),r=i(n.amount);let o="";if("partial"===n.status){let e=0;if(n.appointment_id){const t=n.total_amount_due||n.appointment_total_cost||0,a=n.amount_paid||n.amount||0;e=Math.max(0,t-a)}else{const t=n.total_amount_due||n.amount||0,a=n.amount_paid||n.amount||0;e=Math.max(0,t-a)}e>0&&(o=`⚠️ المبلغ المتبقي: ${i(e)}`)}return`🏥 ${l}\n${c?`👨‍⚕️ ${c}`:""}\n\n📋 إيصال دفع رقم: ${t}\n👤 المريض: ${a}\n💰 المبلغ المدفوع: ${r}\n📅 التاريخ: ${s}\n🔄 حالة الدفعة: ${C(n.status)}\n${n.appointment_id?"📅 مرتبطة بموعد: نعم":""}\n${o?`\n${o}`:""}\n\n✅ هذا إيصال رسمي معتمد\n🔒 معرف التحقق: ${n.id.slice(-12)}\n\n${h?`📞 للاستفسار: ${h}`:""}\n${g?`📍 العنوان: ${g}`:""}\n\nشكراً لثقتكم بنا 🙏`})(),t=yield gt.toDataURL(e,{width:200,margin:1,color:{dark:"#000000",light:"#FFFFFF"}});N(t)}catch(e){console.error("Error generating QR code:",e)}});e&&(v.includeQR&&t(),v.includeBarcode&&(()=>{try{const e=document.createElement("canvas"),t=S();ft(e,t,{format:"CODE128",width:2,height:40,displayValue:!1,margin:0,background:"#ffffff",lineColor:"#000000"}),k(e.toDataURL())}catch(e){console.error("Error generating barcode:",e)}})())},[e,v.includeQR,v.includeBarcode,n,s]);const S=()=>`${new Date(n.payment_date).getTime().toString().slice(-8)}${n.patient_id.slice(-4)}${Math.floor(n.amount).toString().padStart(4,"0")}`,D=()=>{if(f.current){const e=window.open("","_blank");if(e){const t="color"===v.colorMode,a="a4"===v.printerType?"210mm":v.printerType;e.document.write(`\n          <html>\n            <head>\n              <title>إيصال دفع - ${n.receipt_number||n.id.slice(-6)}</title>\n              <style>\n                body {\n                  font-family: 'Arial', 'Tahoma', sans-serif;\n                  direction: rtl;\n                  margin: 0;\n                  padding: 0;\n                  font-size: ${"a4"===v.printerType?"14px":"12px"};\n                  line-height: 1.4;\n                  color: #000;\n                  background: white;\n                }\n\n                .receipt {\n                  width: ${"a4"===a?"100%":a};\n                  max-width: ${"a4"===a?"210mm":a};\n                  margin: 0 auto;\n                  background: white;\n                  font-size: ${"a4"===v.printerType?"12px":"11px"};\n                  padding: ${"a4"===v.printerType?"20px":"0"};\n                }\n\n                .header {\n                  text-align: center;\n                  padding: ${"a4"===v.printerType?"20px 10px":"8px 4px"};\n                  background: ${t?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"#f8f9fa"};\n                  color: ${t?"white":"#000"};\n                  border-bottom: 2px solid ${t?"#764ba2":"#000"};\n                  margin-bottom: 8px;\n                  border-radius: ${"a4"===v.printerType?"8px 8px 0 0":"0"};\n                }\n\n                .clinic-logo {\n                  width: ${"a4"===v.printerType?"60px":"45px"};\n                  height: ${"a4"===v.printerType?"60px":"45px"};\n                  margin: 0 auto 6px;\n                  border-radius: 50%;\n                  background: ${t?"rgba(255,255,255,0.15)":"#e9ecef"};\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  font-size: ${"a4"===v.printerType?"20px":"14px"};\n                  font-weight: bold;\n                  color: ${t?"white":"#495057"};\n                  border: 2px solid ${t?"rgba(255,255,255,0.3)":"#dee2e6"};\n                  box-shadow: ${t?"0 2px 8px rgba(0,0,0,0.15)":"0 1px 4px rgba(0,0,0,0.1)"};\n                  overflow: hidden;\n                  flex-shrink: 0;\n                }\n\n                .clinic-logo img {\n                  width: 100%;\n                  height: 100%;\n                  object-fit: cover;\n                  border-radius: 50%;\n                  max-width: ${"a4"===v.printerType?"60px":"45px"};\n                  max-height: ${"a4"===v.printerType?"60px":"45px"};\n                }\n\n                .clinic-name {\n                  font-size: ${"a4"===v.printerType?"20px":"16px"};\n                  font-weight: bold;\n                  margin-bottom: 4px;\n                  text-transform: uppercase;\n                  text-shadow: ${t?"0 1px 2px rgba(0,0,0,0.3)":"none"};\n                }\n\n                .doctor-name {\n                  font-size: ${"a4"===v.printerType?"16px":"13px"};\n                  font-weight: bold;\n                  margin-bottom: 3px;\n                  opacity: ${t?"0.95":"1"};\n                }\n\n                .clinic-info {\n                  font-size: ${"a4"===v.printerType?"12px":"10px"};\n                  margin: 1px 0;\n                  line-height: 1.2;\n                  opacity: ${t?"0.9":"1"};\n                }\n\n                .receipt-title {\n                  font-size: ${"a4"===v.printerType?"18px":"14px"};\n                  font-weight: bold;\n                  text-align: center;\n                  padding: ${"a4"===v.printerType?"12px 0":"6px 0"};\n                  margin: 8px 0;\n                  background: ${t?"linear-gradient(90deg, #f8f9fa, #e9ecef, #f8f9fa)":"#f8f9fa"};\n                  border-top: 1px dashed #000;\n                  border-bottom: 1px dashed #000;\n                  color: #495057;\n                }\n\n                .content {\n                  padding: ${"a4"===v.printerType?"10px":"4px"};\n                }\n\n                .section {\n                  margin-bottom: ${"a4"===v.printerType?"15px":"8px"};\n                }\n\n                .info-row {\n                  display: flex;\n                  justify-content: space-between;\n                  margin: ${"a4"===v.printerType?"6px 0":"3px 0"};\n                  padding: ${"a4"===v.printerType?"4px 0":"2px 0"};\n                  font-size: ${"a4"===v.printerType?"13px":"11px"};\n                  border-bottom: 1px solid #f1f3f4;\n                }\n\n                .label {\n                  font-weight: bold;\n                  flex: 1;\n                  text-align: right;\n                  color: ${t?"#495057":"#000"};\n                }\n\n                .value {\n                  flex: 1;\n                  text-align: left;\n                  font-weight: normal;\n                  color: ${t?"#212529":"#000"};\n                }\n\n                .amount-section {\n                  background: ${t?"linear-gradient(135deg, #f8f9fa, #e9ecef)":"#f8f9fa"};\n                  border: 1px solid ${t?"#dee2e6":"#000"};\n                  border-radius: ${"a4"===v.printerType?"8px":"4px"};\n                  padding: ${"a4"===v.printerType?"15px":"6px"};\n                  margin-top: 8px;\n                }\n\n                .amount-row {\n                  display: flex;\n                  justify-content: space-between;\n                  margin: ${"a4"===v.printerType?"6px 0":"3px 0"};\n                  font-size: ${"a4"===v.printerType?"13px":"11px"};\n                  font-weight: 500;\n                }\n\n                .total-amount {\n                  font-size: ${"a4"===v.printerType?"18px":"14px"};\n                  font-weight: bold;\n                  text-align: center;\n                  padding: ${"a4"===v.printerType?"12px":"6px"};\n                  margin: 6px 0;\n                  background: ${t?"linear-gradient(135deg, #28a745, #20c997)":"#f0f0f0"};\n                  color: ${t?"white":"#000"};\n                  border: 2px solid ${t?"#28a745":"#000"};\n                  border-radius: ${"a4"===v.printerType?"8px":"4px"};\n                  box-shadow: ${t?"0 2px 10px rgba(40, 167, 69, 0.3)":"none"};\n                }\n\n                .qr-section, .barcode-section {\n                  text-align: center;\n                  margin: ${"a4"===v.printerType?"15px 0":"8px 0"};\n                  padding: ${"a4"===v.printerType?"10px":"5px"};\n                  background: ${t?"#f8f9fa":"white"};\n                  border: 1px dashed ${t?"#dee2e6":"#000"};\n                  border-radius: ${"a4"===v.printerType?"6px":"3px"};\n                }\n\n                .qr-placeholder, .barcode-placeholder {\n                  width: ${"a4"===v.printerType?"80px":"60px"};\n                  height: ${"a4"===v.printerType?"80px":"60px"};\n                  margin: 0 auto 5px;\n                  background: ${t?"linear-gradient(45deg, #000, #333)":"#000"};\n                  border-radius: 4px;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  color: white;\n                  font-size: ${"a4"===v.printerType?"10px":"8px"};\n                  font-weight: bold;\n                }\n\n                .barcode-placeholder {\n                  height: ${"a4"===v.printerType?"30px":"20px"};\n                  width: ${"a4"===v.printerType?"120px":"100px"};\n                  border-radius: 2px;\n                }\n\n                .bottom-section {\n                  display: flex;\n                  justify-content: space-between;\n                  align-items: flex-start;\n                  margin: 12px 0;\n                  gap: 15px;\n                  flex-wrap: wrap;\n                }\n\n                .qr-section {\n                  text-align: center;\n                  flex: 1;\n                  min-width: 80px;\n                }\n\n                .signature-section {\n                  flex: 1;\n                  min-width: 120px;\n                  text-align: center;\n                }\n\n                .signature-box {\n                  margin-bottom: 8px;\n                }\n\n                .signature-line {\n                  width: ${"a4"===v.printerType?"100px":"80px"};\n                  height: 1px;\n                  border-bottom: 1px solid #333;\n                  margin: 0 auto 4px;\n                }\n\n                .signature-label {\n                  font-size: ${"a4"===v.printerType?"10px":"8px"};\n                  color: #666;\n                  margin-bottom: 6px;\n                }\n\n                .stamp-box {\n                  margin-top: 6px;\n                }\n\n                .stamp-area {\n                  width: ${"a4"===v.printerType?"80px":"60px"};\n                  height: ${"a4"===v.printerType?"60px":"45px"};\n                  border: 2px dashed #999;\n                  border-radius: 50%;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  margin: 0 auto;\n                  background: rgba(0,0,0,0.02);\n                }\n\n                .stamp-placeholder {\n                  font-size: ${"a4"===v.printerType?"9px":"7px"};\n                  color: #999;\n                  text-align: center;\n                  line-height: 1.2;\n                }\n\n                .footer {\n                  text-align: center;\n                  padding: ${"a4"===v.printerType?"15px 10px":"6px 4px"};\n                  background: ${t?"linear-gradient(135deg, #f8f9fa, #e9ecef)":"#f8f9fa"};\n                  border-top: 2px solid ${t?"#dee2e6":"#000"};\n                  margin-top: 8px;\n                  font-size: ${"a4"===v.printerType?"12px":"10px"};\n                  border-radius: ${"a4"===v.printerType?"0 0 8px 8px":"0"};\n                }\n\n                .thank-you {\n                  font-size: ${"a4"===v.printerType?"16px":"12px"};\n                  font-weight: bold;\n                  margin-bottom: 3px;\n                  color: ${t?"#495057":"#000"};\n                }\n\n                .date-created {\n                  font-size: ${"a4"===v.printerType?"11px":"9px"};\n                  color: ${t?"#6c757d":"#666"};\n                }\n\n                .separator {\n                  text-align: center;\n                  margin: 6px 0;\n                  font-size: 16px;\n                  letter-spacing: 2px;\n                  color: ${t?"#dee2e6":"#000"};\n                }\n\n                /* Print optimizations */\n                @media print {\n                  body {\n                    margin: 0 !important;\n                    padding: 0 !important;\n                    background: white !important;\n                  }\n\n                  .receipt {\n                    box-shadow: none !important;\n                    border: none !important;\n                    margin: 0 !important;\n                  }\n\n                  .no-print {\n                    display: none !important;\n                  }\n\n                  .info-row, .amount-row {\n                    page-break-inside: avoid;\n                  }\n\n                  ${t?"\n                    .header {\n                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;\n                      color: white !important;\n                      -webkit-print-color-adjust: exact;\n                    }\n                    .total-amount {\n                      background: linear-gradient(135deg, #28a745, #20c997) !important;\n                      color: white !important;\n                      -webkit-print-color-adjust: exact;\n                    }\n                  ":""}\n                }\n\n                /* Screen display styles */\n                @media screen {\n                  body {\n                    padding: 20px;\n                    background: #f5f5f5;\n                  }\n\n                  .receipt {\n                    max-width: ${"a4"===v.printerType?"600px":"320px"};\n                    box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n                    border-radius: 12px;\n                    overflow: hidden;\n                    background: white;\n                    margin: 0 auto;\n                  }\n                }\n              </style>\n            </head>\n            <body>\n              ${f.current.innerHTML}\n            </body>\n          </html>\n        `),e.document.close(),e.print()}}},$=e=>({cash:"نقداً",card:"بطاقة ائتمان",bank_transfer:"تحويل بنكي",check:"شيك",insurance:"تأمين"}[e]||e),C=e=>({completed:"مكتمل",pending:"معلق",partial:"جزئي",overdue:"متأخر",failed:"فاشل",refunded:"مسترد"}[e]||e);return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"flex items-center text-xl font-semibold",children:[p.jsx(ui,{className:"w-5 h-5 ml-2"}),"إيصال الدفع"]}),p.jsxs(Hi,{children:["إيصال رقم ",n.receipt_number||n.id.slice(-6)]})]}),p.jsxs("div",{ref:f,className:"receipt",children:[p.jsxs("div",{className:"header",children:[v.includeLogo&&p.jsx("div",{className:"clinic-logo",style:{width:"60px",height:"60px",margin:"0 auto 8px",borderRadius:"50%",overflow:"hidden",border:"2px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",background:"#f8f9fa"},children:u&&""!==u.trim()?p.jsx("img",{src:u,alt:"شعار العيادة",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%",maxWidth:"60px",maxHeight:"60px"},onError:e=>{console.log("Logo failed to load:",u),e.currentTarget.style.display="none"}}):p.jsx("span",{style:{fontSize:"20px",fontWeight:"bold",color:"#495057"},children:l.charAt(0)})}),p.jsx("div",{className:"clinic-name",children:l}),c&&p.jsx("div",{className:"doctor-name",children:c}),h&&p.jsxs("div",{className:"clinic-info",children:["📞 ",h]}),g&&p.jsxs("div",{className:"clinic-info",children:["📍 ",g]}),x&&p.jsxs("div",{className:"clinic-info",children:["✉️ ",x]})]}),p.jsx("div",{className:"separator",children:"═══════════════════"}),p.jsxs("div",{className:"receipt-title",children:["إيصال دفع رقم ",n.receipt_number||`RCP-${n.id.slice(-6)}`]}),p.jsxs("div",{className:"content",children:[p.jsxs("div",{className:"section",children:[p.jsxs("div",{className:"info-row",children:[p.jsx("span",{className:"label",children:"التاريخ:"}),p.jsx("span",{className:"value",children:ma(n.payment_date)})]}),p.jsxs("div",{className:"info-row",children:[p.jsx("span",{className:"label",children:"الوقت:"}),p.jsx("span",{className:"value",children:new Date(n.payment_date).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!0})})]}),p.jsxs("div",{className:"info-row",children:[p.jsx("span",{className:"label",children:"المريض:"}),p.jsx("span",{className:"value",children:n.patient?n.patient.full_name||`${n.patient.first_name||""} ${n.patient.last_name||""}`.trim():"غير محدد"})]}),(null==(a=n.patient)?void 0:a.phone)&&p.jsxs("div",{className:"info-row",children:[p.jsx("span",{className:"label",children:"الهاتف:"}),p.jsx("span",{className:"value",children:n.patient.phone})]}),p.jsxs("div",{className:"info-row",children:[p.jsx("span",{className:"label",children:"طريقة الدفع:"}),p.jsx("span",{className:"value",children:$(n.payment_method)})]}),n.description&&p.jsxs("div",{className:"info-row",children:[p.jsx("span",{className:"label",children:"الوصف:"}),p.jsx("span",{className:"value",children:n.description})]}),p.jsxs("div",{className:"info-row",children:[p.jsx("span",{className:"label",children:"حالة الدفعة:"}),p.jsx("span",{className:"value",children:C(n.status)})]}),n.appointment_id&&p.jsxs("div",{className:"info-row",children:[p.jsx("span",{className:"label",children:"مرتبطة بموعد:"}),p.jsx("span",{className:"value",children:"نعم"})]})]}),p.jsx("div",{className:"separator",children:"- - - - - - - - - - - - - - - -"}),p.jsxs("div",{className:"amount-section",children:[p.jsxs("div",{className:"amount-row",children:[p.jsx("span",{children:"المبلغ المدفوع في هذه الدفعة:"}),p.jsx("span",{children:i(n.amount)})]}),n.discount_amount&&n.discount_amount>0&&p.jsxs("div",{className:"amount-row",children:[p.jsx("span",{children:"الخصم:"}),p.jsxs("span",{children:["-",i(n.discount_amount)]})]}),n.tax_amount&&n.tax_amount>0&&p.jsxs("div",{className:"amount-row",children:[p.jsx("span",{children:"الضريبة:"}),p.jsxs("span",{children:["+",i(n.tax_amount)]})]}),"partial"===n.status&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"separator",children:"- - - - - - - - - - - - - - - -"}),(n.total_amount_due||n.appointment_total_cost)&&p.jsxs("div",{className:"amount-row",children:[p.jsx("span",{children:"إجمالي المبلغ المطلوب:"}),p.jsx("span",{children:i(n.total_amount_due||n.appointment_total_cost||0)})]}),n.amount_paid&&p.jsxs("div",{className:"amount-row",children:[p.jsx("span",{children:"إجمالي المبلغ المدفوع:"}),p.jsx("span",{children:i(n.amount_paid)})]}),(()=>{let e=0;if(n.appointment_id){const t=n.total_amount_due||n.appointment_total_cost||0,a=n.amount_paid||n.amount||0;e=Math.max(0,t-a)}else{const t=n.total_amount_due||n.amount||0,a=n.amount_paid||n.amount||0;e=Math.max(0,t-a)}return e>0?p.jsxs("div",{className:"amount-row",style:{color:"#dc3545",fontWeight:"bold"},children:[p.jsx("span",{children:"المبلغ المتبقي:"}),p.jsx("span",{children:i(e)})]}):null})()]}),p.jsx("div",{className:"separator",children:"═══════════════════"}),p.jsxs("div",{className:"total-amount",children:["المبلغ الإجمالي لهذه الدفعة: ",i(n.total_amount||n.amount+(n.tax_amount||0)-(n.discount_amount||0))]})]}),p.jsxs("div",{className:"bottom-section",children:[v.includeQR&&p.jsxs("div",{className:"qr-section",children:[w?p.jsx("img",{src:w,alt:"QR Code للتحقق من الإيصال",style:{width:"a4"===v.printerType?"80px":"60px",height:"a4"===v.printerType?"80px":"60px",margin:"0 auto"}}):p.jsx("div",{className:"qr-placeholder",children:"QR"}),p.jsx("div",{style:{fontSize:"8px",color:"#666",marginTop:"4px"},children:"امسح للتحقق من الإيصال"})]}),p.jsxs("div",{className:"signature-section",children:[p.jsxs("div",{className:"signature-box",children:[p.jsx("div",{className:"signature-line"}),p.jsx("div",{className:"signature-label",children:"توقيع الطبيب"})]}),p.jsx("div",{className:"stamp-box",children:p.jsx("div",{className:"stamp-area",children:p.jsx("div",{className:"stamp-placeholder",children:"ختم العيادة"})})})]})]}),v.includeBarcode&&p.jsxs("div",{className:"barcode-section",children:[_?p.jsx("img",{src:_,alt:"باركود الإيصال",style:{width:"a4"===v.printerType?"120px":"100px",height:"a4"===v.printerType?"30px":"20px",margin:"0 auto"}}):p.jsx("div",{className:"barcode-placeholder",children:S()}),p.jsx("div",{style:{fontSize:"8px",color:"#666",marginTop:"2px"},children:S()})]}),p.jsxs("div",{className:"section",children:[p.jsx("div",{className:"separator",children:"- - - - - - - - - - - - - - - -"}),p.jsxs("div",{style:{fontSize:"9px",color:"#666",textAlign:"center",margin:"4px 0"},children:[p.jsxs("div",{children:["معرف الدفعة: ",n.id.slice(-8)]}),p.jsxs("div",{children:["طريقة الدفع: ",$(n.payment_method)]}),"partial"===n.status&&p.jsx("div",{style:{color:"#dc3545",fontWeight:"bold"},children:"⚠️ دفعة جزئية - يرجى الاحتفاظ بالإيصال"}),p.jsxs("div",{style:{marginTop:"4px"},children:["تاريخ الطباعة: ",(new Date).toLocaleDateString("ar-SA")," - ",(new Date).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})]})]})]})]}),p.jsxs("div",{className:"footer",children:[p.jsx("div",{className:"separator",children:"═══════════════════"}),p.jsx("div",{className:"thank-you",children:"شكراً لثقتكم بنا"}),p.jsxs("div",{className:"date-created",children:["تم الإنشاء: ",ma((new Date).toISOString())]}),p.jsx("div",{className:"separator",children:"═══════════════════"})]})]}),p.jsxs("div",{className:"border-t bg-muted/30 p-4 space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("h3",{className:"text-sm font-medium flex items-center",children:[p.jsx(xi,{className:"w-4 h-4 ml-2"}),"إعدادات الطباعة"]}),p.jsxs(Qi,{variant:"ghost",size:"sm",onClick:()=>j(!b),className:"text-xs",children:[p.jsx(Fr,{className:"w-3 h-3 ml-1"}),b?"إخفاء المعاينة":"معاينة"]})]}),p.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[p.jsxs("div",{className:"space-y-1",children:[p.jsx("label",{className:"text-xs font-medium",children:"نوع الطابعة"}),p.jsxs(el,{value:v.printerType,onValueChange:e=>y(t=>d(o({},t),{printerType:e})),children:[p.jsx(al,{className:"h-8 text-xs",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"58mm",children:"حرارية 58mm"}),p.jsx(dl,{value:"80mm",children:"حرارية 80mm"}),p.jsx(dl,{value:"a4",children:"عادية A4"})]})]})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsx("label",{className:"text-xs font-medium",children:"نمط الألوان"}),p.jsxs(el,{value:v.colorMode,onValueChange:e=>y(t=>d(o({},t),{colorMode:e})),children:[p.jsx(al,{className:"h-8 text-xs",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"color",children:"ملون"}),p.jsx(dl,{value:"bw",children:"أبيض وأسود"})]})]})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("input",{type:"checkbox",id:"includeLogo",checked:v.includeLogo,onChange:e=>y(t=>d(o({},t),{includeLogo:e.target.checked})),className:"rounded border-gray-300"}),p.jsx("label",{htmlFor:"includeLogo",className:"text-xs font-medium",children:"تضمين الشعار"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("input",{type:"checkbox",id:"includeQR",checked:v.includeQR,onChange:e=>y(t=>d(o({},t),{includeQR:e.target.checked})),className:"rounded border-gray-300"}),p.jsx("label",{htmlFor:"includeQR",className:"text-xs font-medium",children:"QR Code"})]})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("input",{type:"checkbox",id:"includeBarcode",checked:v.includeBarcode,onChange:e=>y(t=>d(o({},t),{includeBarcode:e.target.checked})),className:"rounded border-gray-300"}),p.jsx("label",{htmlFor:"includeBarcode",className:"text-xs font-medium",children:"تضمين الباركود"})]})]}),p.jsxs(qi,{className:"flex justify-end space-x-2 space-x-reverse",children:[p.jsx(Qi,{variant:"outline",onClick:()=>t(!1),children:"إغلاق"}),p.jsxs(Qi,{variant:"outline",onClick:()=>{D()},children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تحميل PDF"]}),p.jsxs(Qi,{variant:"outline",onClick:()=>{if(f.current){const e=window.open("","_blank");e&&(e.document.write(`\n          <html>\n            <head>\n              <title>إيصال حراري - ${n.receipt_number||n.id.slice(-6)}</title>\n              <style>\n                @page {\n                  size: 80mm auto;\n                  margin: 0;\n                }\n                body {\n                  font-family: 'Courier New', monospace;\n                  direction: rtl;\n                  margin: 0;\n                  padding: 2mm;\n                  font-size: 10px;\n                  line-height: 1.2;\n                  color: #000;\n                  background: white;\n                  width: 76mm;\n                }\n                .receipt {\n                  width: 100%;\n                  font-size: 10px;\n                }\n                .header {\n                  text-align: center;\n                  margin-bottom: 4px;\n                  border-bottom: 1px solid #000;\n                  padding-bottom: 2px;\n                }\n                .clinic-name {\n                  font-size: 12px;\n                  font-weight: bold;\n                  margin-bottom: 1px;\n                }\n                .doctor-name {\n                  font-size: 10px;\n                  font-weight: bold;\n                }\n                .clinic-info {\n                  font-size: 8px;\n                  margin: 0;\n                }\n                .receipt-title {\n                  font-size: 11px;\n                  font-weight: bold;\n                  text-align: center;\n                  margin: 3px 0;\n                  border-top: 1px dashed #000;\n                  border-bottom: 1px dashed #000;\n                  padding: 2px 0;\n                }\n                .info-row, .amount-row {\n                  display: flex;\n                  justify-content: space-between;\n                  margin: 1px 0;\n                  font-size: 9px;\n                }\n                .separator {\n                  text-align: center;\n                  margin: 2px 0;\n                  font-size: 8px;\n                }\n                .total-amount {\n                  font-size: 11px;\n                  font-weight: bold;\n                  text-align: center;\n                  margin: 3px 0;\n                  border: 1px solid #000;\n                  padding: 2px;\n                }\n                .footer {\n                  text-align: center;\n                  margin-top: 4px;\n                  border-top: 1px solid #000;\n                  padding-top: 2px;\n                  font-size: 8px;\n                }\n                .thank-you {\n                  font-size: 9px;\n                  font-weight: bold;\n                }\n                .bottom-section {\n                  display: flex;\n                  justify-content: space-between;\n                  align-items: flex-start;\n                  margin: 4px 0;\n                  gap: 6px;\n                  flex-wrap: wrap;\n                }\n                .qr-section {\n                  text-align: center;\n                  flex: 1;\n                  min-width: 50px;\n                }\n                .signature-section {\n                  flex: 1;\n                  min-width: 70px;\n                  text-align: center;\n                }\n                .signature-line {\n                  width: 50px;\n                  height: 1px;\n                  border-bottom: 1px solid #000;\n                  margin: 0 auto 2px;\n                }\n                .signature-label {\n                  font-size: 6px;\n                  margin-bottom: 2px;\n                }\n                .stamp-area {\n                  width: 35px;\n                  height: 25px;\n                  border: 1px dashed #000;\n                  border-radius: 50%;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  margin: 0 auto;\n                  background: rgba(0,0,0,0.02);\n                }\n                .stamp-placeholder {\n                  font-size: 5px;\n                  text-align: center;\n                  line-height: 1.1;\n                }\n              </style>\n            </head>\n            <body>\n              ${f.current.innerHTML}\n            </body>\n          </html>\n        `),e.document.close(),e.print())}},className:"bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-200",children:[p.jsx(ci,{className:"w-4 h-4 ml-2"}),"طباعة حرارية"]}),p.jsxs(Qi,{onClick:D,className:"bg-green-600 hover:bg-green-700 text-white",children:[p.jsx(ci,{className:"w-4 h-4 ml-2"}),"طباعة ذكية"]})]})]})})}function Zd({open:e,onOpenChange:t,payment:n,patients:a}){const{formatAmount:s}=Sa();if(!n)return null;const r=a.find(e=>e.id===n.patient_id);return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-background border-border shadow-2xl",dir:"rtl",children:[p.jsxs(Vi,{className:"border-b border-border pb-4",children:[p.jsxs(Ui,{className:"flex items-center text-xl font-semibold text-foreground",children:[p.jsx(Fr,{className:"w-5 h-5 ml-2 text-primary"}),"تفاصيل الدفعة"]}),p.jsxs(Hi,{className:"text-muted-foreground",children:["عرض تفاصيل شاملة للدفعة رقم ",n.receipt_number||n.id.slice(-6)]})]}),p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(Ai,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات المريض"]})}),p.jsxs(Yo,{className:"space-y-3",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"الاسم:"}),p.jsx("span",{className:"text-sm font-medium text-foreground",children:(null==r?void 0:r.full_name)||"غير محدد"})]}),(null==r?void 0:r.phone)&&p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"الهاتف:"}),p.jsx("span",{className:"text-sm text-foreground",children:r.phone})]}),(null==r?void 0:r.date_of_birth)&&p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"تاريخ الميلاد:"}),p.jsx("span",{className:"text-sm text-foreground",children:ma(r.date_of_birth)})]})]})]}),p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx($r,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات الدفعة"]})}),p.jsxs(Yo,{className:"space-y-3",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"رقم الإيصال:"}),p.jsx("span",{className:"text-sm font-medium text-foreground",children:n.receipt_number||n.id.slice(-6)})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"تاريخ الدفع:"}),p.jsx("span",{className:"text-sm text-foreground",children:ma(n.payment_date)})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"طريقة الدفع:"}),p.jsx(qo,{variant:"outline",className:"text-xs",children:(e=>{switch(e){case"cash":return"نقدي";case"bank_transfer":return"تحويل بنكي";default:return e}})(n.payment_method)})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"الحالة:"}),(e=>{switch(e){case"completed":return p.jsxs(qo,{variant:"default",className:"bg-green-100 text-green-800 border-green-200",children:[p.jsx(gr,{className:"w-3 h-3 ml-1"}),"مكتملة"]});case"partial":return p.jsxs(qo,{variant:"default",className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:[p.jsx(ar,{className:"w-3 h-3 ml-1"}),"جزئية"]});case"pending":return p.jsxs(qo,{variant:"default",className:"bg-orange-100 text-orange-800 border-orange-200",children:[p.jsx(Sr,{className:"w-3 h-3 ml-1"}),"معلقة"]});default:return p.jsx(qo,{variant:"outline",children:e})}})(n.status)]})]})]})]}),p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(Er,{className:"w-4 h-4 ml-2 text-primary"}),"التفاصيل المالية"]})}),p.jsx(Yo,{children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsxs("div",{className:"text-center p-4 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-800",children:[p.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:s(n.amount)}),p.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400 mt-1",children:"المبلغ المدفوع"})]}),n.discount_amount&&n.discount_amount>0&&p.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-950/30 rounded-lg border border-green-200 dark:border-green-800",children:[p.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:s(n.discount_amount)}),p.jsx("div",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:"الخصم"})]}),n.tax_amount&&n.tax_amount>0&&p.jsxs("div",{className:"text-center p-4 bg-orange-50 dark:bg-orange-950/30 rounded-lg border border-orange-200 dark:border-orange-800",children:[p.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:s(n.tax_amount)}),p.jsx("div",{className:"text-sm text-orange-600 dark:text-orange-400 mt-1",children:"الضريبة"})]}),p.jsxs("div",{className:"text-center p-4 bg-purple-50 dark:bg-purple-950/30 rounded-lg border border-purple-200 dark:border-purple-800",children:[p.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:s(n.total_amount||n.amount+(n.tax_amount||0)-(n.discount_amount||0))}),p.jsx("div",{className:"text-sm text-purple-600 dark:text-purple-400 mt-1",children:"المبلغ الإجمالي"})]})]})})]}),n.tooth_treatment&&p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(nr,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات العلاج"]})}),p.jsxs(Yo,{className:"space-y-3",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"نوع العلاج:"}),p.jsx("span",{className:"text-sm font-medium text-foreground",children:ud(n.tooth_treatment.treatment_type)})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"رقم السن:"}),p.jsx("span",{className:"text-sm text-foreground",children:n.tooth_treatment.tooth_number})]}),n.tooth_treatment.tooth_name&&p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"اسم السن:"}),p.jsx("span",{className:"text-sm text-foreground",children:n.tooth_treatment.tooth_name})]}),n.tooth_treatment.cost&&p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"تكلفة العلاج:"}),p.jsx("span",{className:"text-sm font-medium text-foreground",children:s(n.tooth_treatment.cost)})]})]})]}),n.appointment&&p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(hr,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات الموعد"]})}),p.jsxs(Yo,{className:"space-y-3",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"تاريخ الموعد:"}),p.jsx("span",{className:"text-sm text-foreground",children:ma(n.appointment.appointment_date)})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"الوقت:"}),p.jsx("span",{className:"text-sm text-foreground",children:n.appointment.appointment_time})]}),n.appointment.notes&&p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"ملاحظات:"}),p.jsx("span",{className:"text-sm text-foreground text-right max-w-xs",children:n.appointment.notes})]})]})]}),(n.description||n.notes)&&p.jsxs(Lo,{className:"border-border bg-card shadow-sm",children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(Pr,{className:"w-4 h-4 ml-2 text-primary"}),"ملاحظات إضافية"]})}),p.jsxs(Yo,{className:"space-y-3",children:[n.description&&p.jsxs("div",{children:[p.jsx("span",{className:"text-sm text-muted-foreground block mb-1",children:"الوصف:"}),p.jsx("p",{className:"text-sm text-foreground bg-muted/30 p-3 rounded border",children:n.description})]}),n.notes&&p.jsxs("div",{children:[p.jsx("span",{className:"text-sm text-muted-foreground block mb-1",children:"ملاحظات:"}),p.jsx("p",{className:"text-sm text-foreground bg-muted/30 p-3 rounded border",children:n.notes})]})]})]}),p.jsxs(Lo,{className:"border-border bg-muted/30 shadow-sm",children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"flex items-center text-lg text-card-foreground",children:[p.jsx(Sr,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات النظام"]})}),p.jsxs(Yo,{className:"space-y-3",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"تاريخ الإنشاء:"}),p.jsx("span",{className:"text-sm text-foreground",children:ma(n.created_at)})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"آخر تحديث:"}),p.jsx("span",{className:"text-sm text-foreground",children:ma(n.updated_at)})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"معرف الدفعة:"}),p.jsx("span",{className:"text-xs font-mono text-foreground bg-background px-2 py-1 rounded border",children:n.id})]})]})]})]})]})})}const Qd=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",{className:"relative w-full overflow-auto",children:p.jsx("table",o({ref:t,className:aa("w-full caption-bottom text-sm",a)},s))})});Qd.displayName="Table";const Xd=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("thead",o({ref:t,className:aa("[&_tr]:border-b",a)},s))});Xd.displayName="TableHeader";const Jd=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("tbody",o({ref:t,className:aa("[&_tr:last-child]:border-0",a)},s))});Jd.displayName="TableBody";ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("tfoot",o({ref:t,className:aa("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a)},s))}).displayName="TableFooter";const ec=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("tr",o({ref:t,className:aa("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a)},s))});ec.displayName="TableRow";const tc=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("th",o({ref:t,className:aa("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a)},s))});tc.displayName="TableHead";const nc=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("td",o({ref:t,className:aa("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a)},s))});nc.displayName="TableCell";function ac({payments:e,patients:t,isLoading:n,onEdit:a,onDelete:s,onShowReceipt:r,onViewDetails:i}){const[l,o]=ve.useState("payment_date"),[d,c]=ve.useState("desc"),[u,m]=ve.useState(1),[h,x]=ve.useState(10),g=ve.useMemo(()=>{const e=new Map;return t.forEach(t=>{e.set(t.id,t)}),e},[t]),f=e=>{var t,n,a;if(null==(t=e.patient)?void 0:t.full_name)return e.patient.full_name;if((null==(n=e.patient)?void 0:n.first_name)||(null==(a=e.patient)?void 0:a.last_name))return`${e.patient.first_name||""} ${e.patient.last_name||""}`.trim();const s=g.get(e.patient_id);return(null==s?void 0:s.full_name)||"مريض غير معروف"},v=ve.useMemo(()=>{let t=[...e];return t.sort((e,t)=>{let n,a;switch(l){case"patient_name":n=f(e),a=f(t);break;case"payment_date":n=new Date(e.payment_date),a=new Date(t.payment_date);break;case"amount":n=e.amount,a=t.amount;break;case"payment_method":n=e.payment_method,a=t.payment_method;break;case"status":n=e.status,a=t.status;break;case"receipt_number":n=e.receipt_number||"",a=t.receipt_number||"";break;default:return 0}return n<a?"asc"===d?-1:1:n>a?"asc"===d?1:-1:0}),t},[e,l,d,g]),y=Math.ceil(v.length/h),b=(u-1)*h,j=v.slice(b,b+h),w=({field:e,children:t})=>p.jsx(tc,{className:"cursor-pointer hover:bg-muted/50 text-center",onClick:()=>(e=>{l===e?c("asc"===d?"desc":"asc"):(o(e),c("asc"))})(e),children:p.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[t,l===e?"asc"===d?p.jsx(or,{className:"w-4 h-4"}):p.jsx(rr,{className:"w-4 h-4"}):p.jsx(lr,{className:"w-4 h-4 opacity-50"})]})}),N=e=>{const t={completed:{label:"مكتمل",variant:"default"},partial:{label:"جزئي",variant:"outline"},pending:{label:"معلق",variant:"secondary"}}[e]||{label:e,variant:"outline"};return p.jsx(qo,{variant:t.variant,children:t.label})};return n?p.jsx("div",{className:"border rounded-lg",children:p.jsxs(Qd,{children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{children:"رقم الإيصال"}),p.jsx(tc,{children:"المريض"}),p.jsx(tc,{children:"المبلغ"}),p.jsx(tc,{children:"طريقة الدفع"}),p.jsx(tc,{children:"الحالة"}),p.jsx(tc,{children:"تاريخ الدفع"}),p.jsx(tc,{children:"الإجراءات"})]})}),p.jsx(Jd,{children:[...Array(5)].map((e,t)=>p.jsx(ec,{children:[...Array(7)].map((e,t)=>p.jsx(nc,{children:p.jsx("div",{className:"h-4 bg-muted animate-pulse rounded"})},t))},t))})]})}):0===v.length?p.jsx("div",{className:"border rounded-lg",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-center",children:"#"}),p.jsx(w,{field:"patient_name",children:"المريض"}),p.jsx(tc,{className:"text-center",children:"العلاج/الموعد"}),p.jsx(w,{field:"amount",children:"المبلغ والرصيد"}),p.jsx(w,{field:"payment_method",children:"طريقة الدفع"}),p.jsx(w,{field:"status",children:"الحالة"}),p.jsx(w,{field:"payment_date",children:"تاريخ الدفع"}),p.jsx(tc,{className:"text-center",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"الإجراءات"})})]})}),p.jsx(Jd,{children:p.jsx(ec,{children:p.jsx(nc,{colSpan:8,className:"text-center py-8",children:p.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[p.jsx(Er,{className:"w-12 h-12 text-muted-foreground opacity-50"}),p.jsx("p",{className:"text-muted-foreground",children:"لم يتم تسجيل أي مدفوعات بعد"})]})})})})]})}):p.jsxs("div",{className:"space-y-4",dir:"rtl",children:[p.jsx("div",{className:"border rounded-lg overflow-hidden",children:p.jsx("div",{className:"overflow-x-auto",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{className:"bg-muted/50",children:[p.jsx(tc,{className:"text-center",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"#"})}),p.jsx(w,{field:"patient_name",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"المريض"})}),p.jsx(tc,{className:"text-center",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"العلاج/الموعد"})}),p.jsx(w,{field:"amount",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"المبلغ والرصيد"})}),p.jsx(w,{field:"payment_method",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"طريقة الدفع"})}),p.jsx(w,{field:"status",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"الحالة"})}),p.jsx(w,{field:"payment_date",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"تاريخ الدفع"})}),p.jsx(tc,{className:"text-center",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"الإجراءات"})})]})}),p.jsx(Jd,{children:j.map((e,t)=>{var n,l,o;return p.jsxs(ec,{className:"hover:bg-muted/50",children:[p.jsx(nc,{className:"font-medium text-center",children:b+t+1}),p.jsx(nc,{className:"font-medium text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:f(e).charAt(0)}),p.jsx("span",{className:"arabic-enhanced",children:f(e)})]})}),p.jsx(nc,{className:"text-center",children:e.tooth_treatment_id?p.jsxs("div",{className:"space-y-1",children:[p.jsxs("div",{className:"text-sm font-medium arabic-enhanced text-blue-600 dark:text-blue-400",children:["السن ",null==(n=e.tooth_treatment)?void 0:n.tooth_number]}),p.jsx("div",{className:"text-xs text-muted-foreground",children:ud((null==(l=e.tooth_treatment)?void 0:l.treatment_type)||"")}),e.treatment_total_cost&&p.jsxs("div",{className:"text-xs text-muted-foreground",children:["تكلفة: ",ca(e.treatment_total_cost)]}),void 0!==e.treatment_remaining_balance&&e.treatment_remaining_balance>0&&p.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["متبقي: ",ca(e.treatment_remaining_balance)]})]}):e.appointment_id?p.jsxs("div",{className:"space-y-1",children:[(()=>{var t;const n=null==(t=e.appointment)?void 0:t.start_time;if(n)try{const e=new Date(n);if(!isNaN(e.getTime()))return p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"text-sm font-medium arabic-enhanced",children:e.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"})}),p.jsx("div",{className:"text-xs text-muted-foreground",children:e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!0})})]})}catch(a){console.error("Error parsing appointment date:",a)}return p.jsx("div",{className:"text-sm font-medium arabic-enhanced",children:"موعد محدد"})})(),e.appointment_total_cost&&p.jsxs("div",{className:"text-xs text-muted-foreground",children:["تكلفة: ",ca(e.appointment_total_cost)]}),void 0!==e.appointment_remaining_balance&&e.appointment_remaining_balance>0&&p.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["متبقي: ",ca(e.appointment_remaining_balance)]})]}):p.jsx("div",{className:"text-sm text-muted-foreground arabic-enhanced",children:"دفعة عامة"})}),p.jsx(nc,{className:"text-center",children:p.jsxs("div",{className:"space-y-1",children:[p.jsx("div",{className:"font-medium text-lg",children:ca(e.amount)}),e.tooth_treatment_id?p.jsxs(p.Fragment,{children:[e.treatment_total_cost&&p.jsxs("div",{className:"text-xs text-muted-foreground",children:["من أصل ",ca(e.treatment_total_cost)]}),e.treatment_total_paid&&p.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:["إجمالي مدفوع: ",ca(e.treatment_total_paid)]}),e.treatment_remaining_balance&&e.treatment_remaining_balance>0&&p.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["متبقي: ",ca(e.treatment_remaining_balance)]})]}):e.appointment_id?p.jsxs(p.Fragment,{children:[e.total_amount_due&&p.jsxs("div",{className:"text-xs text-muted-foreground",children:["من أصل ",ca(e.total_amount_due)]}),e.total_amount_due&&e.amount_paid&&p.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:["إجمالي مدفوع: ",ca(e.amount_paid)]}),e.remaining_balance&&e.remaining_balance>0&&p.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["متبقي: ",ca(e.remaining_balance)]})]}):p.jsxs(p.Fragment,{children:[e.total_amount_due&&p.jsxs("div",{className:"text-xs text-muted-foreground",children:["من أصل ",ca(e.total_amount_due)]}),e.total_amount_due&&(()=>{const t=e.total_amount_due||0,n=e.amount||0,a=Math.max(0,t-n);return a>0&&p.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["متبقي: ",ca(a)]})})()]})]})}),p.jsx(nc,{className:"text-center",children:p.jsx(qo,{variant:"outline",className:"arabic-enhanced",children:(o=e.payment_method,{cash:"نقداً",bank_transfer:"تحويل بنكي"}[o]||o)})}),p.jsx(nc,{className:"text-center",children:N(e.status)}),p.jsx(nc,{className:"text-center",children:p.jsx("div",{className:"text-sm arabic-enhanced",children:ma(e.payment_date)})}),p.jsx(nc,{className:"min-w-[220px] text-center",children:p.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-details text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>i(e),title:"عرض التفاصيل",children:[p.jsx(Fr,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"تفاصيل"})]}),p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-receipt",onClick:()=>r(e),children:[p.jsx(ci,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"إيصال"})]}),p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:()=>a(e),children:[p.jsx(si,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:()=>s(e),children:[p.jsx(Ni,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]})]})})]},e.id)})})]})})}),v.length>0&&p.jsxs("div",{className:"flex items-center justify-between px-2",children:[p.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:p.jsxs("p",{className:"text-sm text-muted-foreground arabic-enhanced",children:["عرض ",b+1," إلى ",Math.min(b+h,v.length)," من ",v.length," مدفوعة"]})}),p.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),p.jsxs(el,{value:`${h}`,onValueChange:e=>{x(Number(e)),m(1)},children:[p.jsx(al,{className:"h-8 w-[70px]",children:p.jsx(nl,{placeholder:h})}),p.jsx(il,{side:"top",children:[5,10,20,30,50].map(e=>p.jsx(dl,{value:`${e}`,children:e},e))})]})]}),p.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",u," من ",y]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>m(1),disabled:1===u,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),p.jsx(Nr,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>m(u-1),disabled:1===u,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),p.jsx(br,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>m(u+1),disabled:u===y,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),p.jsx(yr,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>m(y),disabled:u===y,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),p.jsx(wr,{className:"h-4 w-4"})]})]})]})]})]})}ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("caption",o({ref:t,className:aa("mt-4 text-sm text-muted-foreground",a)},s))}).displayName="TableCaption";const sc=new class{getIcon(e,t){if(t)switch(t){case"save":return p.jsx(pi,{className:"w-4 h-4"});case"delete":return p.jsx(Ni,{className:"w-4 h-4"});case"export":case"backup":return p.jsx(Tr,{className:"w-4 h-4"});case"import":case"restore":return p.jsx(Di,{className:"w-4 h-4"});case"update":return p.jsx(mi,{className:"w-4 h-4"})}switch(e){case"success":return p.jsx(gr,{className:"w-4 h-4"});case"error":return p.jsx(Ri,{className:"w-4 h-4"});case"warning":return p.jsx(sr,{className:"w-4 h-4"});default:return p.jsx(Br,{className:"w-4 h-4"})}}getDefaultTitle(e,t){if(t)switch(t){case"save":return"success"===e?"تم الحفظ بنجاح":"error"===e?"فشل في الحفظ":"جاري الحفظ...";case"delete":return"success"===e?"تم الحذف بنجاح":"error"===e?"فشل في الحذف":"جاري الحذف...";case"export":return"success"===e?"تم التصدير بنجاح":"error"===e?"فشل في التصدير":"جاري التصدير...";case"import":return"success"===e?"تم الاستيراد بنجاح":"error"===e?"فشل في الاستيراد":"جاري الاستيراد...";case"backup":return"success"===e?"تم إنشاء النسخة الاحتياطية":"error"===e?"فشل في إنشاء النسخة الاحتياطية":"جاري إنشاء النسخة الاحتياطية...";case"restore":return"success"===e?"تم استعادة النسخة الاحتياطية":"error"===e?"فشل في استعادة النسخة الاحتياطية":"جاري استعادة النسخة الاحتياطية...";case"update":return"success"===e?"تم التحديث بنجاح":"error"===e?"فشل في التحديث":"جاري التحديث...";case"create":return"success"===e?"تم الإنشاء بنجاح":"error"===e?"فشل في الإنشاء":"جاري الإنشاء..."}switch(e){case"success":return"نجح";case"error":return"خطأ";case"warning":return"تحذير";case"info":return"معلومات";case"loading":return"جاري التحميل...";default:return"إشعار"}}getVariant(e){return"error"===e?"destructive":"default"}show(e){const{title:t,description:n,type:a,action:s,duration:r=3e3,showIcon:i=!0,actionButton:l}=e,o=t||this.getDefaultTitle(a,s),d=i?this.getIcon(a,s):null;return vl({title:p.jsxs("div",{className:"flex items-center gap-2 text-right",dir:"rtl",children:[d,p.jsx("span",{children:o})]}),description:p.jsx("div",{className:"text-right mt-1",dir:"rtl",children:n}),variant:this.getVariant(a),duration:"loading"===a?0:r,action:l?p.jsx("button",{onClick:l.onClick,className:"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring",children:l.label}):void 0})}success(e,t,n){return this.show(o({description:e,type:"success",action:t},n))}error(e,t,n){return this.show(o({description:e,type:"error",action:t},n))}warning(e,t,n){return this.show(o({description:e,type:"warning",action:t},n))}info(e,t,n){return this.show(o({description:e,type:"info",action:t},n))}loading(e,t,n){return this.show(o({description:e,type:"loading",action:t},n))}saveSuccess(e="تم حفظ البيانات بنجاح"){return this.success(e,"save")}saveError(e="فشل في حفظ البيانات"){return this.error(e,"save")}deleteSuccess(e="تم حذف العنصر بنجاح"){return this.success(e,"delete")}deleteError(e="فشل في حذف العنصر"){return this.error(e,"delete")}exportSuccess(e="تم تصدير البيانات بنجاح"){return this.success(e,"export")}exportError(e="فشل في تصدير البيانات"){return this.error(e,"export")}noDataToExport(e="لا توجد بيانات للتصدير"){return this.warning(e,"export")}backupSuccess(e="تم إنشاء النسخة الاحتياطية بنجاح"){return this.success(e,"backup")}backupError(e="فشل في إنشاء النسخة الاحتياطية"){return this.error(e,"backup")}restoreSuccess(e="تم استعادة النسخة الاحتياطية بنجاح"){return this.success(e,"restore")}restoreError(e="فشل في استعادة النسخة الاحتياطية"){return this.error(e,"restore")}testSuccess(e="نجح الاختبار بنجاح"){return this.success(e,"update")}testError(e="فشل الاختبار"){return this.error(e,"update")}},rc=sc;let ic=class{static generateFileName(e,t,n){const a=new Date,s=`${a.getDate().toString().padStart(2,"0")}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getFullYear()}`,r=a.toTimeString().split(" ")[0].replace(/:/g,"-");let i=`${{patients:"تقرير_المرضى",appointments:"تقرير_المواعيد",financial:"التقرير_المالي",inventory:"تقرير_المخزون",analytics:"تقرير_التحليلات",overview:"التقرير_الشامل",comprehensive:"التقرير_الشامل_المفصل",treatments:"تقرير_العلاجات"}[e]||`تقرير_${e}`}_${s}`;return(null==n?void 0:n.includeTime)&&(i+=`_${r}`),(null==n?void 0:n.customSuffix)&&(i+=`_${n.customSuffix}`),`${i}.${t}`}static exportReport(e,t,n){return m(this,null,function*(){try{switch(n.format){case"pdf":return yield this.exportToPDF(e,t,n);case"excel":return yield this.exportToExcel(e,t,n);case"csv":return yield this.exportToCSV(e,t,n);default:throw new Error("Unsupported export format")}}catch(a){throw console.error("Export error:",a),a}})}static exportToPDF(e,t,n){return m(this,null,function*(){try{const a=this.createReportHTML(e,t,n),s=this.generateFileName(e,"pdf",{includeTime:!0});return yield this.convertHTMLToPDF(a,s),s}catch(a){throw console.error("Error exporting to PDF:",a),new Error("فشل في تصدير التقرير إلى PDF")}})}static convertHTMLToPDF(e,t){return m(this,null,function*(){try{const n=document.createElement("div");n.innerHTML=e,n.style.position="absolute",n.style.left="-9999px",n.style.top="-9999px",n.style.width="800px",n.style.fontFamily="Arial, sans-serif",n.style.direction="rtl",n.style.fontSize="14px",n.style.lineHeight="1.6",n.style.color="#000",n.style.background="#fff",n.style.padding="20px",document.body.appendChild(n),yield new Promise(e=>setTimeout(e,100));const a=yield vt(n,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:800,height:n.scrollHeight,scrollX:0,scrollY:0});document.body.removeChild(n);const s=a.toDataURL("image/png"),r=new yt({orientation:"portrait",unit:"mm",format:"a4"}),i=r.internal.pageSize.getWidth(),l=r.internal.pageSize.getHeight(),o=i-20,d=a.height*o/a.width;let c=d,u=10;for(r.addImage(s,"PNG",10,u,o,d),c-=l-20;c>=0;)u=c-d+10,r.addPage(),r.addImage(s,"PNG",10,u,o,d),c-=l-20;r.save(t)}catch(n){throw console.error("Error converting HTML to PDF:",n),new Error("فشل في تحويل التقرير إلى PDF")}})}static createReportHTML(e,t,n){const a={patients:"تقرير المرضى",appointments:"تقرير المواعيد",financial:"التقرير المالي",inventory:"تقرير المخزون",analytics:"تقرير التحليلات",overview:"التقرير الشامل"}[e]||"تقرير";return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>${a}</title>\n        <style>\n          body {\n            font-family: 'Arial', sans-serif;\n            direction: rtl;\n            margin: 0;\n            padding: 20px;\n            background: #fff;\n            color: #000;\n            line-height: 1.6;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 2px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-name {\n            font-size: 24px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .report-date {\n            font-size: 14px;\n            color: #64748b;\n          }\n          .summary-cards {\n            display: flex;\n            justify-content: space-around;\n            margin: 30px 0;\n            flex-wrap: wrap;\n          }\n          .summary-card {\n            background: #f8fafc;\n            padding: 20px;\n            border-radius: 8px;\n            text-align: center;\n            min-width: 150px;\n            margin: 5px;\n            border: 1px solid #e2e8f0;\n          }\n          .summary-card h3 {\n            margin: 0 0 10px 0;\n            font-size: 16px;\n            color: #1e293b;\n          }\n          .summary-card .number {\n            font-size: 24px;\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          .section {\n            margin: 30px 0;\n          }\n          .section-title {\n            font-size: 18px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 15px;\n            border-bottom: 1px solid #e2e8f0;\n            padding-bottom: 5px;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n          }\n          th, td {\n            padding: 12px;\n            text-align: center;\n            border: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n          }\n          .footer {\n            margin-top: 40px;\n            text-align: center;\n            font-size: 12px;\n            color: #64748b;\n            border-top: 1px solid #e2e8f0;\n            padding-top: 20px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">${a}</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        ${this.generateReportContent(e,t,n)}\n\n        <div class="footer">\n          تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة - ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}\n        </div>\n      </body>\n      </html>\n    `}static generateReportContent(e,t,n){switch(e){case"patients":return this.generatePatientReportContent(t,n);case"appointments":return this.generateAppointmentReportContent(t,n);case"financial":return this.generateFinancialReportContent(t,n);case"inventory":return this.generateInventoryReportContent(t,n);case"overview":return this.generateOverviewReportContent(t,n);default:return'<div class="section">لا توجد بيانات متاحة</div>'}}static generatePatientReportContent(e,t){return`\n      <div class="summary-cards">\n        <div class="summary-card">\n          <h3>إجمالي المرضى</h3>\n          <div class="number">${e.totalPatients||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المرضى الجدد</h3>\n          <div class="number">${e.newPatientsThisMonth||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المرضى النشطون</h3>\n          <div class="number">${e.activePatients||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>متوسط العمر</h3>\n          <div class="number">${e.averageAge||0} سنة</div>\n        </div>\n      </div>\n\n      ${e.ageDistribution&&e.ageDistribution.length>0?`\n      <div class="section">\n        <div class="section-title">توزيع الأعمار</div>\n        <table>\n          <thead>\n            <tr>\n              <th>الفئة العمرية</th>\n              <th>العدد</th>\n              <th>النسبة المئوية</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.ageDistribution.map(t=>`\n              <tr>\n                <td>${t.ageGroup||t.range}</td>\n                <td>${t.count}</td>\n                <td>${(t.count/e.totalPatients*100).toFixed(1)}%</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n\n      ${e.genderDistribution&&e.genderDistribution.length>0?`\n      <div class="section">\n        <div class="section-title">توزيع الجنس</div>\n        <table>\n          <thead>\n            <tr>\n              <th>الجنس</th>\n              <th>العدد</th>\n              <th>النسبة المئوية</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.genderDistribution.map(t=>`\n              <tr>\n                <td>${"male"===t.gender?"ذكر":"أنثى"}</td>\n                <td>${t.count}</td>\n                <td>${(t.count/e.totalPatients*100).toFixed(1)}%</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n\n      ${t.includeDetails&&e.patients&&e.patients.length>0?`\n      <div class="section">\n        <div class="section-title">تفاصيل المرضى</div>\n        <table>\n          <thead>\n            <tr>\n              <th>الاسم الكامل</th>\n              <th>الهاتف</th>\n              <th>العمر</th>\n              <th>الجنس</th>\n              <th>#</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.patients.slice(0,50).map(e=>`\n              <tr>\n                <td>${e.full_name||"غير محدد"}</td>\n                <td>${e.phone||"غير محدد"}</td>\n                <td>${e.age||"غير محدد"}</td>\n                <td>${"male"===e.gender?"ذكر":"أنثى"}</td>\n                <td>${e.serial_number||"غير محدد"}</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n    `}static generateAppointmentReportContent(e,t){var n;return`\n      <div class="summary-cards">\n        <div class="summary-card">\n          <h3>إجمالي المواعيد</h3>\n          <div class="number">${e.totalAppointments||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المكتملة</h3>\n          <div class="number">${e.completedAppointments||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>الملغية</h3>\n          <div class="number">${e.cancelledAppointments||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>معدل الحضور</h3>\n          <div class="number">${(null==(n=e.attendanceRate)?void 0:n.toFixed(1))||0}%</div>\n        </div>\n      </div>\n\n      ${e.appointmentsByStatus&&e.appointmentsByStatus.length>0?`\n      <div class="section">\n        <div class="section-title">توزيع المواعيد حسب الحالة</div>\n        <table>\n          <thead>\n            <tr>\n              <th>الحالة</th>\n              <th>العدد</th>\n              <th>النسبة المئوية</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.appointmentsByStatus.map(e=>{var t;return`\n              <tr>\n                <td>${this.translateStatus(e.status)}</td>\n                <td>${e.count}</td>\n                <td>${(null==(t=e.percentage)?void 0:t.toFixed(1))||0}%</td>\n              </tr>\n            `}).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n    `}static generateFinancialReportContent(e,t){return`\n      <div class="summary-cards">\n        <div class="summary-card">\n          <h3>إجمالي الإيرادات</h3>\n          <div class="number">${ca(e.totalRevenue||0)}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المدفوعات المكتملة</h3>\n          <div class="number">${ca(e.completedPayments||0)}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المدفوعات المعلقة</h3>\n          <div class="number">${ca(e.pendingPayments||0)}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المدفوعات المتأخرة</h3>\n          <div class="number">${ca(e.overduePayments||0)}</div>\n        </div>\n      </div>\n\n      ${e.paymentMethodStats&&e.paymentMethodStats.length>0?`\n      <div class="section">\n        <div class="section-title">إحصائيات طرق الدفع</div>\n        <table>\n          <thead>\n            <tr>\n              <th>طريقة الدفع</th>\n              <th>المبلغ</th>\n              <th>عدد المعاملات</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.paymentMethodStats.map(e=>`\n              <tr>\n                <td>${this.translatePaymentMethod(e.method)}</td>\n                <td>${ca(e.amount)}</td>\n                <td>${e.count}</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n    `}static generateInventoryReportContent(e,t){return`\n      <div class="summary-cards">\n        <div class="summary-card">\n          <h3>إجمالي الأصناف</h3>\n          <div class="number">${e.totalItems||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>القيمة الإجمالية</h3>\n          <div class="number">${ca(e.totalValue||0)}</div>\n        </div>\n        <div class="summary-card">\n          <h3>أصناف منخفضة المخزون</h3>\n          <div class="number" style="color: #f59e0b;">${e.lowStockItems||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>أصناف منتهية الصلاحية</h3>\n          <div class="number" style="color: #ef4444;">${e.expiredItems||0}</div>\n        </div>\n      </div>\n\n      ${e.itemsByCategory&&e.itemsByCategory.length>0?`\n      <div class="section">\n        <div class="section-title">توزيع الأصناف حسب الفئة</div>\n        <table>\n          <thead>\n            <tr>\n              <th>الفئة</th>\n              <th>عدد الأصناف</th>\n              <th>القيمة</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.itemsByCategory.map(e=>`\n              <tr>\n                <td>${e.category}</td>\n                <td>${e.count}</td>\n                <td>${ca(e.value)} $</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n    `}static generateOverviewReportContent(e,t){return`\n      <div class="section">\n        <div class="section-title">ملخص شامل للعيادة</div>\n        <div class="summary-cards">\n          ${e.patients?`\n          <div class="summary-card">\n            <h3>المرضى</h3>\n            <div class="number">${e.patients.totalPatients||0}</div>\n          </div>\n          `:""}\n          ${e.appointments?`\n          <div class="summary-card">\n            <h3>المواعيد</h3>\n            <div class="number">${e.appointments.totalAppointments||0}</div>\n          </div>\n          `:""}\n          ${e.financial?`\n          <div class="summary-card">\n            <h3>الإيرادات</h3>\n            <div class="number">${ca(e.financial.totalRevenue||0)}</div>\n          </div>\n          `:""}\n          ${e.inventory?`\n          <div class="summary-card">\n            <h3>المخزون</h3>\n            <div class="number">${e.inventory.totalItems||0}</div>\n          </div>\n          `:""}\n        </div>\n      </div>\n\n      ${e.patients?this.generatePatientReportContent(e.patients,t):""}\n      ${e.appointments?this.generateAppointmentReportContent(e.appointments,t):""}\n      ${e.financial?this.generateFinancialReportContent(e.financial,t):""}\n      ${e.inventory?this.generateInventoryReportContent(e.inventory,t):""}\n    `}static translateStatus(e){return{scheduled:"مجدول",completed:"مكتمل",cancelled:"ملغي","no-show":"عدم حضور","in-progress":"قيد التنفيذ"}[e]||e}static translatePaymentMethod(e){return{cash:"نقدي",card:"بطاقة ائتمان",bank_transfer:"تحويل بنكي",insurance:"تأمين",installment:"تقسيط"}[e]||e}static getPaymentStatusInArabic(e){return{completed:"مكتمل",partial:"جزئي",pending:"معلق",overdue:"متأخر",cancelled:"ملغي"}[e]||e}static addPDFHeader(e,t,n){const a=e.internal.pageSize.getWidth();e.setFontSize(24),e.setFont("helvetica","bold"),e.text("عيادة الأسنان الحديثة",a/2,20,{align:"center"}),e.setFontSize(18),e.setFont("helvetica","normal");e.text({patients:"تقرير المرضى",appointments:"تقرير المواعيد",financial:"التقرير المالي",inventory:"تقرير المخزون",analytics:"تقرير التحليلات",overview:"التقرير الشامل"}[t]||"تقرير",a/2,35,{align:"center"}),e.setFontSize(12);const s=new Date,r=`${s.getDate().toString().padStart(2,"0")}/${(s.getMonth()+1).toString().padStart(2,"0")}/${s.getFullYear()}`;e.text(`تاريخ التقرير: ${r}`,a-20,45,{align:"right"}),e.setLineWidth(.5),e.line(20,48,a-20,48)}static addPDFFooter(e,t){const n=e.internal.pageSize.getWidth(),a=e.internal.pageSize.getHeight();e.setFontSize(10),e.setFont("helvetica","normal"),e.text("تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة",n/2,a-10,{align:"center"})}static addPatientReportToPDF(e,t,n,a){return m(this,null,function*(){const s=e.internal.pageSize.getWidth();return e.setFontSize(14),e.setFont("helvetica","bold"),e.text("ملخص إحصائيات المرضى",20,n),n+=15,e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`إجمالي المرضى: ${t.totalPatients||0}`,20,n),e.text(`المرضى الجدد هذا الشهر: ${t.newPatientsThisMonth||0}`,150,n),n+=10,e.text(`المرضى النشطون: ${t.activePatients||0}`,20,n),e.text(`متوسط العمر: ${t.averageAge||0} سنة`,150,n),n+=20,a.includeCharts&&t.ageDistribution&&(e.setFont("helvetica","bold"),e.text("توزيع الأعمار",20,n),n+=10,t.ageDistribution.forEach(t=>{e.setFont("helvetica","normal"),e.text(`${t.range}: ${t.count} مريض`,30,n),n+=8}),n+=10),a.includeDetails&&t.patients&&(e.setFont("helvetica","bold"),e.text("تفاصيل المرضى",20,n),n+=15,e.setFontSize(10),e.text("الاسم الكامل",20,n),e.text("الهاتف",80,n),e.text("العمر",130,n),e.text("الجنس",170,n),e.text("#",220,n),e.line(20,n+2,s-20,n+2),n+=10,e.setFont("helvetica","normal"),t.patients.slice(0,20).forEach(t=>{var a;n>250&&(e.addPage(),n=30),e.text(t.full_name||"غير محدد",20,n),e.text(t.phone||"غير محدد",80,n),e.text((null==(a=t.age)?void 0:a.toString())||"غير محدد",130,n),e.text("male"===t.gender?"ذكر":"أنثى",170,n),e.text(t.serial_number||"غير محدد",220,n),n+=8})),n+20})}static addAppointmentReportToPDF(e,t,n,a){return m(this,null,function*(){return e.internal.pageSize.getWidth(),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("ملخص إحصائيات المواعيد",20,n),n+=15,e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`إجمالي المواعيد: ${t.totalAppointments||0}`,20,n),e.text(`المواعيد المكتملة: ${t.completedAppointments||0}`,150,n),n+=10,e.text(`المواعيد الملغية: ${t.cancelledAppointments||0}`,20,n),e.text(`معدل الحضور: ${t.attendanceRate||0}%`,150,n),n+=20,a.includeCharts&&t.appointmentsByStatus&&(e.setFont("helvetica","bold"),e.text("توزيع حالات المواعيد",20,n),n+=10,t.appointmentsByStatus.forEach(t=>{e.setFont("helvetica","normal"),e.text(`${t.status}: ${t.count} موعد`,30,n),n+=8}),n+=10),n+20})}static addFinancialReportToPDF(e,t,n,a){return m(this,null,function*(){return e.internal.pageSize.getWidth(),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("ملخص الإحصائيات المالية",20,n),n+=15,e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`إجمالي الإيرادات: ${ca(t.totalRevenue||0)}`,20,n),e.text(`المدفوعات المكتملة: ${ca(t.completedPayments||0)}`,150,n),n+=10,e.text(`المدفوعات المعلقة: ${ca(t.pendingPayments||0)}`,20,n),e.text(`المدفوعات المتأخرة: ${ca(t.overduePayments||0)}`,150,n),n+=20,a.includeCharts&&t.paymentMethodStats&&(e.setFont("helvetica","bold"),e.text("توزيع طرق الدفع",20,n),n+=10,t.paymentMethodStats.forEach(t=>{e.setFont("helvetica","normal"),e.text(`${t.method}: ${ca(t.amount)} (${t.count} معاملة)`,30,n),n+=8}),n+=10),a.includeCharts&&t.monthlyRevenue&&(e.setFont("helvetica","bold"),e.text("الإيرادات الشهرية",20,n),n+=10,t.monthlyRevenue.slice(-6).forEach(t=>{e.setFont("helvetica","normal"),e.text(`${t.month}: ${ca(t.revenue)}`,30,n),n+=8}),n+=10),n+20})}static addInventoryReportToPDF(e,t,n,a){return m(this,null,function*(){return e.internal.pageSize.getWidth(),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("ملخص إحصائيات المخزون",20,n),n+=15,e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`إجمالي العناصر: ${t.totalItems||0}`,20,n),e.text(`القيمة الإجمالية: ${ca(t.totalValue||0)}`,150,n),n+=10,e.text(`عناصر منخفضة المخزون: ${t.lowStockItems||0}`,20,n),e.text(`عناصر منتهية الصلاحية: ${t.expiredItems||0}`,150,n),n+=10,e.text(`عناصر نفدت من المخزون: ${t.outOfStockItems||0}`,20,n),e.text(`معدل دوران المخزون: ${t.turnoverRate||0}%`,150,n),n+=20,a.includeCharts&&t.topCategories&&(e.setFont("helvetica","bold"),e.text("أعلى الفئات استهلاكاً",20,n),n+=10,t.topCategories.slice(0,5).forEach(t=>{e.setFont("helvetica","normal"),e.text(`${t.name}: ${t.count} عنصر`,30,n),n+=8}),n+=10),n+20})}static addOverviewReportToPDF(e,t,n,a){return m(this,null,function*(){return t.patients&&(n=yield this.addPatientReportToPDF(e,t.patients,n,a)),t.appointments&&(n>200&&(e.addPage(),n=30),n=yield this.addAppointmentReportToPDF(e,t.appointments,n,a)),t.financial&&(n>200&&(e.addPage(),n=30),n=yield this.addFinancialReportToPDF(e,t.financial,n,a)),t.inventory&&(n>200&&(e.addPage(),n=30),n=yield this.addInventoryReportToPDF(e,t.inventory,n,a)),n})}static exportToExcel(e,t,n){return m(this,null,function*(){const a=new jt.Workbook;switch(a.creator="نظام إدارة العيادة",a.created=new Date,a.modified=new Date,e){case"patients":yield this.addPatientReportToExcel(a,t,n);break;case"appointments":yield this.addAppointmentReportToExcel(a,t,n);break;case"financial":yield this.addFinancialReportToExcel(a,t,n);break;case"inventory":yield this.addInventoryReportToExcel(a,t,n);break;case"labs":yield this.addLabReportToExcel(a,t,n);break;case"clinic-needs":yield this.addClinicNeedsReportToExcel(a,t,n);break;case"clinic-expenses":yield this.addClinicExpensesReportToExcel(a,t,n);break;case"profit-loss":yield this.addProfitLossReportToExcel(a,t,n);break;case"overview":yield this.addOverviewReportToExcel(a,t,n)}const s=this.generateFileName(e,"xlsx",{includeTime:!0}),r=yield a.xlsx.writeBuffer(),i=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=document.createElement("a"),o=URL.createObjectURL(i);return l.setAttribute("href",o),l.setAttribute("download",`${s}.xlsx`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),s})}static addPatientReportToExcel(e,t,n){return m(this,null,function*(){const a=e.addWorksheet("تقرير المرضى");a.mergeCells("A1:F1");const s=a.getCell("A1");if(s.value="تقرير المرضى - عيادة الأسنان الحديثة",s.font={size:16,bold:!0},s.alignment={horizontal:"center"},a.getCell("A3").value="ملخص الإحصائيات",a.getCell("A3").font={bold:!0},a.getCell("A4").value="إجمالي المرضى:",a.getCell("B4").value=t.totalPatients||0,a.getCell("A5").value="المرضى الجدد هذا الشهر:",a.getCell("B5").value=t.newPatientsThisMonth||0,a.getCell("A6").value="المرضى النشطون:",a.getCell("B6").value=t.activePatients||0,a.getCell("A7").value="متوسط العمر:",a.getCell("B7").value=`${t.averageAge||0} سنة`,n.includeDetails&&t.patients){let e=10;a.getCell(`A${e}`).value="تفاصيل المرضى",a.getCell(`A${e}`).font={bold:!0},e+=2;["#","الاسم الكامل","الجنس","العمر","الهاتف","البريد الإلكتروني","تاريخ التسجيل"].forEach((t,n)=>{const s=a.getCell(e,n+1);s.value=t,s.font={bold:!0},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),e++,t.patients.forEach(t=>{const n="male"===t.gender?"ذكر":"أنثى",s=t.created_at?new Date(t.created_at).toLocaleDateString("en-GB"):"";a.getCell(e,1).value=t.serial_number||"",a.getCell(e,2).value=t.full_name||"",a.getCell(e,3).value=n,a.getCell(e,4).value=t.age||"",a.getCell(e,5).value=t.phone||"",a.getCell(e,6).value=t.email||"",a.getCell(e,7).value=s,e++})}a.columns.forEach(e=>{e.width=15})})}static addFinancialReportToExcel(e,t,n){return m(this,null,function*(){const n=e.addWorksheet("التقرير المالي");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="التقرير المالي الشامل - عيادة الأسنان الحديثة",a.font={size:16,bold:!0},a.alignment={horizontal:"center"},n.getCell("A3").value="ملخص الإحصائيات المالية",n.getCell("A3").font={bold:!0},n.getCell("A4").value="إجمالي الإيرادات:",n.getCell("B4").value=`${ca(t.totalRevenue||0)}`,n.getCell("A5").value="المدفوعات المكتملة:",n.getCell("B5").value=`${ca(t.completedPayments||0)}`,n.getCell("A6").value="المدفوعات المعلقة:",n.getCell("B6").value=`${ca(t.pendingPayments||0)}`,n.getCell("A7").value="المدفوعات المتأخرة:",n.getCell("B7").value=`${ca(t.overduePayments||0)}`,n.getCell("D4").value="إجمالي المصروفات:",n.getCell("E4").value=`${ca(t.totalExpenses||0)}`,n.getCell("D5").value="صافي الربح:",n.getCell("E5").value=`${ca(t.netProfit||0)}`,n.getCell("D6").value="هامش الربح:",n.getCell("E6").value=`${(t.profitMargin||0).toFixed(2)}%`,n.getCell("D7").value="حالة الربحية:",n.getCell("E7").value=(t.netProfit||0)>=0?"ربح":"خسارة";let s=10;t.paymentMethodStats&&(n.getCell(`A${s}`).value="توزيع طرق الدفع",n.getCell(`A${s}`).font={bold:!0},s+=2,n.getCell(s,1).value="طريقة الدفع",n.getCell(s,2).value="المبلغ",n.getCell(s,3).value="عدد المعاملات",n.getRow(s).font={bold:!0},s++,t.paymentMethodStats.forEach(e=>{n.getCell(s,1).value=e.method,n.getCell(s,2).value=`${ca(e.amount)}`,n.getCell(s,3).value=e.count,s++}),s+=2),t.expensesByType&&t.expensesByType.length>0&&(n.getCell(`D${s}`).value="توزيع المصروفات حسب النوع",n.getCell(`D${s}`).font={bold:!0},s+=2,n.getCell(s,4).value="نوع المصروف",n.getCell(s,5).value="المبلغ",n.getCell(s,6).value="النسبة المئوية",n.getRow(s).font={bold:!0},s++,t.expensesByType.forEach(e=>{n.getCell(s,4).value=e.type,n.getCell(s,5).value=`${ca(e.amount)}`,n.getCell(s,6).value=`${e.percentage.toFixed(2)}%`,s++}),s+=2),t.recentExpenses&&t.recentExpenses.length>0&&(n.getCell(`A${s}`).value="المصروفات الحديثة (آخر 10 مصروفات)",n.getCell(`A${s}`).font={bold:!0},s+=2,n.getCell(s,1).value="اسم المصروف",n.getCell(s,2).value="النوع",n.getCell(s,3).value="المبلغ",n.getCell(s,4).value="طريقة الدفع",n.getCell(s,5).value="تاريخ الدفع",n.getCell(s,6).value="المورد",n.getRow(s).font={bold:!0},s++,t.recentExpenses.slice(0,10).forEach(e=>{n.getCell(s,1).value=e.expense_name||"غير محدد",n.getCell(s,2).value={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"}[e.expense_type]||e.expense_type||"غير محدد",n.getCell(s,3).value=`${ca(e.amount||0)}`,n.getCell(s,4).value={cash:"نقداً",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمان"}[e.payment_method]||e.payment_method||"غير محدد",n.getCell(s,5).value=e.payment_date?new Date(e.payment_date).toLocaleDateString("en-GB"):"غير محدد",n.getCell(s,6).value=e.vendor||"غير محدد",s++})),n.columns.forEach(e=>{e.width=20})})}static addClinicExpensesReportToExcel(e,t,n){return m(this,null,function*(){const n=e.addWorksheet("مصروفات العيادة");n.views=[{rightToLeft:!0}];let a=1;n.mergeCells(a,1,a,7);const s=n.getCell(a,1);if(s.value="تقرير مصروفات العيادة",s.font={name:"Arial",size:18,bold:!0},s.alignment={horizontal:"center",vertical:"middle"},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},s.font.color={argb:"FFFFFFFF"},n.getRow(a).height=30,a+=2,t.summary){n.mergeCells(a,1,a,7);const e=n.getCell(a,1);e.value="ملخص المصروفات",e.font={name:"Arial",size:14,bold:!0},e.alignment={horizontal:"center"},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE7E6E6"}},a++,Object.entries(t.summary).forEach(([e,t])=>{n.getCell(a,1).value=e,n.getCell(a,2).value=t,n.getCell(a,1).font={name:"Arial",size:11,bold:!0},n.getCell(a,2).font={name:"Arial",size:11},a++}),a++}if(["اسم المصروف","نوع المصروف","المبلغ","طريقة الدفع","تاريخ الدفع","المورد","الحالة"].forEach((e,t)=>{const s=n.getCell(a,t+1);s.value=e,s.font={name:"Arial",size:12,bold:!0},s.alignment={horizontal:"center",vertical:"middle"},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFD9E1F2"}},s.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),a++,t.expenses&&t.expenses.length>0){const e={salary:"راتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},s={cash:"نقدي",card:"بطاقة",bank_transfer:"تحويل بنكي",check:"شيك"},r={paid:"مدفوع",pending:"معلق",overdue:"متأخر"};t.expenses.forEach(t=>{n.getCell(a,1).value=t.expense_name||"غير محدد",n.getCell(a,2).value=e[t.expense_type]||t.expense_type||"غير محدد",n.getCell(a,3).value=`${ca(t.amount||0)}`,n.getCell(a,4).value=s[t.payment_method]||t.payment_method||"غير محدد",n.getCell(a,5).value=t.payment_date?new Date(t.payment_date).toLocaleDateString("en-GB"):"غير محدد",n.getCell(a,6).value=t.vendor||"غير محدد",n.getCell(a,7).value=r[t.status]||t.status||"غير محدد";for(let e=1;e<=7;e++){const t=n.getCell(a,e);t.font={name:"Arial",size:10},t.alignment={horizontal:"center",vertical:"middle"},t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}a++})}n.columns.forEach(e=>{e.width=20})})}static addAppointmentReportToExcel(e,t,n){return m(this,null,function*(){const n=e.addWorksheet("تقرير المواعيد");n.mergeCells("A1:F1");const a=n.getCell("A1");a.value="تقرير المواعيد - عيادة الأسنان الحديثة",a.font={size:16,bold:!0},a.alignment={horizontal:"center"},n.getCell("A3").value="ملخص إحصائيات المواعيد",n.getCell("A3").font={bold:!0},n.getCell("A4").value="إجمالي المواعيد:",n.getCell("B4").value=t.totalAppointments||0,n.getCell("A5").value="المواعيد المكتملة:",n.getCell("B5").value=t.completedAppointments||0,n.getCell("A6").value="المواعيد الملغية:",n.getCell("B6").value=t.cancelledAppointments||0,n.getCell("A7").value="معدل الحضور:",n.getCell("B7").value=`${t.attendanceRate||0}%`,n.columns.forEach(e=>{e.width=20})})}static addInventoryReportToExcel(e,t,n){return m(this,null,function*(){const n=e.addWorksheet("تقرير المخزون");n.mergeCells("A1:F1");const a=n.getCell("A1");a.value="تقرير المخزون - عيادة الأسنان الحديثة",a.font={size:16,bold:!0},a.alignment={horizontal:"center"},n.getCell("A3").value="ملخص إحصائيات المخزون",n.getCell("A3").font={bold:!0};const s=t.summary||t;n.getCell("A4").value="إجمالي العناصر:",n.getCell("B4").value=s["إجمالي العناصر"]||t.totalItems||0,n.getCell("A5").value="القيمة الإجمالية:",n.getCell("B5").value=s["القيمة الإجمالية"]||ca(t.totalValue||0),n.getCell("A6").value="عناصر منخفضة المخزون:",n.getCell("B6").value=s["عناصر منخفضة المخزون"]||t.lowStockItems||0,n.getCell("A7").value="عناصر منتهية الصلاحية:",n.getCell("B7").value=s["عناصر منتهية الصلاحية"]||t.expiredItems||0,void 0!==s["عناصر نفدت من المخزون"]&&(n.getCell("A8").value="عناصر نفدت من المخزون:",n.getCell("B8").value=s["عناصر نفدت من المخزون"]),void 0!==s["عناصر بدون أسعار"]&&(n.getCell("A9").value="عناصر بدون أسعار:",n.getCell("B9").value=s["عناصر بدون أسعار"]),s["تاريخ التقرير"]&&(n.getCell("A10").value="تاريخ التقرير:",n.getCell("B10").value=s["تاريخ التقرير"]),n.columns.forEach(e=>{e.width=20})})}static addLabReportToExcel(e,t,n){return m(this,null,function*(){if(!t)return void console.error("No data provided to addLabReportToExcel");const n=e.addWorksheet("تقرير المختبرات");n.mergeCells("A1:F1");const a=n.getCell("A1");a.value="تقرير المختبرات - عيادة الأسنان الحديثة",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF2E8B57"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"thick"},left:{style:"thick"},bottom:{style:"thick"},right:{style:"thick"}},n.getCell("A2").value=`تاريخ التقرير: ${(new Date).toLocaleDateString("ar-SA")}`,n.getCell("A2").font={size:12,italic:!0},n.getCell("A2").alignment={horizontal:"right"};let s=4;if(t&&t.summary&&"object"==typeof t.summary){n.getCell(`A${s}`).value="ملخص الإحصائيات",n.getCell(`A${s}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},s+=2;try{const e=Object.entries(t.summary);for(const[t,a]of e){n.getCell(`A${s}`).value=t,n.getCell(`B${s}`).value=a,n.getCell(`A${s}`).font={bold:!0},n.getCell(`B${s}`).font={size:11};const e=n.getCell(`A${s}`);e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}},e.alignment={horizontal:"right",vertical:"middle"};const r=n.getCell(`B${s}`);r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}},r.alignment={horizontal:"right",vertical:"middle"},s++}}catch(r){console.error("Error processing summary data:",r)}s+=2}if(t.labs&&t.labs.length>0){n.getCell(`A${s}`).value="بيانات المختبرات",n.getCell(`A${s}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},s+=2;["اسم المختبر","معلومات الاتصال","العنوان","عدد الطلبات","تاريخ الإضافة"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,size:12,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}},a.alignment={horizontal:"center",vertical:"middle"}}),s++;try{t.labs.forEach((e,t)=>{[e.name,e.contact_info||"",e.address||"",e.ordersCount||0,new Date(e.created_at).toLocaleDateString("ar-SA")].forEach((e,a)=>{const r=n.getCell(s,a+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})}),s++})}catch(r){console.error("Error processing labs data:",r)}}if(t.labOrders&&t.labOrders.length>0){s+=2,n.getCell(`A${s}`).value="بيانات طلبات المختبرات",n.getCell(`A${s}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},s+=2;["رقم الطلب","اسم المختبر","اسم الخدمة","اسم المريض","التكلفة","المبلغ المدفوع","المبلغ المتبقي","تاريخ الطلب","الحالة","الملاحظات"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,size:12,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}},a.alignment={horizontal:"center",vertical:"middle"}}),s++;try{t.labOrders.forEach((e,t)=>{var a,r;[t+1,(null==(a=e.lab)?void 0:a.name)||"غير محدد",e.service_name,(null==(r=e.patient)?void 0:r.full_name)||"غير محدد",`$${e.cost}`,`$${e.paid_amount||0}`,`$${e.remaining_balance||0}`,new Date(e.order_date).toLocaleDateString("en-GB"),e.status,e.notes||""].forEach((e,a)=>{const r=n.getCell(s,a+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),a>=4&&a<=6&&(r.font={bold:!0},r.fill||(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}}))}),s++})}catch(r){console.error("Error processing lab orders data:",r)}}n.columns.forEach(e=>{e.width=15}),n.getColumn(1).width=20,n.getColumn(2).width=25,n.getColumn(3).width=30,n.getColumn(4).width=15,n.getColumn(5).width=20})}static addClinicNeedsReportToExcel(e,t,n){return m(this,null,function*(){const n=e.addWorksheet("تقرير احتياجات العيادة");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="تقرير احتياجات العيادة - عيادة الأسنان الحديثة",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF2E8B57"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"thick"},left:{style:"thick"},bottom:{style:"thick"},right:{style:"thick"}},n.getCell("A2").value=`تاريخ التقرير: ${(new Date).toLocaleDateString("en-GB")}`,n.getCell("A2").font={size:12,italic:!0},n.getCell("A2").alignment={horizontal:"right"};let s=4;if(t.summary&&(n.getCell(`A${s}`).value="ملخص الإحصائيات",n.getCell(`A${s}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},s+=2,Object.entries(t.summary).forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,n.getCell(`A${s}`).font={bold:!0},n.getCell(`B${s}`).font={size:11}.B.forEach(e=>{const t=n.getCell(`${e}${s}`);t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}},t.alignment={horizontal:"right",vertical:"middle"}}),s++}),s+=2),t.needs&&t.needs.length>0){n.getCell(`A${s}`).value="بيانات احتياجات العيادة",n.getCell(`A${s}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},s+=2;["#","اسم العنصر","الكمية المطلوبة","الأولوية","الحالة","تاريخ الطلب","تاريخ الاستلام","الملاحظات"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,size:12,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}},a.alignment={horizontal:"center",vertical:"middle"}}),s++,t.needs.forEach((e,t)=>{[t+1,e.item_name,e.quantity_needed,{urgent:"عاجل",high:"عالي",medium:"متوسط",low:"منخفض"}[e.priority]||e.priority,{pending:"معلق",ordered:"تم الطلب",received:"تم الاستلام"}[e.status]||e.status,new Date(e.date_needed).toLocaleDateString("en-GB"),e.date_received?new Date(e.date_received).toLocaleDateString("en-GB"):"",e.notes||""].forEach((a,r)=>{const i=n.getCell(s,r+1);if(i.value=a,i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),3===r){let t="FFF8F9FA";switch(e.priority){case"urgent":t="FFFFE6E6";break;case"high":t="FFFFF2CC";break;case"medium":t="FFFFFFE6";break;case"low":t="FFE6F7FF"}i.fill={type:"pattern",pattern:"solid",fgColor:{argb:t}}}if(4===r){let t="FFF8F9FA";switch(e.status){case"pending":t="FFFFE6E6";break;case"ordered":t="FFFFF2CC";break;case"received":t="FFE6F7E6"}i.fill={type:"pattern",pattern:"solid",fgColor:{argb:t}}}}),s++})}n.columns.forEach(e=>{e.width=15}),n.getColumn(1).width=12,n.getColumn(2).width=25,n.getColumn(3).width=15,n.getColumn(4).width=12,n.getColumn(5).width=15,n.getColumn(6).width=18,n.getColumn(7).width=18,n.getColumn(8).width=30})}static addOverviewReportToExcel(e,t,n){return m(this,null,function*(){t.patients&&(yield this.addPatientReportToExcel(e,t.patients,n)),t.appointments&&(yield this.addAppointmentReportToExcel(e,t.appointments,n)),t.financial&&(yield this.addFinancialReportToExcel(e,t.financial,n)),t.inventory&&(yield this.addInventoryReportToExcel(e,t.inventory,n)),t.labs&&(yield this.addLabReportToExcel(e,t.labs,n)),t.clinicNeeds&&(yield this.addClinicNeedsReportToExcel(e,t.clinicNeeds,n))})}static addProfitLossReportToExcel(e,t,n){return m(this,null,function*(){const n=e.addWorksheet("تقرير الأرباح والخسائر");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="التقرير الشامل للأرباح والخسائر - عيادة الأسنان",a.font={size:16,bold:!0},a.alignment={horizontal:"center"},n.getCell("A3").value="ملخص الأرباح والخسائر",n.getCell("A3").font={bold:!0,size:14};let s=5;if(t.summary&&(Object.entries(t.summary).forEach(([e,t])=>{n.getCell(s,1).value=e,n.getCell(s,2).value=t,n.getCell(s,1).font={bold:!0},s++}),s+=2),t.revenue&&(n.getCell(s,1).value="تفاصيل الإيرادات",n.getCell(s,1).font={bold:!0,size:12,color:{argb:"FF059669"}},n.getCell(s,1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE6F7E6"}},s+=2,n.getCell(s,1).value="المدفوعات المكتملة:",n.getCell(s,2).value=ca(t.revenue.completedPayments||0),n.getCell(s,1).font={bold:!0},s++,n.getCell(s,1).value="المدفوعات الجزئية:",n.getCell(s,2).value=ca(t.revenue.partialPayments||0),n.getCell(s,1).font={bold:!0},s++,n.getCell(s,1).value="المبالغ المعلقة:",n.getCell(s,2).value=ca(t.revenue.pendingPayments||0),n.getCell(s,1).font={bold:!0},s++,n.getCell(s,1).value="المبالغ المتبقية من الجزئية:",n.getCell(s,2).value=ca(t.revenue.remainingBalances||0),n.getCell(s,1).font={bold:!0},s++,n.getCell(s,1).value="إجمالي الإيرادات:",n.getCell(s,2).value=ca(t.revenue.totalRevenue||0),n.getCell(s,1).font={bold:!0,color:{argb:"FF059669"}},n.getCell(s,2).font={bold:!0,color:{argb:"FF059669"}},n.getCell(s,1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}},n.getCell(s,2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}},s+=3),t.expenses){n.getCell(s,1).value="تفاصيل المصروفات",n.getCell(s,1).font={bold:!0,size:12},s+=2,n.getCell(s,1).value="مدفوعات المخابر:",n.getCell(s,2).value=ca(t.expenses.labOrdersTotal||0),s++,n.getCell(s,1).value="متبقي المخابر:",n.getCell(s,2).value=ca(t.expenses.labOrdersRemaining||0),s++,n.getCell(s,1).value="احتياجات العيادة:",n.getCell(s,2).value=ca(t.expenses.clinicNeedsTotal||0),s++,n.getCell(s,1).value="متبقي الاحتياجات:",n.getCell(s,2).value=ca(t.expenses.clinicNeedsRemaining||0),s++,n.getCell(s,1).value="قيمة المخزون:",n.getCell(s,2).value=ca(t.expenses.inventoryExpenses||0),s++,n.getCell(s,1).value="مصروفات العيادة المباشرة:",n.getCell(s,2).value=ca(t.expenses.clinicExpensesTotal||0),s++;const e=(t.expenses.labOrdersTotal||0)+(t.expenses.labOrdersRemaining||0)+(t.expenses.clinicNeedsTotal||0)+(t.expenses.clinicNeedsRemaining||0)+(t.expenses.inventoryExpenses||0)+(t.expenses.clinicExpensesTotal||0);n.getCell(s,1).value="إجمالي المصروفات:",n.getCell(s,2).value=ca(e),n.getCell(s,1).font={bold:!0},n.getCell(s,2).font={bold:!0},s+=3}t.payments&&t.payments.length>0&&this.addPaymentsDetailSheet(e,t.payments),t.labOrders&&t.labOrders.length>0&&this.addLabOrdersDetailSheet(e,t.labOrders),t.clinicNeeds&&t.clinicNeeds.length>0&&this.addClinicNeedsDetailSheet(e,t.clinicNeeds),t.inventoryItems&&t.inventoryItems.length>0&&this.addInventoryDetailSheet(e,t.inventoryItems),t.clinicExpenses&&t.clinicExpenses.length>0&&this.addClinicExpensesDetailSheet(e,t.clinicExpenses),n.columns.forEach(e=>{e.width=25})})}static addPaymentsDetailSheet(e,t){const n=e.addWorksheet("تفاصيل المدفوعات"),a=t.filter(e=>"pending"===e.status),s=t.filter(e=>"partial"===e.status),r=a.reduce((e,t)=>e+(t.treatment_total_cost||t.total_amount_due||0),0),i=s.reduce((e,t)=>{const n=t.total_amount_due||t.treatment_total_cost||0;if(n>0){const a=t.amount_paid||t.treatment_total_paid||t.amount||0;return e+Math.max(0,n-a)}return e+(t.treatment_remaining_balance||t.remaining_balance||0)},0);["اسم المريض","المبلغ المدفوع","المبلغ الإجمالي","المبلغ المتبقي","الحالة","طريقة الدفع","تاريخ الدفع","ملاحظات"].forEach((e,t)=>{const a=n.getCell(1,t+1);a.value=e,a.font={bold:!0},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),t.forEach((e,t)=>{const a=t+2,s=e.amount||0;let r=0,i=0;if("partial"===e.status)if(r=e.total_amount_due||e.treatment_total_cost||0,r>0){const t=e.amount_paid||e.treatment_total_paid||s;i=Math.max(0,r-t)}else i=e.remaining_balance||e.treatment_remaining_balance||0;else"pending"===e.status?(r=e.total_amount_due||e.treatment_total_cost||s,i=r):(r=s,i=0);n.getCell(a,1).value=e.patient_name||"",n.getCell(a,2).value=ca(s),n.getCell(a,3).value=ca(r),n.getCell(a,4).value=ca(i),n.getCell(a,5).value="completed"===e.status?"مكتمل":"partial"===e.status?"جزئي":"معلق",n.getCell(a,6).value=e.payment_method||"",n.getCell(a,7).value=e.payment_date?new Date(e.payment_date).toLocaleDateString("en-GB"):"",n.getCell(a,8).value=e.notes||""});const l=t.length+4;n.getCell(l,1).value="ملخص المدفوعات المعلقة والمتبقية",n.getCell(l,1).font={bold:!0,size:14},n.mergeCells(l,1,l,8),n.getCell(l+2,1).value="إجمالي المدفوعات المعلقة:",n.getCell(l+2,2).value=ca(r),n.getCell(l+2,1).font={bold:!0},n.getCell(l+2,2).font={bold:!0},n.getCell(l+3,1).value="إجمالي المبالغ المتبقية من الدفعات الجزئية:",n.getCell(l+3,2).value=ca(i),n.getCell(l+3,1).font={bold:!0},n.getCell(l+3,2).font={bold:!0};const o=r+i;n.getCell(l+4,1).value="إجمالي المبالغ غير المدفوعة:",n.getCell(l+4,2).value=ca(o),n.getCell(l+4,1).font={bold:!0,color:{argb:"FFDC2626"}},n.getCell(l+4,2).font={bold:!0,color:{argb:"FFDC2626"}};for(let d=l;d<=l+4;d++)for(let e=1;e<=2;e++){const t=n.getCell(d,e);t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},d===l?(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},t.font={bold:!0,size:14,color:{argb:"FFFFFFFF"}}):d>l+1&&(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})}n.columns.forEach(e=>{e.width=15})}static addLabOrdersDetailSheet(e,t){const n=e.addWorksheet("تفاصيل طلبات المخابر");["رقم الطلب","اسم المختبر","اسم المريض","التكلفة","المدفوع","المتبقي","الحالة","تاريخ الطلب"].forEach((e,t)=>{const a=n.getCell(1,t+1);a.value=e,a.font={bold:!0},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),t.forEach((e,t)=>{var a,s;const r=t+2;n.getCell(r,1).value=e.id||"",n.getCell(r,2).value=(null==(a=e.lab)?void 0:a.name)||"",n.getCell(r,3).value=(null==(s=e.patient)?void 0:s.full_name)||"",n.getCell(r,4).value=ca(e.cost||0),n.getCell(r,5).value=ca(e.paid_amount||0),n.getCell(r,6).value=ca((e.cost||0)-(e.paid_amount||0)),n.getCell(r,7).value="completed"===e.status?"مكتمل":"pending"===e.status?"معلق":"ملغي",n.getCell(r,8).value=e.order_date?new Date(e.order_date).toLocaleDateString("en-GB"):""}),n.columns.forEach(e=>{e.width=15})}static addClinicNeedsDetailSheet(e,t){const n=e.addWorksheet("تفاصيل احتياجات العيادة");["اسم العنصر","الكمية","سعر الوحدة","التكلفة الإجمالية","الأولوية","الحالة","التاريخ المطلوب","التاريخ المستلم","ملاحظات"].forEach((e,t)=>{const a=n.getCell(1,t+1);a.value=e,a.font={bold:!0},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),t.forEach((e,t)=>{const a=t+2,s=e.quantity||0,r=e.price||0,i=s*r;n.getCell(a,1).value=e.need_name||e.item_name||"",n.getCell(a,2).value=s,n.getCell(a,3).value=ca(r),n.getCell(a,4).value=ca(i),n.getCell(a,5).value="urgent"===e.priority?"عاجل":"high"===e.priority?"عالي":"medium"===e.priority?"متوسط":"منخفض",n.getCell(a,6).value="received"===e.status?"مستلم":"ordered"===e.status?"مطلوب":"معلق",n.getCell(a,7).value=e.date_needed?new Date(e.date_needed).toLocaleDateString("en-GB"):"",n.getCell(a,8).value=e.date_received?new Date(e.date_received).toLocaleDateString("en-GB"):"",n.getCell(a,9).value=e.notes||""});const a=t.reduce((e,t)=>e+(t.quantity||0)*(t.price||0),0),s=t.length+3;n.getCell(s,1).value="إجمالي تكلفة احتياجات العيادة:",n.getCell(s,4).value=ca(a),n.getCell(s,1).font={bold:!0},n.getCell(s,4).font={bold:!0},n.columns.forEach(e=>{e.width=15})}static addInventoryDetailSheet(e,t){const n=e.addWorksheet("تفاصيل المخزون");["اسم العنصر","الكمية","سعر الوحدة","القيمة الإجمالية","الحد الأدنى","تاريخ الانتهاء","الفئة"].forEach((e,t)=>{const a=n.getCell(1,t+1);a.value=e,a.font={bold:!0},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),t.forEach((e,t)=>{const a=t+2,s=parseFloat(String(e.cost_per_unit||0))||0,r=parseFloat(String(e.unit_price||0))||0,i=s||r,l=parseFloat(String(e.quantity||0))||0,o=l*i;n.getCell(a,1).value=e.name||"",n.getCell(a,2).value=l,n.getCell(a,3).value=ca(i),n.getCell(a,4).value=ca(o),n.getCell(a,5).value=e.minimum_stock||0,n.getCell(a,6).value=e.expiry_date?new Date(e.expiry_date).toLocaleDateString("en-GB"):"",n.getCell(a,7).value=e.category||""}),n.columns.forEach(e=>{e.width=15})}static addClinicExpensesDetailSheet(e,t){const n=e.addWorksheet("تفاصيل مصروفات العيادة");["اسم المصروف","النوع","المبلغ","طريقة الدفع","تاريخ الدفع","المورد","ملاحظات"].forEach((e,t)=>{const a=n.getCell(1,t+1);a.value=e,a.font={bold:!0},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),t.forEach((e,t)=>{const a=t+2;n.getCell(a,1).value=e.expense_name||"",n.getCell(a,2).value=e.expense_type||"",n.getCell(a,3).value=ca(e.amount||0),n.getCell(a,4).value=e.payment_method||"",n.getCell(a,5).value=e.payment_date?new Date(e.payment_date).toLocaleDateString("en-GB"):"",n.getCell(a,6).value=e.vendor||"",n.getCell(a,7).value=e.notes||""}),n.columns.forEach(e=>{e.width=15})}static exportToCSV(e,t,n){return m(this,null,function*(){let a="\ufeff";switch(e){case"patients":a+=this.generatePatientCSV(t,n);break;case"appointments":a+=this.generateAppointmentCSV(t,n);break;case"financial":a+=this.generateFinancialCSV(t,n);break;case"inventory":a+=this.generateInventoryCSV(t,n);break;case"profit-loss":a+=this.generateProfitLossCSV(t,n);break;case"overview":a+=this.generateOverviewCSV(t,n)}yield this.convertCSVToExcel(a,e,n);return this.generateFileName(e,"xlsx",{includeTime:!0})})}static isTableHeader(e,t){return e.includes("اسم المريض")||e.includes("نوع الموعد")||e.includes("نوع الدفع")||e.includes("تاريخ الدفع")||e.includes("اسم الصنف")||e.includes("التاريخ,الوقت")||e.includes("رقم الإيصال")||e.includes("#")||e.includes("اسم العلاج")||e.includes("اسم المنتج")||1===t&&e.includes(",")}static isFinancialData(e){return e.includes("إجمالي")||e.includes("صافي")||e.includes("الربح")||e.includes("الخسارة")||e.includes("المدفوعات")||e.includes("الإيرادات")||e.includes("المصروفات")||e.includes("القيمة الإجمالية")||e.includes("المبلغ الإجمالي")}static convertCSVToExcel(e,t,n){return m(this,null,function*(){try{const n=new jt.Workbook;n.creator="نظام إدارة العيادة",n.created=new Date,n.modified=new Date;const a=n.addWorksheet("التقرير"),s=e.replace("\ufeff","").split("\n").filter(e=>e.trim());let r=1;for(const e of s){if(e.includes(",")){this.parseCSVLine(e).forEach((n,s)=>{const i=a.getCell(r,s+1);i.value=n,this.isTableHeader(e,r)?(i.font={bold:!0,size:12,color:{argb:"FFFFFFFF"}},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"comprehensive"===t?"FF2E8B57":"FF4472C4"}},i.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}):this.isFinancialData(e)?(i.font={bold:!0,size:11},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}},i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}):(i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r%2==0&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})),i.alignment={horizontal:"right",vertical:"middle"}})}else{const t=a.getCell(r,1);t.value=e.trim(),e.includes("عيادة الأسنان")||e.includes("التقرير الشامل")||e.includes("التقرير المالي")?(t.font={bold:!0,size:18,color:{argb:"FF1F4E79"}},t.alignment={horizontal:"center",vertical:"middle"},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE7F3FF"}},a.mergeCells(r,1,r,12)):e.includes("===")||e.includes("تحليل")||e.includes("ملخص")?(t.font={bold:!0,size:14,color:{argb:"FF2E8B57"}},t.alignment={horizontal:"right",vertical:"middle"},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF0FFF0"}},a.mergeCells(r,1,r,8)):(t.font={bold:!0,size:12},t.alignment={horizontal:"right",vertical:"middle"})}r++}a.columns.forEach((e,t)=>{e.width=0===t?25:18}),s.length>0&&s[0].includes(",")&&(a.views=[{state:"frozen",ySplit:1}]),a.eachRow((e,t)=>{e.height=25,1===t&&(e.height=30)});const i=this.generateFileName(t,"xlsx",{includeTime:!0}),l=yield n.xlsx.writeBuffer(),o=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=document.createElement("a"),c=URL.createObjectURL(o);d.setAttribute("href",c),d.setAttribute("download",`${i}.xlsx`),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d),console.log(`✅ تم تحويل CSV إلى Excel: ${i}.xlsx`)}catch(n){console.error("خطأ في تحويل CSV إلى Excel:",n)}})}static parseCSVLine(e){const t=[];let n="",a=!1;for(let s=0;s<e.length;s++){const r=e[s];'"'===r?a=!a:","!==r||a?n+=r:(t.push(n.trim()),n="")}return t.push(n.trim()),t.map(e=>e.replace(/^"|"$/g,""))}static generatePatientCSV(e,t){let n="تقرير المرضى - عيادة الأسنان الحديثة\n\n";return n+="ملخص الإحصائيات\n",n+=`إجمالي المرضى,${e.totalPatients||0}\n`,n+=`المرضى الجدد هذا الشهر,${e.newPatientsThisMonth||0}\n`,n+=`المرضى النشطون,${e.activePatients||0}\n`,n+=`متوسط العمر,${e.averageAge||0} سنة\n\n`,e.ageDistribution&&e.ageDistribution.length>0&&(n+="توزيع الأعمار\n",n+="الفئة العمرية,العدد,النسبة المئوية\n",e.ageDistribution.forEach(t=>{const a=e.totalPatients>0?(t.count/e.totalPatients*100).toFixed(1):"0.0";n+=`"${t.ageGroup}",${t.count},${a}%\n`}),n+="\n"),e.genderDistribution&&e.genderDistribution.length>0&&(n+="توزيع الجنس\n",n+="الجنس,العدد,النسبة المئوية\n",e.genderDistribution.forEach(t=>{const a=e.totalPatients>0?(t.count/e.totalPatients*100).toFixed(1):"0.0",s="male"===t.gender||"ذكور"===t.gender?"ذكر":"أنثى";n+=`"${s}",${t.count},${a}%\n`}),n+="\n"),t.includeDetails&&e.patients&&(n+="تفاصيل المرضى\n",n+="#,الاسم الكامل,الجنس,العمر,الهاتف,البريد الإلكتروني,تاريخ التسجيل\n",e.patients.forEach(e=>{const t="male"===e.gender?"ذكر":"أنثى",a=e.created_at?new Date(e.created_at).toLocaleDateString("ar-SA"):"";n+=`"${e.serial_number||""}","${e.full_name||""}","${t}","${e.age||""}","${e.phone||""}","${e.email||""}","${a}"\n`})),n}static generateFinancialCSV(e,t){let n="التقرير المالي الشامل - عيادة الأسنان الحديثة\n\n";const a=new Date,s=`${a.getDate().toString().padStart(2,"0")}/${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getFullYear()}`,r=a.toLocaleTimeString("ar-SA");if(n+=`تاريخ التقرير,${s}\n`,n+=`وقت الإنشاء,${r}\n\n`,e.filterInfo&&(n+="معلومات الفلترة المطبقة\n",n+=`نطاق البيانات,"${e.filterInfo}"\n`,n+=`عدد المعاملات المصدرة,${e.dataCount||0}\n\n`),n+="ملخص الإحصائيات المالية\n",n+=`إجمالي الإيرادات,${ca(e.totalRevenue||0)}\n`,n+=`المدفوعات المكتملة,${ca(e.completedPayments||0)}\n`,n+=`المدفوعات المعلقة,${ca(e.pendingPayments||0)}\n`,n+=`المدفوعات المتأخرة,${ca(e.overduePayments||0)}\n`,n+=`إجمالي المصروفات,${ca(e.totalExpenses||0)}\n`,n+=`صافي الربح,${ca(e.netProfit||0)}\n`,n+=`هامش الربح,${(e.profitMargin||0).toFixed(2)}%\n`,n+=`حالة الربحية,${(e.netProfit||0)>=0?"ربح":"خسارة"}\n`,e.payments&&Array.isArray(e.payments)){const t=e.payments.filter(e=>"partial"===e.status).reduce((e,t)=>{const n=void 0!==t.remaining_balance?Number(t.remaining_balance):Number(t.total_amount_due||t.amount)-Number(t.amount_paid||t.amount);return e+Math.max(0,n)},0);t>0&&(n+=`المبالغ المتبقية من الدفعات الجزئية,${ca(t)}\n`)}if(n+=`الرصيد المستحق الإجمالي,${ca(e.outstandingBalance||0)}\n\n`,e.paymentMethodStats&&e.paymentMethodStats.length>0){n+="توزيع طرق الدفع\n",n+="طريقة الدفع,المبلغ,عدد المعاملات,النسبة المئوية\n";const t=e.paymentMethodStats.reduce((e,t)=>e+t.amount,0);e.paymentMethodStats.forEach(e=>{const a=t>0?(e.amount/t*100).toFixed(1):"0.0";n+=`"${e.method}","${ca(e.amount)}","${e.count}","${a}%"\n`}),n+="\n"}if(t.includeDetails&&e.payments&&Array.isArray(e.payments)){const t=e.payments;n+="تفاصيل المعاملات المالية\n",n+="رقم الإيصال,تاريخ الدفع,اسم المريض,وصف العلاج,المبلغ الإجمالي,المبلغ المدفوع,الرصيد المتبقي,طريقة الدفع,الحالة,ملاحظات\n",t.forEach(e=>{var t,a,s;const r=e.receipt_number||`#${(null==(t=e.id)?void 0:t.slice(-6))||""}`,i=e.payment_date?ma(e.payment_date):"",l=e.patient_name||`${(null==(a=e.patient)?void 0:a.first_name)||""} ${(null==(s=e.patient)?void 0:s.last_name)||""}`.trim()||"غير محدد",o=e.description||e.treatment_type||"غير محدد";let d,c,u;"partial"===e.status?(d=ca(Number(e.total_amount_due||e.amount)||0),c=ca(Number(e.amount_paid||e.amount)||0),u=ca(Number(e.remaining_balance||0))):e.appointment_id&&e.appointment_total_cost?(d=ca(Number(e.appointment_total_cost)||0),c=ca(Number(e.appointment_total_paid||e.amount)||0),u=ca(Number(e.appointment_remaining_balance||0))):(d=ca(Number(e.amount)||0),c=ca(Number(e.amount)||0),u=ca(0));const m=this.translatePaymentMethod(e.payment_method||"غير محدد"),p=this.getPaymentStatusInArabic(e.status),h=e.notes||"";n+=`"${r}","${i}","${l}","${o}","${d}","${c}","${u}","${m}","${p}","${h}"\n`}),n+="\n"}if(e.expensesByType&&e.expensesByType.length>0&&(n+="توزيع المصروفات حسب النوع\n",n+="نوع المصروف,المبلغ,النسبة المئوية\n",e.expensesByType.forEach(e=>{n+=`"${e.type}","${ca(e.amount)}","${e.percentage.toFixed(2)}%"\n`}),n+="\n"),e.recentExpenses&&e.recentExpenses.length>0){n+="المصروفات الحديثة (آخر 10 مصروفات)\n",n+="اسم المصروف,النوع,المبلغ,طريقة الدفع,تاريخ الدفع,المورد,رقم الإيصال,ملاحظات\n";const t={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},a={cash:"نقداً",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمان"};e.recentExpenses.slice(0,10).forEach(e=>{const s=e.expense_name||"غير محدد",r=t[e.expense_type]||e.expense_type||"غير محدد",i=ca(e.amount||0),l=a[e.payment_method]||e.payment_method||"غير محدد",o=e.payment_date?ma(e.payment_date):"غير محدد",d=e.vendor||"غير محدد",c=e.receipt_number||"غير محدد",u=e.notes||"";n+=`"${s}","${r}","${i}","${l}","${o}","${d}","${c}","${u}"\n`}),n+="\n"}return n}static generateAppointmentCSV(e,t){var n,a;let s="تقرير المواعيد - عيادة الأسنان الحديثة\n\n";return s+="ملخص إحصائيات المواعيد\n",s+=`إجمالي المواعيد,${e.totalAppointments||0}\n`,s+=`المواعيد المكتملة,${e.completedAppointments||0}\n`,s+=`المواعيد الملغية,${e.cancelledAppointments||0}\n`,s+=`المواعيد المجدولة,${e.scheduledAppointments||0}\n`,s+=`عدم الحضور,${e.noShowAppointments||0}\n`,s+=`معدل الحضور,${(null==(n=e.attendanceRate)?void 0:n.toFixed(1))||"0.0"}%\n`,s+=`معدل الإلغاء,${(null==(a=e.cancellationRate)?void 0:a.toFixed(1))||"0.0"}%\n\n`,e.appointmentsByStatus&&e.appointmentsByStatus.length>0&&(s+="توزيع حالات المواعيد\n",s+="الحالة,العدد,النسبة المئوية\n",e.appointmentsByStatus.forEach(e=>{var t;const n=(null==(t=e.percentage)?void 0:t.toFixed(1))||"0.0";s+=`"${e.status}",${e.count},${n}%\n`}),s+="\n"),e.appointmentsByTreatment&&e.appointmentsByTreatment.length>0&&(s+="توزيع المواعيد حسب نوع العلاج\n",s+="نوع العلاج,عدد المواعيد\n",e.appointmentsByTreatment.forEach(e=>{s+=`"${e.treatment}",${e.count}\n`}),s+="\n"),e.filterInfo&&(s+="معلومات الفلترة\n",s+=`نطاق البيانات,"${e.filterInfo}"\n`,s+=`عدد المواعيد المصدرة,${e.dataCount||e.totalAppointments||0}\n`),s}static generateInventoryCSV(e,t){let n="تقرير المخزون - عيادة الأسنان الحديثة\n\n";return n+="ملخص إحصائيات المخزون\n",n+=`إجمالي العناصر,${e.totalItems||0}\n`,n+=`القيمة الإجمالية,${ca(e.totalValue||0)}\n`,n+=`عناصر منخفضة المخزون,${e.lowStockItems||0}\n`,n+=`عناصر منتهية الصلاحية,${e.expiredItems||0}\n`,n}static generateOverviewCSV(e,t){let n="التقرير الشامل - عيادة الأسنان الحديثة\n\n";return e.patients&&(n+=this.generatePatientCSV(e.patients,t)+"\n\n"),e.appointments&&(n+=this.generateAppointmentCSV(e.appointments,t)+"\n\n"),e.financial&&(n+=this.generateFinancialCSV(e.financial,t)+"\n\n"),e.inventory&&(n+=this.generateInventoryCSV(e.inventory,t)),n}static exportClinicNeedsToCSV(e,t="clinic-needs-report"){return m(this,null,function*(){try{const n=e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return"--";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${n}/${a}/${t.getFullYear()}`}catch(t){return"--"}},a=[["#","اسم الاحتياج","الكمية","السعر","الإجمالي","الوصف","الفئة","الأولوية","الحالة","المورد","الملاحظات","تاريخ الإنشاء","تاريخ التحديث"],...e.map(e=>{var t,a;return[e.serial_number||"",e.need_name||"",(null==(t=e.quantity)?void 0:t.toString())||"0",(null==(a=e.price)?void 0:a.toString())||"0",((e.price||0)*(e.quantity||0)).toString(),e.description||"",e.category||"",this.getPriorityLabel(e.priority||""),this.getStatusLabel(e.status||""),e.supplier||"",e.notes||"",e.created_at?n(e.created_at):"",e.updated_at?n(e.updated_at):""]})].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),s="\ufeff"+a;console.log(`✅ Clinic needs exported to Excel: ${t}.xlsx`);const r={format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"};yield this.convertCSVToExcel(s,"clinic-needs",r)}catch(n){throw console.error("Error exporting clinic needs to CSV:",n),new Error("فشل في تصدير احتياجات العيادة إلى CSV")}})}static getPriorityLabel(e){return{urgent:"عاجل",high:"عالي",medium:"متوسط",low:"منخفض"}[e]||e}static getStatusLabel(e){return{pending:"معلق",ordered:"مطلوب",received:"مستلم",cancelled:"ملغي"}[e]||e}static exportPatientsToPDF(e,t="عيادة الأسنان الحديثة"){return m(this,null,function*(){const t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1),a=e.filter(e=>new Date(e.created_at)>=n).length,s={children:0,teens:0,adults:0,seniors:0},r={male:0,female:0};let i=0,l=0;e.forEach(e=>{if(e.age&&"number"==typeof e.age&&e.age>0){const t=e.age;i+=t,l++,t<13?s.children++:t<20?s.teens++:t<60?s.adults++:s.seniors++}"male"===e.gender?r.male++:"female"===e.gender&&r.female++});const o=l>0?Math.round(i/l):0,d={totalPatients:e.length,newPatientsThisMonth:a,activePatients:e.length,averageAge:o,patients:e,ageDistribution:[{ageGroup:"أطفال (0-12)",count:s.children},{ageGroup:"مراهقون (13-19)",count:s.teens},{ageGroup:"بالغون (20-59)",count:s.adults},{ageGroup:"كبار السن (60+)",count:s.seniors}],genderDistribution:[{gender:"ذكور",count:r.male},{gender:"إناث",count:r.female}],registrationTrend:[]};yield this.exportToPDF("patients",d,{format:"pdf",includeCharts:!1,includeDetails:!0,language:"ar",orientation:"landscape",pageSize:"A4"})})}static exportAppointmentsToPDF(e,t="عيادة الأسنان الحديثة"){return m(this,null,function*(){const t=e.length,n=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"cancelled"===e.status).length,s=e.filter(e=>"no-show"===e.status).length,r=e.filter(e=>"scheduled"===e.status).length,i=t>0?Math.round(n/t*100):0,l=t>0?Math.round(a/t*100):0,o={totalAppointments:t,completedAppointments:n,cancelledAppointments:a,noShowAppointments:s,scheduledAppointments:r,attendanceRate:i,cancellationRate:l,appointmentsByStatus:[{status:"مكتمل",count:n,percentage:i},{status:"ملغي",count:a,percentage:l},{status:"لم يحضر",count:s,percentage:t>0?Math.round(s/t*100):0},{status:"مجدول",count:r,percentage:t>0?Math.round(r/t*100):0}],appointmentsByTreatment:[],appointmentsByDay:[],appointmentsByHour:[],peakHours:[],appointmentTrend:[],filterInfo:`البيانات المصدرة: ${t} موعد`,dataCount:t};yield this.exportToPDF("appointments",o,{format:"pdf",includeCharts:!1,includeDetails:!0,language:"ar",orientation:"landscape",pageSize:"A4"})})}static exportPaymentsToPDF(e,t="عيادة الأسنان الحديثة"){return m(this,null,function*(){const t=e.reduce((e,t)=>e+Number(t.amount),0),n=e.filter(e=>"completed"===e.status).reduce((e,t)=>e+Number(t.amount),0),a=e.filter(e=>"partial"===e.status).reduce((e,t)=>e+Number(t.amount),0),s=e.filter(e=>"pending"===e.status).reduce((e,t)=>e+Number(t.amount),0),r=e.filter(e=>"overdue"===e.status).reduce((e,t)=>e+Number(t.amount),0),i=e.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>{const n=t.payment_method||"غير محدد";e[n]||(e[n]={count:0,amount:0}),e[n].count++;const a=Number(t.amount);return e[n].amount+=a,e},{}),l={totalRevenue:t,completedPayments:n+a,pendingPayments:s,overduePayments:r,paymentMethodStats:Object.entries(i).map(([e,t])=>({method:e,count:t.count,amount:t.amount})),monthlyRevenue:[],revenueTrend:[],topTreatments:[],outstandingBalance:s+r,filterInfo:`البيانات المصدرة: ${e.length} دفعة (مكتملة: ${e.filter(e=>"completed"===e.status).length}, جزئية: ${e.filter(e=>"partial"===e.status).length})`,dataCount:e.length};yield this.exportToPDF("financial",l,{format:"pdf",includeCharts:!1,includeDetails:!0,language:"ar",orientation:"landscape",pageSize:"A4"})})}static exportPatientsToExcel(e){return m(this,null,function*(){const t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1),a=e.filter(e=>new Date(e.created_at)>=n).length,s={children:0,teens:0,adults:0,seniors:0},r={male:0,female:0};let i=0,l=0;e.forEach(e=>{if(e.age&&"number"==typeof e.age&&e.age>0){const t=e.age;i+=t,l++,t<13?s.children++:t<20?s.teens++:t<60?s.adults++:s.seniors++}"male"===e.gender?r.male++:"female"===e.gender&&r.female++});const o=l>0?Math.round(i/l):0,d={totalPatients:e.length,newPatientsThisMonth:a,activePatients:e.length,averageAge:o,patients:e,ageDistribution:[{ageGroup:"أطفال (0-12)",count:s.children},{ageGroup:"مراهقون (13-19)",count:s.teens},{ageGroup:"بالغون (20-59)",count:s.adults},{ageGroup:"كبار السن (60+)",count:s.seniors}],genderDistribution:[{gender:"ذكور",count:r.male},{gender:"إناث",count:r.female}],registrationTrend:[]};yield this.exportToExcel("patients",d,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})})}static exportAppointmentsToExcel(e){return m(this,null,function*(){const t=e.length,n=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"cancelled"===e.status).length,s=e.filter(e=>"no-show"===e.status).length,r=e.filter(e=>"scheduled"===e.status).length,i=t>0?Math.round(n/t*100):0,l=t>0?Math.round(a/t*100):0,o={totalAppointments:t,completedAppointments:n,cancelledAppointments:a,noShowAppointments:s,scheduledAppointments:r,attendanceRate:i,cancellationRate:l,appointmentsByStatus:[{status:"مكتمل",count:n,percentage:i},{status:"ملغي",count:a,percentage:l},{status:"لم يحضر",count:s,percentage:t>0?Math.round(s/t*100):0},{status:"مجدول",count:r,percentage:t>0?Math.round(r/t*100):0}],appointmentsByTreatment:[],appointmentsByDay:[],appointmentsByHour:[],peakHours:[],appointmentTrend:[],filterInfo:`البيانات المصدرة: ${t} موعد`,dataCount:t};yield this.exportToExcel("appointments",o,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})})}static exportTreatmentsToCSV(e){return m(this,null,function*(){const t=[];t.push(["نوع العلاج","فئة العلاج","حالة العلاج","التكلفة","تاريخ البداية","تاريخ الإنجاز","اسم المريض","رقم السن","تاريخ الإنشاء"]),e.forEach(e=>{var n;t.push([ad(e.treatment_type||""),sd(e.treatment_category||""),(n=e.treatment_status||"planned",{planned:"مخطط",in_progress:"قيد التنفيذ",completed:"مكتمل",cancelled:"ملغي"}[n]||n),e.cost||0,e.start_date||"",e.completion_date||"",e.patient_name||`مريض ${e.patient_id}`,e.tooth_number||"",e.created_at||""])});const n=e.length,a=e.filter(e=>"completed"===e.treatment_status).length,s=e.filter(e=>"planned"===e.treatment_status).length,r=e.filter(e=>"in_progress"===e.treatment_status).length,i=e.filter(e=>"cancelled"===e.treatment_status).length,l=e.filter(e=>"completed"===e.treatment_status).reduce((e,t)=>e+(e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100})(t.cost),0),o=n>0?Math.round(a/n*100):0;t.push([]),t.push(["ملخص الإحصائيات"]),t.push(["إجمالي العلاجات",n]),t.push(["العلاجات المكتملة",a]),t.push(["العلاجات المخططة",s]),t.push(["العلاجات قيد التنفيذ",r]),t.push(["العلاجات الملغية",i]),t.push(["إجمالي الإيرادات",l]),t.push(["معدل الإنجاز (%)",o]);const d="\ufeff"+t.map(e=>e.map(e=>`"${e}"`).join(",")).join("\n");yield this.convertCSVToExcel(d,"treatments",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"})})}static exportPaymentsToExcel(e){return m(this,null,function*(){const t=e.reduce((e,t)=>e+Number(t.amount),0),n=e.filter(e=>"completed"===e.status).reduce((e,t)=>e+Number(t.amount),0),a=e.filter(e=>"partial"===e.status).reduce((e,t)=>e+Number(t.amount),0),s=new Date;s.setDate(s.getDate()-30);const r=e.filter(e=>"pending"===e.status).filter(e=>new Date(e.payment_date||e.created_at)>=s).reduce((e,t)=>{const n=Number(t.amount)||0,a=Number(t.total_amount_due)||0;return e+(0===n&&a>0?a:n)},0),i=e.filter(e=>"pending"===e.status).filter(e=>new Date(e.payment_date||e.created_at)<s).reduce((e,t)=>{const n=Number(t.amount)||0,a=Number(t.total_amount_due)||0;return e+(0===n&&a>0?a:n)},0),l=e.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>{const n=t.payment_method||"غير محدد";e[n]||(e[n]={count:0,amount:0}),e[n].count++;const a=Number(t.amount);return e[n].amount+=a,e},{}),o=Object.entries(l).map(([e,t])=>({method:e,count:t.count,amount:t.amount})),d=new Map;let c=0;e.forEach(e=>{if("partial"===e.status)if(e.appointment_id){const t=e.appointment_id,n=Number(e.total_amount_due||e.appointment_total_cost||0),a=Number(e.amount||0);d.has(t)||d.set(t,{totalDue:n,totalPaid:0});d.get(t).totalPaid+=a}else{const t=Number(e.total_amount_due||e.amount||0),n=Number(e.amount_paid||e.amount||0);c+=Math.max(0,t-n)}});const u=Array.from(d.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0)+c,m={totalRevenue:t,completedPayments:n+a,pendingPayments:r,overduePayments:i,paymentMethodStats:o,monthlyRevenue:[],revenueTrend:[],topTreatments:[],outstandingBalance:r+i+u,filterInfo:`البيانات المصدرة: ${e.length} دفعة (مكتملة: ${e.filter(e=>"completed"===e.status).length}, جزئية: ${e.filter(e=>"partial"===e.status).length}, معلقة: ${e.filter(e=>"pending"===e.status).length}, متأخرة: ${i>0?e.filter(e=>"pending"===e.status&&new Date(e.payment_date||e.created_at)<s).length:0}, مبلغ متبقي من الجزئية: ${ca(u)})`,dataCount:e.length};yield this.exportToExcel("financial",m,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})})}static exportPaymentsToCSV(e){return m(this,null,function*(){const t=e.reduce((e,t)=>e+Number(t.amount),0),n=e.filter(e=>"completed"===e.status).reduce((e,t)=>e+Number(t.amount),0),a=e.filter(e=>"partial"===e.status).reduce((e,t)=>e+Number(t.amount),0),s=new Date;s.setDate(s.getDate()-30);const r=e.filter(e=>"pending"===e.status).filter(e=>new Date(e.payment_date||e.created_at)>=s).reduce((e,t)=>{const n=Number(t.amount)||0,a=Number(t.total_amount_due)||0;return e+(0===n&&a>0?a:n)},0),i=e.filter(e=>"pending"===e.status).filter(e=>new Date(e.payment_date||e.created_at)<s).reduce((e,t)=>{const n=Number(t.amount)||0,a=Number(t.total_amount_due)||0;return e+(0===n&&a>0?a:n)},0),l=e.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>{const n=t.payment_method||"غير محدد";e[n]||(e[n]={count:0,amount:0}),e[n].count++;const a=Number(t.amount);return e[n].amount+=a,e},{}),o=Object.entries(l).map(([e,t])=>({method:e,count:t.count,amount:t.amount})),d=new Map;let c=0;e.forEach(e=>{if("partial"===e.status)if(e.appointment_id){const t=e.appointment_id,n=Number(e.total_amount_due||e.appointment_total_cost||0),a=Number(e.amount||0);d.has(t)||d.set(t,{totalDue:n,totalPaid:0});d.get(t).totalPaid+=a}else{const t=Number(e.total_amount_due||e.amount||0),n=Number(e.amount_paid||e.amount||0);c+=Math.max(0,t-n)}});const u=Array.from(d.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0)+c,m={totalRevenue:t,completedPayments:n+a,pendingPayments:r,overduePayments:i,paymentMethodStats:o,monthlyRevenue:[],revenueTrend:[],topTreatments:[],outstandingBalance:r+i+u,filterInfo:`البيانات المصدرة: ${e.length} دفعة (مكتملة: ${e.filter(e=>"completed"===e.status).length}, جزئية: ${e.filter(e=>"partial"===e.status).length}, معلقة: ${e.filter(e=>"pending"===e.status).length}, متأخرة: ${i>0?e.filter(e=>"pending"===e.status&&new Date(e.payment_date||e.created_at)<s).length:0}, مبلغ متبقي من الجزئية: ${ca(u)})`,dataCount:e.length,payments:e};yield this.exportToCSV("financial",m,{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"})})}static exportLabsToExcel(e,t){return m(this,null,function*(){const n=e.length,a=t.length,s=t.reduce((e,t)=>e+Number(t.cost),0),r=t.reduce((e,t)=>e+Number(t.paid_amount||0),0),i=t.reduce((e,t)=>e+Number(t.remaining_balance||0),0),l={summary:{"إجمالي المختبرات":n,"إجمالي الطلبات":a,"إجمالي التكلفة":ca(s),"إجمالي المدفوع":ca(r),"إجمالي المتبقي":ca(i),"تاريخ التقرير":ma(new Date)},labs:e.map(e=>d(o({},e),{ordersCount:t.filter(t=>t.lab_id===e.id).length})),labOrders:t,filterInfo:`البيانات المصدرة: ${e.length} مختبر، ${t.length} طلب`,dataCount:e.length+t.length};yield this.exportToExcel("labs",l,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})})}static exportClinicNeedsToExcel(e){return m(this,null,function*(){const t={summary:{"إجمالي الاحتياجات":e.length,"احتياجات معلقة":e.filter(e=>"pending"===e.status).length,"احتياجات مطلوبة":e.filter(e=>"ordered"===e.status).length,"احتياجات مستلمة":e.filter(e=>"received"===e.status).length,"احتياجات عاجلة":e.filter(e=>"urgent"===e.priority).length,"احتياجات عالية الأولوية":e.filter(e=>"high"===e.priority).length,"تاريخ التقرير":ma(new Date)},needs:e,filterInfo:`البيانات المصدرة: ${e.length} احتياج`,dataCount:e.length};yield this.exportToExcel("clinic-needs",t,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})})}static exportInventoryToExcel(e){return m(this,null,function*(){const t=e.length,n=e.filter(e=>{const t=parseFloat(String(e.cost_per_unit||0))||0,n=parseFloat(String(e.unit_price||0))||0;return 0===t&&0===n});n.length>0&&console.warn(`⚠️ ${n.length} عنصر لا يحتوي على سعر:`,n.map(e=>e.name));const a=e.reduce((e,t)=>{const n=parseFloat(String(t.quantity||0))||0,a=parseFloat(String(t.cost_per_unit||0))||0,s=parseFloat(String(t.unit_price||0))||0;return e+n*(a||s)},0),s=e.filter(e=>Number(e.quantity)<=Number(e.minimum_stock||0)).length,r=e.filter(e=>0===Number(e.quantity)).length,i=e.filter(e=>e.expiry_date&&new Date(e.expiry_date)<new Date).length,l={summary:{"إجمالي العناصر":t,"القيمة الإجمالية":ca(a),"عناصر منخفضة المخزون":s,"عناصر نفدت من المخزون":r,"عناصر منتهية الصلاحية":i,"عناصر بدون أسعار":n.length,"تاريخ التقرير":ma(new Date)},items:e,filterInfo:`البيانات المصدرة: ${e.length} عنصر${n.length>0?` (${n.length} بدون أسعار)`:""}`,dataCount:e.length};yield this.exportToExcel("inventory",l,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})})}static exportClinicExpensesToExcel(e){return m(this,null,function*(){if(!e||0===e.length)throw new Error("لا توجد بيانات مصروفات للتصدير");const t=e.reduce((e,t)=>e+(parseFloat(String(t.amount||0))||0),0),n=e.filter(e=>"paid"===e.status).reduce((e,t)=>e+(parseFloat(String(t.amount||0))||0),0),a=e.filter(e=>"pending"===e.status).reduce((e,t)=>e+(parseFloat(String(t.amount||0))||0),0),s=e.filter(e=>"overdue"===e.status).reduce((e,t)=>e+(parseFloat(String(t.amount||0))||0),0),r={summary:{"إجمالي المصروفات":e.length,"إجمالي المبلغ":ca(t),"المبلغ المدفوع":ca(n),"المبلغ المعلق":ca(a),"المبلغ المتأخر":ca(s),"تاريخ التقرير":ma(new Date)},expenses:e,filterInfo:`البيانات المصدرة: ${e.length} مصروف`,dataCount:e.length};yield this.exportToExcel("clinic-expenses",r,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})})}static filterDataByDateRange(e,t,n){if(!t||!t.start||!t.end)return e;const a=new Date(t.start),s=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),r=new Date(t.end),i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);return e.filter(e=>{const t=e[n];if(!t)return!1;const a=new Date(t);let r;return r=t.includes("T")||t.includes(" ")?a:new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),r>=s&&r<=i})}static exportProfitLossToExcel(e){return m(this,null,function*(){const{reportData:t,payments:n,labOrders:a,clinicNeeds:s,inventoryItems:r,clinicExpenses:i,patients:l,appointments:o,filter:d,currency:c}=e,u=this.filterDataByDateRange(n,d,"payment_date"),m=this.filterDataByDateRange(a,d,"order_date"),p=this.filterDataByDateRange(s,d,"created_at"),h=this.filterDataByDateRange(o,d,"created_at"),x=this.filterDataByDateRange(r,d,"created_at"),g=i?this.filterDataByDateRange(i,d,"payment_date"):[],f={summary:{"إجمالي الإيرادات":ca(t.revenue.totalRevenue),"إجمالي المصروفات":ca(t.calculations.totalExpenses),"صافي الربح/الخسارة":ca(t.calculations.isProfit?t.calculations.netProfit:-t.calculations.lossAmount),"نسبة الربح":`${t.calculations.profitMargin.toFixed(2)}%`,"حالة المالية":t.calculations.isProfit?"ربح":"خسارة","إجمالي المرضى":t.details.totalPatients,"إجمالي المواعيد":t.details.totalAppointments,"متوسط الإيرادات لكل مريض":ca(t.details.averageRevenuePerPatient),"متوسط الإيرادات لكل موعد":ca(t.details.averageRevenuePerAppointment),"الفترة الزمنية":t.filterInfo.dateRange,"تاريخ التقرير":ma(new Date)},revenue:{completedPayments:t.revenue.completedPayments,partialPayments:t.revenue.partialPayments,remainingBalances:t.revenue.remainingBalances,pendingPayments:t.revenue.pendingAmount||0,totalRevenue:t.revenue.totalRevenue},expenses:{labOrdersTotal:t.expenses.labOrdersTotal,labOrdersRemaining:t.expenses.labOrdersRemaining,clinicNeedsTotal:t.expenses.clinicNeedsTotal,clinicNeedsRemaining:t.expenses.clinicNeedsRemaining,inventoryExpenses:t.expenses.inventoryExpenses,clinicExpensesTotal:t.expenses.clinicExpensesTotal||0},payments:u,labOrders:m,clinicNeeds:p,inventoryItems:x,clinicExpenses:g,patients:l,appointments:h,filterInfo:`تقرير الأرباح والخسائر - ${t.filterInfo.dateRange} - ${u.length} دفعة، ${m.length} طلب مختبر، ${p.length} احتياج، ${x.length} عنصر مخزون، ${g.length} مصروف`,dataCount:u.length+m.length+p.length+x.length+g.length};yield this.exportToExcel("profit-loss",f,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})})}static generateProfitLossCSV(e,t){let n="";return n+="التقرير الشامل للأرباح والخسائر\n",n+=`تاريخ التقرير,${ma(new Date)}\n`,n+=`وقت التقرير,${(new Date).toLocaleTimeString("ar-SA")}\n\n`,e.summary&&(n+="ملخص الأرباح والخسائر\n",Object.entries(e.summary).forEach(([e,t])=>{n+=`${e},${t}\n`}),n+="\n"),e.revenue&&(n+="تفاصيل الإيرادات\n",n+=`المدفوعات المكتملة,${ca(e.revenue.completedPayments||0)}\n`,n+=`المدفوعات الجزئية,${ca(e.revenue.partialPayments||0)}\n`,n+=`المبالغ المتبقية,${ca(e.revenue.remainingBalances||0)}\n`,n+=`إجمالي الإيرادات,${ca(e.revenue.totalRevenue||0)}\n\n`),e.expenses&&(n+="تفاصيل المصروفات\n",n+=`مدفوعات المخابر,${ca(e.expenses.labOrdersTotal||0)}\n`,n+=`متبقي المخابر,${ca(e.expenses.labOrdersRemaining||0)}\n`,n+=`احتياجات العيادة,${ca(e.expenses.clinicNeedsTotal||0)}\n`,n+=`متبقي الاحتياجات,${ca(e.expenses.clinicNeedsRemaining||0)}\n`,n+=`قيمة المخزون,${ca(e.expenses.inventoryExpenses||0)}\n`,n+=`مصروفات العيادة المباشرة,${ca(e.expenses.clinicExpensesTotal||0)}\n\n`),e.payments&&e.payments.length>0&&(n+="تفاصيل المدفوعات\n",n+="رقم المريض,اسم المريض,المبلغ,الحالة,طريقة الدفع,تاريخ الدفع,ملاحظات\n",e.payments.forEach(e=>{const t="completed"===e.status?"مكتمل":"partial"===e.status?"جزئي":"معلق",a=e.payment_date?ma(e.payment_date):"";n+=`${e.patient_id||""},${e.patient_name||""},${ca(e.amount||0)},${t},${e.payment_method||""},${a},"${e.notes||""}"\n`}),n+="\n"),e.labOrders&&e.labOrders.length>0&&(n+="تفاصيل طلبات المخابر\n",n+="رقم الطلب,اسم المختبر,اسم المريض,التكلفة,المدفوع,المتبقي,الحالة,تاريخ الطلب\n",e.labOrders.forEach(e=>{var t,a;const s="completed"===e.status?"مكتمل":"pending"===e.status?"معلق":"ملغي",r=e.order_date?ma(e.order_date):"",i=(e.cost||0)-(e.paid_amount||0);n+=`${e.id||""},${(null==(t=e.lab)?void 0:t.name)||""},${(null==(a=e.patient)?void 0:a.full_name)||""},${ca(e.cost||0)},${ca(e.paid_amount||0)},${ca(i)},${s},${r}\n`}),n+="\n"),e.clinicNeeds&&e.clinicNeeds.length>0&&(n+="تفاصيل احتياجات العيادة\n",n+="اسم العنصر,الكمية,الأولوية,الحالة,التاريخ المطلوب,التاريخ المستلم,ملاحظات\n",e.clinicNeeds.forEach(e=>{const t="urgent"===e.priority?"عاجل":"high"===e.priority?"عالي":"عادي",a="received"===e.status?"مستلم":"ordered"===e.status?"مطلوب":"معلق",s=e.date_needed?ma(e.date_needed):"",r=e.date_received?ma(e.date_received):"";n+=`${e.item_name||""},${e.quantity||0},${t},${a},${s},${r},"${e.notes||""}"\n`}),n+="\n"),e.inventoryItems&&e.inventoryItems.length>0&&(n+="تفاصيل المخزون\n",n+="اسم العنصر,الكمية,سعر الوحدة,القيمة الإجمالية,الحد الأدنى,تاريخ الانتهاء,الفئة\n",e.inventoryItems.forEach(e=>{const t=parseFloat(String(e.cost_per_unit||0))||0,a=parseFloat(String(e.unit_price||0))||0,s=t||a,r=parseFloat(String(e.quantity||0))||0,i=r*s,l=e.expiry_date?ma(e.expiry_date):"";n+=`${e.name||""},${r},${ca(s)},${ca(i)},${e.minimum_stock||0},${l},${e.category||""}\n`}),n+="\n"),e.clinicExpenses&&e.clinicExpenses.length>0&&(n+="تفاصيل مصروفات العيادة\n",n+="اسم المصروف,النوع,المبلغ,طريقة الدفع,تاريخ الدفع,المورد,ملاحظات\n",e.clinicExpenses.forEach(e=>{const t=e.payment_date?ma(e.payment_date):"";n+=`${e.expense_name||""},${e.expense_type||""},${ca(e.amount||0)},${e.payment_method||""},${t},${e.vendor||""},"${e.notes||""}"\n`}),n+="\n"),n+="معلومات التقرير\n",n+=`${e.filterInfo||""}\n`,n+=`إجمالي السجلات,${e.dataCount||0}\n`,n}};function lc(){wd(),_d();const{toast:e}=yl(),[t,n]=ve.useState(!1),[a,s]=ve.useState(!1),[r,i]=ve.useState(!1),[l,o]=ve.useState(!1),[d,c]=ve.useState(!1),[u,h]=ve.useState(null),[x,g]=ve.useState(void 0),{payments:f,filteredPayments:v,isLoading:y,error:b,searchQuery:j,statusFilter:w,paymentMethodFilter:N,totalRevenue:_,pendingAmount:k,totalRemainingBalance:S,partialPaymentsCount:D,pendingPaymentsCount:$,paymentMethodStats:C,loadPayments:E,deletePayment:T,clearError:A,setSearchQuery:F,setStatusFilter:P,setPaymentMethodFilter:O}=Go(),{loadPatients:R,patients:M}=cl(),L=Bd({data:f,dateField:"payment_date",initialFilter:{preset:"all",startDate:"",endDate:""}});ve.useEffect(()=>{E(),R()},[E,R]),ve.useEffect(()=>{(()=>{try{const e=localStorage.getItem("selectedPatientForPayment");if(e){const t=JSON.parse(e);console.log("Found pre-selected patient for payment:",t),g(t.selectedPatientId),t.openAddDialog&&n(!0),localStorage.removeItem("selectedPatientForPayment")}}catch(e){console.error("Error reading pre-selected patient for payment:",e)}})()},[]),ve.useEffect(()=>{const e=localStorage.getItem("selectedPaymentForDetails");if(e)try{const{payment:t,openDetailsModal:n}=JSON.parse(e);n&&t&&(h(t),o(!0),localStorage.removeItem("selectedPaymentForDetails"))}catch(t){console.error("Error parsing search result data:",t),localStorage.removeItem("selectedPaymentForDetails")}},[]),ve.useEffect(()=>{b&&(e({title:"خطأ",description:b,variant:"destructive"}),A())},[b,e,A]);const I=""!==j||"all"!==w||"all"!==N;return p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-heading-1 text-foreground arabic-enhanced",children:"إدارة المدفوعات"}),p.jsx("p",{className:"text-body text-muted-foreground mt-2 arabic-enhanced",children:"تتبع المدفوعات والفواتير والسجلات المالية"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",onClick:()=>m(this,null,function*(){if(0!==f.length)try{const e=e=>{const t=M.find(t=>t.id===e.patient_id);return(null==t?void 0:t.full_name)||"غير محدد"};let t=[...f];if(L.timeFilter.startDate&&L.timeFilter.endDate){const e=new Date(L.timeFilter.startDate),n=new Date(L.timeFilter.endDate);n.setHours(23,59,59,999),t=t.filter(t=>{const a=new Date(t.payment_date);return a>=e&&a<=n})}j&&(t=t.filter(t=>{var n,a;const s=e(t);return(null==(n=t.receipt_number)?void 0:n.toLowerCase().includes(j.toLowerCase()))||(null==(a=t.description)?void 0:a.toLowerCase().includes(j.toLowerCase()))||s.toLowerCase().includes(j.toLowerCase())||t.amount.toString().includes(j)||t.payment_method.toLowerCase().includes(j.toLowerCase())||t.status.toLowerCase().includes(j.toLowerCase())})),"all"!==w&&(t=t.filter(e=>e.status===w)),"all"!==N&&(t=t.filter(e=>e.payment_method===N)),yield ic.exportPaymentsToExcel(t);let n=`تم تصدير ${t.length} دفعة بنجاح إلى ملف Excel!`;L.timeFilter.startDate&&L.timeFilter.endDate&&(n+=` (مفلترة من ${L.timeFilter.startDate} إلى ${L.timeFilter.endDate})`),("all"!==w||"all"!==N||j)&&(n+=" مع فلاتر مطبقة"),rc.exportSuccess(n)}catch(e){console.error("Error exporting payments:",e),rc.exportError("فشل في تصدير بيانات المدفوعات")}else rc.noDataToExport("لا توجد بيانات مدفوعات للتصدير")}),children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير"]}),p.jsxs(Qi,{onClick:()=>{console.log("Add payment clicked"),g(void 0),n(!0)},children:[p.jsx(di,{className:"w-4 h-4 ml-2"}),"تسجيل دفعة جديدة"]})]})]}),p.jsx(zd,{value:L.timeFilter,onChange:L.handleFilterChange,onClear:L.resetFilter,title:"فلترة زمنية - المدفوعات",defaultOpen:!1}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[p.jsxs(Lo,{className:vd("green"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground",children:"all"===L.timeFilter.preset||!L.timeFilter.startDate&&!L.timeFilter.endDate?"إجمالي الإيرادات":"الإيرادات المفلترة"}),p.jsx(Er,{className:`h-4 w-4 ${yd("green")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===L.timeFilter.preset||!L.timeFilter.startDate&&!L.timeFilter.endDate?ca(_):ca(L.financialStats.totalRevenue)}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===L.timeFilter.preset||!L.timeFilter.startDate&&!L.timeFilter.endDate?"من المدفوعات المكتملة والجزئية":"من المدفوعات المكتملة والجزئية في الفترة المحددة"}),L.trend&&p.jsxs("div",{className:"text-xs flex items-center mt-1 "+(L.trend.isPositive?"text-green-600":"text-red-600"),children:[p.jsx(ki,{className:"w-3 h-3 ml-1 "+(L.trend.isPositive?"":"rotate-180")}),p.jsxs("span",{children:[Math.abs(L.trend.changePercent),"% من الفترة السابقة"]})]})]})]}),p.jsxs(Lo,{className:vd("red"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground",children:"all"===L.timeFilter.preset||!L.timeFilter.startDate&&!L.timeFilter.endDate?"المبالغ غير المدفوعة":"المبالغ غير المدفوعة المفلترة"}),p.jsx(sr,{className:`h-4 w-4 ${yd("red")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===L.timeFilter.preset||!L.timeFilter.startDate&&!L.timeFilter.endDate?ca(k):ca(L.financialStats.pendingAmount)}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===L.timeFilter.preset||!L.timeFilter.startDate&&!L.timeFilter.endDate?"من العلاجات والمواعيد المعلقة":"من العلاجات والمواعيد المعلقة في الفترة المحددة"})]})]}),p.jsxs(Lo,{className:vd("yellow"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground",children:"all"===L.timeFilter.preset||!L.timeFilter.startDate&&!L.timeFilter.endDate?"المبالغ المتبقية":"المبالغ المتبقية المفلترة"}),p.jsx(Sr,{className:`h-4 w-4 ${yd("yellow")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground",children:(()=>{let e=[...f];if(L.timeFilter.startDate&&L.timeFilter.endDate){const t=new Date(L.timeFilter.startDate),n=new Date(L.timeFilter.endDate);n.setHours(23,59,59,999),e=e.filter(e=>{const a=new Date(e.payment_date);return a>=t&&a<=n})}j&&(e=e.filter(e=>{var t,n,a;const s=(null==(t=M.find(t=>t.id===e.patient_id))?void 0:t.full_name)||"";return(null==(n=e.receipt_number)?void 0:n.toLowerCase().includes(j.toLowerCase()))||(null==(a=e.description)?void 0:a.toLowerCase().includes(j.toLowerCase()))||s.toLowerCase().includes(j.toLowerCase())||e.amount.toString().includes(j)||e.payment_method.toLowerCase().includes(j.toLowerCase())||e.status.toLowerCase().includes(j.toLowerCase())})),"all"!==w&&(e=e.filter(e=>e.status===w)),"all"!==N&&(e=e.filter(e=>e.payment_method===N));const t=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},n=new Map,a=new Map;let s=0;e.forEach(e=>{if("partial"===e.status)if(e.tooth_treatment_id){const a=e.tooth_treatment_id,s=t(e.treatment_total_cost||e.total_amount_due||0),r=t(e.amount);n.has(a)||n.set(a,{totalDue:s,totalPaid:0});n.get(a).totalPaid+=r}else if(e.appointment_id){const n=e.appointment_id,s=t(e.total_amount_due||0),r=t(e.amount);a.has(n)||a.set(n,{totalDue:s,totalPaid:0});a.get(n).totalPaid+=r}else{const n=t(e.total_amount_due||e.amount),a=t(e.amount_paid||e.amount);s+=Math.max(0,n-a)}});const r=Array.from(n.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0),i=Array.from(a.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0),l=t(r+i+s);return ca(L.timeFilter.startDate&&L.timeFilter.endDate?l:S)})()}),p.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{let e=[...f];if(L.timeFilter.startDate&&L.timeFilter.endDate){const t=new Date(L.timeFilter.startDate),n=new Date(L.timeFilter.endDate);n.setHours(23,59,59,999),e=e.filter(e=>{const a=new Date(e.payment_date);return a>=t&&a<=n})}j&&(e=e.filter(e=>{var t,n,a;const s=(null==(t=M.find(t=>t.id===e.patient_id))?void 0:t.full_name)||"";return(null==(n=e.receipt_number)?void 0:n.toLowerCase().includes(j.toLowerCase()))||(null==(a=e.description)?void 0:a.toLowerCase().includes(j.toLowerCase()))||s.toLowerCase().includes(j.toLowerCase())||e.amount.toString().includes(j)||e.payment_method.toLowerCase().includes(j.toLowerCase())||e.status.toLowerCase().includes(j.toLowerCase())})),"all"!==w&&(e=e.filter(e=>e.status===w)),"all"!==N&&(e=e.filter(e=>e.payment_method===N));const t=e.filter(e=>"partial"===e.status).length;return"all"===L.timeFilter.preset||!L.timeFilter.startDate&&!L.timeFilter.endDate?`من ${D} دفعة جزئية`:`من ${t} دفعة جزئية في الفترة المحددة`})()})]})]}),p.jsxs(Lo,{className:vd("purple"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground",children:"all"===L.timeFilter.preset||!L.timeFilter.startDate&&!L.timeFilter.endDate?"معدل الإنجاز":"معدل الإنجاز المفلتر"}),p.jsx(ki,{className:`h-4 w-4 ${yd("purple")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground",children:(()=>{let e=[...f];if(L.timeFilter.startDate&&L.timeFilter.endDate){const t=new Date(L.timeFilter.startDate),n=new Date(L.timeFilter.endDate);n.setHours(23,59,59,999),e=e.filter(e=>{const a=new Date(e.payment_date);return a>=t&&a<=n})}const t=e.length,n=e.filter(e=>"completed"===e.status).length;return`${t>0?(n/t*100).toFixed(1):"0.0"}%`})()}),p.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{let e=[...f];if(L.timeFilter.startDate&&L.timeFilter.endDate){const t=new Date(L.timeFilter.startDate),n=new Date(L.timeFilter.endDate);n.setHours(23,59,59,999),e=e.filter(e=>{const a=new Date(e.payment_date);return a>=t&&a<=n})}const t=e.filter(e=>"completed"===e.status).length,n=e.length;return"all"===L.timeFilter.preset||!L.timeFilter.startDate&&!L.timeFilter.endDate?`${t} مكتملة من ${n} إجمالي`:`${t} مكتملة من ${n} في الفترة المحددة`})()})]})]})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsx(zo,{className:"text-lg arabic-enhanced",children:"البحث والتصفية"})}),p.jsxs(Yo,{children:[p.jsx("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:p.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-1",children:[p.jsxs("div",{className:"relative flex-1 max-w-sm",children:[p.jsx(hi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{placeholder:"البحث في المدفوعات...",value:j,onChange:e=>F(e.target.value),className:"pl-10 arabic-enhanced text-right"})]}),p.jsxs(el,{value:w,onValueChange:P,children:[p.jsxs(al,{className:"w-[180px]",children:[p.jsx(Or,{className:"w-4 h-4 mr-2"}),p.jsx(nl,{placeholder:"تصفية حسب الحالة"})]}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الحالات"}),p.jsx(dl,{value:"completed",children:"مكتمل"}),p.jsx(dl,{value:"pending",children:"معلق"}),p.jsx(dl,{value:"partial",children:"جزئي"}),p.jsx(dl,{value:"overdue",children:"متأخر"}),p.jsx(dl,{value:"failed",children:"فاشل"}),p.jsx(dl,{value:"refunded",children:"مسترد"})]})]}),p.jsxs(el,{value:N,onValueChange:O,children:[p.jsxs(al,{className:"w-[180px]",children:[p.jsx(Or,{className:"w-4 h-4 mr-2"}),p.jsx(nl,{placeholder:"تصفية حسب طريقة الدفع"})]}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع طرق الدفع"}),p.jsx(dl,{value:"cash",children:"نقداً"}),p.jsx(dl,{value:"card",children:"بطاقة ائتمان"}),p.jsx(dl,{value:"bank_transfer",children:"تحويل بنكي"}),p.jsx(dl,{value:"check",children:"شيك"}),p.jsx(dl,{value:"insurance",children:"تأمين"})]})]}),I&&p.jsxs(Qi,{variant:"outline",onClick:()=>{F(""),P("all"),O("all")},className:"flex items-center gap-2",children:[p.jsx(Mi,{className:"w-4 h-4"}),"مسح الفلاتر"]})]})}),I&&p.jsxs("div",{className:"mt-4 text-sm text-muted-foreground arabic-enhanced",children:["عرض ",v.length," من أصل ",f.length," مدفوعة"]})]})]}),p.jsx(ac,{payments:v,patients:M,isLoading:y,onEdit:e=>{h(e),s(!0)},onDelete:e=>{h(e),i(!0)},onShowReceipt:e=>{h(e),o(!0)},onViewDetails:e=>{h(e),c(!0)}}),p.jsx(xd,{open:t,onOpenChange:e=>{n(e),e||g(void 0)},preSelectedPatientId:x}),u&&p.jsxs(p.Fragment,{children:[p.jsx(Yd,{open:a,onOpenChange:s,payment:u}),p.jsx(Vd,{open:r,onOpenChange:i,payment:u}),p.jsx(Kd,{open:l,onOpenChange:o,payment:u}),p.jsx(Zd,{open:d,onOpenChange:c,payment:u,patients:M})]})]})}const oc=Ne()(Lt((e,t)=>({backups:[],isLoading:!1,error:null,isCreatingBackup:!1,isRestoringBackup:!1,lastBackupDate:null,autoBackupEnabled:!0,backupFrequency:"daily",loadBackups:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const[t,n]=yield Promise.all([window.electronAPI.backup.list(),window.electronAPI.settings.get()]),a=Array.isArray(t)&&t.length>0&&"string"==typeof t[0]?t.map(e=>({name:e,path:e,size:0,created_at:(new Date).toISOString(),version:"1.0.0"})):t;e({backups:a,isLoading:!1,lastBackupDate:a.length>0?a[0].created_at:null,autoBackupEnabled:"disabled"!==(null==n?void 0:n.backup_frequency)&&void 0!==(null==n?void 0:n.backup_frequency),backupFrequency:"disabled"===(null==n?void 0:n.backup_frequency)||"hourly"===(null==n?void 0:n.backup_frequency)?"daily":(null==n?void 0:n.backup_frequency)||"daily"})}catch(t){e({error:t instanceof Error?t.message:"فشل في تحميل قائمة النسخ الاحتياطية",isLoading:!1})}}),createBackup:(n,a)=>m(void 0,null,function*(){e({isCreatingBackup:!0,error:null});try{const s=yield window.electronAPI.backup.create(n,a);return yield t().loadBackups(),e({isCreatingBackup:!1}),s}catch(s){throw e({error:s instanceof Error?s.message:"فشل في إنشاء النسخة الاحتياطية",isCreatingBackup:!1}),s}}),restoreBackup:t=>m(void 0,null,function*(){e({isRestoringBackup:!0,error:null});try{const n=yield window.electronAPI.backup.restore(t);return e({isRestoringBackup:!1}),n}catch(n){throw e({error:n instanceof Error?n.message:"فشل في استعادة النسخة الاحتياطية",isRestoringBackup:!1}),n}}),deleteBackup:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{yield window.electronAPI.backup.delete(n),yield t().loadBackups()}catch(a){throw e({error:a instanceof Error?a.message:"فشل في حذف النسخة الاحتياطية",isLoading:!1}),a}}),setAutoBackupEnabled:n=>m(void 0,null,function*(){e({autoBackupEnabled:n});try{const e=t().backupFrequency,a="monthly"===e?"weekly":e;yield window.electronAPI.settings.update({backup_frequency:n?a:"disabled"})}catch(a){console.error("Failed to update backup settings:",a)}}),setBackupFrequency:n=>m(void 0,null,function*(){e({backupFrequency:n});const{autoBackupEnabled:a}=t();if(a)try{const e="monthly"===n?"weekly":n;yield window.electronAPI.settings.update({backup_frequency:e})}catch(s){console.error("Failed to update backup frequency:",s)}}),selectBackupFile:()=>m(void 0,null,function*(){try{const e=yield window.electronAPI.dialog.showOpenDialog({title:"اختر ملف النسخة الاحتياطية",filters:[{name:"نسخ احتياطية مع صور",extensions:["zip"]},{name:"ملفات قاعدة البيانات",extensions:["db","sqlite"]},{name:"ملفات النسخ الاحتياطية القديمة",extensions:["json"]},{name:"ملفات النسخ الاحتياطية الأخرى",extensions:["backup","bak"]},{name:"جميع الملفات",extensions:["*"]}],properties:["openFile"]});return e.canceled?null:e.filePaths[0]}catch(t){return e({error:t instanceof Error?t.message:"فشل في اختيار الملف"}),null}}),runBackupTest:()=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const t=yield window.electronAPI.backup.test();return e({isLoading:!1}),t}catch(t){return e({error:t instanceof Error?t.message:"فشل في تشغيل اختبار النسخ الاحتياطي",isLoading:!1}),{success:!1,results:[],error:t instanceof Error?t.message:"Unknown error"}}}),clearError:()=>{e({error:null})},formatBackupSize:e=>{if(0===e)return"0 بايت";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["بايت","كيلوبايت","ميجابايت","جيجابايت"][t]},formatBackupDate:e=>{const t=new Date(e),n=t.getDate(),a=t.getMonth()+1,s=t.getFullYear(),r=t.getHours(),i=t.getMinutes();return`${n.toString().padStart(2,"0")}/${a.toString().padStart(2,"0")}/${s} في ${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},getBackupStatus:()=>{const{backups:e,backupFrequency:n,lastBackupDate:a}=t();let s=null;if(a){const e=new Date(a),t=new Date(e);switch(n){case"daily":t.setDate(t.getDate()+1);break;case"weekly":t.setDate(t.getDate()+7);break;case"monthly":t.setMonth(t.getMonth()+1)}const r=t.getDate(),i=t.getMonth()+1,l=t.getFullYear();s=`${r.toString().padStart(2,"0")}/${i.toString().padStart(2,"0")}/${l}`}return{totalBackups:e.length,lastBackup:a?t().formatBackupDate(a):null,nextScheduledBackup:s}}}),{name:"backup-store"}));function dc(e){return m(this,null,function*(){try{const t=(new TextEncoder).encode(e+"dental_clinic_salt_2024"),n=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(t){throw console.error("Error hashing password:",t),t}})}function cc(e,t){return Promise.race([e,new Promise((e,n)=>setTimeout(()=>n(new Error("Operation timed out")),t))])}const uc=Ki("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),mc=ve.forwardRef((e,t)=>{var n=e,{className:a,variant:s}=n,r=c(n,["className","variant"]);return p.jsx("div",o({ref:t,role:"alert",className:aa(uc({variant:s}),a)},r))});mc.displayName="Alert";ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("h5",o({ref:t,className:aa("mb-1 font-medium leading-none tracking-tight",a)},s))}).displayName="AlertTitle";const pc=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,className:aa("text-sm [&_p]:leading-relaxed",a)},s))});pc.displayName="AlertDescription";const hc=["ما هو اسم أول مدرسة التحقت بها؟","ما هو اسم حيوانك الأليف الأول؟","في أي مدينة ولدت؟","ما هو اسم أفضل صديق لك في الطفولة؟","ما هو لقب والدتك؟","ما هو اسم الشارع الذي نشأت فيه؟","ما هو اسم مدرستك الثانوية؟","ما هو طعامك المفضل؟","ما هو اسم أول شركة عملت بها؟","ما هو رقمك المفضل؟"];function xc({open:e,onOpenChange:t,onSave:n,editMode:a=!1}){const[s,r]=ve.useState("predefined"),[i,l]=ve.useState(""),[o,d]=ve.useState(""),[c,u]=ve.useState(""),[h,x]=ve.useState(!1),[g,f]=ve.useState(""),[v,y]=ve.useState(""),[b,j]=ve.useState("");ve.useEffect(()=>{e&&(w(),r("predefined"),l(""),d(""),u(""),f(""),y(""))},[e]);const w=()=>m(this,null,function*(){if(a)try{const e=yield window.electronAPI.settings.get();(null==e?void 0:e.security_question)&&j(e.security_question)}catch(e){console.error("Error loading current security question:",e)}}),N=()=>m(this,null,function*(){const e="predefined"===s?i:o;if(e.trim())if(c.trim())if(c.trim().length<2)f("إجابة سؤال الأمان يجب أن تكون حرفين على الأقل");else{x(!0),f("");try{const s=yield function(e){return m(this,null,function*(){try{const t=(new TextEncoder).encode(e+"dental_clinic_salt_2024"),n=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(g){throw console.error("Error hashing password:",g),g}})}(c.trim().toLowerCase());yield window.electronAPI.settings.update({security_question:e.trim(),security_answer:s}),y(a?"تم تحديث سؤال الأمان بنجاح":"تم حفظ سؤال الأمان بنجاح"),setTimeout(()=>{n(),t(!1)},2e3)}catch(r){console.error("Error saving security question:",r),f("حدث خطأ في حفظ سؤال الأمان")}finally{x(!1)}}else f("يرجى إدخال إجابة سؤال الأمان");else f("يرجى اختيار أو إدخال سؤال الأمان")}),_=()=>{r("predefined"),l(""),d(""),u(""),f(""),y(""),t(!1)};return p.jsx(Ii,{open:e,onOpenChange:_,children:p.jsxs(Yi,{className:"sm:max-w-lg",dir:"rtl",children:[p.jsx(Vi,{children:p.jsxs(Ui,{className:"flex items-center gap-2 text-right",children:[p.jsx(gi,{className:"w-5 h-5 text-primary"}),a?"تحديث سؤال الأمان":"إعداد سؤال الأمان"]})}),p.jsxs("div",{className:"space-y-6",children:[a&&b&&p.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(Br,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),p.jsxs("div",{children:[p.jsx("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-1",children:"سؤال الأمان الحالي"}),p.jsx("p",{className:"text-blue-700 dark:text-blue-300",children:b})]})]})}),p.jsxs(mc,{children:[p.jsx(Ir,{className:"h-4 w-4"}),p.jsx(pc,{children:"سؤال الأمان يُستخدم لاستعادة كلمة المرور في حالة نسيانها. اختر سؤالاً تتذكر إجابته بسهولة ولا يمكن للآخرين تخمينها."})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx(Ro,{children:"نوع السؤال"}),p.jsxs("div",{className:"flex gap-4",children:[p.jsxs("label",{className:"flex items-center space-x-2 space-x-reverse cursor-pointer",children:[p.jsx("input",{type:"radio",name:"questionType",value:"predefined",checked:"predefined"===s,onChange:e=>r(e.target.value),className:"text-primary"}),p.jsx("span",{children:"اختيار من القائمة"})]}),p.jsxs("label",{className:"flex items-center space-x-2 space-x-reverse cursor-pointer",children:[p.jsx("input",{type:"radio",name:"questionType",value:"custom",checked:"custom"===s,onChange:e=>r(e.target.value),className:"text-primary"}),p.jsx("span",{children:"سؤال مخصص"})]})]})]}),"predefined"===s&&p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"predefinedQuestion",children:"اختر سؤال الأمان"}),p.jsxs(el,{value:i,onValueChange:l,children:[p.jsx(al,{className:"text-right",children:p.jsx(nl,{placeholder:"اختر سؤالاً من القائمة"})}),p.jsx(il,{children:hc.map((e,t)=>p.jsx(dl,{value:e,children:e},t))})]})]}),"custom"===s&&p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"customQuestion",children:"سؤال الأمان المخصص"}),p.jsx(Xi,{id:"customQuestion",type:"text",value:o,onChange:e=>d(e.target.value),placeholder:"أدخل سؤال الأمان الخاص بك",className:"text-right"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"answer",children:"إجابة سؤال الأمان"}),p.jsx(Xi,{id:"answer",type:"text",value:c,onChange:e=>u(e.target.value),placeholder:"أدخل إجابة سؤال الأمان",className:"text-right",onKeyDown:e=>"Enter"===e.key&&N()}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"ملاحظة: الإجابة حساسة لحالة الأحرف، تأكد من كتابتها بنفس الطريقة التي ستتذكرها بها"})]}),g&&p.jsxs(mc,{variant:"destructive",children:[p.jsx(ar,{className:"h-4 w-4"}),p.jsx(pc,{children:g})]}),v&&p.jsxs(mc,{className:"border-green-200 bg-green-50 text-green-800 dark:border-green-800 dark:bg-green-900/20 dark:text-green-200",children:[p.jsx(gr,{className:"h-4 w-4"}),p.jsx(pc,{children:v})]}),!v&&p.jsxs("div",{className:"flex gap-3",children:[p.jsx(Qi,{onClick:N,disabled:h||!i&&!o||!c,className:"flex-1",children:h?"جاري الحفظ...":a?"تحديث":"حفظ"}),p.jsx(Qi,{variant:"outline",onClick:_,className:"flex-1",children:"إلغاء"})]})]})]})})}function gc({showNotification:e}){const{passwordEnabled:t,setPassword:n,removePassword:a,changePassword:s}=function(){const[e,t]=ve.useState({isAuthenticated:!1,isLoading:!0,passwordEnabled:!1});qt(),ve.useEffect(()=>{n()},[]);const n=()=>m(this,null,function*(){try{console.log("🔐 Checking auth status...");const e=yield window.electronAPI.settings.get();console.log("🔐 Current settings:",e);const n=1===(null==e?void 0:e.password_enabled),a=(null==e?void 0:e.app_password)&&e.app_password.length>0;if(console.log("🔐 Password enabled:",n),console.log("🔐 Has password:",a),!n||!a)return console.log("🔐 No password protection, allowing access"),void t({isAuthenticated:!0,isLoading:!1,passwordEnabled:!1});const s="true"===sessionStorage.getItem("dental_clinic_auth");console.log("🔐 Has valid session:",s),s?(console.log("🔐 Valid session found, allowing access"),t({isAuthenticated:!0,isLoading:!1,passwordEnabled:!0})):(console.log("🔐 No valid session, requiring authentication"),t({isAuthenticated:!1,isLoading:!1,passwordEnabled:!0}))}catch(e){console.error("❌ Error checking auth status:",e),t({isAuthenticated:!1,isLoading:!1,passwordEnabled:!1})}});return d(o({},e),{login:e=>m(this,null,function*(){try{console.log("🔐 Attempting login...");const n=yield window.electronAPI.settings.get();if(!(null==n?void 0:n.app_password))return console.log("❌ No password set in settings"),!1;const a=yield dc(e);return console.log("🔐 Password hashed, comparing..."),a===n.app_password?(console.log("✅ Password correct, setting session"),sessionStorage.setItem("dental_clinic_auth","true"),t(e=>d(o({},e),{isAuthenticated:!0})),!0):(console.log("❌ Password incorrect"),!1)}catch(n){return console.error("❌ Login error:",n),!1}}),logout:()=>m(this,null,function*(){var e,n;sessionStorage.removeItem("dental_clinic_auth");try{(null==(n=null==(e=window.electronAPI)?void 0:e.auth)?void 0:n.clearSession)&&(yield window.electronAPI.auth.clearSession())}catch(a){console.log("Could not clear session via Electron:",a)}t(e=>d(o({},e),{isAuthenticated:!1}))}),setPassword:e=>m(this,null,function*(){try{console.log("🔐 Setting password...");const n=yield dc(e);console.log("🔐 Updating settings with hashed password...");const a=yield cc(window.electronAPI.settings.update({app_password:n,password_enabled:1}),1e4);return console.log("🔐 Settings updated:",a),a?(t(e=>d(o({},e),{passwordEnabled:!0})),console.log("✅ Password set successfully"),!0):(console.log("❌ Failed to update settings"),!1)}catch(n){return console.error("❌ Error setting password:",n),!1}}),removePassword:()=>m(this,null,function*(){try{console.log("🔐 Removing password...");const e=yield cc(window.electronAPI.settings.update({app_password:null,password_enabled:0}),1e4);return console.log("🔐 Settings updated:",e),e?(t(e=>d(o({},e),{passwordEnabled:!1,isAuthenticated:!0})),console.log("✅ Password removed successfully"),!0):(console.log("❌ Failed to update settings"),!1)}catch(e){return console.error("❌ Error removing password:",e),!1}}),changePassword:(e,t)=>m(this,null,function*(){try{console.log("🔐 Changing password...");const n=yield window.electronAPI.settings.get();if(!(null==n?void 0:n.app_password))return console.log("❌ No existing password found"),!1;if((yield dc(e))!==n.app_password)return console.log("❌ Old password is incorrect"),!1;const a=yield dc(t);console.log("🔐 Updating with new password...");const s=yield cc(window.electronAPI.settings.update({app_password:a}),1e4);return console.log("🔐 Settings updated:",s),s?(console.log("✅ Password changed successfully"),!0):(console.log("❌ Failed to update settings"),!1)}catch(n){return console.error("❌ Error changing password:",n),!1}}),checkAuthStatus:n})}(),[r,i]=ve.useState(!1),[l,c]=ve.useState(!1),[u,h]=ve.useState(!1),[x,g]=ve.useState(!1),[f,v]=ve.useState(!1),[y,b]=ve.useState(""),[j,w]=ve.useState(!1),[N,_]=ve.useState(""),[k,S]=ve.useState(""),[D,$]=ve.useState(""),[C,E]=ve.useState(""),[T,A]=ve.useState({new:!1,confirm:!1,old:!1,remove:!1}),[F,P]=ve.useState(!1);ve.useEffect(()=>{O()},[]);const O=()=>m(this,null,function*(){try{const e=yield window.electronAPI.settings.get();(null==e?void 0:e.security_question)?(b(e.security_question),w(!0)):w(!1)}catch(e){console.error("Error loading security question:",e)}}),R=e=>{A(t=>d(o({},t),{[e]:!t[e]}))};return p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[p.jsxs("div",{className:"p-6 border-b border-border",children:[p.jsx("h3",{className:"text-lg font-medium text-foreground",children:"حماية التطبيق بكلمة مرور"}),p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"تأمين التطبيق بكلمة مرور لمنع الوصول غير المصرح به"})]}),p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[p.jsx("div",{className:"p-2 rounded-lg "+(t?"bg-green-100 dark:bg-green-900/20":"bg-gray-100 dark:bg-gray-900/20"),children:t?p.jsx(Gr,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):p.jsx(Si,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-foreground",children:t?"كلمة المرور مفعلة":"كلمة المرور معطلة"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:t?"التطبيق محمي بكلمة مرور":"التطبيق غير محمي بكلمة مرور"})]})]}),p.jsx("div",{className:"px-3 py-1 rounded-full text-xs font-medium "+(t?"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200":"bg-gray-100 dark:bg-gray-900/20 text-gray-800 dark:text-gray-200"),children:t?"مفعل":"معطل"})]}),p.jsx("div",{className:"flex flex-wrap gap-3",children:t?p.jsxs(p.Fragment,{children:[p.jsxs("button",{onClick:()=>c(!0),className:"flex items-center space-x-2 space-x-reverse px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[p.jsx(Yr,{className:"w-4 h-4"}),p.jsx("span",{children:"تغيير كلمة المرور"})]}),p.jsxs("button",{onClick:()=>g(!0),className:"flex items-center space-x-2 space-x-reverse px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[p.jsx(Si,{className:"w-4 h-4"}),p.jsx("span",{children:"إزالة كلمة المرور"})]})]}):p.jsxs("button",{onClick:()=>i(!0),className:"flex items-center space-x-2 space-x-reverse px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors",children:[p.jsx(Yr,{className:"w-4 h-4"}),p.jsx("span",{children:"تعيين كلمة مرور"})]})}),p.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:p.jsxs("div",{className:"flex items-start space-x-3 space-x-reverse",children:[p.jsx(Br,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-2",children:"معلومات مهمة حول الأمان"}),p.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[p.jsx("li",{children:"• عند تفعيل كلمة المرور، ستحتاج لإدخالها في كل مرة تفتح فيها التطبيق"}),p.jsx("li",{children:"• يُنصح باستخدام كلمة مرور قوية تحتوي على أرقام وحروف"}),p.jsx("li",{children:"• احتفظ بكلمة المرور في مكان آمن"}),p.jsx("li",{children:"• في حالة نسيان كلمة المرور، يمكنك استخدام سؤال الأمان لاستعادتها"})]})]})]})})]})]}),p.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[p.jsxs("div",{className:"p-6 border-b border-border",children:[p.jsx("h3",{className:"text-lg font-medium text-foreground",children:"سؤال الأمان"}),p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"إعداد سؤال أمان لاستعادة كلمة المرور في حالة نسيانها"})]}),p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[p.jsx("div",{className:"p-2 rounded-lg "+(j?"bg-green-100 dark:bg-green-900/20":"bg-gray-100 dark:bg-gray-900/20"),children:j?p.jsx(Ir,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):p.jsx(Ir,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),p.jsxs("div",{children:[p.jsx("h4",{className:"font-medium text-foreground",children:j?"تم إعداد سؤال الأمان":"لم يتم إعداد سؤال أمان"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:j?"يمكنك استخدام سؤال الأمان لاستعادة كلمة المرور":"قم بإعداد سؤال أمان لاستعادة كلمة المرور"})]})]}),p.jsx("div",{className:"flex space-x-2 space-x-reverse",children:p.jsx("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors duration-200 flex items-center space-x-2 space-x-reverse",children:j?p.jsxs(p.Fragment,{children:[p.jsx(si,{className:"w-4 h-4"}),p.jsx("span",{children:"تحديث"})]}):p.jsxs(p.Fragment,{children:[p.jsx(Ir,{className:"w-4 h-4"}),p.jsx("span",{children:"إعداد"})]})})})]}),j&&y&&p.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:p.jsxs("div",{className:"flex items-start space-x-3 space-x-reverse",children:[p.jsx(Ir,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:"سؤال الأمان الحالي"}),p.jsx("p",{className:"text-blue-700 dark:text-blue-300",children:y})]})]})}),p.jsx("div",{className:"mt-6 p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:p.jsxs("div",{className:"flex items-start space-x-3 space-x-reverse",children:[p.jsx(Br,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-medium text-amber-800 dark:text-amber-200 mb-2",children:"نصائح مهمة لسؤال الأمان"}),p.jsxs("ul",{className:"text-sm text-amber-700 dark:text-amber-300 space-y-1",children:[p.jsx("li",{children:"• اختر سؤالاً تتذكر إجابته بسهولة"}),p.jsx("li",{children:"• تأكد من أن الإجابة لا يمكن للآخرين تخمينها"}),p.jsx("li",{children:"• تجنب الأسئلة التي قد تتغير إجابتها مع الوقت"}),p.jsx("li",{children:"• احتفظ بإجابة السؤال في مكان آمن"})]})]})]})})]})]}),r&&p.jsxs(vc,{title:"تعيين كلمة مرور جديدة",onSubmit:t=>m(this,null,function*(){if(t.preventDefault(),N.trim())if(N.length<4)e("كلمة المرور يجب أن تكون 4 أحرف على الأقل","error");else if(N===k){P(!0);try{console.log("🔐 SecuritySettings: Setting password...");const t=yield n(N);console.log("🔐 SecuritySettings: Password set result:",t),t?(e("تم تعيين كلمة المرور بنجاح","success"),i(!1),_(""),S(""),A({new:!1,confirm:!1,old:!1})):e("فشل في تعيين كلمة المرور","error")}catch(a){console.error("❌ SecuritySettings: Error setting password:",a),e("حدث خطأ أثناء تعيين كلمة المرور","error")}finally{P(!1)}}else e("كلمة المرور وتأكيدها غير متطابقين","error");else e("يرجى إدخال كلمة مرور","error")}),onCancel:()=>{i(!1),_(""),S("")},isLoading:F,children:[p.jsx(fc,{label:"كلمة المرور الجديدة",value:N,onChange:_,show:T.new,onToggleShow:()=>R("new"),placeholder:"أدخل كلمة مرور جديدة"}),p.jsx(fc,{label:"تأكيد كلمة المرور",value:k,onChange:S,show:T.confirm,onToggleShow:()=>R("confirm"),placeholder:"أعد إدخال كلمة المرور"})]}),l&&p.jsxs(vc,{title:"تغيير كلمة المرور",onSubmit:t=>m(this,null,function*(){if(t.preventDefault(),D.trim()&&N.trim())if(N.length<4)e("كلمة المرور الجديدة يجب أن تكون 4 أحرف على الأقل","error");else if(N===k){P(!0);try{console.log("🔐 SecuritySettings: Changing password...");const t=yield s(D,N);console.log("🔐 SecuritySettings: Password change result:",t),t?(e("تم تغيير كلمة المرور بنجاح","success"),c(!1),$(""),_(""),S(""),A({new:!1,confirm:!1,old:!1})):e("كلمة المرور القديمة غير صحيحة","error")}catch(n){console.error("❌ SecuritySettings: Error changing password:",n),e("حدث خطأ أثناء تغيير كلمة المرور","error")}finally{P(!1)}}else e("كلمة المرور الجديدة وتأكيدها غير متطابقين","error");else e("يرجى ملء جميع الحقول","error")}),onCancel:()=>{c(!1),$(""),_(""),S("")},isLoading:F,children:[p.jsx(fc,{label:"كلمة المرور الحالية",value:D,onChange:$,show:T.old,onToggleShow:()=>R("old"),placeholder:"أدخل كلمة المرور الحالية"}),p.jsx(fc,{label:"كلمة المرور الجديدة",value:N,onChange:_,show:T.new,onToggleShow:()=>R("new"),placeholder:"أدخل كلمة مرور جديدة"}),p.jsx(fc,{label:"تأكيد كلمة المرور الجديدة",value:k,onChange:S,show:T.confirm,onToggleShow:()=>R("confirm"),placeholder:"أعد إدخال كلمة المرور الجديدة"})]}),x&&p.jsxs(vc,{title:"إزالة كلمة المرور",onSubmit:t=>m(this,null,function*(){if(t.preventDefault(),C.trim()){P(!0);try{console.log("🔐 SecuritySettings: Verifying password for removal...");const t=yield window.electronAPI.settings.get();if(!(null==t?void 0:t.app_password))return e("لا توجد كلمة مرور مُعيّنة","error"),void P(!1);if((yield function(e){return m(this,null,function*(){try{const t=(new TextEncoder).encode(e+"dental_clinic_salt_2024"),n=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(t){throw console.error("Error hashing password:",t),t}})}(C))!==t.app_password)return e("كلمة المرور غير صحيحة","error"),void P(!1);console.log("🔐 SecuritySettings: Password verified, removing...");const n=yield a();console.log("🔐 SecuritySettings: Password removal result:",n),n?(e("تم إزالة كلمة المرور بنجاح","success"),g(!1),E(""),A(e=>d(o({},e),{remove:!1}))):e("فشل في إزالة كلمة المرور","error")}catch(n){console.error("❌ SecuritySettings: Error removing password:",n),e("حدث خطأ أثناء إزالة كلمة المرور","error")}finally{P(!1)}}else e("يرجى إدخال كلمة المرور الحالية","error")}),onCancel:()=>{g(!1),E(""),A(e=>d(o({},e),{remove:!1}))},isLoading:F,children:[p.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:p.jsxs("div",{className:"flex items-start space-x-3 space-x-reverse",children:[p.jsx(sr,{className:"w-5 h-5 text-red-600 dark:text-red-400 mt-0.5 flex-shrink-0"}),p.jsx("div",{children:p.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:"تحذير: إزالة كلمة المرور ستجعل التطبيق غير محمي. يرجى إدخال كلمة المرور الحالية للتأكيد."})})]})}),p.jsx(fc,{label:"كلمة المرور الحالية",value:C,onChange:E,show:T.remove,onToggleShow:()=>R("remove"),placeholder:"أدخل كلمة المرور الحالية"})]}),u&&p.jsx(yc,{title:"إزالة كلمة المرور",message:"هل أنت متأكد من إزالة كلمة المرور؟ سيصبح التطبيق غير محمي.",onConfirm:()=>m(this,null,function*(){P(!0);try{console.log("🔐 SecuritySettings: Removing password...");const t=yield a();console.log("🔐 SecuritySettings: Password removal result:",t),t?(e("تم إزالة كلمة المرور بنجاح","success"),h(!1)):e("فشل في إزالة كلمة المرور","error")}catch(t){console.error("❌ SecuritySettings: Error removing password:",t),e("حدث خطأ أثناء إزالة كلمة المرور","error")}finally{P(!1)}}),onCancel:()=>h(!1),isLoading:F,confirmText:"إزالة",confirmClass:"bg-red-600 hover:bg-red-700"}),p.jsx(xc,{open:f,onOpenChange:v,onSave:()=>{O(),e("تم حفظ سؤال الأمان بنجاح","success")},editMode:j})]})}function fc({label:e,value:t,onChange:n,show:a,onToggleShow:s,placeholder:r}){return p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"block text-sm font-medium text-foreground",children:e}),p.jsxs("div",{className:"relative",children:[p.jsx("input",{type:a?"text":"password",value:t,onChange:e=>n(e.target.value),className:"w-full pr-3 pl-10 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:r}),p.jsx("button",{type:"button",onClick:s,className:"absolute inset-y-0 left-0 pl-3 flex items-center text-muted-foreground hover:text-foreground",children:a?p.jsx(Ar,{className:"w-4 h-4"}):p.jsx(Fr,{className:"w-4 h-4"})})]})]})}function vc({title:e,children:t,onSubmit:n,onCancel:a,isLoading:s}){return p.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[p.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:a}),p.jsx("div",{className:"relative bg-card border border-border rounded-lg shadow-2xl max-w-md w-full mx-4",children:p.jsxs("div",{className:"p-6",children:[p.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:e}),p.jsxs("form",{onSubmit:n,className:"space-y-4",children:[t,p.jsxs("div",{className:"flex justify-end space-x-3 space-x-reverse pt-4",children:[p.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 border border-input bg-background text-foreground rounded-lg hover:bg-accent",children:"إلغاء"}),p.jsx("button",{type:"submit",disabled:s,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50",children:s?"جاري الحفظ...":"حفظ"})]})]})]})})]})}function yc({title:e,message:t,onConfirm:n,onCancel:a,isLoading:s,confirmText:r,confirmClass:i}){return p.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[p.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:a}),p.jsx("div",{className:"relative bg-card border border-border rounded-lg shadow-2xl max-w-md w-full mx-4",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center mb-4",children:[p.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center ml-3",children:p.jsx(sr,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-lg font-semibold text-foreground",children:e}),p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t})]})]}),p.jsxs("div",{className:"flex justify-end space-x-3 space-x-reverse",children:[p.jsx("button",{onClick:a,className:"px-4 py-2 border border-input bg-background text-foreground rounded-lg hover:bg-accent",children:"إلغاء"}),p.jsx("button",{onClick:n,disabled:s,className:`px-4 py-2 text-white rounded-lg transition-colors disabled:opacity-50 ${i}`,children:s?"جاري التنفيذ...":r})]})]})})]})}const bc=[{key:"0",arabicKey:"٠",description:"لوحة التحكم",icon:p.jsx(xi,{className:"w-3 h-3"}),category:"تنقل"},{key:"1",arabicKey:"١",description:"المرضى",icon:p.jsx(Fi,{className:"w-3 h-3"}),category:"تنقل"},{key:"2",arabicKey:"٢",description:"المواعيد",icon:p.jsx(hr,{className:"w-3 h-3"}),category:"تنقل"},{key:"3",arabicKey:"٣",description:"الدفعات",icon:p.jsx(Er,{className:"w-3 h-3"}),category:"تنقل"},{key:"4",arabicKey:"٤",description:"المخزون",icon:p.jsx(xi,{className:"w-3 h-3"}),category:"تنقل"},{key:"5",arabicKey:"٥",description:"المختبرات",icon:p.jsx(xi,{className:"w-3 h-3"}),category:"تنقل"},{key:"6",arabicKey:"٦",description:"الأدوية",icon:p.jsx(xi,{className:"w-3 h-3"}),category:"تنقل"},{key:"7",arabicKey:"٧",description:"العلاجات",icon:p.jsx(xi,{className:"w-3 h-3"}),category:"تنقل"},{key:"8",arabicKey:"٨",description:"احتياجات العيادة",icon:p.jsx(xi,{className:"w-3 h-3"}),category:"تنقل"},{key:"9",arabicKey:"٩",description:"التقارير",icon:p.jsx(xi,{className:"w-3 h-3"}),category:"تنقل"},{key:"A",arabicKey:"ش",description:"إضافة مريض جديد",icon:p.jsx(Fi,{className:"w-3 h-3"}),category:"إجراءات"},{key:"S",arabicKey:"س",description:"إضافة موعد جديد",icon:p.jsx(hr,{className:"w-3 h-3"}),category:"إجراءات"},{key:"D",arabicKey:"ي",description:"إضافة دفعة جديدة",icon:p.jsx(Er,{className:"w-3 h-3"}),category:"إجراءات"},{key:"F1",arabicKey:"F1",description:"فتح الإعدادات",icon:p.jsx(xi,{className:"w-3 h-3"}),category:"عمليات"},{key:"R",arabicKey:"ق",description:"تحديث الصفحة",icon:p.jsx(mi,{className:"w-3 h-3"}),category:"عمليات"},{key:"F",arabicKey:"ب",description:"فتح البحث",icon:p.jsx(hi,{className:"w-3 h-3"}),category:"عمليات"},{key:"ESC",arabicKey:"ESC",description:"إغلاق النوافذ",icon:p.jsx(Mi,{className:"w-3 h-3"}),category:"عمليات"}];function jc({className:e,compact:t=!1}){const{isDarkMode:n}=Gt(),[a,s]=ve.useState(!1),[r,i]=ve.useState(null),l=Array.from(new Set(bc.map(e=>e.category))),o=r?bc.filter(e=>e.category===r):bc;return t?p.jsx("div",{className:aa("fixed bottom-4 right-4 z-50",e),children:p.jsx(Lo,{className:aa("shadow-xl border backdrop-blur-sm",n?"border-border/30 bg-gradient-to-br from-background/90 to-muted/90 shadow-2xl shadow-black/30":"border-border/50 bg-gradient-to-br from-background/95 to-muted/95 shadow-lg"),children:p.jsxs(Yo,{className:"p-3",children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:aa("p-1.5 rounded-md",n?"bg-primary/20":"bg-primary/10"),children:p.jsx(Vr,{className:"w-4 h-4 text-primary"})}),p.jsx("span",{className:"text-sm font-semibold text-foreground",children:"اختصارات سريعة"})]}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>s(!a),className:aa("h-7 w-7 p-0 rounded-md transition-all duration-200",n?"text-muted-foreground hover:text-foreground hover:bg-muted/30":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:a?p.jsx(jr,{className:"w-3.5 h-3.5"}):p.jsx(vr,{className:"w-3.5 h-3.5"})})]}),a&&p.jsxs("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:[p.jsxs("div",{className:"flex gap-1.5 flex-wrap",children:[p.jsx(Qi,{variant:null===r?"default":"outline",size:"sm",onClick:()=>i(null),className:"h-7 text-xs px-3 rounded-full transition-all duration-200 hover:scale-105",children:"الكل"}),l.map(e=>p.jsx(Qi,{variant:r===e?"default":"outline",size:"sm",onClick:()=>i(e),className:"h-7 text-xs px-3 rounded-full transition-all duration-200 hover:scale-105",children:e},e))]}),p.jsx("div",{className:"space-y-1.5",children:o.map((e,t)=>p.jsxs("div",{className:"flex items-center justify-between p-2.5 rounded-lg bg-card/50 border border-border/30 hover:bg-card/80 hover:border-border/60 transition-all duration-200 hover:shadow-sm",children:[p.jsxs("div",{className:"flex items-center gap-2.5",children:[p.jsx("div",{className:"p-1 rounded-md bg-muted/50",children:e.icon}),p.jsx("span",{className:"text-xs text-foreground font-medium",children:e.description})]}),p.jsxs("div",{className:"flex items-center gap-1.5",children:[p.jsx(qo,{variant:"secondary",className:"text-xs px-2 py-0.5 bg-primary/10 text-primary border-primary/20 font-mono font-semibold",children:e.key}),e.arabicKey!==e.key&&p.jsx(qo,{variant:"outline",className:"text-xs px-2 py-0.5 border-emerald-200 text-emerald-700 dark:border-emerald-800 dark:text-emerald-300 font-mono font-semibold",children:e.arabicKey})]})]},t))})]})]})})}):p.jsx(Lo,{className:aa("shadow-lg border border-border/50 bg-gradient-to-br from-background to-muted/30",e),children:p.jsxs(Yo,{className:"p-6",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[p.jsx("div",{className:"p-2 rounded-lg bg-primary/10 dark:bg-primary/20",children:p.jsx(Vr,{className:"w-5 h-5 text-primary"})}),p.jsx("h3",{className:"font-semibold text-lg text-foreground",children:"اختصارات لوحة المفاتيح"})]}),p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(e=>p.jsxs("div",{className:"space-y-3",children:[p.jsxs("h4",{className:"font-semibold text-sm text-primary border-b border-primary/20 pb-2 flex items-center gap-2",children:[p.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"}),e]}),p.jsx("div",{className:"space-y-2",children:bc.filter(t=>t.category===e).map((e,t)=>p.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-card border border-border/30 hover:bg-card/80 hover:border-border/60 hover:shadow-sm transition-all duration-200",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"p-1.5 rounded-md bg-muted/50",children:e.icon}),p.jsx("span",{className:"text-sm text-foreground font-medium",children:e.description})]}),p.jsxs("div",{className:"flex items-center gap-1.5",children:[p.jsx(qo,{variant:"secondary",className:"text-xs px-2 py-1 bg-primary/10 text-primary border-primary/20 font-mono font-semibold",children:e.key}),e.arabicKey!==e.key&&p.jsx(qo,{variant:"outline",className:"text-xs px-2 py-1 border-emerald-200 text-emerald-700 dark:border-emerald-800 dark:text-emerald-300 font-mono font-semibold",children:e.arabicKey})]})]},t))})]},e))})]})})}function wc(){const[e,t]=ve.useState(null),[n,a]=ve.useState(!1),s=()=>m(this,null,function*(){var e,n;a(!0);try{if(!(null==(n=null==(e=window.electronAPI)?void 0:e.database)?void 0:n.getStatus))throw new Error("Database API not available");const a=yield window.electronAPI.database.getStatus();t(a),console.log("Database status:",a)}catch(s){console.error("Database status check failed:",s),t({connected:!1,error:s instanceof Error?s.message:"Unknown error"})}finally{a(!1)}});ve.useEffect(()=>{s()},[]);return p.jsxs(Lo,{className:"w-full max-w-2xl mx-auto",children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(Cr,{className:"h-5 w-5"}),"تشخيص قاعدة البيانات"]})}),p.jsxs(Yo,{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{children:"حالة الاتصال:"}),p.jsxs("div",{className:"flex items-center gap-2",children:[e?e.connected?p.jsx(gr,{className:"h-4 w-4 text-green-600 dark:text-green-400"}):p.jsx(ar,{className:"h-4 w-4 text-red-600 dark:text-red-400"}):p.jsx(Cr,{className:"h-4 w-4"}),p.jsx(qo,{variant:(null==e?void 0:e.connected)?"default":"destructive",children:(null==e?void 0:e.connected)?"متصل":"غير متصل"})]})]}),(null==e?void 0:e.dbPath)&&p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{children:"مسار قاعدة البيانات:"}),p.jsx("code",{className:"text-sm bg-gray-500 dark:bg-gray-700 dark:text-gray-100 px-2 py-1 rounded border dark:border-gray-600",children:e.dbPath})]}),void 0!==(null==e?void 0:e.tablesCount)&&p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{children:"عدد الجداول:"}),p.jsx(qo,{variant:"outline",children:e.tablesCount})]}),void 0!==(null==e?void 0:e.isOpen)&&p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{children:"حالة قاعدة البيانات:"}),p.jsx(qo,{variant:e.isOpen?"default":"secondary",children:e.isOpen?"مفتوحة":"مغلقة"})]}),(null==e?void 0:e.fileSize)&&p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{children:"حجم الملف:"}),p.jsx(qo,{variant:"outline",children:e.fileSize})]}),(null==e?void 0:e.lastModified)&&p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{children:"آخر تعديل:"}),p.jsx("code",{className:"text-xs bg-gray-500 dark:bg-gray-700 dark:text-gray-100 px-2 py-1 rounded border dark:border-gray-600",children:new Date(e.lastModified).toLocaleString("ar-EG")})]}),(null==e?void 0:e.tableNames)&&e.tableNames.length>0&&p.jsxs("div",{className:"space-y-2",children:[p.jsx("span",{className:"font-medium",children:"الجداول الموجودة:"}),p.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.tableNames.map((e,t)=>p.jsx(qo,{variant:"secondary",className:"text-xs",children:e},t)),e.hasMoreTables&&p.jsx(qo,{variant:"outline",className:"text-xs",children:"+المزيد..."})]})]}),(null==e?void 0:e.error)&&p.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:[p.jsxs("div",{className:"flex items-center gap-2 text-red-800 dark:text-red-400",children:[p.jsx(ar,{className:"h-4 w-4"}),p.jsx("span",{className:"font-medium",children:"خطأ:"})]}),p.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1 text-sm",children:e.error})]}),p.jsx(Qi,{onClick:s,disabled:n,className:"w-full",children:n?p.jsxs(p.Fragment,{children:[p.jsx(mi,{className:"h-4 w-4 mr-2 animate-spin"}),"جاري الفحص..."]}):p.jsxs(p.Fragment,{children:[p.jsx(mi,{className:"h-4 w-4 mr-2"}),"إعادة فحص"]})})]})]})}function Nc(){const[e,t]=ve.useState("backup"),[n,a]=ve.useState(null),[s,r]=ve.useState({message:"",type:"success",show:!1}),{backups:i,isLoading:l,error:c,isCreatingBackup:u,isRestoringBackup:h,autoBackupEnabled:x,backupFrequency:g,loadBackups:f,createBackup:v,restoreBackup:y,deleteBackup:b,setAutoBackupEnabled:j,setBackupFrequency:w,selectBackupFile:N,clearError:_,formatBackupSize:k,formatBackupDate:S,getBackupStatus:D}=oc(),{settings:$,updateSettings:C,loadSettings:E}=qt(),{isDarkMode:T,toggleDarkMode:A}=Gt(),{currentCurrency:F,setCurrency:P}=Sa(),O=Gd(),{refreshAllImages:R}=Ko(),[M,L]=ve.useState("");ve.useEffect(()=>{f(),E()},[f,E]),ve.useEffect(()=>{L(O)},[O]),ve.useEffect(()=>{c&&(I(c,"error"),_())},[c,_]),ve.useEffect(()=>{n?console.log("🔍 Delete confirmation dialog opened for:",n):console.log("🔍 Delete confirmation dialog closed")},[n]),ve.useEffect(()=>{const e=e=>{n&&"Escape"===e.key&&a(null)};return n?(document.addEventListener("keydown",e),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[n]);const I=(e,t="success")=>{r({message:e,type:t,show:!0}),setTimeout(()=>{r(e=>d(o({},e),{show:!1}))},3e3)},z=(e=!1)=>m(this,null,function*(){try{yield v(null,e);I(e?"تم إنشاء النسخة الاحتياطية مع الصور بنجاح":"تم إنشاء النسخة الاحتياطية بنجاح","success")}catch(t){I("فشل في إنشاء النسخة الاحتياطية","error")}}),B=e=>m(this,null,function*(){try{if(window.confirm("هل أنت متأكد من استعادة هذه النسخة الاحتياطية؟ سيتم استبدال جميع البيانات الحالية.")){yield y(e);try{yield R()}catch(t){console.warn("Could not refresh images after restore:",t)}I("تم استعادة النسخة الاحتياطية بنجاح","success"),window.location.reload()}}catch(t){I("فشل في استعادة النسخة الاحتياطية","error")}}),Y=e=>m(this,null,function*(){try{console.log("🗑️ Attempting to delete backup:",e),yield b(e),I("تم حذف النسخة الاحتياطية بنجاح","success"),a(null),console.log("✅ Backup deleted successfully:",e)}catch(t){console.error("❌ Failed to delete backup:",t),I(`فشل في حذف النسخة الاحتياطية: ${t instanceof Error?t.message:"خطأ غير معروف"}`,"error"),a(null)}}),V=e=>m(this,null,function*(){try{void 0!==e.clinic_logo&&L(e.clinic_logo),yield C(e),yield E(),I("تم حفظ إعدادات العيادة بنجاح","success")}catch(t){console.error("Error updating settings:",t),I("فشل في حفظ إعدادات العيادة","error")}}),q=D();return p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-heading-1 text-foreground arabic-enhanced",children:"الإعدادات"}),p.jsx("p",{className:"text-body text-muted-foreground mt-2 arabic-enhanced",children:"إدارة إعدادات العيادة والنسخ الاحتياطية"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs("button",{onClick:()=>f(),disabled:l,className:"flex items-center space-x-2 space-x-reverse px-4 py-2 border border-input bg-background text-foreground rounded-lg hover:bg-accent disabled:opacity-50",children:[p.jsx(mi,{className:"w-4 h-4 "+(l?"animate-spin":"")}),p.jsx("span",{children:"تحديث"})]}),p.jsxs("button",{onClick:()=>m(this,null,function*(){const e={"الوضع المظلم":T?"مفعل":"معطل","النسخ التلقائية":x?"مفعلة":"معطلة","تكرار النسخ":"daily"===g?"يومياً":"weekly"===g?"أسبوعياً":"شهرياً","إجمالي النسخ الاحتياطية":q.totalBackups,"آخر نسخة احتياطية":q.lastBackup||"لا توجد","تاريخ التصدير":ma(new Date)},t="\ufeff"+["الإعداد,القيمة",...Object.entries(e).map(([e,t])=>`"${e}","${t}"`)].join("\n");yield ic.convertCSVToExcel(t,"settings",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"})}),className:"flex items-center space-x-2 space-x-reverse px-4 py-2 border border-input bg-background text-foreground rounded-lg hover:bg-accent",children:[p.jsx(Tr,{className:"w-4 h-4"}),p.jsx("span",{children:"تصدير الإعدادات"})]})]})]}),p.jsx("div",{className:"border-b border-border",children:p.jsx("nav",{className:"-mb-px flex space-x-8 space-x-reverse",children:[{id:"backup",name:"النسخ الاحتياطية",icon:Cr},{id:"diagnostics",name:"تشخيص النظام",icon:sr},{id:"appearance",name:"المظهر",icon:ni},{id:"shortcuts",name:"اختصارات لوحة المفاتيح",icon:Vr},{id:"security",name:"الأمان",icon:Yr},{id:"clinic",name:"إعدادات العيادة",icon:xi},{id:"development",name:"فريق التطوير",icon:Fi}].map(n=>p.jsxs("button",{onClick:()=>t(n.id),className:"flex items-center space-x-2 space-x-reverse py-2 px-1 border-b-2 font-medium text-sm "+(e===n.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground hover:border-border"),children:[p.jsx(n.icon,{className:"w-4 h-4"}),p.jsx("span",{children:n.name})]},n.id))})}),"backup"===e&&p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[p.jsx("div",{className:"bg-card rounded-lg shadow border border-border p-6",children:p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:p.jsx(Mr,{className:"w-6 h-6 text-primary"})}),p.jsxs("div",{className:"mr-4",children:[p.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"إجمالي النسخ"}),p.jsx("p",{className:"text-2xl font-bold text-foreground",children:q.totalBackups})]})]})}),p.jsx("div",{className:"bg-card rounded-lg shadow border border-border p-6",children:p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/20 rounded-lg",children:p.jsx(Sr,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),p.jsxs("div",{className:"mr-4",children:[p.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"آخر نسخة احتياطية"}),p.jsx("p",{className:"text-sm font-bold text-foreground",children:q.lastBackup||"لا توجد نسخ"})]})]})}),p.jsx("div",{className:"bg-card rounded-lg shadow border border-border p-6",children:p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/20 rounded-lg",children:p.jsx(hr,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),p.jsxs("div",{className:"mr-4",children:[p.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"النسخة التالية"}),p.jsx("p",{className:"text-sm font-bold text-foreground",children:q.nextScheduledBackup||"غير محدد"})]})]})})]}),p.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[p.jsxs("div",{className:"p-6 border-b border-border",children:[p.jsx("h3",{className:"text-lg font-medium text-foreground",children:"النسخ الاحتياطية اليدوية"}),p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"إنشاء واستعادة النسخ الاحتياطية يدوياً (تنسيق SQLite)"})]}),p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[p.jsxs("button",{onClick:()=>z(!1),disabled:u,className:"flex items-center justify-center space-x-2 space-x-reverse px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed",children:[p.jsx(Tr,{className:"w-5 h-5"}),p.jsx("span",{children:u?"جاري الإنشاء...":"إنشاء نسخة احتياطية"})]}),p.jsxs("button",{onClick:()=>z(!0),disabled:u,className:"flex items-center justify-center space-x-2 space-x-reverse px-6 py-3 bg-blue-600 dark:bg-blue-700 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[p.jsx(zr,{className:"w-5 h-5"}),p.jsx("span",{children:u?"جاري الإنشاء...":"إنشاء نسخة احتياطية مع صور"})]}),p.jsxs("button",{onClick:()=>m(this,null,function*(){try{const t=yield N();if(!t)return;if(window.confirm("هل أنت متأكد من استعادة هذه النسخة الاحتياطية؟ سيتم استبدال جميع البيانات الحالية.")){yield y(t);try{yield R()}catch(e){console.warn("Could not refresh images after restore:",e)}I("تم استعادة النسخة الاحتياطية بنجاح","success"),window.location.reload()}}catch(e){I("فشل في استعادة النسخة الاحتياطية","error")}}),disabled:h,className:"flex items-center justify-center space-x-2 space-x-reverse px-6 py-3 bg-green-600 dark:bg-green-700 text-white rounded-lg hover:bg-green-700 dark:hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[p.jsx(Di,{className:"w-5 h-5"}),p.jsx("span",{children:h?"جاري الاستعادة...":"استعادة نسخة احتياطية"})]})]}),p.jsx("div",{className:"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:p.jsxs("div",{className:"flex",children:[p.jsx(sr,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 ml-2"}),p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"تنبيه مهم"}),p.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"استعادة النسخة الاحتياطية ستستبدل جميع البيانات الحالية. تأكد من إنشاء نسخة احتياطية حديثة قبل الاستعادة."}),p.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-2",children:p.jsx("strong",{children:"أنواع النسخ الاحتياطية:"})}),p.jsxs("ul",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1 mr-4",children:[p.jsxs("li",{children:["• ",p.jsx("strong",{children:"نسخة عادية (.db):"})," قاعدة البيانات فقط - سريعة وحجم صغير"]}),p.jsxs("li",{children:["• ",p.jsx("strong",{children:"نسخة مع صور (.zip):"})," قاعدة البيانات + جميع الصور - حماية شاملة"]})]})]})]})})]})]}),!1,p.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[p.jsxs("div",{className:"p-6 border-b border-border",children:[p.jsx("h3",{className:"text-lg font-medium text-foreground",children:"النسخ الاحتياطية المحفوظة"}),p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"قائمة بجميع النسخ الاحتياطية المتاحة - اضغط على أي نسخة لاستعادتها"})]}),p.jsx("div",{className:"p-6",children:l?p.jsxs("div",{className:"text-center py-8",children:[p.jsx(mi,{className:"w-8 h-8 animate-spin mx-auto text-muted-foreground"}),p.jsx("p",{className:"mt-2 text-muted-foreground",children:"جاري التحميل..."})]}):0===i.length?p.jsxs("div",{className:"text-center py-8",children:[p.jsx(Cr,{className:"w-12 h-12 mx-auto text-muted-foreground"}),p.jsx("h3",{className:"mt-2 text-sm font-medium text-foreground",children:"لا توجد نسخ احتياطية"}),p.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"ابدأ بإنشاء أول نسخة احتياطية"})]}):p.jsx("div",{className:"space-y-3",children:i.map((e,t)=>p.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg hover:bg-accent cursor-pointer",onClick:()=>B(e.path),children:[p.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[p.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:p.jsx(gi,{className:"w-5 h-5 text-primary"})}),p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("h4",{className:"text-sm font-medium text-foreground",children:e.name}),e.isSqliteOnly&&p.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded-full",children:"SQLite"}),e.includesImages&&p.jsxs("span",{className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200 rounded-full flex items-center gap-1",children:[p.jsx(zr,{className:"w-3 h-3"}),"مع صور"]}),e.isLegacy&&p.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-900/20 text-gray-800 dark:text-gray-200 rounded-full",children:"قديم"})]}),p.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse text-sm text-muted-foreground",children:[p.jsx("span",{children:S(e.created_at)}),p.jsx("span",{children:k(e.size)}),e.version&&p.jsxs("span",{children:["إصدار ",e.version]})]})]})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("button",{onClick:t=>{t.stopPropagation(),B(e.path)},className:"p-2 text-green-600 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/20 rounded-lg",title:"استعادة",children:p.jsx(Di,{className:"w-4 h-4"})}),p.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),console.log("🗑️ Delete button clicked for backup:",e.name),a(e.name)},className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"حذف",type:"button",children:p.jsx(Ni,{className:"w-4 h-4"})})]})]},`${e.name}-${t}`))})})]})]}),"diagnostics"===e&&p.jsx("div",{className:"space-y-6",children:p.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[p.jsxs("div",{className:"p-6 border-b border-border",children:[p.jsx("h3",{className:"text-lg font-medium text-foreground",children:"تشخيص النظام"}),p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"فحص حالة قاعدة البيانات والنظام"})]}),p.jsx("div",{className:"p-6",children:p.jsx(wc,{})})]})}),"appearance"===e&&p.jsx("div",{className:"space-y-6",children:p.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[p.jsxs("div",{className:"p-6 border-b border-border",children:[p.jsx("h3",{className:"text-lg font-medium text-foreground",children:"إعدادات المظهر"}),p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"تخصيص مظهر التطبيق وفقاً لتفضيلاتك"})]}),p.jsxs("div",{className:"p-6 space-y-6",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[p.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:T?p.jsx(Jr,{className:"w-5 h-5 text-primary"}):p.jsx(bi,{className:"w-5 h-5 text-primary"})}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium text-foreground",children:"الوضع المظلم"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"تبديل بين الوضع الفاتح والمظلم للتطبيق"})]})]}),p.jsx("button",{onClick:A,className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(T?"bg-primary":"bg-muted"),children:p.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-background transition-transform "+(T?"translate-x-6":"translate-x-1")})})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsx("h4",{className:"text-sm font-medium text-foreground",children:"معاينة المظهر"}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsx("div",{className:"p-4 border border-border rounded-lg bg-background",children:p.jsxs("div",{className:"space-y-3",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h5",{className:"text-sm font-medium text-foreground",children:T?"الوضع المظلم":"الوضع الفاتح"}),p.jsx("div",{className:"w-3 h-3 rounded-full bg-primary"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("div",{className:"h-2 bg-muted rounded"}),p.jsx("div",{className:"h-2 bg-muted rounded w-3/4"}),p.jsx("div",{className:"h-2 bg-muted rounded w-1/2"})]}),p.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[p.jsx("div",{className:"w-8 h-6 bg-primary rounded text-xs"}),p.jsx("div",{className:"w-8 h-6 bg-secondary rounded text-xs"})]})]})}),p.jsxs("div",{className:"p-4 border border-border rounded-lg bg-muted/50",children:[p.jsx("h5",{className:"text-sm font-medium text-foreground mb-2",children:"مميزات المظهر"}),p.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[p.jsx("li",{children:"• تحسين قراءة النصوص العربية"}),p.jsx("li",{children:"• ألوان مناسبة للتطبيقات الطبية"}),p.jsx("li",{children:"• حفظ تلقائي للتفضيلات"}),p.jsx("li",{children:"• تباين عالي للوضوح"})]})]})]})]})]})]})}),"shortcuts"===e&&p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[p.jsxs("div",{className:"p-6 border-b border-border",children:[p.jsx("h3",{className:"text-lg font-medium text-foreground",children:"اختصارات لوحة المفاتيح"}),p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"تعرف على جميع اختصارات لوحة المفاتيح المتاحة لتسريع عملك"})]}),p.jsx("div",{className:"p-6",children:p.jsx(jc,{})})]}),p.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[p.jsx("div",{className:"p-6 border-b border-border",children:p.jsx("h3",{className:"text-lg font-medium text-foreground",children:"نصائح للاستخدام"})}),p.jsx("div",{className:"p-6 space-y-4",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[p.jsx("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-2",children:"الأحرف العربية"}),p.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"يمكنك استخدام الأحرف العربية أو الإنجليزية للاختصارات. مثلاً: A أو ش لإضافة مريض جديد."})]}),p.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[p.jsx("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-2",children:"التنقل السريع"}),p.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"استخدم الأرقام 0-9 أو ٠-٩ للتنقل السريع بين الصفحات المختلفة."})]}),p.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg",children:[p.jsx("h4",{className:"font-medium text-purple-800 dark:text-purple-200 mb-2",children:"الإجراءات السريعة"}),p.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300",children:"استخدم A/S/D أو ش/س/ي لإضافة مريض أو موعد أو دفعة بسرعة."})]}),p.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg",children:[p.jsx("h4",{className:"font-medium text-orange-800 dark:text-orange-200 mb-2",children:"العمليات العامة"}),p.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:"F1 للإعدادات، R/ق للتحديث، F/ب للبحث، ESC للإغلاق."})]})]})})]})]}),"security"===e&&p.jsx(gc,{showNotification:I}),"clinic"===e&&p.jsx("div",{className:"space-y-6",children:p.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[p.jsxs("div",{className:"p-6 border-b border-border",children:[p.jsx("h3",{className:"text-lg font-medium text-foreground",children:"معلومات العيادة"}),p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"إعدادات العيادة الأساسية والمعلومات التي تظهر في الإيصالات"})]}),p.jsx("div",{className:"p-6",children:p.jsxs("form",{className:"space-y-6",onSubmit:e=>{e.preventDefault();const t=new FormData(e.currentTarget),n={clinic_name:t.get("clinic_name"),doctor_name:t.get("doctor_name"),clinic_address:t.get("clinic_address"),clinic_phone:t.get("clinic_phone"),clinic_email:t.get("clinic_email"),currency:t.get("currency")};V(n)},children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{htmlFor:"clinic_name",className:"text-sm font-medium text-foreground",children:"اسم العيادة *"}),p.jsx("input",{type:"text",id:"clinic_name",name:"clinic_name",defaultValue:(null==$?void 0:$.clinic_name)||"",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:!0})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{htmlFor:"doctor_name",className:"text-sm font-medium text-foreground",children:"اسم الدكتور *"}),p.jsx("input",{type:"text",id:"doctor_name",name:"doctor_name",defaultValue:(null==$?void 0:$.doctor_name)||"",placeholder:"د. محمد أحمد",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:!0})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{htmlFor:"clinic_phone",className:"text-sm font-medium text-foreground",children:"رقم الهاتف"}),p.jsx("input",{type:"tel",id:"clinic_phone",name:"clinic_phone",defaultValue:(null==$?void 0:$.clinic_phone)||"",placeholder:"+963 95 966 9628",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{htmlFor:"clinic_email",className:"text-sm font-medium text-foreground",children:"البريد الإلكتروني"}),p.jsx("input",{type:"email",id:"clinic_email",name:"clinic_email",defaultValue:(null==$?void 0:$.clinic_email)||"",placeholder:"clinic@example.com",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary"})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{htmlFor:"clinic_address",className:"text-sm font-medium text-foreground",children:"عنوان العيادة"}),p.jsx("textarea",{id:"clinic_address",name:"clinic_address",defaultValue:(null==$?void 0:$.clinic_address)||"",placeholder:"حلب، الجمهورية العربية السورية",rows:3,className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{htmlFor:"currency",className:"text-sm font-medium text-foreground flex items-center gap-2",children:[p.jsx(Er,{className:"w-4 h-4"}),"العملة المستخدمة"]}),p.jsx("select",{id:"currency",name:"currency",defaultValue:(null==$?void 0:$.currency)||F||"USD",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary",onChange:e=>{P(e.target.value)},children:Object.entries(sa).map(([e,t])=>p.jsxs("option",{value:e,children:[t.nameAr," (",t.symbol,") - ",t.name]},e))}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"العملة المختارة ستظهر في جميع أنحاء التطبيق (المدفوعات، التقارير، الإحصائيات)"})]}),p.jsxs("div",{className:"space-y-4 pt-4 border-t border-border",children:[p.jsx("h4",{className:"text-sm font-medium text-foreground",children:"شعار العيادة"}),p.jsxs("div",{className:"flex items-start space-x-4 space-x-reverse",children:[p.jsx("div",{className:"flex-shrink-0",children:p.jsx("div",{className:"w-20 h-20 border-2 border-dashed border-border rounded-lg flex items-center justify-center bg-muted/50",children:M?p.jsx("img",{src:M,alt:"شعار العيادة",className:"w-full h-full object-cover rounded-lg"}):p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"w-8 h-8 mx-auto mb-1 text-muted-foreground",children:"📷"}),p.jsx("span",{className:"text-xs text-muted-foreground",children:"لا يوجد شعار"})]})})}),p.jsxs("div",{className:"flex-1 space-y-2",children:[p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("input",{type:"file",id:"clinic_logo",accept:"image/*",className:"hidden",onChange:e=>m(this,null,function*(){var t;const n=null==(t=e.target.files)?void 0:t[0];if(n){const e=new FileReader;e.onload=e=>m(this,null,function*(){var t;const n=null==(t=e.target)?void 0:t.result;yield V({clinic_logo:n})}),e.readAsDataURL(n)}})}),p.jsx("button",{type:"button",onClick:()=>{var e;return null==(e=document.getElementById("clinic_logo"))?void 0:e.click()},className:"px-3 py-2 text-sm border border-input bg-background text-foreground rounded-md hover:bg-accent",children:"اختيار شعار"}),M&&p.jsx("button",{type:"button",onClick:()=>V({clinic_logo:""}),className:"px-3 py-2 text-sm border border-red-200 bg-red-50 text-red-700 rounded-md hover:bg-red-100",children:"حذف الشعار"})]}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"يُفضل استخدام صورة مربعة بحجم 200x200 بكسل أو أكبر. الصيغ المدعومة: JPG, PNG, GIF"})]})]})]}),p.jsx("div",{className:"flex justify-end",children:p.jsx("button",{type:"submit",disabled:l,className:"px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"جاري الحفظ...":"حفظ الإعدادات"})})]})})]})}),"development"===e&&p.jsx("div",{className:"space-y-6",children:p.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[p.jsxs("div",{className:"p-6 border-b border-border",children:[p.jsx("h3",{className:"text-lg font-medium text-foreground",children:"معلومات فريق التطوير"}),p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"تواصل مع فريق التطوير للدعم الفني والاستفسارات"})]}),p.jsxs("div",{className:"p-6 space-y-6",children:[p.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse p-4 bg-muted/50 rounded-lg",children:[p.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:p.jsx(Fi,{className:"w-6 h-6 text-primary"})}),p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-medium text-foreground",children:"اسم الفريق"}),p.jsx("p",{className:"text-lg font-bold text-foreground",children:"AgorraCode"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"فريق تطوير تطبيقات إدارة العيادات"})]})]}),p.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse p-4 bg-muted/50 rounded-lg",children:[p.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/20 rounded-lg",children:p.jsx(ri,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h4",{className:"text-sm font-medium text-foreground",children:"رقم التواصل"}),p.jsx("p",{className:"text-lg font-bold text-foreground",children:"00963959669628"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"متاح للدعم الفني من 9 صباحاً إلى 6 مساءً"})]}),p.jsx("button",{onClick:()=>m(this,null,function*(){var e,t;const n="https://api.whatsapp.com/send/?phone=963959669628";try{if(window.electronAPI&&window.electronAPI.system&&window.electronAPI.system.openExternal)return void(yield window.electronAPI.system.openExternal(n))}catch(a){console.log("Method 1 failed:",a)}try{if(window.electronAPI)return void(yield null==(t=null==(e=window.electronAPI.shell)?void 0:e.openExternal)?void 0:t.call(e,n))}catch(a){console.log("Method 2 failed:",a)}window.open(n,"_blank","noopener,noreferrer")}),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"تواصل عبر واتساب"})]}),p.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse p-4 bg-muted/50 rounded-lg",children:[p.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/20 rounded-lg",children:p.jsx(Wr,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h4",{className:"text-sm font-medium text-foreground",children:"البريد الإلكتروني"}),p.jsx("p",{className:"text-lg font-bold text-foreground",children:"AgorraCode@gmail.com"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"للاستفسارات والدعم الفني"})]}),p.jsx("button",{onClick:()=>window.open("mailto:AgorraCode@gmail.com","_blank"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"إرسال إيميل"})]}),p.jsx("div",{className:"p-4 bg-primary/5 border border-primary/20 rounded-lg",children:p.jsxs("div",{className:"flex items-start space-x-3 space-x-reverse",children:[p.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:p.jsx(Br,{className:"w-5 h-5 text-primary"})}),p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-medium text-foreground mb-2",children:"معلومات إضافية"}),p.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[p.jsx("li",{children:"• نقدم دعماً فنياً شاملاً لجميع مستخدمي التطبيق"}),p.jsx("li",{children:"• نستقبل اقتراحاتكم لتطوير وتحسين التطبيق"}),p.jsx("li",{children:"• نوفر تدريباً مجانياً على استخدام التطبيق"}),p.jsx("li",{children:"• نضمن الاستجابة السريعة لجميع الاستفسارات"})]})]})]})})]})]})}),n&&p.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{zIndex:9999},children:[p.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>a(null),style:{zIndex:9998}}),p.jsx("div",{className:"relative bg-card border border-border rounded-lg shadow-2xl max-w-md w-full mx-4",style:{zIndex:1e4},dir:"rtl",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center mb-4",children:[p.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center ml-3",children:p.jsx(sr,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"تأكيد الحذف"}),p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"هل أنت متأكد من حذف هذه النسخة الاحتياطية؟"})]})]}),p.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:p.jsxs("div",{className:"flex",children:[p.jsx(sr,{className:"w-4 h-4 text-red-600 dark:text-red-400 ml-2 mt-0.5 flex-shrink-0"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 font-medium",children:"تحذير: لا يمكن التراجع عن هذا الإجراء"}),p.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:['سيتم حذف النسخة الاحتياطية "',n,'" نهائياً من النظام.']})]})]})}),p.jsxs("div",{className:"flex justify-end space-x-3 space-x-reverse",children:[p.jsx("button",{onClick:()=>a(null),className:"px-4 py-2 border border-input bg-background text-foreground rounded-lg hover:bg-accent transition-colors",children:"إلغاء"}),p.jsx("button",{onClick:()=>Y(n),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:"تأكيد الحذف"})]})]})})]}),s.show&&p.jsx("div",{className:"fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 "+("success"===s.type?"bg-green-500 text-white":"error"===s.type?"bg-red-500 text-white":"bg-blue-500 text-white"),children:p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("span",{className:"text-lg",children:"success"===s.type?"✅":"error"===s.type?"❌":"ℹ️"}),p.jsx("span",{children:s.message})]})})]})}var _c="rovingFocusGroup.onEntryFocus",kc={bubbles:!1,cancelable:!0},Sc="RovingFocusGroup",[Dc,$c,Cc]=Z(Sc),[Ec,Tc]=M(Sc,[Cc]),[Ac,Fc]=Ec(Sc),Pc=ve.forwardRef((e,t)=>p.jsx(Dc.Provider,{scope:e.__scopeRovingFocusGroup,children:p.jsx(Dc.Slot,{scope:e.__scopeRovingFocusGroup,children:p.jsx(Oc,d(o({},e),{ref:t}))})}));Pc.displayName=Sc;var Oc=ve.forwardRef((e,t)=>{const n=e,{__scopeRovingFocusGroup:a,orientation:s,loop:r=!1,dir:i,currentTabStopId:l,defaultCurrentTabStopId:u,onCurrentTabStopIdChange:m,onEntryFocus:h,preventScrollOnEntryFocus:x=!1}=n,g=c(n,["__scopeRovingFocusGroup","orientation","loop","dir","currentTabStopId","defaultCurrentTabStopId","onCurrentTabStopIdChange","onEntryFocus","preventScrollOnEntryFocus"]),f=ve.useRef(null),v=z(t,f),y=Q(i),[b,j]=G({prop:l,defaultProp:null!=u?u:null,onChange:m,caller:Sc}),[w,N]=ve.useState(!1),_=U(h),k=$c(a),S=ve.useRef(!1),[D,$]=ve.useState(0);return ve.useEffect(()=>{const e=f.current;if(e)return e.addEventListener(_c,_),()=>e.removeEventListener(_c,_)},[_]),p.jsx(Ac,{scope:a,orientation:s,dir:y,loop:r,currentTabStopId:b,onItemFocus:ve.useCallback(e=>j(e),[j]),onItemShiftTab:ve.useCallback(()=>N(!0),[]),onFocusableItemAdd:ve.useCallback(()=>$(e=>e+1),[]),onFocusableItemRemove:ve.useCallback(()=>$(e=>e-1),[]),children:p.jsx(q.div,d(o({tabIndex:w||0===D?-1:0,"data-orientation":s},g),{ref:v,style:o({outline:"none"},e.style),onMouseDown:Y(e.onMouseDown,()=>{S.current=!0}),onFocus:Y(e.onFocus,e=>{const t=!S.current;if(e.target===e.currentTarget&&t&&!w){const t=new CustomEvent(_c,kc);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=k().filter(e=>e.focusable);Ic([e.find(e=>e.active),e.find(e=>e.id===b),...e].filter(Boolean).map(e=>e.ref.current),x)}}S.current=!1}),onBlur:Y(e.onBlur,()=>N(!1))}))})}),Rc="RovingFocusGroupItem",Mc=ve.forwardRef((e,t)=>{const n=e,{__scopeRovingFocusGroup:a,focusable:s=!0,active:r=!1,tabStopId:i,children:l}=n,u=c(n,["__scopeRovingFocusGroup","focusable","active","tabStopId","children"]),m=W(),h=i||m,x=Fc(Rc,a),g=x.currentTabStopId===h,f=$c(a),{onFocusableItemAdd:v,onFocusableItemRemove:y,currentTabStopId:b}=x;return ve.useEffect(()=>{if(s)return v(),()=>y()},[s,v,y]),p.jsx(Dc.ItemSlot,{scope:a,id:h,focusable:s,active:r,children:p.jsx(q.span,d(o({tabIndex:g?0:-1,"data-orientation":x.orientation},u),{ref:t,onMouseDown:Y(e.onMouseDown,e=>{s?x.onItemFocus(h):e.preventDefault()}),onFocus:Y(e.onFocus,()=>x.onItemFocus(h)),onKeyDown:Y(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void x.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,n){const a=function(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,n);return"vertical"===t&&["ArrowLeft","ArrowRight"].includes(a)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(a)?void 0:Lc[a]}(e,x.orientation,x.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let s=f().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)s.reverse();else if("prev"===t||"next"===t){"prev"===t&&s.reverse();const r=s.indexOf(e.currentTarget);s=x.loop?(a=r+1,(n=s).map((e,t)=>n[(a+t)%n.length])):s.slice(r+1)}setTimeout(()=>Ic(s))}var n,a}),children:"function"==typeof l?l({isCurrentTabStop:g,hasTabStop:null!=b}):l}))})});Mc.displayName=Rc;var Lc={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Ic(e,t=!1){const n=document.activeElement;for(const a of e){if(a===n)return;if(a.focus({preventScroll:t}),document.activeElement!==n)return}}var zc=Pc,Bc=Mc,Yc="Tabs",[Vc,qc]=M(Yc,[Tc]),Uc=Tc(),[Hc,Gc]=Vc(Yc),Wc=ve.forwardRef((e,t)=>{const n=e,{__scopeTabs:a,value:s,onValueChange:r,defaultValue:i,orientation:l="horizontal",dir:u,activationMode:m="automatic"}=n,h=c(n,["__scopeTabs","value","onValueChange","defaultValue","orientation","dir","activationMode"]),x=Q(u),[g,f]=G({prop:s,onChange:r,defaultProp:null!=i?i:"",caller:Yc});return p.jsx(Hc,{scope:a,baseId:W(),value:g,onValueChange:f,orientation:l,dir:x,activationMode:m,children:p.jsx(q.div,d(o({dir:x,"data-orientation":l},h),{ref:t}))})});Wc.displayName=Yc;var Kc="TabsList",Zc=ve.forwardRef((e,t)=>{const n=e,{__scopeTabs:a,loop:s=!0}=n,r=c(n,["__scopeTabs","loop"]),i=Gc(Kc,a),l=Uc(a);return p.jsx(zc,d(o({asChild:!0},l),{orientation:i.orientation,dir:i.dir,loop:s,children:p.jsx(q.div,d(o({role:"tablist","aria-orientation":i.orientation},r),{ref:t}))}))});Zc.displayName=Kc;var Qc="TabsTrigger",Xc=ve.forwardRef((e,t)=>{const n=e,{__scopeTabs:a,value:s,disabled:r=!1}=n,i=c(n,["__scopeTabs","value","disabled"]),l=Gc(Qc,a),u=Uc(a),m=tu(l.baseId,s),h=nu(l.baseId,s),x=s===l.value;return p.jsx(Bc,d(o({asChild:!0},u),{focusable:!r,active:x,children:p.jsx(q.button,d(o({type:"button",role:"tab","aria-selected":x,"aria-controls":h,"data-state":x?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:m},i),{ref:t,onMouseDown:Y(e.onMouseDown,e=>{r||0!==e.button||!1!==e.ctrlKey?e.preventDefault():l.onValueChange(s)}),onKeyDown:Y(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&l.onValueChange(s)}),onFocus:Y(e.onFocus,()=>{const e="manual"!==l.activationMode;x||r||!e||l.onValueChange(s)})}))}))});Xc.displayName=Qc;var Jc="TabsContent",eu=ve.forwardRef((e,t)=>{const n=e,{__scopeTabs:a,value:s,forceMount:r,children:i}=n,l=c(n,["__scopeTabs","value","forceMount","children"]),u=Gc(Jc,a),m=tu(u.baseId,s),h=nu(u.baseId,s),x=s===u.value,g=ve.useRef(x);return ve.useEffect(()=>{const e=requestAnimationFrame(()=>g.current=!1);return()=>cancelAnimationFrame(e)},[]),p.jsx(K,{present:r||x,children:({present:n})=>p.jsx(q.div,d(o({"data-state":x?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":m,hidden:!n,id:h,tabIndex:0},l),{ref:t,style:d(o({},e.style),{animationDuration:g.current?"0s":void 0}),children:n&&i}))})});function tu(e,t){return`${e}-trigger-${t}`}function nu(e,t){return`${e}-content-${t}`}eu.displayName=Jc;var au=Zc,su=Xc,ru=eu;const iu=Wc,lu=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(au,o({ref:t,className:aa("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",a)},s))});lu.displayName=au.displayName;const ou=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(su,o({ref:t,className:aa("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",a)},s))});ou.displayName=su.displayName;const du=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(ru,o({ref:t,className:aa("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a)},s))});du.displayName=ru.displayName;const cu=(e,t,n)=>{if(e&&"reportValidity"in e){const a=Ya(n,t);e.setCustomValidity(a&&a.message||""),e.reportValidity()}},uu=(e,t)=>{for(const n in t.fields){const a=t.fields[n];a&&a.ref&&"reportValidity"in a.ref?cu(a.ref,n,e):a&&a.refs&&a.refs.forEach(t=>cu(t,n,e))}},mu=(e,t)=>{t.shouldUseNativeValidation&&uu(e,t);const n={};for(const a in e){const s=Ya(t.fields,a),r=Object.assign(e[a]||{},{ref:s&&s.ref});if(pu(t.names||Object.keys(e),a)){const e=Object.assign({},Ya(n,a));qa(e,"root",r),qa(n,a,e)}else qa(n,a,r)}return n},pu=(e,t)=>{const n=hu(t);return e.some(e=>hu(e).match(`^${n}\\.\\d+`))};function hu(e){return e.replace(/\]|\[/g,"")}function xu(e,t,n){var a;function s(n,a){var s,r;Object.defineProperty(n,"_zod",{value:null!=(s=n._zod)?s:{},enumerable:!1}),null!=(r=n._zod).traits||(r.traits=new Set),n._zod.traits.add(e),t(n,a);for(const e in l.prototype)e in n||Object.defineProperty(n,e,{value:l.prototype[e].bind(n)});n._zod.constr=l,n._zod.def=a}const r=null!=(a=null==n?void 0:n.Parent)?a:Object;class i extends r{}function l(e){var t;const a=(null==n?void 0:n.Parent)?new i:this;s(a,e),null!=(t=a._zod).deferred||(t.deferred=[]);for(const n of a._zod.deferred)n();return a}return Object.defineProperty(i,"name",{value:e}),Object.defineProperty(l,"init",{value:s}),Object.defineProperty(l,Symbol.hasInstance,{value:t=>{var a,s;return!!((null==n?void 0:n.Parent)&&t instanceof n.Parent)||(null==(s=null==(a=null==t?void 0:t._zod)?void 0:a.traits)?void 0:s.has(e))}}),Object.defineProperty(l,"name",{value:e}),l}class gu extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const fu={};function vu(e){return e&&Object.assign(fu,e),fu}function yu(e,t){return"bigint"==typeof t?t.toString():t}const bu=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function ju(e){return"string"==typeof e?e:null==e?void 0:e.message}function wu(e,t,n){var a,s,r,i,l,c,u,m,p,h,x;const g=d(o({},e),{path:null!=(a=e.path)?a:[]});if(!e.message){const a=null!=(x=null!=(h=null!=(m=null!=(c=ju(null==(i=null==(r=null==(s=e.inst)?void 0:s._zod.def)?void 0:r.error)?void 0:i.call(r,e)))?c:ju(null==(l=null==t?void 0:t.error)?void 0:l.call(t,e)))?m:ju(null==(u=n.customError)?void 0:u.call(n,e)))?h:ju(null==(p=n.localeError)?void 0:p.call(n,e)))?x:"Invalid input";g.message=a}return delete g.inst,delete g.continue,(null==t?void 0:t.reportInput)||delete g.input,g}const Nu=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,yu,2),enumerable:!0})},_u=xu("$ZodError",Nu),ku=xu("$ZodError",Nu,{Parent:Error}),Su=e=>(t,n,a,s)=>{var r;const i=a?Object.assign(a,{async:!1}):{async:!1},l=t._zod.run({value:n,issues:[]},i);if(l instanceof Promise)throw new gu;if(l.issues.length){const t=new(null!=(r=null==s?void 0:s.Err)?r:e)(l.issues.map(e=>wu(e,i,vu())));throw bu(t,null==s?void 0:s.callee),t}return l.value},Du=Su(ku),$u=e=>(t,n,a,s)=>m(void 0,null,function*(){var r;const i=a?Object.assign(a,{async:!0}):{async:!0};let l=t._zod.run({value:n,issues:[]},i);if(l instanceof Promise&&(l=yield l),l.issues.length){const t=new(null!=(r=null==s?void 0:s.Err)?r:e)(l.issues.map(e=>wu(e,i,vu())));throw bu(t,null==s?void 0:s.callee),t}return l.value}),Cu=$u(ku);function Eu(e,t){try{var n=e()}catch(a){return t(a)}return n&&n.then?n.then(void 0,t):n}function Tu(e,t){for(var n={};e.length;){var a=e[0],s=a.code,r=a.message,i=a.path.join(".");if(!n[i])if("unionErrors"in a){var l=a.unionErrors[0].errors[0];n[i]={message:l.message,type:l.code}}else n[i]={message:r,type:s};if("unionErrors"in a&&a.unionErrors.forEach(function(t){return t.errors.forEach(function(t){return e.push(t)})}),t){var o=n[i].types,d=o&&o[a.code];n[i]=hs(i,t,n,s,d?[].concat(d,a.message):a.message)}e.shift()}return n}function Au(e,t){for(var n={};e.length;){var a=e[0],s=a.code,r=a.message,i=a.path.join(".");if(!n[i])if("invalid_union"===a.code){var l=a.errors[0][0];n[i]={message:l.message,type:l.code}}else n[i]={message:r,type:s};if("invalid_union"===a.code&&a.errors.forEach(function(t){return t.forEach(function(t){return e.push(t)})}),t){var o=n[i].types,d=o&&o[a.code];n[i]=hs(i,t,n,s,d?[].concat(d,a.message):a.message)}e.shift()}return n}function Fu(e,t,n){if(void 0===n&&(n={}),"_def"in(a=e)&&"object"==typeof a._def&&"typeName"in a._def)return function(s,r,i){try{return Promise.resolve(Eu(function(){return Promise.resolve(e["sync"===n.mode?"parse":"parseAsync"](s,t)).then(function(e){return i.shouldUseNativeValidation&&uu({},i),{errors:{},values:n.raw?Object.assign({},s):e}})},function(e){if(t=e,Array.isArray(null==t?void 0:t.issues))return{values:{},errors:mu(Tu(e.errors,!i.shouldUseNativeValidation&&"all"===i.criteriaMode),i)};var t;throw e}))}catch(a){return Promise.reject(a)}};var a;if(function(e){return"_zod"in e&&"object"==typeof e._zod}(e))return function(s,r,i){try{return Promise.resolve(Eu(function(){return Promise.resolve(("sync"===n.mode?Du:Cu)(e,s,t)).then(function(e){return i.shouldUseNativeValidation&&uu({},i),{errors:{},values:n.raw?Object.assign({},s):e}})},function(e){if(e instanceof _u)return{values:{},errors:mu(Au(e.issues,!i.shouldUseNativeValidation&&"all"===i.criteriaMode),i)};throw e}))}catch(a){return Promise.reject(a)}};throw new Error("Invalid input: not a Zod schema")}var Pu,Ou,Ru;(Ou=Pu||(Pu={})).assertEqual=e=>{},Ou.assertIs=function(e){},Ou.assertNever=function(e){throw new Error},Ou.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},Ou.getValidEnumValues=e=>{const t=Ou.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),n={};for(const a of t)n[a]=e[a];return Ou.objectValues(n)},Ou.objectValues=e=>Ou.objectKeys(e).map(function(t){return e[t]}),Ou.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},Ou.find=(e,t)=>{for(const n of e)if(t(n))return n},Ou.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,Ou.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},Ou.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(Ru||(Ru={})).mergeShapes=(e,t)=>o(o({},e),t);const Mu=Pu.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Lu=e=>{switch(typeof e){case"undefined":return Mu.undefined;case"string":return Mu.string;case"number":return Number.isNaN(e)?Mu.nan:Mu.number;case"boolean":return Mu.boolean;case"function":return Mu.function;case"bigint":return Mu.bigint;case"symbol":return Mu.symbol;case"object":return Array.isArray(e)?Mu.array:null===e?Mu.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Mu.promise:"undefined"!=typeof Map&&e instanceof Map?Mu.map:"undefined"!=typeof Set&&e instanceof Set?Mu.set:"undefined"!=typeof Date&&e instanceof Date?Mu.date:Mu.object;default:return Mu.unknown}},Iu=Pu.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class zu extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},n={_errors:[]},a=e=>{for(const s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(a);else if("invalid_return_type"===s.code)a(s.returnTypeError);else if("invalid_arguments"===s.code)a(s.argumentsError);else if(0===s.path.length)n._errors.push(t(s));else{let e=n,a=0;for(;a<s.path.length;){const n=s.path[a];a===s.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(s))):e[n]=e[n]||{_errors:[]},e=e[n],a++}}};return a(this),n}static assert(e){if(!(e instanceof zu))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Pu.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},n=[];for(const a of this.issues)if(a.path.length>0){const n=a.path[0];t[n]=t[n]||[],t[n].push(e(a))}else n.push(e(a));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}zu.create=e=>new zu(e);const Bu=(e,t)=>{let n;switch(e.code){case Iu.invalid_type:n=e.received===Mu.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Iu.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,Pu.jsonStringifyReplacer)}`;break;case Iu.unrecognized_keys:n=`Unrecognized key(s) in object: ${Pu.joinValues(e.keys,", ")}`;break;case Iu.invalid_union:n="Invalid input";break;case Iu.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Pu.joinValues(e.options)}`;break;case Iu.invalid_enum_value:n=`Invalid enum value. Expected ${Pu.joinValues(e.options)}, received '${e.received}'`;break;case Iu.invalid_arguments:n="Invalid function arguments";break;case Iu.invalid_return_type:n="Invalid function return type";break;case Iu.invalid_date:n="Invalid date";break;case Iu.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:Pu.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Iu.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Iu.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Iu.custom:n="Invalid input";break;case Iu.invalid_intersection_types:n="Intersection results could not be merged";break;case Iu.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case Iu.not_finite:n="Number must be finite";break;default:n=t.defaultError,Pu.assertNever(e)}return{message:n}};let Yu=Bu;function Vu(e,t){const n=Yu,a=(e=>{const{data:t,path:n,errorMaps:a,issueData:s}=e,r=[...n,...s.path||[]],i=d(o({},s),{path:r});if(void 0!==s.message)return d(o({},s),{path:r,message:s.message});let l="";const c=a.filter(e=>!!e).slice().reverse();for(const o of c)l=o(i,{data:t,defaultError:l}).message;return d(o({},s),{path:r,message:l})})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===Bu?void 0:Bu].filter(e=>!!e)});e.common.issues.push(a)}class qu{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const a of t){if("aborted"===a.status)return Uu;"dirty"===a.status&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static mergeObjectAsync(e,t){return m(this,null,function*(){const n=[];for(const e of t){const t=yield e.key,a=yield e.value;n.push({key:t,value:a})}return qu.mergeObjectSync(e,n)})}static mergeObjectSync(e,t){const n={};for(const a of t){const{key:t,value:s}=a;if("aborted"===t.status)return Uu;if("aborted"===s.status)return Uu;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),"__proto__"===t.value||void 0===s.value&&!a.alwaysSet||(n[t.value]=s.value)}return{status:e.value,value:n}}}const Uu=Object.freeze({status:"aborted"}),Hu=e=>({status:"dirty",value:e}),Gu=e=>({status:"valid",value:e}),Wu=e=>"aborted"===e.status,Ku=e=>"dirty"===e.status,Zu=e=>"valid"===e.status,Qu=e=>"undefined"!=typeof Promise&&e instanceof Promise;var Xu,Ju;(Ju=Xu||(Xu={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},Ju.toString=e=>"string"==typeof e?e:null==e?void 0:e.message;class em{constructor(e,t,n,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const tm=(e,t)=>{if(Zu(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new zu(e.common.issues);return this._error=t,this._error}}};function nm(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:a,description:s}=e;if(t&&(n||a))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:s};return{errorMap:(t,s)=>{var r,i;const{message:l}=e;return"invalid_enum_value"===t.code?{message:null!=l?l:s.defaultError}:void 0===s.data?{message:null!=(r=null!=l?l:a)?r:s.defaultError}:"invalid_type"!==t.code?{message:s.defaultError}:{message:null!=(i=null!=l?l:n)?i:s.defaultError}},description:s}}class am{get description(){return this._def.description}_getType(e){return Lu(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Lu(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new qu,ctx:{common:e.parent.common,data:e.data,parsedType:Lu(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Qu(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const a={common:{issues:[],async:null!=(n=null==t?void 0:t.async)&&n,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Lu(e)},s=this._parseSync({data:e,path:a.path,parent:a});return tm(a,s)}"~validate"(e){var t,n;const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Lu(e)};if(!this["~standard"].async)try{const t=this._parseSync({data:e,path:[],parent:a});return Zu(t)?{value:t.value}:{issues:a.common.issues}}catch(s){(null==(n=null==(t=null==s?void 0:s.message)?void 0:t.toLowerCase())?void 0:n.includes("encountered"))&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then(e=>Zu(e)?{value:e.value}:{issues:a.common.issues})}parseAsync(e,t){return m(this,null,function*(){const n=yield this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error})}safeParseAsync(e,t){return m(this,null,function*(){const n={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Lu(e)},a=this._parse({data:e,path:n.path,parent:n}),s=yield Qu(a)?a:Promise.resolve(a);return tm(n,s)})}refine(e,t){return this._refinement((n,a)=>{const s=e(n),r=()=>a.addIssue(o({code:Iu.custom},(e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t)(n)));return"undefined"!=typeof Promise&&s instanceof Promise?s.then(e=>!!e||(r(),!1)):!!s||(r(),!1)})}refinement(e,t){return this._refinement((n,a)=>!!e(n)||(a.addIssue("function"==typeof t?t(n,a):t),!1))}_refinement(e){return new tp({schema:this,typeName:cp.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return np.create(this,this._def)}nullable(){return ap.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return zm.create(this)}promise(){return ep.create(this,this._def)}or(e){return Vm.create([this,e],this._def)}and(e){return Um.create(this,e,this._def)}transform(e){return new tp(d(o({},nm(this._def)),{schema:this,typeName:cp.ZodEffects,effect:{type:"transform",transform:e}}))}default(e){const t="function"==typeof e?e:()=>e;return new sp(d(o({},nm(this._def)),{innerType:this,defaultValue:t,typeName:cp.ZodDefault}))}brand(){return new lp(o({typeName:cp.ZodBranded,type:this},nm(this._def)))}catch(e){const t="function"==typeof e?e:()=>e;return new rp(d(o({},nm(this._def)),{innerType:this,catchValue:t,typeName:cp.ZodCatch}))}describe(e){return new(0,this.constructor)(d(o({},this._def),{description:e}))}pipe(e){return op.create(this,e)}readonly(){return dp.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const sm=/^c[^\s-]{8,}$/i,rm=/^[0-9a-z]+$/,im=/^[0-9A-HJKMNP-TV-Z]{26}$/i,lm=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,om=/^[a-z0-9_-]{21}$/i,dm=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,cm=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,um=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let mm;const pm=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,hm=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,xm=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,gm=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,fm=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,vm=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ym="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bm=new RegExp(`^${ym}$`);function jm(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function wm(e){return new RegExp(`^${jm(e)}$`)}function Nm(e){let t=`${ym}T${jm(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function _m(e,t){return!("v4"!==t&&t||!pm.test(e))||!("v6"!==t&&t||!xm.test(e))}function km(e,t){if(!dm.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const a=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(a));return"object"==typeof s&&null!==s&&((!("typ"in s)||"JWT"===(null==s?void 0:s.typ))&&(!!s.alg&&(!t||s.alg===t)))}catch(n){return!1}}function Sm(e,t){return!("v4"!==t&&t||!hm.test(e))||!("v6"!==t&&t||!gm.test(e))}class Dm extends am{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==Mu.string){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.string,received:t.parsedType}),Uu}const t=new qu;let n;for(const s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(n=this._getOrReturnCtx(e,n),Vu(n,{code:Iu.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("max"===s.kind)e.data.length>s.value&&(n=this._getOrReturnCtx(e,n),Vu(n,{code:Iu.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("length"===s.kind){const a=e.data.length>s.value,r=e.data.length<s.value;(a||r)&&(n=this._getOrReturnCtx(e,n),a?Vu(n,{code:Iu.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):r&&Vu(n,{code:Iu.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),t.dirty())}else if("email"===s.kind)um.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"email",code:Iu.invalid_string,message:s.message}),t.dirty());else if("emoji"===s.kind)mm||(mm=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),mm.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"emoji",code:Iu.invalid_string,message:s.message}),t.dirty());else if("uuid"===s.kind)lm.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"uuid",code:Iu.invalid_string,message:s.message}),t.dirty());else if("nanoid"===s.kind)om.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"nanoid",code:Iu.invalid_string,message:s.message}),t.dirty());else if("cuid"===s.kind)sm.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"cuid",code:Iu.invalid_string,message:s.message}),t.dirty());else if("cuid2"===s.kind)rm.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"cuid2",code:Iu.invalid_string,message:s.message}),t.dirty());else if("ulid"===s.kind)im.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"ulid",code:Iu.invalid_string,message:s.message}),t.dirty());else if("url"===s.kind)try{new URL(e.data)}catch(a){n=this._getOrReturnCtx(e,n),Vu(n,{validation:"url",code:Iu.invalid_string,message:s.message}),t.dirty()}else if("regex"===s.kind){s.regex.lastIndex=0;s.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"regex",code:Iu.invalid_string,message:s.message}),t.dirty())}else if("trim"===s.kind)e.data=e.data.trim();else if("includes"===s.kind)e.data.includes(s.value,s.position)||(n=this._getOrReturnCtx(e,n),Vu(n,{code:Iu.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),t.dirty());else if("toLowerCase"===s.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===s.kind)e.data=e.data.toUpperCase();else if("startsWith"===s.kind)e.data.startsWith(s.value)||(n=this._getOrReturnCtx(e,n),Vu(n,{code:Iu.invalid_string,validation:{startsWith:s.value},message:s.message}),t.dirty());else if("endsWith"===s.kind)e.data.endsWith(s.value)||(n=this._getOrReturnCtx(e,n),Vu(n,{code:Iu.invalid_string,validation:{endsWith:s.value},message:s.message}),t.dirty());else if("datetime"===s.kind){Nm(s).test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{code:Iu.invalid_string,validation:"datetime",message:s.message}),t.dirty())}else if("date"===s.kind){bm.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{code:Iu.invalid_string,validation:"date",message:s.message}),t.dirty())}else if("time"===s.kind){wm(s).test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{code:Iu.invalid_string,validation:"time",message:s.message}),t.dirty())}else"duration"===s.kind?cm.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"duration",code:Iu.invalid_string,message:s.message}),t.dirty()):"ip"===s.kind?_m(e.data,s.version)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"ip",code:Iu.invalid_string,message:s.message}),t.dirty()):"jwt"===s.kind?km(e.data,s.alg)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"jwt",code:Iu.invalid_string,message:s.message}),t.dirty()):"cidr"===s.kind?Sm(e.data,s.version)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"cidr",code:Iu.invalid_string,message:s.message}),t.dirty()):"base64"===s.kind?fm.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"base64",code:Iu.invalid_string,message:s.message}),t.dirty()):"base64url"===s.kind?vm.test(e.data)||(n=this._getOrReturnCtx(e,n),Vu(n,{validation:"base64url",code:Iu.invalid_string,message:s.message}),t.dirty()):Pu.assertNever(s);return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement(t=>e.test(t),o({validation:t,code:Iu.invalid_string},Xu.errToObj(n)))}_addCheck(e){return new Dm(d(o({},this._def),{checks:[...this._def.checks,e]}))}email(e){return this._addCheck(o({kind:"email"},Xu.errToObj(e)))}url(e){return this._addCheck(o({kind:"url"},Xu.errToObj(e)))}emoji(e){return this._addCheck(o({kind:"emoji"},Xu.errToObj(e)))}uuid(e){return this._addCheck(o({kind:"uuid"},Xu.errToObj(e)))}nanoid(e){return this._addCheck(o({kind:"nanoid"},Xu.errToObj(e)))}cuid(e){return this._addCheck(o({kind:"cuid"},Xu.errToObj(e)))}cuid2(e){return this._addCheck(o({kind:"cuid2"},Xu.errToObj(e)))}ulid(e){return this._addCheck(o({kind:"ulid"},Xu.errToObj(e)))}base64(e){return this._addCheck(o({kind:"base64"},Xu.errToObj(e)))}base64url(e){return this._addCheck(o({kind:"base64url"},Xu.errToObj(e)))}jwt(e){return this._addCheck(o({kind:"jwt"},Xu.errToObj(e)))}ip(e){return this._addCheck(o({kind:"ip"},Xu.errToObj(e)))}cidr(e){return this._addCheck(o({kind:"cidr"},Xu.errToObj(e)))}datetime(e){var t,n;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck(o({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!=(t=null==e?void 0:e.offset)&&t,local:null!=(n=null==e?void 0:e.local)&&n},Xu.errToObj(null==e?void 0:e.message)))}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck(o({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision},Xu.errToObj(null==e?void 0:e.message)))}duration(e){return this._addCheck(o({kind:"duration"},Xu.errToObj(e)))}regex(e,t){return this._addCheck(o({kind:"regex",regex:e},Xu.errToObj(t)))}includes(e,t){return this._addCheck(o({kind:"includes",value:e,position:null==t?void 0:t.position},Xu.errToObj(null==t?void 0:t.message)))}startsWith(e,t){return this._addCheck(o({kind:"startsWith",value:e},Xu.errToObj(t)))}endsWith(e,t){return this._addCheck(o({kind:"endsWith",value:e},Xu.errToObj(t)))}min(e,t){return this._addCheck(o({kind:"min",value:e},Xu.errToObj(t)))}max(e,t){return this._addCheck(o({kind:"max",value:e},Xu.errToObj(t)))}length(e,t){return this._addCheck(o({kind:"length",value:e},Xu.errToObj(t)))}nonempty(e){return this.min(1,Xu.errToObj(e))}trim(){return new Dm(d(o({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new Dm(d(o({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new Dm(d(o({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function $m(e,t){const n=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,s=n>a?n:a;return Number.parseInt(e.toFixed(s).replace(".",""))%Number.parseInt(t.toFixed(s).replace(".",""))/i(10,s)}Dm.create=e=>{var t;return new Dm(o({checks:[],typeName:cp.ZodString,coerce:null!=(t=null==e?void 0:e.coerce)&&t},nm(e)))};class Cm extends am{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==Mu.number){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.number,received:t.parsedType}),Uu}let t;const n=new qu;for(const a of this._def.checks)if("int"===a.kind)Pu.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Vu(t,{code:Iu.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty());else if("min"===a.kind){(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),Vu(t,{code:Iu.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty())}else if("max"===a.kind){(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),Vu(t,{code:Iu.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty())}else"multipleOf"===a.kind?0!==$m(e.data,a.value)&&(t=this._getOrReturnCtx(e,t),Vu(t,{code:Iu.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Vu(t,{code:Iu.not_finite,message:a.message}),n.dirty()):Pu.assertNever(a);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Xu.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Xu.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Xu.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Xu.toString(t))}setLimit(e,t,n,a){return new Cm(d(o({},this._def),{checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Xu.toString(a)}]}))}_addCheck(e){return new Cm(d(o({},this._def),{checks:[...this._def.checks,e]}))}int(e){return this._addCheck({kind:"int",message:Xu.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Xu.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Xu.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Xu.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Xu.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Xu.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Xu.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Xu.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Xu.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&Pu.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Cm.create=e=>new Cm(o({checks:[],typeName:cp.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1},nm(e)));class Em extends am{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch(a){return this._getInvalidInput(e)}if(this._getType(e)!==Mu.bigint)return this._getInvalidInput(e);let t;const n=new qu;for(const s of this._def.checks)if("min"===s.kind){(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),Vu(t,{code:Iu.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty())}else if("max"===s.kind){(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),Vu(t,{code:Iu.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty())}else"multipleOf"===s.kind?e.data%s.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Vu(t,{code:Iu.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):Pu.assertNever(s);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.bigint,received:t.parsedType}),Uu}gte(e,t){return this.setLimit("min",e,!0,Xu.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Xu.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Xu.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Xu.toString(t))}setLimit(e,t,n,a){return new Em(d(o({},this._def),{checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Xu.toString(a)}]}))}_addCheck(e){return new Em(d(o({},this._def),{checks:[...this._def.checks,e]}))}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Xu.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Xu.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Xu.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Xu.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Xu.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Em.create=e=>{var t;return new Em(o({checks:[],typeName:cp.ZodBigInt,coerce:null!=(t=null==e?void 0:e.coerce)&&t},nm(e)))};class Tm extends am{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==Mu.boolean){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.boolean,received:t.parsedType}),Uu}return Gu(e.data)}}Tm.create=e=>new Tm(o({typeName:cp.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1},nm(e)));class Am extends am{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==Mu.date){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.date,received:t.parsedType}),Uu}if(Number.isNaN(e.data.getTime())){return Vu(this._getOrReturnCtx(e),{code:Iu.invalid_date}),Uu}const t=new qu;let n;for(const a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),Vu(n,{code:Iu.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),t.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),Vu(n,{code:Iu.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),t.dirty()):Pu.assertNever(a);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Am(d(o({},this._def),{checks:[...this._def.checks,e]}))}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Xu.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Xu.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Am.create=e=>new Am(o({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:cp.ZodDate},nm(e)));class Fm extends am{_parse(e){if(this._getType(e)!==Mu.symbol){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.symbol,received:t.parsedType}),Uu}return Gu(e.data)}}Fm.create=e=>new Fm(o({typeName:cp.ZodSymbol},nm(e)));class Pm extends am{_parse(e){if(this._getType(e)!==Mu.undefined){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.undefined,received:t.parsedType}),Uu}return Gu(e.data)}}Pm.create=e=>new Pm(o({typeName:cp.ZodUndefined},nm(e)));class Om extends am{_parse(e){if(this._getType(e)!==Mu.null){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.null,received:t.parsedType}),Uu}return Gu(e.data)}}Om.create=e=>new Om(o({typeName:cp.ZodNull},nm(e)));class Rm extends am{constructor(){super(...arguments),this._any=!0}_parse(e){return Gu(e.data)}}Rm.create=e=>new Rm(o({typeName:cp.ZodAny},nm(e)));class Mm extends am{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Gu(e.data)}}Mm.create=e=>new Mm(o({typeName:cp.ZodUnknown},nm(e)));class Lm extends am{_parse(e){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.never,received:t.parsedType}),Uu}}Lm.create=e=>new Lm(o({typeName:cp.ZodNever},nm(e)));class Im extends am{_parse(e){if(this._getType(e)!==Mu.undefined){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.void,received:t.parsedType}),Uu}return Gu(e.data)}}Im.create=e=>new Im(o({typeName:cp.ZodVoid},nm(e)));class zm extends am{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),a=this._def;if(t.parsedType!==Mu.array)return Vu(t,{code:Iu.invalid_type,expected:Mu.array,received:t.parsedType}),Uu;if(null!==a.exactLength){const e=t.data.length>a.exactLength.value,s=t.data.length<a.exactLength.value;(e||s)&&(Vu(t,{code:e?Iu.too_big:Iu.too_small,minimum:s?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(Vu(t,{code:Iu.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(Vu(t,{code:Iu.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>a.type._parseAsync(new em(t,e,t.path,n)))).then(e=>qu.mergeArray(n,e));const s=[...t.data].map((e,n)=>a.type._parseSync(new em(t,e,t.path,n)));return qu.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new zm(d(o({},this._def),{minLength:{value:e,message:Xu.toString(t)}}))}max(e,t){return new zm(d(o({},this._def),{maxLength:{value:e,message:Xu.toString(t)}}))}length(e,t){return new zm(d(o({},this._def),{exactLength:{value:e,message:Xu.toString(t)}}))}nonempty(e){return this.min(1,e)}}function Bm(e){if(e instanceof Ym){const t={};for(const n in e.shape){const a=e.shape[n];t[n]=np.create(Bm(a))}return new Ym(d(o({},e._def),{shape:()=>t}))}return e instanceof zm?new zm(d(o({},e._def),{type:Bm(e.element)})):e instanceof np?np.create(Bm(e.unwrap())):e instanceof ap?ap.create(Bm(e.unwrap())):e instanceof Hm?Hm.create(e.items.map(e=>Bm(e))):e}zm.create=(e,t)=>new zm(o({type:e,minLength:null,maxLength:null,exactLength:null,typeName:cp.ZodArray},nm(t)));class Ym extends am{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=Pu.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Mu.object){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.object,received:t.parsedType}),Uu}const{status:t,ctx:n}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),r=[];if(!(this._def.catchall instanceof Lm&&"strip"===this._def.unknownKeys))for(const l in n.data)s.includes(l)||r.push(l);const i=[];for(const l of s){const e=a[l],t=n.data[l];i.push({key:{status:"valid",value:l},value:e._parse(new em(n,t,n.path,l)),alwaysSet:l in n.data})}if(this._def.catchall instanceof Lm){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of r)i.push({key:{status:"valid",value:t},value:{status:"valid",value:n.data[t]}});else if("strict"===e)r.length>0&&(Vu(n,{code:Iu.unrecognized_keys,keys:r}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of r){const a=n.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new em(n,a,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(()=>m(this,null,function*(){const e=[];for(const t of i){const n=yield t.key,a=yield t.value;e.push({key:n,value:a,alwaysSet:t.alwaysSet})}return e})).then(e=>qu.mergeObjectSync(t,e)):qu.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return Xu.errToObj,new Ym(o(d(o({},this._def),{unknownKeys:"strict"}),void 0!==e?{errorMap:(t,n)=>{var a,s,r,i;const l=null!=(r=null==(s=(a=this._def).errorMap)?void 0:s.call(a,t,n).message)?r:n.defaultError;return"unrecognized_keys"===t.code?{message:null!=(i=Xu.errToObj(e).message)?i:l}:{message:l}}}:{}))}strip(){return new Ym(d(o({},this._def),{unknownKeys:"strip"}))}passthrough(){return new Ym(d(o({},this._def),{unknownKeys:"passthrough"}))}extend(e){return new Ym(d(o({},this._def),{shape:()=>o(o({},this._def.shape()),e)}))}merge(e){return new Ym({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>o(o({},this._def.shape()),e._def.shape()),typeName:cp.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ym(d(o({},this._def),{catchall:e}))}pick(e){const t={};for(const n of Pu.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new Ym(d(o({},this._def),{shape:()=>t}))}omit(e){const t={};for(const n of Pu.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new Ym(d(o({},this._def),{shape:()=>t}))}deepPartial(){return Bm(this)}partial(e){const t={};for(const n of Pu.objectKeys(this.shape)){const a=this.shape[n];e&&!e[n]?t[n]=a:t[n]=a.optional()}return new Ym(d(o({},this._def),{shape:()=>t}))}required(e){const t={};for(const n of Pu.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof np;)e=e._def.innerType;t[n]=e}return new Ym(d(o({},this._def),{shape:()=>t}))}keyof(){return Qm(Pu.objectKeys(this.shape))}}Ym.create=(e,t)=>new Ym(o({shape:()=>e,unknownKeys:"strip",catchall:Lm.create(),typeName:cp.ZodObject},nm(t))),Ym.strictCreate=(e,t)=>new Ym(o({shape:()=>e,unknownKeys:"strict",catchall:Lm.create(),typeName:cp.ZodObject},nm(t))),Ym.lazycreate=(e,t)=>new Ym(o({shape:e,unknownKeys:"strip",catchall:Lm.create(),typeName:cp.ZodObject},nm(t)));class Vm extends am{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map(e=>m(this,null,function*(){const n=d(o({},t),{common:d(o({},t.common),{issues:[]}),parent:null});return{result:yield e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}}))).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const a of e)if("dirty"===a.result.status)return t.common.issues.push(...a.ctx.common.issues),a.result;const n=e.map(e=>new zu(e.ctx.common.issues));return Vu(t,{code:Iu.invalid_union,unionErrors:n}),Uu});{let e;const a=[];for(const r of n){const n=d(o({},t),{common:d(o({},t.common),{issues:[]}),parent:null}),s=r._parseSync({data:t.data,path:t.path,parent:n});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:n}),n.common.issues.length&&a.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const s=a.map(e=>new zu(e));return Vu(t,{code:Iu.invalid_union,unionErrors:s}),Uu}}get options(){return this._def.options}}function qm(e,t){const n=Lu(e),a=Lu(t);if(e===t)return{valid:!0,data:e};if(n===Mu.object&&a===Mu.object){const n=Pu.objectKeys(t),a=Pu.objectKeys(e).filter(e=>-1!==n.indexOf(e)),s=o(o({},e),t);for(const r of a){const n=qm(e[r],t[r]);if(!n.valid)return{valid:!1};s[r]=n.data}return{valid:!0,data:s}}if(n===Mu.array&&a===Mu.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let a=0;a<e.length;a++){const s=qm(e[a],t[a]);if(!s.valid)return{valid:!1};n.push(s.data)}return{valid:!0,data:n}}return n===Mu.date&&a===Mu.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}Vm.create=(e,t)=>new Vm(o({options:e,typeName:cp.ZodUnion},nm(t)));class Um extends am{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=(e,a)=>{if(Wu(e)||Wu(a))return Uu;const s=qm(e.value,a.value);return s.valid?((Ku(e)||Ku(a))&&t.dirty(),{status:t.value,value:s.data}):(Vu(n,{code:Iu.invalid_intersection_types}),Uu)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Um.create=(e,t,n)=>new Um(o({left:e,right:t,typeName:cp.ZodIntersection},nm(n)));class Hm extends am{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Mu.array)return Vu(n,{code:Iu.invalid_type,expected:Mu.array,received:n.parsedType}),Uu;if(n.data.length<this._def.items.length)return Vu(n,{code:Iu.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Uu;!this._def.rest&&n.data.length>this._def.items.length&&(Vu(n,{code:Iu.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((e,t)=>{const a=this._def.items[t]||this._def.rest;return a?a._parse(new em(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(a).then(e=>qu.mergeArray(t,e)):qu.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new Hm(d(o({},this._def),{rest:e}))}}Hm.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Hm(o({items:e,typeName:cp.ZodTuple,rest:null},nm(t)))};class Gm extends am{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Mu.map)return Vu(n,{code:Iu.invalid_type,expected:Mu.map,received:n.parsedType}),Uu;const a=this._def.keyType,s=this._def.valueType,r=[...n.data.entries()].map(([e,t],r)=>({key:a._parse(new em(n,e,n.path,[r,"key"])),value:s._parse(new em(n,t,n.path,[r,"value"]))}));if(n.common.async){const e=new Map;return Promise.resolve().then(()=>m(this,null,function*(){for(const n of r){const a=yield n.key,s=yield n.value;if("aborted"===a.status||"aborted"===s.status)return Uu;"dirty"!==a.status&&"dirty"!==s.status||t.dirty(),e.set(a.value,s.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const n of r){const a=n.key,s=n.value;if("aborted"===a.status||"aborted"===s.status)return Uu;"dirty"!==a.status&&"dirty"!==s.status||t.dirty(),e.set(a.value,s.value)}return{status:t.value,value:e}}}}Gm.create=(e,t,n)=>new Gm(o({valueType:t,keyType:e,typeName:cp.ZodMap},nm(n)));class Wm extends am{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Mu.set)return Vu(n,{code:Iu.invalid_type,expected:Mu.set,received:n.parsedType}),Uu;const a=this._def;null!==a.minSize&&n.data.size<a.minSize.value&&(Vu(n,{code:Iu.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&n.data.size>a.maxSize.value&&(Vu(n,{code:Iu.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const s=this._def.valueType;function r(e){const n=new Set;for(const a of e){if("aborted"===a.status)return Uu;"dirty"===a.status&&t.dirty(),n.add(a.value)}return{status:t.value,value:n}}const i=[...n.data.values()].map((e,t)=>s._parse(new em(n,e,n.path,t)));return n.common.async?Promise.all(i).then(e=>r(e)):r(i)}min(e,t){return new Wm(d(o({},this._def),{minSize:{value:e,message:Xu.toString(t)}}))}max(e,t){return new Wm(d(o({},this._def),{maxSize:{value:e,message:Xu.toString(t)}}))}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Wm.create=(e,t)=>new Wm(o({valueType:e,minSize:null,maxSize:null,typeName:cp.ZodSet},nm(t)));class Km extends am{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Km.create=(e,t)=>new Km(o({getter:e,typeName:cp.ZodLazy},nm(t)));class Zm extends am{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Vu(t,{received:t.data,code:Iu.invalid_literal,expected:this._def.value}),Uu}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Qm(e,t){return new Xm(o({values:e,typeName:cp.ZodEnum},nm(t)))}Zm.create=(e,t)=>new Zm(o({value:e,typeName:cp.ZodLiteral},nm(t)));class Xm extends am{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return Vu(t,{expected:Pu.joinValues(n),received:t.parsedType,code:Iu.invalid_type}),Uu}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return Vu(t,{received:t.data,code:Iu.invalid_enum_value,options:n}),Uu}return Gu(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Xm.create(e,o(o({},this._def),t))}exclude(e,t=this._def){return Xm.create(this.options.filter(t=>!e.includes(t)),o(o({},this._def),t))}}Xm.create=Qm;class Jm extends am{_parse(e){const t=Pu.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Mu.string&&n.parsedType!==Mu.number){const e=Pu.objectValues(t);return Vu(n,{expected:Pu.joinValues(e),received:n.parsedType,code:Iu.invalid_type}),Uu}if(this._cache||(this._cache=new Set(Pu.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=Pu.objectValues(t);return Vu(n,{received:n.data,code:Iu.invalid_enum_value,options:e}),Uu}return Gu(e.data)}get enum(){return this._def.values}}Jm.create=(e,t)=>new Jm(o({values:e,typeName:cp.ZodNativeEnum},nm(t)));class ep extends am{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Mu.promise&&!1===t.common.async)return Vu(t,{code:Iu.invalid_type,expected:Mu.promise,received:t.parsedType}),Uu;const n=t.parsedType===Mu.promise?t.data:Promise.resolve(t.data);return Gu(n.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ep.create=(e,t)=>new ep(o({type:e,typeName:cp.ZodPromise},nm(t)));class tp extends am{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===cp.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=this._def.effect||null,s={addIssue:e=>{Vu(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===a.type){const e=a.transform(n.data,s);if(n.common.async)return Promise.resolve(e).then(e=>m(this,null,function*(){if("aborted"===t.value)return Uu;const a=yield this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===a.status?Uu:"dirty"===a.status||"dirty"===t.value?Hu(a.value):a}));{if("aborted"===t.value)return Uu;const a=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===a.status?Uu:"dirty"===a.status||"dirty"===t.value?Hu(a.value):a}}if("refinement"===a.type){const e=e=>{const t=a.refinement(e,s);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===a.status?Uu:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>"aborted"===n.status?Uu:("dirty"===n.status&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if("transform"===a.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Zu(e))return Uu;const r=a.transform(e.value,s);if(r instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:r}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>Zu(e)?Promise.resolve(a.transform(e.value,s)).then(e=>({status:t.value,value:e})):Uu)}Pu.assertNever(a)}}tp.create=(e,t,n)=>new tp(o({schema:e,typeName:cp.ZodEffects,effect:t},nm(n))),tp.createWithPreprocess=(e,t,n)=>new tp(o({schema:t,effect:{type:"preprocess",transform:e},typeName:cp.ZodEffects},nm(n)));class np extends am{_parse(e){return this._getType(e)===Mu.undefined?Gu(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}np.create=(e,t)=>new np(o({innerType:e,typeName:cp.ZodOptional},nm(t)));class ap extends am{_parse(e){return this._getType(e)===Mu.null?Gu(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ap.create=(e,t)=>new ap(o({innerType:e,typeName:cp.ZodNullable},nm(t)));class sp extends am{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===Mu.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}sp.create=(e,t)=>new sp(o({innerType:e,typeName:cp.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default},nm(t)));class rp extends am{_parse(e){const{ctx:t}=this._processInputParams(e),n=d(o({},t),{common:d(o({},t.common),{issues:[]})}),a=this._def.innerType._parse({data:n.data,path:n.path,parent:o({},n)});return Qu(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new zu(n.common.issues)},input:n.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new zu(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}rp.create=(e,t)=>new rp(o({innerType:e,typeName:cp.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch},nm(t)));class ip extends am{_parse(e){if(this._getType(e)!==Mu.nan){const t=this._getOrReturnCtx(e);return Vu(t,{code:Iu.invalid_type,expected:Mu.nan,received:t.parsedType}),Uu}return{status:"valid",value:e.data}}}ip.create=e=>new ip(o({typeName:cp.ZodNaN},nm(e)));class lp extends am{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class op extends am{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async){return(()=>m(this,null,function*(){const e=yield this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Uu:"dirty"===e.status?(t.dirty(),Hu(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})}))()}{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Uu:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new op({in:e,out:t,typeName:cp.ZodPipeline})}}class dp extends am{_parse(e){const t=this._def.innerType._parse(e),n=e=>(Zu(e)&&(e.value=Object.freeze(e.value)),e);return Qu(t)?t.then(e=>n(e)):n(t)}unwrap(){return this._def.innerType}}var cp,up;dp.create=(e,t)=>new dp(o({innerType:e,typeName:cp.ZodReadonly},nm(t))),Ym.lazycreate,(up=cp||(cp={})).ZodString="ZodString",up.ZodNumber="ZodNumber",up.ZodNaN="ZodNaN",up.ZodBigInt="ZodBigInt",up.ZodBoolean="ZodBoolean",up.ZodDate="ZodDate",up.ZodSymbol="ZodSymbol",up.ZodUndefined="ZodUndefined",up.ZodNull="ZodNull",up.ZodAny="ZodAny",up.ZodUnknown="ZodUnknown",up.ZodNever="ZodNever",up.ZodVoid="ZodVoid",up.ZodArray="ZodArray",up.ZodObject="ZodObject",up.ZodUnion="ZodUnion",up.ZodDiscriminatedUnion="ZodDiscriminatedUnion",up.ZodIntersection="ZodIntersection",up.ZodTuple="ZodTuple",up.ZodRecord="ZodRecord",up.ZodMap="ZodMap",up.ZodSet="ZodSet",up.ZodFunction="ZodFunction",up.ZodLazy="ZodLazy",up.ZodLiteral="ZodLiteral",up.ZodEnum="ZodEnum",up.ZodEffects="ZodEffects",up.ZodNativeEnum="ZodNativeEnum",up.ZodOptional="ZodOptional",up.ZodNullable="ZodNullable",up.ZodDefault="ZodDefault",up.ZodCatch="ZodCatch",up.ZodPromise="ZodPromise",up.ZodBranded="ZodBranded",up.ZodPipeline="ZodPipeline",up.ZodReadonly="ZodReadonly";const mp=Dm.create,pp=Cm.create;Lm.create,zm.create;const hp=Ym.create;Ym.strictCreate,Vm.create,Um.create,Hm.create,Xm.create,ep.create,np.create,ap.create;const xp=e=>{const t=e,{children:n}=t,a=c(t,["children"]);return ye.createElement(is.Provider,{value:a},n)},gp=ve.createContext({}),fp=e=>{var t=c(e,[]);return p.jsx(gp.Provider,{value:{name:t.name},children:p.jsx(ps,o({},t))})},vp=()=>{const e=ve.useContext(gp),t=ve.useContext(yp),{getFieldState:n,formState:a}=ls(),s=n(e.name,a);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:r}=t;return o({id:r,name:e.name,formItemId:`${r}-form-item`,formDescriptionId:`${r}-form-item-description`,formMessageId:`${r}-form-item-message`},s)},yp=ve.createContext({}),bp=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);const r=ve.useId();return p.jsx(yp.Provider,{value:{id:r},children:p.jsx("div",o({ref:t,className:aa("space-y-2",a)},s))})});bp.displayName="FormItem";const jp=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);const{error:r,formItemId:i}=vp();return p.jsx(Ro,o({ref:t,className:aa(r&&"text-destructive",a),htmlFor:i},s))});jp.displayName="FormLabel";const wp=ve.forwardRef((e,t)=>{var n=c(e,[]);const{error:a,formItemId:s,formDescriptionId:r,formMessageId:i}=vp();return p.jsx(j,o({ref:t,id:s,"aria-describedby":a?`${r} ${i}`:`${r}`,"aria-invalid":!!a},n))});wp.displayName="FormControl";ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);const{formDescriptionId:r}=vp();return p.jsx("p",o({ref:t,id:r,className:aa("text-[0.8rem] text-muted-foreground",a)},s))}).displayName="FormDescription";const Np=ve.forwardRef((e,t)=>{var n,a=e,{className:s,children:r}=a,i=c(a,["className","children"]);const{error:l,formMessageId:u}=vp(),m=l?String(null!=(n=null==l?void 0:l.message)?n:""):r;return m?p.jsx("p",d(o({ref:t,id:u,className:aa("text-[0.8rem] font-medium text-destructive",s)},i),{children:m})):null});Np.displayName="FormMessage";const _p=hp({name:mp().min(1,"اسم العنصر مطلوب"),description:mp().optional(),category:mp().min(1,"الفئة مطلوبة"),quantity:pp().min(0,"الكمية يجب أن تكون صفر أو أكثر"),unit:mp().optional(),cost_per_unit:pp().min(0,"التكلفة يجب أن تكون صفر أو أكثر").optional(),supplier:mp().optional(),expiry_date:mp().optional(),minimum_stock:pp().min(0,"الحد الأدنى يجب أن يكون صفر أو أكثر")}),kp=["أدوات طبية","مواد استهلاكية","أدوية","مواد حشو","معدات تعقيم","مواد تجميل","أدوات جراحة","مواد تنظيف","معدات تشخيص","مواد وقاية"],Sp=["قطعة","علبة","زجاجة","أنبوب","كيس","لتر","مل","جرام","كيلو","متر"];function Dp({isOpen:e,onClose:t,onSave:n,categories:a,suppliers:s}){const{toast:r}=yl(),[i,l]=ve.useState(!1),[c,u]=ve.useState(""),[h,x]=ve.useState(""),g=Js({resolver:Fu(_p),defaultValues:{name:"",description:"",category:"",quantity:0,unit:"",cost_per_unit:0,supplier:"",expiry_date:"",minimum_stock:0}}),f=()=>{g.reset(),u(""),x(""),t()},v=[...new Set([...kp,...a])],y=[...new Set(s)];return p.jsx(Ii,{open:e,onOpenChange:f,children:p.jsxs(Yi,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsx(Ui,{className:"text-xl font-bold text-foreground",children:"إضافة عنصر مخزون جديد"}),p.jsx(Hi,{children:"أدخل تفاصيل العنصر الجديد في المخزون"})]}),p.jsx(xp,d(o({},g),{children:p.jsxs("form",{onSubmit:g.handleSubmit(e=>m(this,null,function*(){l(!0);try{const a=d(o({},e),{category:c||e.category,supplier:h||e.supplier});yield n(a),g.reset(),u(""),x(""),t(),r({title:"نجح",description:"تم إضافة العنصر بنجاح"})}catch(a){console.error("Error adding inventory item:",a),r({title:"خطأ",description:"فشل في إضافة العنصر. يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{l(!1)}})),className:"space-y-4",children:[p.jsx(fp,{control:g.control,name:"name",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"اسم العنصر *"}),p.jsx(wp,{children:p.jsx(Xi,d(o({placeholder:"مثال: قفازات طبية"},e),{className:"text-right"}))}),p.jsx(Np,{})]})}),p.jsx(fp,{control:g.control,name:"description",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"الوصف"}),p.jsx(wp,{children:p.jsx(Ji,d(o({placeholder:"وصف مختصر للعنصر..."},e),{className:"text-right resize-none",rows:2}))}),p.jsx(Np,{})]})}),p.jsx(fp,{control:g.control,name:"category",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"الفئة *"}),p.jsxs(el,{onValueChange:e.onChange,value:e.value,children:[p.jsx(wp,{children:p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر الفئة"})})}),p.jsxs(il,{children:[v.map(e=>p.jsx(dl,{value:e,children:e},e)),p.jsx(dl,{value:"custom",children:"فئة جديدة..."})]})]}),"custom"===e.value&&p.jsx(Xi,{placeholder:"أدخل اسم الفئة الجديدة",value:c,onChange:e=>u(e.target.value),className:"mt-2 text-right"}),p.jsx(Np,{})]})}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsx(fp,{control:g.control,name:"quantity",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"الكمية *"}),p.jsx(wp,{children:p.jsx(Xi,d(o({type:"number",min:"0",placeholder:"0"},e),{onChange:t=>{const n=t.target.value;e.onChange(""===n?0:Number(n))},onBlur:t=>{const n=Number(t.target.value)||0;e.onChange(n)},className:"text-right"}))}),p.jsx(Np,{})]})}),p.jsx(fp,{control:g.control,name:"unit",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"الوحدة"}),p.jsxs(el,{onValueChange:e.onChange,value:e.value,children:[p.jsx(wp,{children:p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر الوحدة"})})}),p.jsx(il,{children:Sp.map(e=>p.jsx(dl,{value:e,children:e},e))})]}),p.jsx(Np,{})]})})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsx(fp,{control:g.control,name:"cost_per_unit",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"تكلفة الوحدة "}),p.jsx(wp,{children:p.jsx(Xi,d(o({type:"number",min:"0",step:"1",placeholder:"0.00"},e),{onChange:t=>{const n=t.target.value;e.onChange(""===n?0:Number(n))},onBlur:t=>{const n=Number(t.target.value)||0;e.onChange(n)},className:"text-right"}))}),p.jsx(Np,{})]})}),p.jsx(fp,{control:g.control,name:"minimum_stock",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"الحد الأدنى *"}),p.jsx(wp,{children:p.jsx(Xi,d(o({type:"number",min:"0",placeholder:"0"},e),{onChange:t=>e.onChange(Number(t.target.value)),className:"text-right"}))}),p.jsx(Np,{})]})})]}),p.jsx(fp,{control:g.control,name:"supplier",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"المورد"}),p.jsxs(el,{onValueChange:e.onChange,value:e.value,children:[p.jsx(wp,{children:p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر المورد"})})}),p.jsxs(il,{children:[y.map(e=>p.jsx(dl,{value:e,children:e},e)),p.jsx(dl,{value:"custom",children:"مورد جديد..."})]})]}),"custom"===e.value&&p.jsx(Xi,{placeholder:"أدخل اسم المورد الجديد",value:h,onChange:e=>x(e.target.value),className:"mt-2 text-right"}),p.jsx(Np,{})]})}),p.jsx(fp,{control:g.control,name:"expiry_date",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"تاريخ انتهاء الصلاحية"}),p.jsx(wp,{children:p.jsx(Xi,d(o({type:"date"},e),{className:"text-right"}))}),p.jsx(Np,{})]})}),p.jsxs(qi,{className:"gap-2",children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:f,disabled:i,children:"إلغاء"}),p.jsxs(Qi,{type:"submit",disabled:i,children:[i&&p.jsx(Hr,{className:"mr-2 h-4 w-4 animate-spin"}),"إضافة العنصر"]})]})]})}))]})})}const $p=hp({name:mp().min(1,"اسم العنصر مطلوب"),description:mp().optional(),category:mp().min(1,"الفئة مطلوبة"),quantity:pp().min(0,"الكمية يجب أن تكون صفر أو أكثر"),unit:mp().optional(),cost_per_unit:pp().min(0,"التكلفة يجب أن تكون صفر أو أكثر").optional(),supplier:mp().optional(),expiry_date:mp().optional(),minimum_stock:pp().min(0,"الحد الأدنى يجب أن يكون صفر أو أكثر")}),Cp=["أدوات طبية","مواد استهلاكية","أدوية","مواد حشو","معدات تعقيم","مواد تجميل","أدوات جراحة","مواد تنظيف","معدات تشخيص","مواد وقاية"],Ep=["قطعة","علبة","زجاجة","أنبوب","كيس","لتر","مل","جرام","كيلو","متر"];function Tp({isOpen:e,onClose:t,onSave:n,item:a,categories:s,suppliers:r}){const{toast:i}=yl(),[l,c]=ve.useState(!1),[u,h]=ve.useState(""),[x,g]=ve.useState(""),f=Js({resolver:Fu($p),defaultValues:{name:"",description:"",category:"",quantity:0,unit:"",cost_per_unit:0,supplier:"",expiry_date:"",minimum_stock:0}});ve.useEffect(()=>{a&&e&&(f.reset({name:a.name||"",description:a.description||"",category:a.category||"",quantity:a.quantity||0,unit:a.unit||"",cost_per_unit:a.cost_per_unit||0,supplier:a.supplier||"",expiry_date:a.expiry_date||"",minimum_stock:a.minimum_stock||0}),h(""),g(""))},[a,e,f]);const v=()=>{f.reset(),h(""),g(""),t()},y=[...new Set([...Cp,...s])],b=[...new Set(r)];return a?p.jsx(Ii,{open:e,onOpenChange:v,children:p.jsxs(Yi,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[p.jsxs(Vi,{children:[p.jsx(Ui,{className:"text-xl font-bold text-foreground",children:"تعديل عنصر المخزون"}),p.jsxs(Hi,{children:["تعديل تفاصيل العنصر: ",a.name]})]}),p.jsx(xp,d(o({},f),{children:p.jsxs("form",{onSubmit:f.handleSubmit(e=>m(this,null,function*(){if(a){c(!0);try{const s=d(o({},e),{category:u||e.category,supplier:x||e.supplier});yield n(a.id,s),t(),i({title:"نجح",description:"تم تحديث العنصر بنجاح"})}catch(s){console.error("Error updating inventory item:",s),i({title:"خطأ",description:"فشل في تحديث العنصر. يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{c(!1)}}})),className:"space-y-4",children:[p.jsx(fp,{control:f.control,name:"name",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"اسم العنصر *"}),p.jsx(wp,{children:p.jsx(Xi,d(o({placeholder:"مثال: قفازات طبية"},e),{className:"text-right"}))}),p.jsx(Np,{})]})}),p.jsx(fp,{control:f.control,name:"description",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"الوصف"}),p.jsx(wp,{children:p.jsx(Ji,d(o({placeholder:"وصف مختصر للعنصر..."},e),{className:"text-right resize-none",rows:2}))}),p.jsx(Np,{})]})}),p.jsx(fp,{control:f.control,name:"category",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"الفئة *"}),p.jsxs(el,{onValueChange:e.onChange,value:e.value,children:[p.jsx(wp,{children:p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر الفئة"})})}),p.jsxs(il,{children:[y.map(e=>p.jsx(dl,{value:e,children:e},e)),p.jsx(dl,{value:"custom",children:"فئة جديدة..."})]})]}),"custom"===e.value&&p.jsx(Xi,{placeholder:"أدخل اسم الفئة الجديدة",value:u,onChange:e=>h(e.target.value),className:"mt-2 text-right"}),p.jsx(Np,{})]})}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsx(fp,{control:f.control,name:"quantity",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"الكمية *"}),p.jsx(wp,{children:p.jsx(Xi,d(o({type:"number",min:"0",placeholder:"0"},e),{onChange:t=>{const n=t.target.value;e.onChange(""===n?0:Number(n))},onBlur:t=>{const n=Number(t.target.value)||0;e.onChange(n)},className:"text-right"}))}),p.jsx(Np,{})]})}),p.jsx(fp,{control:f.control,name:"unit",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"الوحدة"}),p.jsxs(el,{onValueChange:e.onChange,value:e.value,children:[p.jsx(wp,{children:p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر الوحدة"})})}),p.jsx(il,{children:Ep.map(e=>p.jsx(dl,{value:e,children:e},e))})]}),p.jsx(Np,{})]})})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsx(fp,{control:f.control,name:"cost_per_unit",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"تكلفة الوحدة"}),p.jsx(wp,{children:p.jsx(Xi,d(o({type:"number",min:"0",step:"1",placeholder:"0.00"},e),{onChange:t=>{const n=t.target.value;e.onChange(""===n?0:Number(n))},onBlur:t=>{const n=Number(t.target.value)||0;e.onChange(n)},className:"text-right"}))}),p.jsx(Np,{})]})}),p.jsx(fp,{control:f.control,name:"minimum_stock",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"الحد الأدنى *"}),p.jsx(wp,{children:p.jsx(Xi,d(o({type:"number",min:"0",placeholder:"0"},e),{onChange:t=>e.onChange(Number(t.target.value)),className:"text-right"}))}),p.jsx(Np,{})]})})]}),p.jsx(fp,{control:f.control,name:"supplier",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"المورد"}),p.jsxs(el,{onValueChange:e.onChange,value:e.value,children:[p.jsx(wp,{children:p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر المورد"})})}),p.jsxs(il,{children:[b.map(e=>p.jsx(dl,{value:e,children:e},e)),p.jsx(dl,{value:"custom",children:"مورد جديد..."})]})]}),"custom"===e.value&&p.jsx(Xi,{placeholder:"أدخل اسم المورد الجديد",value:x,onChange:e=>g(e.target.value),className:"mt-2 text-right"}),p.jsx(Np,{})]})}),p.jsx(fp,{control:f.control,name:"expiry_date",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"تاريخ انتهاء الصلاحية"}),p.jsx(wp,{children:p.jsx(Xi,d(o({type:"date"},e),{className:"text-right"}))}),p.jsx(Np,{})]})}),p.jsxs(qi,{className:"gap-2",children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:v,disabled:l,children:"إلغاء"}),p.jsxs(Qi,{type:"submit",disabled:l,children:[l&&p.jsx(Hr,{className:"mr-2 h-4 w-4 animate-spin"}),"حفظ التغييرات"]})]})]})}))]})}):null}function Ap({isOpen:e,onClose:t,onConfirm:n,item:a,isLoading:s=!1}){const{toast:r}=yl(),[i,l]=ve.useState(!1);return a?p.jsx(Gl,{open:e,onOpenChange:t,children:p.jsxs(Zl,{className:"sm:max-w-[425px]",dir:"rtl",children:[p.jsx(Ql,{children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-destructive/10",children:p.jsx(sr,{className:"h-6 w-6 text-destructive"})}),p.jsx("div",{children:p.jsx(Jl,{className:"text-lg font-semibold text-foreground",children:"تأكيد حذف العنصر"})})]})}),p.jsx(eo,{className:"text-right text-muted-foreground",children:"هل أنت متأكد من حذف العنصر التالي من المخزون؟"}),p.jsxs("div",{className:"space-y-3",children:[p.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"font-medium text-foreground",children:a.name}),p.jsx("span",{className:"text-sm text-muted-foreground",children:"الاسم:"})]}),a.category&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-sm",children:a.category}),p.jsx("span",{className:"text-sm text-muted-foreground",children:"الفئة:"})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsxs("span",{className:"text-sm",children:[a.quantity," ",a.unit||"قطعة"]}),p.jsx("span",{className:"text-sm text-muted-foreground",children:"الكمية:"})]}),a.supplier&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-sm",children:a.supplier}),p.jsx("span",{className:"text-sm text-muted-foreground",children:"المورد:"})]})]}),p.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3",children:[p.jsx("p",{className:"text-sm text-destructive font-medium",children:"⚠️ تحذير: هذا الإجراء لا يمكن التراجع عنه"}),p.jsx("p",{className:"text-xs text-destructive/80 mt-1",children:"سيتم حذف العنصر وجميع سجلات الاستخدام المرتبطة به نهائياً"})]})]}),p.jsxs(Xl,{className:"gap-2",children:[p.jsx(no,{onClick:t,disabled:i||s,className:"flex-1",children:"إلغاء"}),p.jsxs(to,{onClick:()=>m(this,null,function*(){if(a){l(!0);try{yield n(a.id),t(),r({title:"نجح",description:"تم حذف العنصر بنجاح"})}catch(e){console.error("Error deleting inventory item:",e),r({title:"خطأ",description:"فشل في حذف العنصر. يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{l(!1)}}}),disabled:i||s,className:"flex-1 bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[(i||s)&&p.jsx(Hr,{className:"mr-2 h-4 w-4 animate-spin"}),"حذف العنصر"]})]})]})}):null}const Fp=hp({quantity_used:pp().min(1,"الكمية المستخدمة يجب أن تكون أكبر من صفر"),appointment_id:mp().optional(),notes:mp().optional(),usage_date:mp().min(1,"تاريخ الاستخدام مطلوب")});function Pp({isOpen:e,onClose:t,onSave:n,item:a,appointments:s}){const{toast:r}=yl(),[i,l]=ve.useState(!1),c=Js({resolver:Fu(Fp),defaultValues:{quantity_used:1,appointment_id:"",notes:"",usage_date:(new Date).toISOString().split("T")[0]}}),u=()=>{c.reset(),t()};if(!a)return null;const h=(new Date).toISOString().split("T")[0],x=s.filter(e=>e.start_time.startsWith(h)),g=a.quantity<=a.minimum_stock,f=0===a.quantity;return p.jsx(Ii,{open:e,onOpenChange:u,children:p.jsxs(Yi,{className:"sm:max-w-[500px]",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsx(Ui,{className:"text-xl font-bold text-foreground",children:"تسجيل استخدام المواد"}),p.jsxs(Hi,{children:["تسجيل استخدام: ",a.name]})]}),p.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"font-medium text-foreground",children:a.name}),p.jsx("span",{className:"text-sm text-muted-foreground",children:"العنصر:"})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsxs("span",{className:"text-sm",children:[a.quantity," ",a.unit||"قطعة"]}),p.jsx("span",{className:"text-sm text-muted-foreground",children:"الكمية المتوفرة:"})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"text-sm",children:a.minimum_stock}),p.jsx("span",{className:"text-sm text-muted-foreground",children:"الحد الأدنى:"})]})]}),f&&p.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(sr,{className:"h-4 w-4 text-destructive"}),p.jsx("p",{className:"text-sm text-destructive font-medium",children:"تحذير: نفد المخزون من هذا العنصر"})]})}),g&&!f&&p.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(sr,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-400"}),p.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 font-medium",children:"تحذير: المخزون منخفض (أقل من الحد الأدنى)"})]})}),p.jsx(xp,d(o({},c),{children:p.jsxs("form",{onSubmit:c.handleSubmit(e=>m(this,null,function*(){if(a)if(e.quantity_used>a.quantity)r({title:"خطأ",description:`الكمية المطلوبة (${e.quantity_used}) أكبر من الكمية المتوفرة (${a.quantity})`,variant:"destructive"});else{l(!0);try{const s={inventory_id:a.id,quantity_used:e.quantity_used,appointment_id:e.appointment_id||void 0,notes:e.notes||void 0,usage_date:e.usage_date};yield n(s),c.reset({quantity_used:1,appointment_id:"",notes:"",usage_date:(new Date).toISOString().split("T")[0]}),t(),r({title:"نجح",description:"تم تسجيل الاستخدام بنجاح"})}catch(s){console.error("Error recording usage:",s),r({title:"خطأ",description:"فشل في تسجيل الاستخدام. يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{l(!1)}}})),className:"space-y-4",children:[p.jsx(fp,{control:c.control,name:"quantity_used",render:({field:e})=>p.jsxs(bp,{children:[p.jsxs(jp,{className:"text-sm font-medium",children:["الكمية المستخدمة * (",a.unit||"قطعة",")"]}),p.jsx(wp,{children:p.jsx(Xi,d(o({type:"number",min:"1",max:a.quantity,placeholder:"1"},e),{onChange:t=>{const n=t.target.value;e.onChange(""===n?1:Number(n))},onBlur:t=>{const n=Number(t.target.value)||1;e.onChange(n)},className:"text-right",disabled:f}))}),p.jsx(Np,{}),e.value>a.quantity&&p.jsxs("p",{className:"text-sm text-destructive",children:["الكمية المطلوبة أكبر من المتوفر (",a.quantity,")"]})]})}),p.jsx(fp,{control:c.control,name:"usage_date",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"تاريخ الاستخدام *"}),p.jsx(wp,{children:p.jsx(Xi,d(o({type:"date"},e),{className:"text-right"}))}),p.jsx(Np,{})]})}),p.jsx(fp,{control:c.control,name:"appointment_id",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"الموعد المرتبط (اختياري)"}),p.jsxs(el,{onValueChange:e.onChange,value:e.value,children:[p.jsx(wp,{children:p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر الموعد"})})}),p.jsxs(il,{children:[p.jsx(dl,{value:"none",children:"بدون موعد محدد"}),x.map(e=>{var t,n;return p.jsxs(dl,{value:e.id,children:[e.title," - ",null==(t=e.patient)?void 0:t.first_name," ",null==(n=e.patient)?void 0:n.last_name]},e.id)}),s.filter(e=>!e.start_time.startsWith(h)).slice(0,10).map(e=>{var t,n;return p.jsxs(dl,{value:e.id,children:[e.title," - ",null==(t=e.patient)?void 0:t.first_name," ",null==(n=e.patient)?void 0:n.last_name,p.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",(()=>{const t=new Date(e.start_time);return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`})(),")"]})]},e.id)})]})]}),p.jsx(Np,{})]})}),p.jsx(fp,{control:c.control,name:"notes",render:({field:e})=>p.jsxs(bp,{children:[p.jsx(jp,{className:"text-sm font-medium",children:"ملاحظات"}),p.jsx(wp,{children:p.jsx(Ji,d(o({placeholder:"ملاحظات حول الاستخدام..."},e),{className:"text-right resize-none",rows:3}))}),p.jsx(Np,{})]})}),p.jsxs(qi,{className:"gap-2",children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:u,disabled:i,children:"إلغاء"}),p.jsxs(Qi,{type:"submit",disabled:i||f||c.watch("quantity_used")>a.quantity,children:[i&&p.jsx(Hr,{className:"mr-2 h-4 w-4 animate-spin"}),"تسجيل الاستخدام"]})]})]})}))]})})}function Op({items:e,onRefresh:t,onItemClick:n}){const[a,s]=ve.useState(!0),[r,i]=ve.useState(!0),[l,o]=ve.useState(!0),d=new Date,c=e.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0),u=e.filter(e=>0===e.quantity),m=e.filter(e=>e.expiry_date&&new Date(e.expiry_date)<d),h=e.filter(e=>{if(!e.expiry_date)return!1;const t=new Date(e.expiry_date),n=Math.ceil((t.getTime()-d.getTime())/864e5);return n<=30&&n>0}),{formatAmount:x}=Sa(),g=e=>{const t=new Date(e);return Math.ceil((t.getTime()-d.getTime())/864e5)},f=({title:e,items:t,icon:a,color:s,isVisible:r,onToggle:i,emptyMessage:l})=>p.jsx(Lo,{className:`border-l-4 ${s}`,children:p.jsxs(Md,{open:r,onOpenChange:i,children:[p.jsx(Io,{className:"pb-3",children:p.jsx(Ld,{asChild:!0,children:p.jsxs("div",{className:"flex items-center justify-between cursor-pointer",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[a,p.jsxs("div",{children:[p.jsx(zo,{className:"text-lg font-semibold",children:e}),p.jsxs(Bo,{children:[t.length," عنصر"]})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(qo,{variant:"secondary",className:"text-sm",children:t.length}),r?p.jsx(Ar,{className:"h-4 w-4"}):p.jsx(Fr,{className:"h-4 w-4"})]})]})})}),p.jsx(Id,{children:p.jsx(Yo,{className:"pt-0",children:0===t.length?p.jsx("p",{className:"text-center text-muted-foreground py-4",children:l}):p.jsx("div",{className:"space-y-3",children:t.map(e=>p.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>null==n?void 0:n(e),children:p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h4",{className:"font-medium text-foreground",children:e.name}),p.jsx("div",{className:"text-left",children:e.category&&p.jsx(qo,{variant:"outline",className:"text-xs",children:e.category})})]}),p.jsxs("div",{className:"flex items-center justify-between mt-1 text-sm text-muted-foreground",children:[p.jsxs("div",{children:["الكمية: ",e.quantity," ",e.unit||"قطعة",e.minimum_stock>0&&p.jsxs("span",{className:"mr-2",children:["(الحد الأدنى: ",e.minimum_stock,")"]})]}),e.expiry_date&&p.jsx("div",{className:"text-left",children:m.includes(e)?p.jsx("span",{className:"text-destructive font-medium",children:"منتهي الصلاحية"}):h.includes(e)?p.jsxs("span",{className:"text-yellow-600 dark:text-yellow-400 font-medium",children:["ينتهي خلال ",g(e.expiry_date)," يوم"]}):p.jsxs("span",{children:["ينتهي: ",(()=>{const t=new Date(e.expiry_date);return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`})()]})})]}),e.cost_per_unit&&p.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["القيمة الإجمالية: ",x(e.quantity*e.cost_per_unit)]})]})},e.id))})})})]})}),v=c.length+u.length+m.length+h.length;return 0===v?p.jsx(Lo,{className:"border-green-200 dark:border-green-800",children:p.jsx(Yo,{className:"p-6",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ti,{className:"h-12 w-12 mx-auto mb-3 text-green-500"}),p.jsx("h3",{className:"text-lg font-semibold text-green-700 dark:text-green-400 mb-2",children:"لا توجد تنبيهات"}),p.jsx("p",{className:"text-green-600 dark:text-green-300",children:"جميع عناصر المخزون في حالة جيدة"}),t&&p.jsxs(Qi,{variant:"outline",size:"sm",onClick:t,className:"mt-3",children:[p.jsx(mi,{className:"h-4 w-4 mr-2"}),"تحديث"]})]})})}):p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"تنبيهات المخزون"}),p.jsxs("p",{className:"text-sm text-muted-foreground",children:[v," تنبيه يتطلب انتباهك"]})]}),t&&p.jsxs(Qi,{variant:"outline",size:"sm",onClick:t,children:[p.jsx(mi,{className:"h-4 w-4 mr-2"}),"تحديث"]})]}),u.length>0&&p.jsx(f,{title:"نفد المخزون",items:u,icon:p.jsx(sr,{className:"h-5 w-5 text-destructive"}),color:"border-l-destructive",isVisible:r,onToggle:()=>i(!r),emptyMessage:"لا توجد عناصر نفد مخزونها"}),c.length>0&&p.jsx(f,{title:"مخزون منخفض",items:c,icon:p.jsx(ti,{className:"h-5 w-5 text-yellow-600"}),color:"border-l-yellow-500",isVisible:a,onToggle:()=>s(!a),emptyMessage:"لا توجد عناصر بمخزون منخفض"}),m.length>0&&p.jsx(f,{title:"منتهية الصلاحية",items:m,icon:p.jsx(hr,{className:"h-5 w-5 text-destructive"}),color:"border-l-destructive",isVisible:r,onToggle:()=>i(!r),emptyMessage:"لا توجد عناصر منتهية الصلاحية"}),h.length>0&&p.jsx(f,{title:"تنتهي صلاحيتها قريباً",items:h,icon:p.jsx(hr,{className:"h-5 w-5 text-yellow-600"}),color:"border-l-yellow-500",isVisible:l,onToggle:()=>o(!l),emptyMessage:"لا توجد عناصر تنتهي صلاحيتها قريباً"})]})}var Rp="ScrollArea",[Mp,Lp]=M(Rp),[Ip,zp]=Mp(Rp),Bp=ve.forwardRef((e,t)=>{const n=e,{__scopeScrollArea:a,type:s="hover",dir:r,scrollHideDelay:i=600}=n,l=c(n,["__scopeScrollArea","type","dir","scrollHideDelay"]),[u,m]=ve.useState(null),[h,x]=ve.useState(null),[g,f]=ve.useState(null),[v,y]=ve.useState(null),[b,j]=ve.useState(null),[w,N]=ve.useState(0),[_,k]=ve.useState(0),[S,D]=ve.useState(!1),[$,C]=ve.useState(!1),E=z(t,e=>m(e)),T=Q(r);return p.jsx(Ip,{scope:a,type:s,dir:T,scrollHideDelay:i,scrollArea:u,viewport:h,onViewportChange:x,content:g,onContentChange:f,scrollbarX:v,onScrollbarXChange:y,scrollbarXEnabled:S,onScrollbarXEnabledChange:D,scrollbarY:b,onScrollbarYChange:j,scrollbarYEnabled:$,onScrollbarYEnabledChange:C,onCornerWidthChange:N,onCornerHeightChange:k,children:p.jsx(q.div,d(o({dir:T},l),{ref:E,style:o({position:"relative","--radix-scroll-area-corner-width":w+"px","--radix-scroll-area-corner-height":_+"px"},e.style)}))})});Bp.displayName=Rp;var Yp="ScrollAreaViewport",Vp=ve.forwardRef((e,t)=>{const n=e,{__scopeScrollArea:a,children:s,nonce:r}=n,i=c(n,["__scopeScrollArea","children","nonce"]),l=zp(Yp,a),u=ve.useRef(null),m=z(t,u,l.onViewportChange);return p.jsxs(p.Fragment,{children:[p.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),p.jsx(q.div,d(o({"data-radix-scroll-area-viewport":""},i),{ref:m,style:o({overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden"},e.style),children:p.jsx("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:s})}))]})});Vp.displayName=Yp;var qp="ScrollAreaScrollbar",Up=ve.forwardRef((e,t)=>{const n=e,{forceMount:a}=n,s=c(n,["forceMount"]),r=zp(qp,e.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:l}=r,u="horizontal"===e.orientation;return ve.useEffect(()=>(u?i(!0):l(!0),()=>{u?i(!1):l(!1)}),[u,i,l]),"hover"===r.type?p.jsx(Hp,d(o({},s),{ref:t,forceMount:a})):"scroll"===r.type?p.jsx(Gp,d(o({},s),{ref:t,forceMount:a})):"auto"===r.type?p.jsx(Wp,d(o({},s),{ref:t,forceMount:a})):"always"===r.type?p.jsx(Kp,d(o({},s),{ref:t})):null});Up.displayName=qp;var Hp=ve.forwardRef((e,t)=>{const n=e,{forceMount:a}=n,s=c(n,["forceMount"]),r=zp(qp,e.__scopeScrollArea),[i,l]=ve.useState(!1);return ve.useEffect(()=>{const e=r.scrollArea;let t=0;if(e){const n=()=>{window.clearTimeout(t),l(!0)},a=()=>{t=window.setTimeout(()=>l(!1),r.scrollHideDelay)};return e.addEventListener("pointerenter",n),e.addEventListener("pointerleave",a),()=>{window.clearTimeout(t),e.removeEventListener("pointerenter",n),e.removeEventListener("pointerleave",a)}}},[r.scrollArea,r.scrollHideDelay]),p.jsx(K,{present:a||i,children:p.jsx(Wp,d(o({"data-state":i?"visible":"hidden"},s),{ref:t}))})}),Gp=ve.forwardRef((e,t)=>{const n=e,{forceMount:a}=n,s=c(n,["forceMount"]),r=zp(qp,e.__scopeScrollArea),i="horizontal"===e.orientation,l=hh(()=>m("SCROLL_END"),100),[u,m]=(h="hidden",x={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},ve.useReducer((e,t)=>{const n=x[e][t];return null!=n?n:e},h));var h,x;return ve.useEffect(()=>{if("idle"===u){const e=window.setTimeout(()=>m("HIDE"),r.scrollHideDelay);return()=>window.clearTimeout(e)}},[u,r.scrollHideDelay,m]),ve.useEffect(()=>{const e=r.viewport,t=i?"scrollLeft":"scrollTop";if(e){let n=e[t];const a=()=>{const a=e[t];n!==a&&(m("SCROLL"),l()),n=a};return e.addEventListener("scroll",a),()=>e.removeEventListener("scroll",a)}},[r.viewport,i,m,l]),p.jsx(K,{present:a||"hidden"!==u,children:p.jsx(Kp,d(o({"data-state":"hidden"===u?"hidden":"visible"},s),{ref:t,onPointerEnter:Y(e.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:Y(e.onPointerLeave,()=>m("POINTER_LEAVE"))}))})}),Wp=ve.forwardRef((e,t)=>{const n=zp(qp,e.__scopeScrollArea),a=e,{forceMount:s}=a,r=c(a,["forceMount"]),[i,l]=ve.useState(!1),u="horizontal"===e.orientation,m=hh(()=>{if(n.viewport){const e=n.viewport.offsetWidth<n.viewport.scrollWidth,t=n.viewport.offsetHeight<n.viewport.scrollHeight;l(u?e:t)}},10);return xh(n.viewport,m),xh(n.content,m),p.jsx(K,{present:s||i,children:p.jsx(Kp,d(o({"data-state":i?"visible":"hidden"},r),{ref:t}))})}),Kp=ve.forwardRef((e,t)=>{const n=e,{orientation:a="vertical"}=n,s=c(n,["orientation"]),r=zp(qp,e.__scopeScrollArea),i=ve.useRef(null),l=ve.useRef(0),[u,m]=ve.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),h=oh(u.viewport,u.content),x=d(o({},s),{sizes:u,onSizesChange:m,hasThumb:Boolean(h>0&&h<1),onThumbChange:e=>i.current=e,onThumbPointerUp:()=>l.current=0,onThumbPointerDown:e=>l.current=e});function g(e,t){return function(e,t,n,a="ltr"){const s=dh(n),r=s/2,i=t||r,l=s-i,o=n.scrollbar.paddingStart+i,d=n.scrollbar.size-n.scrollbar.paddingEnd-l,c=n.content-n.viewport,u="ltr"===a?[0,c]:[-1*c,0];return uh([o,d],u)(e)}(e,l.current,u,t)}return"horizontal"===a?p.jsx(Zp,d(o({},x),{ref:t,onThumbPositionChange:()=>{if(r.viewport&&i.current){const e=ch(r.viewport.scrollLeft,u,r.dir);i.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{r.viewport&&(r.viewport.scrollLeft=e)},onDragScroll:e=>{r.viewport&&(r.viewport.scrollLeft=g(e,r.dir))}})):"vertical"===a?p.jsx(Qp,d(o({},x),{ref:t,onThumbPositionChange:()=>{if(r.viewport&&i.current){const e=ch(r.viewport.scrollTop,u);i.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{r.viewport&&(r.viewport.scrollTop=e)},onDragScroll:e=>{r.viewport&&(r.viewport.scrollTop=g(e))}})):null}),Zp=ve.forwardRef((e,t)=>{const n=e,{sizes:a,onSizesChange:s}=n,r=c(n,["sizes","onSizesChange"]),i=zp(qp,e.__scopeScrollArea),[l,u]=ve.useState(),m=ve.useRef(null),h=z(t,m,i.onScrollbarXChange);return ve.useEffect(()=>{m.current&&u(getComputedStyle(m.current))},[m]),p.jsx(eh,d(o({"data-orientation":"horizontal"},r),{ref:h,sizes:a,style:o({bottom:0,left:"rtl"===i.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===i.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":dh(a)+"px"},e.style),onThumbPointerDown:t=>e.onThumbPointerDown(t.x),onDragScroll:t=>e.onDragScroll(t.x),onWheelScroll:(t,n)=>{if(i.viewport){const a=i.viewport.scrollLeft+t.deltaX;e.onWheelScroll(a),mh(a,n)&&t.preventDefault()}},onResize:()=>{m.current&&i.viewport&&l&&s({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:lh(l.paddingLeft),paddingEnd:lh(l.paddingRight)}})}}))}),Qp=ve.forwardRef((e,t)=>{const n=e,{sizes:a,onSizesChange:s}=n,r=c(n,["sizes","onSizesChange"]),i=zp(qp,e.__scopeScrollArea),[l,u]=ve.useState(),m=ve.useRef(null),h=z(t,m,i.onScrollbarYChange);return ve.useEffect(()=>{m.current&&u(getComputedStyle(m.current))},[m]),p.jsx(eh,d(o({"data-orientation":"vertical"},r),{ref:h,sizes:a,style:o({top:0,right:"ltr"===i.dir?0:void 0,left:"rtl"===i.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":dh(a)+"px"},e.style),onThumbPointerDown:t=>e.onThumbPointerDown(t.y),onDragScroll:t=>e.onDragScroll(t.y),onWheelScroll:(t,n)=>{if(i.viewport){const a=i.viewport.scrollTop+t.deltaY;e.onWheelScroll(a),mh(a,n)&&t.preventDefault()}},onResize:()=>{m.current&&i.viewport&&l&&s({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:lh(l.paddingTop),paddingEnd:lh(l.paddingBottom)}})}}))}),[Xp,Jp]=Mp(qp),eh=ve.forwardRef((e,t)=>{const n=e,{__scopeScrollArea:a,sizes:s,hasThumb:r,onThumbChange:i,onThumbPointerUp:l,onThumbPointerDown:u,onThumbPositionChange:m,onDragScroll:h,onWheelScroll:x,onResize:g}=n,f=c(n,["__scopeScrollArea","sizes","hasThumb","onThumbChange","onThumbPointerUp","onThumbPointerDown","onThumbPositionChange","onDragScroll","onWheelScroll","onResize"]),v=zp(qp,a),[y,b]=ve.useState(null),j=z(t,e=>b(e)),w=ve.useRef(null),N=ve.useRef(""),_=v.viewport,k=s.content-s.viewport,S=U(x),D=U(m),$=hh(g,10);function C(e){if(w.current){const t=e.clientX-w.current.left,n=e.clientY-w.current.top;h({x:t,y:n})}}return ve.useEffect(()=>{const e=e=>{const t=e.target;(null==y?void 0:y.contains(t))&&S(e,k)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[_,y,k,S]),ve.useEffect(D,[s,D]),xh(y,$),xh(v.content,$),p.jsx(Xp,{scope:a,scrollbar:y,hasThumb:r,onThumbChange:U(i),onThumbPointerUp:U(l),onThumbPositionChange:D,onThumbPointerDown:U(u),children:p.jsx(q.div,d(o({},f),{ref:j,style:o({position:"absolute"},f.style),onPointerDown:Y(e.onPointerDown,e=>{if(0===e.button){e.target.setPointerCapture(e.pointerId),w.current=y.getBoundingClientRect(),N.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",v.viewport&&(v.viewport.style.scrollBehavior="auto"),C(e)}}),onPointerMove:Y(e.onPointerMove,C),onPointerUp:Y(e.onPointerUp,e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=N.current,v.viewport&&(v.viewport.style.scrollBehavior=""),w.current=null})}))})}),th="ScrollAreaThumb",nh=ve.forwardRef((e,t)=>{const n=e,{forceMount:a}=n,s=c(n,["forceMount"]),r=Jp(th,e.__scopeScrollArea);return p.jsx(K,{present:a||r.hasThumb,children:p.jsx(ah,o({ref:t},s))})}),ah=ve.forwardRef((e,t)=>{const n=e,{__scopeScrollArea:a,style:s}=n,r=c(n,["__scopeScrollArea","style"]),i=zp(th,a),l=Jp(th,a),{onThumbPositionChange:u}=l,m=z(t,e=>l.onThumbChange(e)),h=ve.useRef(void 0),x=hh(()=>{h.current&&(h.current(),h.current=void 0)},100);return ve.useEffect(()=>{const e=i.viewport;if(e){const t=()=>{if(x(),!h.current){const t=ph(e,u);h.current=t,u()}};return u(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}},[i.viewport,x,u]),p.jsx(q.div,d(o({"data-state":l.hasThumb?"visible":"hidden"},r),{ref:m,style:o({width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)"},s),onPointerDownCapture:Y(e.onPointerDownCapture,e=>{const t=e.target.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top;l.onThumbPointerDown({x:n,y:a})}),onPointerUp:Y(e.onPointerUp,l.onThumbPointerUp)}))});nh.displayName=th;var sh="ScrollAreaCorner",rh=ve.forwardRef((e,t)=>{const n=zp(sh,e.__scopeScrollArea),a=Boolean(n.scrollbarX&&n.scrollbarY);return"scroll"!==n.type&&a?p.jsx(ih,d(o({},e),{ref:t})):null});rh.displayName=sh;var ih=ve.forwardRef((e,t)=>{const n=e,{__scopeScrollArea:a}=n,s=c(n,["__scopeScrollArea"]),r=zp(sh,a),[i,l]=ve.useState(0),[u,m]=ve.useState(0),h=Boolean(i&&u);return xh(r.scrollbarX,()=>{var e;const t=(null==(e=r.scrollbarX)?void 0:e.offsetHeight)||0;r.onCornerHeightChange(t),m(t)}),xh(r.scrollbarY,()=>{var e;const t=(null==(e=r.scrollbarY)?void 0:e.offsetWidth)||0;r.onCornerWidthChange(t),l(t)}),h?p.jsx(q.div,d(o({},s),{ref:t,style:o({width:i,height:u,position:"absolute",right:"ltr"===r.dir?0:void 0,left:"rtl"===r.dir?0:void 0,bottom:0},e.style)})):null});function lh(e){return e?parseInt(e,10):0}function oh(e,t){const n=e/t;return isNaN(n)?0:n}function dh(e){const t=oh(e.viewport,e.content),n=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=(e.scrollbar.size-n)*t;return Math.max(a,18)}function ch(e,t,n="ltr"){const a=dh(t),s=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,r=t.scrollbar.size-s,i=t.content-t.viewport,l=r-a,o=X(e,"ltr"===n?[0,i]:[-1*i,0]);return uh([0,i],[0,l])(o)}function uh(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const a=(t[1]-t[0])/(e[1]-e[0]);return t[0]+a*(n-e[0])}}function mh(e,t){return e>0&&e<t}var ph=(e,t=()=>{})=>{let n={left:e.scrollLeft,top:e.scrollTop},a=0;return function s(){const r={left:e.scrollLeft,top:e.scrollTop},i=n.left!==r.left,l=n.top!==r.top;(i||l)&&t(),n=r,a=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(a)};function hh(e,t){const n=U(e),a=ve.useRef(0);return ve.useEffect(()=>()=>window.clearTimeout(a.current),[]),ve.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(n,t)},[n,t])}function xh(e,t){const n=U(t);H(()=>{let t=0;if(e){const a=new ResizeObserver(()=>{cancelAnimationFrame(t),t=window.requestAnimationFrame(n)});return a.observe(e),()=>{window.cancelAnimationFrame(t),a.unobserve(e)}}},[e,n])}var gh=Bp,fh=Vp,vh=rh;const yh=ve.forwardRef((e,t)=>{var n=e,{className:a,children:s}=n,r=c(n,["className","children"]);return p.jsxs(gh,d(o({ref:t,className:aa("relative overflow-hidden",a)},r),{children:[p.jsx(fh,{className:"h-full w-full rounded-[inherit]",children:s}),p.jsx(bh,{}),p.jsx(vh,{})]}))});yh.displayName=gh.displayName;const bh=ve.forwardRef((e,t)=>{var n=e,{className:a,orientation:s="vertical"}=n,r=c(n,["className","orientation"]);return p.jsx(Up,d(o({ref:t,orientation:s,className:aa("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a)},r),{children:p.jsx(nh,{className:"relative flex-1 rounded-full bg-border"})}))});function jh({isOpen:e,onClose:t,item:n}){const[a,s]=ve.useState([]),[r,i]=ve.useState(!1),{getUsageHistory:l}=jd();ve.useEffect(()=>{n&&e&&o()},[n,e]);const o=()=>m(this,null,function*(){if(n){i(!0);try{const e=l(n.id);s(e)}catch(e){console.error("Error loading usage history:",e)}finally{i(!1)}}}),d=e=>{const t=new Date(e),n=t.getDate(),a=t.getMonth()+1,s=t.getFullYear(),r=t.getHours(),i=t.getMinutes();return`${n.toString().padStart(2,"0")}/${a.toString().padStart(2,"0")}/${s} ${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},c=()=>a.reduce((e,t)=>e+t.quantity_used,0);return n?p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"sm:max-w-[700px] max-h-[80vh]",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"text-xl font-bold text-foreground flex items-center gap-2",children:[p.jsx(nr,{className:"h-5 w-5"}),"تاريخ الاستخدام"]}),p.jsxs(Hi,{children:["تاريخ استخدام: ",n.name]})]}),p.jsxs(Lo,{children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"text-lg flex items-center gap-2",children:[p.jsx(ti,{className:"h-4 w-4"}),"معلومات العنصر"]})}),p.jsx(Yo,{children:p.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-muted-foreground",children:"الكمية الحالية"}),p.jsxs("p",{className:"font-medium",children:[n.quantity," ",n.unit||"قطعة"]})]}),p.jsxs("div",{children:[p.jsx("p",{className:"text-muted-foreground",children:"إجمالي المستخدم"}),p.jsxs("p",{className:"font-medium",children:[c()," ",n.unit||"قطعة"]})]}),p.jsxs("div",{children:[p.jsx("p",{className:"text-muted-foreground",children:"عدد مرات الاستخدام"}),p.jsx("p",{className:"font-medium",children:a.length})]}),p.jsxs("div",{children:[p.jsx("p",{className:"text-muted-foreground",children:"الفئة"}),p.jsx("p",{className:"font-medium",children:n.category||"غير محدد"})]})]})})]}),p.jsxs(Lo,{className:"flex-1",children:[p.jsxs(Io,{className:"pb-3",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs(zo,{className:"text-lg flex items-center gap-2",children:[p.jsx(hr,{className:"h-4 w-4"}),"سجل الاستخدام"]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:o,disabled:r,children:[p.jsx(mi,{className:"h-4 w-4 mr-2 "+(r?"animate-spin":"")}),"تحديث"]})]}),p.jsxs(Bo,{children:[a.length," سجل استخدام"]})]}),p.jsx(Yo,{children:p.jsx(yh,{className:"h-[300px] w-full",children:r?p.jsxs("div",{className:"text-center py-8",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),p.jsx("p",{className:"mt-2 text-muted-foreground",children:"جاري التحميل..."})]}):0===a.length?p.jsxs("div",{className:"text-center py-8",children:[p.jsx(nr,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground opacity-50"}),p.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا يوجد سجل استخدام"}),p.jsx("p",{className:"text-muted-foreground",children:"لم يتم تسجيل أي استخدام لهذا العنصر بعد"})]}):p.jsx("div",{className:"space-y-3",children:a.map((e,t)=>p.jsxs("div",{className:"flex items-start gap-3 p-4 bg-muted/30 rounded-lg",children:[p.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:p.jsx(nr,{className:"h-4 w-4 text-primary"})}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("div",{className:"flex items-center justify-between mb-2",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(qo,{variant:"secondary",className:"text-xs",children:[e.quantity_used," ",n.unit||"قطعة"]}),p.jsx("span",{className:"text-sm text-muted-foreground",children:d(e.usage_date)})]})}),e.appointment_id&&p.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mb-1",children:[p.jsx(Ai,{className:"h-3 w-3"}),p.jsx("span",{children:"مرتبط بموعد"})]}),e.notes&&p.jsxs("div",{className:"flex items-start gap-1 text-sm",children:[p.jsx(Pr,{className:"h-3 w-3 mt-0.5 text-muted-foreground"}),p.jsx("p",{className:"text-muted-foreground",children:e.notes})]})]})]},e.id||t))})})})]}),a.length>0&&p.jsx(Lo,{children:p.jsx(Yo,{className:"pt-6",children:p.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-2xl font-bold text-primary",children:c()}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المستخدم"})]}),p.jsxs("div",{children:[p.jsx("p",{className:"text-2xl font-bold text-primary",children:a.length}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"مرات الاستخدام"})]}),p.jsxs("div",{children:[p.jsx("p",{className:"text-2xl font-bold text-primary",children:a.length>0?Math.round(c()/a.length*10)/10:0}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"متوسط الاستخدام"})]})]})})})]})}):null}function wh({items:e,isLoading:t,onEdit:n,onDelete:a,onViewDetails:s}){yl();const{formatAmount:r}=Sa(),[i,l]=ve.useState("name"),[c,u]=ve.useState("asc"),[m,h]=ve.useState(1),[x,g]=ve.useState(10),[f,v]=ve.useState(""),[y,b]=ve.useState("all"),[j,w]=ve.useState("all"),N=ve.useMemo(()=>[...new Set(e.map(e=>e.category).filter(Boolean))].sort(),[e]),_=ve.useMemo(()=>{const t=new Date;let n=e.map(e=>{const n=(e.quantity||0)*(e.cost_per_unit||0),a=e.quantity<=e.minimum_stock,s=e.expiry_date&&new Date(e.expiry_date)<t,r=e.expiry_date&&!s&&new Date(e.expiry_date)<=new Date(t.getTime()+2592e6);let i="normal";return 0===e.quantity?i="out_of_stock":s?i="expired":r?i="expiring_soon":a&&(i="low_stock"),d(o({},e),{total_value:n,status:i,isLowStock:a,isExpired:s,isExpiringSoon:r})});if(f.trim()){const e=f.toLowerCase();n=n.filter(t=>{var n,a,s;return t.name.toLowerCase().includes(e)||(null==(n=t.description)?void 0:n.toLowerCase().includes(e))||(null==(a=t.category)?void 0:a.toLowerCase().includes(e))||(null==(s=t.supplier)?void 0:s.toLowerCase().includes(e))})}return"all"!==y&&(n=n.filter(e=>e.category===y)),"all"!==j&&(n=n.filter(e=>e.status===j)),n},[e,f,y,j]),k=ve.useMemo(()=>[..._].sort((e,t)=>{var n,a;let s,r;switch(i){case"name":s=e.name.toLowerCase(),r=t.name.toLowerCase();break;case"category":s=(null==(n=e.category)?void 0:n.toLowerCase())||"",r=(null==(a=t.category)?void 0:a.toLowerCase())||"";break;case"quantity":s=e.quantity,r=t.quantity;break;case"cost_per_unit":s=e.cost_per_unit||0,r=t.cost_per_unit||0;break;case"total_value":s=e.total_value,r=t.total_value;break;case"expiry_date":s=e.expiry_date?new Date(e.expiry_date):new Date("9999-12-31"),r=t.expiry_date?new Date(t.expiry_date):new Date("9999-12-31");break;default:return 0}return s<r?"asc"===c?-1:1:s>r?"asc"===c?1:-1:0}),[_,i,c]),S=Math.ceil(k.length/x),D=(m-1)*x,$=k.slice(D,D+x),C=e=>{h(Math.max(1,Math.min(e,S)))};ye.useEffect(()=>{h(1)},[f,y,j]);const E=({field:e,children:t})=>p.jsx(tc,{className:"cursor-pointer hover:bg-muted/50 select-none text-center",onClick:()=>(e=>{i===e?u("asc"===c?"desc":"asc"):(l(e),u("asc"))})(e),children:p.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[t,i===e?"asc"===c?p.jsx(or,{className:"w-4 h-4"}):p.jsx(rr,{className:"w-4 h-4"}):p.jsx(lr,{className:"w-4 h-4 opacity-50"})]})}),T=e=>{switch(e.status){case"out_of_stock":return p.jsxs(qo,{variant:"destructive",className:"arabic-enhanced",children:[p.jsx(sr,{className:"w-3 h-3 mr-1"}),"نفد المخزون"]});case"expired":return p.jsxs(qo,{variant:"destructive",className:"arabic-enhanced",children:[p.jsx(Sr,{className:"w-3 h-3 mr-1"}),"منتهي الصلاحية"]});case"expiring_soon":return p.jsxs(qo,{variant:"secondary",className:"arabic-enhanced",children:[p.jsx(Sr,{className:"w-3 h-3 mr-1"}),"ينتهي قريباً"]});case"low_stock":return p.jsxs(qo,{variant:"outline",className:"arabic-enhanced border-yellow-500 text-yellow-700",children:[p.jsx(sr,{className:"w-3 h-3 mr-1"}),"مخزون منخفض"]});default:return p.jsxs(qo,{variant:"outline",className:"arabic-enhanced border-green-500 text-green-700",children:[p.jsx(gr,{className:"w-3 h-3 mr-1"}),"طبيعي"]})}};return t?p.jsx("div",{className:"border rounded-lg",dir:"rtl",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{className:"bg-muted/50",children:[p.jsx(tc,{className:"text-center",children:"#"}),p.jsx(tc,{className:"text-center",children:"اسم العنصر"}),p.jsx(tc,{className:"text-center",children:"الفئة"}),p.jsx(tc,{className:"text-center",children:"الكمية"}),p.jsx(tc,{className:"text-center",children:"سعر الوحدة"}),p.jsx(tc,{className:"text-center",children:"القيمة الإجمالية"}),p.jsx(tc,{className:"text-center",children:"الحالة"}),p.jsx(tc,{className:"text-center",children:"الاجراءات"})]})}),p.jsx(Jd,{children:[...Array(5)].map((e,t)=>p.jsx(ec,{children:[...Array(8)].map((e,t)=>p.jsx(nc,{children:p.jsx("div",{className:"h-4 bg-muted animate-pulse rounded"})},t))},t))})]})}):0===e.length?p.jsx("div",{className:"border rounded-lg",dir:"rtl",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{className:"bg-muted/50",children:[p.jsx(tc,{className:"text-center",children:"#"}),p.jsx(tc,{className:"text-center",children:"اسم العنصر"}),p.jsx(tc,{className:"text-center",children:"الفئة"}),p.jsx(tc,{className:"text-center",children:"الكمية"}),p.jsx(tc,{className:"text-center",children:"سعر الوحدة"}),p.jsx(tc,{className:"text-center",children:"القيمة الإجمالية"}),p.jsx(tc,{className:"text-center",children:"الحالة"}),p.jsx(tc,{className:"text-center",children:"الاجراءات"})]})}),p.jsx(Jd,{children:p.jsx(ec,{children:p.jsx(nc,{colSpan:8,className:"text-center py-8",children:p.jsxs("div",{className:"flex flex-col items-center gap-2",children:[p.jsx(ti,{className:"w-12 h-12 text-muted-foreground opacity-50"}),p.jsx("p",{className:"text-muted-foreground arabic-enhanced",children:"لا توجد عناصر مخزون"})]})})})})]})}):p.jsxs("div",{className:"space-y-4",dir:"rtl",children:[p.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[p.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 flex-1 items-start sm:items-center",children:[p.jsxs("div",{className:"relative flex-1 max-w-sm order-1",children:[p.jsx(hi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{placeholder:"البحث في المخزون...",value:f,onChange:e=>v(e.target.value),className:"pl-10 arabic-enhanced text-right border-2 focus:border-primary/50 transition-colors"})]}),p.jsxs(el,{value:j,onValueChange:w,children:[p.jsxs(al,{className:"w-[200px] order-2 border-2 focus:border-primary/50 transition-colors",children:[p.jsx(Or,{className:"w-4 h-4 mr-2 text-orange-500"}),p.jsx(nl,{placeholder:"تصفية حسب الحالة"})]}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الحالات"}),p.jsx(dl,{value:"normal",children:"طبيعي"}),p.jsx(dl,{value:"low_stock",children:"مخزون منخفض"}),p.jsx(dl,{value:"out_of_stock",children:"نفد المخزون"}),p.jsx(dl,{value:"expiring_soon",children:"ينتهي قريباً"}),p.jsx(dl,{value:"expired",children:"منتهي الصلاحية"})]})]}),p.jsxs(el,{value:y,onValueChange:b,children:[p.jsxs(al,{className:"w-[200px] order-3 border-2 focus:border-primary/50 transition-colors",children:[p.jsx(Or,{className:"w-4 h-4 mr-2 text-blue-500"}),p.jsx(nl,{placeholder:"تصفية حسب الفئة"})]}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الفئات"}),N.map(e=>p.jsx(dl,{value:e,children:e},e))]})]})]}),p.jsxs("div",{className:"text-sm text-muted-foreground arabic-enhanced bg-muted/30 px-3 py-2 rounded-lg border",children:["إجمالي العناصر: ",p.jsx("span",{className:"font-semibold text-foreground",children:_.length})]})]}),p.jsx("div",{className:"border rounded-lg overflow-hidden",children:p.jsx("div",{className:"overflow-x-auto",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{className:"bg-muted/50",children:[p.jsx(tc,{className:"text-center",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"#"})}),p.jsx(E,{field:"name",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"اسم العنصر"})}),p.jsx(E,{field:"category",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"الفئة"})}),p.jsx(E,{field:"quantity",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"الكمية"})}),p.jsx(E,{field:"cost_per_unit",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"سعر الوحدة"})}),p.jsx(E,{field:"total_value",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"القيمة الإجمالية"})}),p.jsx(tc,{className:"text-center",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"الحالة"})}),p.jsx(tc,{className:"text-center",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"الاجراءات"})})]})}),p.jsx(Jd,{children:$.map((e,t)=>p.jsxs(ec,{className:"hover:bg-muted/50",children:[p.jsx(nc,{className:"font-medium text-center",children:D+t+1}),p.jsx(nc,{className:"font-medium text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:e.name.charAt(0)}),p.jsxs("div",{children:[p.jsx("span",{className:"arabic-enhanced",children:e.name}),e.description&&p.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e.description})]})]})}),p.jsx(nc,{className:"text-center",children:e.category?p.jsx(qo,{variant:"outline",className:"arabic-enhanced",children:e.category}):p.jsx("span",{className:"text-muted-foreground",children:"-"})}),p.jsx(nc,{className:"text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-1",children:[p.jsx("span",{className:"font-medium",children:e.quantity}),p.jsx("span",{className:"text-muted-foreground text-sm",children:e.unit||"قطعة"})]})}),p.jsx(nc,{className:"text-center",children:e.cost_per_unit?p.jsx("span",{className:"font-medium",children:r(e.cost_per_unit)}):p.jsx("span",{className:"text-muted-foreground",children:"-"})}),p.jsx(nc,{className:"text-center",children:p.jsx("span",{className:"font-medium",children:r(e.total_value)})}),p.jsx(nc,{className:"text-center",children:T(e)}),p.jsx(nc,{className:"min-w-[200px] text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-1",children:[p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-view",onClick:t=>{t.preventDefault(),t.stopPropagation(),s(e)},children:[p.jsx(Fr,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"عرض"})]}),p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:t=>{t.preventDefault(),t.stopPropagation(),n(e)},children:[p.jsx(si,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:t=>{t.preventDefault(),t.stopPropagation(),a(e.id)},children:[p.jsx(Ni,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]})]})})]},e.id))})]})})}),k.length>0&&p.jsxs("div",{className:"flex items-center justify-between px-2",children:[p.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:p.jsxs("p",{className:"text-sm text-muted-foreground arabic-enhanced",children:["عرض ",D+1," إلى ",Math.min(D+x,k.length)," من ",k.length," عنصر"]})}),p.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),p.jsxs(el,{value:`${x}`,onValueChange:e=>g(Number(e)),children:[p.jsx(al,{className:"h-8 w-[70px]",children:p.jsx(nl,{placeholder:x})}),p.jsx(il,{side:"top",children:[5,10,20,30,50].map(e=>p.jsx(dl,{value:`${e}`,children:e},e))})]})]}),p.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",m," من ",S]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(1),disabled:1===m,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),p.jsx(Nr,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(m-1),disabled:1===m,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),p.jsx(br,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(m+1),disabled:m===S,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),p.jsx(yr,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(S),disabled:m===S,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),p.jsx(wr,{className:"h-4 w-4"})]})]})]})]})]})}function Nh({amount:e,currency:t,className:n="",fallbackFormat:a=!0,showSymbolOnly:s=!1,useGlobalCurrency:r=!0}){const{currentCurrency:i,formatAmount:l,formatAmountSymbol:o}=Sa(),d=r?t||i:t||"USD";try{const t=s?o(e,d):l(e,d);return p.jsx("span",{className:n,children:t})}catch(c){if(console.warn("Error formatting currency:",c),a){const t=ia(d);try{const a=new Intl.NumberFormat("en-US",{minimumFractionDigits:s?0:t.decimals,maximumFractionDigits:s?0:t.decimals}).format(e),r="before"===t.position?`${t.symbol}${a}`:`${a} ${t.symbol}`;return p.jsx("span",{className:n,children:r})}catch(u){const t=ia(d),a=s?Math.round(e).toString():e.toFixed(t.decimals),r="before"===t.position?`${t.symbol}${a}`:`${a} ${t.symbol}`;return p.jsx("span",{className:n,children:r})}}return p.jsxs("span",{className:n,children:[e," ",d]})}}function _h(){wd();const[e,t]=ve.useState(!1),[n,a]=ve.useState(!1),[s,r]=ve.useState(!1),[i,l]=ve.useState(!1),[o,d]=ve.useState(!1),[c,u]=ve.useState(null),[h,x]=ve.useState("inventory"),{items:g,filteredItems:f,isLoading:v,error:y,categories:b,suppliers:j,totalValue:w,lowStockCount:N,expiredCount:_,expiringSoonCount:k,loadItems:S,createItem:D,updateItem:$,deleteItem:C,recordUsage:E,clearError:T}=jd(),{appointments:A,loadAppointments:F}=Wo();ve.useEffect(()=>{S(),F()},[S,F]);const P=({title:e,value:t,icon:n,color:a="blue",trend:s})=>p.jsx(Lo,{className:vd(a),children:p.jsx(Yo,{className:"p-6",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:e}),p.jsx("p",{className:"text-2xl font-bold text-foreground",children:t}),s&&p.jsxs("div",{className:"flex items-center mt-1",children:[s>0?p.jsx(ki,{className:"w-4 h-4 text-green-500 mr-1"}):p.jsx(_i,{className:"w-4 h-4 text-red-500 mr-1"}),p.jsxs("span",{className:"text-xs "+(s>0?"text-green-500":"text-red-500"),children:[Math.abs(s),"%"]})]})]}),p.jsx("div",{className:`text-2xl ${yd(a)}`,children:n})]})})});return p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"إدارة المخزون"}),p.jsx("p",{className:"text-muted-foreground mt-2",children:"تتبع المواد والمعدات ومستويات المخزون"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",onClick:()=>m(this,null,function*(){if(0!==f.length)try{const e=f.filter(e=>{const t=parseFloat(String(e.cost_per_unit||0))||0,n=parseFloat(String(e.unit_price||0))||0;return 0===t&&0===n});yield ic.exportInventoryToExcel(f);let t=`تم تصدير ${f.length} عنصر مخزون بنجاح إلى ملف Excel مع التنسيق الجميل!`;e.length>0&&(t+=` (تنبيه: ${e.length} عنصر لا يحتوي على سعر - يمكنك تعديل العناصر لإضافة الأسعار)`),rc.exportSuccess(t)}catch(e){console.error("Error exporting inventory:",e),rc.exportError("فشل في تصدير بيانات المخزون")}else rc.noDataToExport("لا توجد بيانات مخزون للتصدير")}),children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير"]}),p.jsxs(Qi,{onClick:()=>t(!0),className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(di,{className:"w-4 h-4"}),p.jsx("span",{children:"إضافة عنصر جديد"})]})]})]}),p.jsxs(iu,{value:h,onValueChange:x,className:"w-full",children:[p.jsxs(lu,{className:"grid w-full grid-cols-2",children:[p.jsxs(ou,{value:"inventory",className:"flex items-center gap-2",children:[p.jsx(ti,{className:"w-4 h-4"}),"المخزون"]}),p.jsxs(ou,{value:"alerts",className:"flex items-center gap-2",children:[p.jsx(cr,{className:"w-4 h-4"}),"التنبيهات",N+_+k>0&&p.jsx(qo,{variant:"destructive",className:"ml-1 text-xs",children:N+_+k})]})]}),p.jsxs(du,{value:"inventory",className:"space-y-6",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[p.jsx(P,{title:"إجمالي العناصر",value:g.length,icon:p.jsx(ti,{}),color:"blue"}),p.jsx(P,{title:"قيمة المخزون",value:p.jsx(Nh,{amount:w}),icon:p.jsx(Er,{}),color:"green"}),p.jsx(P,{title:"مخزون منخفض",value:N,icon:p.jsx(sr,{}),color:"yellow"}),p.jsx(P,{title:"منتهي الصلاحية",value:_+k,icon:p.jsx(hr,{}),color:"red"})]}),y&&p.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:[p.jsxs("p",{className:"text-destructive",children:["خطأ: ",y]}),p.jsx(Qi,{variant:"outline",size:"sm",onClick:T,className:"mt-2",children:"إغلاق"})]}),p.jsx(wh,{items:f,isLoading:v,onEdit:e=>{u(e),a(!0)},onDelete:e=>{const t=g.find(t=>t.id===e);t&&(u(t),r(!0))},onViewDetails:e=>{u(e),d(!0)}})]}),p.jsx(du,{value:"alerts",className:"space-y-6",children:p.jsx(Op,{items:g,onRefresh:S,onItemClick:e=>{u(e),a(!0)}})})]}),p.jsx(Dp,{isOpen:e,onClose:()=>t(!1),onSave:e=>m(this,null,function*(){yield D(e)}),categories:b,suppliers:j}),p.jsx(Tp,{isOpen:n,onClose:()=>a(!1),onSave:(e,t)=>m(this,null,function*(){yield $(e,t)}),item:c,categories:b,suppliers:j}),p.jsx(Ap,{isOpen:s,onClose:()=>r(!1),onConfirm:e=>m(this,null,function*(){yield C(e)}),item:c,isLoading:v}),p.jsx(Pp,{isOpen:i,onClose:()=>l(!1),onSave:e=>m(this,null,function*(){yield E(e)}),item:c,appointments:A}),p.jsx(jh,{isOpen:o,onClose:()=>d(!1),item:c})]})}bh.displayName=Up.displayName;const kh=()=>{const e=new Date;return{dateRange:{start:new Date(e.getFullYear(),e.getMonth(),1).toISOString().split("T")[0],end:e.toISOString().split("T")[0],preset:"month"}}},Sh=Ne()(Lt((e,t)=>("undefined"!=typeof window&&(window.addEventListener("patient-deleted",e=>m(void 0,null,function*(){const{clearCache:e,generateReport:n}=t();e();try{yield n("patients")}catch(a){console.error("Error refreshing reports after patient deletion:",a)}})),window.addEventListener("patient-added",e=>m(void 0,null,function*(){const{clearCache:e,generateReport:n}=t();e();try{yield n("patients")}catch(a){console.error("Error refreshing reports after patient addition:",a)}})),window.addEventListener("patient-updated",e=>m(void 0,null,function*(){const{clearCache:e,generateReport:n}=t();e();try{yield n("patients")}catch(a){console.error("Error refreshing reports after patient update:",a)}})),window.addEventListener("appointment-changed",e=>m(void 0,null,function*(){const{clearCache:e,generateReport:n}=t();e();try{yield n("appointments")}catch(a){console.error("Error refreshing appointment reports:",a)}})),window.addEventListener("payment-changed",e=>m(void 0,null,function*(){const{clearCache:e,generateReport:n}=t();e();try{yield n("financial")}catch(a){console.error("Error refreshing financial reports:",a)}})),window.addEventListener("inventory-changed",e=>m(void 0,null,function*(){const{clearCache:e,generateReport:n}=t();e();try{yield n("inventory")}catch(a){console.error("Error refreshing inventory reports:",a)}})),window.addEventListener("clinic-needs-changed",e=>m(void 0,null,function*(){const{clearCache:e,generateReport:n}=t();e();try{yield n("clinicNeeds")}catch(a){console.error("Error refreshing clinic needs reports:",a)}}))),{reportData:null,patientReports:null,appointmentReports:null,financialReports:null,inventoryReports:null,analyticsReports:null,treatmentReports:null,clinicNeedsReports:null,isLoading:!1,isExporting:!1,error:null,activeReportType:"overview",currentFilter:kh(),savedFilters:[],cachedReports:new Map,cacheExpiry:3e5,autoRefreshInterval:null,generateReport:(n,a)=>m(void 0,null,function*(){var s,r,i,l,d,c,u,m,p,h,x,g,f,v;const{currentFilter:y,getCachedReport:b,setCachedReport:j,cacheExpiry:w}=t(),N=o(o({},y),a),_=((e,t)=>`${e}_${JSON.stringify(t)}`)(n,N),k=b(_);if(k)e({[`${n}Reports`]:k,isLoading:!1});else{e({isLoading:!0,error:null});try{let a=null;switch(n){case"patients":a=yield null==(r=null==(s=window.electronAPI)?void 0:s.reports)?void 0:r.generatePatientReport(N),e({patientReports:a});break;case"appointments":a=yield null==(l=null==(i=window.electronAPI)?void 0:i.reports)?void 0:l.generateAppointmentReport(N),console.log("✅ Appointment report generated:",a),e({appointmentReports:a});break;case"financial":a=yield null==(c=null==(d=window.electronAPI)?void 0:d.reports)?void 0:c.generateFinancialReport(N),console.log("✅ Financial report generated:",a),e({financialReports:a});break;case"inventory":a=yield null==(m=null==(u=window.electronAPI)?void 0:u.reports)?void 0:m.generateInventoryReport(N),console.log("✅ Inventory report generated:",a),e({inventoryReports:a});break;case"analytics":a=yield null==(h=null==(p=window.electronAPI)?void 0:p.reports)?void 0:h.generateAnalyticsReport(N),console.log("✅ Analytics report generated:",a),e({analyticsReports:a});break;case"treatments":a=yield null==(g=null==(x=window.electronAPI)?void 0:x.reports)?void 0:g.generateTreatmentReport(N),console.log("✅ Treatment report generated:",a),e({treatmentReports:a});break;case"clinicNeeds":a=yield t().generateClinicNeedsReport(N),console.log("✅ Clinic needs report generated:",a),e({clinicNeedsReports:a});break;case"overview":a=yield null==(v=null==(f=window.electronAPI)?void 0:f.reports)?void 0:v.generateOverviewReport(N),console.log("✅ Overview report generated:",a),e({reportData:a})}a&&(j(_,a),console.log(`💾 Report cached with key: ${_}`)),e({isLoading:!1})}catch(S){console.error(`❌ Error generating ${n} report:`,S),e({error:S instanceof Error?S.message:`Failed to generate ${n} report`,isLoading:!1})}}}),generateAllReports:n=>m(void 0,null,function*(){const{generateReport:a}=t(),s=["patients","appointments","financial","inventory","analytics","treatments","clinicNeeds"];e({isLoading:!0,error:null});try{for(const e of s)yield a(e,n);console.log("✅ All reports generated successfully"),e({isLoading:!1})}catch(r){console.error("❌ Error generating all reports:",r),e({error:r instanceof Error?r.message:"Failed to generate reports",isLoading:!1})}}),refreshReports:()=>m(void 0,null,function*(){const{activeReportType:e,currentFilter:n,clearCache:a}=t();a(),yield t().generateReport(e,n)}),setFilter:n=>{e({currentFilter:o(o({},t().currentFilter),n)})},resetFilter:()=>{e({currentFilter:kh()})},saveFilter:n=>{const{currentFilter:a,savedFilters:s}=t(),r={name:n,filter:a},i=s.findIndex(e=>e.name===n);if(i>=0){const t=[...s];t[i]=r,e({savedFilters:t})}else e({savedFilters:[...s,r]})},loadFilter:n=>{const{savedFilters:a}=t(),s=a.find(e=>e.name===n);s&&e({currentFilter:s.filter})},deleteFilter:n=>{const{savedFilters:a}=t();e({savedFilters:a.filter(e=>e.name!==n)})},setActiveReportType:t=>{e({activeReportType:t})},clearError:()=>{e({error:null})},exportReport:(n,a)=>m(void 0,null,function*(){var s,r;e({isExporting:!0,error:null});try{const{currentFilter:i}=t(),l=yield null==(r=null==(s=window.electronAPI)?void 0:s.reports)?void 0:r.exportReport(n,i,a);if(e({isExporting:!1}),!(null==l?void 0:l.success))throw new Error((null==l?void 0:l.message)||"فشل في تصدير التقرير");{const e=new CustomEvent("showToast",{detail:{title:"تم التصدير بنجاح",description:`تم حفظ التقرير في: ${l.filePath}`,type:"success"}});window.dispatchEvent(e)}return l}catch(i){console.error("Error exporting report:",i);const t=i instanceof Error?i.message:"Failed to export report";e({error:t,isExporting:!1});const n=new CustomEvent("showToast",{detail:{title:"خطأ في التصدير",description:t,type:"error"}});throw window.dispatchEvent(n),i}}),clearCache:()=>{e({cachedReports:new Map})},startAutoRefresh:(n=5)=>{const{stopAutoRefresh:a}=t();a();const s=setInterval(()=>m(void 0,null,function*(){const{activeReportType:e,generateReport:n,generateAllReports:a}=t();try{"overview"===e?yield a():yield n(e),console.log("Auto-refresh completed successfully")}catch(s){console.error("Auto-refresh failed:",s)}}),60*n*1e3);e({autoRefreshInterval:s})},stopAutoRefresh:()=>{const{autoRefreshInterval:n}=t();n&&(clearInterval(n),e({autoRefreshInterval:null}))},syncReportsData:()=>m(void 0,null,function*(){const{generateAllReports:e}=t();try{yield e();const t=new CustomEvent("showToast",{detail:{title:"تم تحديث البيانات",description:"تم مزامنة جميع التقارير بنجاح",type:"success"}});window.dispatchEvent(t)}catch(n){console.error("Data sync failed:",n);const e=new CustomEvent("showToast",{detail:{title:"خطأ في المزامنة",description:"فشل في تحديث البيانات",type:"error"}});window.dispatchEvent(e)}}),getCachedReport:e=>{const{cachedReports:n,cacheExpiry:a}=t(),s=n.get(e);return s&&Date.now()-s.timestamp<a?s.data:null},setCachedReport:(n,a)=>{const{cachedReports:s}=t(),r=new Map(s);r.set(n,{data:a,timestamp:Date.now()}),e({cachedReports:r})},generateClinicNeedsReport:e=>m(void 0,null,function*(){var t,n;try{const a=(yield null==(n=null==(t=window.electronAPI)?void 0:t.clinicNeeds)?void 0:n.getAll())||[];let s=a;if((null==e?void 0:e.startDate)&&(null==e?void 0:e.endDate)){const t=new Date(e.startDate),n=new Date(e.endDate);s=a.filter(e=>{const a=new Date(e.created_at);return a>=t&&a<=n})}const r=s.length,i=s.reduce((e,t)=>e+t.price*t.quantity,0),l=r>0?i/r:0,o=s.filter(e=>"pending"===e.status).length,d=s.filter(e=>"ordered"===e.status).length,c=s.filter(e=>"received"===e.status).length,u=s.filter(e=>"cancelled"===e.status).length,m=s.filter(e=>"urgent"===e.priority).length,p=s.filter(e=>"high"===e.priority).length,h=s.filter(e=>"medium"===e.priority).length,x=s.filter(e=>"low"===e.priority).length,g=r>0?c/r*100:0,f=r>0?m/r*100:0,v=[{status:"pending",count:o,percentage:r>0?o/r*100:0,value:s.filter(e=>"pending"===e.status).reduce((e,t)=>e+t.price*t.quantity,0)},{status:"ordered",count:d,percentage:r>0?d/r*100:0,value:s.filter(e=>"ordered"===e.status).reduce((e,t)=>e+t.price*t.quantity,0)},{status:"received",count:c,percentage:r>0?c/r*100:0,value:s.filter(e=>"received"===e.status).reduce((e,t)=>e+t.price*t.quantity,0)},{status:"cancelled",count:u,percentage:r>0?u/r*100:0,value:s.filter(e=>"cancelled"===e.status).reduce((e,t)=>e+t.price*t.quantity,0)}],y=[{priority:"urgent",count:m,percentage:r>0?m/r*100:0,value:s.filter(e=>"urgent"===e.priority).reduce((e,t)=>e+t.price*t.quantity,0)},{priority:"high",count:p,percentage:r>0?p/r*100:0,value:s.filter(e=>"high"===e.priority).reduce((e,t)=>e+t.price*t.quantity,0)},{priority:"medium",count:h,percentage:r>0?h/r*100:0,value:s.filter(e=>"medium"===e.priority).reduce((e,t)=>e+t.price*t.quantity,0)},{priority:"low",count:x,percentage:r>0?x/r*100:0,value:s.filter(e=>"low"===e.priority).reduce((e,t)=>e+t.price*t.quantity,0)}],b=new Map;s.forEach(e=>{const t=e.category||"غير محدد",n=b.get(t)||{count:0,value:0};b.set(t,{count:n.count+1,value:n.value+e.price*e.quantity})});const j=Array.from(b.entries()).map(([e,t])=>({category:e,count:t.count,value:t.value})),w=new Map;s.forEach(e=>{const t=e.supplier||"غير محدد",n=w.get(t)||{count:0,value:0};w.set(t,{count:n.count+1,value:n.value+e.price*e.quantity})});const N=Array.from(w.entries()).map(([e,t])=>({supplier:e,count:t.count,value:t.value})),_=[];for(let e=5;e>=0;e--){const t=new Date;t.setMonth(t.getMonth()-e);const n=new Date(t.getFullYear(),t.getMonth(),1),s=new Date(t.getFullYear(),t.getMonth()+1,0),r=a.filter(e=>{const t=new Date(e.created_at);return t>=n&&t<=s});_.push({period:`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`,count:r.length,value:r.reduce((e,t)=>e+t.price*t.quantity,0)})}const k=s.map(e=>({need_name:e.need_name,value:e.price*e.quantity,quantity:e.quantity})).sort((e,t)=>t.value-e.value).slice(0,10),S=s.filter(e=>"pending"===e.status).slice(0,10),D=s.filter(e=>"urgent"===e.priority).slice(0,10),$=s.filter(e=>{const t=new Date(e.created_at),n=(Date.now()-t.getTime())/864e5;return"pending"===e.status&&n>30}).slice(0,10);return{totalNeeds:r,totalValue:i,pendingCount:o,orderedCount:d,receivedCount:c,cancelledCount:u,urgentCount:m,highPriorityCount:p,mediumPriorityCount:h,lowPriorityCount:x,averageNeedValue:l,completionRate:g,urgencyRate:f,needsByStatus:v,needsByPriority:y,needsByCategory:j,needsBySupplier:N,needsTrend:_,topExpensiveNeeds:k,pendingNeeds:S,urgentNeeds:D,overdueNeeds:$,recentlyReceived:s.filter(e=>"received"===e.status).sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime()).slice(0,10),needsList:s,filterInfo:e?`${e.startDate} - ${e.endDate}`:"جميع البيانات",dataCount:s.length}}catch(a){throw console.error("Error generating clinic needs report:",a),a}})})),{name:"reports-store"}),Dh={status:"",expenseType:"",category:"",vendor:"",isRecurring:null,dateRange:{start:"",end:""}},$h={totalExpenses:0,totalAmount:0,paidAmount:0,pendingAmount:0,overdueAmount:0,recurringExpenses:0,expensesByType:{},expensesByStatus:{},monthlyExpenses:{}},Ch=Ne((e,t)=>({expenses:[],filteredExpenses:[],selectedExpense:null,isLoading:!1,error:null,searchQuery:"",filters:Dh,analytics:$h,categories:[],vendors:[],expenseTypes:["salary","utilities","rent","maintenance","supplies","insurance","other"],loadExpenses:()=>m(void 0,null,function*(){var n,a;e({isLoading:!0,error:null});try{const s=(yield null==(a=null==(n=window.electronAPI)?void 0:n.clinicExpenses)?void 0:a.getAll())||[];e({expenses:s,filteredExpenses:s,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateVendors(),t().filterExpenses()}catch(s){console.error("Error loading clinic expenses:",s),e({error:s instanceof Error?s.message:"Failed to load clinic expenses",isLoading:!1})}}),createExpense:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield window.electronAPI.clinicExpenses.create(n),{expenses:s}=t(),r=[...s,a];e({expenses:r,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateVendors(),t().filterExpenses(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-expenses-changed",{detail:{type:"created",expenseId:a.id,expense:a}}))}catch(a){throw console.error("Error creating clinic expense:",a),e({error:a instanceof Error?a.message:"Failed to create clinic expense",isLoading:!1}),a}}),updateExpense:(n,a)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const s=yield window.electronAPI.clinicExpenses.update(n,a),{expenses:r}=t(),i=r.map(e=>e.id===n?s:e);e({expenses:i,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateVendors(),t().filterExpenses(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-expenses-changed",{detail:{type:"updated",expenseId:n,expense:s}}))}catch(s){throw console.error("Error updating clinic expense:",s),e({error:s instanceof Error?s.message:"Failed to update clinic expense",isLoading:!1}),s}}),deleteExpense:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{if(yield window.electronAPI.clinicExpenses.delete(n)){const{expenses:a}=t(),s=a.filter(e=>e.id!==n);e({expenses:s,selectedExpense:null,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateVendors(),t().filterExpenses(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-expenses-changed",{detail:{type:"deleted",expenseId:n}}))}}catch(a){throw console.error("Error deleting clinic expense:",a),e({error:a instanceof Error?a.message:"Failed to delete clinic expense",isLoading:!1}),a}}),setSelectedExpense:t=>e({selectedExpense:t}),setSearchQuery:n=>{e({searchQuery:n}),t().filterExpenses()},setFilters:n=>{e({filters:n}),t().filterExpenses()},clearError:()=>e({error:null}),filterExpenses:()=>{const{expenses:n,searchQuery:a,filters:s}=t();let r=[...n];if(a.trim()){const e=a.toLowerCase();r=r.filter(t=>{var n,a,s;return t.expense_name.toLowerCase().includes(e)||(null==(n=t.description)?void 0:n.toLowerCase().includes(e))||(null==(a=t.vendor)?void 0:a.toLowerCase().includes(e))||(null==(s=t.notes)?void 0:s.toLowerCase().includes(e))})}if(s.status&&(r=r.filter(e=>e.status===s.status)),s.expenseType&&(r=r.filter(e=>e.expense_type===s.expenseType)),s.category&&(r=r.filter(e=>e.category===s.category)),s.vendor&&(r=r.filter(e=>e.vendor===s.vendor)),null!==s.isRecurring&&(r=r.filter(e=>e.is_recurring===s.isRecurring)),s.dateRange.start&&s.dateRange.end){const e=new Date(s.dateRange.start),t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0),n=new Date(s.dateRange.end),a=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);r=r.filter(e=>{const n=e.payment_date;if(!n)return!1;const s=new Date(n);let r;return r=n.includes("T")||n.includes(" ")?s:new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0),r>=t&&r<=a})}e({filteredExpenses:r})},calculateAnalytics:()=>{const{expenses:n}=t(),a=n.length,s=n.reduce((e,t)=>e+t.amount,0),r=n.filter(e=>"paid"===e.status).reduce((e,t)=>e+t.amount,0),i=n.filter(e=>"pending"===e.status).reduce((e,t)=>e+t.amount,0),l=n.filter(e=>"overdue"===e.status).reduce((e,t)=>e+t.amount,0),o=n.filter(e=>e.is_recurring).length,d=n.reduce((e,t)=>(e[t.expense_type]=(e[t.expense_type]||0)+t.amount,e),{}),c=n.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+t.amount,e),{}),u=n.reduce((e,t)=>{const n=new Date(t.payment_date).toISOString().slice(0,7);return e[n]=(e[n]||0)+t.amount,e},{});e({analytics:{totalExpenses:a,totalAmount:s,paidAmount:r,pendingAmount:i,overdueAmount:l,recurringExpenses:o,expensesByType:d,expensesByStatus:c,monthlyExpenses:u}})},getExpensesByType:e=>{const{expenses:n}=t();return n.filter(t=>t.expense_type===e)},getExpensesByStatus:e=>{const{expenses:n}=t();return n.filter(t=>t.status===e)},getRecurringExpenses:()=>{const{expenses:e}=t();return e.filter(e=>e.is_recurring)},updateCategories:()=>{const{expenses:n}=t(),a=[...new Set(n.map(e=>e.category).filter(Boolean))];e({categories:a})},updateVendors:()=>{const{expenses:n}=t(),a=[...new Set(n.map(e=>e.vendor).filter(Boolean))];e({vendors:a})},updateExpenseTypes:()=>{e({expenseTypes:["salary","utilities","rent","maintenance","supplies","insurance","other"]})}})),Eh=Ne()(Lt((e,t)=>({needs:[],filteredNeeds:[],selectedNeed:null,isLoading:!1,error:null,searchQuery:"",filters:{},categories:[],suppliers:[],totalNeeds:0,totalValue:0,pendingCount:0,orderedCount:0,receivedCount:0,urgentCount:0,loadNeeds:()=>m(void 0,null,function*(){var n,a;e({isLoading:!0,error:null});try{const s=(yield null==(a=null==(n=window.electronAPI)?void 0:n.clinicNeeds)?void 0:a.getAll())||[];e({needs:s,filteredNeeds:s,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterNeeds()}catch(s){console.error("Error loading clinic needs:",s),e({error:s instanceof Error?s.message:"Failed to load clinic needs",isLoading:!1})}}),createNeed:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const a=yield window.electronAPI.clinicNeeds.create(n),{needs:s}=t(),r=[...s,a];e({needs:r,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterNeeds(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-needs-changed",{detail:{type:"created",needId:a.id,need:a}}))}catch(a){console.error("Error creating clinic need:",a),e({error:a instanceof Error?a.message:"Failed to create clinic need",isLoading:!1})}}),updateNeed:(n,a)=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{const s=yield window.electronAPI.clinicNeeds.update(n,a),{needs:r}=t(),i=r.map(e=>e.id===n?s:e);e({needs:i,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterNeeds(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-needs-changed",{detail:{type:"updated",needId:n,need:s}}))}catch(s){console.error("Error updating clinic need:",s),e({error:s instanceof Error?s.message:"Failed to update clinic need",isLoading:!1})}}),deleteNeed:n=>m(void 0,null,function*(){e({isLoading:!0,error:null});try{yield window.electronAPI.clinicNeeds.delete(n);const{needs:a}=t(),s=a.filter(e=>e.id!==n);e({needs:s,selectedNeed:null,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterNeeds(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-needs-changed",{detail:{type:"deleted",needId:n}}))}catch(a){console.error("Error deleting clinic need:",a),e({error:a instanceof Error?a.message:"Failed to delete clinic need",isLoading:!1})}}),setSelectedNeed:t=>e({selectedNeed:t}),setSearchQuery:n=>{e({searchQuery:n}),t().filterNeeds()},setFilters:n=>{e({filters:n}),t().filterNeeds()},clearError:()=>e({error:null}),filterNeeds:()=>{const{needs:n,searchQuery:a,filters:s}=t();let r=n;if(a.trim()){const e=a.toLowerCase().trim();r=r.filter(t=>{var n,a,s;return t.need_name.toLowerCase().includes(e)||t.serial_number.toLowerCase().includes(e)||(null==(n=t.description)?void 0:n.toLowerCase().includes(e))||(null==(a=t.category)?void 0:a.toLowerCase().includes(e))||(null==(s=t.supplier)?void 0:s.toLowerCase().includes(e))})}s.category&&(r=r.filter(e=>e.category===s.category)),s.priority&&(r=r.filter(e=>e.priority===s.priority)),s.status&&(r=r.filter(e=>e.status===s.status)),e({filteredNeeds:r})},calculateAnalytics:()=>{const{needs:n}=t(),a=n.length,s=n.reduce((e,t)=>e+t.price*t.quantity,0),r=n.filter(e=>"pending"===e.status).length,i=n.filter(e=>"ordered"===e.status).length,l=n.filter(e=>"received"===e.status).length,o=n.filter(e=>"urgent"===e.priority).length;e({totalNeeds:a,totalValue:s,pendingCount:r,orderedCount:i,receivedCount:l,urgentCount:o})},getNeedsByStatus:e=>t().needs.filter(t=>t.status===e),getNeedsByPriority:e=>t().needs.filter(t=>t.priority===e),updateCategories:()=>{const{needs:n}=t(),a=[...new Set(n.map(e=>e.category).filter(Boolean))];e({categories:a})},updateSuppliers:()=>{const{needs:n}=t(),a=[...new Set(n.map(e=>e.supplier).filter(Boolean))];e({suppliers:a})},getNextSerialNumber:()=>{const{needs:e}=t();let n=0;return e.forEach(e=>{const t=e.serial_number;if(t.match(/^\d+$/)){const e=parseInt(t,10);e>n&&(n=e)}}),(n+1).toString()}}),{name:"clinic-needs-store"})),Th=Ne()(Lt((e,t)=>({labOrders:[],filteredLabOrders:[],selectedLabOrder:null,isLoading:!1,error:null,searchQuery:"",statusFilter:"all",labFilter:"all",dateRangeFilter:{start:"",end:""},totalOrders:0,totalCost:0,totalPaid:0,totalRemaining:0,pendingOrders:0,completedOrders:0,cancelledOrders:0,loadLabOrders:()=>m(void 0,null,function*(){var n,a;e({isLoading:!0,error:null});try{const s=(yield null==(a=null==(n=window.electronAPI)?void 0:n.labOrders)?void 0:a.getAll())||[];e({labOrders:s,filteredLabOrders:s,isLoading:!1}),t().calculateStatistics(),t().filterLabOrders()}catch(s){console.error("❌ [DEBUG] Error loading lab orders:",s),e({error:s instanceof Error?s.message:"Failed to load lab orders",isLoading:!1})}}),createLabOrder:n=>m(void 0,null,function*(){var a,s;e({isLoading:!0,error:null});try{console.log("➕ [DEBUG] Creating lab order:",n);const r=n.cost-(n.paid_amount||0),i=d(o({},n),{remaining_balance:r}),l=yield null==(s=null==(a=window.electronAPI)?void 0:a.labOrders)?void 0:s.create(i);if(l){console.log("✅ [DEBUG] Lab order created successfully:",l);const{labOrders:n}=t(),a=[...n,l];e({labOrders:a,isLoading:!1}),t().calculateStatistics(),t().filterLabOrders()}}catch(r){throw console.error("❌ [DEBUG] Error creating lab order:",r),e({error:r instanceof Error?r.message:"Failed to create lab order",isLoading:!1}),r}}),updateLabOrder:(n,a)=>m(void 0,null,function*(){var s,r,i,l;e({isLoading:!0,error:null});try{console.log("🔄 [DEBUG] Updating lab order:",n,a);const e=t().labOrders.find(e=>e.id===n);if(e&&(void 0!==a.cost||void 0!==a.paid_amount)){const t=null!=(s=a.cost)?s:e.cost,n=null!=(r=a.paid_amount)?r:e.paid_amount||0;a.remaining_balance=t-n}const o=yield null==(l=null==(i=window.electronAPI)?void 0:i.labOrders)?void 0:l.update(n,a);if(o){console.log("✅ [DEBUG] Lab order updated successfully:",o),console.log("🔄 [DEBUG] Force reloading lab orders after update..."),yield t().loadLabOrders();const e=t().labOrders.find(e=>e.id===n);console.log("🔍 [DEBUG] Verification after update:",{orderId:n,found:!!e,tooth_treatment_id:null==e?void 0:e.tooth_treatment_id,updatedData:a})}}catch(o){throw console.error("❌ [DEBUG] Error updating lab order:",o),e({error:o instanceof Error?o.message:"Failed to update lab order",isLoading:!1}),o}}),deleteLabOrder:n=>m(void 0,null,function*(){var a,s,r;e({isLoading:!0,error:null});try{if(yield null==(s=null==(a=window.electronAPI)?void 0:a.labOrders)?void 0:s.delete(n)){const{labOrders:a}=t(),s=a.filter(e=>e.id!==n);e({labOrders:s,selectedLabOrder:(null==(r=t().selectedLabOrder)?void 0:r.id)===n?null:t().selectedLabOrder,isLoading:!1}),t().calculateStatistics(),t().filterLabOrders()}}catch(i){throw console.error("Error deleting lab order:",i),e({error:i instanceof Error?i.message:"Failed to delete lab order",isLoading:!1}),i}}),setSelectedLabOrder:t=>e({selectedLabOrder:t}),setSearchQuery:n=>{e({searchQuery:n}),t().filterLabOrders()},setStatusFilter:n=>{e({statusFilter:n}),t().filterLabOrders()},setLabFilter:n=>{e({labFilter:n}),t().filterLabOrders()},setDateRangeFilter:n=>{e({dateRangeFilter:n}),t().filterLabOrders()},filterLabOrders:()=>{const{labOrders:n,searchQuery:a,statusFilter:s,labFilter:r,dateRangeFilter:i}=t();let l=[...n];if(a.trim()&&(l=l.filter(e=>{var t,n;return e.service_name.toLowerCase().includes(a.toLowerCase())||(null==(t=e.lab)?void 0:t.name)&&e.lab.name.toLowerCase().includes(a.toLowerCase())||(null==(n=e.patient)?void 0:n.full_name)&&e.patient.full_name.toLowerCase().includes(a.toLowerCase())||e.notes&&e.notes.toLowerCase().includes(a.toLowerCase())})),s&&"all"!==s&&(l=l.filter(e=>e.status===s)),r&&"all"!==r&&(l=l.filter(e=>e.lab_id===r)),i.start&&i.end){const e=new Date(i.start),t=new Date(i.end);l=l.filter(n=>{const a=new Date(n.order_date);return a>=e&&a<=t})}e({filteredLabOrders:l})},clearFilters:()=>{e({searchQuery:"",statusFilter:"all",labFilter:"all",dateRangeFilter:{start:"",end:""}}),t().filterLabOrders()},clearError:()=>e({error:null}),calculateStatistics:()=>{const{labOrders:n}=t(),a=n.length,s=n.reduce((e,t)=>e+t.cost,0),r=n.reduce((e,t)=>e+(t.paid_amount||0),0),i=n.reduce((e,t)=>e+(t.remaining_balance||0),0),l=n.filter(e=>"معلق"===e.status).length,o=n.filter(e=>"مكتمل"===e.status).length,d=n.filter(e=>"ملغي"===e.status).length;e({totalOrders:a,totalCost:s,totalPaid:r,totalRemaining:i,pendingOrders:l,completedOrders:o,cancelledOrders:d})},getOrdersByLab:e=>t().labOrders.filter(t=>t.lab_id===e),getOrdersByPatient:e=>t().labOrders.filter(t=>t.patient_id===e),getOrdersByStatus:e=>t().labOrders.filter(t=>t.status===e),getOrdersByDateRange:(e,n)=>t().labOrders.filter(t=>{const a=new Date(t.order_date);return a>=e&&a<=n}),getLabOrdersByTreatment:e=>t().labOrders.filter(t=>t.tooth_treatment_id===e)}),{name:"lab-order-store"})),Ah=(e=["overview"])=>{const{generateReport:t,generateAllReports:n,clearCache:a}=Sh();return ve.useEffect(()=>{const s=["patient-added","patient-updated","patient-deleted","patient-changed","appointment-added","appointment-updated","appointment-deleted","appointment-changed","payment-added","payment-updated","payment-deleted","payment-changed","inventory-added","inventory-updated","inventory-deleted","inventory-changed","clinic-needs-added","clinic-needs-updated","clinic-needs-deleted","clinic-needs-changed"].map(s=>({eventType:s,handler:()=>(s=>m(void 0,null,function*(){console.log(`🔄 Real-time Reports: ${s} detected, refreshing reports...`),a();try{e.includes("overview")||0===e.length?yield n():yield Promise.all(e.map(e=>t(e))),console.log("✅ Real-time Reports: Refresh completed successfully")}catch(r){console.error("❌ Real-time Reports: Refresh failed:",r)}}))(s)}));return s.forEach(({eventType:e,handler:t})=>{window.addEventListener(e,t)}),()=>{s.forEach(({eventType:e,handler:t})=>{window.removeEventListener(e,t)})}},[t,n,a,e]),{refreshReports:()=>m(void 0,null,function*(){a(),e.includes("overview")||0===e.length?yield n():yield Promise.all(e.map(e=>t(e)))}),refreshSpecificReport:e=>m(void 0,null,function*(){a(),yield t(e)})}},Fh=e=>{const{generateReport:t,clearCache:n}=Sh();return ve.useEffect(()=>{const a=()=>m(void 0,null,function*(){console.log(`🔄 Real-time ${e} Reports: Data changed, refreshing...`),n();try{yield t(e),console.log(`✅ Real-time ${e} Reports: Refresh completed`)}catch(a){console.error(`❌ Real-time ${e} Reports: Refresh failed:`,a)}}),s={patients:["patient-added","patient-updated","patient-deleted","patient-changed"],appointments:["appointment-added","appointment-updated","appointment-deleted","appointment-changed"],financial:["payment-added","payment-updated","payment-deleted","payment-changed"],inventory:["inventory-added","inventory-updated","inventory-deleted","inventory-changed"],clinicNeeds:["clinic-needs-added","clinic-needs-updated","clinic-needs-deleted","clinic-needs-changed"]}[e]||[];return s.forEach(e=>{window.addEventListener(e,a)}),()=>{s.forEach(e=>{window.removeEventListener(e,a)})}},[e,t,n]),{refreshReport:()=>m(void 0,null,function*(){n(),yield t(e)})}};function Ph(e){return e.filter(e=>e.count>0).map(e=>d(o({},e),{gender:e.gender||"غير محدد"}))}function Oh(e){return e.filter(e=>e.count>0).map(e=>d(o({},e),{ageGroup:e.ageGroup||"غير محدد"}))}class Rh{static createEnhancedAppointmentReportHTML(e,t){var n,a,s,r;const i=Mh.getEnhancedHeader("تقرير المواعيد",t,"تقرير شامل عن إحصائيات المواعيد والحضور"),l=Mh.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المواعيد - ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</title>\n        ${l}\n      </head>\n      <body>\n        ${i}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">📅</div>\n            <div class="card-content">\n              <h3>إجمالي المواعيد</h3>\n              <div class="number">${e.totalAppointments.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">✅</div>\n            <div class="card-content">\n              <h3>المواعيد المكتملة</h3>\n              <div class="number">${e.completedAppointments.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">❌</div>\n            <div class="card-content">\n              <h3>المواعيد الملغية</h3>\n              <div class="number warning">${e.cancelledAppointments.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card danger">\n            <div class="card-icon">⚠️</div>\n            <div class="card-content">\n              <h3>عدم الحضور</h3>\n              <div class="number danger">${(null==(n=e.noShowAppointments)?void 0:n.toLocaleString())||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">📊</div>\n            <div class="card-content">\n              <h3>معدل الحضور</h3>\n              <div class="number">${(null==(a=e.attendanceRate)?void 0:a.toFixed(1))||"0"}%</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">📉</div>\n            <div class="card-content">\n              <h3>معدل الإلغاء</h3>\n              <div class="number warning">${(null==(s=e.cancellationRate)?void 0:s.toFixed(1))||"0"}%</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Appointments List Section --\x3e\n        ${e.appointmentsList&&e.appointmentsList.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📋</span>\n            قائمة المواعيد\n          </div>\n          <div class="section-content">\n            <div class="appointments-grid">\n              ${e.appointmentsList.slice(0,50).map((e,t)=>{const n=e.start_time?(()=>{try{const t=new Date(e.start_time);if(isNaN(t.getTime()))return"غير محدد";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear();return`${n}/${a}/${s} - ${t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})}`}catch(t){return"غير محدد"}})():"غير محدد",a=(e=>{switch(e){case"completed":return{text:"مكتمل",class:"status-completed"};case"cancelled":return{text:"ملغي",class:"status-cancelled"};case"no_show":return{text:"لم يحضر",class:"status-no-show"};case"scheduled":return{text:"مجدول",class:"status-scheduled"};default:return{text:"غير محدد",class:"status-unknown"}}})(e.status);return`\n                  <div class="appointment-card">\n                    <div class="appointment-header">\n                      <div class="appointment-avatar">\n                        ${(e.patient_name||"م").charAt(0)}\n                      </div>\n                      <div class="appointment-info">\n                        <h4 class="appointment-patient">${e.patient_name||"غير محدد"}</h4>\n                        <span class="appointment-serial">#${e.id||(t+1).toString().padStart(3,"0")}</span>\n                      </div>\n                    </div>\n                    <div class="appointment-details">\n                      <div class="detail-item">\n                        <span class="detail-label">التاريخ والوقت:</span>\n                        <span class="detail-value">${n}</span>\n                      </div>\n                      <div class="detail-item">\n                        <span class="detail-label">نوع العلاج:</span>\n                        <span class="detail-value">${e.treatment_name?ad(e.treatment_name):"غير محدد"}</span>\n                      </div>\n                      <div class="detail-item">\n                        <span class="detail-label">المدة:</span>\n                        <span class="detail-value">${e.duration||30} دقيقة</span>\n                      </div>\n                      <div class="detail-item">\n                        <span class="detail-label">الحالة:</span>\n                        <span class="detail-value ${a.class}">${a.text}</span>\n                      </div>\n                      ${e.notes?`\n                      <div class="detail-item">\n                        <span class="detail-label">ملاحظات:</span>\n                        <span class="detail-value">${e.notes}</span>\n                      </div>\n                      `:""}\n                    </div>\n                  </div>\n                `}).join("")}\n            </div>\n            ${e.appointmentsList.length>50?`\n            <div class="pagination-info">\n              <p>عرض أول 50 موعد من إجمالي ${e.appointmentsList.length.toLocaleString()} موعد</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📊</span>\n            توزيع المواعيد حسب الحالة\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الحالة</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${(null==(r=e.appointmentsByStatus)?void 0:r.map(e=>{var t;const n=parseFloat((null==(t=e.percentage)?void 0:t.toFixed(1))||"0"),a=Math.max(5,n);return`\n                      <tr>\n                        <td class="category-cell">${e.status}</td>\n                        <td class="number-cell">${e.count.toLocaleString()}</td>\n                        <td class="percentage-cell">${n}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join(""))||'<tr><td colspan="4" class="no-data">لا توجد بيانات</td></tr>'}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        ${e.appointmentsByTreatment&&e.appointmentsByTreatment.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">🦷</span>\n            توزيع المواعيد حسب نوع العلاج\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>نوع العلاج</th>\n                    <th>عدد المواعيد</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.appointmentsByTreatment.slice(0,10).map(t=>{const n=Math.max(...e.appointmentsByTreatment.map(e=>e.count)),a=n>0?t.count/n*100:0,s=Math.max(5,a);return`\n                      <tr>\n                        <td class="category-cell">${ad(t.treatment)}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${s}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        ${e.appointmentsByDay&&e.appointmentsByDay.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📅</span>\n            توزيع المواعيد حسب أيام الأسبوع\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>اليوم</th>\n                    <th>عدد المواعيد</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.appointmentsByDay.map(t=>{const n=Math.max(...e.appointmentsByDay.map(e=>e.count)),a=n>0?t.count/n*100:0,s=Math.max(5,a);return`\n                      <tr>\n                        <td class="category-cell">${t.day}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${s}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        ${e.peakHours&&e.peakHours.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">⏰</span>\n            أوقات الذروة\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الوقت</th>\n                    <th>عدد المواعيد</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.peakHours.map(t=>{const n=Math.max(...e.peakHours.map(e=>e.count)),a=n>0?t.count/n*100:0,s=Math.max(5,a);return`\n                      <tr>\n                        <td class="category-cell">${t.hour}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${s}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        <div class="report-footer">\n          <p>تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة</p>\n          <p class="generated-info">تاريخ الإنشاء: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</p>\n        </div>\n      </body>\n      </html>\n    `}static createEnhancedFinancialReportHTML(e,t){var n,a,s,r,i,l,o,d;const c=Mh.getEnhancedHeader("التقرير المالي",t,"تقرير شامل عن الإيرادات والمدفوعات"),u=Mh.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>التقرير المالي - ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</title>\n        ${u}\n      </head>\n      <body>\n        ${c}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">💰</div>\n            <div class="card-content">\n              <h3>إجمالي الإيرادات</h3>\n              <div class="number">$${(null==(n=e.totalRevenue)?void 0:n.toLocaleString())||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">✅</div>\n            <div class="card-content">\n              <h3>المدفوعات المكتملة</h3>\n              <div class="number">${(null==(a=e.completedPayments)?void 0:a.toLocaleString())||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">🔄</div>\n            <div class="card-content">\n              <h3>المدفوعات الجزئية</h3>\n              <div class="number">${(null==(s=e.partialPayments)?void 0:s.toLocaleString())||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">⏳</div>\n            <div class="card-content">\n              <h3>المدفوعات المعلقة</h3>\n              <div class="number">${(null==(r=e.pendingPayments)?void 0:r.toLocaleString())||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card danger">\n            <div class="card-icon">⚠️</div>\n            <div class="card-content">\n              <h3>المدفوعات المتأخرة</h3>\n              <div class="number">${(null==(i=e.overduePayments)?void 0:i.toLocaleString())||"0"}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Payment Methods Analysis --\x3e\n        ${e.revenueByPaymentMethod&&e.revenueByPaymentMethod.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">💳</span>\n            الإيرادات حسب طريقة الدفع\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>طريقة الدفع</th>\n                    <th>المبلغ</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.revenueByPaymentMethod.map(e=>{var t;const n=e.percentage||0,a=Math.max(5,n);return`\n                      <tr>\n                        <td class="category-cell">${"نقدي"===e.method?"💵":"بطاقة"===e.method?"💳":"تحويل بنكي"===e.method?"🏦":"💰"} ${e.method}</td>\n                        <td class="number-cell">$${(null==(t=e.amount)?void 0:t.toLocaleString())||"0"}</td>\n                        <td class="percentage-cell">${n.toFixed(1)}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n\n\n        ${e.revenueByTreatment&&e.revenueByTreatment.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">🦷</span>\n            الإيرادات حسب نوع العلاج\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>نوع العلاج</th>\n                    <th>إجمالي الإيرادات</th>\n                    <th>عدد المعاملات</th>\n                    <th>متوسط المبلغ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.revenueByTreatment.slice(0,10).map(e=>{var t,n,a;return`\n                    <tr>\n                      <td class="category-cell">${ad(e.treatment)}</td>\n                      <td class="number-cell">$${(null==(t=e.amount)?void 0:t.toLocaleString())||"0"}</td>\n                      <td class="number-cell">${(null==(n=e.count)?void 0:n.toLocaleString())||"0"}</td>\n                      <td class="number-cell">$${(null==(a=e.avgAmount)?void 0:a.toLocaleString())||"0"}</td>\n                    </tr>\n                  `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Payment Status Analysis --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📈</span>\n            تحليل حالات المدفوعات\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>حالة الدفع</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${(()=>{const t=e.dataCount||0;return[{status:"مكتمل",count:e.completedPayments||0,icon:"✅",color:"success"},{status:"جزئي",count:e.partialPayments||0,icon:"🔄",color:"info"},{status:"معلق",count:e.pendingPayments||0,icon:"⏳",color:"warning"},{status:"متأخر",count:e.overduePayments||0,icon:"⚠️",color:"danger"},{status:"فاشل",count:e.failedPayments||0,icon:"❌",color:"danger"}].map(e=>{const n=t>0?e.count/t*100:0,a=Math.max(5,n);return`\n                        <tr>\n                          <td class="category-cell">${e.icon} ${e.status}</td>\n                          <td class="number-cell">${e.count.toLocaleString()}</td>\n                          <td class="percentage-cell">${n.toFixed(1)}%</td>\n                          <td class="chart-cell">\n                            <div class="progress-bar">\n                              <div class="progress-fill ${e.color}" style="width: ${a}%"></div>\n                            </div>\n                          </td>\n                        </tr>\n                      `}).join("")})()}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Payment Status Analysis Summary --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📊</span>\n            تحليل إحصائي لحالات المدفوعات\n          </div>\n          <div class="section-content">\n            <div class="analysis-cards">\n              ${(()=>{const t=e.dataCount||0;return[{status:"مكتمل",count:e.completedPayments||0,icon:"✅",color:"#065f46",bgColor:"#d1fae5"},{status:"جزئي",count:e.partialPayments||0,icon:"🔄",color:"#1e40af",bgColor:"#dbeafe"},{status:"معلق",count:e.pendingPayments||0,icon:"⏳",color:"#92400e",bgColor:"#fef3c7"},{status:"متأخر",count:e.overduePayments||0,icon:"⚠️",color:"#991b1b",bgColor:"#fee2e2"}].map(e=>{const n=t>0?e.count/t*100:0;return`\n                    <div class="analysis-card" style="border-left-color: ${e.color}; border-left-width: 6px;">\n                      <div class="analysis-icon" style="background: ${e.bgColor}; color: ${e.color}; border: 2px solid ${e.color};">\n                        ${e.icon}\n                      </div>\n                      <div class="analysis-content">\n                        <h3 style="color: ${e.color};">${e.status}</h3>\n                        <div class="analysis-stats">\n                          <div class="stat">\n                            <span class="stat-label">العدد:</span>\n                            <span class="stat-value" style="color: ${e.color};">${e.count.toLocaleString()}</span>\n                          </div>\n                          <div class="stat">\n                            <span class="stat-label">النسبة:</span>\n                            <span class="stat-value" style="color: ${e.color};">${n.toFixed(1)}%</span>\n                          </div>\n                          <div class="stat">\n                            <span class="stat-label">من إجمالي:</span>\n                            <span class="stat-value">${t.toLocaleString()}</span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  `}).join("")})()}\n            </div>\n          </div>\n        </div>\n\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة</p>\n              <p class="generated-info">تاريخ الإنشاء: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</p>\n              ${e.filterInfo?`<p class="filter-info">📊 ${e.filterInfo}</p>`:""}\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">💰 ${(()=>{try{const{getCurrencyConfig:n,formatCurrencyWithConfig:a,getDefaultCurrency:s}=require("@/lib/utils"),r=n((null==t?void 0:t.currency)||s());return a(e.totalRevenue||0,r)}catch(n){return new Intl.NumberFormat("en-US",{style:"currency",currency:(null==t?void 0:t.currency)||"USD"}).format(e.totalRevenue||0)}})()} إجمالي</span>\n                <span class="stat-item">✅ ${(null==(l=e.completedPayments)?void 0:l.toLocaleString())||"0"} مكتمل</span>\n                <span class="stat-item">🔄 ${(null==(o=e.partialPayments)?void 0:o.toLocaleString())||"0"} جزئي</span>\n                <span class="stat-item">📊 ${(null==(d=e.dataCount)?void 0:d.toLocaleString())||"0"} معاملة</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static createEnhancedInventoryReportHTML(e,t){var n,a,s,r,i;const l=Mh.getEnhancedHeader("تقرير المخزون",t,"تقرير شامل عن حالة المخزون والتنبيهات"),o=Mh.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المخزون - ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</title>\n        ${o}\n      </head>\n      <body>\n        ${l}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">📦</div>\n            <div class="card-content">\n              <h3>إجمالي الأصناف</h3>\n              <div class="number">${e.totalItems.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">💰</div>\n            <div class="card-content">\n              <h3>القيمة الإجمالية</h3>\n              <div class="number">$${(null==(n=e.totalValue)?void 0:n.toLocaleString())||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">⚠️</div>\n            <div class="card-content">\n              <h3>أصناف منخفضة المخزون</h3>\n              <div class="number">${e.lowStockItems||0}</div>\n            </div>\n          </div>\n          <div class="summary-card danger">\n            <div class="card-icon">⏰</div>\n            <div class="card-content">\n              <h3>أصناف منتهية الصلاحية</h3>\n              <div class="number">${e.expiredItems||0}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">❌</div>\n            <div class="card-content">\n              <h3>أصناف نفد مخزونها</h3>\n              <div class="number">${e.outOfStockItems||0}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Inventory Items List Section --\x3e\n        ${e.inventoryItems&&e.inventoryItems.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📋</span>\n            قائمة أصناف المخزون\n          </div>\n          <div class="section-content">\n            <div class="inventory-grid">\n              ${e.inventoryItems.slice(0,50).map((e,t)=>`\n                <div class="inventory-card">\n                  <div class="inventory-header">\n                    <div class="inventory-avatar">\n                      ${(e.name||"ص").charAt(0)}\n                    </div>\n                    <div class="inventory-info">\n                      <h4 class="inventory-name">${e.name||"غير محدد"}</h4>\n                      <span class="inventory-category">${e.category||"غير مصنف"}</span>\n                    </div>\n                  </div>\n                  <div class="inventory-details">\n                    <div class="detail-item">\n                      <span class="detail-label">الكمية:</span>\n                      <span class="detail-value ${e.quantity<=e.minimum_stock?"status-warning":"status-success"}">${e.quantity.toLocaleString()}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">سعر الوحدة:</span>\n                      <span class="detail-value">$${(e.unit_price||e.cost_per_unit||0).toLocaleString()}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">القيمة الإجمالية:</span>\n                      <span class="detail-value">$${((e.unit_price||e.cost_per_unit||0)*e.quantity).toLocaleString()}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">الحد الأدنى:</span>\n                      <span class="detail-value">${e.minimum_stock||0}</span>\n                    </div>\n                    ${e.expiry_date?`\n                    <div class="detail-item">\n                      <span class="detail-label">تاريخ الانتهاء:</span>\n                      <span class="detail-value ${new Date(e.expiry_date)<new Date?"status-danger":"status-info"}">${new Date(e.expiry_date).toLocaleDateString("ar-SA")}</span>\n                    </div>\n                    `:""}\n                    <div class="detail-item">\n                      <span class="detail-label">الحالة:</span>\n                      <span class="detail-value ${0===e.quantity?"status-danger":e.quantity<=e.minimum_stock?"status-warning":"status-success"}">\n                        ${0===e.quantity?"نفد المخزون":e.quantity<=e.minimum_stock?"مخزون منخفض":"متوفر"}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              `).join("")}\n            </div>\n            ${e.inventoryItems.length>50?`\n            <div class="pagination-info">\n              <p>عرض أول 50 صنف من إجمالي ${e.inventoryItems.length.toLocaleString()} صنف</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Category Distribution --\x3e\n        ${e.itemsByCategory&&e.itemsByCategory.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📊</span>\n            توزيع الأصناف حسب الفئة\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الفئة</th>\n                    <th>عدد الأصناف</th>\n                    <th>القيمة الإجمالية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.itemsByCategory.map(t=>{var n;const a=e.totalItems>0?Math.round(t.count/e.totalItems*100):0;return`\n                    <tr>\n                      <td class="category-name">${t.category}</td>\n                      <td class="count-cell">${t.count.toLocaleString()}</td>\n                      <td class="value-cell">$${(null==(n=t.value)?void 0:n.toLocaleString())||"0"}</td>\n                      <td class="progress-cell">\n                        <div class="progress-bar">\n                          <div class="progress-fill" style="width: ${a}%"></div>\n                        </div>\n                        <span class="percentage">${a}%</span>\n                      </td>\n                    </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Stock Alerts Section --\x3e\n        ${e.stockAlerts&&e.stockAlerts.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">⚠️</span>\n            تنبيهات المخزون\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الصنف</th>\n                    <th>الكمية الحالية</th>\n                    <th>الحد الأدنى</th>\n                    <th>الحالة</th>\n                    <th>مستوى التنبيه</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.stockAlerts.slice(0,20).map(e=>{const t=0===e.quantity?"critical":"warning",n=e.minimum_stock>0?Math.min(100,Math.round(e.quantity/e.minimum_stock*100)):0;return`\n                    <tr>\n                      <td class="item-name">${e.name}</td>\n                      <td class="quantity-cell ${t}">${e.quantity.toLocaleString()}</td>\n                      <td class="minimum-cell">${e.minimum_stock||0}</td>\n                      <td class="status-cell">\n                        <span class="status-badge ${t}">\n                          ${0===e.quantity?"نفد المخزون":"مخزون منخفض"}\n                        </span>\n                      </td>\n                      <td class="alert-level">\n                        ${0===e.quantity?"🔴 عاجل":"🟡 تحذير"}\n                      </td>\n                      <td class="progress-cell">\n                        <div class="progress-bar">\n                          <div class="progress-fill ${t}" style="width: ${n}%"></div>\n                        </div>\n                        <span class="percentage">${n}%</span>\n                      </td>\n                    </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${e.stockAlerts.length>20?`\n            <div class="pagination-info">\n              <p>عرض أول 20 تنبيه من إجمالي ${e.stockAlerts.length.toLocaleString()} تنبيه</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Expiry Alerts Section --\x3e\n        ${e.expiryAlerts&&e.expiryAlerts.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">⏰</span>\n            تنبيهات انتهاء الصلاحية\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الصنف</th>\n                    <th>تاريخ الانتهاء</th>\n                    <th>الأيام المتبقية</th>\n                    <th>الكمية</th>\n                    <th>الحالة</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.expiryAlerts.slice(0,15).map(e=>{const t=new Date(e.expiry_date),n=new Date,a=Math.ceil((t.getTime()-n.getTime())/864e5),s=a<0,r=a<=30&&a>=0;return`\n                    <tr>\n                      <td class="item-name">${e.name}</td>\n                      <td class="date-cell">${t.toLocaleDateString("ar-SA")}</td>\n                      <td class="days-cell ${s?"expired":r?"expiring":"safe"}">\n                        ${s?"منتهي الصلاحية":`${a} يوم`}\n                      </td>\n                      <td class="quantity-cell">${e.quantity.toLocaleString()}</td>\n                      <td class="status-cell">\n                        <span class="status-badge ${s?"critical":r?"warning":"safe"}">\n                          ${s?"منتهي":r?"ينتهي قريباً":"آمن"}\n                        </span>\n                      </td>\n                    </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${e.expiryAlerts.length>15?`\n            <div class="pagination-info">\n              <p>عرض أول 15 تنبيه من إجمالي ${e.expiryAlerts.length.toLocaleString()} تنبيه</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Enhanced Footer --\x3e\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة</p>\n              <p class="generated-info">تاريخ الإنشاء: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</p>\n              ${e.filterInfo?`<p class="filter-info">📊 ${e.filterInfo}</p>`:""}\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">📦 ${(null==(a=e.totalItems)?void 0:a.toLocaleString())||"0"} صنف</span>\n                <span class="stat-item">💰 $${(null==(s=e.totalValue)?void 0:s.toLocaleString())||"0"} قيمة</span>\n                <span class="stat-item">⚠️ ${(null==(r=e.lowStockItems)?void 0:r.toLocaleString())||"0"} منخفض</span>\n                <span class="stat-item">📊 ${(null==(i=e.dataCount)?void 0:i.toLocaleString())||"0"} مفلتر</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static createEnhancedTreatmentReportHTML(e,t){var n,a,s,r,i;const l=Mh.getEnhancedHeader("تقرير العلاجات السنية",t,"تقرير شامل عن إحصائيات العلاجات والإيرادات"),o=Mh.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير العلاجات - ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</title>\n        ${o}\n      </head>\n      <body>\n        ${l}\n\n        \x3c!-- Summary Statistics --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📊</span>\n            ملخص الإحصائيات\n          </div>\n          <div class="section-content">\n            <div class="stats-grid">\n              <div class="stat-card">\n                <div class="stat-value">${(null==(n=e.totalTreatments)?void 0:n.toLocaleString())||"0"}</div>\n                <div class="stat-label">إجمالي العلاجات</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${(null==(a=e.completedTreatments)?void 0:a.toLocaleString())||"0"}</div>\n                <div class="stat-label">العلاجات المكتملة</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${(null==(s=e.plannedTreatments)?void 0:s.toLocaleString())||"0"}</div>\n                <div class="stat-label">العلاجات المخططة</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${(null==(r=e.inProgressTreatments)?void 0:r.toLocaleString())||"0"}</div>\n                <div class="stat-label">قيد التنفيذ</div>\n              </div>\n            </div>\n            <div class="stats-grid">\n              <div class="stat-card">\n                <div class="stat-value">${new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e.totalRevenue||0)}</div>\n                <div class="stat-label">إجمالي الإيرادات</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e.averageTreatmentCost||0)}</div>\n                <div class="stat-label">متوسط تكلفة العلاج</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${e.completionRate||"0"}%</div>\n                <div class="stat-label">معدل الإنجاز</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${(null==(i=e.cancelledTreatments)?void 0:i.toLocaleString())||"0"}</div>\n                <div class="stat-label">العلاجات الملغية</div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Treatment Status Distribution --\x3e\n        ${e.treatmentsByStatus&&e.treatmentsByStatus.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📈</span>\n            توزيع العلاجات حسب الحالة\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الحالة</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.treatmentsByStatus.map(e=>{var t,n;const a=Math.max(5,e.percentage||0);return`\n                      <tr>\n                        <td class="category-cell">${e.status}</td>\n                        <td class="number-cell">${(null==(t=e.count)?void 0:t.toLocaleString())||"0"}</td>\n                        <td class="percentage-cell">${(null==(n=e.percentage)?void 0:n.toFixed(1))||"0"}%</td>\n                        <td class="progress-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Treatment Types Distribution --\x3e\n        ${e.treatmentsByType&&e.treatmentsByType.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">🦷</span>\n            توزيع العلاجات حسب النوع\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>نوع العلاج</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.treatmentsByType.slice(0,15).map(e=>{var t,n;const a=Math.max(5,e.percentage||0);return`\n                      <tr>\n                        <td class="category-cell">${e.type}</td>\n                        <td class="number-cell">${(null==(t=e.count)?void 0:t.toLocaleString())||"0"}</td>\n                        <td class="percentage-cell">${(null==(n=e.percentage)?void 0:n.toFixed(1))||"0"}%</td>\n                        <td class="progress-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${e.treatmentsByType.length>15?`\n            <div class="pagination-info">\n              <p>عرض أول 15 نوع من إجمالي ${e.treatmentsByType.length.toLocaleString()} نوع</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Revenue by Category --\x3e\n        ${e.revenueByCategory&&e.revenueByCategory.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">💰</span>\n            الإيرادات حسب فئة العلاج\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>فئة العلاج</th>\n                    <th>إجمالي الإيرادات</th>\n                    <th>عدد العلاجات</th>\n                    <th>متوسط التكلفة</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.revenueByCategory.slice(0,10).map(e=>{var n,a;const s=e.count>0?e.revenue/e.count:0;return`\n                      <tr>\n                        <td class="category-cell">${e.category}</td>\n                        <td class="number-cell">${(null==(n=e.revenue)?void 0:n.toLocaleString())||"0"} ${(null==t?void 0:t.currency)||"$"}</td>\n                        <td class="number-cell">${(null==(a=e.count)?void 0:a.toLocaleString())||"0"}</td>\n                        <td class="number-cell">${s.toLocaleString()} ${(null==t?void 0:t.currency)||"$"}</td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Pending Treatments --\x3e\n        ${e.pendingTreatments&&e.pendingTreatments.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">⏳</span>\n            العلاجات المعلقة (${e.pendingTreatments.length})\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>نوع العلاج</th>\n                    <th>اسم المريض</th>\n                    <th>الحالة</th>\n                    <th>التاريخ</th>\n                    <th>التكلفة</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.pendingTreatments.slice(0,20).map(e=>`\n                    <tr>\n                      <td class="category-cell">${ad(e.treatment_type||"غير محدد")}</td>\n                      <td class="patient-cell">${e.patient_name||"غير محدد"}</td>\n                      <td class="status-cell">\n                        <span class="status-badge warning">${e.status||"معلق"}</span>\n                      </td>\n                      <td class="date-cell">${e.created_at?(()=>{const t=new Date(e.created_at);return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`})():"غير محدد"}</td>\n                      <td class="number-cell">${new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e.cost||0)}</td>\n                    </tr>\n                  `).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${e.pendingTreatments.length>20?`\n            <div class="pagination-info">\n              <p>عرض أول 20 علاج من إجمالي ${e.pendingTreatments.length.toLocaleString()} علاج معلق</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Enhanced Footer --\x3e\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة</p>\n              <p class="generated-info">تاريخ الإنشاء: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</p>\n            </div>\n            <div class="footer-right">\n              <p class="clinic-name">${(null==t?void 0:t.clinic_name)||"عيادة الأسنان الحديثة"}</p>\n              ${(null==t?void 0:t.clinic_address)?`<p class="clinic-address">${t.clinic_address}</p>`:""}\n              ${(null==t?void 0:t.clinic_phone)?`<p class="clinic-phone">📞 ${t.clinic_phone}</p>`:""}\n            </div>\n          </div>\n        </div>\n\n      </body>\n      </html>\n    `}static createEnhancedProfitLossReportHTML(e,t){const{reportData:n,payments:a,labOrders:s,clinicNeeds:r,inventoryItems:i,clinicExpenses:l,patients:o,appointments:d,filter:c,currency:u}=e,m=Mh.getEnhancedHeader("التقرير الشامل للأرباح والخسائر",t,"تحليل مالي شامل يربط جميع جوانب العيادة"),p=Mh.getEnhancedStyles(),h=e=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:u||"SAR",minimumFractionDigits:2}).format(e||0),x=e=>{try{const t=new Date(e);return isNaN(t.getTime())?"غير محدد":t.toLocaleDateString("en-GB")}catch(t){return"غير محدد"}};return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير الأرباح والخسائر - ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</title>\n        ${p}\n        <style>\n          .profit-loss-summary {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n            margin: 20px 0;\n          }\n          .profit-card {\n            background: linear-gradient(135deg, #10b981, #059669);\n            color: white;\n            padding: 20px;\n            border-radius: 10px;\n            text-align: center;\n          }\n          .loss-card {\n            background: linear-gradient(135deg, #ef4444, #dc2626);\n            color: white;\n            padding: 20px;\n            border-radius: 10px;\n            text-align: center;\n          }\n          .financial-breakdown {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 30px;\n            margin: 30px 0;\n          }\n          .revenue-section, .expenses-section {\n            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);\n            padding: 20px;\n            border-radius: 10px;\n            border: 2px solid #1a365d;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          }\n          .revenue-section h3 {\n            color: #059669;\n            border-bottom: 2px solid #10b981;\n            padding-bottom: 10px;\n          }\n          .expenses-section h3 {\n            color: #dc2626;\n            border-bottom: 2px solid #ef4444;\n            padding-bottom: 10px;\n          }\n          .breakdown-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 8px 0;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          .breakdown-item:last-child {\n            border-bottom: none;\n            font-weight: bold;\n            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);\n            color: white;\n            padding: 12px;\n            margin-top: 10px;\n            border-radius: 5px;\n            text-shadow: 0 1px 2px rgba(0,0,0,0.2);\n          }\n          .details-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            font-size: 12px;\n          }\n          .details-table th,\n          .details-table td {\n            border: 1px solid #e2e8f0;\n            padding: 8px;\n            text-align: right;\n          }\n          .details-table th {\n            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);\n            color: white;\n            font-weight: bold;\n            text-shadow: 0 1px 2px rgba(0,0,0,0.2);\n          }\n          .details-table tr:nth-child(even) {\n            background: #f8fafc;\n          }\n          .statistics-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 15px;\n            margin: 20px 0;\n          }\n          .stat-card {\n            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n            border: 2px solid #1a365d;\n            border-radius: 8px;\n            padding: 15px;\n            text-align: center;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          }\n          .stat-number {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e40af;\n          }\n          .stat-label {\n            font-size: 12px;\n            color: #64748b;\n            margin-top: 5px;\n          }\n        </style>\n      </head>\n      <body>\n        ${m}\n\n        \x3c!-- النتيجة النهائية --\x3e\n        <div class="profit-loss-summary">\n          <div class="${n.calculations.isProfit?"profit-card":"loss-card"}">\n            <h2>${n.calculations.isProfit?"🎉 ربح":"⚠️ خسارة"}</h2>\n            <div class="number" style="font-size: 28px; margin: 10px 0;">\n              ${h(n.calculations.isProfit?n.calculations.netProfit:n.calculations.lossAmount)}\n            </div>\n            <p>نسبة الربح: ${n.calculations.profitMargin.toFixed(2)}%</p>\n          </div>\n          <div class="summary-card info">\n            <h3>معلومات التقرير</h3>\n            <p><strong>الفترة الزمنية:</strong> ${n.filterInfo.dateRange}</p>\n            <p><strong>إجمالي السجلات:</strong> ${n.filterInfo.totalRecords}</p>\n            <p><strong>السجلات المفلترة:</strong> ${n.filterInfo.filteredRecords}</p>\n            <p><strong>تاريخ التقرير:</strong> ${x((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        \x3c!-- تفصيل الإيرادات والمصروفات --\x3e\n        <div class="financial-breakdown">\n          <div class="revenue-section">\n            <h3>📈 تفاصيل الإيرادات</h3>\n            <div class="breakdown-item">\n              <span>المدفوعات المكتملة:</span>\n              <span>${h(n.revenue.completedPayments)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>المدفوعات الجزئية:</span>\n              <span>${h(n.revenue.partialPayments)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>المبالغ المعلقة (غير مدفوعة):</span>\n              <span>${h(n.revenue.pendingAmount||0)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>المبالغ المتبقية:</span>\n              <span>${h(n.revenue.remainingBalances)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>إجمالي الإيرادات:</span>\n              <span>${h(n.revenue.totalRevenue)}</span>\n            </div>\n          </div>\n\n          <div class="expenses-section">\n            <h3>📉 تفاصيل المصروفات</h3>\n            <div class="breakdown-item">\n              <span>مدفوعات المخابر:</span>\n              <span>${h(n.expenses.labOrdersTotal)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>متبقي المخابر:</span>\n              <span>${h(n.expenses.labOrdersRemaining)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>احتياجات العيادة:</span>\n              <span>${h(n.expenses.clinicNeedsTotal)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>متبقي الاحتياجات:</span>\n              <span>${h(n.expenses.clinicNeedsRemaining)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>قيمة المخزون:</span>\n              <span>${h(n.expenses.inventoryExpenses)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>مصروفات العيادة المباشرة:</span>\n              <span>${h(n.expenses.clinicExpensesTotal||0)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>إجمالي المصروفات:</span>\n              <span>${h(n.calculations.totalExpenses)}</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- إحصائيات إضافية --\x3e\n        <div class="statistics-grid">\n          <div class="stat-card">\n            <div class="stat-number">${n.details.totalPatients}</div>\n            <div class="stat-label">إجمالي المرضى</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-number">${n.details.totalAppointments}</div>\n            <div class="stat-label">إجمالي المواعيد</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-number">${n.details.totalLabOrders}</div>\n            <div class="stat-label">طلبات المخابر</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-number">${n.details.totalClinicNeeds}</div>\n            <div class="stat-label">احتياجات العيادة</div>\n          </div>\n        </div>\n\n        \x3c!-- متوسطات الإيرادات --\x3e\n        <div class="section">\n          <h3>📊 متوسطات الإيرادات</h3>\n          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">\n            <div class="summary-card">\n              <h4>متوسط الإيرادات لكل مريض</h4>\n              <div class="number">${h(n.details.averageRevenuePerPatient)}</div>\n            </div>\n            <div class="summary-card">\n              <h4>متوسط الإيرادات لكل موعد</h4>\n              <div class="number">${h(n.details.averageRevenuePerAppointment)}</div>\n            </div>\n          </div>\n        </div>\n\n        ${a&&a.length>0?`\n        \x3c!-- تفاصيل المدفوعات --\x3e\n        <div class="section">\n          <h3>💰 تفاصيل المدفوعات (أحدث 20 دفعة)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>اسم المريض</th>\n                <th>المبلغ المدفوع</th>\n                <th>المبلغ الإجمالي</th>\n                <th>المبلغ المتبقي</th>\n                <th>الحالة</th>\n                <th>طريقة الدفع</th>\n                <th>تاريخ الدفع</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${a.slice(0,20).map(e=>{const t=e.amount||0;let n=0,a=0;if("partial"===e.status){n=e.total_amount_due||e.treatment_total_cost||0;const s=e.amount_paid||e.treatment_total_paid||t;a=Math.max(0,n-s)}else"pending"===e.status?(n=e.total_amount_due||e.treatment_total_cost||t,a=n):(n=t,a=0);return`\n                <tr>\n                  <td>${e.patient_name||""}</td>\n                  <td>${h(t)}</td>\n                  <td>${h(n)}</td>\n                  <td>${h(a)}</td>\n                  <td>${"completed"===e.status?"مكتمل":"partial"===e.status?"جزئي":"معلق"}</td>\n                  <td>${e.payment_method||""}</td>\n                  <td>${e.payment_date?x(e.payment_date):""}</td>\n                </tr>\n                `}).join("")}\n            </tbody>\n          </table>\n\n          \x3c!-- ملخص المدفوعات المعلقة والمتبقية --\x3e\n          <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%); border: 2px solid #1a365d; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">\n            <h4>📊 ملخص المدفوعات المعلقة والمتبقية</h4>\n            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">\n              <div>\n                <strong>إجمالي المدفوعات المعلقة:</strong><br>\n                ${h(a.filter(e=>"pending"===e.status).reduce((e,t)=>e+(t.total_amount_due||t.treatment_total_cost||0),0))}\n              </div>\n              <div>\n                <strong>إجمالي المبالغ المتبقية من الدفعات الجزئية:</strong><br>\n                ${h(a.filter(e=>"partial"===e.status).reduce((e,t)=>{const n=t.total_amount_due||t.treatment_total_cost||0,a=t.amount_paid||t.treatment_total_paid||t.amount||0;return e+Math.max(0,n-a)},0))}\n              </div>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        ${s&&s.length>0?`\n        \x3c!-- تفاصيل طلبات المخابر --\x3e\n        <div class="section">\n          <h3>🔬 تفاصيل طلبات المخابر (أحدث 15 طلب)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>رقم الطلب</th>\n                <th>اسم المختبر</th>\n                <th>اسم المريض</th>\n                <th>التكلفة</th>\n                <th>المدفوع</th>\n                <th>المتبقي</th>\n                <th>الحالة</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${s.slice(0,15).map(e=>{var t,n;return`\n                <tr>\n                  <td>${e.id||""}</td>\n                  <td>${(null==(t=e.lab)?void 0:t.name)||""}</td>\n                  <td>${(null==(n=e.patient)?void 0:n.full_name)||""}</td>\n                  <td>${h(e.cost||0)}</td>\n                  <td>${h(e.paid_amount||0)}</td>\n                  <td>${h((e.cost||0)-(e.paid_amount||0))}</td>\n                  <td>${"completed"===e.status?"مكتمل":"pending"===e.status?"معلق":"ملغي"}</td>\n                </tr>\n              `}).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${r&&r.length>0?`\n        \x3c!-- تفاصيل احتياجات العيادة --\x3e\n        <div class="section">\n          <h3>🏥 تفاصيل احتياجات العيادة (أحدث 15 احتياج)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>اسم العنصر</th>\n                <th>الكمية</th>\n                <th>سعر الوحدة</th>\n                <th>التكلفة الإجمالية</th>\n                <th>الأولوية</th>\n                <th>الحالة</th>\n                <th>تاريخ الطلب</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${r.slice(0,15).map(e=>{const t=e.quantity||0,n=e.price||0,a=t*n;return`\n                <tr>\n                  <td>${e.need_name||e.item_name||""}</td>\n                  <td>${t}</td>\n                  <td>${h(n)}</td>\n                  <td>${h(a)}</td>\n                  <td>${"urgent"===e.priority?"عاجل":"high"===e.priority?"عالي":"medium"===e.priority?"متوسط":"منخفض"}</td>\n                  <td>${"received"===e.status?"مستلم":"ordered"===e.status?"مطلوب":"معلق"}</td>\n                  <td>${e.created_at?x(e.created_at):""}</td>\n                </tr>\n                `}).join("")}\n            </tbody>\n          </table>\n\n          \x3c!-- إجمالي تكلفة احتياجات العيادة --\x3e\n          <div style="margin-top: 15px; padding: 10px; background: #f1f5f9; border-radius: 5px;">\n            <strong>إجمالي تكلفة احتياجات العيادة: ${h(r.reduce((e,t)=>e+(t.quantity||0)*(t.price||0),0))}</strong>\n          </div>\n        </div>\n        `:""}\n\n        ${l&&l.length>0?`\n        \x3c!-- تفاصيل مصروفات العيادة --\x3e\n        <div class="section">\n          <h3>💸 تفاصيل مصروفات العيادة (أحدث 15 مصروف)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>اسم المصروف</th>\n                <th>النوع</th>\n                <th>المبلغ</th>\n                <th>طريقة الدفع</th>\n                <th>تاريخ الدفع</th>\n                <th>المورد</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${l.slice(0,15).map(e=>`\n                <tr>\n                  <td>${e.expense_name||""}</td>\n                  <td>${e.expense_type||""}</td>\n                  <td>${h(e.amount||0)}</td>\n                  <td>${e.payment_method||""}</td>\n                  <td>${e.payment_date?x(e.payment_date):""}</td>\n                  <td>${e.vendor||""}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        \x3c!-- Footer --\x3e\n        <div class="footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="report-date">تاريخ التقرير: ${x((new Date).toISOString())}</p>\n              <p class="report-time">وقت التقرير: ${(new Date).toLocaleTimeString("ar-SA")}</p>\n            </div>\n            <div class="footer-right">\n              <p class="clinic-name">${(null==t?void 0:t.clinic_name)||"عيادة الأسنان الحديثة"}</p>\n              ${(null==t?void 0:t.clinic_address)?`<p class="clinic-address">${t.clinic_address}</p>`:""}\n              ${(null==t?void 0:t.clinic_phone)?`<p class="clinic-phone">📞 ${t.clinic_phone}</p>`:""}\n            </div>\n          </div>\n        </div>\n\n      </body>\n      </html>\n    `}}class Mh{static getEnhancedHeader(e,t,n){return this.createEnhancedHeader(e,t,n)}static getEnhancedStyles(){return this.createEnhancedStyles()}static createEnhancedHeader(e,t,n){const a=(null==t?void 0:t.clinic_name)||"عيادة الأسنان الحديثة",s=(null==t?void 0:t.doctor_name)||"د. محمد أحمد",r=(null==t?void 0:t.clinic_address)||"",i=(null==t?void 0:t.clinic_phone)||"",l=(null==t?void 0:t.clinic_logo)||"";return(()=>{const e=new Date;e.getDate().toString().padStart(2,"0"),(e.getMonth()+1).toString().padStart(2,"0"),e.getFullYear()})(),`\n      <div class="enhanced-header">\n        <div class="header-content">\n          <div class="clinic-info">\n            ${l&&""!==l.trim()?`\n              <div class="clinic-logo">\n                <img src="${l}" alt="شعار العيادة" />\n              </div>\n            `:""}\n            <div class="clinic-details">\n              <h1 class="clinic-name">${a}</h1>\n              ${s?`<h2 class="doctor-name">${s}</h2>`:""}\n              ${r?`<p class="clinic-address">${r}</p>`:""}\n              ${i?`<p class="clinic-phone">📞 ${i}</p>`:""}\n            </div>\n          </div>\n\n          <div class="report-info">\n            <h3 class="report-title">${e}</h3>\n            ${n?`<p class="report-subtitle">${n}</p>`:""}\n            <p class="report-date">📅 ${this.formatGregorianDate(new Date)}</p>\n            <p class="report-time">🕐 ${(new Date).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}</p>\n          </div>\n        </div>\n\n        <div class="header-decoration"></div>\n      </div>\n    `}static createEnhancedStyles(){return`\n      <style>\n        @import url('/fonts/Tajawal-Regular.ttf');\n        @import url('/fonts/Tajawal-Bold.ttf');\n        @import url('/fonts/Tajawal-Medium.ttf');\n\n        * {\n          box-sizing: border-box;\n          margin: 0;\n          padding: 0;\n        }\n\n        body {\n          font-family: ${this.TYPOGRAPHY.fonts.primary};\n          direction: rtl;\n          line-height: 1.6;\n          color: ${this.COLORS.text.primary};\n          background: ${this.COLORS.white};\n          margin: ${this.LAYOUT.margins.top} ${this.LAYOUT.margins.right} ${this.LAYOUT.margins.bottom} ${this.LAYOUT.margins.left};\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n        }\n\n        /* Enhanced Header Styles */\n        .enhanced-header {\n          background: linear-gradient(135deg, ${this.COLORS.primary} 0%, ${this.COLORS.secondary} 100%);\n          color: ${this.COLORS.white};\n          padding: ${this.LAYOUT.spacing.card};\n          border-radius: ${this.LAYOUT.borderRadius};\n          margin-bottom: ${this.LAYOUT.spacing.section};\n          box-shadow: ${this.LAYOUT.shadows.header};\n          position: relative;\n          overflow: hidden;\n        }\n\n        .header-content {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          position: relative;\n          z-index: 2;\n        }\n\n        .clinic-info {\n          display: flex;\n          align-items: center;\n          gap: ${this.LAYOUT.spacing.element};\n        }\n\n        .clinic-logo {\n          width: 70px;\n          height: 70px;\n          border-radius: 50%;\n          overflow: hidden;\n          background: ${this.COLORS.white};\n          padding: 4px;\n          box-shadow: 0 3px 10px rgba(0,0,0,0.15);\n          border: 2px solid rgba(255,255,255,0.8);\n          flex-shrink: 0;\n        }\n\n        .clinic-logo img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          border-radius: 50%;\n          max-width: 70px;\n          max-height: 70px;\n        }\n\n        .clinic-details h1.clinic-name {\n          font-size: ${this.TYPOGRAPHY.sizes.h2};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          margin-bottom: 5px;\n          text-shadow: 0 2px 4px rgba(0,0,0,0.3);\n        }\n\n        .clinic-details h2.doctor-name {\n          font-size: ${this.TYPOGRAPHY.sizes.h4};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          margin-bottom: 8px;\n          opacity: 0.95;\n        }\n\n        .clinic-details p {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          margin-bottom: 3px;\n          opacity: 0.9;\n        }\n\n        .report-info {\n          text-align: left;\n          direction: ltr;\n        }\n\n        .report-info h3.report-title {\n          font-size: ${this.TYPOGRAPHY.sizes.h3};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          margin-bottom: 8px;\n          text-shadow: 0 2px 4px rgba(0,0,0,0.3);\n        }\n\n        .report-info p {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          margin-bottom: 3px;\n          opacity: 0.9;\n        }\n\n        .header-decoration {\n          position: absolute;\n          top: -50%;\n          right: -10%;\n          width: 200px;\n          height: 200px;\n          background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);\n          border-radius: 50%;\n        }\n\n        /* Enhanced Card Styles */\n        .summary-cards {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n          gap: ${this.LAYOUT.spacing.element};\n          margin: ${this.LAYOUT.spacing.section} 0;\n        }\n\n        .summary-card {\n          background: ${this.COLORS.white};\n          border: 2px solid ${this.COLORS.border};\n          border-radius: ${this.LAYOUT.borderRadius};\n          padding: ${this.LAYOUT.spacing.card};\n          box-shadow: ${this.LAYOUT.shadows.card};\n          transition: all 0.3s ease;\n          position: relative;\n          overflow: hidden;\n          display: flex;\n          align-items: center;\n          gap: 15px;\n        }\n\n        .summary-card.primary::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: ${this.COLORS.primary};\n        }\n\n        .summary-card.success::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: ${this.COLORS.success};\n        }\n\n        .summary-card.info::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: #1e40af;\n        }\n\n        .summary-card.warning::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: ${this.COLORS.warning};\n        }\n\n        .card-icon {\n          font-size: 32px;\n          min-width: 50px;\n          height: 50px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          background: ${this.COLORS.light};\n          border-radius: 50%;\n          flex-shrink: 0;\n        }\n\n        .card-content {\n          flex: 1;\n          text-align: right;\n        }\n\n        .summary-card h3 {\n          font-size: ${this.TYPOGRAPHY.sizes.h5};\n          font-weight: ${this.TYPOGRAPHY.weights.semibold};\n          color: ${this.COLORS.text.secondary};\n          margin-bottom: ${this.LAYOUT.spacing.small};\n        }\n\n        .summary-card .number {\n          font-size: ${this.TYPOGRAPHY.sizes.h2};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.primary};\n          margin-bottom: 5px;\n        }\n\n        .summary-card .currency {\n          color: ${this.COLORS.success};\n        }\n\n        .summary-card .warning {\n          color: ${this.COLORS.warning};\n        }\n\n        .summary-card .danger {\n          color: ${this.COLORS.danger};\n        }\n\n        /* Enhanced Section Styles */\n        .section {\n          margin: ${this.LAYOUT.spacing.section} 0;\n          background: ${this.COLORS.white};\n          border-radius: ${this.LAYOUT.borderRadius};\n          overflow: hidden;\n          box-shadow: ${this.LAYOUT.shadows.card};\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n        }\n\n        .section-title {\n          font-size: ${this.TYPOGRAPHY.sizes.h4};\n          font-weight: ${this.TYPOGRAPHY.weights.semibold};\n          color: ${this.COLORS.primary};\n          margin-bottom: ${this.LAYOUT.spacing.element};\n          padding: ${this.LAYOUT.spacing.element} ${this.LAYOUT.spacing.card};\n          background: linear-gradient(90deg, ${this.COLORS.light} 0%, ${this.COLORS.white} 100%);\n          border-bottom: 2px solid ${this.COLORS.border};\n          position: relative;\n          display: flex;\n          align-items: center;\n          gap: 10px;\n          page-break-after: avoid !important;\n          break-after: avoid !important;\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n        }\n\n        .section-title::before {\n          content: '';\n          position: absolute;\n          left: 0;\n          top: 0;\n          bottom: 0;\n          width: 4px;\n          background: ${this.COLORS.primary};\n        }\n\n        .section-icon {\n          font-size: 20px;\n        }\n\n        .section-content {\n          padding: ${this.LAYOUT.spacing.card};\n        }\n\n        /* Patient Cards Grid */\n        .patients-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .patient-card {\n          background: ${this.COLORS.white};\n          border: 2px solid ${this.COLORS.border};\n          border-radius: 12px;\n          padding: 20px;\n          box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          transition: all 0.3s ease;\n        }\n\n        .patient-card:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 2px 6px rgba(0,0,0,0.15);\n          border-color: ${this.COLORS.primary};\n        }\n\n        .patient-header {\n          display: flex;\n          align-items: center;\n          gap: 15px;\n          margin-bottom: 15px;\n          padding-bottom: 15px;\n          border-bottom: 1px solid ${this.COLORS.border};\n        }\n\n        .patient-avatar {\n          width: 50px;\n          height: 50px;\n          background: ${this.COLORS.primary};\n          color: ${this.COLORS.white};\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 20px;\n          font-weight: bold;\n          flex-shrink: 0;\n        }\n\n        .patient-info {\n          flex: 1;\n        }\n\n        .patient-name {\n          font-size: 16px;\n          font-weight: bold;\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 5px 0;\n        }\n\n        .patient-serial {\n          font-size: 12px;\n          color: ${this.COLORS.text.muted};\n          background: ${this.COLORS.light};\n          padding: 2px 8px;\n          border-radius: 12px;\n          display: inline-block;\n        }\n\n        .patient-details {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 10px;\n        }\n\n        .detail-item {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 8px 0;\n        }\n\n        .detail-label {\n          font-size: 12px;\n          color: ${this.COLORS.text.muted};\n          font-weight: medium;\n        }\n\n        .detail-value {\n          font-size: 12px;\n          color: ${this.COLORS.text.primary};\n          font-weight: bold;\n        }\n\n        .status-active {\n          color: ${this.COLORS.success};\n        }\n\n        .pagination-info {\n          text-align: center;\n          padding: 20px;\n          background: ${this.COLORS.light};\n          border-radius: 8px;\n          margin-top: 20px;\n        }\n\n        .pagination-info p {\n          color: ${this.COLORS.text.muted};\n          font-size: 14px;\n          margin: 0;\n        }\n\n        /* Appointment Cards Grid */\n        .appointments-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .appointment-card {\n          background: ${this.COLORS.white};\n          border: 2px solid ${this.COLORS.border};\n          border-radius: 12px;\n          padding: 20px;\n          box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          transition: all 0.3s ease;\n        }\n\n        .appointment-card:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 2px 6px rgba(0,0,0,0.15);\n          border-color: ${this.COLORS.accent};\n        }\n\n        .appointment-header {\n          display: flex;\n          align-items: center;\n          gap: 15px;\n          margin-bottom: 15px;\n          padding-bottom: 15px;\n          border-bottom: 1px solid ${this.COLORS.border};\n        }\n\n        .appointment-avatar {\n          width: 50px;\n          height: 50px;\n          background: linear-gradient(135deg, ${this.COLORS.accent}, ${this.COLORS.warning});\n          color: ${this.COLORS.white};\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 20px;\n          font-weight: bold;\n          flex-shrink: 0;\n        }\n\n        .appointment-info {\n          flex: 1;\n        }\n\n        .appointment-patient {\n          font-size: 16px;\n          font-weight: bold;\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 5px 0;\n        }\n\n        .appointment-serial {\n          font-size: 12px;\n          color: ${this.COLORS.text.muted};\n          background: ${this.COLORS.light};\n          padding: 2px 8px;\n          border-radius: 12px;\n          display: inline-block;\n        }\n\n        .appointment-details {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 8px;\n        }\n\n        .status-completed {\n          color: ${this.COLORS.success};\n          background: rgba(6, 95, 70, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-cancelled {\n          color: ${this.COLORS.warning};\n          background: rgba(146, 64, 14, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-no-show {\n          color: ${this.COLORS.danger};\n          background: rgba(153, 27, 27, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-scheduled {\n          color: ${this.COLORS.primary};\n          background: rgba(26, 54, 93, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-unknown {\n          color: ${this.COLORS.text.muted};\n          background: rgba(75, 85, 99, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        /* Enhanced Table Styles */\n        table {\n          width: 100%;\n          border-collapse: collapse;\n          margin: ${this.LAYOUT.spacing.element} 0;\n          background: ${this.COLORS.white};\n          border-radius: ${this.LAYOUT.borderRadius};\n          overflow: hidden;\n          box-shadow: 0 2px 10px rgba(0,0,0,0.05);\n        }\n\n        th {\n          background: linear-gradient(135deg, ${this.COLORS.primary} 0%, ${this.COLORS.secondary} 100%);\n          color: ${this.COLORS.white};\n          font-weight: ${this.TYPOGRAPHY.weights.semibold};\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          padding: ${this.LAYOUT.spacing.element};\n          text-align: center;\n          border: none;\n          text-shadow: 0 1px 2px rgba(0,0,0,0.2);\n        }\n\n        td {\n          padding: ${this.LAYOUT.spacing.small} ${this.LAYOUT.spacing.element};\n          text-align: center;\n          border-bottom: 1px solid ${this.COLORS.border};\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          color: ${this.COLORS.text.primary};\n        }\n\n        tr:nth-child(even) {\n          background: ${this.COLORS.light};\n        }\n\n        tr:hover {\n          background: rgba(14, 165, 233, 0.05);\n        }\n\n        /* Enhanced Footer */\n        .report-footer {\n          margin-top: ${this.LAYOUT.spacing.section};\n          padding: ${this.LAYOUT.spacing.card};\n          background: ${this.COLORS.light};\n          border-radius: ${this.LAYOUT.borderRadius};\n          text-align: center;\n          border-top: 3px solid ${this.COLORS.primary};\n        }\n\n        .report-footer p {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          color: ${this.COLORS.text.secondary};\n          margin-bottom: 5px;\n        }\n\n        .report-footer .generated-info {\n          font-size: ${this.TYPOGRAPHY.sizes.tiny};\n          color: ${this.COLORS.text.muted};\n          font-style: italic;\n        }\n\n        /* Enhanced Data Table Styles */\n        .data-table {\n          width: 100%;\n          border-collapse: collapse;\n          margin: ${this.LAYOUT.spacing.element} 0;\n          background: ${this.COLORS.white};\n          border-radius: ${this.LAYOUT.borderRadius};\n          overflow: visible;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          page-break-before: auto;\n          page-break-after: auto;\n          display: table !important;\n        }\n\n        .data-table th {\n          background: ${this.COLORS.primary};\n          color: ${this.COLORS.white};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          padding: ${this.LAYOUT.spacing.element};\n          text-align: center;\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          border: 2px solid ${this.COLORS.border};\n          border-bottom: 3px solid ${this.COLORS.secondary};\n        }\n\n        .data-table td {\n          padding: ${this.LAYOUT.spacing.element};\n          text-align: center;\n          border: 1px solid ${this.COLORS.border};\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          color: ${this.COLORS.text.primary};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          page-break-inside: avoid;\n          break-inside: avoid;\n        }\n\n        .data-table tr {\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          page-break-before: avoid !important;\n          page-break-after: avoid !important;\n          display: table-row !important;\n        }\n\n        .data-table thead {\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          page-break-after: avoid !important;\n          display: table-header-group !important;\n        }\n\n        .data-table tbody {\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          display: table-row-group !important;\n        }\n\n        .data-table tr:nth-child(even) {\n          background: ${this.COLORS.light};\n        }\n\n        .data-table tr:nth-child(odd) {\n          background: ${this.COLORS.white};\n        }\n\n        .data-table tr:hover {\n          background: #e2e8f0;\n        }\n\n        .category-cell {\n          text-align: right !important;\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n        }\n\n        .number-cell {\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.primary};\n        }\n\n        .percentage-cell {\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          color: ${this.COLORS.text.secondary};\n        }\n\n        .chart-cell {\n          width: 150px;\n          padding: 8px !important;\n        }\n\n        .progress-bar {\n          width: 100%;\n          height: 20px;\n          background: ${this.COLORS.light};\n          border: 1px solid ${this.COLORS.border};\n          border-radius: 10px;\n          overflow: hidden;\n          position: relative;\n        }\n\n        .progress-fill {\n          height: 100%;\n          background: ${this.COLORS.primary};\n          border-radius: 8px;\n          transition: width 0.3s ease;\n          position: relative;\n          border: 1px solid ${this.COLORS.secondary};\n        }\n\n        .progress-fill.gender-male {\n          background: #1e40af;\n          border-color: #1e3a8a;\n        }\n\n        .progress-fill.gender-female {\n          background: #be185d;\n          border-color: #9d174d;\n        }\n\n        .progress-fill.trend {\n          background: ${this.COLORS.success};\n          border-color: #047857;\n        }\n\n        .no-data {\n          text-align: center !important;\n          color: ${this.COLORS.text.muted};\n          font-style: italic;\n          padding: 30px !important;\n        }\n\n        .chart-container {\n          background: ${this.COLORS.white};\n          border-radius: 8px;\n          overflow: hidden;\n        }\n\n        /* Enhanced Footer Styles */\n        .footer-content {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          gap: 20px;\n        }\n\n        .footer-left {\n          flex: 1;\n          text-align: right;\n        }\n\n        .footer-right {\n          flex-shrink: 0;\n        }\n\n        .footer-title {\n          margin: 0 0 5px 0;\n          color: ${this.COLORS.text.primary};\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n        }\n\n        .footer-stats {\n          display: flex;\n          gap: 15px;\n          align-items: center;\n        }\n\n        .stat-item {\n          background: ${this.COLORS.white};\n          padding: 8px 12px;\n          border-radius: 20px;\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          color: ${this.COLORS.text.primary};\n          border: 1px solid ${this.COLORS.border};\n        }\n\n        /* Page Break */\n        .page-break {\n          page-break-before: always;\n          break-before: page;\n          height: 0;\n          margin: 0;\n          padding: 0;\n        }\n\n        /* Page Header for New Pages */\n        .page-header {\n          text-align: center;\n          margin: 40px 0 30px 0;\n          padding: 30px 20px;\n          background: linear-gradient(135deg, ${this.COLORS.light} 0%, ${this.COLORS.white} 100%);\n          border-radius: ${this.LAYOUT.borderRadius};\n          border: 2px solid ${this.COLORS.border};\n          position: relative;\n        }\n\n        .page-header::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          height: 4px;\n          background: linear-gradient(90deg, ${this.COLORS.primary}, ${this.COLORS.secondary});\n          border-radius: ${this.LAYOUT.borderRadius} ${this.LAYOUT.borderRadius} 0 0;\n        }\n\n        .page-title {\n          font-size: ${this.TYPOGRAPHY.sizes.h2};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.primary};\n          margin: 0 0 10px 0;\n          text-shadow: 0 1px 2px rgba(0,0,0,0.1);\n        }\n\n        .page-subtitle {\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          color: ${this.COLORS.text.secondary};\n          margin: 0;\n          font-style: italic;\n        }\n\n        /* Analysis Cards */\n        .analysis-cards {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .analysis-card {\n          background: ${this.COLORS.white};\n          border: 1px solid ${this.COLORS.border};\n          border-left: 4px solid ${this.COLORS.primary};\n          border-radius: ${this.LAYOUT.borderRadius};\n          padding: 25px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          display: flex;\n          align-items: center;\n          gap: 20px;\n          transition: all 0.3s ease;\n        }\n\n        .analysis-card:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 15px rgba(0,0,0,0.15);\n        }\n\n        .analysis-icon {\n          width: 60px;\n          height: 60px;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 28px;\n          flex-shrink: 0;\n        }\n\n        .analysis-content {\n          flex: 1;\n        }\n\n        .analysis-content h3 {\n          font-size: ${this.TYPOGRAPHY.sizes.h4};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 15px 0;\n        }\n\n        .analysis-stats {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n          gap: 10px;\n        }\n\n        .stat {\n          display: flex;\n          flex-direction: column;\n          gap: 5px;\n        }\n\n        .stat-label {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          color: ${this.COLORS.text.muted};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n        }\n\n        .stat-value {\n          font-size: ${this.TYPOGRAPHY.sizes.h5};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.primary};\n        }\n\n        /* Inventory Specific Styles */\n        .inventory-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .inventory-card {\n          background: ${this.COLORS.white};\n          border: 1px solid ${this.COLORS.border};\n          border-radius: ${this.LAYOUT.borderRadius};\n          padding: 20px;\n          box-shadow: ${this.LAYOUT.shadows.card};\n          transition: all 0.3s ease;\n          break-inside: avoid;\n          page-break-inside: avoid;\n        }\n\n        .inventory-card:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 6px 25px rgba(0,0,0,0.12);\n        }\n\n        .inventory-header {\n          display: flex;\n          align-items: center;\n          gap: 15px;\n          margin-bottom: 15px;\n          padding-bottom: 15px;\n          border-bottom: 1px solid ${this.COLORS.border};\n        }\n\n        .inventory-avatar {\n          width: 50px;\n          height: 50px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, ${this.COLORS.primary}, ${this.COLORS.secondary});\n          color: ${this.COLORS.white};\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 20px;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          text-transform: uppercase;\n          flex-shrink: 0;\n        }\n\n        .inventory-info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .inventory-name {\n          font-size: ${this.TYPOGRAPHY.sizes.h5};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 5px 0;\n          line-height: 1.3;\n          word-wrap: break-word;\n        }\n\n        .inventory-category {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          color: ${this.COLORS.text.muted};\n          background: ${this.COLORS.light};\n          padding: 4px 8px;\n          border-radius: 12px;\n          display: inline-block;\n        }\n\n        .inventory-details {\n          display: grid;\n          gap: 10px;\n        }\n\n        .status-warning {\n          color: #f59e0b !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .status-success {\n          color: #10b981 !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .status-danger {\n          color: #ef4444 !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .status-info {\n          color: #3b82f6 !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        /* Alert Level Styles */\n        .alert-level {\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          text-align: center;\n        }\n\n        .status-badge {\n          padding: 4px 8px;\n          border-radius: 12px;\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          text-align: center;\n          display: inline-block;\n        }\n\n        .status-badge.critical {\n          background: #fef2f2;\n          color: #dc2626;\n          border: 1px solid #fecaca;\n        }\n\n        .status-badge.warning {\n          background: #fffbeb;\n          color: #d97706;\n          border: 1px solid #fed7aa;\n        }\n\n        .status-badge.safe {\n          background: #f0fdf4;\n          color: #16a34a;\n          border: 1px solid #bbf7d0;\n        }\n\n        /* Expiry Status Styles */\n        .days-cell.expired {\n          color: #dc2626;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .days-cell.expiring {\n          color: #d97706;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .days-cell.safe {\n          color: #16a34a;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .quantity-cell.critical {\n          color: #dc2626;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .quantity-cell.warning {\n          color: #d97706;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .progress-fill.critical {\n          background: linear-gradient(90deg, #dc2626, #ef4444);\n        }\n\n        .progress-fill.warning {\n          background: linear-gradient(90deg, #d97706, #f59e0b);\n        }\n\n        /* Print Optimizations - حماية قوية جداً من انقطاع الجداول */\n        @media print {\n          * {\n            -webkit-print-color-adjust: exact !important;\n            color-adjust: exact !important;\n            print-color-adjust: exact !important;\n          }\n\n          body {\n            margin: 0;\n            padding: 20px;\n            background: white !important;\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          .enhanced-header {\n            background: ${this.COLORS.primary} !important;\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n          }\n\n          .summary-card {\n            break-inside: avoid;\n            page-break-inside: avoid;\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .summary-card::before {\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n          }\n\n          .section {\n            break-inside: avoid;\n            page-break-inside: avoid;\n            border: 1px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .inventory-card {\n            break-inside: avoid;\n            page-break-inside: avoid;\n            border: 1px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .data-table {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            display: table !important;\n            width: 100% !important;\n            table-layout: fixed !important;\n            border-collapse: collapse !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n            margin: 0 !important;\n            position: relative !important;\n          }\n\n          .data-table thead {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-after: avoid !important;\n            display: table-header-group !important;\n          }\n\n          .data-table tbody {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            display: table-row-group !important;\n          }\n\n          .data-table tr {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            display: table-row !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* حماية إضافية للجداول */\n          .data-table td, .data-table th {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* حماية شاملة للأقسام */\n          .section-title {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-after: avoid !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* منع الانقطاع للعناصر المحمية */\n          .no-break {\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n            page-break-before: auto !important;\n            page-break-after: auto !important;\n            display: block !important;\n            overflow: visible !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n            position: relative !important;\n          }\n\n          /* حماية إضافية للجداول الصغيرة */\n          .data-table.small-table {\n            min-height: 200px !important;\n            max-height: 400px !important;\n          }\n\n          /* منع انقطاع الصفوف */\n          .data-table tr.no-break {\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            display: table-row !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* حماية خاصة للخلايا */\n          .data-table td.no-break,\n          .data-table th.no-break {\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n            white-space: nowrap !important;\n            overflow: hidden !important;\n            text-overflow: ellipsis !important;\n          }\n\n          .data-table th {\n            background: ${this.COLORS.primary} !important;\n            color: white !important;\n            border: 2px solid ${this.COLORS.border} !important;\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n          }\n\n          .data-table td {\n            border: 1px solid ${this.COLORS.border} !important;\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n          }\n\n          .progress-fill {\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n            border: 1px solid ${this.COLORS.text.primary} !important;\n          }\n\n          .patient-card {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .appointment-card {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .analysis-card {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          table {\n            break-inside: auto;\n          }\n\n          tr {\n            break-inside: avoid;\n            break-after: auto;\n          }\n\n          .page-break {\n            page-break-before: always !important;\n            break-before: page !important;\n          }\n        }\n      </style>\n    `}static generatePDFFileName(e){const t=new Date,n=`${t.getDate().toString().padStart(2,"0")}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getFullYear()}`,a=t.toTimeString().split(" ")[0].replace(/:/g,"-");return`${{patients:"تقرير_المرضى",appointments:"تقرير_المواعيد",financial:"التقرير_المالي",inventory:"تقرير_المخزون",treatments:"تقرير_العلاجات",comprehensive:"التقرير_الشامل"}[e]||`تقرير_${e}`}_${n}_${a}.pdf`}static exportPatientReport(e,t){return m(this,null,function*(){try{const n=this.createEnhancedPatientReportHTML(e,t),a=this.generatePDFFileName("patients");yield this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting patient report:",n),new Error("فشل في تصدير تقرير المرضى")}})}static exportAppointmentReport(e,t){return m(this,null,function*(){try{const n=Rh.createEnhancedAppointmentReportHTML(e,t),a=this.generatePDFFileName("appointments");yield this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting appointment report:",n),new Error("فشل في تصدير تقرير المواعيد")}})}static exportFinancialReport(e,t){return m(this,null,function*(){try{const n=Rh.createEnhancedFinancialReportHTML(e,t),a=this.generatePDFFileName("financial");yield this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting financial report:",n),new Error("فشل في تصدير التقرير المالي")}})}static exportInventoryReport(e,t){return m(this,null,function*(){try{const n=Rh.createEnhancedInventoryReportHTML(e,t),a=this.generatePDFFileName("inventory");yield this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting inventory report:",n),new Error("فشل في تصدير تقرير المخزون")}})}static filterDataByDateRange(e,t,n){if(!t||!t.start||!t.end)return e;const a=new Date(t.start),s=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),r=new Date(t.end),i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);return e.filter(e=>{const t=e[n];if(!t)return!1;const a=new Date(t);let r;return r=t.includes("T")||t.includes(" ")?a:new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),r>=s&&r<=i})}static exportProfitLossReport(e,t){return m(this,null,function*(){try{const{reportData:n,payments:a,labOrders:s,clinicNeeds:r,inventoryItems:i,clinicExpenses:l,patients:o,appointments:d,filter:c,currency:u}=e,m=this.filterDataByDateRange(a,c,"payment_date"),p=this.filterDataByDateRange(s,c,"order_date"),h=this.filterDataByDateRange(r,c,"created_at"),x=this.filterDataByDateRange(d,c,"created_at"),g=this.filterDataByDateRange(i,c,"created_at"),f={reportData:n,payments:m,labOrders:p,clinicNeeds:h,inventoryItems:g,clinicExpenses:l?this.filterDataByDateRange(l,c,"payment_date"):[],patients:o,appointments:x,filter:c,currency:u},v=Rh.createEnhancedProfitLossReportHTML(f,t),y=this.generatePDFFileName("profit-loss");yield this.convertHTMLToPDF(v,y)}catch(n){throw console.error("Error exporting profit/loss report:",n),new Error("فشل في تصدير تقرير الأرباح والخسائر")}})}static exportComprehensivePendingInvoice(e){return m(this,null,function*(){try{const t=this.createComprehensivePendingInvoiceHTML(e),n=this.generatePDFFileName(`pending-invoice-${e.patient.full_name}`);yield this.convertHTMLToPDF(t,n)}catch(t){throw console.error("Error exporting comprehensive pending invoice:",t),new Error("فشل في تصدير فاتورة المدفوعات المعلقة")}})}static createComprehensivePendingInvoiceHTML(e){const{patient:t,summary:n,settings:a,clinic_info:s}=e,r=e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return"غير محدد";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${n}/${a}/${t.getFullYear()}`}catch(t){return"غير محدد"}},i=e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return"غير محدد";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear();return`${n}/${a}/${s} - ${t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`}catch(t){return"غير محدد"}},l=e=>{try{if(null==s?void 0:s.currency){const t={USD:"$",EUR:"€",SYP:"ل.س",TRY:"₺",SAR:"ر.س"}[s.currency]||s.currency;return`${e.toLocaleString("ar-SA")} ${t}`}return`${e.toLocaleString("ar-SA")} ل.س`}catch(t){return`${e} ل.س`}};return`\n    <!DOCTYPE html>\n    <html dir="rtl" lang="ar">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>فاتورة المدفوعات المعلقة - ${t.full_name}</title>\n      <style>\n        * {\n          margin: 0;\n          padding: 0;\n          box-sizing: border-box;\n        }\n\n        body {\n          font-family: 'Arial', 'Tahoma', sans-serif;\n          direction: rtl;\n          background: white;\n          color: #333;\n          line-height: 1.6;\n          font-size: 14px;\n        }\n\n        .invoice-container {\n          max-width: 800px;\n          margin: 0 auto;\n          padding: 20px;\n          background: white;\n        }\n\n        .header {\n          text-align: center;\n          margin-bottom: 30px;\n          border-bottom: 3px solid #2563eb;\n          padding-bottom: 20px;\n        }\n\n        .header h1 {\n          color: #2563eb;\n          font-size: 28px;\n          margin-bottom: 10px;\n          font-weight: bold;\n        }\n\n        .header .invoice-info {\n          display: flex;\n          justify-content: space-between;\n          margin-top: 15px;\n          font-size: 12px;\n          color: #666;\n        }\n\n        .info-section {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 20px;\n          margin-bottom: 30px;\n        }\n\n        .info-card {\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 15px;\n          background: #f9fafb;\n        }\n\n        .info-card h3 {\n          color: #2563eb;\n          font-size: 16px;\n          margin-bottom: 10px;\n          border-bottom: 1px solid #e5e7eb;\n          padding-bottom: 5px;\n        }\n\n        .info-card p {\n          margin: 5px 0;\n          font-size: 13px;\n        }\n\n        .items-section {\n          margin-bottom: 30px;\n        }\n\n        .items-header {\n          background: #2563eb;\n          color: white;\n          padding: 15px;\n          border-radius: 8px 8px 0 0;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n\n        .items-header h3 {\n          font-size: 18px;\n        }\n\n        .items-badge {\n          background: rgba(255, 255, 255, 0.2);\n          padding: 4px 12px;\n          border-radius: 20px;\n          font-size: 12px;\n        }\n\n        .items-list {\n          border: 1px solid #e5e7eb;\n          border-top: none;\n          border-radius: 0 0 8px 8px;\n        }\n\n        .item-row {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 15px;\n          border-bottom: 1px solid #e5e7eb;\n          transition: background-color 0.2s;\n        }\n\n        .item-row:last-child {\n          border-bottom: none;\n        }\n\n        .item-row:hover {\n          background: #f9fafb;\n        }\n\n        .item-details {\n          flex: 1;\n        }\n\n        .item-title {\n          font-weight: bold;\n          color: #1f2937;\n          margin-bottom: 5px;\n        }\n\n        .item-meta {\n          font-size: 11px;\n          color: #6b7280;\n          display: flex;\n          gap: 15px;\n          flex-wrap: wrap;\n        }\n\n        .item-amount {\n          text-align: left;\n          font-weight: bold;\n          font-size: 16px;\n          color: #059669;\n        }\n\n        .summary-section {\n          background: #f9fafb;\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 20px;\n          margin-bottom: 30px;\n        }\n\n        .summary-title {\n          color: #2563eb;\n          font-size: 18px;\n          margin-bottom: 15px;\n          text-align: center;\n          border-bottom: 1px solid #e5e7eb;\n          padding-bottom: 10px;\n        }\n\n        .summary-row {\n          display: flex;\n          justify-content: space-between;\n          margin: 10px 0;\n          padding: 5px 0;\n        }\n\n        .summary-row.discount {\n          color: #dc2626;\n        }\n\n        .summary-row.tax {\n          color: #2563eb;\n        }\n\n        .summary-row.total {\n          border-top: 2px solid #2563eb;\n          padding-top: 15px;\n          margin-top: 15px;\n          font-size: 20px;\n          font-weight: bold;\n          color: #2563eb;\n        }\n\n        .footer {\n          text-align: center;\n          margin-top: 40px;\n          padding-top: 20px;\n          border-top: 1px solid #e5e7eb;\n          color: #6b7280;\n          font-size: 12px;\n        }\n\n        .date-range {\n          background: #eff6ff;\n          border: 1px solid #bfdbfe;\n          border-radius: 6px;\n          padding: 10px;\n          margin-bottom: 20px;\n          text-align: center;\n          font-size: 12px;\n          color: #1e40af;\n        }\n\n        @media print {\n          body {\n            margin: 0;\n            padding: 0;\n          }\n\n          .invoice-container {\n            max-width: none;\n            margin: 0;\n            padding: 15px;\n          }\n\n          .item-row:hover {\n            background: transparent;\n          }\n        }\n      </style>\n    </head>\n    <body>\n      <div class="invoice-container">\n        \x3c!-- رأس الفاتورة --\x3e\n        <div class="header">\n          <h1>فاتورة المدفوعات المعلقة الشاملة</h1>\n          <div class="invoice-info">\n            <div>رقم الفاتورة: ${e.invoice_number}</div>\n            <div>تاريخ الإصدار: ${r(e.invoice_date)}</div>\n            <div>وقت الإنشاء: ${i(e.generated_at)}</div>\n          </div>\n        </div>\n\n        \x3c!-- نطاق التاريخ --\x3e\n        <div class="date-range">\n          <strong>فترة الفاتورة:</strong> من ${r(n.date_range.from)} إلى ${r(n.date_range.to)}\n        </div>\n\n        \x3c!-- معلومات المريض والعيادة --\x3e\n        <div class="info-section">\n          <div class="info-card">\n            <h3>معلومات المريض</h3>\n            <p><strong>الاسم الكامل:</strong> ${t.full_name}</p>\n            <p><strong>رقم الهاتف:</strong> ${t.phone||"غير محدد"}</p>\n            ${t.email?`<p><strong>البريد الإلكتروني:</strong> ${t.email}</p>`:""}\n            ${t.address?`<p><strong>العنوان:</strong> ${t.address}</p>`:""}\n            <p><strong>تاريخ الميلاد:</strong> ${t.date_of_birth?r(t.date_of_birth):"غير محدد"}</p>\n          </div>\n\n          <div class="info-card">\n            <h3>معلومات العيادة</h3>\n            <p><strong>اسم العيادة:</strong> ${s.clinic_name||"عيادة الأسنان"}</p>\n            ${s.clinic_phone?`<p><strong>هاتف العيادة:</strong> ${s.clinic_phone}</p>`:""}\n            ${s.clinic_address?`<p><strong>عنوان العيادة:</strong> ${s.clinic_address}</p>`:""}\n            ${s.clinic_email?`<p><strong>إيميل العيادة:</strong> ${s.clinic_email}</p>`:""}\n          </div>\n        </div>\n\n        \x3c!-- تفاصيل المدفوعات المعلقة --\x3e\n        <div class="items-section">\n          <div class="items-header">\n            <h3>تفاصيل المدفوعات المعلقة</h3>\n            <div class="items-badge">${n.total_items} عنصر</div>\n          </div>\n\n          <div class="items-list">\n            ${n.items.map((e,t)=>`\n              <div class="item-row">\n                <div class="item-details">\n                  <div class="item-title">\n                    ${t+1}. ${e.appointment_title||e.treatment_type||e.description||"عنصر غير محدد"}\n                  </div>\n                  <div class="item-meta">\n                    ${e.appointment_date?`<span>📅 ${r(e.appointment_date)}</span>`:""}\n                    ${e.tooth_name?`<span>🦷 ${e.tooth_name} (${e.tooth_number})</span>`:""}\n                    ${e.treatment_type?`<span>🔧 ${e.treatment_type}</span>`:""}\n                    ${e.notes?`<span>📝 ${e.notes}</span>`:""}\n                  </div>\n                </div>\n                <div class="item-amount">\n                  ${l(e.amount)}\n                  ${e.discount_amount&&e.discount_amount>0?`<div style="font-size: 11px; color: #dc2626;">خصم: ${l(e.discount_amount)}</div>`:""}\n                </div>\n              </div>\n            `).join("")}\n          </div>\n        </div>\n\n        \x3c!-- ملخص المبالغ --\x3e\n        <div class="summary-section">\n          <h3 class="summary-title">ملخص المبالغ</h3>\n\n          <div class="summary-row">\n            <span>المجموع الفرعي:</span>\n            <span>${l(n.subtotal)}</span>\n          </div>\n\n          ${n.total_discount>0?`\n            <div class="summary-row discount">\n              <span>الخصم (${"percentage"===a.discount_type?`${a.discount_value}%`:"مبلغ ثابت"}):</span>\n              <span>-${l(n.total_discount)}</span>\n            </div>\n            ${a.discount_reason?`\n              <div style="font-size: 11px; color: #6b7280; text-align: center; margin: 5px 0;">\n                سبب الخصم: ${a.discount_reason}\n              </div>\n            `:""}\n          `:""}\n\n          ${n.total_tax>0?`\n            <div class="summary-row tax">\n              <span>الضريبة (${a.tax_rate}%):</span>\n              <span>+${l(n.total_tax)}</span>\n            </div>\n          `:""}\n\n          <div class="summary-row total">\n            <span>المجموع النهائي:</span>\n            <span>${l(n.final_total)}</span>\n          </div>\n        </div>\n\n        \x3c!-- شروط الدفع --\x3e\n        ${a.include_payment_terms&&a.payment_terms_text?`\n          <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 6px; padding: 15px; margin-bottom: 20px;">\n            <h4 style="color: #92400e; margin-bottom: 8px;">شروط الدفع:</h4>\n            <p style="color: #92400e; font-size: 13px;">${a.payment_terms_text}</p>\n          </div>\n        `:""}\n\n        \x3c!-- الملاحظات --\x3e\n        ${a.footer_notes?`\n          <div class="footer">\n            <p>${a.footer_notes}</p>\n          </div>\n        `:""}\n\n        \x3c!-- معلومات إضافية --\x3e\n        <div class="footer">\n          <p>تم إنشاء هذه الفاتورة إلكترونياً في ${i(e.generated_at)}</p>\n          <p>للاستفسارات، يرجى التواصل مع العيادة</p>\n        </div>\n      </div>\n    </body>\n    </html>\n    `}static exportComprehensiveReport(e,t,n,a){return m(this,null,function*(){try{const s=this.createComprehensiveReportHTML(e,t,n,a),r=this.generatePDFFileName("comprehensive");yield this.convertHTMLToPDF(s,r)}catch(s){throw console.error("Error exporting comprehensive report:",s),new Error("فشل في تصدير التقرير الشامل")}})}static exportComprehensiveFinancialReport(e,t){return m(this,null,function*(){try{const n=this.createComprehensiveFinancialReportHTML(e,t),a=this.generatePDFFileName("comprehensive_financial");yield this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting comprehensive financial report:",n),new Error("فشل في تصدير التقرير المالي الشامل")}})}static createEnhancedPatientReportHTML(e,t){var n,a,s;const r=this.createEnhancedHeader("تقرير المرضى",t,"تقرير شامل عن إحصائيات المرضى والتوزيعات"),i=this.createEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المرضى - ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</title>\n        ${i}\n      </head>\n      <body>\n        ${r}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">👥</div>\n            <div class="card-content">\n              <h3>إجمالي المرضى</h3>\n              <div class="number">${e.totalPatients.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">✨</div>\n            <div class="card-content">\n              <h3>المرضى الجدد</h3>\n              <div class="number">${(e.newPatients||0).toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">💚</div>\n            <div class="card-content">\n              <h3>المرضى النشطون</h3>\n              <div class="number">${e.activePatients.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">⏸️</div>\n            <div class="card-content">\n              <h3>المرضى غير النشطين</h3>\n              <div class="number">${(e.totalPatients-e.activePatients).toLocaleString()}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Patient List Section --\x3e\n        ${e.patientsList&&e.patientsList.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📋</span>\n            قائمة المرضى\n          </div>\n          <div class="section-content">\n            <div class="patients-grid">\n              ${e.patientsList.slice(0,50).map((e,t)=>`\n                <div class="patient-card">\n                  <div class="patient-header">\n                    <div class="patient-avatar">\n                      ${(e.full_name||e.first_name||"م").charAt(0)}\n                    </div>\n                    <div class="patient-info">\n                      <h4 class="patient-name">${e.full_name||`${e.first_name||""} ${e.last_name||""}`.trim()}</h4>\n                      <span class="patient-serial">#${e.serial_number||(t+1).toString().padStart(3,"0")}</span>\n                    </div>\n                  </div>\n                  <div class="patient-details">\n                    <div class="detail-item">\n                      <span class="detail-label">الجنس:</span>\n                      <span class="detail-value">${"male"===e.gender?"ذكر":"female"===e.gender?"أنثى":"غير محدد"}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">العمر:</span>\n                      <span class="detail-value">${e.age||"غير محدد"} سنة</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">الهاتف:</span>\n                      <span class="detail-value">${e.phone||"غير محدد"}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">الحالة:</span>\n                      <span class="detail-value status-active">${e.patient_condition||"نشط"}</span>\n                    </div>\n                  </div>\n                </div>\n              `).join("")}\n            </div>\n            ${e.patientsList.length>50?`\n            <div class="pagination-info">\n              <p>عرض أول 50 مريض من إجمالي ${e.patientsList.length.toLocaleString()} مريض</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Age Distribution --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📊</span>\n            توزيع الأعمار\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الفئة العمرية</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${(null==(n=e.ageDistribution)?void 0:n.map(t=>{const n=e.totalPatients>0?(t.count/e.totalPatients*100).toFixed(1):"0.0",a=Math.max(5,parseFloat(n));return`\n                      <tr>\n                        <td class="category-cell">${t.ageGroup}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="percentage-cell">${n}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join(""))||'<tr><td colspan="4" class="no-data">لا توجد بيانات</td></tr>'}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Page Break Before Gender Distribution --\x3e\n        <div class="page-break"></div>\n\n        \x3c!-- Gender Distribution Page Header --\x3e\n        <div class="page-header">\n          <h2 class="page-title">📊 تحليل توزيع الجنس</h2>\n          <p class="page-subtitle">تقرير تفصيلي عن توزيع المرضى حسب الجنس</p>\n        </div>\n\n        \x3c!-- Gender Distribution --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">👥</span>\n            توزيع الجنس\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الجنس</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${(null==(a=e.genderDistribution)?void 0:a.map(t=>{const n=e.totalPatients>0?(t.count/e.totalPatients*100).toFixed(1):"0.0",a=Math.max(5,parseFloat(n));return`\n                      <tr>\n                        <td class="category-cell">${"ذكر"===t.gender?"👨":"أنثى"===t.gender?"👩":"👤"} ${t.gender}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="percentage-cell">${n}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill gender-${"ذكر"===t.gender?"male":"female"}" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join(""))||'<tr><td colspan="4" class="no-data">لا توجد بيانات</td></tr>'}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Gender Analysis Summary --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📈</span>\n            تحليل إحصائي لتوزيع الجنس\n          </div>\n          <div class="section-content">\n            <div class="analysis-cards">\n              ${(null==(s=e.genderDistribution)?void 0:s.map(t=>{const n=e.totalPatients>0?(t.count/e.totalPatients*100).toFixed(1):"0.0",a="ذكر"===t.gender?"👨":"أنثى"===t.gender?"👩":"👤",s="ذكر"===t.gender?"#1e40af":"أنثى"===t.gender?"#be185d":"#374151";return`\n                  <div class="analysis-card" style="border-left-color: ${s}; border-left-width: 6px;">\n                    <div class="analysis-icon" style="background: ${"ذكر"===t.gender?"#dbeafe":"أنثى"===t.gender?"#fce7f3":"#f3f4f6"}; color: ${s}; border: 2px solid ${s};">\n                      ${a}\n                    </div>\n                    <div class="analysis-content">\n                      <h3 style="color: ${s};">${t.gender}</h3>\n                      <div class="analysis-stats">\n                        <div class="stat">\n                          <span class="stat-label">العدد:</span>\n                          <span class="stat-value" style="color: ${s};">${t.count.toLocaleString()}</span>\n                        </div>\n                        <div class="stat">\n                          <span class="stat-label">النسبة:</span>\n                          <span class="stat-value" style="color: ${s};">${n}%</span>\n                        </div>\n                        <div class="stat">\n                          <span class="stat-label">من إجمالي:</span>\n                          <span class="stat-value">${e.totalPatients.toLocaleString()}</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                `}).join(""))||'<p class="no-data">لا توجد بيانات للتحليل</p>'}\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Registration Trend --\x3e\n        ${e.registrationTrend&&e.registrationTrend.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📈</span>\n            اتجاه التسجيل الشهري\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الشهر</th>\n                    <th>عدد المرضى الجدد</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.registrationTrend.map(t=>{const n=Math.max(...e.registrationTrend.map(e=>e.count)),a=n>0?Math.max(5,t.count/n*100):5;return`\n                      <tr>\n                        <td class="category-cell">${t.period}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill trend" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة</p>\n              <p class="generated-info">تاريخ الإنشاء: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</p>\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">📊 ${e.totalPatients.toLocaleString()} مريض</span>\n                <span class="stat-item">✨ ${(e.newPatients||0).toLocaleString()} جديد</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static createPatientReportHTML(e){var t,n;return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المرضى</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 150px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 16px; color: #1e293b; }\n          .summary-card .number { font-size: 24px; font-weight: bold; color: #0ea5e9; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">تقرير المرضى</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>إجمالي المرضى</h3>\n            <div class="number">${e.totalPatients}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المرضى الجدد</h3>\n            <div class="number">${e.newPatients||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المرضى النشطون</h3>\n            <div class="number">${e.activePatients}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المرضى غير النشطين</h3>\n            <div class="number">${e.totalPatients-e.activePatients||0}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">توزيع الأعمار</div>\n          <table>\n            <thead>\n              <tr>\n                <th>الفئة العمرية</th>\n                <th>العدد</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${(null==(t=e.ageDistribution)?void 0:t.map(e=>`\n                <tr>\n                  <td>${e.ageGroup}</td>\n                  <td>${e.count}</td>\n                </tr>\n              `).join(""))||'<tr><td colspan="2">لا توجد بيانات</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n\n        <div class="section">\n          <div class="section-title">توزيع الجنس</div>\n          <table>\n            <thead>\n              <tr>\n                <th>الجنس</th>\n                <th>العدد</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${(null==(n=e.genderDistribution)?void 0:n.map(e=>`\n                <tr>\n                  <td>${"male"===e.gender?"ذكر":"أنثى"}</td>\n                  <td>${e.count}</td>\n                </tr>\n              `).join(""))||'<tr><td colspan="2">لا توجد بيانات</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static createAppointmentReportHTML(e){var t,n;return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المواعيد</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 120px; margin: 5px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #1e293b; }\n          .summary-card .number { font-size: 20px; font-weight: bold; color: #0ea5e9; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">تقرير المواعيد</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>إجمالي المواعيد</h3>\n            <div class="number">${e.totalAppointments}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المكتملة</h3>\n            <div class="number">${e.completedAppointments}</div>\n          </div>\n          <div class="summary-card">\n            <h3>الملغية</h3>\n            <div class="number">${e.cancelledAppointments}</div>\n          </div>\n          <div class="summary-card">\n            <h3>عدم الحضور</h3>\n            <div class="number">${e.noShowAppointments||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>معدل الحضور</h3>\n            <div class="number">${(null==(t=e.attendanceRate)?void 0:t.toFixed(1))||0}%</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">توزيع المواعيد حسب الحالة</div>\n          <table>\n            <thead>\n              <tr>\n                <th>الحالة</th>\n                <th>العدد</th>\n                <th>النسبة المئوية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${(null==(n=e.appointmentsByStatus)?void 0:n.map(e=>{var t;return`\n                <tr>\n                  <td>${this.translateStatus(e.status)}</td>\n                  <td>${e.count}</td>\n                  <td>${(null==(t=e.percentage)?void 0:t.toFixed(1))||0}%</td>\n                </tr>\n              `}).join(""))||'<tr><td colspan="3">لا توجد بيانات</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static createFinancialReportHTML(e){var t,n,a,s,r;return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>التقرير المالي</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 150px; margin: 5px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #1e293b; }\n          .summary-card .number { font-size: 18px; font-weight: bold; color: #0ea5e9; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">التقرير المالي</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>إجمالي الإيرادات</h3>\n            <div class="number">$${(null==(t=e.totalRevenue)?void 0:t.toLocaleString())||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المدفوعات المكتملة</h3>\n            <div class="number">$${(null==(n=e.totalRevenue)?void 0:n.toLocaleString())||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المدفوعات المعلقة</h3>\n            <div class="number">$${(null==(a=e.pendingPayments)?void 0:a.toLocaleString())||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المدفوعات المتأخرة</h3>\n            <div class="number">$${(null==(s=e.overduePayments)?void 0:s.toLocaleString())||0}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">إحصائيات طرق الدفع</div>\n          <table>\n            <thead>\n              <tr>\n                <th>طريقة الدفع</th>\n                <th>المبلغ</th>\n                <th>عدد المعاملات</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${(null==(r=e.paymentMethodStats)?void 0:r.map(e=>{var t;return`\n                <tr>\n                  <td>${this.translatePaymentMethod(e.method)}</td>\n                  <td>${(null==(t=e.amount)?void 0:t.toLocaleString())||0} $</td>\n                  <td>${e.count||0}</td>\n                </tr>\n              `}).join(""))||'<tr><td colspan="3">لا توجد بيانات</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static createInventoryReportHTML(e){var t,n;return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المخزون</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 150px; margin: 5px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #1e293b; }\n          .summary-card .number { font-size: 18px; font-weight: bold; color: #0ea5e9; }\n          .warning { color: #f59e0b !important; }\n          .danger { color: #ef4444 !important; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">تقرير المخزون</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>إجمالي الأصناف</h3>\n            <div class="number">${e.totalItems}</div>\n          </div>\n          <div class="summary-card">\n            <h3>القيمة الإجمالية</h3>\n            <div class="number">${(null==(t=e.totalValue)?void 0:t.toLocaleString())||0} $</div>\n          </div>\n          <div class="summary-card">\n            <h3>أصناف منخفضة المخزون</h3>\n            <div class="number warning">${e.lowStockItems||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>أصناف منتهية الصلاحية</h3>\n            <div class="number danger">${e.expiredItems||0}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">توزيع الأصناف حسب الفئة</div>\n          <table>\n            <thead>\n              <tr>\n                <th>الفئة</th>\n                <th>عدد الأصناف</th>\n                <th>القيمة</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${(null==(n=e.itemsByCategory)?void 0:n.map(e=>{var t;return`\n                <tr>\n                  <td>${e.category}</td>\n                  <td>${e.count}</td>\n                  <td>${(null==(t=e.value)?void 0:t.toLocaleString())||0} $</td>\n                </tr>\n              `}).join(""))||'<tr><td colspan="3">لا توجد بيانات</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n\n        ${e.stockAlerts&&e.stockAlerts.length>0?`\n        <div class="section">\n          <div class="section-title">تنبيهات المخزون</div>\n          <table>\n            <thead>\n              <tr>\n                <th>الصنف</th>\n                <th>الكمية الحالية</th>\n                <th>الحالة</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.stockAlerts.slice(0,10).map(e=>`\n                <tr>\n                  <td>${e.name}</td>\n                  <td>${e.quantity}</td>\n                  <td class="${0===e.quantity?"danger":"warning"}">\n                    ${0===e.quantity?"نفد المخزون":"مخزون منخفض"}\n                  </td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n      </body>\n      </html>\n    `}static createComprehensiveReportHTML(e,t,n,a){var s,r,i,l,o,d;return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>التقرير الشامل</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-section { display: flex; justify-content: space-between; margin: 30px 0; flex-wrap: wrap; }\n          .summary-group { background: #f8fafc; padding: 20px; border-radius: 8px; min-width: 200px; margin: 10px; }\n          .summary-group h3 { margin: 0 0 15px 0; font-size: 16px; color: #0ea5e9; text-align: center; }\n          .summary-item { margin: 8px 0; font-size: 14px; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">التقرير الشامل</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-section">\n          <div class="summary-group">\n            <h3>المرضى</h3>\n            <div class="summary-item">إجمالي: ${e.totalPatients}</div>\n            <div class="summary-item">جدد: ${e.newPatients||0}</div>\n            <div class="summary-item">نشطون: ${e.activePatients}</div>\n          </div>\n          <div class="summary-group">\n            <h3>المواعيد</h3>\n            <div class="summary-item">إجمالي: ${t.totalAppointments}</div>\n            <div class="summary-item">مكتملة: ${t.completedAppointments}</div>\n            <div class="summary-item">معدل الحضور: ${(null==(s=t.attendanceRate)?void 0:s.toFixed(1))||0}%</div>\n          </div>\n          <div class="summary-group">\n            <h3>الإيرادات</h3>\n            <div class="summary-item">إجمالي: ${(null==(r=n.totalRevenue)?void 0:r.toLocaleString())||0} $</div>\n            <div class="summary-item">مكتملة: ${(null==(i=n.totalRevenue)?void 0:i.toLocaleString())||0} $</div>\n          </div>\n          <div class="summary-group">\n            <h3>المخزون</h3>\n            <div class="summary-item">إجمالي الأصناف: ${a.totalItems}</div>\n            <div class="summary-item">القيمة: ${(null==(l=a.totalValue)?void 0:l.toLocaleString())||0} $</div>\n            <div class="summary-item">تنبيهات: ${(a.lowStockItems||0)+(a.expiredItems||0)}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">مؤشرات الأداء الرئيسية</div>\n          <table>\n            <thead>\n              <tr>\n                <th>المؤشر</th>\n                <th>القيمة</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td>معدل نمو المرضى</td>\n                <td>${((e.newPatients||0)/e.totalPatients*100).toFixed(1)}%</td>\n              </tr>\n              <tr>\n                <td>معدل حضور المواعيد</td>\n                <td>${(null==(o=t.attendanceRate)?void 0:o.toFixed(1))||0}%</td>\n              </tr>\n              <tr>\n                <td>معدل الإلغاء</td>\n                <td>${(null==(d=t.cancellationRate)?void 0:d.toFixed(1))||0}%</td>\n              </tr>\n              <tr>\n                <td>متوسط الإيراد لكل مريض</td>\n                <td>${(()=>{try{const{getCurrencyConfig:t,formatCurrencyWithConfig:a,getDefaultCurrency:s}=require("@/lib/utils"),r=t(s());return a((n.totalRevenue||0)/e.totalPatients,r)}catch(t){return`$${((n.totalRevenue||0)/e.totalPatients).toLocaleString()}`}})()}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static convertHTMLToPDF(e,t){return m(this,null,function*(){try{const n=document.createElement("div");n.innerHTML=e,n.style.position="absolute",n.style.left="-9999px",n.style.top="-9999px",n.style.width="800px",n.style.fontFamily="Arial, sans-serif",n.style.direction="rtl",n.style.fontSize="14px",n.style.lineHeight="1.6",n.style.color="#000",n.style.background="#fff",n.style.padding="20px",document.body.appendChild(n),yield new Promise(e=>setTimeout(e,100));const a=yield vt(n,{scale:1.5,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:800,height:n.scrollHeight,scrollX:0,scrollY:0});document.body.removeChild(n);const s=a.toDataURL("image/jpeg",2),r=new yt({orientation:"portrait",unit:"mm",format:"a4"}),i=r.internal.pageSize.getWidth(),l=r.internal.pageSize.getHeight(),o=i-20,d=a.height*o/a.width;let c=d,u=10;for(r.addImage(s,"PNG",10,u,o,d),c-=l-20;c>=0;)u=c-d+10,r.addPage(),r.addImage(s,"PNG",10,u,o,d),c-=l-20;r.save(t)}catch(n){throw console.error("Error converting HTML to PDF:",n),new Error("فشل في تحويل التقرير إلى PDF")}})}static exportTreatmentReport(e,t){return m(this,null,function*(){try{const n=Rh.createEnhancedTreatmentReportHTML(e,t),a=this.generatePDFFileName("treatments");yield this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting treatment report:",n),new Error("فشل في تصدير تقرير العلاجات")}})}static exportIndividualPatientRecord(e,t){return m(this,null,function*(){try{const n=this.createIndividualPatientRecordHTML(e,t),a=(new Date).toLocaleDateString("en-GB").replace(/\//g,"-"),s=`${e.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;yield this.convertHTMLToPDF(n,s)}catch(n){throw console.error("Error exporting individual patient record:",n),new Error("فشل في تصدير سجل المريض")}})}static exportPatientPayments(e,t){return m(this,null,function*(){try{const n=this.createPatientPaymentsHTML(e,t),a=(new Date).toLocaleDateString("en-GB").replace(/\//g,"-"),s=`مدفوعات_${e.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;yield this.convertHTMLToPDF(n,s)}catch(n){throw console.error("Error exporting patient payments:",n),new Error("فشل في تصدير مدفوعات المريض")}})}static exportPatientTreatments(e,t){return m(this,null,function*(){try{const n=this.createPatientTreatmentsHTML(e,t),a=(new Date).toLocaleDateString("en-GB").replace(/\//g,"-"),s=`علاجات_${e.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;yield this.convertHTMLToPDF(n,s)}catch(n){throw console.error("Error exporting patient treatments:",n),new Error("فشل في تصدير علاجات المريض")}})}static exportPatientAppointments(e,t){return m(this,null,function*(){try{const n=this.createPatientAppointmentsHTML(e,t),a=(new Date).toLocaleDateString("en-GB").replace(/\//g,"-"),s=`مواعيد_${e.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;yield this.convertHTMLToPDF(n,s)}catch(n){throw console.error("Error exporting patient appointments:",n),new Error("فشل في تصدير مواعيد المريض")}})}static exportPatientPrescriptions(e,t){return m(this,null,function*(){try{const n=this.createPatientPrescriptionsHTML(e,t),a=(new Date).toLocaleDateString("en-GB").replace(/\//g,"-"),s=`وصفات_${e.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;yield this.convertHTMLToPDF(n,s)}catch(n){throw console.error("Error exporting patient prescriptions:",n),new Error("فشل في تصدير وصفات المريض")}})}static createPatientRecordHTMLForPrint(e,t){return this.createIndividualPatientRecordHTML(e,t)}static createIndividualPatientRecordHTML(e,t){const{patient:n,appointments:a,treatments:s,payments:r,prescriptions:i,labOrders:l,stats:o}=e,d=e=>e?new Date(e).toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",c=e=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR"}).format(e||0),u=(e,t,n,a=!1,s="")=>`\n        <div style="page-break-before: auto; page-break-inside: avoid !important; break-inside: avoid !important; display: block; margin-bottom: 30px;">\n          <div class="section-title" style="page-break-after: avoid !important; break-after: avoid !important; margin-bottom: 10px;">${e}</div>\n          <div style="page-break-inside: avoid !important; break-inside: avoid !important; display: block; overflow: visible;">\n            <table class="data-table" style="page-break-inside: avoid !important; break-inside: avoid !important; width: 100%; table-layout: fixed; border-collapse: collapse; margin: 0;">\n              <thead style="page-break-inside: avoid !important; break-inside: avoid !important; page-break-after: avoid !important;">\n                <tr>\n                  ${t.map(e=>`<th>${e}</th>`).join("")}\n                </tr>\n              </thead>\n              <tbody style="page-break-inside: avoid !important; break-inside: avoid !important;">\n                ${n.join("")}\n                ${a&&s?s:""}\n              </tbody>\n            </table>\n          </div>\n        </div>`;let m=0,p=0;const h=[],x=[];null==r||r.forEach(e=>{e.appointment_id||(e.tooth_treatment_id?h.push(e):x.push(e)),p+=e.amount||0}),null==a||a.forEach(e=>{e.cost&&(m+=e.cost)}),null==s||s.forEach(e=>{e.cost&&(m+=e.cost)}),x.forEach(e=>{const t=e.treatment_cost||e.total_amount||e.amount||0;m+=t});const g=Math.max(0,m-p);let f=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>${n.full_name} - ${d((new Date).toISOString())}</title>\n        <style>\n          * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n          }\n          body {\n            font-family: 'Arial', sans-serif;\n            line-height: 1.6;\n            color: #000;\n            background: #fff;\n            padding: 20px;\n            direction: rtl;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #000;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-name {\n            font-size: 24px;\n            font-weight: bold;\n            margin-bottom: 10px;\n          }\n          .report-title {\n            font-size: 20px;\n            margin-bottom: 5px;\n          }\n          .report-date {\n            font-size: 14px;\n            color: #666;\n          }\n          .patient-info {\n            border: 2px solid #000;\n            padding: 20px;\n            margin-bottom: 30px;\n          }\n          .patient-name {\n            font-size: 22px;\n            font-weight: bold;\n            text-align: center;\n            margin-bottom: 20px;\n            border-bottom: 1px solid #000;\n            padding-bottom: 10px;\n          }\n          .info-row {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 10px;\n            padding: 5px 0;\n            border-bottom: 1px dotted #ccc;\n          }\n          .info-label {\n            font-weight: bold;\n            width: 30%;\n          }\n          .info-value {\n            width: 65%;\n          }\n          .section-title {\n            font-size: 18px;\n            font-weight: bold;\n            margin: 30px 0 15px 0;\n            padding: 10px;\n            border: 2px solid #000;\n            text-align: center;\n            background: #f5f5f5;\n            page-break-after: avoid;\n            break-after: avoid;\n          }\n          .data-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 20px;\n            border: 2px solid #000;\n            page-break-inside: avoid;\n            break-inside: avoid;\n          }\n          .data-table th {\n            background: #f0f0f0;\n            border: 1px solid #000;\n            padding: 10px;\n            text-align: center;\n            font-weight: bold;\n          }\n          .data-table td {\n            border: 1px solid #000;\n            padding: 8px;\n            text-align: center;\n            page-break-inside: avoid;\n            break-inside: avoid;\n          }\n          .data-table tr {\n            page-break-inside: avoid;\n            break-inside: avoid;\n          }\n          .data-table tr:nth-child(even) {\n            background: #f9f9f9;\n          }\n          .financial-summary {\n            border: 2px solid #000;\n            padding: 20px;\n            margin: 20px 0;\n            page-break-before: always;\n            page-break-inside: avoid;\n          }\n          .financial-title {\n            font-size: 18px;\n            font-weight: bold;\n            text-align: center;\n            margin-bottom: 15px;\n            border-bottom: 1px solid #000;\n            padding-bottom: 10px;\n          }\n          .financial-row {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 10px;\n            padding: 5px 0;\n            border-bottom: 1px dotted #ccc;\n          }\n          .financial-label {\n            font-weight: bold;\n          }\n          .financial-amount {\n            font-weight: bold;\n          }\n          .no-data {\n            text-align: center;\n            color: #666;\n            font-style: italic;\n            padding: 20px;\n            border: 1px solid #ccc;\n            margin: 20px 0;\n          }\n          .footer {\n            margin-top: 40px;\n            text-align: center;\n            font-size: 12px;\n            color: #666;\n            border-top: 1px solid #ccc;\n            padding-top: 20px;\n          }\n\n          @media print {\n  .data-table {\n    page-break-inside: avoid;\n    break-inside: avoid;\n    display: table;\n    width: 100%;\n  }\n\n  .data-table thead {\n    display: table-header-group;\n  }\n\n  .data-table tbody {\n    display: table-row-group;\n  }\n\n  .data-table tr {\n    page-break-inside: avoid;\n    break-inside: avoid;\n  }\n\n  .data-table td,\n  .data-table th {\n    page-break-inside: avoid;\n    break-inside: avoid;\n  }\n\n  .section-title {\n    page-break-before: always;\n    break-before: always;\n  }\n}\n\n        </style>\n      </head>\n      <body>\n        \x3c!-- رأس التقرير --\x3e\n        <div class="header">\n          ${(null==t?void 0:t.clinic_logo)&&""!==t.clinic_logo.trim()?`\n            <div style="text-align: center; margin-bottom: 15px;">\n              <img src="${t.clinic_logo}" alt="شعار العيادة" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid #000; object-fit: cover;" />\n            </div>\n          `:""}\n          <div class="clinic-name">${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</div>\n          ${(null==t?void 0:t.doctor_name)?`<div style="font-size: 16px; margin-bottom: 10px;">د. ${t.doctor_name}</div>`:""}\n          <div class="report-title">سجل المريض الطبي</div>\n          <div class="report-date">تاريخ التقرير: ${d((new Date).toISOString())}</div>\n        </div>\n\n        \x3c!-- معلومات المريض الأساسية --\x3e\n        <div class="patient-info">\n          <div class="patient-name">${n.full_name}</div>\n          <div class="info-row">\n            <span class="info-label">العمر:</span>\n            <span class="info-value">${n.age} سنة</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">الجنس:</span>\n            <span class="info-value">${"male"===n.gender?"ذكر":"أنثى"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">رقم الهاتف:</span>\n            <span class="info-value">${n.phone||"غير محدد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">البريد الإلكتروني:</span>\n            <span class="info-value">${n.email||"غير محدد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">العنوان:</span>\n            <span class="info-value">${n.address||"غير محدد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">حالة المريض:</span>\n            <span class="info-value">${n.patient_condition||"غير محدد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">الحساسية:</span>\n            <span class="info-value">${n.allergies||"لا توجد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">الحالات المرضية:</span>\n            <span class="info-value">${n.medical_conditions||"لا توجد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">تاريخ التسجيل:</span>\n            <span class="info-value">${d(n.date_added)}</span>\n          </div>\n        </div>`;if(f+=`\n      \x3c!-- الملخص المالي --\x3e\n      <div class="financial-summary">\n        <div class="header" style="margin-bottom: 30px;">\n          <div class="clinic-name">${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</div>\n          <div class="report-title">الملخص المالي للمريض</div>\n          <div class="report-date">${n.full_name} - ${d((new Date).toISOString())}</div>\n        </div>\n\n        <div class="financial-title">تفاصيل الحساب المالي</div>\n        <div class="financial-row">\n          <span class="financial-label">إجمالي التكاليف:</span>\n          <span class="financial-amount">${c(m)}</span>\n        </div>\n        <div class="financial-row">\n          <span class="financial-label">إجمالي المدفوع:</span>\n          <span class="financial-amount">${c(p)}</span>\n        </div>\n        <div class="financial-row">\n          <span class="financial-label">المبلغ المتبقي:</span>\n          <span class="financial-amount">${c(g)}</span>\n        </div>\n\n        <div style="margin-top: 30px; padding: 15px; background: #f5f5f5; border-radius: 5px;">\n          <div style="font-weight: bold; margin-bottom: 10px;">ملاحظات مالية:</div>\n          <div style="font-size: 14px; line-height: 1.6;">\n            ${g>0?`• يوجد مبلغ متبقي قدره ${c(g)} يجب تحصيله`:"• تم سداد جميع المستحقات المالية بالكامل"}\n            <br>• تاريخ آخر تحديث: ${d((new Date).toISOString())}\n            <br>• عدد المدفوعات المسجلة: ${r?r.length:0}\n          </div>\n        </div>\n      </div>`,a&&a.length>0){const e=`سجل المواعيد (${a.length})`,t=["التاريخ","الوقت","نوع الموعد","الحالة","الملاحظات"],n=a.map(e=>{const t="completed"===e.status?"مكتمل":"scheduled"===e.status?"مجدول":"cancelled"===e.status?"ملغي":"معلق";return`\n          <tr>\n            <td>${d(e.start_time)}</td>\n            <td>${n=e.start_time,n?new Date(n).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):"غير محدد"}</td>\n            <td>${e.appointment_type||"عام"}</td>\n            <td>${t}</td>\n            <td>${e.notes||"-"}</td>\n          </tr>`;var n});f+=u(e,t,n)}else f+='\n        <div class="section-title">سجل المواعيد</div>\n        <div class="no-data">لا توجد مواعيد مسجلة لهذا المريض</div>';if(s&&s.length>0){const e=`سجل العلاجات (${s.length})`,t=["رقم السن","نوع العلاج","التكلفة","الحالة","التاريخ","المدفوعات المرتبطة","الملاحظات"],n=s.map(e=>{const t="completed"===e.treatment_status?"مكتمل":"in_progress"===e.treatment_status?"قيد التنفيذ":"مخطط",n=ud(e.treatment_name||e.treatment_type||""),a=h.filter(t=>t.tooth_treatment_id===e.id).reduce((e,t)=>e+(t.amount||0),0);return`\n          <tr>\n            <td>${e.tooth_number||"-"}</td>\n            <td>${n}</td>\n            <td>${c(e.cost||0)}</td>\n            <td>${t}</td>\n            <td>${d(e.treatment_date||e.created_at)}</td>\n            <td>${c(a)}</td>\n            <td>${e.notes||"-"}</td>\n          </tr>`});f+=u(e,t,n)}else f+='\n        <div class="section-title">سجل العلاجات</div>\n        <div class="no-data">لا توجد علاجات مسجلة لهذا المريض</div>';if(r&&r.length>0){const e=`السجل المالي الشامل - جميع المدفوعات (${r.length})`,t=["التاريخ","المبلغ المدفوع","المبلغ الإجمالي","طريقة الدفع","النوع","الوصف","الملاحظات"],n=r.map(e=>{const t="cash"===e.payment_method?"نقدي":"card"===e.payment_method?"بطاقة":"bank_transfer"===e.payment_method?"تحويل بنكي":"أخرى";let n="عام",a=e.description||"-";const s={zirconia_post_core:"دعامة زيركونيا - قلب وتد",bone_graft:"ترقيع عظم",crown:"تاج",filling:"حشوة",root_canal:"علاج عصب",extraction:"خلع",cleaning:"تنظيف",implant:"زراعة",bridge:"جسر",veneer:"قشرة",orthodontics:"تقويم",whitening:"تبييض",scaling:"تنظيف الجير",polishing:"تلميع",consultation:"استشارة"};if(e.tooth_treatment_id){n="علاج أسنان";const t=e.treatment_name||e.description||"";a=s[t]||t||"علاج أسنان"}else if(e.appointment_id)n="موعد",a=e.appointment_title||e.description||"موعد";else{const t=e.description||"";a=s[t]||t||"دفعة عامة"}return`\n          <tr>\n            <td>${d(e.payment_date||e.created_at)}</td>\n            <td>${c(e.amount||e.total_amount)}</td>\n            <td>${c(e.treatment_cost||e.total_amount||e.amount)}</td>\n            <td>${t}</td>\n            <td>${n}</td>\n            <td>${a}</td>\n            <td>${e.notes||"-"}</td>\n          </tr>`}),a=r.reduce((e,t)=>e+(t.amount||t.total_amount||0),0),s=r.reduce((e,t)=>e+(t.treatment_cost||t.total_amount||t.amount||0),0),i=`\n        <tr style="background-color: #f8f9fa; font-weight: bold; border-top: 2px solid #dee2e6;">\n          <td style="text-align: right; padding: 12px;">المجموع:</td>\n          <td style="padding: 12px; color: #28a745;">${c(a)}</td>\n          <td style="padding: 12px; color: #007bff;">${c(s)}</td>\n          <td colspan="4"></td>\n        </tr>`;f+=u(e,t,n,!0,i)}else f+='\n        <div class="section-title">سجل المدفوعات</div>\n        <div class="no-data">لا توجد مدفوعات مسجلة لهذا المريض</div>';if(i&&i.length>0){const e=`الوصفات الطبية (${i.length})`,t=["التاريخ","اسم الدواء","الجرعة","التكرار","المدة","تعليمات الاستخدام","الملاحظات"],n=[];i.forEach(e=>{e.medications&&e.medications.length>0?e.medications.forEach((t,a)=>{n.push(`\n              <tr>\n                <td>${d(e.prescription_date||e.created_at)}</td>\n                <td>${t.medication_name||t.name||"-"}</td>\n                <td>${t.dosage||"-"}</td>\n                <td>${t.frequency||"-"}</td>\n                <td>${t.duration||"-"}</td>\n                <td>${t.medication_instructions||t.instructions||"-"}</td>\n                <td>${e.notes||"-"}</td>\n              </tr>`)}):n.push(`\n            <tr>\n              <td>${d(e.prescription_date||e.created_at)}</td>\n              <td>${e.medication_name||"-"}</td>\n              <td>${e.dosage||"-"}</td>\n              <td>${e.frequency||"-"}</td>\n              <td>${e.duration||"-"}</td>\n              <td>${e.instructions||"-"}</td>\n              <td>${e.notes||"-"}</td>\n            </tr>`)}),f+=u(e,t,n)}else f+='\n        <div class="section-title">الوصفات الطبية</div>\n        <div class="no-data">لا توجد وصفات طبية مسجلة لهذا المريض</div>';return l&&l.length>0?(f+=`\n        <div style="page-break-before: auto; page-break-inside: avoid; break-inside: avoid;">\n          <div class="section-title">طلبات المختبر (${l.length})</div>\n          <table class="data-table" style="page-break-inside: avoid !important; break-inside: avoid !important;">\n            <thead>\n              <tr>\n                <th>التاريخ</th>\n                <th>نوع الطلب</th>\n                <th>الحالة</th>\n                <th>التكلفة</th>\n                <th>الملاحظات</th>\n              </tr>\n            </thead>\n            <tbody>`,l.forEach(e=>{const t="completed"===e.status?"مكتمل":"in_progress"===e.status?"قيد التنفيذ":"معلق";f+=`\n            <tr>\n              <td>${d(e.order_date||e.created_at)}</td>\n              <td>${e.order_type||"-"}</td>\n              <td>${t}</td>\n              <td>${c(e.cost||0)}</td>\n              <td>${e.notes||"-"}</td>\n            </tr>`}),f+="\n            </tbody>\n          </table>\n        </div>"):f+='\n        <div class="section-title">طلبات المختبر</div>\n        <div class="no-data">لا توجد طلبات مختبر مسجلة لهذا المريض</div>',n.notes&&(f+=`\n        <div class="section-title">ملاحظات إضافية</div>\n        <div style="border: 1px solid #ccc; padding: 20px; margin: 20px 0;">\n          ${n.notes}\n        </div>`),f+=`\n        <div class="footer">\n          تم إنشاء هذا  التقرير في ${d((new Date).toISOString())} - ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}\n        </div>\n      </body>\n      </html>`,f}static exportClinicNeedsReport(e,t){return m(this,null,function*(){try{const n=this.createClinicNeedsReportHTML(e,t),a=this.generatePDFFileName("clinic-needs");yield this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting clinic needs report:",n),new Error("فشل في تصدير تقرير احتياجات العيادة")}})}static createClinicNeedsReportHTML(e,t){const{title:n,currency:a,isDarkMode:s}=t,r=e=>{try{const{getCurrencyConfig:t,formatCurrencyWithConfig:n}=require("@/lib/utils");return n(e||0,t(a||"USD"))}catch(t){try{return new Intl.NumberFormat("en-US",{style:"currency",currency:a||"USD",minimumFractionDigits:2}).format(e||0)}catch(n){try{const{getCurrencyConfig:t,getDefaultCurrency:n}=require("@/lib/utils"),s=t(a||n()),r=(e||0).toFixed(s.decimals);return"before"===s.position?`${s.symbol}${r}`:`${r} ${s.symbol}`}catch(s){return`$${(e||0).toFixed(2)}`}}}},i=e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return"--";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${n}/${a}/${t.getFullYear()}`}catch(t){return"--"}},l=e=>(e=>e?{pending:"معلق",ordered:"مطلوب",received:"مستلم",cancelled:"ملغي"}[e]||e:"غير محدد")(e),o=e=>(e=>e?{urgent:"عاجل",high:"عالي",medium:"متوسط",low:"منخفض"}[e]||e:"غير محدد")(e);return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>${n}</title>\n        <style>\n          @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap');\n\n          * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n          }\n\n          body {\n            font-family: 'Noto Sans Arabic', Arial, sans-serif;\n            line-height: 1.6;\n            color: ${s?"#e5e7eb":"#1f2937"};\n            background-color: ${s?"#1f2937":"#ffffff"};\n            direction: rtl;\n            padding: 20px;\n          }\n\n          .header {\n            text-align: center;\n            margin-bottom: 30px;\n            border-bottom: 3px solid #3b82f6;\n            padding-bottom: 20px;\n          }\n\n          .header h1 {\n            color: #3b82f6;\n            font-size: 28px;\n            font-weight: 700;\n            margin-bottom: 10px;\n          }\n\n          .header p {\n            color: ${s?"#9ca3af":"#6b7280"};\n            font-size: 14px;\n          }\n\n          .stats-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 20px;\n            margin-bottom: 30px;\n          }\n\n          .stat-card {\n            background: ${s?"#374151":"#f8fafc"};\n            border: 1px solid ${s?"#4b5563":"#e2e8f0"};\n            border-radius: 8px;\n            padding: 20px;\n            text-align: center;\n          }\n\n          .stat-card h3 {\n            color: #3b82f6;\n            font-size: 14px;\n            font-weight: 600;\n            margin-bottom: 8px;\n          }\n\n          .stat-card .value {\n            font-size: 24px;\n            font-weight: 700;\n            color: ${s?"#e5e7eb":"#1f2937"};\n          }\n\n          .section {\n            margin-bottom: 30px;\n          }\n\n          .section h2 {\n            color: #3b82f6;\n            font-size: 20px;\n            font-weight: 600;\n            margin-bottom: 15px;\n            border-bottom: 2px solid #e2e8f0;\n            padding-bottom: 8px;\n          }\n\n          .table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 20px;\n            background: ${s?"#374151":"#ffffff"};\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n          }\n\n          .table th,\n          .table td {\n            padding: 12px;\n            text-align: right;\n            border-bottom: 1px solid ${s?"#4b5563":"#e2e8f0"};\n          }\n\n          .table th {\n            background: ${s?"#4b5563":"#f1f5f9"};\n            font-weight: 600;\n            color: ${s?"#e5e7eb":"#374151"};\n          }\n\n          .table tr:hover {\n            background: ${s?"#4b5563":"#f8fafc"};\n          }\n\n          .badge {\n            display: inline-block;\n            padding: 4px 8px;\n            border-radius: 4px;\n            font-size: 12px;\n            font-weight: 500;\n          }\n\n          .badge-pending { background: #fef3c7; color: #92400e; }\n          .badge-ordered { background: #dbeafe; color: #1e40af; }\n          .badge-received { background: #d1fae5; color: #065f46; }\n          .badge-cancelled { background: #fee2e2; color: #991b1b; }\n          .badge-urgent { background: #fee2e2; color: #991b1b; }\n          .badge-high { background: #fef3c7; color: #92400e; }\n          .badge-medium { background: #dbeafe; color: #1e40af; }\n          .badge-low { background: #d1fae5; color: #065f46; }\n\n          .footer {\n            margin-top: 40px;\n            text-align: center;\n            color: ${s?"#9ca3af":"#6b7280"};\n            font-size: 12px;\n            border-top: 1px solid ${s?"#4b5563":"#e2e8f0"};\n            padding-top: 20px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <h1>${n}</h1>\n          <p>تاريخ التقرير: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()} | ${e.filterInfo||"جميع البيانات"}</p>\n        </div>\n\n        <div class="stats-grid">\n          <div class="stat-card">\n            <h3>إجمالي الاحتياجات</h3>\n            <div class="value">${e.totalNeeds||0}</div>\n          </div>\n          <div class="stat-card">\n            <h3>القيمة الإجمالية</h3>\n            <div class="value">${r(e.totalValue||0)}</div>\n          </div>\n          <div class="stat-card">\n            <h3>الاحتياجات المعلقة</h3>\n            <div class="value">${e.pendingCount||0}</div>\n          </div>\n          <div class="stat-card">\n            <h3>الاحتياجات العاجلة</h3>\n            <div class="value">${e.urgentCount||0}</div>\n          </div>\n          <div class="stat-card">\n            <h3>معدل الإنجاز</h3>\n            <div class="value">${(e.completionRate||0).toFixed(1)}%</div>\n          </div>\n          <div class="stat-card">\n            <h3>متوسط قيمة الاحتياج</h3>\n            <div class="value">${r(e.averageNeedValue||0)}</div>\n          </div>\n        </div>\n\n        ${e.needsByStatus&&e.needsByStatus.length>0?`\n        <div class="section">\n          <h2>توزيع الاحتياجات حسب الحالة</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>الحالة</th>\n                <th>العدد</th>\n                <th>النسبة المئوية</th>\n                <th>القيمة الإجمالية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.needsByStatus.map(e=>`\n                <tr>\n                  <td><span class="badge badge-${e.status}">${l(e.status)}</span></td>\n                  <td>${e.count}</td>\n                  <td>${e.percentage.toFixed(1)}%</td>\n                  <td>${r(e.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.needsByPriority&&e.needsByPriority.length>0?`\n        <div class="section">\n          <h2>توزيع الاحتياجات حسب الأولوية</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>الأولوية</th>\n                <th>العدد</th>\n                <th>النسبة المئوية</th>\n                <th>القيمة الإجمالية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.needsByPriority.map(e=>`\n                <tr>\n                  <td><span class="badge badge-${e.priority}">${o(e.priority)}</span></td>\n                  <td>${e.count}</td>\n                  <td>${e.percentage.toFixed(1)}%</td>\n                  <td>${r(e.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.topExpensiveNeeds&&e.topExpensiveNeeds.length>0?`\n        <div class="section">\n          <h2>الاحتياجات الأغلى سعراً (أعلى 10)</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>اسم الاحتياج</th>\n                <th>الكمية</th>\n                <th>القيمة الإجمالية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.topExpensiveNeeds.map(e=>`\n                <tr>\n                  <td>${e.need_name}</td>\n                  <td>${e.quantity}</td>\n                  <td>${r(e.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.needsByCategory&&e.needsByCategory.length>0?`\n        <div class="section">\n          <h2>توزيع الاحتياجات حسب الفئة</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>الفئة</th>\n                <th>العدد</th>\n                <th>القيمة الإجمالية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.needsByCategory.map(e=>`\n                <tr>\n                  <td>${e.category||"غير محدد"}</td>\n                  <td>${e.count}</td>\n                  <td>${r(e.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.urgentNeeds&&e.urgentNeeds.length>0?`\n        <div class="section">\n          <h2>الاحتياجات العاجلة</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>اسم الاحتياج</th>\n                <th>الحالة</th>\n                <th>الفئة</th>\n                <th>القيمة</th>\n                <th>تاريخ الإنشاء</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.urgentNeeds.slice(0,10).map(e=>`\n                <tr>\n                  <td>${e.need_name}</td>\n                  <td><span class="badge badge-${e.status}">${l(e.status)}</span></td>\n                  <td>${e.category||"غير محدد"}</td>\n                  <td>${r(e.price*e.quantity)}</td>\n                  <td>${i(e.created_at)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.pendingNeeds&&e.pendingNeeds.length>0?`\n        <div class="section">\n          <h2>الاحتياجات المعلقة</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>اسم الاحتياج</th>\n                <th>الفئة</th>\n                <th>الأولوية</th>\n                <th>القيمة</th>\n                <th>تاريخ الإنشاء</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.pendingNeeds.slice(0,10).map(e=>`\n                <tr>\n                  <td>${e.need_name}</td>\n                  <td>${e.category||"غير محدد"}</td>\n                  <td><span class="badge badge-${e.priority}">${o(e.priority)}</span></td>\n                  <td>${r(e.price*e.quantity)}</td>\n                  <td>${i(e.created_at)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.recentlyReceived&&e.recentlyReceived.length>0?`\n        <div class="section">\n          <h2>الاحتياجات المستلمة حديثاً</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>اسم الاحتياج</th>\n                <th>الفئة</th>\n                <th>المورد</th>\n                <th>القيمة</th>\n                <th>تاريخ الإنشاء</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.recentlyReceived.slice(0,10).map(e=>`\n                <tr>\n                  <td>${e.need_name}</td>\n                  <td>${e.category||"غير محدد"}</td>\n                  <td>${e.supplier||"غير محدد"}</td>\n                  <td>${r(e.price*e.quantity)}</td>\n                  <td>${i(e.created_at)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة | ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</p>\n        </div>\n      </body>\n      </html>\n    `}static createComprehensiveFinancialReportHTML(e,t){const n=e=>{try{const{getCurrencyConfig:n,formatCurrencyWithConfig:a,getDefaultCurrency:s}=require("@/lib/utils");return a(e||0,n((null==t?void 0:t.currency)||s()))}catch(n){try{const{getCurrencyConfig:n,getDefaultCurrency:a}=require("@/lib/utils"),s=n((null==t?void 0:t.currency)||a()),r=e.toLocaleString("en-US",{minimumFractionDigits:s.decimals,maximumFractionDigits:s.decimals});return"before"===s.position?`${s.symbol}${r}`:`${r} ${s.symbol}`}catch(a){return`$${e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}}};return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>التقرير المالي الشامل - ${(null==t?void 0:t.clinic_name)||"عيادة الأسنان"}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-name {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-title {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .report-subtitle {\n            font-size: 16px;\n            color: #64748b;\n            margin-bottom: 10px;\n          }\n          .report-date {\n            font-size: 14px;\n            color: #64748b;\n          }\n          .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 20px;\n            margin: 30px 0;\n          }\n          .summary-card {\n            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n            padding: 20px;\n            border-radius: 12px;\n            text-align: center;\n            border: 1px solid #e2e8f0;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n          }\n          .summary-card h3 {\n            margin: 0 0 10px 0;\n            font-size: 14px;\n            color: #64748b;\n            font-weight: 600;\n          }\n          .summary-card .number {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          .profit { color: #10b981 !important; }\n          .loss { color: #ef4444 !important; }\n          .warning { color: #f59e0b !important; }\n          .section {\n            margin: 40px 0;\n            page-break-inside: avoid;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 20px;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .subsection-title {\n            font-size: 16px;\n            font-weight: bold;\n            color: #1e293b;\n            margin: 20px 0 10px 0;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          td {\n            font-size: 13px;\n          }\n          .profit-loss-section {\n            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\n            padding: 25px;\n            border-radius: 12px;\n            border: 1px solid #0ea5e9;\n            margin: 30px 0;\n          }\n          .two-column {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 30px;\n            margin: 20px 0;\n          }\n          .info-box {\n            background: #f8fafc;\n            padding: 15px;\n            border-radius: 8px;\n            border-left: 4px solid #0ea5e9;\n            margin: 15px 0;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n          @media print {\n            body { margin: 0; }\n            .section { page-break-inside: avoid; }\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">${(null==t?void 0:t.clinic_name)||"عيادة الأسنان الحديثة"}</div>\n          <div class="report-title">التقرير المالي الشامل</div>\n          <div class="report-subtitle">تحليل شامل للأرباح والخسائر والإيرادات والمصروفات</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</div>\n          ${e.filterInfo?`<div class="info-box">${e.filterInfo}</div>`:""}\n        </div>\n\n        \x3c!-- الإحصائيات المالية الرئيسية --\x3e\n        <div class="section">\n          <div class="section-title">الإحصائيات المالية الرئيسية</div>\n          <div class="summary-grid">\n            <div class="summary-card">\n              <h3>إجمالي الإيرادات</h3>\n              <div class="number profit">${n(e.totalRevenue||0)}</div>\n            </div>\n            <div class="summary-card">\n              <h3>إجمالي المصروفات</h3>\n              <div class="number">${n(e.totalExpenses||0)}</div>\n            </div>\n            <div class="summary-card">\n              <h3>صافي ${e.isProfit?"الربح":"الخسارة"}</h3>\n              <div class="number ${e.isProfit?"profit":"loss"}">\n                ${n(e.isProfit?e.netProfit||0:e.lossAmount||0)}\n              </div>\n            </div>\n            <div class="summary-card">\n              <h3>هامش الربح</h3>\n              <div class="number ${e.profitMargin>=0?"profit":"loss"}">\n                ${(e.profitMargin||0).toFixed(2)}%\n              </div>\n            </div>\n            <div class="summary-card">\n              <h3>المبالغ المعلقة</h3>\n              <div class="number warning">${n(e.totalPending||0)}</div>\n            </div>\n            <div class="summary-card">\n              <h3>المبالغ المتبقية</h3>\n              <div class="number warning">${n(e.totalOverdue||0)}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- تحليل الأرباح والخسائر --\x3e\n        <div class="profit-loss-section">\n          <div class="section-title">تحليل الأرباح والخسائر التفصيلي</div>\n          <div class="two-column">\n            <div>\n              <div class="subsection-title">الإيرادات</div>\n              <table>\n                <tr><td>المدفوعات المكتملة</td><td>${n(e.totalPaid||0)}</td></tr>\n                <tr><td>المدفوعات الجزئية</td><td>${n((e.totalRevenue||0)-(e.totalPaid||0))}</td></tr>\n                <tr><td><strong>إجمالي الإيرادات</strong></td><td><strong>${n(e.totalRevenue||0)}</strong></td></tr>\n              </table>\n            </div>\n            <div>\n              <div class="subsection-title">المصروفات</div>\n              <table>\n                <tr><td>مصروفات العيادة المباشرة</td><td>${n(e.clinicExpensesTotal||0)}</td></tr>\n                <tr><td>مصروفات المخابر</td><td>${n(e.labOrdersTotal||0)}</td></tr>\n                <tr><td>مصروفات الاحتياجات</td><td>${n(e.clinicNeedsTotal||0)}</td></tr>\n                <tr><td>مصروفات المخزون</td><td>${n(e.inventoryExpenses||0)}</td></tr>\n                <tr><td><strong>إجمالي المصروفات</strong></td><td><strong>${n(e.totalExpenses||0)}</strong></td></tr>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- إحصائيات المعاملات --\x3e\n        <div class="section">\n          <div class="section-title">إحصائيات المعاملات</div>\n          <div class="summary-grid">\n            <div class="summary-card">\n              <h3>إجمالي المعاملات</h3>\n              <div class="number">${e.totalTransactions||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>المعاملات المكتملة</h3>\n              <div class="number profit">${e.completedPayments||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>المعاملات الجزئية</h3>\n              <div class="number warning">${e.partialPayments||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>المعاملات المعلقة</h3>\n              <div class="number">${e.pendingPayments||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>معدل النجاح</h3>\n              <div class="number profit">${e.successRate||"0.0"}%</div>\n            </div>\n            <div class="summary-card">\n              <h3>متوسط المعاملة</h3>\n              <div class="number">${n(parseFloat(e.averageTransaction||"0"))}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- توزيع طرق الدفع --\x3e\n        ${e.revenueByPaymentMethod&&e.revenueByPaymentMethod.length>0?`\n        <div class="section">\n          <div class="section-title">توزيع الإيرادات حسب طريقة الدفع</div>\n          <table>\n            <thead>\n              <tr>\n                <th>طريقة الدفع</th>\n                <th>المبلغ</th>\n                <th>النسبة المئوية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.revenueByPaymentMethod.map(e=>`\n                <tr>\n                  <td>${e.method}</td>\n                  <td>${n(e.amount)}</td>\n                  <td>${e.percentage.toFixed(2)}%</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        \x3c!-- توزيع المصروفات حسب النوع --\x3e\n        ${e.expensesByType&&e.expensesByType.length>0?`\n        <div class="section">\n          <div class="section-title">توزيع المصروفات حسب النوع</div>\n          <table>\n            <thead>\n              <tr>\n                <th>نوع المصروف</th>\n                <th>المبلغ</th>\n                <th>النسبة المئوية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.expensesByType.map(e=>`\n                <tr>\n                  <td>${e.type}</td>\n                  <td>${n(e.amount)}</td>\n                  <td>${e.percentage.toFixed(2)}%</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        \x3c!-- تفاصيل المصروفات الحديثة --\x3e\n        ${e.expenses&&e.expenses.length>0?`\n        <div class="section">\n          <div class="section-title">المصروفات الحديثة (آخر 10 مصروفات)</div>\n          <table>\n            <thead>\n              <tr>\n                <th>اسم المصروف</th>\n                <th>النوع</th>\n                <th>المبلغ</th>\n                <th>طريقة الدفع</th>\n                <th>تاريخ الدفع</th>\n                <th>المورد</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.expenses.slice(0,10).map(e=>`\n                <tr>\n                  <td>${e.expense_name||"غير محدد"}</td>\n                  <td>${{salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"}[e.expense_type]||e.expense_type||"غير محدد"}</td>\n                  <td>${n(e.amount||0)}</td>\n                  <td>${{cash:"نقداً",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمان"}[e.payment_method]||e.payment_method||"غير محدد"}</td>\n                  <td>${e.payment_date?(()=>{try{return new Date(e.payment_date).toLocaleDateString("en-GB")}catch(t){return e.payment_date}})():"غير محدد"}</td>\n                  <td>${e.vendor||"غير محدد"}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة | ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</p>\n        </div>\n      </body>\n      </html>\n    `}static translateStatus(e){return pd(e)}static translatePaymentMethod(e){return hd(e)}static formatGregorianDate(e){if(!e||isNaN(e.getTime()))return"غير محدد";return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`}static createPatientPaymentsHTML(e,t){const{patient:n,payments:a}=e,s=t||{},r=e=>{if((null==s?void 0:s.currency)&&"SYP"!==(null==s?void 0:s.currency)){const t={USD:"$",EUR:"€",SYP:"ل.س",TRY:"₺",SAR:"ر.س"}[s.currency]||s.currency;return`${e.toLocaleString("ar-SA")} ${t}`}return`${e.toLocaleString("ar-SA")} ل.س`},i=e=>{const t=new Date(e);if(!t||isNaN(t.getTime()))return"غير محدد";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`};let l=0;const o=[],d=[];null==a||a.forEach(e=>{e.tooth_treatment_id?o.push(e):e.appointment_id&&d.push(e),l+=e.amount||0});let c=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>مدفوعات المريض - ${n.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${(null==s?void 0:s.clinic_name)||"عيادة الأسنان الحديثة"}</h1>\n            ${(null==s?void 0:s.address)?`<p>${s.address}</p>`:""}\n            ${(null==s?void 0:s.phone)?`<p>الهاتف: ${s.phone}</p>`:""}\n            ${(null==s?void 0:s.email)?`<p>البريد الإلكتروني: ${s.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>تقرير مدفوعات المريض</h2>\n            <p>تاريخ التقرير: ${i((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>معلومات المريض</h3>\n          <div class="info-grid">\n            <div><strong>الاسم:</strong> ${n.full_name}</div>\n            <div><strong>الجنس:</strong> ${"male"===n.gender?"ذكر":"أنثى"}</div>\n            <div><strong>العمر:</strong> ${n.age} سنة</div>\n            ${n.phone?`<div><strong>الهاتف:</strong> ${n.phone}</div>`:""}\n            ${n.email?`<div><strong>البريد الإلكتروني:</strong> ${n.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>الملخص المالي</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">إجمالي المدفوعات:</span>\n              <span class="value">${r(l)}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">عدد المدفوعات:</span>\n              <span class="value">${(null==a?void 0:a.length)||0}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">مدفوعات العلاجات:</span>\n              <span class="value">${o.length}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">مدفوعات المواعيد:</span>\n              <span class="value">${d.length}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const e="سجل المدفوعات",t=["التاريخ","المبلغ","طريقة الدفع","النوع","الوصف","رقم الإيصال","الحالة"],n=a.map(e=>{const t=e.tooth_treatment_id?"علاج سني":e.appointment_id?"موعد":"دفعة عامة",n="completed"===e.status?"مكتمل":"partial"===e.status?"جزئي":"معلق",a="cash"===e.payment_method?"نقدي":"تحويل بنكي";return`\n          <tr>\n            <td>${i(e.payment_date)}</td>\n            <td>${r(e.amount)}</td>\n            <td>${a}</td>\n            <td>${t}</td>\n            <td>${e.description||"-"}</td>\n            <td>${e.receipt_number||"-"}</td>\n            <td>${n}</td>\n          </tr>`});c+=`\n        <div class="section-title">${e}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(e=>`<th>${e}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${n.join("")}\n          </tbody>\n        </table>`}else c+='\n        <div class="section-title">سجل المدفوعات</div>\n        <div class="no-data">لا توجد مدفوعات مسجلة لهذا المريض</div>';return c+=`\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة ${(null==s?void 0:s.clinic_name)||"عيادة الأسنان الحديثة"}</p>\n          <p>تاريخ الطباعة: ${i((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,c}static createPatientTreatmentsHTML(e,t){const{patient:n,treatments:a}=e,s=t||{},r=e=>{if((null==s?void 0:s.currency)&&"SYP"!==(null==s?void 0:s.currency)){const t={USD:"$",EUR:"€",SYP:"ل.س",TRY:"₺",SAR:"ر.س"}[s.currency]||s.currency;return`${e.toLocaleString("ar-SA")} ${t}`}return`${e.toLocaleString("ar-SA")} ل.س`},i=e=>{const t=new Date(e);if(!t||isNaN(t.getTime()))return"غير محدد";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`},l=(null==a?void 0:a.length)||0,o=(null==a?void 0:a.filter(e=>"completed"===e.treatment_status).length)||0,d=(null==a?void 0:a.filter(e=>"in_progress"===e.treatment_status).length)||0,c=(null==a?void 0:a.filter(e=>"planned"===e.treatment_status).length)||0,u=(null==a?void 0:a.reduce((e,t)=>e+(t.cost||0),0))||0;let m=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>علاجات المريض - ${n.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${(null==s?void 0:s.clinic_name)||"عيادة الأسنان الحديثة"}</h1>\n            ${(null==s?void 0:s.address)?`<p>${s.address}</p>`:""}\n            ${(null==s?void 0:s.phone)?`<p>الهاتف: ${s.phone}</p>`:""}\n            ${(null==s?void 0:s.email)?`<p>البريد الإلكتروني: ${s.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>تقرير علاجات المريض</h2>\n            <p>تاريخ التقرير: ${i((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>معلومات المريض</h3>\n          <div class="info-grid">\n            <div><strong>الاسم:</strong> ${n.full_name}</div>\n            <div><strong>الجنس:</strong> ${"male"===n.gender?"ذكر":"أنثى"}</div>\n            <div><strong>العمر:</strong> ${n.age} سنة</div>\n            ${n.phone?`<div><strong>الهاتف:</strong> ${n.phone}</div>`:""}\n            ${n.email?`<div><strong>البريد الإلكتروني:</strong> ${n.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>ملخص العلاجات</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">إجمالي العلاجات:</span>\n              <span class="value">${l}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">العلاجات المكتملة:</span>\n              <span class="value">${o}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">العلاجات قيد التنفيذ:</span>\n              <span class="value">${d}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">العلاجات المخططة:</span>\n              <span class="value">${c}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">إجمالي التكلفة:</span>\n              <span class="value">${r(u)}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const e="سجل العلاجات",t=["رقم السن","اسم السن","نوع العلاج","التكلفة","الحالة","تاريخ البدء","تاريخ الانتهاء","الملاحظات"],n=a.map(e=>{const t="completed"===e.treatment_status?"مكتمل":"in_progress"===e.treatment_status?"قيد التنفيذ":"planned"===e.treatment_status?"مخطط":"ملغي",n=ud(e.treatment_type||"");return`\n          <tr>\n            <td>${e.tooth_number||"-"}</td>\n            <td>${e.tooth_name||"-"}</td>\n            <td>${n}</td>\n            <td>${r(e.cost||0)}</td>\n            <td>${t}</td>\n            <td>${e.start_date?i(e.start_date):"-"}</td>\n            <td>${e.completion_date?i(e.completion_date):"-"}</td>\n            <td>${e.notes||"-"}</td>\n          </tr>`});m+=`\n        <div class="section-title">${e}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(e=>`<th>${e}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${n.join("")}\n          </tbody>\n        </table>`}else m+='\n        <div class="section-title">سجل العلاجات</div>\n        <div class="no-data">لا توجد علاجات مسجلة لهذا المريض</div>';return m+=`\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة ${(null==s?void 0:s.clinic_name)||"عيادة الأسنان الحديثة"}</p>\n          <p>تاريخ الطباعة: ${i((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,m}static createPatientAppointmentsHTML(e,t){const{patient:n,appointments:a}=e,s=t||{},r=e=>{if(!e)return"غير محدد";const t=new Date(e);if(!t||isNaN(t.getTime()))return"غير محدد";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`},i=e=>{if(!e)return"غير محدد";const t=new Date(e);return!t||isNaN(t.getTime())?"غير محدد":t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})},l=(null==a?void 0:a.length)||0,o=(null==a?void 0:a.filter(e=>"completed"===e.status).length)||0,d=(null==a?void 0:a.filter(e=>"cancelled"===e.status).length)||0,c=(null==a?void 0:a.filter(e=>"scheduled"===e.status).length)||0,u=(null==a?void 0:a.filter(e=>"no_show"===e.status).length)||0;let m=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>مواعيد المريض - ${n.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${(null==s?void 0:s.clinic_name)||"عيادة الأسنان الحديثة"}</h1>\n            ${(null==s?void 0:s.address)?`<p>${s.address}</p>`:""}\n            ${(null==s?void 0:s.phone)?`<p>الهاتف: ${s.phone}</p>`:""}\n            ${(null==s?void 0:s.email)?`<p>البريد الإلكتروني: ${s.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>تقرير مواعيد المريض</h2>\n            <p>تاريخ التقرير: ${r((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>معلومات المريض</h3>\n          <div class="info-grid">\n            <div><strong>الاسم:</strong> ${n.full_name}</div>\n            <div><strong>الجنس:</strong> ${"male"===n.gender?"ذكر":"أنثى"}</div>\n            <div><strong>العمر:</strong> ${n.age} سنة</div>\n            ${n.phone?`<div><strong>الهاتف:</strong> ${n.phone}</div>`:""}\n            ${n.email?`<div><strong>البريد الإلكتروني:</strong> ${n.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>ملخص المواعيد</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">إجمالي المواعيد:</span>\n              <span class="value">${l}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">المواعيد المكتملة:</span>\n              <span class="value">${o}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">المواعيد المجدولة:</span>\n              <span class="value">${c}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">المواعيد الملغية:</span>\n              <span class="value">${d}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">لم يحضر:</span>\n              <span class="value">${u}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const e="سجل المواعيد",t=["التاريخ","الوقت","نوع الموعد","الحالة","الملاحظات"],n=a.map(e=>{const t="completed"===e.status?"مكتمل":"cancelled"===e.status?"ملغي":"scheduled"===e.status?"مجدول":"no_show"===e.status?"لم يحضر":"معلق",n=(e=>{if(!e)return{date:"غير محدد",time:"غير محدد"};const t=new Date(e);return!t||isNaN(t.getTime())?{date:"غير محدد",time:"غير محدد"}:{date:r(e),time:i(e)}})(e.start_time);return`\n          <tr>\n            <td>${n.date}</td>\n            <td>${n.time}</td>\n            <td>${e.title||e.appointment_type||"فحص عام"}</td>\n            <td>${t}</td>\n            <td>${e.notes||"-"}</td>\n          </tr>`});m+=`\n        <div class="section-title">${e}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(e=>`<th>${e}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${n.join("")}\n          </tbody>\n        </table>`}else m+='\n        <div class="section-title">سجل المواعيد</div>\n        <div class="no-data">لا توجد مواعيد مسجلة لهذا المريض</div>';return m+=`\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة ${(null==s?void 0:s.clinic_name)||"عيادة الأسنان الحديثة"}</p>\n          <p>تاريخ الطباعة: ${r((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,m}static createPatientPrescriptionsHTML(e,t){const{patient:n,prescriptions:a}=e,s=t||{},r=e=>{const t=new Date(e);if(!t||isNaN(t.getTime()))return"غير محدد";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`},i=(null==a?void 0:a.length)||0,l=(null==a?void 0:a.reduce((e,t)=>{var n;return e+((null==(n=t.medications)?void 0:n.length)||0)},0))||0,o=(null==a?void 0:a.filter(e=>{const t=new Date(e.prescription_date),n=new Date;return n.setDate(n.getDate()-30),t>=n}).length)||0;let d=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>وصفات المريض - ${n.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${(null==s?void 0:s.clinic_name)||"عيادة الأسنان الحديثة"}</h1>\n            ${(null==s?void 0:s.address)?`<p>${s.address}</p>`:""}\n            ${(null==s?void 0:s.phone)?`<p>الهاتف: ${s.phone}</p>`:""}\n            ${(null==s?void 0:s.email)?`<p>البريد الإلكتروني: ${s.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>تقرير وصفات المريض</h2>\n            <p>تاريخ التقرير: ${r((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>معلومات المريض</h3>\n          <div class="info-grid">\n            <div><strong>الاسم:</strong> ${n.full_name}</div>\n            <div><strong>الجنس:</strong> ${"male"===n.gender?"ذكر":"أنثى"}</div>\n            <div><strong>العمر:</strong> ${n.age} سنة</div>\n            ${n.phone?`<div><strong>الهاتف:</strong> ${n.phone}</div>`:""}\n            ${n.email?`<div><strong>البريد الإلكتروني:</strong> ${n.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>ملخص الوصفات</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">إجمالي الوصفات:</span>\n              <span class="value">${i}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">إجمالي الأدوية:</span>\n              <span class="value">${l}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">الوصفات الحديثة (30 يوم):</span>\n              <span class="value">${o}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const e="سجل الوصفات",t=["تاريخ الوصفة","اسم الدواء","الجرعة","تعليمات الاستخدام","ملاحظات"],n=[];a.forEach(e=>{e.medications&&e.medications.length>0?e.medications.forEach(t=>{n.push(`\n              <tr>\n                <td>${r(e.prescription_date)}</td>\n                <td>${t.medication_name||t.name||"-"}</td>\n                <td>${t.dose||t.dosage||"-"}</td>\n                <td>${t.medication_instructions||t.instructions||"-"}</td>\n                <td>${e.notes||"-"}</td>\n              </tr>`)}):n.push(`\n            <tr>\n              <td>${r(e.prescription_date)}</td>\n              <td>-</td>\n              <td>-</td>\n              <td>-</td>\n              <td>${e.notes||"-"}</td>\n            </tr>`)}),d+=`\n        <div class="section-title">${e}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(e=>`<th>${e}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${n.join("")}\n          </tbody>\n        </table>`}else d+='\n        <div class="section-title">سجل الوصفات</div>\n        <div class="no-data">لا توجد وصفات مسجلة لهذا المريض</div>';return d+=`\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة ${(null==s?void 0:s.clinic_name)||"عيادة الأسنان الحديثة"}</p>\n          <p>تاريخ الطباعة: ${r((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,d}}function Lh(){var e,t;const{patientReports:n,isLoading:a,isExporting:s,generateReport:r,exportReport:i,currentFilter:l,setFilter:o,clearCache:d}=Sh(),{currency:c,settings:u}=qt(),{toast:h}=yl(),{isDarkMode:x}=Gt(),{patients:g,loadPatients:f}=cl(),[v,y]=ve.useState(""),[b,j]=ve.useState("all"),[w,N]=ve.useState("all");ve.useEffect(()=>{r("patients"),f()},[r,f]),Fh("patients");const _=({title:e,value:t,icon:n,color:a="blue",trend:s,description:r})=>p.jsxs(Lo,{className:vd(a),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:e}),p.jsx(n,{className:`h-4 w-4 ${yd(a)}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:t}),s&&p.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(s.isPositive?"text-green-600":"text-red-600"),children:[p.jsxs("span",{className:"ml-1",children:[Math.abs(s.value),"%"]}),s.isPositive?p.jsx(ki,{className:"h-3 w-3"}):p.jsx(_i,{className:"h-3 w-3"})]}),r&&p.jsx("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:r})]})]}),k=(null==(e=null==n?void 0:n.patientsList)?void 0:e.filter(e=>{var t,n;const a=`${e.first_name} ${e.last_name}`.toLowerCase().includes(v.toLowerCase())||(null==(t=e.phone)?void 0:t.includes(v))||(null==(n=e.email)?void 0:n.toLowerCase().includes(v.toLowerCase())),s="all"===b||(()=>{if(!e.date_of_birth)return"unknown"===b;const t=(new Date).getFullYear()-new Date(e.date_of_birth).getFullYear();switch(b){case"child":return t<18;case"adult":return t>=18&&t<60;case"senior":return t>=60;default:return!0}})();return a&&s&&"all"===w}))||[];return a?p.jsx("div",{className:"flex items-center justify-center py-12",children:p.jsxs("div",{className:"text-center",children:[p.jsx(Fi,{className:"h-12 w-12 animate-pulse text-sky-600 mx-auto mb-4"}),p.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل تقارير المرضى..."})]})}):n?p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"تقارير المرضى"}),p.jsx("p",{className:"text-muted-foreground mt-1",children:"إحصائيات وتحليلات شاملة للمرضى"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){try{d(),yield r("patients"),h({title:"تم التحديث بنجاح",description:"تم تحديث تقارير المرضى بأحدث البيانات"})}catch(e){console.error("Error refreshing patient reports:",e),h({title:"خطأ في التحديث",description:"فشل في تحديث التقارير. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),disabled:a,children:[p.jsx(mi,{className:"w-4 h-4 ml-2 "+(a?"animate-spin":"")}),a?"جاري التحديث...":"تحديث"]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){if(g&&0!==g.length)try{yield ic.exportPatientsToExcel(g),h({title:"تم التصدير بنجاح",description:`تم تصدير تقرير المرضى كملف Excel مع التنسيق الجميل (${g.length} مريض)`})}catch(e){console.error("Error exporting Excel:",e),h({title:"خطأ في التصدير",description:"فشل في تصدير التقرير. يرجى المحاولة مرة أخرى.",variant:"destructive"})}else h({title:"لا توجد بيانات",description:"لا توجد بيانات مرضى للتصدير",variant:"destructive"})}),disabled:s,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير اكسل"]}),p.jsxs(Qi,{variant:"default",size:"sm",onClick:()=>m(this,null,function*(){try{if(!g||0===g.length)return void h({title:"لا توجد بيانات",description:"لا توجد بيانات مرضى للتصدير",variant:"destructive"});const e=g.length,t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1),a=g.filter(e=>new Date(e.created_at)>=n).length,s={children:0,teens:0,adults:0,seniors:0},r={male:0,female:0};let i=0,l=0;g.forEach(e=>{if(e.age&&"number"==typeof e.age&&e.age>0){const t=e.age;i+=t,l++,t<13?s.children++:t<20?s.teens++:t<60?s.adults++:s.seniors++}"male"===e.gender?r.male++:"female"===e.gender&&r.female++});const o={totalPatients:e,newPatientsThisMonth:a,activePatients:e,averageAge:l>0?Math.round(i/l):0,patients:g,ageDistribution:[{ageGroup:"أطفال (0-12)",count:s.children},{ageGroup:"مراهقون (13-19)",count:s.teens},{ageGroup:"بالغون (20-59)",count:s.adults},{ageGroup:"كبار السن (60+)",count:s.seniors}],genderDistribution:[{gender:"ذكور",count:r.male},{gender:"إناث",count:r.female}],registrationTrend:[],filterInfo:"جميع المرضى المسجلين",dataCount:e};yield Mh.exportPatientReport(o,u),h({title:"تم التصدير بنجاح",description:`تم تصدير تقرير المرضى كملف PDF (${e} مريض)`})}catch(e){console.error("Error exporting PDF:",e),h({title:"خطأ في التصدير",description:"فشل في تصدير التقرير كملف PDF. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),disabled:s,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),s?"جاري التصدير...":"تصدير PDF"]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[p.jsx(_,{title:"إجمالي المرضى",value:(null==n?void 0:n.totalPatients)||0,icon:Fi,color:"blue",description:"العدد الكلي للمرضى المسجلين"}),p.jsx(_,{title:"المرضى الجدد",value:(null==n?void 0:n.newPatients)||0,icon:Ci,color:"green",description:"المرضى المسجلين حديثاً"}),p.jsx(_,{title:"المرضى النشطين",value:(null==n?void 0:n.activePatients)||0,icon:$i,color:"emerald",description:"المرضى الذين لديهم مواعيد حديثة"}),p.jsx(_,{title:"المرضى غير النشطين",value:(null==n?void 0:n.inactivePatients)||0,icon:Ti,color:"red",description:"المرضى بدون مواعيد حديثة"})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ii,{className:"w-5 h-5"}),p.jsx("span",{children:"التوزيع العمري"})]}),p.jsxs(Bo,{children:["توزيع المرضى حسب الفئات العمرية (",n.totalPatients," مريض إجمالي)"]})]}),p.jsxs(Yo,{children:[(()=>{const e=Oh(n.ageDistribution);ya("categorical",x),ya("primary",x);const t=wa("demographics",x,e.length),a=ja(x);return 0===e.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ii,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات توزيع عمري متاحة"})]})}):p.jsx(ke,{width:"100%",height:a.responsive.desktop.height,children:p.jsxs(Se,{margin:{top:20,right:30,left:20,bottom:20},children:[p.jsx(De,{data:e,cx:"50%",cy:"50%",labelLine:!1,label:({ageGroup:e,count:t,percent:n})=>t>0?`${e}: ${t} (${(100*n).toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"count",stroke:x?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:e.map((e,n)=>p.jsx($e,{fill:t[n%t.length]},`age-${n}`))}),p.jsx(Ce,{formatter:(e,t)=>[`${e} مريض`,"العدد"],labelFormatter:e=>`الفئة العمرية: ${e}`,contentStyle:a.tooltip})]})})})(),(()=>{const e=Oh(n.ageDistribution),t=wa("demographics",x,e.length);return e.length>0&&p.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:e.map((e,a)=>p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t[a%t.length]}}),p.jsxs("span",{className:"text-muted-foreground",children:[e.ageGroup,": ",e.count," (",Math.round(e.count/n.totalPatients*100),"%)"]})]},`age-legend-${a}`))})})()]})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(dr,{className:"w-5 h-5"}),p.jsx("span",{children:"التوزيع حسب الجنس"})]}),p.jsxs(Bo,{children:["توزيع المرضى حسب الجنس (",n.totalPatients," مريض إجمالي)"]})]}),p.jsxs(Yo,{children:[(()=>{const e=Ph(n.genderDistribution),t=wa("demographics",x,2),a=ya("primary",x),s=ja(x);return 0===e.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(dr,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات توزيع جنس متاحة"})]})}):p.jsx(ke,{width:"100%",height:s.responsive.desktop.height,children:p.jsxs(Ee,{data:e,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:s.bar.barCategoryGap,children:[p.jsx(Te,{strokeDasharray:s.grid.strokeDasharray,stroke:s.grid.stroke,strokeOpacity:s.grid.strokeOpacity}),p.jsx(Ae,{dataKey:"gender",tick:{fontSize:14,fill:x?"#9ca3af":"#6b7280"},axisLine:{stroke:x?"#4b5563":"#d1d5db"},tickLine:{stroke:x?"#4b5563":"#d1d5db"}}),p.jsx(Fe,{tick:{fontSize:14,fill:x?"#9ca3af":"#6b7280"},axisLine:{stroke:x?"#4b5563":"#d1d5db"},tickLine:{stroke:x?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"],allowDecimals:!1,tickFormatter:e=>`${Math.round(e)} مريض`}),p.jsx(Ce,{formatter:(e,t)=>[`${e} مريض`,"العدد"],labelFormatter:e=>`الجنس: ${e}`,contentStyle:s.tooltip}),p.jsx(Pe,{dataKey:"count",fill:a[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100,children:e.map((e,n)=>p.jsx($e,{fill:t[n%t.length]},`cell-${n}`))})]})})})(),(()=>{const e=Ph(n.genderDistribution);return e.length>0&&p.jsx("div",{className:"mt-4 grid grid-cols-2 gap-4 text-sm",children:e.map((e,t)=>p.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:e.gender}),p.jsxs("div",{className:"font-semibold",children:[e.count," مريض (",Math.round(e.count/n.totalPatients*100),"%)"]})]},`gender-summary-${t}`))})})()]})]})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ki,{className:"w-5 h-5"}),p.jsx("span",{children:"اتجاه التسجيل"})]}),p.jsxs(Bo,{children:["عدد المرضى المسجلين شهرياً (",(null==(t=n.registrationTrend)?void 0:t.length)||0," فترة)"]})]}),p.jsxs(Yo,{children:[(()=>{const e=n.registrationTrend||[],t=ya("primary",x);wa("medical",x,1);const a=ja(x);return 0===e.length?p.jsx("div",{className:"flex items-center justify-center h-96 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ki,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات اتجاه تسجيل متاحة"})]})}):p.jsx(ke,{width:"100%",height:a.responsive.large.height,children:p.jsxs(Oe,{data:e,margin:{top:20,right:30,left:20,bottom:20},children:[p.jsx(Te,{strokeDasharray:a.grid.strokeDasharray,stroke:a.grid.stroke,strokeOpacity:a.grid.strokeOpacity}),p.jsx(Ae,{dataKey:"period",tick:{fontSize:12,fill:x?"#9ca3af":"#6b7280"},axisLine:{stroke:x?"#4b5563":"#d1d5db"},tickLine:{stroke:x?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),p.jsx(Fe,{tick:{fontSize:12,fill:x?"#9ca3af":"#6b7280"},axisLine:{stroke:x?"#4b5563":"#d1d5db"},tickLine:{stroke:x?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"],tickFormatter:e=>`${e} مريض`}),p.jsx(Ce,{formatter:(e,t)=>[`${e} مريض`,"عدد المسجلين"],labelFormatter:e=>`الفترة: ${e}`,contentStyle:a.tooltip}),p.jsx(Re,{type:"monotone",dataKey:"count",stroke:t[0],fill:t[0],fillOpacity:.3,strokeWidth:3,connectNulls:!1})]})})})(),(()=>{const e=n.registrationTrend||[];return e.length>0&&p.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[p.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:"أعلى فترة"}),p.jsxs("div",{className:"font-semibold",children:[Math.max(...e.map(e=>e.count))," مريض"]})]}),p.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:"متوسط شهري"}),p.jsxs("div",{className:"font-semibold",children:[Math.round(e.reduce((e,t)=>e+t.count,0)/e.length)," مريض"]})]}),p.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:"إجمالي المسجلين"}),p.jsxs("div",{className:"font-semibold",children:[e.reduce((e,t)=>e+t.count,0)," مريض"]})]})]})})()]})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(Fi,{className:"w-5 h-5"}),p.jsx("span",{children:"قائمة المرضى"})]}),p.jsx(Bo,{children:"قائمة تفصيلية بجميع المرضى"})]}),p.jsxs(Yo,{children:[p.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",dir:"rtl",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx(Ro,{htmlFor:"search",children:"البحث"}),p.jsxs("div",{className:"relative",children:[p.jsx(hi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{id:"search",placeholder:"البحث بالاسم، الهاتف، أو البريد الإلكتروني...",value:v,onChange:e=>y(e.target.value),className:"pl-10",dir:"rtl"})]})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"age-filter",children:"الفئة العمرية"}),p.jsxs(el,{value:b,onValueChange:j,children:[p.jsx(al,{className:"w-40",dir:"rtl",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الأعمار"}),p.jsx(dl,{value:"child",children:"أطفال (أقل من 18)"}),p.jsx(dl,{value:"adult",children:"بالغين (18-59)"}),p.jsx(dl,{value:"senior",children:"كبار السن (60+)"}),p.jsx(dl,{value:"unknown",children:"غير محدد"})]})]})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"status-filter",children:"الحالة"}),p.jsxs(el,{value:w,onValueChange:N,children:[p.jsx(al,{className:"w-32",dir:"rtl",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"الكل"}),p.jsx(dl,{value:"active",children:"نشط"}),p.jsx(dl,{value:"inactive",children:"غير نشط"})]})]})]})]}),p.jsxs("div",{className:"border rounded-lg overflow-hidden",dir:"rtl",children:[p.jsx("div",{className:"overflow-x-auto",children:p.jsxs("table",{className:"w-full table-center-all",dir:"rtl",children:[p.jsx("thead",{className:"bg-muted/50",children:p.jsxs("tr",{children:[p.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"#"}),p.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"الاسم"}),p.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"الهاتف"}),p.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"البريد الإلكتروني"}),p.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"تاريخ التسجيل"}),p.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"العمر"}),p.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"الحالة"})]})}),p.jsx("tbody",{children:k.map((e,t)=>p.jsxs("tr",{className:"hover:bg-muted/50 "+(t%2==0?"bg-background":"bg-muted/30"),children:[p.jsx("td",{className:"p-3 font-medium text-center",children:t+1}),p.jsx("td",{className:"p-3 font-medium text-center table-cell-wrap-truncate-md",children:p.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:e.full_name?e.full_name.charAt(0):(e.first_name||"").charAt(0)}),p.jsx("span",{className:"arabic-enhanced",children:e.full_name||`${e.first_name||""} ${e.last_name||""}`.trim()})]})}),p.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced table-cell-wrap-truncate-sm",children:e.phone||"-"}),p.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced table-cell-wrap-truncate-lg",children:e.email||"-"}),p.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced",children:ma(e.created_at)}),p.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced",children:e.age||(e.date_of_birth?(new Date).getFullYear()-new Date(e.date_of_birth).getFullYear():"-")}),p.jsx("td",{className:"p-3 text-center",children:p.jsx(qo,{variant:"secondary",className:"arabic-enhanced",children:"نشط"})})]},e.id))})]})}),0===k.length&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx(Fi,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),p.jsx("p",{className:"text-muted-foreground",children:"لا توجد نتائج مطابقة للبحث"})]})]})]})]})]}):p.jsxs("div",{className:"text-center py-12",children:[p.jsx(Fi,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"لا توجد بيانات"}),p.jsx("p",{className:"text-muted-foreground",children:"لم يتم العثور على بيانات المرضى"})]})}function Ih(){var e,t,n,a,s,r;const{currency:i,settings:l}=qt(),{inventoryReports:c,isLoading:u,isExporting:h,generateReport:x,exportReport:g,clearCache:f}=Sh(),{isDarkMode:v}=Gt(),{items:y,loadItems:b}=jd(),[j,w]=ve.useState(""),[N,_]=ve.useState("all"),[k,S]=ve.useState("all"),D=Bd({data:y,dateField:"created_at",initialFilter:{preset:"all",startDate:"",endDate:""}});Fh("inventory"),ve.useEffect(()=>{x("inventory"),b()},[x,b]);const $=ya("categorical",v),C=ya("primary",v),E=ja(v),T=({title:e,value:t,icon:n,color:a,trend:s,description:r})=>p.jsx(Lo,{className:vd(a),dir:"rtl",children:p.jsxs(Yo,{className:"p-6",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-muted-foreground text-right",children:e}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse justify-end",children:[p.jsx("p",{className:"text-2xl font-bold text-foreground",children:t}),s&&p.jsxs("div",{className:"flex items-center text-sm "+(s.isPositive?"text-green-600":"text-red-600"),children:[p.jsxs("span",{className:"ml-1",children:[Math.abs(s.value),"%"]}),s.isPositive?p.jsx(ki,{className:"w-4 h-4"}):p.jsx(_i,{className:"w-4 h-4"})]})]})]}),p.jsx("div",{className:`p-3 rounded-full ${yd(a)}`,children:p.jsx(n,{className:"w-6 h-6"})})]}),r&&p.jsx("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:r})]})}),A=(null==(e=null==c?void 0:c.stockAlerts)?void 0:e.filter(e=>{var t;const n=e.name.toLowerCase().includes(j.toLowerCase())||(null==(t=e.category)?void 0:t.toLowerCase().includes(j.toLowerCase())),a="all"===N||e.category===N,s="all"===k||(()=>{const t=new Date,n=e.expiry_date&&new Date(e.expiry_date)<t,a=e.expiry_date&&(()=>{const n=new Date(e.expiry_date),a=Math.ceil((n.getTime()-t.getTime())/864e5);return a<=30&&a>0})(),s=e.quantity<=e.minimum_stock&&e.quantity>0,r=0===e.quantity;switch(k){case"low_stock":return s;case"out_of_stock":return r;case"expired":return n;case"expiring_soon":return a;default:return!0}})();return n&&a&&s}))||[];null==(t=null==c?void 0:c.expiryAlerts)||t.filter(e=>{var t;const n=e.name.toLowerCase().includes(j.toLowerCase())||(null==(t=e.category)?void 0:t.toLowerCase().includes(j.toLowerCase())),a="all"===N||e.category===N;return n&&a});const F=Array.from(new Set([...(null==(n=null==c?void 0:c.stockAlerts)?void 0:n.map(e=>e.category).filter(Boolean))||[],...(null==(a=null==c?void 0:c.expiryAlerts)?void 0:a.map(e=>e.category).filter(Boolean))||[]]));return u?p.jsx("div",{className:"flex items-center justify-center py-12",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ti,{className:"h-12 w-12 animate-pulse text-sky-600 mx-auto mb-4"}),p.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل تقارير المخزون..."})]})}):c?p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"تقارير المخزون"}),p.jsx("p",{className:"text-muted-foreground mt-1",children:"إحصائيات وتحليلات شاملة للمخزون والتنبيهات"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){try{yield x("inventory");const e=new CustomEvent("showToast",{detail:{title:"تم التحديث بنجاح",description:"تم تحديث تقارير المخزون",type:"success"}});window.dispatchEvent(e)}catch(e){const t=new CustomEvent("showToast",{detail:{title:"خطأ في التحديث",description:"فشل في تحديث التقارير",type:"error"}});window.dispatchEvent(t)}}),disabled:u,children:[p.jsx(mi,{className:"w-4 h-4 ml-2 "+(u?"animate-spin":"")}),"تحديث"]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){const e=D.filteredData;if(0!==e.length)try{const t=e.reduce((e,t)=>e+(t.unit_price||t.cost_per_unit||0)*t.quantity,0),n=e.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0).length,a=e.filter(e=>!!e.expiry_date&&new Date(e.expiry_date)<new Date).length,s=e.filter(e=>0===e.quantity).length,r={"نطاق البيانات":D.timeFilter.startDate&&D.timeFilter.endDate?`من ${D.timeFilter.startDate} إلى ${D.timeFilter.endDate}`:"جميع البيانات","إجمالي العناصر":e.length,"القيمة الإجمالية":t,"عناصر منخفضة المخزون":n,"عناصر منتهية الصلاحية":a,"عناصر نفدت من المخزون":s,"تاريخ التقرير":ma(new Date)},i="\ufeff"+["المؤشر,القيمة",...Object.entries(r).map(([e,t])=>`"${e}","${t}"`)].join("\n");yield ExportService.convertCSVToExcel(i,"inventory",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"}),rc.exportSuccess(`تم تصدير تقرير المخزون بنجاح! (${e.length} عنصر)`)}catch(t){console.error("Error exporting CSV:",t),rc.exportError("فشل في تصدير تقرير المخزون")}else rc.noDataToExport("لا توجد بيانات مخزون للتصدير")}),disabled:h,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير اكسل"]}),p.jsxs(Qi,{variant:"default",size:"sm",onClick:()=>m(this,null,function*(){try{const e=D.filteredData;if(0===e.length)return void rc.noDataToExport("لا توجد بيانات مخزون للتصدير");const t=d(o({},c),{totalItems:e.length,totalValue:e.reduce((e,t)=>e+(t.unit_price||t.cost_per_unit||0)*t.quantity,0),lowStockItems:e.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0).length,expiredItems:e.filter(e=>!!e.expiry_date&&new Date(e.expiry_date)<new Date).length,outOfStockItems:e.filter(e=>0===e.quantity).length,inventoryItems:e,filterInfo:D.timeFilter.startDate&&D.timeFilter.endDate?`البيانات من ${D.timeFilter.startDate} إلى ${D.timeFilter.endDate}`:"جميع البيانات",dataCount:e.length});yield Mh.exportInventoryReport(t,l),rc.exportSuccess(`تم تصدير تقرير المخزون كملف PDF بنجاح (${e.length} عنصر)`)}catch(e){console.error("Error exporting PDF:",e),rc.exportError("فشل في تصدير التقرير كملف PDF")}}),disabled:h,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير PDF"]})]})]}),p.jsx(zd,{value:D.timeFilter,onChange:D.handleFilterChange,onClear:D.resetFilter,title:"فلترة زمنية - المخزون",defaultOpen:!1}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[p.jsx(T,{title:"إجمالي العناصر",value:D.filteredData.length,icon:ti,color:"blue",description:"العدد الكلي لعناصر المخزون في الفترة المحددة",trend:D.trend}),p.jsx(T,{title:"القيمة الإجمالية",value:p.jsx(Nh,{amount:D.filteredData.reduce((e,t)=>e+t.unit_price*t.quantity,0),currency:i}),icon:ki,color:"green",description:"القيمة الإجمالية للمخزون في الفترة المحددة"}),p.jsx(T,{title:"مخزون منخفض",value:D.filteredData.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0).length,icon:sr,color:"yellow",description:"عناصر تحتاج إعادة تموين"}),p.jsx(T,{title:"منتهية الصلاحية",value:D.filteredData.filter(e=>!!e.expiry_date&&new Date(e.expiry_date)<new Date).length,icon:hr,color:"red",description:"عناصر منتهية الصلاحية"})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ii,{className:"w-5 h-5"}),p.jsx("span",{children:"التوزيع حسب الفئة"})]}),p.jsx(Bo,{children:"توزيع عناصر المخزون حسب الفئات"})]}),p.jsx(Yo,{children:p.jsx(ke,{width:"100%",height:E.responsive.desktop.height,children:p.jsxs(Se,{margin:{top:20,right:30,left:20,bottom:20},children:[p.jsx(De,{data:c.itemsByCategory.filter(e=>e.count>0),cx:"50%",cy:"50%",labelLine:!1,label:({category:e,count:t,percent:n})=>t>0?`${e}: ${t} (${(100*n).toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"count",stroke:v?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:c.itemsByCategory.filter(e=>e.count>0).map((e,t)=>p.jsx($e,{fill:$[t%$.length]},`cell-${t}`))}),p.jsx(Ce,{formatter:(e,t)=>[e,"عدد العناصر"],labelFormatter:e=>`الفئة: ${e}`,contentStyle:E.tooltip})]})})})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(dr,{className:"w-5 h-5"}),p.jsx("span",{children:"التوزيع حسب المورد"})]}),p.jsx(Bo,{children:"توزيع عناصر المخزون حسب الموردين"})]}),p.jsx(Yo,{children:p.jsx(ke,{width:"100%",height:E.responsive.desktop.height,children:p.jsxs(Ee,{data:c.itemsBySupplier.filter(e=>e.count>0).slice(0,8),margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:"20%",children:[p.jsx(Te,{strokeDasharray:E.grid.strokeDasharray,stroke:E.grid.stroke,strokeOpacity:E.grid.strokeOpacity}),p.jsx(Ae,{dataKey:"supplier",tick:{fontSize:14,fill:v?"#9ca3af":"#6b7280"},axisLine:{stroke:v?"#4b5563":"#d1d5db"},tickLine:{stroke:v?"#4b5563":"#d1d5db"},interval:0}),p.jsx(Fe,{tick:{fontSize:14,fill:v?"#9ca3af":"#6b7280"},axisLine:{stroke:v?"#4b5563":"#d1d5db"},tickLine:{stroke:v?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"]}),p.jsx(Ce,{formatter:(e,t)=>[e,"عدد العناصر"],labelFormatter:e=>`المورد: ${e}`,contentStyle:E.tooltip}),p.jsx(Pe,{dataKey:"count",fill:C[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100})]})})})]})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ki,{className:"w-5 h-5"}),p.jsx("span",{children:"اتجاه الاستخدام"})]}),p.jsx(Bo,{children:"معدل استخدام المخزون شهرياً"})]}),p.jsx(Yo,{children:p.jsx(ke,{width:"100%",height:E.responsive.desktop.height,children:p.jsxs(Oe,{data:c.usageTrend,margin:{top:20,right:30,left:20,bottom:20},children:[p.jsx(Te,{strokeDasharray:E.grid.strokeDasharray,stroke:E.grid.stroke,strokeOpacity:E.grid.strokeOpacity}),p.jsx(Ae,{dataKey:"period",tick:{fontSize:12,fill:v?"#9ca3af":"#6b7280"},axisLine:{stroke:v?"#4b5563":"#d1d5db"}}),p.jsx(Fe,{tick:{fontSize:12,fill:v?"#9ca3af":"#6b7280"},axisLine:{stroke:v?"#4b5563":"#d1d5db"}}),p.jsx(Ce,{formatter:(e,t)=>[e,"معدل الاستخدام"],labelFormatter:e=>`الفترة: ${e}`,contentStyle:E.tooltip}),p.jsx(Re,{type:"monotone",dataKey:"usage",stroke:C[3],fill:C[3],fillOpacity:.3,strokeWidth:3})]})})})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(sr,{className:"w-5 h-5"}),p.jsx("span",{children:"تنبيهات المخزون"})]}),p.jsx(Bo,{children:"العناصر التي تحتاج انتباهك"})]}),p.jsxs(Yo,{children:[p.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx(Ro,{htmlFor:"search",children:"البحث"}),p.jsxs("div",{className:"relative",children:[p.jsx(hi,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{id:"search",placeholder:"البحث بالاسم أو الفئة...",value:j,onChange:e=>w(e.target.value),className:"pr-10"})]})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"category-filter",children:"الفئة"}),p.jsxs(el,{value:N,onValueChange:_,children:[p.jsx(al,{className:"w-40",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الفئات"}),F.map(e=>p.jsx(dl,{value:e,children:e},e))]})]})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"alert-filter",children:"نوع التنبيه"}),p.jsxs(el,{value:k,onValueChange:S,children:[p.jsx(al,{className:"w-40",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع التنبيهات"}),p.jsx(dl,{value:"low_stock",children:"مخزون منخفض"}),p.jsx(dl,{value:"out_of_stock",children:"نفد المخزون"}),p.jsx(dl,{value:"expired",children:"منتهي الصلاحية"}),p.jsx(dl,{value:"expiring_soon",children:"ينتهي قريباً"})]})]})]})]}),p.jsxs("div",{className:"border rounded-lg overflow-hidden",dir:"rtl",children:[p.jsx("div",{className:"overflow-x-auto",children:p.jsxs("table",{className:"w-full table-center-all",children:[p.jsx("thead",{className:"bg-muted",children:p.jsxs("tr",{children:[p.jsx("th",{className:"text-center p-3 font-medium",children:"#"}),p.jsx("th",{className:"text-center p-3 font-medium",children:"اسم العنصر"}),p.jsx("th",{className:"text-center p-3 font-medium",children:"الفئة"}),p.jsx("th",{className:"text-center p-3 font-medium",children:"الكمية الحالية"}),p.jsx("th",{className:"text-center p-3 font-medium",children:"الحد الأدنى"}),p.jsx("th",{className:"text-center p-3 font-medium",children:"تاريخ الانتهاء"}),p.jsx("th",{className:"text-center p-3 font-medium",children:"نوع التنبيه"}),p.jsx("th",{className:"text-center p-3 font-medium",children:"الإجراءات"})]})}),p.jsx("tbody",{children:A.map((e,t)=>{const n=new Date,a=e.expiry_date&&new Date(e.expiry_date)<n,s=e.expiry_date&&(()=>{const t=new Date(e.expiry_date),a=Math.ceil((t.getTime()-n.getTime())/864e5);return a<=30&&a>0})(),r=e.quantity<=e.minimum_stock&&e.quantity>0;let i="",l="";return 0===e.quantity?(i="نفد المخزون",l="destructive"):a?(i="منتهي الصلاحية",l="destructive"):r?(i="مخزون منخفض",l="warning"):s&&(i="ينتهي قريباً",l="warning"),p.jsxs("tr",{className:t%2==0?"bg-background":"bg-muted/50",children:[p.jsx("td",{className:"p-3 font-medium text-center",children:t+1}),p.jsx("td",{className:"p-3 font-medium text-center table-cell-wrap-truncate-md",children:e.name}),p.jsx("td",{className:"p-3 text-muted-foreground text-center table-cell-wrap-truncate-sm",children:e.category||"-"}),p.jsxs("td",{className:"p-3 text-muted-foreground text-center",children:[e.quantity," ",e.unit||"قطعة"]}),p.jsxs("td",{className:"p-3 text-muted-foreground text-center",children:[e.minimum_stock," ",e.unit||"قطعة"]}),p.jsx("td",{className:"p-3 text-muted-foreground text-center",children:e.expiry_date?ma(e.expiry_date):"-"}),p.jsx("td",{className:"p-3 text-center",children:p.jsx(qo,{variant:l,children:i})}),p.jsx("td",{className:"p-3 text-center",children:p.jsx(Qi,{variant:"ghost",size:"sm",children:p.jsx(Fr,{className:"w-4 h-4"})})})]},e.id)})})]})}),0===A.length&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx(ti,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),p.jsx("p",{className:"text-muted-foreground",children:0===(null==(s=null==c?void 0:c.stockAlerts)?void 0:s.length)?"لا توجد تنبيهات للمخزون - جميع العناصر في حالة جيدة":"لا توجد تنبيهات مطابقة للبحث"}),p.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["إجمالي التنبيهات: ",(null==(r=null==c?void 0:c.stockAlerts)?void 0:r.length)||0]})]})]})]})]})]}):p.jsxs("div",{className:"text-center py-12",children:[p.jsx(ti,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"لا توجد بيانات"}),p.jsx("p",{className:"text-muted-foreground",children:"لم يتم العثور على بيانات المخزون"}),p.jsxs(Qi,{onClick:()=>x("inventory"),className:"mt-4",variant:"outline",children:[p.jsx(mi,{className:"w-4 h-4 ml-2"}),"إعادة تحميل"]})]})}function zh(){const{appointmentReports:e,isLoading:t,isExporting:n,generateReport:a,clearCache:s}=Sh(),{appointments:r,loadAppointments:i}=Wo(),{settings:l}=qt(),{isDarkMode:c}=Gt(),u=Bd({data:r,dateField:"start_time",initialFilter:{preset:"all",startDate:"",endDate:""}});Fh("appointments"),ve.useEffect(()=>{a("appointments"),i()},[a,i]);const h=(()=>{const e=u.filteredData.length>0?u.filteredData:r,t=e.length,n=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"cancelled"===e.status).length,s=e.filter(e=>"scheduled"===e.status).length,i=e.filter(e=>"no_show"===e.status).length,l=t>0?Math.round(n/t*1e3)/10:0,o=t>0?Math.round(a/t*1e3)/10:0;return{total:t,completed:n,cancelled:a,pending:s,noShow:i,attendanceRate:l.toFixed(1),cancellationRate:o.toFixed(1),appointmentsByStatus:[],appointmentTrend:[]}})();ya("categorical",c);const x=ya("primary",c),g=wa("status",c,8),f=ja(c),v=(()=>{try{return function(e){return e.filter(e=>e.value>0)}([{name:"مكتمل",value:h.completed,color:g[0]},{name:"مجدول",value:h.pending,color:g[4]},{name:"ملغي",value:h.cancelled,color:g[2]},{name:"لم يحضر",value:h.noShow,color:g[3]}].map(e=>d(o({},e),{percentage:h.total>0?Math.round(e.value/h.total*100):0})))}catch(e){return console.error("Appointment Reports: Error processing status data:",e),[]}})(),y=(()=>{try{if((null==e?void 0:e.appointmentTrend)&&e.appointmentTrend.length>0)return e.appointmentTrend.map(e=>({month:e.period,count:e.count,formattedCount:`${e.count} موعد`}));t=r,n="start_time",Array.isArray(t)&&0!==t.length&&t.every(e=>{const t=e[n];if(!t)return!1;const a=new Date(t);return!isNaN(a.getTime())&&a.getFullYear()>1900&&a.getFullYear()<2100})||console.warn("Appointment Reports: Invalid date data detected");const a=r.reduce((e,t)=>{try{if(!t||!t.start_time)return e;const n=new Date(t.start_time);if(isNaN(n.getTime())||n.getFullYear()<1900||n.getFullYear()>2100)return console.warn("Invalid appointment start_time:",t.start_time),e;const a=n.getMonth(),s=ga(n.getFullYear(),a);return e[s]=(e[s]||0)+1,e}catch(n){return console.warn("Error processing appointment date:",t.start_time,n),e}},{}),s=Object.entries(a).map(([e,t])=>({month:e,count:t,formattedCount:`${t} موعد`})).sort((e,t)=>{const n=new Date(e.month),a=new Date(t.month);return n.getTime()-a.getTime()}).filter(e=>e.count>0);return function(e){return!(!Array.isArray(e)||0===e.length)&&e.every(e=>"object"==typeof e&&null!==e&&Object.values(e).some(e=>"number"==typeof e&&!isNaN(e)&&isFinite(e)))}(s)?s:(console.warn("Appointment Reports: Invalid monthly chart data"),[])}catch(a){return console.error("Appointment Reports: Error processing monthly data:",a),[]}var t,n})();return p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"تقارير المواعيد"}),p.jsx("p",{className:"text-muted-foreground mt-1",children:"إحصائيات وتحليلات شاملة للمواعيد"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){try{s(),yield a("appointments"),yield i();const e=new CustomEvent("showToast",{detail:{title:"تم التحديث بنجاح",description:"تم تحديث تقارير المواعيد",type:"success"}});window.dispatchEvent(e)}catch(e){console.error("Error refreshing appointment reports:",e);const t=new CustomEvent("showToast",{detail:{title:"خطأ في التحديث",description:"فشل في تحديث التقارير",type:"error"}});window.dispatchEvent(t)}}),disabled:t,children:[p.jsx(mi,{className:"w-4 h-4 ml-2 "+(t?"animate-spin":"")}),"تحديث"]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){const e=u.filteredData.length>0?u.filteredData:r;if(0!==e.length)try{const t=u.timeFilter.startDate&&u.timeFilter.endDate?`من ${u.timeFilter.startDate} إلى ${u.timeFilter.endDate}`:"جميع البيانات",n={};e.forEach(e=>{const t=e.treatment_name||"غير محدد";n[t]=(n[t]||0)+1});const a=Object.entries(n).map(([e,t])=>({treatment:e,count:t})).sort((e,t)=>t.count-e.count),s={totalAppointments:h.total,completedAppointments:h.completed,cancelledAppointments:h.cancelled,scheduledAppointments:h.pending,noShowAppointments:h.noShow,attendanceRate:parseFloat(h.attendanceRate),cancellationRate:parseFloat(h.cancellationRate),appointmentsByStatus:v.map(e=>({status:e.name,count:e.value,percentage:h.total>0?e.value/h.total*100:0})),appointmentsByTreatment:a,appointmentsByDay:[],appointmentsByHour:[],peakHours:[],appointmentTrend:[],appointmentsList:e,filterInfo:t,dataCount:e.length},r="\ufeff"+ic.generateAppointmentCSV(s,{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"});yield ic.convertCSVToExcel(r,"appointments",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"}),rc.exportSuccess(`تم تصدير تقرير المواعيد بنجاح! (${e.length} موعد)`)}catch(t){console.error("Error exporting CSV:",t),rc.exportError("فشل في تصدير تقرير المواعيد")}else rc.noDataToExport("لا توجد بيانات مواعيد للتصدير")}),disabled:n,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير اكسل"]}),p.jsxs(Qi,{variant:"default",size:"sm",onClick:()=>m(this,null,function*(){try{const e=u.filteredData.length>0?u.filteredData:r;if(0===e.length)return void rc.noDataToExport("لا توجد بيانات مواعيد للتصدير");const t={totalAppointments:h.total,completedAppointments:h.completed,cancelledAppointments:h.cancelled,noShowAppointments:h.noShow,attendanceRate:parseFloat(h.attendanceRate),cancellationRate:parseFloat(h.cancellationRate),appointmentsByStatus:v.map(e=>({status:e.name,count:e.value,percentage:h.total>0?e.value/h.total*100:0})),peakHours:[],monthlyTrend:y,filterInfo:u.timeFilter.startDate&&u.timeFilter.endDate?`البيانات من ${u.timeFilter.startDate} إلى ${u.timeFilter.endDate}`:"جميع البيانات",dataCount:e.length};yield Mh.exportAppointmentReport(t,l),rc.exportSuccess(`تم تصدير تقرير المواعيد كملف PDF بنجاح (${e.length} موعد)`)}catch(e){console.error("Error exporting PDF:",e),rc.exportError("فشل في تصدير التقرير كملف PDF")}}),disabled:n,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير PDF"]})]})]}),p.jsx(zd,{value:u.timeFilter,onChange:u.handleFilterChange,onClear:u.resetFilter,title:"فلترة زمنية - المواعيد",defaultOpen:!1}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",dir:"rtl",children:[p.jsxs(Lo,{className:vd("purple"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"إجمالي المواعيد"}),p.jsx(hr,{className:`h-4 w-4 ${yd("purple")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:r.length}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"إجمالي المواعيد المسجلة"})]})]}),p.jsxs(Lo,{className:vd("blue"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===u.timeFilter.preset||!u.timeFilter.startDate&&!u.timeFilter.endDate?"المواعيد الحالية":"المواعيد المفلترة"}),p.jsx(Fi,{className:`h-4 w-4 ${yd("blue")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:"all"===u.timeFilter.preset||!u.timeFilter.startDate&&!u.timeFilter.endDate?r.length:u.filteredData.length}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"all"===u.timeFilter.preset||!u.timeFilter.startDate&&!u.timeFilter.endDate?"جميع المواعيد":"المواعيد في الفترة المحددة"}),u.trend&&p.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(u.trend.isPositive?"text-green-600":"text-red-600"),children:[p.jsxs("span",{className:"ml-1",children:[Math.abs(u.trend.changePercent),"%"]}),u.trend.isPositive?p.jsx(ki,{className:"h-3 w-3"}):p.jsx(_i,{className:"h-3 w-3"})]})]})]}),p.jsxs(Lo,{className:vd("emerald"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"المواعيد المكتملة"}),p.jsx(gr,{className:`h-4 w-4 ${yd("emerald")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:h.completed}),p.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["معدل الحضور: ",h.attendanceRate,"%"]})]})]}),p.jsxs(Lo,{className:vd("orange"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"المواعيد الملغية"}),p.jsx(Ri,{className:`h-4 w-4 ${yd("orange")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:h.cancelled}),p.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["معدل الإلغاء: ",h.cancellationRate,"%"]})]})]}),p.jsxs(Lo,{className:vd("cyan"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"المواعيد المجدولة"}),p.jsx(Sr,{className:`h-4 w-4 ${yd("cyan")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:h.pending}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"في انتظار التنفيذ"})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ii,{className:"w-5 h-5"}),p.jsx("span",{children:"توزيع حالات المواعيد"})]}),p.jsxs(Bo,{children:["توزيع المواعيد حسب الحالة (",h.total," موعد إجمالي)"]})]}),p.jsxs(Yo,{children:[0===v.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ii,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات مواعيد متاحة"})]})}):p.jsx(ke,{width:"100%",height:f.responsive.desktop.height,children:p.jsxs(Se,{margin:{top:20,right:30,left:20,bottom:20},children:[p.jsx(De,{data:v,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t,percent:n})=>t>0?`${e}: ${t} (${(100*n).toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"value",stroke:c?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:v.map((e,t)=>p.jsx($e,{fill:e.color},`appointment-status-${t}`))}),p.jsx(Ce,{formatter:(e,t)=>[`${e} موعد`,"العدد"],labelFormatter:e=>`الحالة: ${e}`,contentStyle:f.tooltip})]})}),v.length>0&&p.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:v.map((e,t)=>p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsxs("span",{className:"text-muted-foreground",children:[e.name,": ",e.value," (",e.percentage,"%)"]})]},`status-legend-${t}`))})]})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(dr,{className:"w-5 h-5"}),p.jsx("span",{children:"المواعيد الشهرية"})]}),p.jsxs(Bo,{children:["عدد المواعيد حسب الشهر (",y.length," شهر)"]})]}),p.jsxs(Yo,{children:[0===y.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(dr,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات مواعيد شهرية متاحة"})]})}):p.jsx(ke,{width:"100%",height:f.responsive.desktop.height,children:p.jsxs(Ee,{data:y,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:f.bar.barCategoryGap,children:[p.jsx(Te,{strokeDasharray:f.grid.strokeDasharray,stroke:f.grid.stroke,strokeOpacity:f.grid.strokeOpacity}),p.jsx(Ae,{dataKey:"month",tick:{fontSize:14,fill:c?"#9ca3af":"#6b7280"},axisLine:{stroke:c?"#4b5563":"#d1d5db"},tickLine:{stroke:c?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),p.jsx(Fe,{tick:{fontSize:14,fill:c?"#9ca3af":"#6b7280"},axisLine:{stroke:c?"#4b5563":"#d1d5db"},tickLine:{stroke:c?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"],tickFormatter:e=>`${e} موعد`}),p.jsx(Ce,{formatter:(e,t)=>[`${e} موعد`,"العدد"],labelFormatter:e=>`الشهر: ${e}`,contentStyle:f.tooltip}),p.jsx(Pe,{dataKey:"count",fill:x[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100})]})}),y.length>0&&p.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[p.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:"أعلى شهر"}),p.jsxs("div",{className:"font-semibold",children:[Math.max(...y.map(e=>e.count))," موعد"]})]}),p.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:"متوسط شهري"}),p.jsxs("div",{className:"font-semibold",children:[Math.round(y.reduce((e,t)=>e+t.count,0)/y.length)," موعد"]})]}),p.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:"أقل شهر"}),p.jsxs("div",{className:"font-semibold",children:[Math.min(...y.map(e=>e.count))," موعد"]})]})]})]})]})]})]})}function Bh(e){const t=[],n=[];if(null==e)return t.push("Amount is null or undefined"),{isValid:!1,errors:t,warnings:n,sanitizedValue:0};const a=Number(e);if(isNaN(a))return t.push(`Invalid amount: ${e} cannot be converted to number`),{isValid:!1,errors:t,warnings:n,sanitizedValue:0};if(!isFinite(a))return t.push(`Amount is not finite: ${a}`),{isValid:!1,errors:t,warnings:n,sanitizedValue:0};a<0&&n.push(`Negative amount detected: ${a}`),a>1e6&&n.push(`Very large amount detected: ${a}`);return{isValid:!0,errors:t,warnings:n,sanitizedValue:Math.round(100*a)/100}}function Yh(e){if(!Array.isArray(e))return console.error("Payments is not an array:",e),{validPayments:[],invalidPayments:[],totalErrors:1,totalWarnings:0};const t=[],n=[];let a=0,s=0;return e.forEach((e,r)=>{const i=function(e){const t=[],n=[];if(!e)return t.push("Payment object is null or undefined"),{isValid:!1,errors:t,warnings:n};if(e.id||t.push("Payment ID is missing"),e.patient_id||t.push("Patient ID is missing"),e.payment_date){const n=new Date(e.payment_date);isNaN(n.getTime())&&t.push(`Invalid payment date: ${e.payment_date}`)}else t.push("Payment date is missing");e.payment_method||n.push("Payment method is missing"),e.status||n.push("Payment status is missing");const a=Bh(e.amount);return a.isValid||t.push(...a.errors),n.push(...a.warnings),{isValid:0===t.length,errors:t,warnings:n}}(e);if(a+=i.errors.length,s+=i.warnings.length,i.isValid){const n=Bh(e.amount);t.push(d(o({},e),{amount:n.sanitizedValue||0}))}else console.warn(`Invalid payment at index ${r}:`,i.errors),n.push({payment:e,errors:i.errors,warnings:i.warnings})}),{validPayments:t,invalidPayments:n,totalErrors:a,totalWarnings:s}}function Vh(e){return Bh(e).sanitizedValue||0}u(Mh,"COLORS",{primary:"#1a365d",secondary:"#2c5282",accent:"#92400e",success:"#065f46",warning:"#92400e",danger:"#991b1b",muted:"#374151",light:"#f9fafb",white:"#ffffff",border:"#d1d5db",text:{primary:"#111827",secondary:"#374151",muted:"#4b5563"}}),u(Mh,"TYPOGRAPHY",{fonts:{primary:"'Tajawal', 'Cairo', Arial, sans-serif",secondary:"'Tajawal', Arial, sans-serif",monospace:"'Courier New', monospace"},sizes:{h1:"28px",h2:"24px",h3:"20px",h4:"18px",h5:"16px",body:"14px",small:"12px",tiny:"10px"},weights:{light:"300",normal:"400",medium:"500",semibold:"600",bold:"700"}}),u(Mh,"LAYOUT",{margins:{top:"40px",bottom:"40px",left:"30px",right:"30px"},spacing:{section:"30px",card:"20px",element:"15px",small:"10px"},borderRadius:"12px",shadows:{card:"0 4px 20px rgba(0,0,0,0.08)",header:"0 2px 10px rgba(0,0,0,0.05)"}});class qh{static validateAmount(e){if(null==e)return{isValid:!0,value:0};const t=Number(e);return isNaN(t)?{isValid:!1,value:0,error:`Invalid amount: ${e}`}:isFinite(t)?t<0?{isValid:!1,value:0,error:`Amount cannot be negative: ${e}`}:{isValid:!0,value:Math.round(100*t)/100}:{isValid:!1,value:0,error:`Amount is not finite: ${e}`}}static validatePayments(e){const t=[],n=[];let a=0,s=0,r=0,i=0,l=0;if(!Array.isArray(e))return t.push("Payments data is not an array"),{isValid:!1,errors:t,warnings:n,calculations:{totalRevenue:0,completedAmount:0,partialAmount:0,pendingAmount:0,overdueAmount:0}};e.forEach((e,o)=>{if(!e||"object"!=typeof e)return void t.push(`Payment at index ${o} is invalid`);const d=this.validateAmount(e.amount);if(!d.isValid)return void t.push(`Payment ${e.id||o}: ${d.error}`);const c=d.value;switch(e.status){case"completed":s+=c,a+=c;break;case"partial":const t=this.validateAmount(e.amount_paid||e.amount);t.isValid&&(r+=t.value,a+=t.value);break;case"pending":i+=c;break;case"overdue":l+=c;break;default:n.push(`Payment ${e.id||o}: Unknown status '${e.status}'`)}});const o=s+r;return Math.abs(a-o)>.01&&n.push(`Revenue calculation mismatch: ${a} vs ${o}`),{isValid:0===t.length,errors:t,warnings:n,calculations:{totalRevenue:Math.round(100*a)/100,completedAmount:Math.round(100*s)/100,partialAmount:Math.round(100*r)/100,pendingAmount:Math.round(100*i)/100,overdueAmount:Math.round(100*l)/100}}}static validateExpenses(e){const t=[],n=[];let a=0,s=0,r=0;const i={};return Array.isArray(e)?(e.forEach((e,n)=>{if(!e||"object"!=typeof e)return void t.push(`Expense at index ${n} is invalid`);const l=this.validateAmount(e.amount);if(!l.isValid)return void t.push(`Expense ${e.id||n}: ${l.error}`);const o=l.value;"paid"===e.status?(s+=o,a+=o):"pending"===e.status&&(r+=o);const d=e.expense_type||"other";i[d]=(i[d]||0)+o}),{isValid:0===t.length,errors:t,warnings:n,calculations:{totalExpenses:Math.round(100*a)/100,paidExpenses:Math.round(100*s)/100,pendingExpenses:Math.round(100*r)/100,expensesByType:i}}):(t.push("Expenses data is not an array"),{isValid:!1,errors:t,warnings:n,calculations:{totalExpenses:0,paidExpenses:0,pendingExpenses:0,expensesByType:{}}})}static validateInventory(e){const t=[],n=[];let a=0,s=0,r=0;if(!Array.isArray(e))return t.push("Inventory data is not an array"),{isValid:!1,errors:t,warnings:n,calculations:{totalValue:0,totalItems:0,lowStockItems:0,expiredItems:0}};const i=new Date;return e.forEach((e,l)=>{if(!e||"object"!=typeof e)return void t.push(`Inventory item at index ${l} is invalid`);const o=this.validateAmount(e.quantity),d=this.validateAmount(e.cost_per_unit||0);if(!o.isValid)return void t.push(`Item ${e.id||l}: Invalid quantity`);d.isValid||n.push(`Item ${e.id||l}: Invalid price`);const c=o.value,u=d.value;if(a+=c*u,c<=(e.minimum_stock||0)&&c>0&&s++,e.expiry_date){new Date(e.expiry_date)<i&&r++}}),{isValid:0===t.length,errors:t,warnings:n,calculations:{totalValue:Math.round(100*a)/100,totalItems:e.length,lowStockItems:s,expiredItems:r}}}static validateAllFinancialData(e){const t=[],n=[],a=this.validatePayments(e.payments);t.push(...a.errors),n.push(...a.warnings);let s={calculations:{totalExpenses:0}};e.expenses&&(s=this.validateExpenses(e.expenses),t.push(...s.errors),n.push(...s.warnings));let r={calculations:{totalValue:0}};e.inventory&&(r=this.validateInventory(e.inventory),t.push(...r.errors),n.push(...r.warnings)),e.labOrders&&e.labOrders.forEach((e,a)=>{const s=this.validateAmount(e.paid_amount||0),r=this.validateAmount(e.cost||0);s.isValid||t.push(`Lab order ${a+1}: Invalid paid amount - ${s.error}`),r.isValid||t.push(`Lab order ${a+1}: Invalid cost - ${r.error}`),s.value>r.value&&n.push(`Lab order ${a+1}: Paid amount (${s.value}) exceeds cost (${r.value})`)}),e.clinicNeeds&&e.clinicNeeds.forEach((e,a)=>{const s=this.validateAmount(e.quantity||0),r=this.validateAmount(e.price||0);s.isValid||t.push(`Clinic need ${a+1}: Invalid quantity - ${s.error}`),r.isValid||t.push(`Clinic need ${a+1}: Invalid price - ${r.error}`),s.value<=0&&n.push(`Clinic need ${a+1}: Zero or negative quantity`)});let i=s.calculations.totalExpenses;if(e.inventory){i+=e.inventory.reduce((e,t)=>e+this.validateAmount(t.cost_per_unit||0).value*this.validateAmount(t.quantity||0).value,0)}if(e.labOrders){i+=e.labOrders.reduce((e,t)=>e+this.validateAmount(t.paid_amount||0).value,0)}if(e.clinicNeeds){i+=e.clinicNeeds.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+this.validateAmount(t.quantity||0).value*this.validateAmount(t.price||0).value,0)}const l=a.calculations.totalRevenue,o=l-i,d=l>0?o/l*100:0;return l<0&&t.push("Total revenue cannot be negative"),i<0&&t.push("Total expenses cannot be negative"),{isValid:0===t.length,errors:t,warnings:n,calculations:{totalRevenue:Math.round(100*l)/100,totalExpenses:Math.round(100*i)/100,netProfit:Math.round(100*o)/100,profitMargin:Math.round(100*d)/100}}}}class Uh{static validatePaymentCalculations(e){const t=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},n=e.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,n)=>e+("partial"===n.status&&void 0!==n.amount_paid?t(n.amount_paid):t(n.amount)),0),a=e.filter(e=>"completed"===e.status).reduce((e,n)=>e+t(n.amount),0),s=e.filter(e=>"partial"===e.status).reduce((e,n)=>e+(void 0!==n.amount_paid?t(n.amount_paid):t(n.amount)),0),r=e.filter(e=>"pending"===e.status).reduce((e,n)=>{const a=t(n.amount),s=t(n.total_amount_due);return e+(0===a&&s>0?s:a)},0),i=e.filter(e=>{if("pending"!==e.status)return!1;const t=new Date(e.payment_date),n=new Date;return n.setDate(n.getDate()-30),t<n}).reduce((e,n)=>{const a=t(n.amount),s=t(n.total_amount_due);return e+(0===a&&s>0?s:a)},0),l=a+s;return Math.abs(n-l)>.01&&console.warn("Payment calculation mismatch:",{totalRevenue:n,calculatedTotal:a+s,completedAmount:a,partialAmount:s,difference:n-l}),{totalRevenue:Math.round(100*n)/100,completedAmount:Math.round(100*a)/100,partialAmount:Math.round(100*s)/100,pendingAmount:Math.round(100*r)/100,overdueAmount:Math.round(100*i)/100,isValid:Math.abs(n-l)<=.01}}static validateAppointmentStats(e){const t=e.length,n=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"cancelled"===e.status).length,s=e.filter(e=>"no-show"===e.status).length,r=e.filter(e=>"scheduled"===e.status).length,i=n+a+s+r,l=t-i;0!==l&&console.warn("Appointment status calculation mismatch:",{total:t,calculatedTotal:i,otherStatuses:l,statusBreakdown:{completed:n,cancelled:a,noShow:s,scheduled:r}});return{total:t,completed:n,cancelled:a,noShow:s,scheduled:r,attendanceRate:t>0?Math.round(n/t*100):0,isValid:0===l}}static validateInventoryStats(e){const t=e.length,n=e.reduce((e,t)=>e+(t.unit_price||0)*(t.quantity||0),0),a=e.filter(e=>(e.quantity||0)<=(e.minimum_stock||0)&&(e.quantity||0)>0).length,s=e.filter(e=>0===(e.quantity||0)).length,r=e.filter(e=>(e.quantity||0)>(e.minimum_stock||0)).length,i=a+s+r;return i!==t&&console.warn("Inventory calculation mismatch:",{totalItems:t,calculatedTotal:i,breakdown:{lowStockItems:a,outOfStockItems:s,inStockItems:r}}),{totalItems:t,totalValue:Math.round(100*n)/100,lowStockItems:a,outOfStockItems:s,inStockItems:r,isValid:i===t}}static validateAllData(e){const t=this.validatePaymentCalculations(e.payments),n=this.validateAppointmentStats(e.appointments),a=this.validateInventoryStats(e.inventory),s=t.isValid&&n.isValid&&a.isValid;return s||console.error("Data validation failed:",{payments:t.isValid,appointments:n.isValid,inventory:a.isValid}),{payments:t,appointments:n,inventory:a,isAllValid:s}}static compareFilteredData(e,t,n){const a=e.length,s=t.length,r=a>0?s/a*100:0;return console.log(`Filter comparison for ${n}:`,{original:a,filtered:s,ratio:`${Math.round(r)}%`,isFiltered:s<a}),{originalCount:a,filteredCount:s,filterRatio:Math.round(r),isFiltered:s<a}}}const Hh={all:"جميع البيانات",today:"اليوم",yesterday:"أمس",this_week:"هذا الأسبوع",last_week:"الأسبوع الماضي",this_month:"هذا الشهر",last_month:"الشهر الماضي",this_quarter:"هذا الربع",last_quarter:"الربع الماضي",this_year:"هذا العام",last_year:"العام الماضي",last_30_days:"آخر 30 يوم",last_90_days:"آخر 90 يوم",custom:"فترة مخصصة"};class Gh{static calculateFinancialStats(e,t,n,a,s){const r=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},i=Array.isArray(e)?e.filter(e=>e&&"object"==typeof e):[],l=Array.isArray(t)?t.filter(e=>e&&"object"==typeof e):[],o=Array.isArray(n)?n.filter(e=>e&&"object"==typeof e):[],d=Array.isArray(a)?a.filter(e=>e&&"object"==typeof e):[],c=Array.isArray(s)?s.filter(e=>e&&"object"==typeof e):[];console.log("🔍 calculateFinancialStats called with validated data:",{paymentsCount:i.length,labOrdersCount:l.length,clinicNeedsCount:o.length,inventoryItemsCount:d.length,expensesCount:c.length});const u=r(e.filter(e=>"completed"===e.status).reduce((e,t)=>e+r(t.amount),0)),m=r(e.filter(e=>"partial"===e.status).reduce((e,t)=>e+r(t.amount),0)),p=u+m,h=r(e.filter(e=>("partial"===e.status||"pending"===e.status)&&(e.treatment_remaining_balance||e.remaining_balance)).reduce((e,t)=>{const n=r(t.treatment_remaining_balance),a=r(t.remaining_balance);return e+(n||a)},0)),x=e.filter(e=>"pending"===e.status).reduce((e,t)=>{const n=r(t.amount),a=r(t.total_amount_due);let s=n;if(t.tooth_treatment_id){s=r(t.treatment_total_cost)||a}else 0===n&&a>0&&(s=a);return e+s},0);let g=0,f=0,v=0,y=0,b=0;t&&Array.isArray(t)&&(g=r(t.reduce((e,t)=>e+r(t.paid_amount||0),0)),f=r(t.reduce((e,t)=>e+r(t.remaining_balance||0),0))),n&&Array.isArray(n)&&(v=r(n.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+r(t.quantity)*r(t.price),0)),y=r(n.filter(e=>"pending"===e.status||"ordered"===e.status).reduce((e,t)=>e+r(t.quantity)*r(t.price),0))),a&&Array.isArray(a)&&(b=r(a.reduce((e,t)=>e+r(t.cost_per_unit||0)*r(t.quantity||0),0)));let j=0,w=[];if(c&&c.length>0){j=r(c.filter(e=>"paid"===e.status).reduce((e,t)=>e+r(t.amount),0));const e={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},t={};c.filter(e=>"paid"===e.status).forEach(e=>{const n=e.expense_type||"other",a=r(e.amount);t[n]=(t[n]||0)+a}),w=Object.entries(t).map(([t,n])=>({type:e[t]||t,amount:r(n),percentage:j>0?r(n)/j*100:0}))}const N=r(g+v+b+j),_=r(p-N),k=_>=0,S=p>0?r(_/p*100):0;console.log("💰 Financial calculations verification:",{totalRevenue:r(p),totalExpenses:r(N),netProfit:r(_),profitMargin:r(S),breakdown:{labOrdersTotal:r(g),clinicNeedsTotal:r(v),inventoryExpenses:r(b),clinicExpensesTotal:r(j)}});const D=new Date;return D.setDate(D.getDate()-30),{completedPayments:u,partialPayments:m,totalRevenue:p,remainingBalances:h,pendingAmount:x,labOrdersTotal:g,labOrdersRemaining:f,clinicNeedsTotal:v,clinicNeedsRemaining:y,inventoryExpenses:b,clinicExpensesTotal:j,expensesByType:w,totalExpenses:N,netProfit:k?_:0,lossAmount:k?0:Math.abs(_),profitMargin:r(S),isProfit:k,totalTransactions:e.length,completedTransactions:e.filter(e=>"completed"===e.status).length,partialTransactions:e.filter(e=>"partial"===e.status).length,pendingTransactions:e.filter(e=>"pending"===e.status).length}}static filterAllDataByDateRange(e,t){var n,a,s,r;const i=e=>{if(!e)return!1;const n=new Date(e);let a;return a=e.includes("T")||e.includes(" ")?n:new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),a>=t.startDate&&a<=t.endDate};return{patients:e.patients,appointments:e.appointments.filter(e=>i(e.start_time)||i(e.created_at)),payments:e.payments.filter(e=>i(e.payment_date)||i(e.created_at)),inventory:e.inventory.filter(e=>i(e.created_at)||i(e.updated_at)),treatments:(null==(n=e.treatments)?void 0:n.filter(e=>i(e.start_date||"")||i(e.created_at||"")))||[],prescriptions:(null==(a=e.prescriptions)?void 0:a.filter(e=>i(e.created_at)))||[],labOrders:(null==(s=e.labOrders)?void 0:s.filter(e=>i(e.order_date)||i(e.created_at)))||[],clinicNeeds:(null==(r=e.clinicNeeds)?void 0:r.filter(e=>i(e.created_at)))||[]}}static calculateAllAspectsStats(e,t){const n=this.calculateFinancialStats(e.payments,e.labOrders,e.clinicNeeds,e.inventory,e.expenses),a=this.calculateDetailedAppointmentStats(e.appointments),s=this.calculateTreatmentStats(e.treatments),r=this.calculatePrescriptionStats(e.prescriptions),i=this.calculateLabOrderStats(e.labOrders),l=this.calculateClinicNeedsStats(e.clinicNeeds),d=this.calculateInventoryStats(e.inventory);return o(o(o(o(o(o(o({dateRange:{start:ma(t.startDate.toISOString()),end:ma(t.endDate.toISOString()),period:`${ma(t.startDate.toISOString())} - ${ma(t.endDate.toISOString())}`},totalPatients:e.patients.length,totalAppointments:e.appointments.length,totalPayments:e.payments.length,totalTreatments:e.treatments.length,totalPrescriptions:e.prescriptions.length,totalLabOrders:e.labOrders.length,totalClinicNeeds:e.clinicNeeds.length,totalInventoryItems:e.inventory.length},n),a),s),r),i),l),d)}static calculateAppointmentStats(e){const t=e.length,n=e.filter(e=>"completed"===e.status).length;return{total:t,completed:n,cancelled:e.filter(e=>"cancelled"===e.status).length,noShow:e.filter(e=>"no-show"===e.status).length,scheduled:e.filter(e=>"scheduled"===e.status).length,attendanceRate:t>0?Math.round(n/t*100):0}}static calculateDetailedAppointmentStats(e){const t=this.calculateAppointmentStats(e),n=e.reduce((e,t)=>{if(t.start_time){const n=new Date(t.start_time).getHours();e[n]=(e[n]||0)+1}return e},{}),a=Object.entries(n).reduce((e,[t,n])=>n>e.count?{hour:parseInt(t),count:n}:e,{hour:0,count:0}),s=e.reduce((e,t)=>{if(t.start_time){const n=["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"][new Date(t.start_time).getDay()];e[n]=(e[n]||0)+1}return e},{});return d(o({},t),{peakHour:a.hour?`${a.hour}:00 (${a.count} مواعيد)`:"غير محدد",dayDistribution:s,averagePerDay:e.length>0?Math.round(e.length/7):0})}static calculateTreatmentStats(e){const t=e.length,n=e.filter(e=>"completed"===e.treatment_status).length,a=e.filter(e=>"planned"===e.treatment_status).length,s=e.filter(e=>"in_progress"===e.treatment_status).length,r=e.filter(e=>"cancelled"===e.treatment_status).length,i=e.reduce((e,t)=>{const n=t.treatment_type||"غير محدد";return e[n]=(e[n]||0)+1,e},{}),l=e.reduce((e,t)=>{var n;const a=(null==(n=t.tooth_number)?void 0:n.toString())||"غير محدد";return e[a]=(e[a]||0)+1,e},{});return{totalTreatments:t,completedTreatments:n,plannedTreatments:a,inProgressTreatments:s,cancelledTreatments:r,completionRate:t>0?Math.round(n/t*100):0,treatmentTypes:i,teethTreated:l,mostTreatedTooth:Object.entries(l).reduce((e,[t,n])=>n>e.count?{tooth:t,count:n}:e,{tooth:"غير محدد",count:0})}}static calculatePrescriptionStats(e){const t=e.length;e.reduce((e,t)=>e,{});const n=new Set(e.map(e=>e.patient_id)).size;return{totalPrescriptions:t,patientsWithPrescriptions:n,averagePrescriptionsPerPatient:n>0?Math.round(t/n*100)/100:0}}static calculateLabOrderStats(e){const t=e.length,n=e.filter(e=>"معلق"===e.status).length,a=e.filter(e=>"مكتمل"===e.status).length,s=e.filter(e=>"ملغي"===e.status).length,r=e.reduce((e,t)=>e+(t.cost||0),0),i=e.reduce((e,t)=>e+(t.paid_amount||0),0),l=e.reduce((e,t)=>e+(t.remaining_balance||0),0),o=e.reduce((e,t)=>{var n;const a=(null==(n=t.lab)?void 0:n.name)||"غير محدد";return e[a]=(e[a]||0)+1,e},{});return{totalLabOrders:t,pendingLabOrders:n,completedLabOrders:a,cancelledLabOrders:s,labOrdersCompletionRate:t>0?Math.round(a/t*100):0,totalLabCost:r,totalLabPaid:i,totalLabRemaining:l,labFrequency:o,mostUsedLab:Object.entries(o).reduce((e,[t,n])=>n>e.count?{lab:t,count:n}:e,{lab:"غير محدد",count:0})}}static calculateClinicNeedsStats(e){const t=e.length,n=e.filter(e=>"pending"===e.status).length,a=e.filter(e=>"ordered"===e.status).length,s=e.filter(e=>"received"===e.status).length,r=e.filter(e=>"cancelled"===e.status).length,i=e.reduce((e,t)=>e+(t.quantity||0)*(t.price||0),0),l=e.reduce((e,t)=>{const n=t.priority||"medium";return e[n]=(e[n]||0)+1,e},{}),o=e.reduce((e,t)=>{const n=t.category||"غير محدد";return e[n]=(e[n]||0)+1,e},{});return{totalClinicNeeds:t,pendingNeeds:n,orderedNeeds:a,receivedNeeds:s,cancelledNeeds:r,needsCompletionRate:t>0?Math.round(s/t*100):0,totalNeedsValue:i,priorityAnalysis:l,categoryAnalysis:o,urgentNeeds:l.urgent||0,highPriorityNeeds:l.high||0}}static validateAmount(e){const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100}static calculateInventoryStats(e){const t=e.length,n=e.reduce((e,t)=>{const n=t.category||"غير محدد";return e[n]=(e[n]||0)+1,e},{});return{totalInventoryItems:t,totalInventoryValue:e.reduce((e,t)=>e+this.validateAmount(t.cost_per_unit||0)*this.validateAmount(t.quantity||0),0),lowStockItems:e.filter(e=>(e.quantity||0)<=(e.minimum_quantity||0)).length,inventoryByCategory:n}}static groupByStatus(e,t){return e.reduce((e,n)=>{const a=n[t]||"غير محدد";return e[a]=(e[a]||0)+1,e},{})}static groupByMethod(e){return e.reduce((e,t)=>{const n=t.payment_method||"غير محدد";return e[n]=(e[n]||0)+1,e},{})}static groupByCategory(e){return e.reduce((e,t)=>{const n=t.category||"غير محدد";return e[n]=(e[n]||0)+1,e},{})}static generateComprehensiveCSV(e){const t=this.calculateFinancialStats(e.payments),n=this.calculateAppointmentStats(e.appointments),a=this.calculateInventoryStats(e.inventory);let s="\ufeff";if(s+="التقرير الشامل - عيادة الأسنان الحديثة\n",s+=`تاريخ التقرير,${this.formatGregorianDate(new Date)}\n`,s+=`وقت الإنشاء,${(new Date).toLocaleTimeString("ar-SA")}\n\n`,s+="معلومات الفلترة المطبقة\n",s+=`فلتر المواعيد,${e.filterInfo.appointmentFilter}\n`,s+=`فلتر المدفوعات,${e.filterInfo.paymentFilter}\n`,s+=`فلتر المخزون,${e.filterInfo.inventoryFilter}\n\n`,s+="إحصائيات المرضى\n",s+=`إجمالي المرضى,${e.patients.length}\n`,s+=`المرضى الجدد هذا الشهر,${this.getNewPatientsThisMonth(e.patients)}\n`,s+=`المرضى النشطون,${this.getActivePatients(e.patients,e.appointments)}\n`,s+=`متوسط عمر المرضى,${this.calculateAverageAge(e.patients)}\n`,s+=`توزيع الجنس,${this.getGenderDistribution(e.patients)}\n\n`,s+="إحصائيات المواعيد (مفلترة)\n",s+=`إجمالي المواعيد,${n.total}\n`,s+=`المواعيد المكتملة,${n.completed}\n`,s+=`المواعيد الملغية,${n.cancelled}\n`,s+=`المواعيد المجدولة,${n.scheduled}\n`,s+=`معدل الحضور,${n.attendanceRate}%\n\n`,s+="الإحصائيات المالية (مفلترة)\n",s+=`إجمالي الإيرادات,${ca(t.totalRevenue)}\n`,s+=`المدفوعات المكتملة,${ca(t.completedAmount)}\n`,s+=`المدفوعات الجزئية,${ca(t.partialAmount)}\n`,s+=`المدفوعات المعلقة,${ca(t.pendingAmount)}\n`,s+=`المدفوعات المتأخرة,${ca(t.overdueAmount)}\n`,t.totalRemainingFromPartialPayments>0&&(s+=`المبالغ المتبقية من الدفعات الجزئية,${ca(t.totalRemainingFromPartialPayments)}\n`),s+=`الرصيد المستحق الإجمالي,${ca(t.outstandingBalance)}\n`,s+=`إجمالي المعاملات,${t.totalTransactions}\n`,s+=`إجمالي المصروفات,${ca(t.totalExpenses||0)}\n`,s+=`صافي الربح,${ca(t.netProfit||0)}\n`,s+=`هامش الربح,${(t.profitMargin||0).toFixed(2)}%\n`,s+=`حالة الربحية,${(t.netProfit||0)>=0?"ربح":"خسارة"}\n\n`,t.expensesByType&&t.expensesByType.length>0&&(s+="توزيع المصروفات حسب النوع\n",s+="نوع المصروف,المبلغ,النسبة المئوية\n",t.expensesByType.forEach(e=>{s+=`"${e.type}","${ca(e.amount)}","${e.percentage.toFixed(2)}%"\n`}),s+="\n"),s+="توزيع طرق الدفع\n",s+="طريقة الدفع,المبلغ,عدد المعاملات\n",Object.entries(t.paymentMethodStats).forEach(([e,t])=>{s+=`"${e}","${ca(t.amount)}","${t.count}"\n`}),s+="\n",s+="إحصائيات المخزون (مفلترة)\n",s+=`إجمالي العناصر,${a.totalItems}\n`,s+=`القيمة الإجمالية,${ca(a.totalValue)}\n`,s+=`عناصر منخفضة المخزون,${a.lowStockItems}\n`,s+=`عناصر نفدت من المخزون,${a.outOfStockItems}\n`,s+=`عناصر منتهية الصلاحية,${a.expiredItems}\n`,s+=`عناصر قريبة الانتهاء (30 يوم),${a.nearExpiryItems}\n\n`,e.appointments.length>0&&(s+="تفاصيل المواعيد المفلترة\n",s+="التاريخ,الوقت,اسم المريض,عنوان الموعد,نوع العلاج,التكلفة,الحالة,ملاحظات\n",e.appointments.forEach(e=>{var t,n;const a=ma(e.start_time),r=new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}),i=(null==(t=e.patient)?void 0:t.full_name)||(null==(n=e.patient)?void 0:n.name)||"غير محدد",l=e.title||"غير محدد",o=e.treatment_type||"غير محدد",d=e.cost?ca(e.cost):"0",c=this.getStatusInArabic(e.status),u=e.notes||"";s+=`"${a}","${r}","${i}","${l}","${o}","${d}","${c}","${u}"\n`}),s+="\n"),e.payments.length>0&&(s+="تفاصيل المدفوعات المفلترة\n",s+="تاريخ الدفع,اسم المريض,الوصف,المبلغ,المبلغ المدفوع,الرصيد المتبقي,طريقة الدفع,الحالة,رقم الإيصال,ملاحظات\n",e.payments.forEach(e=>{var t,n;const a=ma(e.payment_date),r=(null==(t=e.patient)?void 0:t.full_name)||(null==(n=e.patient)?void 0:n.name)||"غير محدد",i=e.description||"غير محدد";let l,o,d;if("partial"===e.status){const t=Number(e.total_amount_due||e.amount)||0,n=Number(e.amount_paid||e.amount)||0;l=ca(t),o=ca(n),d=ca(Math.max(0,t-n))}else e.appointment_id&&e.treatment_total_cost?(l=ca(Number(e.treatment_total_cost)||0),o=ca(Number(e.treatment_total_paid||e.amount)||0),d=ca(Number(e.treatment_remaining_balance||0))):(l=ca(Number(e.amount)||0),o=ca(Number(e.amount)||0),d=ca(0));const c=this.getPaymentMethodInArabic(e.payment_method),u=hd(e.status),m=e.receipt_number||"",p=e.notes||"";s+=`"${a}","${r}","${i}","${l}","${o}","${d}","${c}","${u}","${m}","${p}"\n`}),s+="\n"),e.inventory.length>0&&(s+="تفاصيل المخزون المفلتر\n",s+="اسم الصنف,الوصف,الفئة,الكمية,الوحدة,الحد الأدنى,تكلفة الوحدة,القيمة الإجمالية,المورد,تاريخ الانتهاء,الحالة,تاريخ الإنشاء\n",e.inventory.forEach(e=>{const t=e.name||"غير محدد",n=e.description||"غير محدد",a=e.category||"غير محدد",r=e.quantity||0,i=e.unit||"قطعة",l=e.minimum_stock||0,o=ca(e.cost_per_unit||0),d=ca((e.cost_per_unit||0)*(e.quantity||0)),c=e.supplier||"غير محدد",u=e.expiry_date?ma(e.expiry_date):"غير محدد",m=this.getInventoryStatusInArabic(e.quantity||0,e.minimum_stock||0),p=ma(e.created_at);s+=`"${t}","${n}","${a}","${r}","${i}","${l}","${o}","${d}","${c}","${u}","${m}","${p}"\n`}),s+="\n"),e.patients.length>0){s+="تفاصيل المرضى (أحدث 50 مريض)\n",s+="#,الاسم الكامل,رقم الهاتف,العمر,الجنس,الحالة الطبية,الحساسية,البريد الإلكتروني,العنوان,تاريخ التسجيل,آخر موعد,إجمالي المواعيد,إجمالي المدفوعات,الرصيد المتبقي,ملاحظات\n";[...e.patients].sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,50).forEach(t=>{const n=t.serial_number||"غير محدد",a=t.full_name||t.name||"غير محدد",r=t.phone||"غير محدد",i=t.age||"غير محدد",l="male"===t.gender?"ذكر":"female"===t.gender?"أنثى":"غير محدد",o=t.patient_condition||"غير محدد",d=t.allergies||"لا يوجد",c=t.email||"غير محدد",u=t.address||"غير محدد",m=ma(t.created_at),p=t.notes||"لا يوجد",h=e.appointments.filter(e=>e.patient_id===t.id),x=e.payments.filter(e=>e.patient_id===t.id),g=h.length>0?ma(h.sort((e,t)=>new Date(t.start_time).getTime()-new Date(e.start_time).getTime())[0].start_time):"لا يوجد",f=h.length;let v=0,y=0,b=0,j=0;h.forEach(e=>{if(e.cost){const t=x.filter(t=>t.appointment_id===e.id).reduce((e,t)=>e+(t.amount||0),0);b+=e.cost,j+=t}});x.filter(e=>!e.appointment_id).forEach(e=>{j+=e.amount||0,e.total_amount_due&&(b+=e.total_amount_due)}),v+=j,y+=Math.max(0,b-j),s+=`"${n}","${a}","${r}","${i}","${l}","${o}","${d}","${c}","${u}","${m}","${g}","${f}","${ca(v)}","${ca(y)}","${p}"\n`}),s+="\n"}s+="ملخص إضافي للطبيب\n",s+=`متوسط قيمة الموعد,${n.total>0?ca(t.totalRevenue/n.total):"0"}\n`,s+=`متوسط المدفوعات اليومية,${this.calculateDailyAverage(e.payments,t.totalRevenue)}\n`,s+=`نسبة المدفوعات المكتملة,${t.totalTransactions>0?Math.round(t.completedTransactions/t.totalTransactions*100):0}%\n`,s+=`نسبة المدفوعات الجزئية,${t.totalTransactions>0?Math.round(t.partialTransactions/t.totalTransactions*100):0}%\n`,s+=`نسبة الإلغاء,${n.total>0?Math.round(n.cancelled/n.total*100):0}%\n`,s+=`متوسط عدد المواعيد لكل مريض,${e.patients.length>0?Math.round(n.total/e.patients.length*100)/100:0}\n`,s+=`متوسط الإيرادات لكل مريض,${e.patients.length>0?ca(t.totalRevenue/e.patients.length):"0"}\n\n`,s+="تحليلات متقدمة\n";const r=e.appointments.reduce((e,t)=>e+(t.cost||0),0),i=r>0?Math.round(t.totalRevenue/r*100):0;s+=`معدل التحصيل,${i}%\n`;const l=this.analyzeTreatmentTypes(e.appointments);s+=`أكثر أنواع العلاج طلباً,${l.mostCommon}\n`,s+=`أعلى أنواع العلاج قيمة,${l.highestValue}\n`;const o=this.analyzeAppointmentTimes(e.appointments);s+=`أكثر الأوقات ازدحاماً,${o.peakHour}\n`,s+=`أكثر الأيام ازدحاماً,${o.peakDay}\n`;const d=this.analyzePatients(e.patients,e.appointments,e.payments);return s+=`أكثر المرضى زيارة,${d.mostFrequent}\n`,s+=`أعلى المرضى إنفاقاً,${d.highestSpender}\n`,s+="\nتوصيات للطبيب\n",n.attendanceRate<80&&(s+=`توصية,تحسين معدل الحضور - النسبة الحالية ${n.attendanceRate}% منخفضة\n`),i<90&&(s+=`توصية,تحسين معدل التحصيل - النسبة الحالية ${i}% منخفضة\n`),t.partialTransactions>t.completedTransactions&&(s+=`توصية,متابعة المدفوعات الجزئية - ${t.partialTransactions} معاملة جزئية مقابل ${t.completedTransactions} مكتملة\n`),a.lowStockItems>0&&(s+=`توصية,تجديد المخزون - ${a.lowStockItems} صنف منخفض المخزون\n`),a.expiredItems>0&&(s+=`توصية,إزالة المواد المنتهية الصلاحية - ${a.expiredItems} صنف منتهي الصلاحية\n`),a.nearExpiryItems>0&&(s+=`توصية,استخدام المواد قريبة الانتهاء - ${a.nearExpiryItems} صنف ينتهي خلال 30 يوم\n`),n.cancelled>.2*n.completed&&(s+=`توصية,تقليل معدل الإلغاء - ${n.cancelled} موعد ملغي من أصل ${n.total}\n`),t.overdueAmount>.1*t.totalRevenue&&(s+=`توصية,متابعة المدفوعات المتأخرة - ${ca(t.overdueAmount)} مبلغ متأخر\n`),s}static getStatusInArabic(e){return{scheduled:"مجدول",completed:"مكتمل",cancelled:"ملغي","no-show":"لم يحضر",confirmed:"مؤكد",pending:"معلق"}[e]||e}static getPaymentMethodInArabic(e){return{cash:"نقدي",bank_transfer:"تحويل بنكي",credit_card:"بطاقة ائتمان",debit_card:"بطاقة خصم"}[e]||e}static getInventoryStatusInArabic(e,t){return 0===e?"نفد من المخزون":e<=t?"منخفض المخزون":"متوفر"}static calculateDailyAverage(e,t){if(0===e.length)return"0";const n=new Set(e.map(e=>e.payment_date.split("T")[0])).size;if(0===n)return"0";return ca(t/n)}static calculateAge(e){try{const t=new Date(e),n=new Date;let a=n.getFullYear()-t.getFullYear();const s=n.getMonth()-t.getMonth();return(s<0||0===s&&n.getDate()<t.getDate())&&a--,a.toString()}catch(t){return"غير محدد"}}static calculateAverageAge(e){if(0===e.length)return"0";const t=e.reduce((e,t)=>e+("number"==typeof t.age?t.age:0),0)/e.length;return Math.round(t).toString()}static getGenderDistribution(e){if(0===e.length)return"لا يوجد بيانات";const t=e.filter(e=>"male"===e.gender).length,n=e.filter(e=>"female"===e.gender).length;return`ذكور: ${t} (${Math.round(t/e.length*100)}%) - إناث: ${n} (${Math.round(n/e.length*100)}%)`}static getNewPatientsThisMonth(e){const t=(new Date).toISOString().slice(0,7);return e.filter(e=>e.created_at.startsWith(t)).length}static getActivePatients(e,t){const n=new Date;n.setMonth(n.getMonth()-3);return new Set(t.filter(e=>new Date(e.start_time)>=n).map(e=>e.patient_id)).size}static analyzeTreatmentTypes(e){const t={};e.forEach(e=>{const n=e.title||e.treatment_type||"غير محدد",a=this.getTreatmentNameInArabic(n);t[a]||(t[a]={count:0,totalValue:0}),t[a].count++,t[a].totalValue+=e.cost||0});const n=Object.entries(t).sort((e,t)=>t[1].count-e[1].count),a=Object.entries(t).sort((e,t)=>t[1].totalValue-e[1].totalValue);return{mostCommon:n.length>0?`${n[0][0]} (${n[0][1].count} مرة)`:"لا يوجد",highestValue:a.length>0?`${a[0][0]} (${ca(a[0][1].totalValue)})`:"لا يوجد"}}static analyzeAppointmentTimes(e){const t={},n={};e.forEach(e=>{const a=new Date(e.start_time),s=a.getHours(),r=a.toLocaleDateString("ar-SA",{weekday:"long"});t[s]=(t[s]||0)+1,n[r]=(n[r]||0)+1});const a=Object.entries(t).sort((e,t)=>t[1]-e[1])[0],s=Object.entries(n).sort((e,t)=>t[1]-e[1])[0];return{peakHour:a?`${a[0]}:00 (${a[1]} موعد)`:"لا يوجد",peakDay:s?`${s[0]} (${s[1]} موعد)`:"لا يوجد"}}static analyzePatients(e,t,n){const a={};e.forEach(e=>{const s=t.filter(t=>t.patient_id===e.id),r=n.filter(t=>t.patient_id===e.id).reduce((e,t)=>e+("partial"===t.status&&void 0!==t.amount_paid?Number(t.amount_paid):Number(t.amount)),0);a[e.id]={name:e.full_name||e.name||"غير محدد",appointmentCount:s.length,totalPayments:r}});const s=Object.values(a).sort((e,t)=>t.appointmentCount-e.appointmentCount),r=Object.values(a).sort((e,t)=>t.totalPayments-e.totalPayments);return{mostFrequent:s.length>0?`${s[0].name} (${s[0].appointmentCount} موعد)`:"لا يوجد",highestSpender:r.length>0?`${r[0].name} (${ca(r[0].totalPayments)})`:"لا يوجد"}}static exportComprehensiveReport(e){return m(this,null,function*(){try{const t=function(e,t,n){const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(e){case"today":const e=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999);return{startDate:s,endDate:e};case"yesterday":const r=new Date(s.getFullYear(),s.getMonth(),s.getDate()-1),i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);return{startDate:r,endDate:i};case"this_week":const l=new Date(s);return l.setDate(s.getDate()-s.getDay()),{startDate:l,endDate:a};case"last_week":const o=new Date(s);o.setDate(s.getDate()-s.getDay()-7);const d=new Date(o);return d.setDate(o.getDate()+6),d.setHours(23,59,59,999),{startDate:o,endDate:d};case"this_month":return{startDate:new Date(s.getFullYear(),s.getMonth(),1),endDate:a};case"last_month":const c=new Date(s.getFullYear(),s.getMonth()-1,1),u=new Date(s.getFullYear(),s.getMonth(),0);return u.setHours(23,59,59,999),{startDate:c,endDate:u};case"this_quarter":return{startDate:new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3),1),endDate:a};case"last_quarter":const m=new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3)-3,1),p=new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3),0);return p.setHours(23,59,59,999),{startDate:m,endDate:p};case"this_year":return{startDate:new Date(s.getFullYear(),0,1),endDate:a};case"last_year":const h=new Date(s.getFullYear()-1,0,1),x=new Date(s.getFullYear()-1,11,31);return x.setHours(23,59,59,999),{startDate:h,endDate:x};case"last_30_days":return{startDate:new Date(s.getFullYear(),s.getMonth(),s.getDate()-30),endDate:new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999)};case"last_90_days":return{startDate:new Date(s.getFullYear(),s.getMonth(),s.getDate()-90),endDate:new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999)};case"custom":return t&&n?{startDate:new Date(t+"T00:00:00"),endDate:new Date(n+"T23:59:59.999")}:{startDate:new Date(0),endDate:a};default:return{startDate:new Date(0),endDate:a}}}(e.timePeriod,e.customStartDate,e.customEndDate),n=this.filterAllDataByDateRange(e,t);e.expenses&&(n.expenses=e.expenses.filter(e=>{if(!e.payment_date)return!1;const n=new Date(e.payment_date);return n>=t.startDate&&n<=t.endDate}));const a=function(e){return console.log("🔍 Validating data before export..."),Uh.validateAllData(e).isAllValid?(console.log("✅ Data validation passed! Export will contain accurate values."),e.filterInfo&&console.log("📊 Filter information:",e.filterInfo),!0):(console.error("❌ Data validation failed! Export may contain incorrect values."),!1)}({payments:n.payments,appointments:n.appointments,inventory:n.inventory,filterInfo:{appointmentFilter:Hh[e.timePeriod],paymentFilter:Hh[e.timePeriod],inventoryFilter:Hh[e.timePeriod]}});if(!a)throw new Error("فشل في التحقق من صحة البيانات");const s=this.calculateAllAspectsStats(n,t);this.generateEnhancedComprehensiveCSV({patients:e.patients,appointments:n.appointments,payments:n.payments,inventory:n.inventory,treatments:n.treatments,prescriptions:n.prescriptions,labOrders:n.labOrders,clinicNeeds:n.clinicNeeds,timePeriod:e.timePeriod,stats:s});yield this.exportComprehensiveReportToExcel({patients:e.patients,appointments:n.appointments,payments:n.payments,inventory:n.inventory,treatments:n.treatments,prescriptions:n.prescriptions,labOrders:n.labOrders,clinicNeeds:n.clinicNeeds,expenses:n.expenses||[],timePeriod:e.timePeriod,stats:s,dateRange:t})}catch(t){throw console.error("Error exporting comprehensive report:",t),new Error("فشل في تصدير التقرير الشامل")}})}static calculateComprehensiveStats(e){var t,n;const a=this.calculateFinancialStats(e.filteredPayments,e.labOrders,e.clinicNeeds,e.filteredInventory,e.expenses);return d(o({totalPatients:e.patients.length,totalAppointments:e.filteredAppointments.length,totalPayments:e.filteredPayments.length,totalInventoryItems:e.filteredInventory.length,totalLabOrders:(null==(t=e.labOrders)?void 0:t.length)||0,totalClinicNeeds:(null==(n=e.clinicNeeds)?void 0:n.length)||0},a),{appointmentsByStatus:this.groupByStatus(e.filteredAppointments,"status"),paymentsByMethod:this.groupByMethod(e.filteredPayments),inventoryByCategory:this.groupByCategory(e.filteredInventory)})}static generateEnhancedComprehensiveCSV(e){let t="\ufeff";return t+="التقرير الشامل المفصل للعيادة - جميع الجوانب\n",t+=`تاريخ التقرير,${this.formatGregorianDate(new Date)}\n`,t+=`وقت التقرير,${(new Date).toLocaleTimeString("ar-SA")}\n`,t+=`الفترة الزمنية,${Hh[e.timePeriod]}\n`,e.stats.dateRange&&(t+=`نطاق التواريخ,${e.stats.dateRange.period}\n`),t+="\n",t+="=== ملخص عام شامل ===\n",t+=`إجمالي المرضى,${e.stats.totalPatients}\n`,t+=`إجمالي المواعيد (مفلترة),${e.stats.totalAppointments}\n`,t+=`إجمالي المدفوعات (مفلترة),${e.stats.totalPayments}\n`,t+=`إجمالي العلاجات (مفلترة),${e.stats.totalTreatments}\n`,t+=`إجمالي الوصفات (مفلترة),${e.stats.totalPrescriptions}\n`,t+=`إجمالي طلبات المخابر (مفلترة),${e.stats.totalLabOrders}\n`,t+=`إجمالي احتياجات العيادة (مفلترة),${e.stats.totalClinicNeeds}\n`,t+=`إجمالي عناصر المخزون,${e.stats.totalInventoryItems}\n\n`,t+="تحليل الأرباح والخسائر الشامل\n",t+="=================================\n\n",t+="الإيرادات\n",t+=`المدفوعات المكتملة,${ca(e.stats.completedPayments||0)}\n`,t+=`المدفوعات الجزئية,${ca(e.stats.partialPayments||0)}\n`,t+=`إجمالي الإيرادات,${ca(e.stats.totalRevenue||0)}\n`,t+=`المبالغ المتبقية من المدفوعات الجزئية,${ca(e.stats.remainingBalances||0)}\n`,t+=`المدفوعات المعلقة,${ca(e.stats.pendingAmount||0)}\n\n`,t+="المصروفات\n",t+=`إجمالي المدفوعات للمخابر,${ca(e.stats.labOrdersTotal||0)}\n`,t+=`إجمالي المتبقي للمخابر,${ca(e.stats.labOrdersRemaining||0)}\n`,t+=`إجمالي المدفوعات للاحتياجات والمخزون,${ca(e.stats.clinicNeedsTotal||0)}\n`,t+=`إجمالي المتبقي للاحتياجات,${ca(e.stats.clinicNeedsRemaining||0)}\n`,t+=`قيمة المخزون الحالي,${ca(e.stats.inventoryExpenses||0)}\n`,t+=`مصروفات العيادة المباشرة,${ca(e.stats.clinicExpensesTotal||0)}\n`,t+=`إجمالي المصروفات,${ca(e.stats.totalExpenses||0)}\n\n`,t+="النتيجة النهائية\n",e.stats.isProfit?(t+=`صافي الربح,${ca(e.stats.netProfit||0)}\n`,t+=`نسبة الربح,${(e.stats.profitMargin||0).toFixed(2)}%\n`,t+="الحالة,ربح\n"):(t+=`إجمالي الخسارة,${ca(e.stats.lossAmount||0)}\n`,t+=`نسبة الخسارة,${Math.abs(e.stats.profitMargin||0).toFixed(2)}%\n`,t+="الحالة,خسارة\n"),t+="\n",t+="تحليل المواعيد التفصيلي\n",t+="========================\n",t+=`إجمالي المواعيد,${e.stats.total||0}\n`,t+=`المواعيد المكتملة,${e.stats.completed||0}\n`,t+=`المواعيد الملغية,${e.stats.cancelled||0}\n`,t+=`المواعيد المجدولة,${e.stats.scheduled||0}\n`,t+=`المواعيد الغائبة,${e.stats.noShow||0}\n`,t+=`معدل الحضور,${e.stats.attendanceRate||0}%\n`,e.stats.peakHour&&(t+=`أكثر الأوقات ازدحاماً,${e.stats.peakHour}\n`),t+=`متوسط المواعيد يومياً,${e.stats.averagePerDay||0}\n\n`,t+="تحليل العلاجات التفصيلي\n",t+="========================\n",t+=`إجمالي العلاجات,${e.stats.totalTreatments||0}\n`,t+=`العلاجات المكتملة,${e.stats.completedTreatments||0}\n`,t+=`العلاجات المخططة,${e.stats.plannedTreatments||0}\n`,t+=`العلاجات قيد التنفيذ,${e.stats.inProgressTreatments||0}\n`,t+=`العلاجات الملغية,${e.stats.cancelledTreatments||0}\n`,t+=`معدل إنجاز العلاجات,${e.stats.completionRate||0}%\n`,e.stats.mostTreatedTooth&&(t+=`أكثر الأسنان علاجاً,السن رقم ${e.stats.mostTreatedTooth.tooth} (${e.stats.mostTreatedTooth.count} علاج)\n`),t+="\n",t+="توزيع أنواع العلاجات\n",e.stats.treatmentTypes&&"object"==typeof e.stats.treatmentTypes?Object.entries(e.stats.treatmentTypes).forEach(([e,n])=>{const a=this.getTreatmentNameInArabic(e);t+=`${a},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",t+="توزيع الأسنان المعالجة\n",e.stats.teethTreated&&"object"==typeof e.stats.teethTreated?Object.entries(e.stats.teethTreated).forEach(([e,n])=>{t+=`السن رقم ${e},${n} علاج\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",e.treatments&&e.treatments.length>0&&e.treatments.length<=100&&(t+="تفاصيل العلاجات الفردية\n",t+="المريض,رقم السن,نوع العلاج,الفئة,الحالة,تاريخ البداية,تاريخ الإكمال,التكلفة,ملاحظات\n",e.treatments.forEach(n=>{const a=e.patients.find(e=>e.id===n.patient_id),s=a?a.full_name||a.name||`${a.first_name||""} ${a.last_name||""}`.trim():"غير محدد",r=n.start_date?ma(n.start_date):"غير محدد",i=n.completion_date?ma(n.completion_date):"غير محدد",l=n.cost?ca(n.cost):"غير محدد",o=(n.notes||"").replace(/,/g,"؛"),d=this.getTreatmentNameInArabic(n.treatment_type||"غير محدد"),c=this.getCategoryNameInArabic(n.treatment_category||"غير محدد"),u=this.getStatusLabelInArabic(n.treatment_status||"غير محدد");t+=`"${s}",${n.tooth_number||"غير محدد"},"${d}","${c}","${u}",${r},${i},${l},"${o}"\n`}),t+="\n"),t+="تحليل الوصفات\n",t+="===============\n",t+=`إجمالي الوصفات,${e.stats.totalPrescriptions||0}\n`,t+=`المرضى الذين لديهم وصفات,${e.stats.patientsWithPrescriptions||0}\n`,t+=`متوسط الوصفات لكل مريض,${e.stats.averagePrescriptionsPerPatient||0}\n\n`,e.prescriptions&&e.prescriptions.length>0&&e.prescriptions.length<=50&&(t+="تفاصيل الوصفات الفردية\n",t+="تاريخ الوصفة,المريض,الموعد,ملاحظات\n",e.prescriptions.forEach(n=>{const a=n.prescription_date?ma(n.prescription_date):"غير محدد";let s=n.patient_name||"غير محدد",r=n.appointment_title||"غير محدد";if("غير محدد"===s){const t=e.patients.find(e=>e.id===n.patient_id);s=t?t.full_name||t.name||`${t.first_name||""} ${t.last_name||""}`.trim():"غير محدد"}if("غير محدد"===r){const t=e.appointments.find(e=>e.id===n.appointment_id);r=t?t.title||t.description||"موعد طبي":"غير محدد"}const i=(n.notes||"").replace(/,/g,"؛");t+=`${a},"${s}","${r}","${i}"\n`}),t+="\n"),t+="تحليل طلبات المخابر\n",t+="==================\n",t+=`إجمالي طلبات المخابر,${e.stats.totalLabOrders||0}\n`,t+=`الطلبات المعلقة,${e.stats.pendingLabOrders||0}\n`,t+=`الطلبات المكتملة,${e.stats.completedLabOrders||0}\n`,t+=`الطلبات الملغية,${e.stats.cancelledLabOrders||0}\n`,t+=`معدل إنجاز طلبات المخابر,${e.stats.labOrdersCompletionRate||0}%\n`,t+=`إجمالي تكلفة المخابر,${ca(e.stats.totalLabCost||0)}\n`,t+=`إجمالي المدفوع للمخابر,${ca(e.stats.totalLabPaid||0)}\n`,t+=`إجمالي المتبقي للمخابر,${ca(e.stats.totalLabRemaining||0)}\n`,e.stats.mostUsedLab&&(t+=`أكثر المخابر استخداماً,${e.stats.mostUsedLab.lab} (${e.stats.mostUsedLab.count} طلب)\n`),t+="\n",t+="توزيع المخابر المستخدمة\n",e.stats.labFrequency&&"object"==typeof e.stats.labFrequency?Object.entries(e.stats.labFrequency).forEach(([e,n])=>{t+=`${e},${n} طلب\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",e.labOrders&&e.labOrders.length>0&&e.labOrders.length<=50&&(t+="تفاصيل طلبات المخابر الفردية\n",t+="تاريخ الطلب,المختبر,المريض,الحالة,التكلفة,المدفوع,المتبقي,ملاحظات\n",e.labOrders.forEach(n=>{const a=n.order_date?ma(n.order_date):"غير محدد",s=n.lab_name||n.laboratory||"غير محدد",r=e.patients.find(e=>e.id===n.patient_id),i=r?r.full_name||r.name||`${r.first_name||""} ${r.last_name||""}`.trim():"غير محدد",l=n.status||"غير محدد",o=n.cost?ca(n.cost):"غير محدد",d=n.paid_amount?ca(n.paid_amount):"غير محدد",c=n.remaining_balance?ca(n.remaining_balance):"غير محدد",u=(n.notes||"").replace(/,/g,"؛");t+=`${a},"${s}","${i}",${l},${o},${d},${c},"${u}"\n`}),t+="\n"),t+="تحليل احتياجات العيادة\n",t+="=====================\n",t+=`إجمالي الاحتياجات,${e.stats.totalClinicNeeds||0}\n`,t+=`الاحتياجات المعلقة,${e.stats.pendingNeeds||0}\n`,t+=`الاحتياجات المطلوبة,${e.stats.orderedNeeds||0}\n`,t+=`الاحتياجات المستلمة,${e.stats.receivedNeeds||0}\n`,t+=`الاحتياجات الملغية,${e.stats.cancelledNeeds||0}\n`,t+=`معدل إنجاز الاحتياجات,${e.stats.needsCompletionRate||0}%\n`,t+=`إجمالي قيمة الاحتياجات,${ca(e.stats.totalNeedsValue||0)}\n`,t+=`الاحتياجات العاجلة,${e.stats.urgentNeeds||0}\n`,t+=`الاحتياجات عالية الأولوية,${e.stats.highPriorityNeeds||0}\n\n`,t+="توزيع الأولويات\n",e.stats.priorityAnalysis&&"object"==typeof e.stats.priorityAnalysis?Object.entries(e.stats.priorityAnalysis).forEach(([e,n])=>{t+=`${"urgent"===e?"عاجل":"high"===e?"عالي":"medium"===e?"متوسط":"low"===e?"منخفض":e},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",t+="توزيع فئات الاحتياجات\n",e.stats.categoryAnalysis&&"object"==typeof e.stats.categoryAnalysis?Object.entries(e.stats.categoryAnalysis).forEach(([e,n])=>{t+=`${e},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",e.clinicNeeds&&e.clinicNeeds.length>0&&e.clinicNeeds.length<=50&&(t+="تفاصيل احتياجات العيادة الفردية\n",t+="تاريخ الطلب,اسم الصنف,الفئة,الكمية,السعر,القيمة الإجمالية,الأولوية,الحالة,ملاحظات\n",e.clinicNeeds.forEach(e=>{const n=e.created_at?ma(e.created_at):"غير محدد",a=e.item_name||"غير محدد",s=e.category||"غير محدد",r=e.quantity||0,i=e.price?ca(e.price):"غير محدد",l=ca((e.quantity||0)*(e.price||0)),o="urgent"===e.priority?"عاجل":"high"===e.priority?"عالي":"medium"===e.priority?"متوسط":"low"===e.priority?"منخفض":e.priority||"غير محدد",d="pending"===e.status?"معلق":"ordered"===e.status?"مطلوب":"received"===e.status?"مستلم":"cancelled"===e.status?"ملغي":e.status||"غير محدد",c=(e.notes||"").replace(/,/g,"؛");t+=`${n},"${a}","${s}",${r},${i},${l},"${o}","${d}","${c}"\n`}),t+="\n"),t+="توزيع المواعيد حسب الحالة\n",e.stats.appointmentsByStatus&&"object"==typeof e.stats.appointmentsByStatus?Object.entries(e.stats.appointmentsByStatus).forEach(([e,n])=>{t+=`${e},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",t+="توزيع المدفوعات حسب طريقة الدفع\n",e.stats.paymentsByMethod&&"object"==typeof e.stats.paymentsByMethod?Object.entries(e.stats.paymentsByMethod).forEach(([e,n])=>{t+=`${e},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",t+="توزيع المخزون حسب الفئة\n",e.stats.inventoryByCategory&&"object"==typeof e.stats.inventoryByCategory?Object.entries(e.stats.inventoryByCategory).forEach(([e,n])=>{t+=`${e},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",e.payments.length>0&&(t+="تفاصيل المدفوعات المفلترة\n",t+="رقم الإيصال,المريض,المبلغ,طريقة الدفع,الحالة,تاريخ الدفع,الوصف\n",e.payments.forEach(n=>{var a;const s=(null==(a=e.patients.find(e=>e.id===n.patient_id))?void 0:a.full_name)||"غير محدد";t+=`"${n.receipt_number||`#${n.id.slice(-6)}`}","${s}","${ca(n.amount)}","${n.payment_method}","${n.status}","${ma(n.payment_date)}","${n.description||"-"}"\n`}),t+="\n"),e.appointments.length>0&&(t+="تفاصيل المواعيد المفلترة\n",t+="المريض,العنوان,التاريخ,الوقت,الحالة,التكلفة\n",e.appointments.forEach(n=>{var a;const s=(null==(a=e.patients.find(e=>e.id===n.patient_id))?void 0:a.full_name)||"غير محدد";t+=`"${s}","${n.title||"-"}","${ma(n.start_time)}","${ha(n.start_time)}","${n.status}","${ca(n.cost||0)}"\n`}),t+="\n"),e.inventory.length>0&&(t+="تفاصيل المخزون المفلتر\n",t+="اسم المنتج,الفئة,الكمية,السعر,تاريخ الانتهاء,الحالة\n",e.inventory.forEach(e=>{t+=`"${e.name}","${e.category||"-"}","${e.quantity}","${ca(e.price||0)}","${e.expiry_date?ma(e.expiry_date):"-"}","${e.status||"-"}"\n`})),t}static getTreatmentNameInArabic(e){return ud(e)}static getCategoryNameInArabic(e){return md(e)}static getStatusLabelInArabic(e){return pd(e)}static formatGregorianDate(e){if(!e||isNaN(e.getTime()))return"غير محدد";return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`}static exportComprehensiveReportToExcel(e){return m(this,null,function*(){const t=new jt.Workbook;t.creator="نظام إدارة العيادة",t.created=new Date,t.modified=new Date,t.title="التقرير الشامل المفصل",t.description="تقرير شامل لجميع جوانب العيادة",yield this.createSummarySheet(t,e),yield this.createPatientsSheet(t,e),yield this.createAppointmentsSheet(t,e),yield this.createPaymentsSheet(t,e),yield this.createInventorySheet(t,e),yield this.createLabOrdersSheet(t,e),yield this.createClinicNeedsSheet(t,e),yield this.createExpensesSheet(t,e),yield this.createProfitLossSheet(t,e);const n=`التقرير_الشامل_المفصل_${Hh[e.timePeriod]}_${(new Date).toISOString().split("T")[0]}`,a=yield t.xlsx.writeBuffer(),s=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=document.createElement("a"),i=URL.createObjectURL(s);r.setAttribute("href",i),r.setAttribute("download",`${n}.xlsx`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),console.log("✅ تم تصدير التقرير الشامل المفصل بنجاح")})}static createSummarySheet(e,t){return m(this,null,function*(){try{console.log("Creating summary sheet with data:",t);const n=e.addWorksheet("الملخص العام");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="التقرير الشامل المفصل - عيادة الأسنان",a.font={size:18,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF2E8B57"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"thick"},left:{style:"thick"},bottom:{style:"thick"},right:{style:"thick"}},n.getCell("A3").value=`تاريخ التقرير: ${ma(new Date)}`,n.getCell("A3").font={size:12,italic:!0};const s=t.timePeriod&&Hh[t.timePeriod]?Hh[t.timePeriod]:t.timePeriod||"غير محدد";n.getCell("A4").value=`الفترة الزمنية: ${s}`,n.getCell("A4").font={size:12,italic:!0};let r=6;const i=Array.isArray(t.patients)?t.patients:[],l=Array.isArray(t.appointments)?t.appointments:[],o=Array.isArray(t.payments)?t.payments:[],d=Array.isArray(t.inventory)?t.inventory:[],c=Array.isArray(t.labOrders)?t.labOrders:[],u=Array.isArray(t.clinicNeeds)?t.clinicNeeds:[],m=Array.isArray(t.expenses)?t.expenses:[];console.log("Data arrays lengths:",{patients:i.length,appointments:l.length,payments:o.length,inventory:d.length,labOrders:c.length,clinicNeeds:u.length,expenses:m.length});const p=[["إجمالي المرضى",i.length],["إجمالي المواعيد",l.length],["إجمالي المدفوعات",o.length],["إجمالي عناصر المخزون",d.length],["إجمالي طلبات المختبرات",c.length],["إجمالي احتياجات العيادة",u.length],["إجمالي مصروفات العيادة",m.length]];n.getCell(`A${r}`).value="الإحصائيات الأساسية",n.getCell(`A${r}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},r+=2,Array.isArray(p)&&p.forEach(([e,t])=>{n.getCell(`A${r}`).value=e,n.getCell(`B${r}`).value=t,n.getCell(`A${r}`).font={bold:!0};["A","B"].forEach(e=>{const t=n.getCell(`${e}${r}`);t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}},t.alignment={horizontal:"right",vertical:"middle"}}),r++}),r+=2,n.getCell(`A${r}`).value="الإحصائيات المالية",n.getCell(`A${r}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},r+=2;const h=t.stats||{},x=[["إجمالي الإيرادات",ca(h.totalRevenue||0)],["المدفوعات المكتملة",ca(h.completedPayments||0)],["المدفوعات الجزئية",ca(h.partialPayments||0)],["المبالغ المعلقة",ca(h.pendingAmount||0)],["إجمالي المصروفات",ca(h.totalExpenses||0)],["صافي الربح/الخسارة",ca(h.netProfit||0)]];Array.isArray(x)&&x.forEach(([e,t])=>{n.getCell(`A${r}`).value=e,n.getCell(`B${r}`).value=t,n.getCell(`A${r}`).font={bold:!0};["A","B"].forEach(e=>{const t=n.getCell(`${e}${r}`);t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}},t.alignment={horizontal:"right",vertical:"middle"}}),r++}),n.getColumn("A").width=30,n.getColumn("B").width=20,console.log("Summary sheet created successfully")}catch(n){throw console.error("Error creating summary sheet:",n),n}})}static createPatientsSheet(e,t){return m(this,null,function*(){const n=e.addWorksheet("المرضى");n.mergeCells("A1:G1");const a=n.getCell("A1");a.value="تقرير المرضى",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=t.patients||[],i=[["إجمالي المرضى",r.length],["المرضى الذكور",r.filter(e=>"male"===e.gender).length],["المرضى الإناث",r.filter(e=>"female"===e.gender).length],["متوسط العمر",r.length>0?Math.round(r.reduce((e,t)=>e+(t.age||0),0)/r.length):0]];n.getCell(`A${s}`).value="إحصائيات المرضى",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,i.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل المرضى",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["الرقم التسلسلي","الاسم الكامل","الجنس","العمر","الهاتف","البريد الإلكتروني","تاريخ التسجيل"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,r.forEach((e,t)=>{[e.serial_number||"",e.full_name||"","male"===e.gender?"ذكر":"female"===e.gender?"أنثى":"غير محدد",e.age||"",e.phone||"",e.email||"",e.created_at?ma(e.created_at):""].forEach((e,a)=>{const r=n.getCell(s,a+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})}),s++}),n.columns.forEach(e=>{e.width=15})})}static createAppointmentsSheet(e,t){return m(this,null,function*(){const n=e.addWorksheet("المواعيد");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="تقرير المواعيد",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF8B5CF6"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=Array.isArray(t.appointments)?t.appointments:[],i=[["إجمالي المواعيد",r.length],["المواعيد المكتملة",r.filter(e=>"completed"===e.status).length],["المواعيد الملغية",r.filter(e=>"cancelled"===e.status).length],["المواعيد المجدولة",r.filter(e=>"scheduled"===e.status).length]];n.getCell(`A${s}`).value="إحصائيات المواعيد",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,i.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل المواعيد",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["التاريخ","الوقت","اسم المريض","نوع العلاج","التكلفة","الحالة","الطبيب","ملاحظات"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF8B5CF6"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,Array.isArray(r)&&r.forEach((e,t)=>{var a;[e.start_time?ma(e.start_time):"",e.start_time?new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"",(null==(a=e.patient)?void 0:a.full_name)||"غير محدد",e.title||"غير محدد",e.cost?ca(e.cost):"0",this.getStatusInArabic(e.status),e.doctor_name||"غير محدد",e.notes||""].forEach((e,a)=>{const r=n.getCell(s,a+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})}),s++}),n.columns.forEach(e=>{e.width=15})})}static createPaymentsSheet(e,t){return m(this,null,function*(){const n=e.addWorksheet("المدفوعات");n.mergeCells("A1:I1");const a=n.getCell("A1");a.value="تقرير المدفوعات",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF10B981"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=Array.isArray(t.payments)?t.payments:[],i=r.reduce((e,t)=>e+(t.amount||0),0),l=r.filter(e=>"completed"===e.status),o=r.filter(e=>"partial"===e.status),d=r.filter(e=>"pending"===e.status),c=[["إجمالي المدفوعات",r.length],["إجمالي الإيرادات",ca(i)],["المدفوعات المكتملة",l.length],["المدفوعات الجزئية",o.length],["المدفوعات المعلقة",d.length]];n.getCell(`A${s}`).value="إحصائيات المدفوعات",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,c.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل المدفوعات",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["تاريخ الدفع","اسم المريض","الوصف","المبلغ","المبلغ المدفوع","الرصيد المتبقي","طريقة الدفع","الحالة","رقم الإيصال"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF10B981"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,Array.isArray(r)&&r.forEach((e,t)=>{var a;let r,i,l;"partial"===e.status?(r=Number(e.total_amount_due||e.amount)||0,i=Number(e.amount_paid||e.amount)||0,l=Math.max(0,r-i)):e.appointment_id&&e.appointment_total_cost?(r=Number(e.appointment_total_cost)||0,i=Number(e.appointment_total_paid||e.amount)||0,l=Number(e.appointment_remaining_balance||0)):(r=Number(e.amount)||0,i=Number(e.amount)||0,l=0);[e.payment_date?ma(e.payment_date):"",(null==(a=e.patient)?void 0:a.full_name)||"غير محدد",e.description||"غير محدد",ca(r),ca(i),ca(l),e.payment_method||"غير محدد",this.getPaymentStatusInArabic(e.status),e.receipt_number||""].forEach((e,a)=>{const r=n.getCell(s,a+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),a>=3&&a<=5&&(r.font={bold:!0},r.fill||(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}}))}),s++}),n.columns.forEach(e=>{e.width=15})})}static createInventorySheet(e,t){return m(this,null,function*(){const n=e.addWorksheet("المخزون");n.mergeCells("A1:F1");const a=n.getCell("A1");a.value="تقرير المخزون",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF59E0B"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=Array.isArray(t.inventory)?t.inventory:[],i=r.reduce((e,t)=>e+(t.cost||0)*(t.quantity||0),0),l=r.filter(e=>(e.quantity||0)<=5).length,o=[["إجمالي العناصر",r.length],["القيمة الإجمالية",ca(i)],["عناصر منخفضة المخزون",l],["عناصر نفدت من المخزون",r.filter(e=>0===(e.quantity||0)).length]];n.getCell(`A${s}`).value="إحصائيات المخزون",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,o.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل المخزون",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["اسم المنتج","الفئة","الكمية","التكلفة","القيمة الإجمالية","تاريخ الانتهاء"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF59E0B"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,Array.isArray(r)&&r.forEach((e,t)=>{[e.name||"",e.category||"",e.quantity||0,ca(e.cost||0),ca((e.cost||0)*(e.quantity||0)),e.expiry_date?ma(e.expiry_date):""].forEach((a,r)=>{const i=n.getCell(s,r+1);i.value=a,i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),2===r&&(e.quantity||0)<=5&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFECACA"}},i.font={bold:!0,color:{argb:"FFDC2626"}})}),s++}),n.columns.forEach(e=>{e.width=15})})}static createLabOrdersSheet(e,t){return m(this,null,function*(){const n=e.addWorksheet("طلبات المختبرات");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="تقرير طلبات المختبرات",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF14B8A6"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=Array.isArray(t.labOrders)?t.labOrders:[],i=r.reduce((e,t)=>e+(t.cost||0),0),l=r.reduce((e,t)=>e+(t.paid_amount||0),0),o=i-l,d=[["إجمالي الطلبات",r.length],["إجمالي التكلفة",ca(i)],["إجمالي المدفوع",ca(l)],["إجمالي المتبقي",ca(o)]];n.getCell(`A${s}`).value="إحصائيات طلبات المختبرات",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,d.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل طلبات المختبرات",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["تاريخ الطلب","المختبر","اسم المريض","الخدمة","التكلفة","المدفوع","المتبقي","الحالة"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF14B8A6"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,Array.isArray(r)&&r.forEach((e,a)=>{var r;const i=(Array.isArray(t.patients)?t.patients:[]).find(t=>t.id===e.patient_id);[e.order_date?ma(e.order_date):"",(null==(r=e.lab)?void 0:r.name)||"غير محدد",(null==i?void 0:i.full_name)||"غير محدد",e.service_name||"غير محدد",ca(e.cost||0),ca(e.paid_amount||0),ca((e.cost||0)-(e.paid_amount||0)),e.status||"غير محدد"].forEach((e,t)=>{const r=n.getCell(s,t+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},a%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),t>=4&&t<=6&&(r.font={bold:!0},r.fill||(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}}))}),s++}),n.columns.forEach(e=>{e.width=15})})}static createClinicNeedsSheet(e,t){return m(this,null,function*(){const n=e.addWorksheet("احتياجات العيادة");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="تقرير احتياجات العيادة",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEC4899"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=t.clinicNeeds.reduce((e,t)=>e+(t.price||0)*(t.quantity||0),0),i=t.clinicNeeds.filter(e=>"urgent"===e.priority).length,l=t.clinicNeeds.filter(e=>"pending"===e.status).length,o=[["إجمالي الاحتياجات",t.clinicNeeds.length],["إجمالي التكلفة المتوقعة",ca(r)],["الاحتياجات العاجلة",i],["الاحتياجات المعلقة",l]];n.getCell(`A${s}`).value="إحصائيات احتياجات العيادة",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,o.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل احتياجات العيادة",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["تاريخ الطلب","اسم الصنف","الفئة","الكمية","السعر المتوقع","القيمة الإجمالية","الأولوية","الحالة"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEC4899"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,t.clinicNeeds.forEach((e,t)=>{[e.created_at?ma(e.created_at):"",e.name||"غير محدد",e.category||"غير محدد",e.quantity||0,ca(e.price||0),ca((e.price||0)*(e.quantity||0)),{urgent:"عاجل",high:"عالي",medium:"متوسط",low:"منخفض"}[e.priority]||e.priority||"غير محدد",{pending:"معلق",ordered:"تم الطلب",received:"تم الاستلام"}[e.status]||e.status||"غير محدد"].forEach((a,r)=>{const i=n.getCell(s,r+1);i.value=a,i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),"urgent"===e.priority&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFECACA"}},i.font={bold:!0,color:{argb:"FFDC2626"}})}),s++}),n.columns.forEach(e=>{e.width=15})})}static createExpensesSheet(e,t){return m(this,null,function*(){const n=e.addWorksheet("مصروفات العيادة");n.mergeCells("A1:G1");const a=n.getCell("A1");a.value="تقرير مصروفات العيادة",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEF4444"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=t.expenses.reduce((e,t)=>e+(t.amount||0),0),i=t.expenses.filter(e=>"paid"===e.status),l=t.expenses.filter(e=>"pending"===e.status),o=[["إجمالي المصروفات",t.expenses.length],["إجمالي المبلغ",ca(r)],["المصروفات المدفوعة",i.length],["المصروفات المعلقة",l.length]];n.getCell(`A${s}`).value="إحصائيات مصروفات العيادة",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,o.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل مصروفات العيادة",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["تاريخ الدفع","اسم المصروف","النوع","المبلغ","طريقة الدفع","المورد","الحالة"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEF4444"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,t.expenses.forEach((e,t)=>{[e.payment_date?ma(e.payment_date):"",e.expense_name||"غير محدد",{salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"}[e.expense_type]||e.expense_type||"غير محدد",ca(e.amount||0),{cash:"نقداً",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمان"}[e.payment_method]||e.payment_method||"غير محدد",e.vendor||"غير محدد","paid"===e.status?"مدفوع":"معلق"].forEach((e,a)=>{const r=n.getCell(s,a+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),3===a&&(r.font={bold:!0},r.fill||(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}}))}),s++}),n.columns.forEach(e=>{e.width=15})})}static createProfitLossSheet(e,t){return m(this,null,function*(){const n=e.addWorksheet("الأرباح والخسائر");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="تقرير الأرباح والخسائر",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF7C3AED"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=t.payments.reduce((e,t)=>e+(t.amount||0),0),i=t.labOrders.reduce((e,t)=>e+(t.cost||0),0),l=t.clinicNeeds.reduce((e,t)=>e+(t.price||0)*(t.quantity||0),0),o=t.inventory.reduce((e,t)=>e+(t.cost||0)*(t.quantity||0),0),d=t.expenses.reduce((e,t)=>e+(t.amount||0),0),c=i+l+o+d,u=r-c,m=u>=0,p=r>0?u/r*100:0;n.getCell(`A${s}`).value="ملخص الأرباح والخسائر",n.getCell(`A${s}`).font={size:14,bold:!0,color:{argb:"FF7C3AED"}},s+=2;[["إجمالي الإيرادات",ca(r)],["إجمالي المصروفات",ca(c)],["صافي الربح/الخسارة",ca(Math.abs(u))],["نسبة الربح",`${p.toFixed(2)}%`],["الحالة المالية",m?"ربح":"خسارة"]].forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,n.getCell(`A${s}`).font={bold:!0},"الحالة المالية"===e&&(n.getCell(`B${s}`).font={bold:!0,color:{argb:m?"FF10B981":"FFEF4444"}}),s++}),s+=2,n.getCell(`A${s}`).value="تفصيل الإيرادات",n.getCell(`A${s}`).font={size:14,bold:!0,color:{argb:"FF10B981"}},s+=2;const h=t.payments.filter(e=>"completed"===e.status),x=t.payments.filter(e=>"partial"===e.status),g=t.payments.filter(e=>"pending"===e.status);[["المدفوعات المكتملة",`${h.length} (${ca(h.reduce((e,t)=>e+(t.amount||0),0))})`],["المدفوعات الجزئية",`${x.length} (${ca(x.reduce((e,t)=>e+(t.amount||0),0))})`],["المدفوعات المعلقة",`${g.length} (${ca(g.reduce((e,t)=>e+(t.amount||0),0))})`]].forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفصيل المصروفات",n.getCell(`A${s}`).font={size:14,bold:!0,color:{argb:"FFEF4444"}},s+=2;[["تكاليف المختبرات",ca(i)],["احتياجات العيادة",ca(l)],["تكاليف المخزون",ca(o)],["مصروفات مباشرة",ca(d)]].forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),n.getColumn("A").width=30,n.getColumn("B").width=20})}static getPaymentStatusInArabic(e){return{completed:"مكتمل",partial:"جزئي",pending:"معلق",overdue:"متأخر",cancelled:"ملغي"}[e]||e}static filterByDateRange(e,t,n){if(!t||!t.start||!t.end)return e;const a=new Date(t.start),s=new Date(t.end);return s.setHours(23,59,59,999),e.filter(e=>{const t=new Date(e[n]);return t>=a&&t<=s})}}function Wh(){const{payments:e}=Go(),{expenses:t}=Ch(),{inventoryItems:n}=jd(),{labOrders:a}=Th(),{clinicNeeds:s}=Eh(),{currentCurrency:r}=Sa(),[i,l]=ve.useState(null),[o,d]=ve.useState(!1),c=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},u=()=>m(this,null,function*(){d(!0);try{const r=qh.validateAllFinancialData({payments:e,expenses:t,inventory:n,labOrders:a,clinicNeeds:s}),i=Gh.calculateFinancialStats(e,a,s,n,t),o=c(t.filter(e=>"paid"===e.status).reduce((e,t)=>e+c(t.amount),0)),d=Array.isArray(n)?n:[],u=c(d.reduce((e,t)=>e+c(t.cost_per_unit||0)*c(t.quantity||0),0)),m=Array.isArray(s)?s:[],p=c(m.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+c(t.quantity)*c(t.price),0)),h=Array.isArray(a)?a:[],x=o+u+p+c(h.reduce((e,t)=>e+c(t.paid_amount||0),0)),g=c(e.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+c(t.amount),0)),f=g-x,v=g>0?f/g*100:0,y={revenueMatch:Math.abs(g-i.totalRevenue)<.01,expensesMatch:Math.abs(x-i.totalExpenses)<.01,profitMatch:Math.abs(f-(i.netProfit||i.lossAmount))<.01},b=r.isValid&&y.revenueMatch&&y.expensesMatch&&y.profitMatch;l({isAccurate:b,totalRevenue:g,totalExpenses:x,netProfit:f,profitMargin:v,dataIntegrity:{paymentsValid:e.length>0,expensesValid:t.length>=0,inventoryValid:n.length>=0,labOrdersValid:a.length>=0,clinicNeedsValid:s.length>=0},errors:r.errors,warnings:r.warnings,lastVerified:new Date})}catch(r){console.error("Error during financial verification:",r),l({isAccurate:!1,totalRevenue:0,totalExpenses:0,netProfit:0,profitMargin:0,dataIntegrity:{paymentsValid:!1,expensesValid:!1,inventoryValid:!1,labOrdersValid:!1,clinicNeedsValid:!1},errors:[`Verification failed: ${r}`],warnings:[],lastVerified:new Date})}finally{d(!1)}});ve.useEffect(()=>{u()},[e,t,n,a,s]);const h=e=>e?p.jsx(gr,{className:"h-4 w-4 text-green-500"}):p.jsx(Ri,{className:"h-4 w-4 text-red-500"});return p.jsxs(Lo,{className:"w-full",children:[p.jsx(Io,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(mr,{className:"h-5 w-5"}),"التحقق من دقة النظام المالي"]}),p.jsx(Bo,{children:"فحص شامل لضمان دقة 100% في جميع الحسابات المالية"})]}),p.jsxs(Qi,{onClick:u,disabled:o,size:"sm",children:[o?p.jsx(mi,{className:"h-4 w-4 animate-spin mr-2"}):p.jsx(mi,{className:"h-4 w-4 mr-2"}),"فحص الآن"]})]})}),p.jsx(Yo,{className:"space-y-6",children:i&&p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[h(i.isAccurate),p.jsxs("span",{className:"font-medium",children:["حالة النظام المالي: ",(x=i.isAccurate,p.jsx(qo,{variant:x?"default":"destructive",children:x?"صحيح":"خطأ"}))]})]}),p.jsxs("span",{className:"text-sm text-muted-foreground",children:["آخر فحص: ",i.lastVerified.toLocaleString("ar-SA")]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsx("div",{className:"text-sm text-muted-foreground",children:"إجمالي الإيرادات"}),p.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.jsx(Nh,{amount:i.totalRevenue,currency:r})})]}),p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsx("div",{className:"text-sm text-muted-foreground",children:"إجمالي المصروفات"}),p.jsx("div",{className:"text-2xl font-bold text-red-600",children:p.jsx(Nh,{amount:i.totalExpenses,currency:r})})]}),p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsx("div",{className:"text-sm text-muted-foreground",children:"صافي الربح"}),p.jsx("div",{className:"text-2xl font-bold "+(i.netProfit>=0?"text-green-600":"text-red-600"),children:p.jsx(Nh,{amount:i.netProfit,currency:r})}),p.jsxs("div",{className:"text-sm text-muted-foreground",children:["هامش الربح: ",i.profitMargin.toFixed(1),"%"]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("h4",{className:"font-medium",children:"سلامة البيانات"}),p.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[p.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[h(i.dataIntegrity.paymentsValid),p.jsx("span",{className:"text-sm",children:"المدفوعات"})]}),p.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[h(i.dataIntegrity.expensesValid),p.jsx("span",{className:"text-sm",children:"المصروفات"})]}),p.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[h(i.dataIntegrity.inventoryValid),p.jsx("span",{className:"text-sm",children:"المخزون"})]}),p.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[h(i.dataIntegrity.labOrdersValid),p.jsx("span",{className:"text-sm",children:"المختبر"})]}),p.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[h(i.dataIntegrity.clinicNeedsValid),p.jsx("span",{className:"text-sm",children:"الاحتياجات"})]})]})]}),i.errors.length>0&&p.jsxs(mc,{variant:"destructive",children:[p.jsx(Ri,{className:"h-4 w-4"}),p.jsxs(pc,{children:[p.jsx("div",{className:"font-medium mb-2",children:"أخطاء مكتشفة:"}),p.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.errors.map((e,t)=>p.jsx("li",{className:"text-sm",children:e},t))})]})]}),i.warnings.length>0&&p.jsxs(mc,{children:[p.jsx(sr,{className:"h-4 w-4"}),p.jsxs(pc,{children:[p.jsx("div",{className:"font-medium mb-2",children:"تحذيرات:"}),p.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.warnings.map((e,t)=>p.jsx("li",{className:"text-sm",children:e},t))})]})]})]})})]});var x}const Kh=ve.forwardRef((e,t)=>{var n=e,{className:a,value:s=0,max:r=100}=n,i=c(n,["className","value","max"]);const l=Math.min(Math.max(s/r*100,0),100);return p.jsx("div",d(o({ref:t,className:aa("relative h-2 w-full overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",a)},i),{children:p.jsx("div",{className:"h-full bg-blue-600 dark:bg-blue-500 transition-all duration-300 ease-in-out rounded-full",style:{width:`${l}%`}})}))});function Zh(){const{payments:e}=Go(),{expenses:t}=Ch(),{inventoryItems:n}=jd(),{labOrders:a}=Th(),{clinicNeeds:s}=Eh(),{currentCurrency:r}=Sa(),[i,l]=ve.useState(null),[o,d]=ve.useState(!1),c=()=>m(this,null,function*(){d(!0);try{const r=Date.now(),i=[],o=[],d=[];let c=100;const u=Array.isArray(e)?e:[],m=Array.isArray(t)?t:[],p=Array.isArray(n)?n:[],h=Array.isArray(a)?a:[],x=Array.isArray(s)?s:[];0===u.length&&(o.push("لا توجد مدفوعات في النظام"),c-=20),0===m.length&&(o.push("لا توجد مصروفات مسجلة"),c-=10);const g=qh.validateAllFinancialData({payments:u,expenses:m,inventory:p,labOrders:h,clinicNeeds:x});let f=g.isValid?100:70;g.isValid||(i.push(...g.errors),f-=10*g.errors.length),g.warnings.length>0&&(o.push(...g.warnings),f-=5*g.warnings.length);const v=Gh.calculateFinancialStats(e,a,s,n,t),y=v.totalRevenue,b=v.totalExpenses,j=v.isProfit?v.netProfit:-v.lossAmount,w=v.profitMargin,N=Date.now()-r;let _=100;N>1e3&&(_-=20,o.push("تحليل النظام يستغرق وقتاً أطول من المتوقع"));let k=100;const S=new Date(Date.now()-36e5),D=e.filter(e=>new Date(e.payment_date)>S);e.length>0&&0===D.length&&(k-=10,o.push("لا توجد مدفوعات حديثة في الساعة الماضية")),b>y&&d.push("المصروفات تتجاوز الإيرادات - يُنصح بمراجعة الميزانية"),w<10&&d.push("هامش الربح منخفض - يُنصح بتحسين الكفاءة التشغيلية"),0===n.length&&d.push("لا توجد عناصر في المخزون - يُنصح بإضافة المواد الأساسية");const $=Math.round((c+f+k+_)/4),C={overallHealth:Math.max(0,Math.min(100,$)),dataIntegrity:Math.max(0,Math.min(100,c)),calculationAccuracy:Math.max(0,Math.min(100,f)),realTimeSync:Math.max(0,Math.min(100,k)),performanceScore:Math.max(0,Math.min(100,_))};l({isHealthy:$>=80&&0===i.length,lastUpdated:new Date,metrics:C,issues:i,warnings:o,recommendations:d,financialSummary:{totalRevenue:y,totalExpenses:b,netProfit:j,profitMargin:w},dataStats:{paymentsCount:e.length,expensesCount:t.length,inventoryCount:n.length,labOrdersCount:a.length,clinicNeedsCount:s.length}})}catch(r){console.error("Error analyzing system health:",r),l({isHealthy:!1,lastUpdated:new Date,metrics:{overallHealth:0,dataIntegrity:0,calculationAccuracy:0,realTimeSync:0,performanceScore:0},issues:[`خطأ في تحليل النظام: ${r}`],warnings:[],recommendations:["يُنصح بإعادة تشغيل التطبيق"],financialSummary:{totalRevenue:0,totalExpenses:0,netProfit:0,profitMargin:0},dataStats:{paymentsCount:0,expensesCount:0,inventoryCount:0,labOrdersCount:0,clinicNeedsCount:0}})}finally{d(!1)}});ve.useEffect(()=>{c()},[e,t,n,a,s]);const u=e=>e>=90?"text-green-600":e>=70?"text-yellow-600":"text-red-600";return p.jsxs(Lo,{className:"w-full",children:[p.jsx(Io,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(nr,{className:"h-5 w-5"}),"حالة النظام المالي"]}),p.jsx(Bo,{children:"مراقبة شاملة لصحة وأداء النظام المالي في الوقت الفعلي"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[i&&(h=i.isHealthy,p.jsx(qo,{variant:h?"default":"destructive",children:h?"صحي":"يحتاج انتباه"})),p.jsxs(Qi,{onClick:c,disabled:o,size:"sm",variant:"outline",children:[o?p.jsx(mi,{className:"h-4 w-4 animate-spin mr-2"}):p.jsx(mi,{className:"h-4 w-4 mr-2"}),"تحديث"]})]})]})}),p.jsx(Yo,{className:"space-y-6",children:i&&p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"text-center p-6 border rounded-lg",children:[p.jsxs("div",{className:`text-4xl font-bold ${u(i.metrics.overallHealth)}`,children:[i.metrics.overallHealth,"%"]}),p.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"الصحة العامة للنظام"}),p.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["آخر تحديث: ",i.lastUpdated.toLocaleString("ar-SA")]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex justify-between text-sm",children:[p.jsx("span",{children:"سلامة البيانات"}),p.jsxs("span",{className:u(i.metrics.dataIntegrity),children:[i.metrics.dataIntegrity,"%"]})]}),p.jsx(Kh,{value:i.metrics.dataIntegrity,className:"h-2"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex justify-between text-sm",children:[p.jsx("span",{children:"دقة الحسابات"}),p.jsxs("span",{className:u(i.metrics.calculationAccuracy),children:[i.metrics.calculationAccuracy,"%"]})]}),p.jsx(Kh,{value:i.metrics.calculationAccuracy,className:"h-2"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex justify-between text-sm",children:[p.jsx("span",{children:"التزامن الفوري"}),p.jsxs("span",{className:u(i.metrics.realTimeSync),children:[i.metrics.realTimeSync,"%"]})]}),p.jsx(Kh,{value:i.metrics.realTimeSync,className:"h-2"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex justify-between text-sm",children:[p.jsx("span",{children:"الأداء"}),p.jsxs("span",{className:u(i.metrics.performanceScore),children:[i.metrics.performanceScore,"%"]})]}),p.jsx(Kh,{value:i.metrics.performanceScore,className:"h-2"})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx(Er,{className:"h-4 w-4 text-green-600"}),p.jsx("span",{className:"text-sm font-medium",children:"إجمالي الإيرادات"})]}),p.jsx("div",{className:"text-xl font-bold text-green-600",children:p.jsx(Nh,{amount:i.financialSummary.totalRevenue,currency:r})})]}),p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx(Xr,{className:"h-4 w-4 text-red-600"}),p.jsx("span",{className:"text-sm font-medium",children:"إجمالي المصروفات"})]}),p.jsx("div",{className:"text-xl font-bold text-red-600",children:p.jsx(Nh,{amount:i.financialSummary.totalExpenses,currency:r})})]}),p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.financialSummary.netProfit>=0?p.jsx(di,{className:"h-4 w-4 text-green-600"}):p.jsx(Xr,{className:"h-4 w-4 text-red-600"}),p.jsx("span",{className:"text-sm font-medium",children:"صافي الربح"})]}),p.jsx("div",{className:"text-xl font-bold "+(i.financialSummary.netProfit>=0?"text-green-600":"text-red-600"),children:p.jsx(Nh,{amount:i.financialSummary.netProfit,currency:r})})]}),p.jsxs("div",{className:"p-4 border rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.financialSummary.profitMargin>=0?p.jsx(ki,{className:"h-4 w-4 text-green-600"}):p.jsx(_i,{className:"h-4 w-4 text-red-600"}),p.jsx("span",{className:"text-sm font-medium",children:"هامش الربح"})]}),p.jsxs("div",{className:"text-xl font-bold "+(i.financialSummary.profitMargin>=0?"text-green-600":"text-red-600"),children:[i.financialSummary.profitMargin.toFixed(1),"%"]})]})]}),p.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[p.jsxs("div",{className:"text-center p-3 border rounded",children:[p.jsx("div",{className:"text-2xl font-bold",children:i.dataStats.paymentsCount}),p.jsx("div",{className:"text-sm text-muted-foreground",children:"مدفوعات"})]}),p.jsxs("div",{className:"text-center p-3 border rounded",children:[p.jsx("div",{className:"text-2xl font-bold",children:i.dataStats.expensesCount}),p.jsx("div",{className:"text-sm text-muted-foreground",children:"مصروفات"})]}),p.jsxs("div",{className:"text-center p-3 border rounded",children:[p.jsx("div",{className:"text-2xl font-bold",children:i.dataStats.inventoryCount}),p.jsx("div",{className:"text-sm text-muted-foreground",children:"مخزون"})]}),p.jsxs("div",{className:"text-center p-3 border rounded",children:[p.jsx("div",{className:"text-2xl font-bold",children:i.dataStats.labOrdersCount}),p.jsx("div",{className:"text-sm text-muted-foreground",children:"مختبر"})]}),p.jsxs("div",{className:"text-center p-3 border rounded",children:[p.jsx("div",{className:"text-2xl font-bold",children:i.dataStats.clinicNeedsCount}),p.jsx("div",{className:"text-sm text-muted-foreground",children:"احتياجات"})]})]}),i.issues.length>0&&p.jsxs(mc,{variant:"destructive",children:[p.jsx(Ri,{className:"h-4 w-4"}),p.jsxs(pc,{children:[p.jsx("div",{className:"font-medium mb-2",children:"مشاكل تحتاج إصلاح:"}),p.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.issues.map((e,t)=>p.jsx("li",{className:"text-sm",children:e},t))})]})]}),i.warnings.length>0&&p.jsxs(mc,{children:[p.jsx(sr,{className:"h-4 w-4"}),p.jsxs(pc,{children:[p.jsx("div",{className:"font-medium mb-2",children:"تحذيرات:"}),p.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.warnings.map((e,t)=>p.jsx("li",{className:"text-sm",children:e},t))})]})]}),i.recommendations.length>0&&p.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/50 border border-blue-200 dark:border-blue-700 rounded-lg",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx(Li,{className:"h-4 w-4 text-blue-600"}),p.jsx("span",{className:"font-medium text-blue-800 dark:text-blue-200",children:"توصيات للتحسين:"})]}),p.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-blue-700 dark:text-blue-300",children:i.recommendations.map((e,t)=>p.jsx("li",{children:e},t))})]})]})})]});var h}function Qh(){var e,t,n,a;const{financialReports:s,isLoading:r,isExporting:i,generateReport:l,clearCache:u}=Sh(),{payments:h,totalRevenue:x,pendingAmount:g,overdueAmount:f,paymentMethodStats:v,monthlyRevenue:y,loadPayments:b}=Go(),{expenses:j,analytics:w,loadExpenses:N}=Ch(),{inventoryItems:_,loadItems:k}=jd(),{labOrders:S,loadLabOrders:D}=Th(),{clinicNeeds:$,loadNeeds:C}=Eh(),{currentCurrency:E,formatAmount:T}=Sa(),{settings:A}=qt(),{isDarkMode:F}=Gt(),P=Bd({data:h,dateField:"payment_date",initialFilter:{preset:"all",startDate:"",endDate:""}}),O=Bd({data:j,dateField:"payment_date",initialFilter:P.timeFilter});Fh("financial"),ve.useEffect(()=>{l("financial"),b(),N(),k(),D(),C()},[l,b,N,k,D,C]),ve.useEffect(()=>{const e=Array.isArray(h)?h:[],t=Array.isArray(j)?j:[],n=Array.isArray(_)?_:[];if(e.length>0||t.length>0||n.length>0)try{(function(e){const t=qh.validateAllFinancialData(e);return t.isValid?(t.warnings.length>0&&console.warn("⚠️ Financial validation warnings:",t.warnings),console.log("✅ Financial validation passed with 100% accuracy"),!0):(console.error("❌ Financial validation failed:",t.errors),!1)})({payments:e,expenses:t,inventory:n})||console.warn("⚠️ Financial data validation issues detected. Please check the data integrity.")}catch(a){console.error("Error validating financial data:",a)}},[h,j,_]),ve.useEffect(()=>{const e=Array.isArray(h)?h:[];if(e.length>0)try{const t=Yh(e);t.totalErrors>0&&console.warn(`Found ${t.totalErrors} errors in ${t.invalidPayments.length} payments`),t.totalWarnings>0&&console.warn(`Found ${t.totalWarnings} warnings in payment data`)}catch(t){console.error("Error validating payments:",t)}},[h]);const R=(()=>{const e=P||{filteredData:[],timeFilter:{preset:"all"}},t=Array.isArray(h)?h:[],n=Yh(Array.isArray(e.filteredData)&&e.filteredData.length>0?e.filteredData:t).validPayments;if(s&&"all"===e.timeFilter.preset&&(!e.timeFilter.startDate||!e.timeFilter.endDate))return{totalRevenue:Vh(s.totalRevenue),totalPaid:Vh(s.totalPaid),totalPending:Vh(s.totalPending),totalOverdue:Vh(s.totalOverdue),revenueByPaymentMethod:s.revenueByPaymentMethod||{},revenueTrend:s.revenueTrend||[],recentTransactions:s.recentTransactions||[],outstandingPayments:s.outstandingPayments||[]};const a=n.filter(e=>"completed"===e.status),r=n.filter(e=>"pending"===e.status),i=n.filter(e=>"failed"===e.status),l=n.filter(e=>"refunded"===e.status),o=a.reduce((e,t)=>e+(t.amount||0),0),d=r.reduce((e,t)=>e+(t.amount||0),0),c=n.filter(e=>"overdue"===e.status).reduce((e,t)=>e+(t.amount||0),0);!function(e){const t={},n=[];e&&"object"==typeof e?Object.entries(e).forEach(([e,a])=>{if(!e.match(/^\d{4}-\d{2}$/))return void n.push(`Invalid month format: ${e}`);const s=Bh(a);s.isValid?t[e]=s.sanitizedValue||0:n.push(`Invalid amount for month ${e}: ${a}`)}):n.push("Monthly data is not a valid object")}(y||{});const u=function(e){const t={},n=[];if(!e||"object"!=typeof e)return n.push("Payment method stats is not a valid object"),{validStats:t,errors:n};const a=["cash","card","bank_transfer","check","insurance"];return Object.entries(e).forEach(([e,s])=>{a.includes(e)||"unknown"===e||console.warn(`Unknown payment method: ${e}`);const r=Bh(s);r.isValid?t[e]=r.sanitizedValue||0:n.push(`Invalid amount for payment method ${e}: ${s}`)}),{validStats:t,errors:n}}(v||{}),m=n.length,p=m>0?Math.round(a.length/m*1e3)/10:0,x=a.length>0&&o>0?Math.round(o/a.length*100)/100:0;return{totalRevenue:Vh(o),totalPaid:Vh(o),totalPending:Vh(d),totalOverdue:Vh(c),revenueByPaymentMethod:u.validStats,revenueTrend:[],recentTransactions:[],outstandingPayments:[],totalTransactions:m,completedCount:a.length,pendingCount:r.length,failedCount:i.length,refundedCount:l.length,successRate:isNaN(p)?"0.0":p.toFixed(1),averageTransaction:isNaN(x)?"0.00":x.toFixed(2),validatedPayments:n}})();R.totalTransactions||(h||[]).length,R.completedCount||(h||[]).filter(e=>"completed"===e.status).length,R.pendingCount||(h||[]).filter(e=>"pending"===e.status).length,R.failedCount||(h||[]).filter(e=>"failed"===e.status).length,R.refundedCount||(h||[]).filter(e=>"refunded"===e.status).length,R.successRate,R.averageTransaction;const M=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},L=O||{filteredData:[]},I=Array.isArray(j)?j:[],z=Array.isArray(L.filteredData)&&L.filteredData.length>0?L.filteredData:I,B=qh.validateExpenses(z),Y=B.calculations.totalExpenses,V=M((_||[]).reduce((e,t)=>e+M(t.cost_per_unit||0)*M(t.quantity||0),0)),q=M(($||[]).filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+M(t.quantity)*M(t.price),0)),U=M((S||[]).reduce((e,t)=>e+M(t.paid_amount||0),0)),H=Y+V+q+U;console.log("💰 Financial System Verification:",{revenue:{totalRevenue:R.totalRevenue,completedPayments:(null==(e=null==P?void 0:P.financialStats)?void 0:e.completedPayments)||0,partialPayments:(null==(t=null==P?void 0:P.financialStats)?void 0:t.partialPayments)||0,pendingAmount:g,overdueAmount:f},expenses:{directExpenses:Y,inventoryExpenses:V,clinicNeedsExpenses:q,labOrdersExpenses:U,totalExpenses:H},calculations:{netProfit:R.totalRevenue-H,profitMargin:R.totalRevenue>0?(R.totalRevenue-H)/R.totalRevenue*100:0},dataIntegrity:{paymentsCount:(h||[]).length,expensesCount:(j||[]).length,inventoryItemsCount:(_||[]).length,clinicNeedsCount:($||[]).length,labOrdersCount:(S||[]).length}}),!B.isValid&&z.length>0&&console.warn("⚠️ Expense validation errors:",B.errors);const G=qh.validateAmount(R.totalRevenue-H).value,W=R.totalRevenue>0?G/R.totalRevenue*100:0,K=qh.validateAllFinancialData({payments:h||[],expenses:z||[],inventory:_||[],labOrders:S||[],clinicNeeds:$||[]});K.isValid||console.error("❌ Comprehensive Financial Validation Failed:",K.errors),K.warnings.length>0&&console.warn("⚠️ Financial Validation Warnings:",K.warnings);const Z=Gh.calculateFinancialStats(h,S,$,_,z),Q={revenueMatch:Math.abs(R.totalRevenue-Z.totalRevenue)<.01,expensesMatch:Math.abs(H-Z.totalExpenses)<.01,profitMatch:Math.abs(G-Z.netProfit)<.01};Q.revenueMatch&&Q.expensesMatch&&Q.profitMatch?console.log("✅ Financial Calculations Verified - 100% Accuracy Confirmed"):console.warn("⚠️ Financial Calculation Mismatch Detected:",{local:{revenue:R.totalRevenue,expenses:H,profit:G},system:{revenue:Z.totalRevenue,expenses:Z.totalExpenses,profit:Z.netProfit},comparison:Q}),ve.useEffect(()=>{const e=P||{timeFilter:{preset:"all"}},t=O||{timeFilter:{preset:"all"},handleFilterChange:()=>{}};e.timeFilter!==t.timeFilter&&t.handleFilterChange&&t.handleFilterChange(e.timeFilter)},[null==P?void 0:P.timeFilter,null==O?void 0:O.timeFilter]),ve.useEffect(()=>{const e=e=>{console.log("🔄 Financial data changed:",e.detail),b(),N(),k(),D(),C()},t=["payments-changed","clinic-expenses-changed","inventory-changed","lab-orders-changed","clinic-needs-changed"];return t.forEach(t=>{window.addEventListener(t,e)}),()=>{t.forEach(t=>{window.removeEventListener(t,e)})}},[b,N,k,D,C]);const X=(()=>{const e={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},t={};return z.filter(e=>"paid"===e.status).forEach(e=>{const n=e.expense_type||"other",a=M(e.amount);t[n]=(t[n]||0)+a}),Object.entries(t).map(([t,n])=>({name:e[t]||t,value:n,percentage:H>0?n/H*100:0}))})();ya("categorical",F);const J=ya("primary",F),ee=wa("financial",F,8),te=wa("status",F,8),ne=ja(F),ae=(()=>{var e;try{const t={cash:"نقداً",card:"بطاقة ائتمان",bank_transfer:"تحويل بنكي",check:"شيك",insurance:"تأمين"},n=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},a=h||[],s=(null==(e=null==P?void 0:P.filteredData)?void 0:e.length)>0?P.filteredData:a;if(0===s.length)return[];const r={};s.filter(e=>"completed"===e.status||"partial"===e.status).forEach(e=>{const t=e.payment_method||"cash",a=n(e.amount);console.log(`Payment method calculation - Payment ${e.id}: Method=${t}, Amount=${a}, Status=${e.status}`),a>0&&(r[t]=(r[t]||0)+a)}),console.log("Payment method calculated stats:",r);const i=Object.entries(r).filter(([e,t])=>t>0).map(([e,a])=>({method:t[e]||e,amount:n(a),formattedAmount:ca(a,E),count:s.filter(t=>t.payment_method===e&&("completed"===t.status||"partial"===t.status)).length})).sort((e,t)=>t.amount-e.amount);return console.log("Payment method final data:",i),console.log("Payment method total:",i.reduce((e,t)=>e+t.amount,0)),function(e){return e.filter(e=>e.amount>0).map(e=>d(o({},e),{method:e.method||"غير محدد"}))}(i)}catch(t){return console.error("Financial Reports: Error processing payment method data:",t),[]}})(),se=(()=>{var e;try{const t=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},n=h||[],a=(null==(e=null==P?void 0:P.filteredData)?void 0:e.length)>0?P.filteredData:n;if(0===a.length)return[];console.log("Processing monthly revenue for",a.length,"payments"),console.log("Sample payments:",a.slice(0,3)),console.log("All payment amounts:",a.map(e=>({id:e.id,amount:e.amount,status:e.status,date:e.payment_date})));const s={};a.filter(e=>"completed"===e.status||"partial"===e.status).forEach(e=>{try{const n=new Date(e.payment_date||e.created_at||e.date);if(isNaN(n.getTime()))return void console.warn("Invalid payment date for payment:",e.id,e.payment_date);const a=n.toISOString().slice(0,7),r=t(e.amount);console.log(`Payment ${e.id}: Date=${e.payment_date}, Month=${a}, Amount=${r}, Status=${e.status}`),r>0&&(s[a]=(s[a]||0)+r,console.log(`Added ${r} to month ${a}, total now: ${s[a]}`))}catch(n){console.warn("Error processing payment date:",e.payment_date,n)}}),console.log("Calculated monthly revenue:",s);const r=Object.entries(s);if(1===r.length){const[e,t]=r[0],n=new Date(e+"-01"),a=new Date(n);a.setMonth(a.getMonth()-1);const i=a.toISOString().slice(0,7);s[i]=0;const l=new Date(n);l.setMonth(l.getMonth()+1);const o=l.toISOString().slice(0,7);s[o]=0}const i=Object.entries(s).filter(([e,t])=>e.match(/^\d{4}-\d{2}$/)).map(([e,n])=>{const a=new Date(e+"-01");return{month:`${["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"][a.getMonth()]} ${a.getFullYear()}`,revenue:t(n),formattedRevenue:ca(t(n),E),originalMonth:e}}).sort((e,t)=>e.originalMonth.localeCompare(t.originalMonth)).map(e=>{var t=e,{originalMonth:n}=t;return c(t,["originalMonth"])});return console.log("Final monthly revenue data:",i),i}catch(t){return console.error("Financial Reports: Error processing monthly revenue data:",t),[]}})(),re=(()=>{var e;try{const t=h||[],n=(null==(e=null==P?void 0:P.filteredData)?void 0:e.length)>0?P.filteredData:t;if(0===n.length)return[];const a=n.filter(e=>"completed"===e.status).length,s=n.filter(e=>"partial"===e.status).length,r=n.filter(e=>"pending"===e.status).length,i=n.filter(e=>"failed"===e.status).length,l=n.filter(e=>"refunded"===e.status).length,c=n.length;return function(e){return e.filter(e=>e.value>0)}([{name:"مكتمل",value:a,color:te[0]||"#10b981"},{name:"جزئي",value:s,color:te[1]||"#f59e0b"},{name:"معلق",value:r,color:te[2]||"#6b7280"},{name:"فاشل",value:i,color:te[3]||"#ef4444"},{name:"مسترد",value:l,color:te[4]||"#8b5cf6"}].filter(e=>e.value>0).map(e=>d(o({},e),{percentage:c>0?Math.round(e.value/c*100):0})))}catch(t){return console.error("Financial Reports: Error processing status data:",t),[]}})();return p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"التقارير المالية"}),p.jsx("p",{className:"text-muted-foreground mt-1",children:"إحصائيات وتحليلات شاملة للمدفوعات والإيرادات"}),p.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[p.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[p.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),p.jsx("span",{children:"البيانات محدثة في الوقت الفعلي"})]}),P.filteredData.length>0&&p.jsxs("div",{className:"text-xs text-muted-foreground",children:["• ",P.filteredData.length," معاملة",P.timeFilter.startDate&&P.timeFilter.endDate&&" (مفلترة)"]})]})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){try{u(),yield l("financial"),yield b();const e=new CustomEvent("showToast",{detail:{title:"تم التحديث بنجاح",description:"تم تحديث التقارير المالية",type:"success"}});window.dispatchEvent(e)}catch(e){console.error("Error refreshing financial reports:",e);const t=new CustomEvent("showToast",{detail:{title:"خطأ في التحديث",description:"فشل في تحديث التقارير",type:"error"}});window.dispatchEvent(t)}}),disabled:r,children:[p.jsx(mi,{className:"w-4 h-4 ml-2 "+(r?"animate-spin":"")}),"تحديث"]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){try{const e=P.filteredData.length>0?P.filteredData:h;if(0===e.length)return void rc.noDataToExport("لا توجد بيانات مالية للتصدير");const t=yield function(e,t,n){return m(this,null,function*(){const a=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},s=Gh.calculateFinancialStats(e,[],[],[],n);let r="\ufeff";r+="التقرير المالي الشامل\n",r+="===================\n\n",r+="معلومات التقرير\n",r+="================\n",r+=`تاريخ التقرير,${ma((new Date).toISOString())}\n`,r+=`وقت التقرير,${(new Date).toLocaleTimeString("ar-SA")}\n`,t.startDate&&t.endDate?r+=`الفترة الزمنية,من ${t.startDate} إلى ${t.endDate}\n`:r+="الفترة الزمنية,جميع البيانات\n",r+=`عدد المعاملات,${e.length}\n\n`,r+="الإحصائيات المالية الرئيسية\n",r+="============================\n",r+=`إجمالي الإيرادات,${ca(s.totalRevenue)}\n`,r+=`المدفوعات المكتملة,${ca(s.completedPayments)}\n`,r+=`المدفوعات الجزئية,${ca(s.partialPayments)}\n`,r+=`المبالغ المتبقية,${ca(s.remainingBalances)}\n`,r+=`المبالغ المعلقة,${ca(s.pendingAmount)}\n`,r+=`إجمالي المصروفات,${ca(s.totalExpenses||0)}\n`,r+=`صافي الربح,${ca(s.netProfit||0)}\n`,r+=`هامش الربح,${(s.profitMargin||0).toFixed(2)}%\n`,r+=`حالة الربحية,${(s.netProfit||0)>=0?"ربح":"خسارة"}\n\n`,r+="تحليل الأرباح والخسائر\n",r+="====================\n",r+=`صافي الربح,${ca(s.netProfit||0)}\n`,r+=`مبلغ الخسارة,${ca(s.lossAmount||0)}\n`,r+=`هامش الربح,${(s.profitMargin||0).toFixed(2)}%\n`,r+=`حالة الأرباح,${s.isProfit?"ربح":"خسارة"}\n`,r+=`إجمالي المصروفات,${ca(s.totalExpenses||0)}\n\n`,r+="تفصيل المصروفات\n",r+="================\n",r+=`مصروفات المخابر,${ca(s.labOrdersTotal||0)}\n`,r+=`متبقي المخابر,${ca(s.labOrdersRemaining||0)}\n`,r+=`مصروفات الاحتياجات,${ca(s.clinicNeedsTotal||0)}\n`,r+=`متبقي الاحتياجات,${ca(s.clinicNeedsRemaining||0)}\n`,r+=`مصروفات المخزون,${ca(s.inventoryExpenses||0)}\n\n`,r+="إحصائيات المعاملات\n",r+="==================\n",r+=`إجمالي المعاملات,${s.totalTransactions}\n`,r+=`المعاملات المكتملة,${s.completedTransactions}\n`,r+=`المعاملات الجزئية,${s.partialTransactions}\n`,r+=`المعاملات المعلقة,${s.pendingTransactions}\n\n`,r+="تحليل طرق الدفع\n",r+="================\n";const i={};if(e.forEach(e=>{const t=e.payment_method||"غير محدد",n="cash"===t?"نقدي":"card"===t?"بطاقة ائتمان":"bank_transfer"===t?"تحويل بنكي":"check"===t?"شيك":"insurance"===t?"تأمين":t;let s=0;"completed"===e.status?s=a(e.amount):"partial"===e.status&&void 0!==e.amount_paid&&(s=a(e.amount_paid)),s>0&&(i[n]=(i[n]||0)+s)}),Object.entries(i).forEach(([e,t])=>{const n=s.totalRevenue>0?(t/s.totalRevenue*100).toFixed(2):"0.00";r+=`${e},${ca(t)} (${n}%)\n`}),r+="\n",s.expensesByType&&s.expensesByType.length>0&&(r+="توزيع المصروفات حسب النوع\n",r+="==========================\n",r+="نوع المصروف,المبلغ,النسبة المئوية\n",s.expensesByType.forEach(e=>{r+=`"${e.type}",${ca(e.amount)},${e.percentage.toFixed(2)}%\n`}),r+="\n"),n&&n.length>0){const e=n.filter(e=>"paid"===e.status).sort((e,t)=>new Date(t.payment_date).getTime()-new Date(e.payment_date).getTime()).slice(0,20);if(e.length>0){r+="المصروفات الحديثة (آخر 20 مصروف)\n",r+="===================================\n",r+="اسم المصروف,النوع,المبلغ,طريقة الدفع,تاريخ الدفع,المورد,رقم الإيصال,ملاحظات\n";const t={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},n={cash:"نقداً",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمان"};e.forEach(e=>{const a=(e.expense_name||"غير محدد").replace(/,/g,"؛"),s=t[e.expense_type]||e.expense_type||"غير محدد",i=ca(e.amount||0),l=n[e.payment_method]||e.payment_method||"غير محدد",o=e.payment_date?ma(e.payment_date):"غير محدد",d=(e.vendor||"غير محدد").replace(/,/g,"؛"),c=e.receipt_number||"غير محدد",u=(e.notes||"").replace(/,/g,"؛");r+=`"${a}","${s}",${i},"${l}",${o},"${d}","${c}","${u}"\n`}),r+="\n"}}return e.length<=100&&(r+="تفاصيل المدفوعات الفردية\n",r+="=========================\n",r+="رقم الإيصال,المريض,المبلغ,المبلغ المدفوع,طريقة الدفع,الحالة,تاريخ الدفع,الوصف,ملاحظات\n",e.forEach(e=>{var t,n;const a=e.receipt_number||`#${(null==(t=e.id)?void 0:t.slice(-6))||"N/A"}`,s=(null==(n=e.patient)?void 0:n.full_name)||e.patient_name||"غير محدد",i=ca(e.amount||0),l=e.amount_paid?ca(e.amount_paid):i,o="cash"===e.payment_method?"نقدي":"card"===e.payment_method?"بطاقة ائتمان":"bank_transfer"===e.payment_method?"تحويل بنكي":"check"===e.payment_method?"شيك":"insurance"===e.payment_method?"تأمين":e.payment_method||"غير محدد",d="completed"===e.status?"مكتمل":"partial"===e.status?"جزئي":"pending"===e.status?"معلق":"failed"===e.status?"فاشل":"refunded"===e.status?"مسترد":e.status||"غير محدد",c=e.payment_date?ma(e.payment_date):"غير محدد",u=(e.description||"").replace(/,/g,"؛"),m=(e.notes||"").replace(/,/g,"؛");r+=`"${a}","${s}",${i},${l},"${o}","${d}",${c},"${u}","${m}"\n`})),r})}(e,P.timeFilter,z);yield ic.convertCSVToExcel(t,"comprehensive-financial",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"}),rc.exportSuccess(`تم تصدير التقرير المالي الشامل بنجاح! (${e.length} معاملة)`)}catch(e){console.error("Error exporting comprehensive financial CSV:",e),rc.exportError("فشل في تصدير التقرير المالي الشامل")}}),disabled:i,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير Excel شامل"]}),p.jsxs(Qi,{variant:"default",size:"sm",onClick:()=>m(this,null,function*(){try{const e=P.filteredData.length>0?P.filteredData:h;if(0===e.length)return void rc.noDataToExport("لا توجد بيانات مالية للتصدير");const t=yield function(e,t,n,a,s,r){return m(this,null,function*(){const i=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},l=Gh.calculateFinancialStats(e,n,a,s,r),o=r?r.filter(e=>"paid"===e.status).reduce((e,t)=>e+i(t.amount),0):0,d=r?(()=>{const e={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},t={};return r.filter(e=>"paid"===e.status).forEach(e=>{const n=e.expense_type||"other",a=i(e.amount);t[n]=(t[n]||0)+a}),Object.entries(t).map(([t,n])=>({type:e[t]||t,amount:i(n),percentage:o>0?i(n)/o*100:0}))})():[],c=(l.totalExpenses||0)+o,u=l.totalRevenue-c,m=l.totalRevenue>0?u/l.totalRevenue*100:0,p={};return e.forEach(e=>{const t=e.payment_method||"unknown",n=i(e.amount);n>0&&("completed"===e.status||"partial"===e.status)&&(p[t]=(p[t]||0)+n)}),console.log("Payment method stats calculation:",{paymentsLength:e.length,paymentMethodStats:p}),{totalRevenue:l.totalRevenue,totalPaid:l.completedPayments+l.partialPayments,totalPending:l.pendingAmount,totalOverdue:l.remainingBalances,completedPayments:e.filter(e=>"completed"===e.status).length,partialPayments:e.filter(e=>"partial"===e.status).length,pendingPayments:e.filter(e=>"pending"===e.status).length,failedPayments:e.filter(e=>"failed"===e.status).length,netProfit:u,lossAmount:u<0?Math.abs(u):0,profitMargin:m,isProfit:u>=0,totalExpenses:c,labOrdersTotal:l.labOrdersTotal||0,labOrdersRemaining:l.labOrdersRemaining||0,clinicNeedsTotal:l.clinicNeedsTotal||0,clinicNeedsRemaining:l.clinicNeedsRemaining||0,inventoryExpenses:l.inventoryExpenses||0,clinicExpensesTotal:o,expensesByType:d,revenueByPaymentMethod:Object.entries(p).map(([e,t])=>({method:"cash"===e?"نقدي":"card"===e?"بطاقة ائتمان":"bank_transfer"===e?"تحويل بنكي":"check"===e?"شيك":"insurance"===e?"تأمين":e,amount:i(t),percentage:l.totalRevenue>0?i(t)/l.totalRevenue*100:0})),filterInfo:t.startDate&&t.endDate?`البيانات المفلترة من ${t.startDate} إلى ${t.endDate}`:"جميع البيانات المالية",dataCount:e.length,totalTransactions:e.length,successRate:e.length>0?(e.filter(e=>"completed"===e.status||"partial"===e.status).length/e.length*100).toFixed(1):"0.0",averageTransaction:e.length>0?(l.totalRevenue/e.length).toFixed(2):"0.00",payments:e.map(e=>{var t,n;return{id:e.id,receipt_number:e.receipt_number||`#${(null==(t=e.id)?void 0:t.slice(-6))||"N/A"}`,patient_name:(null==(n=e.patient)?void 0:n.full_name)||e.patient_name||"غير محدد",amount:e.amount,amount_paid:e.amount_paid,payment_method:e.payment_method,status:e.status,payment_date:e.payment_date,description:e.description,notes:e.notes}}),expenses:r?r.filter(e=>"paid"===e.status).map(e=>({id:e.id,expense_name:e.expense_name,amount:e.amount,expense_type:e.expense_type,category:e.category,payment_method:e.payment_method,payment_date:e.payment_date,description:e.description,vendor:e.vendor,receipt_number:e.receipt_number,notes:e.notes})):[]}})}(e,P.timeFilter,S,$,_,z);yield Mh.exportComprehensiveFinancialReport(t,A);let n=`تم تصدير التقرير المالي الشامل كملف PDF بنجاح! (${e.length} معاملة)`;P.timeFilter.startDate&&P.timeFilter.endDate&&(n+=` - مفلتر من ${P.timeFilter.startDate} إلى ${P.timeFilter.endDate}`),n+=` - إجمالي الإيرادات: $${t.totalRevenue.toFixed(2)}`,rc.exportSuccess(n)}catch(e){console.error("Error exporting comprehensive financial PDF:",e),rc.exportError("فشل في تصدير التقرير المالي الشامل كملف PDF")}}),disabled:i,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير PDF شامل"]})]})]}),p.jsx(zd,{value:P.timeFilter,onChange:P.handleFilterChange,onClear:P.resetFilter,title:"فلترة زمنية - المدفوعات",defaultOpen:!1}),p.jsx(Zh,{}),p.jsx(Wh,{}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[p.jsxs(Lo,{className:vd("green"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"إجمالي الإيرادات"}),p.jsx(Er,{className:`h-4 w-4 ${yd("green")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:p.jsx(Nh,{amount:(null==(n=null==P?void 0:P.financialStats)?void 0:n.totalRevenue)||x||0,currency:E})}),p.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["من ",((null==P?void 0:P.filteredData)||[]).filter(e=>"completed"===e.status||"partial"===e.status).length," معاملة"]}),(null==P?void 0:P.trend)&&p.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(P.trend.isPositive?"text-green-600":"text-red-600"),children:[p.jsxs("span",{className:"ml-1",children:[Math.abs(P.trend.changePercent||0),"%"]}),P.trend.isPositive?p.jsx(ki,{className:"h-3 w-3"}):p.jsx(_i,{className:"h-3 w-3"})]})]})]}),p.jsxs(Lo,{className:vd("red"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"إجمالي المصروفات"}),p.jsx(Xr,{className:`h-4 w-4 ${yd("red")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:p.jsx(Nh,{amount:H,currency:E})}),p.jsxs("div",{className:"text-xs text-muted-foreground text-right space-y-1 mt-2",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{children:"مصروفات مباشرة:"}),p.jsx(Nh,{amount:Y,currency:E})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{children:"تكلفة المخزون:"}),p.jsx(Nh,{amount:V,currency:E})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{children:"احتياجات العيادة:"}),p.jsx(Nh,{amount:q,currency:E})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{children:"طلبات المختبر:"}),p.jsx(Nh,{amount:U,currency:E})]}),p.jsx("div",{className:"border-t pt-1 mt-2 font-medium",children:p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{children:"إجمالي المصروفات:"}),p.jsx(Nh,{amount:H,currency:E})]})})]})]})]}),p.jsxs(Lo,{className:vd(G>=0?"green":"red"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"صافي الربح"}),G>=0?p.jsx(di,{className:`h-4 w-4 ${yd("green")}`}):p.jsx(Xr,{className:`h-4 w-4 ${yd("red")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:p.jsx(Nh,{amount:G,currency:E})}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"الإيرادات - المصروفات"})]})]}),p.jsxs(Lo,{className:vd("yellow"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"المبالغ المستحقة"}),p.jsx(Sr,{className:`h-4 w-4 ${yd("yellow")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:p.jsx(Nh,{amount:g+f+((null==(a=null==P?void 0:P.financialStats)?void 0:a.totalRemainingBalance)||0),currency:E})}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"معلقة ومتأخرة ومتبقية"})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",dir:"rtl",children:[p.jsxs(Lo,{className:vd(W>=0?"green":"red"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"هامش الربح"}),p.jsx(dr,{className:`h-4 w-4 ${yd(W>=0?"green":"red")}`})]}),p.jsxs(Yo,{children:[p.jsxs("div",{className:"text-2xl font-bold text-foreground text-right",children:[W.toFixed(1),"%"]}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"نسبة الربح من الإيرادات"})]})]}),p.jsxs(Lo,{className:vd("purple"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"إجمالي المعاملات"}),p.jsx(ui,{className:`h-4 w-4 ${yd("purple")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:((null==P?void 0:P.filteredData)||[]).length}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"معاملة مالية"})]})]}),p.jsxs(Lo,{className:vd("teal"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"متوسط المعاملة"}),p.jsx(Er,{className:`h-4 w-4 ${yd("teal")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:p.jsx(Nh,{amount:(()=>{var e;const t=P||{filteredData:[],financialStats:{totalRevenue:0}},n=Array.isArray(h)?h:[],a=Array.isArray(t.filteredData)&&t.filteredData.length>0?t.filteredData:n,s=(null==(e=t.financialStats)?void 0:e.totalRevenue)||0;return a.length>0?s/a.length:0})(),currency:E})}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"متوسط قيمة المعاملة"})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ii,{className:"w-5 h-5"}),p.jsx("span",{children:"توزيع حالات المدفوعات"})]}),p.jsxs(Bo,{children:["توزيع المدفوعات حسب الحالة (",P.filteredData.length," معاملة)",P.timeFilter.startDate&&P.timeFilter.endDate&&" في الفترة المحددة"]})]}),p.jsxs(Yo,{children:[0===re.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ii,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات مدفوعات متاحة"})]})}):p.jsx(ke,{width:"100%",height:ne.responsive.desktop.height,children:p.jsxs(Se,{margin:{top:20,right:30,left:20,bottom:20},children:[p.jsx(De,{data:re,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t,percent:n})=>t>0?`${e}: ${t} (${(100*n).toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"value",stroke:F?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:re.map((e,t)=>p.jsx($e,{fill:e.color},`payment-status-${t}`))}),p.jsx(Ce,{formatter:(e,t)=>[`${e} معاملة`,"العدد"],labelFormatter:e=>`الحالة: ${e}`,contentStyle:ne.tooltip})]})}),re.length>0&&p.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:re.map((e,t)=>p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsxs("span",{className:"text-muted-foreground",children:[e.name,": ",e.value," (",e.percentage,"%)"]})]},`status-legend-${t}`))})]})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(dr,{className:"w-5 h-5"}),p.jsx("span",{children:"طرق الدفع"})]}),p.jsxs(Bo,{children:["الإيرادات حسب طريقة الدفع (",ca((()=>{const e=ae.reduce((e,t)=>e+t.amount,0);return console.log("Payment method total calculation:",{paymentMethodData:ae,total:e,financialStatsTotal:P.financialStats.totalRevenue}),e})(),E)," إجمالي)",P.timeFilter.startDate&&P.timeFilter.endDate&&" في الفترة المحددة"]})]}),p.jsxs(Yo,{children:[0===ae.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(dr,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات طرق دفع متاحة"})]})}):p.jsx(ke,{width:"100%",height:ne.responsive.desktop.height,children:p.jsxs(Ee,{data:ae,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:ne.bar.barCategoryGap,children:[p.jsx(Te,{strokeDasharray:ne.grid.strokeDasharray,stroke:ne.grid.stroke,strokeOpacity:ne.grid.strokeOpacity}),p.jsx(Ae,{dataKey:"method",tick:{fontSize:14,fill:F?"#9ca3af":"#6b7280"},axisLine:{stroke:F?"#4b5563":"#d1d5db"},tickLine:{stroke:F?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),p.jsx(Fe,{tick:{fontSize:14,fill:F?"#9ca3af":"#6b7280"},axisLine:{stroke:F?"#4b5563":"#d1d5db"},tickLine:{stroke:F?"#4b5563":"#d1d5db"},tickFormatter:e=>Na(e,"currency",E),domain:[0,"dataMax + 100"]}),p.jsx(Ce,{formatter:(e,t,n)=>[ca(Number(e),E),"المبلغ",`${n.payload.count} معاملة`],labelFormatter:e=>`طريقة الدفع: ${e}`,contentStyle:ne.tooltip}),p.jsx(Pe,{dataKey:"amount",fill:J[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100})]})}),ae.length>0&&p.jsx("div",{className:"mt-4 grid grid-cols-1 gap-2 text-sm",children:ae.slice(0,3).map((e,t)=>p.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/50 rounded",children:[p.jsx("span",{className:"font-medium",children:e.method}),p.jsxs("div",{className:"text-left",children:[p.jsx("div",{className:"font-semibold",children:e.formattedAmount}),p.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.count," معاملة"]})]})]},`method-summary-${t}`))})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ii,{className:"w-5 h-5"}),p.jsx("span",{children:"توزيع المصروفات حسب النوع"})]}),p.jsxs(Bo,{children:["توزيع المصروفات المدفوعة حسب النوع (",T(H)," إجمالي)"]})]}),p.jsxs(Yo,{children:[0===X.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ii,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد مصروفات مدفوعة"})]})}):p.jsx(ke,{width:"100%",height:ne.responsive.desktop.height,children:p.jsxs(Se,{margin:{top:20,right:30,left:20,bottom:20},children:[p.jsx(De,{data:X,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t,percentage:n})=>t>0?`${e}: ${T(t)} (${n.toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"value",stroke:F?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:X.map((e,t)=>p.jsx($e,{fill:ee[t%ee.length]},`expense-type-${t}`))}),p.jsx(Ce,{formatter:(e,t)=>[T(Number(e)),"المبلغ"],labelFormatter:e=>`نوع المصروف: ${e}`,contentStyle:ne.tooltip})]})}),X.length>0&&p.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:X.map((e,t)=>p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:ee[t%ee.length]}}),p.jsxs("span",{className:"text-muted-foreground",children:[e.name,": ",p.jsx(Nh,{amount:e.value})," (",e.percentage.toFixed(1),"%)"]})]},`expense-legend-${t}`))})]})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(dr,{className:"w-5 h-5"}),p.jsx("span",{children:"مقارنة الإيرادات والمصروفات"})]}),p.jsx(Bo,{children:"مقارنة بين الإيرادات والمصروفات وصافي الربح"})]}),p.jsx(Yo,{children:p.jsx(ke,{width:"100%",height:ne.responsive.desktop.height,children:p.jsxs(Ee,{data:[{name:"الإيرادات",value:R.totalRevenue,type:"revenue"},{name:"المصروفات",value:H,type:"expenses"},{name:"صافي الربح",value:G,type:"profit"}],margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:ne.bar.barCategoryGap,children:[p.jsx(Te,{strokeDasharray:ne.grid.strokeDasharray,stroke:ne.grid.stroke,strokeOpacity:ne.grid.strokeOpacity}),p.jsx(Ae,{dataKey:"name",tick:{fontSize:14,fill:F?"#9ca3af":"#6b7280"},axisLine:{stroke:F?"#4b5563":"#d1d5db"},tickLine:{stroke:F?"#4b5563":"#d1d5db"}}),p.jsx(Fe,{tick:{fontSize:14,fill:F?"#9ca3af":"#6b7280"},axisLine:{stroke:F?"#4b5563":"#d1d5db"},tickLine:{stroke:F?"#4b5563":"#d1d5db"},tickFormatter:e=>Na(e,"currency",E)}),p.jsx(Ce,{formatter:(e,t,n)=>[T(Number(e)),"المبلغ"],labelFormatter:e=>e,contentStyle:ne.tooltip}),p.jsx(Pe,{dataKey:"value",fill:e=>"revenue"===(null==e?void 0:e.type)?ya("financial",F)[0]:"expenses"===(null==e?void 0:e.type)?ya("financial",F)[1]:(null==e?void 0:e.value)>=0?ya("financial",F)[0]:ya("financial",F)[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100,children:[{name:"الإيرادات",value:R.totalRevenue,type:"revenue"},{name:"المصروفات",value:H,type:"expenses"},{name:"صافي الربح",value:G,type:"profit"}].map((e,t)=>p.jsx($e,{fill:"revenue"===e.type?ya("financial",F)[0]:"expenses"===e.type?ya("financial",F)[1]:e.value>=0?ya("financial",F)[0]:ya("financial",F)[1]},`profit-loss-${t}`))})]})})})]})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ki,{className:"w-5 h-5"}),p.jsx("span",{children:"الإيرادات الشهرية"})]}),p.jsxs(Bo,{children:["تطور الإيرادات عبر الأشهر (",se.length," شهر)"]})]}),p.jsxs(Yo,{children:[0===se.length?p.jsx("div",{className:"flex items-center justify-center h-96 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ki,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات إيرادات شهرية متاحة"}),p.jsx("p",{className:"text-sm mt-2",children:0===P.filteredData.length?"قم بإضافة مدفوعات لعرض الإحصائيات":`يوجد ${P.filteredData.length} مدفوعة ولكن لا توجد بيانات شهرية صالحة`})]})}):p.jsx(ke,{width:"100%",height:ne.responsive.large.height,children:p.jsxs(Oe,{data:se,margin:{top:20,right:30,left:20,bottom:20},children:[p.jsx(Te,{strokeDasharray:ne.grid.strokeDasharray,stroke:ne.grid.stroke,strokeOpacity:ne.grid.strokeOpacity}),p.jsx(Ae,{dataKey:"month",tick:{fontSize:12,fill:F?"#9ca3af":"#6b7280"},axisLine:{stroke:F?"#4b5563":"#d1d5db"},tickLine:{stroke:F?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),p.jsx(Fe,{tick:{fontSize:12,fill:F?"#9ca3af":"#6b7280"},axisLine:{stroke:F?"#4b5563":"#d1d5db"},tickLine:{stroke:F?"#4b5563":"#d1d5db"},tickFormatter:e=>Na(e,"currency",E),domain:[0,"dataMax + 100"]}),p.jsx(Ce,{formatter:e=>[ca(Number(e),E),"الإيرادات"],labelFormatter:e=>`الشهر: ${e}`,contentStyle:ne.tooltip}),p.jsx(Re,{type:"monotone",dataKey:"revenue",stroke:J[0],fill:J[0],fillOpacity:.3,strokeWidth:3,connectNulls:!1})]})}),se.length>0&&p.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[p.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:"أعلى شهر"}),p.jsx("div",{className:"font-semibold",children:(()=>{const e=se.map(e=>e.revenue).filter(e=>e>0);return e.length>0?ca(Math.max(...e),E):ca(0,E)})()})]}),p.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:"متوسط شهري"}),p.jsx("div",{className:"font-semibold",children:(()=>{const e=se.map(e=>e.revenue).filter(e=>e>0);return e.length>0?ca(e.reduce((e,t)=>e+t,0)/e.length,E):ca(0,E)})()})]}),p.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:"أقل شهر"}),p.jsx("div",{className:"font-semibold",children:(()=>{const e=se.map(e=>e.revenue).filter(e=>e>0);return e.length>0?ca(Math.min(...e),E):ca(0,E)})()})]})]})]})]}),P.filteredData.length>0&&p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ui,{className:"w-5 h-5"}),p.jsx("span",{children:"المدفوعات الحديثة"})]}),p.jsxs(Bo,{children:["آخر ",Math.min(10,P.filteredData.length)," مدفوعات",P.timeFilter.startDate&&P.timeFilter.endDate&&` في الفترة من ${P.timeFilter.startDate} إلى ${P.timeFilter.endDate}`]})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"overflow-x-auto",children:p.jsxs("table",{className:"w-full border-collapse",children:[p.jsx("thead",{children:p.jsxs("tr",{className:"border-b border-border",children:[p.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"رقم الإيصال"}),p.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"المريض"}),p.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"المبلغ"}),p.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"طريقة الدفع"}),p.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"الحالة"}),p.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"التاريخ"})]})}),p.jsx("tbody",{children:P.filteredData.sort((e,t)=>new Date(t.payment_date||t.created_at).getTime()-new Date(e.payment_date||e.created_at).getTime()).slice(0,10).map((e,t)=>{var n,a;return p.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/50 transition-colors",children:[p.jsx("td",{className:"p-3 text-right",children:p.jsx("span",{className:"font-mono text-sm",children:e.receipt_number||`#${(null==(n=e.id)?void 0:n.slice(-6))||"N/A"}`})}),p.jsx("td",{className:"p-3 text-right",children:p.jsx("span",{className:"font-medium",children:(null==(a=e.patient)?void 0:a.full_name)||e.patient_name||"غير محدد"})}),p.jsx("td",{className:"p-3 text-right",children:p.jsxs("div",{className:"flex flex-col",children:[p.jsx("span",{className:"font-semibold",children:p.jsx(Nh,{amount:"pending"===e.status?e.total_amount_due&&e.total_amount_due>0?e.total_amount_due:e.remaining_balance&&e.remaining_balance>0?e.remaining_balance:e.amount||0:e.amount||0,currency:E})}),"partial"===e.status&&p.jsxs("div",{className:"text-xs space-y-0.5",children:[e.amount_paid&&p.jsxs("div",{className:"text-blue-600 dark:text-blue-400",children:["مدفوع: ",p.jsx(Nh,{amount:e.amount_paid,currency:E})]}),(e.appointment_remaining_balance||e.remaining_balance)&&p.jsxs("div",{className:"text-orange-600 dark:text-orange-400",children:["متبقي: ",p.jsx(Nh,{amount:e.appointment_remaining_balance||e.remaining_balance||0,currency:E})]})]}),"pending"===e.status&&e.total_amount_due&&p.jsxs("div",{className:"text-xs text-muted-foreground",children:["إجمالي مطلوب: ",p.jsx(Nh,{amount:e.total_amount_due,currency:E})]})]})}),p.jsx("td",{className:"p-3 text-right",children:p.jsx("span",{className:"text-sm",children:{cash:"نقداً",card:"بطاقة ائتمان",bank_transfer:"تحويل بنكي",check:"شيك",insurance:"تأمين"}[e.payment_method]||e.payment_method||"غير محدد"})}),p.jsx("td",{className:"p-3 text-right",children:p.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${{completed:"text-green-600 bg-green-50 dark:bg-green-900/20",partial:"text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20",pending:"text-gray-600 bg-gray-50 dark:bg-gray-900/20",failed:"text-red-600 bg-red-50 dark:bg-red-900/20",refunded:"text-purple-600 bg-purple-50 dark:bg-purple-900/20"}[e.status]||"text-gray-600 bg-gray-50"}`,children:{completed:"مكتمل",partial:"جزئي",pending:"معلق",failed:"فاشل",refunded:"مسترد"}[e.status]||e.status||"غير محدد"})}),p.jsx("td",{className:"p-3 text-right",children:p.jsx("span",{className:"text-sm text-muted-foreground",children:ma(e.payment_date||e.created_at)})})]},e.id||t)})})]})}),P.filteredData.length>10&&p.jsx("div",{className:"mt-4 text-center",children:p.jsxs("p",{className:"text-sm text-muted-foreground",children:["عرض 10 من أصل ",P.filteredData.length," مدفوعة"]})})]})]})]})}function Xh({isActive:e=!0,lastUpdate:t,className:n=""}){const[a,s]=ve.useState(!1);ve.useEffect(()=>{const e=()=>{s(!0),setTimeout(()=>s(!1),1e3)},t=["patient-added","patient-updated","patient-deleted","patient-changed","appointment-added","appointment-updated","appointment-deleted","appointment-changed","payment-added","payment-updated","payment-deleted","payment-changed","inventory-added","inventory-updated","inventory-deleted","inventory-changed"];return t.forEach(t=>{window.addEventListener(t,e)}),()=>{t.forEach(t=>{window.removeEventListener(t,e)})}},[]);return e?p.jsx(qo,{variant:a?"default":"secondary",className:`flex items-center gap-1 ${n} ${a?"bg-green-500 text-white":"bg-green-100 text-green-800"}`,children:a?p.jsxs(p.Fragment,{children:[p.jsx(mi,{className:"w-3 h-3 animate-spin"}),p.jsx("span",{className:"text-xs",children:"يتم التحديث..."})]}):p.jsxs(p.Fragment,{children:[p.jsx(Oi,{className:"w-3 h-3"}),p.jsx("span",{className:"text-xs",children:t?(e=>{const t=(new Date).getTime()-e.getTime(),n=Math.floor(t/1e3),a=Math.floor(n/60),s=Math.floor(a/60);if(n<60)return"الآن";if(a<60)return`منذ ${a} دقيقة`;if(s<24)return`منذ ${s} ساعة`;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})(t):"متصل"})]})}):p.jsxs(qo,{variant:"secondary",className:`flex items-center gap-1 ${n}`,children:[p.jsx(Pi,{className:"w-3 h-3"}),p.jsx("span",{className:"text-xs",children:"غير متصل"})]})}Kh.displayName="Progress";const Jh=()=>{const[e,t]=ve.useState(!1);ve.useEffect(()=>{m(void 0,null,function*(){t(!0);try{yield cd()}finally{t(!1)}})},[]);return{updateTreatmentName:ve.useCallback((e,t)=>{((e,t)=>{ld[e]=t})(e,t)},[]),refreshTreatmentNames:ve.useCallback(()=>m(void 0,null,function*(){t(!0);try{yield cd()}finally{t(!1)}}),[]),isLoading:e}},ex=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16","#f97316"];function tx({title:e,value:t,icon:n,color:a,description:s,trend:r}){return p.jsxs(Lo,{className:vd(a),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:e}),p.jsx(n,{className:`h-4 w-4 ${yd(a)}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right mb-1",children:t}),s&&p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:s}),r&&p.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(r.isPositive?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[p.jsx(ki,{className:"h-3 w-3 ml-1 "+(r.isPositive?"":"rotate-180")}),p.jsxs("span",{children:[Math.abs(r.value),"%"]})]})]})]})}function nx(){const{treatmentReports:e,isLoading:t,isExporting:n,generateReport:a,clearCache:s}=Sh(),{toothTreatments:r,loadToothTreatments:i}=Ko(),{patients:l,loadPatients:c}=cl(),{currency:u,settings:h}=qt();Gt();const{refreshTreatmentNames:x}=Jh(),g=Bd({data:r,dateField:"created_at",initialFilter:{preset:"all",startDate:"",endDate:""}});Fh("treatments"),ve.useEffect(()=>{a("treatments"),i(),c(),x()},[a,i,c,x]);const f=ve.useMemo(()=>{const e=g.filteredData;if(!e||0===e.length)return{totalTreatments:0,completedTreatments:0,plannedTreatments:0,inProgressTreatments:0,cancelledTreatments:0,totalRevenue:0,averageTreatmentCost:0,completionRate:0,treatmentsByStatus:[],treatmentsByCategory:[],treatmentsByType:[],revenueByCategory:[],pendingTreatments:[],overdueTreatments:[]};const t=e.length,n=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"planned"===e.status).length,s=e.filter(e=>"in-progress"===e.status).length,r=e.filter(e=>"cancelled"===e.status).length,i=e.reduce((e,t)=>e+(t.cost||0),0),c=t>0?i/t:0,u=t>0?Math.round(n/t*100):0,m=e.reduce((e,t)=>{const n=pd(t.status||"غير محدد");return e[n]=(e[n]||0)+1,e},{}),p=Object.entries(m).map(([e,n])=>({status:e,count:n,percentage:t>0?Math.round(n/t*100):0})),h=e.reduce((e,t)=>{const n=md(t.treatment_category||"غير محدد");return e[n]=(e[n]||0)+1,e},{}),x=Object.entries(h).map(([e,n])=>({category:e,count:n,percentage:t>0?Math.round(n/t*100):0})),f=e.reduce((e,t)=>{const n=ud(t.treatment_type||"غير محدد");return e[n]=(e[n]||0)+1,e},{}),v=Object.entries(f).map(([e,n])=>({type:e,count:n,percentage:t>0?Math.round(n/t*100):0})),y=Object.entries(e.reduce((e,t)=>{const n=md(t.treatment_category||"غير محدد");return e[n]||(e[n]={revenue:0,count:0}),e[n].revenue+=t.cost||0,e[n].count+=1,e},{})).map(([e,t])=>({category:e,revenue:t.revenue,count:t.count})),b=e.filter(e=>"planned"===e.status||"in-progress"===e.status).map(e=>{var t,n,a;return d(o({},e),{patient_name:(null==(t=l.find(t=>t.id===e.patient_id))?void 0:t.full_name)||`${(null==(n=l.find(t=>t.id===e.patient_id))?void 0:n.first_name)||""} ${(null==(a=l.find(t=>t.id===e.patient_id))?void 0:a.last_name)||""}`.trim()||`مريض ${e.patient_id}`})}),j=new Date;j.setDate(j.getDate()-30);const w=b.filter(e=>new Date(e.created_at)<j);return{totalTreatments:t,completedTreatments:n,plannedTreatments:a,inProgressTreatments:s,cancelledTreatments:r,totalRevenue:i,averageTreatmentCost:c,completionRate:u,treatmentsByStatus:p,treatmentsByCategory:x,treatmentsByType:v,revenueByCategory:y,pendingTreatments:b,overdueTreatments:w}},[g.filteredData,l]),v=()=>m(this,null,function*(){try{s(),yield a("treatments"),yield i(),yield c(),rc.success("تم تحديث تقارير العلاجات بنجاح")}catch(e){console.error("Error refreshing treatment reports:",e),rc.error("فشل في تحديث تقارير العلاجات")}});return t?p.jsx("div",{className:"flex items-center justify-center h-64",dir:"rtl",children:p.jsxs("div",{className:"text-center",children:[p.jsx(mi,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),p.jsx("p",{children:"جاري تحميل تقارير العلاجات..."})]})}):e?p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[p.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"تقارير العلاجات"}),p.jsx(Xh,{isActive:!0})]}),p.jsx("p",{className:"text-muted-foreground",children:"تحليل شامل لجميع العلاجات والإجراءات الطبية"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{onClick:v,disabled:t,variant:"outline",size:"sm",className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(mi,{className:"w-4 h-4 ml-2 "+(t?"animate-spin":"")}),"تحديث"]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){try{const e=g.filteredData.length>0?g.filteredData:r;if(0===e.length)return void rc.noDataToExport("لا توجد بيانات علاجات للتصدير");const t={};l.forEach(e=>{t[e.id]=e.full_name||`${e.first_name||""} ${e.last_name||""}`.trim()});const n=e.map(e=>d(o({},e),{patient_name:t[e.patient_id]||`مريض ${e.patient_id}`}));yield ic.exportTreatmentsToCSV(n),rc.exportSuccess(`تم تصدير تقرير العلاجات بنجاح! (${e.length} علاج)`)}catch(e){console.error("Error exporting CSV:",e),rc.exportError("فشل في تصدير تقرير العلاجات")}}),disabled:n,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير اكسل"]}),p.jsxs(Qi,{variant:"default",size:"sm",onClick:()=>m(this,null,function*(){try{const e=g.filteredData.length>0?g.filteredData:r;if(0===e.length)return void rc.noDataToExport("لا توجد بيانات علاجات للتصدير");const t={};l.forEach(e=>{t[e.id]=e.full_name||`${e.first_name||""} ${e.last_name||""}`.trim()});e.map(e=>d(o({},e),{patient_name:t[e.patient_id]||`مريض ${e.patient_id}`}));const n=d(o({},f),{filterInfo:g.timeFilter.startDate&&g.timeFilter.endDate?`البيانات من ${g.timeFilter.startDate} إلى ${g.timeFilter.endDate}`:"جميع البيانات",dataCount:e.length});yield Mh.exportTreatmentReport(n,h),rc.exportSuccess(`تم تصدير تقرير العلاجات كملف PDF بنجاح (${e.length} علاج)`)}catch(e){console.error("Error exporting PDF:",e),rc.exportError("فشل في تصدير تقرير العلاجات كملف PDF")}}),disabled:n,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير PDF"]})]})]}),p.jsx(zd,{value:g.timeFilter,onChange:g.handleFilterChange,onClear:g.resetFilter,title:"فلترة العلاجات حسب التاريخ",defaultOpen:!1}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[p.jsx(tx,{title:"إجمالي العلاجات",value:f.totalTreatments,icon:nr,color:"blue",description:"العدد الكلي للعلاجات",trend:g.trend}),p.jsx(tx,{title:"العلاجات المكتملة",value:f.completedTreatments,icon:gr,color:"green",description:`معدل الإنجاز: ${f.completionRate}%`}),p.jsx(tx,{title:"إجمالي الإيرادات",value:p.jsx(Nh,{amount:f.totalRevenue,currency:u}),icon:Er,color:"green",description:`متوسط التكلفة: ${ca(f.averageTreatmentCost,u)}`}),p.jsx(tx,{title:"العلاجات المعلقة",value:f.pendingTreatments.length,icon:Sr,color:"yellow",description:`متأخرة: ${f.overdueTreatments.length}`})]}),p.jsxs(iu,{defaultValue:"overview",className:"space-y-6",children:[p.jsxs(lu,{className:"grid w-full grid-cols-4",children:[p.jsx(ou,{value:"overview",children:"نظرة عامة"}),p.jsx(ou,{value:"analysis",children:"التحليل"}),p.jsx(ou,{value:"performance",children:"الأداء"}),p.jsx(ou,{value:"details",children:"التفاصيل"})]}),p.jsx(du,{value:"overview",className:"space-y-6",children:p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(ii,{className:"h-5 w-5"}),"توزيع حالات العلاج"]})}),p.jsx(Yo,{children:0===f.treatmentsByStatus.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ii,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات علاجات متاحة"})]})}):p.jsx(ke,{width:"100%",height:300,children:p.jsxs(Se,{children:[p.jsx(De,{data:f.treatmentsByStatus,cx:"50%",cy:"50%",labelLine:!1,label:({status:e,percentage:t})=>`${e}: ${t}%`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:f.treatmentsByStatus.map((e,t)=>p.jsx($e,{fill:ex[t%ex.length]},`cell-${t}`))}),p.jsx(Ce,{formatter:(e,t)=>[e,t],labelFormatter:e=>`الحالة: ${e}`})]})})})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(dr,{className:"h-5 w-5"}),"العلاجات حسب الفئة"]})}),p.jsx(Yo,{children:0===f.treatmentsByCategory.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(dr,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات فئات علاجات متاحة"})]})}):p.jsx(ke,{width:"100%",height:300,children:p.jsxs(Ee,{data:f.treatmentsByCategory,children:[p.jsx(Te,{strokeDasharray:"3 3"}),p.jsx(Ae,{dataKey:"category",tick:{fontSize:12},interval:0,angle:-45,textAnchor:"end",height:80}),p.jsx(Fe,{}),p.jsx(Ce,{formatter:(e,t)=>[e,"عدد العلاجات"],labelFormatter:e=>`الفئة: ${e}`}),p.jsx(Pe,{dataKey:"count",fill:"#3b82f6",radius:[4,4,0,0]})]})})})]})]})}),p.jsx(du,{value:"analysis",className:"space-y-6",children:p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsx(zo,{children:"الإيرادات حسب الفئة"})}),p.jsx(Yo,{children:p.jsx("div",{className:"space-y-4",children:f.revenueByCategory&&0!==f.revenueByCategory.length?f.revenueByCategory.map((e,t)=>p.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/30 rounded-lg",children:[p.jsx("span",{className:"font-medium text-right",children:e.category}),p.jsxs("div",{className:"text-left",children:[p.jsx("div",{className:"font-bold",children:p.jsx(Nh,{amount:e.revenue,currency:u})}),p.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.count," علاج"]})]})]},t)):p.jsx("div",{className:"flex items-center justify-center h-40 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(Er,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),p.jsx("p",{className:"text-sm",children:"لا توجد بيانات إيرادات متاحة"})]})})})})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsx(zo,{children:"أشهر العلاجات"})}),p.jsx(Yo,{children:p.jsx("div",{className:"space-y-4",children:e.mostPopularTreatments.slice(0,5).map((e,t)=>p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"font-medium",children:e.name}),p.jsxs("div",{className:"text-left",children:[p.jsxs("div",{className:"font-bold",children:[e.count," مرة"]}),p.jsx("div",{className:"text-sm text-muted-foreground",children:p.jsx(Nh,{amount:e.revenue,currency:u})})]})]},t))})})]})]})}),p.jsx(du,{value:"performance",className:"space-y-6",children:p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsx(zo,{children:"اتجاه العلاجات الشهري"})}),p.jsx(Yo,{children:e.treatmentTrend&&0!==e.treatmentTrend.length?p.jsx(ke,{width:"100%",height:300,children:p.jsxs(Me,{data:e.treatmentTrend,children:[p.jsx(Te,{strokeDasharray:"3 3"}),p.jsx(Ae,{dataKey:"period"}),p.jsx(Fe,{}),p.jsx(Ce,{formatter:(e,t)=>[e,t],labelFormatter:e=>`الفترة: ${e}`}),p.jsx(Le,{type:"monotone",dataKey:"completed",stroke:"#10b981",name:"مكتمل",strokeWidth:2,dot:{fill:"#10b981",strokeWidth:2,r:4}}),p.jsx(Le,{type:"monotone",dataKey:"planned",stroke:"#3b82f6",name:"مخطط",strokeWidth:2,dot:{fill:"#3b82f6",strokeWidth:2,r:4}})]})}):p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ki,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات اتجاه العلاجات متاحة"})]})})})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsx(zo,{children:"مؤشرات الأداء"})}),p.jsx(Yo,{children:p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{children:"معدل الإنجاز"}),p.jsxs(qo,{variant:"secondary",children:[e.completionRate,"%"]})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{children:"متوسط وقت الإنجاز"}),p.jsxs(qo,{variant:"secondary",children:[Math.round(e.averageCompletionTime)," يوم"]})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{children:"المرضى بعلاجات متعددة"}),p.jsx(qo,{variant:"secondary",children:e.patientsWithMultipleTreatments})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{children:"متوسط العلاجات لكل مريض"}),p.jsx(qo,{variant:"secondary",children:e.averageTreatmentsPerPatient.toFixed(1)})]})]})})]})]})}),p.jsx(du,{value:"details",className:"space-y-6",children:p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(Sr,{className:"h-5 w-5"}),"العلاجات المعلقة (",f.pendingTreatments.length,")"]})}),p.jsx(Yo,{children:p.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===f.pendingTreatments.length?p.jsx("div",{className:"flex items-center justify-center h-40 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(Sr,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),p.jsx("p",{className:"text-sm",children:"لا توجد علاجات معلقة"})]})}):p.jsxs(Qd,{children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-right",children:"نوع العلاج"}),p.jsx(tc,{className:"text-right",children:"اسم المريض"}),p.jsx(tc,{className:"text-right",children:"الحالة"}),p.jsx(tc,{className:"text-right",children:"التاريخ"}),p.jsx(tc,{className:"text-right",children:"التكلفة"})]})}),p.jsx(Jd,{children:f.pendingTreatments.slice(0,10).map(e=>p.jsxs(ec,{children:[p.jsx(nc,{className:"text-right",children:ud(e.treatment_type)}),p.jsx(nc,{className:"text-right",children:e.patient_name||`مريض ${e.patient_id}`}),p.jsx(nc,{className:"text-right",children:p.jsx(qo,{variant:"planned"===e.status?"secondary":"default",children:pd(e.status||"غير محدد")})}),p.jsx(nc,{className:"text-right",children:e.created_at?ma(e.created_at):"غير محدد"}),p.jsx(nc,{className:"text-right",children:p.jsx(Nh,{amount:e.cost||0,currency:u})})]},e.id))})]})})})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(ar,{className:"h-5 w-5 text-red-500"}),"العلاجات المتأخرة (",f.overdueTreatments.length,")"]})}),p.jsx(Yo,{children:p.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===f.overdueTreatments.length?p.jsx("div",{className:"flex items-center justify-center h-40 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(gr,{className:"w-8 h-8 mx-auto mb-2 opacity-50 text-green-500"}),p.jsx("p",{className:"text-sm",children:"لا توجد علاجات متأخرة"})]})}):p.jsxs(Qd,{children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-right",children:"نوع العلاج"}),p.jsx(tc,{className:"text-right",children:"اسم المريض"}),p.jsx(tc,{className:"text-right",children:"تاريخ الإنشاء"}),p.jsx(tc,{className:"text-right",children:"الأيام المتأخرة"}),p.jsx(tc,{className:"text-right",children:"التكلفة"})]})}),p.jsx(Jd,{children:f.overdueTreatments.slice(0,10).map(e=>{const t=e.created_at?Math.ceil(((new Date).getTime()-new Date(e.created_at).getTime())/864e5):0;return p.jsxs(ec,{children:[p.jsx(nc,{className:"text-right",children:ud(e.treatment_type)}),p.jsx(nc,{className:"text-right",children:e.patient_name||`مريض ${e.patient_id}`}),p.jsx(nc,{className:"text-right",children:e.created_at?ma(e.created_at):"غير محدد"}),p.jsx(nc,{className:"text-right",children:p.jsxs(qo,{variant:"destructive",children:[t," يوم"]})}),p.jsx(nc,{className:"text-right",children:p.jsx(Nh,{amount:e.cost||0,currency:u})})]},e.id)})})]})})})]})]})})]})]}):p.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[p.jsx(yi,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),p.jsx("p",{className:"text-muted-foreground",children:"لا توجد بيانات علاجات متاحة"}),p.jsxs(Qi,{onClick:v,className:"mt-4",children:[p.jsx(mi,{className:"h-4 w-4 ml-2"}),"تحديث"]})]})}const ax={pending:"#f59e0b",ordered:"#3b82f6",received:"#10b981",cancelled:"#ef4444",urgent:"#dc2626",high:"#f59e0b",medium:"#3b82f6",low:"#10b981"},sx={pending:"معلق",ordered:"مطلوب",received:"مستلم",cancelled:"ملغي"},rx={urgent:"عاجل",high:"عالي",medium:"متوسط",low:"منخفض"};function ix(){const{clinicNeedsReports:e,isLoading:t,isExporting:n,generateReport:a,clearCache:s}=Sh(),{needs:r,loadNeeds:i}=Eh(),{currency:l,settings:c}=qt(),{isDarkMode:u}=Gt(),h=Bd({data:r,dateField:"created_at",initialFilter:{preset:"all",startDate:"",endDate:""}});Fh("clinicNeeds"),ve.useEffect(()=>{a("clinicNeeds"),i()},[a,i]);const x=ve.useMemo(()=>{const e=h.filteredData;if(!e||0===e.length)return{totalNeeds:0,totalValue:0,pendingCount:0,orderedCount:0,receivedCount:0,cancelledCount:0,urgentCount:0,completionRate:0,urgencyRate:0,averageNeedValue:0,needsByStatus:[],needsByPriority:[],needsByCategory:[],topExpensiveNeeds:[]};const t=e.length,n=e.reduce((e,t)=>e+t.price*t.quantity,0),a=t>0?n/t:0,s=e.filter(e=>"pending"===e.status).length,r=e.filter(e=>"ordered"===e.status).length,i=e.filter(e=>"received"===e.status).length,l=e.filter(e=>"cancelled"===e.status).length,o=e.filter(e=>"urgent"===e.priority).length,d=t>0?i/t*100:0,c=t>0?o/t*100:0,u=[{name:sx.pending,value:s,color:ax.pending},{name:sx.ordered,value:r,color:ax.ordered},{name:sx.received,value:i,color:ax.received},{name:sx.cancelled,value:l,color:ax.cancelled}].filter(e=>e.value>0),m={urgent:e.filter(e=>"urgent"===e.priority).length,high:e.filter(e=>"high"===e.priority).length,medium:e.filter(e=>"medium"===e.priority).length,low:e.filter(e=>"low"===e.priority).length},p=[{name:rx.urgent,value:m.urgent,color:ax.urgent},{name:rx.high,value:m.high,color:ax.high},{name:rx.medium,value:m.medium,color:ax.medium},{name:rx.low,value:m.low,color:ax.low}].filter(e=>e.value>0),x=new Map;e.forEach(e=>{const t=e.category||"غير محدد",n=x.get(t)||{count:0,value:0};x.set(t,{count:n.count+1,value:n.value+e.price*e.quantity})});return{totalNeeds:t,totalValue:n,pendingCount:s,orderedCount:r,receivedCount:i,cancelledCount:l,urgentCount:o,completionRate:d,urgencyRate:c,averageNeedValue:a,needsByStatus:u,needsByPriority:p,needsByCategory:Array.from(x.entries()).map(([e,t])=>({category:e,count:t.count,value:t.value})).sort((e,t)=>t.value-e.value),topExpensiveNeeds:e.map(e=>({need_name:e.need_name,value:e.price*e.quantity,quantity:e.quantity,price:e.price})).sort((e,t)=>t.value-e.value).slice(0,10)}},[h.filteredData]);if(t)return p.jsx("div",{className:"flex items-center justify-center h-96",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),p.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل تقرير احتياجات العيادة..."})]})});const g=x;return p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[p.jsx(kr,{className:"w-6 h-6 text-primary"}),"تقرير احتياجات العيادة"]}),p.jsx("p",{className:"text-muted-foreground mt-1",children:"تحليل شامل لاحتياجات ومتطلبات العيادة"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){s(),yield a("clinicNeeds"),yield i(),sc.success("تم تحديث التقرير")}),disabled:t,className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(mi,{className:"w-4 h-4 "+(t?"animate-spin":"")}),p.jsx("span",{children:"تحديث"})]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){try{const e=h.filteredData;if(!e||0===e.length)return void sc.error("لا توجد بيانات للتصدير");const t=`clinic-needs-report${"all"!==h.filter.preset?`_${h.filter.preset}_${h.filter.startDate||""}_${h.filter.endDate||""}`:""}`;yield ic.exportClinicNeedsToCSV(e,t),sc.success(`تم تصدير ${e.length} احتياج بنجاح`)}catch(e){console.error("Error exporting CSV:",e),sc.error("فشل في تصدير البيانات")}}),disabled:n,className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(Tr,{className:"w-4 h-4"}),p.jsx("span",{children:"CSV"})]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){try{if(!h.filteredData||0===h.filteredData.length)return void sc.error("لا توجد بيانات للتصدير");const e=d(o({},g),{needsList:h.filteredData,filterInfo:"all"!==h.filter.preset?`الفترة: ${h.filter.preset} (${h.filter.startDate||""} - ${h.filter.endDate||""})`:"جميع البيانات",dataCount:h.filteredData.length});yield Mh.exportClinicNeedsReport(e,{title:"تقرير احتياجات العيادة",currency:l,isDarkMode:u}),sc.success("تم تصدير التقرير بنجاح")}catch(e){console.error("Error exporting PDF:",e),sc.error("فشل في تصدير التقرير")}}),disabled:n,className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(Tr,{className:"w-4 h-4"}),p.jsx("span",{children:"PDF"})]})]})]}),p.jsx(zd,{value:h.filter,onChange:h.setFilter,className:"w-full"}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[p.jsxs(Lo,{className:vd("blue"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"إجمالي الاحتياجات"}),p.jsx(kr,{className:`h-4 w-4 ${yd("blue")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:g.totalNeeds}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"احتياج مسجل في النظام"})]})]}),p.jsxs(Lo,{className:vd("green"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"القيمة الإجمالية"}),p.jsx(Er,{className:`h-4 w-4 ${yd("green")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:p.jsx(Nh,{amount:g.totalValue,currency:l})}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"قيمة جميع الاحتياجات"})]})]}),p.jsxs(Lo,{className:vd("orange"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"الاحتياجات المعلقة"}),p.jsx(Sr,{className:`h-4 w-4 ${yd("orange")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:g.pendingCount}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"في انتظار الطلب"})]})]}),p.jsxs(Lo,{className:vd("red"),dir:"rtl",children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"الاحتياجات العاجلة"}),p.jsx(sr,{className:`h-4 w-4 ${yd("red")}`})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:g.urgentCount}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"تحتاج اهتمام فوري"})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ii,{className:"w-5 h-5"}),p.jsx("span",{children:"توزيع الاحتياجات حسب الحالة"})]}),p.jsxs(Bo,{children:["توزيع الاحتياجات حسب حالة الطلب (",g.totalNeeds," احتياج إجمالي)"]})]}),p.jsx(Yo,{children:0===g.needsByStatus.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ii,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات احتياجات متاحة"})]})}):p.jsx(ke,{width:"100%",height:300,children:p.jsxs(Se,{children:[p.jsx(De,{data:g.needsByStatus,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t,percent:n})=>`${e}: ${t} (${(100*n).toFixed(1)}%)`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:g.needsByStatus.map((e,t)=>p.jsx($e,{fill:e.color},`cell-${t}`))}),p.jsx(Ce,{}),p.jsx(Ie,{})]})})})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(dr,{className:"w-5 h-5"}),p.jsx("span",{children:"توزيع الاحتياجات حسب الأولوية"})]}),p.jsx(Bo,{children:"توزيع الاحتياجات حسب مستوى الأولوية"})]}),p.jsx(Yo,{children:0===g.needsByPriority.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(dr,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات أولوية متاحة"})]})}):p.jsx(ke,{width:"100%",height:300,children:p.jsxs(Ee,{data:g.needsByPriority,children:[p.jsx(Te,{strokeDasharray:"3 3"}),p.jsx(Ae,{dataKey:"name"}),p.jsx(Fe,{}),p.jsx(Ce,{}),p.jsx(Pe,{dataKey:"value",fill:"#8884d8",children:g.needsByPriority.map((e,t)=>p.jsx($e,{fill:e.color},`cell-${t}`))})]})})})]})]}),p.jsxs(iu,{defaultValue:"categories",className:"w-full",dir:"rtl",children:[p.jsxs(lu,{className:"grid w-full grid-cols-4",children:[p.jsx(ou,{value:"categories",children:"الفئات"}),p.jsx(ou,{value:"expensive",children:"الأغلى سعراً"}),p.jsx(ou,{value:"pending",children:"المعلقة"}),p.jsx(ou,{value:"urgent",children:"العاجلة"})]}),p.jsx(du,{value:"categories",className:"space-y-4",children:p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(ti,{className:"h-5 w-5"}),"الاحتياجات حسب الفئة (",g.needsByCategory.length," فئة)"]})}),p.jsx(Yo,{children:p.jsx("div",{className:"max-h-96 overflow-y-auto",children:p.jsxs(Qd,{children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-right",children:"الفئة"}),p.jsx(tc,{className:"text-right",children:"العدد"}),p.jsx(tc,{className:"text-right",children:"القيمة الإجمالية"}),p.jsx(tc,{className:"text-right",children:"متوسط القيمة"})]})}),p.jsx(Jd,{children:g.needsByCategory.map((e,t)=>p.jsxs(ec,{children:[p.jsx(nc,{className:"font-medium text-right",children:e.category}),p.jsx(nc,{className:"text-right",children:e.count}),p.jsx(nc,{className:"text-right",children:p.jsx(Nh,{amount:e.value,currency:l})}),p.jsx(nc,{className:"text-right",children:p.jsx(Nh,{amount:e.value/e.count,currency:l})})]},t))})]})})})]})}),p.jsx(du,{value:"expensive",className:"space-y-4",children:p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(Er,{className:"h-5 w-5"}),"الاحتياجات الأغلى سعراً (أعلى 10)"]})}),p.jsx(Yo,{children:p.jsx("div",{className:"max-h-96 overflow-y-auto",children:p.jsxs(Qd,{children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-right",children:"اسم الاحتياج"}),p.jsx(tc,{className:"text-right",children:"الكمية"}),p.jsx(tc,{className:"text-right",children:"سعر الوحدة"}),p.jsx(tc,{className:"text-right",children:"القيمة الإجمالية"})]})}),p.jsx(Jd,{children:g.topExpensiveNeeds.map((e,t)=>p.jsxs(ec,{children:[p.jsx(nc,{className:"font-medium text-right",children:e.need_name}),p.jsx(nc,{className:"text-right",children:e.quantity}),p.jsx(nc,{className:"text-right",children:p.jsx(Nh,{amount:e.price,currency:l})}),p.jsx(nc,{className:"text-right",children:p.jsx(Nh,{amount:e.value,currency:l})})]},t))})]})})})]})}),p.jsx(du,{value:"pending",className:"space-y-4",children:p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(Sr,{className:"h-5 w-5"}),"الاحتياجات المعلقة (",g.pendingCount,")"]})}),p.jsx(Yo,{children:p.jsx("div",{className:"max-h-96 overflow-y-auto",children:p.jsxs(Qd,{children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-right",children:"اسم الاحتياج"}),p.jsx(tc,{className:"text-right",children:"الفئة"}),p.jsx(tc,{className:"text-right",children:"الأولوية"}),p.jsx(tc,{className:"text-right",children:"القيمة"}),p.jsx(tc,{className:"text-right",children:"تاريخ الإنشاء"})]})}),p.jsx(Jd,{children:h.filteredData.filter(e=>"pending"===e.status).slice(0,10).map(e=>p.jsxs(ec,{children:[p.jsx(nc,{className:"font-medium text-right",children:e.need_name}),p.jsx(nc,{className:"text-right",children:e.category||"غير محدد"}),p.jsx(nc,{className:"text-right",children:p.jsx(qo,{variant:"urgent"===e.priority?"destructive":"secondary",children:rx[e.priority]})}),p.jsx(nc,{className:"text-right",children:p.jsx(Nh,{amount:e.price*e.quantity,currency:l})}),p.jsx(nc,{className:"text-right",children:ma(e.created_at)})]},e.id))})]})})})]})}),p.jsx(du,{value:"urgent",className:"space-y-4",children:p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(sr,{className:"h-5 w-5"}),"الاحتياجات العاجلة (",g.urgentCount,")"]})}),p.jsx(Yo,{children:p.jsx("div",{className:"max-h-96 overflow-y-auto",children:p.jsxs(Qd,{children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-right",children:"اسم الاحتياج"}),p.jsx(tc,{className:"text-right",children:"الحالة"}),p.jsx(tc,{className:"text-right",children:"الفئة"}),p.jsx(tc,{className:"text-right",children:"القيمة"}),p.jsx(tc,{className:"text-right",children:"تاريخ الإنشاء"})]})}),p.jsx(Jd,{children:h.filteredData.filter(e=>"urgent"===e.priority).slice(0,10).map(e=>p.jsxs(ec,{children:[p.jsx(nc,{className:"font-medium text-right",children:e.need_name}),p.jsx(nc,{className:"text-right",children:p.jsx(qo,{variant:"received"===e.status?"default":"secondary",children:sx[e.status]})}),p.jsx(nc,{className:"text-right",children:e.category||"غير محدد"}),p.jsx(nc,{className:"text-right",children:p.jsx(Nh,{amount:e.price*e.quantity,currency:l})}),p.jsx(nc,{className:"text-right",children:ma(e.created_at)})]},e.id))})]})})})]})})]})]})}var lx="horizontal",ox=["horizontal","vertical"],dx=ve.forwardRef((e,t)=>{const n=e,{decorative:a,orientation:s=lx}=n,r=c(n,["decorative","orientation"]),i=function(e){return ox.includes(e)}(s)?s:lx,l=a?{role:"none"}:{"aria-orientation":"vertical"===i?i:void 0,role:"separator"};return p.jsx(q.div,d(o(o({"data-orientation":i},l),r),{ref:t}))});dx.displayName="Separator";var cx=dx;const ux=ve.forwardRef((e,t)=>{var n=e,{className:a,orientation:s="horizontal",decorative:r=!0}=n,i=c(n,["className","orientation","decorative"]);return p.jsx(cx,o({ref:t,decorative:r,orientation:s,className:aa("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",a)},i))});ux.displayName=cx.displayName;class mx{static validateAmount(e){const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100}static filterByDateRange(e,t,n){const a=t.start||t.startDate,s=t.end||t.endDate;if(!a&&!s)return e;return e.filter(e=>{const t=e[n];if(!t)return!1;const r=new Date(t);let i,l=null,o=null;a&&(l=new Date(a),l=new Date(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0,0)),s&&(o=new Date(s),o=new Date(o.getFullYear(),o.getMonth(),o.getDate(),23,59,59,999)),i=t.includes("T")||t.includes(" ")?r:new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0);return(!l||i>=l)&&(!o||i<=o)})}static calculateRevenueStats(e){const t=this.validateAmount(e.filter(e=>"completed"===e.status).reduce((e,t)=>e+this.validateAmount(t.amount),0)),n=this.validateAmount(e.filter(e=>"partial"===e.status).reduce((e,t)=>e+this.validateAmount(t.amount),0));return{completedPayments:t,totalRevenue:t+n,partialPayments:n,remainingBalances:this.validateAmount(e.filter(e=>"partial"===e.status).reduce((e,t)=>{const n=this.validateAmount(t.total_amount_due||t.treatment_total_cost||t.appointment_total_cost||0),a=this.validateAmount(t.amount_paid||t.treatment_total_paid||t.appointment_total_paid||t.amount||0),s=Math.max(0,n-a);return 0===n?e+this.validateAmount(t.remaining_balance||t.treatment_remaining_balance||t.appointment_remaining_balance||0):e+s},0)),pendingAmount:this.validateAmount(e.filter(e=>"pending"===e.status).reduce((e,t)=>{const n=this.validateAmount(t.amount),a=this.validateAmount(t.total_amount_due);let s=n;if(t.tooth_treatment_id){s=this.validateAmount(t.treatment_total_cost)||a}else 0===n&&a>0?s=a:t.remaining_balance&&t.remaining_balance>0&&(s=this.validateAmount(t.remaining_balance));return e+s},0))}}static calculateExpenseStats(e,t,n,a){return{labOrdersTotal:this.validateAmount(e.reduce((e,t)=>e+this.validateAmount(t.paid_amount||0),0)),labOrdersRemaining:this.validateAmount(e.reduce((e,t)=>e+this.validateAmount(t.remaining_balance||0),0)),clinicNeedsTotal:this.validateAmount(t.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+this.validateAmount(t.quantity)*this.validateAmount(t.price),0)),clinicNeedsRemaining:this.validateAmount(t.filter(e=>"pending"===e.status||"ordered"===e.status).reduce((e,t)=>e+this.validateAmount(t.quantity)*this.validateAmount(t.price),0)),inventoryExpenses:this.validateAmount(n.reduce((e,t)=>e+this.validateAmount(t.cost_per_unit||0)*this.validateAmount(t.quantity||0),0)),clinicExpensesTotal:a?this.validateAmount(a.filter(e=>"paid"===e.status).reduce((e,t)=>e+this.validateAmount(t.amount),0)):0}}static calculateProfitLoss(e,t){const n=e-t,a=n>=0,s=a?0:Math.abs(n),r=e>0?n/e*100:0;return{totalIncome:e,totalExpenses:t,netProfit:a?n:0,profitMargin:this.validateAmount(r),lossAmount:s,isProfit:a}}static generateComprehensiveProfitLossReport(e,t,n,a,s,r,i,l){const o=(null==i?void 0:i.dateRange)?this.filterByDateRange(e,i.dateRange,"payment_date"):e,d=(null==i?void 0:i.dateRange)?this.filterByDateRange(t,i.dateRange,"order_date"):t,c=(null==i?void 0:i.dateRange)?this.filterByDateRange(n,i.dateRange,"created_at"):n,u=(null==i?void 0:i.dateRange)?this.filterByDateRange(r,i.dateRange,"created_at"):r,m=(null==i?void 0:i.dateRange)?this.filterByDateRange(a,i.dateRange,"created_at"):a,p=(null==i?void 0:i.dateRange)&&l?this.filterByDateRange(l,i.dateRange,"payment_date"):l,h=this.calculateRevenueStats(o),x=this.calculateExpenseStats(d,c,m,p),g=h.totalRevenue,f=x.labOrdersTotal+x.clinicNeedsTotal+x.inventoryExpenses+x.clinicExpensesTotal;return{revenue:h,expenses:x,calculations:this.calculateProfitLoss(g,f),details:{totalPatients:s.length,totalAppointments:u.length,totalLabOrders:d.length,totalClinicNeeds:c.length,totalInventoryItems:m.length,totalExpenses:p?p.length:0,averageRevenuePerPatient:s.length>0?g/s.length:0,averageRevenuePerAppointment:u.length>0?g/u.length:0},filterInfo:{dateRange:(null==i?void 0:i.dateRange)?`${i.dateRange.start||i.dateRange.startDate||"البداية"} - ${i.dateRange.end||i.dateRange.endDate||"النهاية"}`:"جميع البيانات",totalRecords:e.length+t.length+n.length+r.length+a.length+(l?l.length:0),filteredRecords:o.length+d.length+c.length+u.length+m.length+(p?p.length:0)}}}}function px(){const{payments:e}=Go(),{expenses:t}=Ch(),{labOrders:n}=Th(),{needs:a}=Eh(),{items:s}=jd(),{patients:r}=cl(),{appointments:i}=Wo(),{currency:l,settings:o}=qt(),{isDarkMode:d}=Gt(),[c,u]=ve.useState(null),[h,x]=ve.useState("this_month"),[g,f]=ve.useState(""),[v,y]=ve.useState(""),[b,j]=ve.useState(!1),[w,N]=ve.useState(!1),_=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,k=(e,t,n)=>{const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(e){case"all":default:return null;case"today":return{start:_(s),end:_(s)};case"yesterday":const e=new Date(s);return e.setDate(e.getDate()-1),{start:_(e),end:_(e)};case"this_week":const a=new Date(s);return a.setDate(s.getDate()-s.getDay()),{start:_(a),end:_(s)};case"last_week":const r=new Date(s);r.setDate(s.getDate()-s.getDay()-1);const i=new Date(r);return i.setDate(r.getDate()-6),{start:_(i),end:_(r)};case"this_month":const l=new Date(s.getFullYear(),s.getMonth(),1);return{start:_(l),end:_(s)};case"last_month":const o=new Date(s.getFullYear(),s.getMonth()-1,1),d=new Date(s.getFullYear(),s.getMonth(),0);return{start:_(o),end:_(d)};case"this_quarter":const c=new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3),1);return{start:_(c),end:_(s)};case"last_quarter":const u=new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3)-3,1),m=new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3),0);return{start:_(u),end:_(m)};case"this_year":const p=new Date(s.getFullYear(),0,1);return{start:_(p),end:_(s)};case"last_year":const h=new Date(s.getFullYear()-1,0,1),x=new Date(s.getFullYear()-1,11,31);return{start:_(h),end:_(x)};case"last_30_days":const g=new Date(s);return g.setDate(s.getDate()-30),{start:_(g),end:_(s)};case"last_90_days":const f=new Date(s);return f.setDate(s.getDate()-90),{start:_(f),end:_(s)};case"custom":return t&&n?{start:t,end:n}:null}},S=()=>m(this,null,function*(){j(!0);try{const l=k(h,g,v),o=mx.generateComprehensiveProfitLossReport(e,n,a,s,r,i,l?{dateRange:l}:void 0,t);u(o)}catch(l){console.error("Error generating comprehensive profit/loss report:",l)}finally{j(!1)}});if(ve.useEffect(()=>{S()},[h,g,v,e,t,n,a,s,r,i]),b||!c)return p.jsx("div",{className:"flex items-center justify-center h-96",children:p.jsxs("div",{className:"text-center",children:[p.jsx(mr,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{className:"text-muted-foreground",children:"جاري حساب التقرير الشامل..."})]})});const{revenue:D,expenses:$,calculations:C,details:E,filterInfo:T}=c;return p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-3",children:[p.jsx(mr,{className:"w-6 h-6"}),"التقرير الشامل للأرباح والخسائر"]}),p.jsxs("p",{className:"text-muted-foreground mt-1",children:["تحليل مالي شامل يربط جميع جوانب العيادة - ",T.dateRange]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){if(c){N(!0);try{yield Mh.exportProfitLossReport({reportData:c,payments:e,labOrders:n,clinicNeeds:a,inventoryItems:s,clinicExpenses:t,patients:r,appointments:i,filter:k(h,g,v),currency:l},o),rc.success("تم تصدير تقرير الأرباح والخسائر إلى PDF بنجاح")}catch(d){console.error("Error exporting to PDF:",d),rc.error("فشل في تصدير التقرير إلى PDF")}finally{N(!1)}}else rc.error("لا توجد بيانات للتصدير")}),disabled:w||!c,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),w?"جاري التصدير...":"تصدير PDF"]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){if(c){N(!0);try{yield ic.exportProfitLossToExcel({reportData:c,payments:e,labOrders:n,clinicNeeds:a,inventoryItems:s,clinicExpenses:t,patients:r,appointments:i,filter:k(h,g,v),currency:l}),rc.success("تم تصدير تقرير الأرباح والخسائر إلى Excel بنجاح")}catch(o){console.error("Error exporting to Excel:",o),rc.error("فشل في تصدير التقرير إلى Excel")}finally{N(!1)}}else rc.error("لا توجد بيانات للتصدير")}),disabled:w||!c,children:[p.jsx(Pr,{className:"w-4 h-4 ml-2"}),w?"جاري التصدير...":"تصدير اكسل"]})]})]}),p.jsxs(Lo,{className:vd("blue"),children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center gap-3",children:[p.jsx(Or,{className:`w-5 h-5 ${yd("blue")}`}),"فلترة التقرير"]}),p.jsx(Bo,{children:"اختر الفترة الزمنية للتقرير الشامل للأرباح والخسائر"})]}),p.jsx(Yo,{className:"space-y-4",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"period",children:"الفترة الزمنية"}),p.jsxs(el,{value:h,onValueChange:e=>x(e),children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر الفترة الزمنية"})}),p.jsx(il,{children:Object.entries(Hh).map(([e,t])=>p.jsx(dl,{value:e,children:t},e))})]})]}),"custom"===h&&p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"startDate",children:"تاريخ البداية"}),p.jsx(Xi,{id:"startDate",type:"date",value:g,onChange:e=>f(e.target.value)})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"endDate",children:"تاريخ النهاية"}),p.jsx(Xi,{id:"endDate",type:"date",value:v,onChange:e=>y(e.target.value)})]})]})]})})]}),p.jsxs(Lo,{className:C.isProfit?vd("green"):vd("red"),children:[p.jsx(Io,{children:p.jsx(zo,{className:"flex items-center gap-3 text-xl",children:C.isProfit?p.jsxs(p.Fragment,{children:[p.jsx(ki,{className:`w-6 h-6 ${yd("green")}`}),p.jsx("span",{children:"ربح"}),p.jsxs(qo,{variant:"secondary",className:"bg-green-100 text-green-800",children:[C.profitMargin.toFixed(1),"%"]})]}):p.jsxs(p.Fragment,{children:[p.jsx(_i,{className:`w-6 h-6 ${yd("red")}`}),p.jsx("span",{children:"خسارة"}),p.jsx(qo,{variant:"destructive",children:"خسارة"})]})})}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-3xl font-bold",children:C.isProfit?p.jsx(Nh,{amount:C.netProfit,currency:l}):p.jsx(Nh,{amount:C.lossAmount,currency:l})}),p.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:C.isProfit?`صافي الربح بنسبة ${C.profitMargin.toFixed(1)}%`:"إجمالي الخسارة من العمليات"})]})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[p.jsxs(Lo,{className:vd("blue"),children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-3",children:[p.jsx(ki,{className:`w-5 h-5 ${yd("blue")}`}),"إجمالي الإيرادات"]})}),p.jsxs(Yo,{className:"space-y-4",children:[p.jsx("div",{className:"text-2xl font-bold",children:p.jsx(Nh,{amount:D.totalRevenue,currency:l})}),p.jsx(ux,{}),p.jsxs("div",{className:"space-y-3",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"المدفوعات المكتملة"}),p.jsx(Nh,{amount:D.completedPayments,currency:l})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"المدفوعات الجزئية"}),p.jsx(Nh,{amount:D.partialPayments,currency:l})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"المبالغ المتبقية"}),p.jsx(Nh,{amount:D.remainingBalances,currency:l})]})]})]})]}),p.jsxs(Lo,{className:vd("red"),children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-3",children:[p.jsx(_i,{className:`w-5 h-5 ${yd("red")}`}),"إجمالي المصروفات"]})}),p.jsxs(Yo,{className:"space-y-4",children:[p.jsx("div",{className:"text-2xl font-bold",children:p.jsx(Nh,{amount:C.totalExpenses,currency:l})}),p.jsx(ux,{}),p.jsxs("div",{className:"space-y-3",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"مدفوعات المخابر"}),p.jsx(Nh,{amount:$.labOrdersTotal,currency:l})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"متبقي المخابر"}),p.jsx(Nh,{amount:$.labOrdersRemaining,currency:l})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"احتياجات العيادة"}),p.jsx(Nh,{amount:$.clinicNeedsTotal,currency:l})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"متبقي الاحتياجات"}),p.jsx(Nh,{amount:$.clinicNeedsRemaining,currency:l})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"قيمة المخزون"}),p.jsx(Nh,{amount:$.inventoryExpenses,currency:l})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"مصروفات العيادة المباشرة"}),p.jsx(Nh,{amount:$.clinicExpensesTotal||0,currency:l})]})]})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[p.jsx(Lo,{className:vd("purple"),children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(Fi,{className:`w-8 h-8 ${yd("purple")}`}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المرضى"}),p.jsx("p",{className:"text-xl font-bold",children:E.totalPatients})]})]})})}),p.jsx(Lo,{className:vd("orange"),children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(hr,{className:`w-8 h-8 ${yd("orange")}`}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"المواعيد"}),p.jsx("p",{className:"text-xl font-bold",children:E.totalAppointments})]})]})})}),p.jsx(Lo,{className:vd("cyan"),children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(ur,{className:`w-8 h-8 ${yd("cyan")}`}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"طلبات المخابر"}),p.jsx("p",{className:"text-xl font-bold",children:E.totalLabOrders})]})]})})}),p.jsx(Lo,{className:vd("indigo"),children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(ti,{className:`w-8 h-8 ${yd("indigo")}`}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"احتياجات العيادة"}),p.jsx("p",{className:"text-xl font-bold",children:E.totalClinicNeeds})]})]})})})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsx(zo,{className:"text-lg",children:"متوسط الإيرادات لكل مريض"})}),p.jsx(Yo,{children:p.jsx("div",{className:"text-2xl font-bold",children:p.jsx(Nh,{amount:E.averageRevenuePerPatient,currency:l})})})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsx(zo,{className:"text-lg",children:"متوسط الإيرادات لكل موعد"})}),p.jsx(Yo,{children:p.jsx("div",{className:"text-2xl font-bold",children:p.jsx(Nh,{amount:E.averageRevenuePerAppointment,currency:l})})})]})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsx(zo,{className:"text-lg",children:"معلومات التقرير"})}),p.jsx(Yo,{children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground",children:"الفترة المحددة: "}),p.jsx("span",{className:"font-medium",children:Hh[h]})]}),p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground",children:"نطاق التواريخ: "}),p.jsx("span",{className:"font-medium",children:T.dateRange})]}),p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground",children:"إجمالي السجلات: "}),p.jsx("span",{className:"font-medium",children:T.totalRecords})]}),p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground",children:"السجلات المفلترة: "}),p.jsx("span",{className:"font-medium",children:T.filteredRecords})]})]})})]}),function(){if(!c)return null;const{revenue:t,expenses:n,calculations:a}=c,s={primary:d?"#3b82f6":"#2563eb",secondary:d?"#10b981":"#059669",warning:d?"#f59e0b":"#d97706",danger:d?"#ef4444":"#dc2626",purple:d?"#8b5cf6":"#7c3aed",teal:d?"#14b8a6":"#0d9488"},r=[{name:"مدفوعات مكتملة",value:t.completedPayments,color:s.secondary,percentage:t.totalRevenue>0?(t.completedPayments/t.totalRevenue*100).toFixed(1):"0"},{name:"مدفوعات جزئية",value:t.partialPayments,color:s.warning,percentage:t.totalRevenue>0?(t.partialPayments/t.totalRevenue*100).toFixed(1):"0"},{name:"مبالغ معلقة",value:t.pendingAmount||0,color:s.danger,percentage:t.totalRevenue>0?((t.pendingAmount||0)/t.totalRevenue*100).toFixed(1):"0"},{name:"مبالغ متبقية",value:t.remainingBalances,color:s.purple,percentage:t.totalRevenue>0?(t.remainingBalances/t.totalRevenue*100).toFixed(1):"0"}].filter(e=>e.value>0),i=[{name:"طلبات المخابر",value:n.labOrdersTotal,color:s.primary,percentage:a.totalExpenses>0?(n.labOrdersTotal/a.totalExpenses*100).toFixed(1):"0"},{name:"احتياجات العيادة",value:n.clinicNeedsTotal,color:s.secondary,percentage:a.totalExpenses>0?(n.clinicNeedsTotal/a.totalExpenses*100).toFixed(1):"0"},{name:"تكلفة المخزون",value:n.inventoryExpenses,color:s.warning,percentage:a.totalExpenses>0?(n.inventoryExpenses/a.totalExpenses*100).toFixed(1):"0"},{name:"مصروفات مباشرة",value:n.clinicExpensesTotal||0,color:s.danger,percentage:a.totalExpenses>0?((n.clinicExpensesTotal||0)/a.totalExpenses*100).toFixed(1):"0"}].filter(e=>e.value>0),o=[{name:"الإيرادات",value:t.totalRevenue,type:"revenue"},{name:"المصروفات",value:a.totalExpenses,type:"expenses"},{name:"صافي الربح",value:a.isProfit?a.netProfit:-a.lossAmount,type:"profit"}],u={tooltip:{backgroundColor:d?"#1f2937":"#ffffff",border:"1px solid "+(d?"#374151":"#e5e7eb"),borderRadius:"8px",color:d?"#f9fafb":"#111827"},grid:{strokeDasharray:"3 3",stroke:d?"#374151":"#e5e7eb",strokeOpacity:.5}};return p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ii,{className:"w-5 h-5"}),p.jsx("span",{children:"توزيع الإيرادات"})]}),p.jsxs(Bo,{children:["توزيع الإيرادات حسب نوع المدفوعات (",r.length," فئة)"]})]}),p.jsxs(Yo,{children:[0===r.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ii,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد بيانات إيرادات متاحة"})]})}):p.jsx(ke,{width:"100%",height:300,children:p.jsxs(Se,{margin:{top:20,right:30,left:20,bottom:20},children:[p.jsx(De,{data:r,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percentage:t})=>`${e}: ${t}%`,outerRadius:100,innerRadius:40,fill:"#8884d8",dataKey:"value",stroke:d?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:r.map((e,t)=>p.jsx($e,{fill:e.color},`revenue-${t}`))}),p.jsx(Ce,{formatter:e=>[p.jsx(Nh,{amount:Number(e),currency:l}),"المبلغ"],labelFormatter:e=>`نوع الإيراد: ${e}`,contentStyle:u.tooltip})]})}),r.length>0&&p.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:r.map((e,t)=>p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsxs("span",{className:"text-muted-foreground",children:[e.name,": ",p.jsx(Nh,{amount:e.value,currency:l})," (",e.percentage,"%)"]})]},`revenue-legend-${t}`))})]})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ii,{className:"w-5 h-5"}),p.jsx("span",{children:"توزيع المصروفات"})]}),p.jsxs(Bo,{children:["توزيع المصروفات حسب النوع (",i.length," فئة)"]})]}),p.jsxs(Yo,{children:[0===i.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ii,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد مصروفات متاحة"})]})}):p.jsx(ke,{width:"100%",height:300,children:p.jsxs(Se,{margin:{top:20,right:30,left:20,bottom:20},children:[p.jsx(De,{data:i,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percentage:t})=>`${e}: ${t}%`,outerRadius:100,innerRadius:40,fill:"#8884d8",dataKey:"value",stroke:d?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:i.map((e,t)=>p.jsx($e,{fill:e.color},`expense-${t}`))}),p.jsx(Ce,{formatter:e=>[p.jsx(Nh,{amount:Number(e),currency:l}),"المبلغ"],labelFormatter:e=>`نوع المصروف: ${e}`,contentStyle:u.tooltip})]})}),i.length>0&&p.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:i.map((e,t)=>p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsxs("span",{className:"text-muted-foreground",children:[e.name,": ",p.jsx(Nh,{amount:e.value,currency:l})," (",e.percentage,"%)"]})]},`expense-legend-${t}`))})]})]})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(dr,{className:"w-5 h-5"}),p.jsx("span",{children:"مقارنة الإيرادات والمصروفات"})]}),p.jsx(Bo,{children:"مقارنة شاملة بين الإيرادات والمصروفات وصافي الربح/الخسارة"})]}),p.jsxs(Yo,{children:[p.jsx(ke,{width:"100%",height:400,children:p.jsxs(Ee,{data:o,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:"20%",children:[p.jsx(Te,{strokeDasharray:u.grid.strokeDasharray,stroke:u.grid.stroke,strokeOpacity:u.grid.strokeOpacity}),p.jsx(Ae,{dataKey:"name",tick:{fontSize:14,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"}}),p.jsx(Fe,{tick:{fontSize:14,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"},tickFormatter:e=>Math.abs(e)>=1e3?`${(e/1e3).toFixed(0)}k`:e.toString()}),p.jsx(Ce,{formatter:e=>[p.jsx(Nh,{amount:Number(e),currency:l}),"المبلغ"],labelFormatter:e=>e,contentStyle:u.tooltip}),p.jsx(Pe,{dataKey:"value",radius:[4,4,0,0],minPointSize:5,maxBarSize:100,children:o.map((e,t)=>p.jsx($e,{fill:"revenue"===e.type?s.secondary:"expenses"===e.type?s.danger:e.value>=0?s.secondary:s.danger},`comparison-${t}`))})]})}),p.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[p.jsxs("div",{className:"text-center p-3 bg-green-50 dark:bg-green-950/50 rounded",children:[p.jsx("div",{className:"text-xs text-green-600 dark:text-green-400",children:"الإيرادات"}),p.jsx("div",{className:"font-semibold text-green-700 dark:text-green-300",children:p.jsx(Nh,{amount:t.totalRevenue,currency:l})})]}),p.jsxs("div",{className:"text-center p-3 bg-red-50 dark:bg-red-950/50 rounded",children:[p.jsx("div",{className:"text-xs text-red-600 dark:text-red-400",children:"المصروفات"}),p.jsx("div",{className:"font-semibold text-red-700 dark:text-red-300",children:p.jsx(Nh,{amount:a.totalExpenses,currency:l})})]}),p.jsxs("div",{className:"text-center p-3 rounded "+(a.isProfit?"bg-blue-50 dark:bg-blue-950/50":"bg-orange-50 dark:bg-orange-950/50"),children:[p.jsx("div",{className:"text-xs "+(a.isProfit?"text-blue-600 dark:text-blue-400":"text-orange-600 dark:text-orange-400"),children:a.isProfit?"صافي الربح":"صافي الخسارة"}),p.jsx("div",{className:"font-semibold "+(a.isProfit?"text-blue-700 dark:text-blue-300":"text-orange-700 dark:text-orange-300"),children:p.jsx(Nh,{amount:a.isProfit?a.netProfit:a.lossAmount,currency:l})})]})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ui,{className:"w-5 h-5"}),p.jsx("span",{children:"حالات المدفوعات"})]}),p.jsxs(Bo,{children:["توزيع المدفوعات حسب الحالة (",e.length," مدفوعة)"]})]}),p.jsx(Yo,{children:(()=>{const t=[{name:"مكتملة",value:e.filter(e=>"completed"===e.status).length,color:s.secondary,amount:e.filter(e=>"completed"===e.status).reduce((e,t)=>e+(t.amount||0),0)},{name:"جزئية",value:e.filter(e=>"partial"===e.status).length,color:s.warning,amount:e.filter(e=>"partial"===e.status).reduce((e,t)=>e+(t.amount||0),0)},{name:"معلقة",value:e.filter(e=>"pending"===e.status).length,color:s.danger,amount:e.filter(e=>"pending"===e.status).reduce((e,t)=>e+(t.total_amount_due||t.amount||0),0)}].filter(e=>e.value>0);return 0===t.length?p.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:p.jsxs("div",{className:"text-center",children:[p.jsx(ui,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد مدفوعات متاحة"})]})}):p.jsxs(p.Fragment,{children:[p.jsx(ke,{width:"100%",height:300,children:p.jsxs(Ee,{data:t,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:"20%",children:[p.jsx(Te,{strokeDasharray:u.grid.strokeDasharray,stroke:u.grid.stroke,strokeOpacity:u.grid.strokeOpacity}),p.jsx(Ae,{dataKey:"name",tick:{fontSize:14,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"}}),p.jsx(Fe,{tick:{fontSize:14,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"}}),p.jsx(Ce,{formatter:(e,t,n)=>[`${e} مدفوعة`,"العدد",p.jsx(Nh,{amount:n.payload.amount,currency:l})],labelFormatter:e=>`الحالة: ${e}`,contentStyle:u.tooltip}),p.jsx(Pe,{dataKey:"value",radius:[4,4,0,0],minPointSize:5,maxBarSize:80,children:t.map((e,t)=>p.jsx($e,{fill:e.color},`status-${t}`))})]})}),p.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2 text-sm",children:t.map((e,t)=>p.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:e.name}),p.jsxs("div",{className:"font-semibold",children:[e.value," مدفوعة"]}),p.jsx("div",{className:"text-xs",children:p.jsx(Nh,{amount:e.amount,currency:l})})]},`status-summary-${t}`))})]})})()})]}),p.jsxs(Lo,{dir:"rtl",children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ki,{className:"w-5 h-5"}),p.jsx("span",{children:"تحليل الربحية"})]}),p.jsx(Bo,{children:"تحليل مفصل لهامش الربح والأداء المالي"})]}),p.jsx(Yo,{children:p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"text-4xl font-bold mb-2",children:p.jsxs("span",{className:a.isProfit?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:[a.profitMargin.toFixed(1),"%"]})}),p.jsx("div",{className:"text-sm text-muted-foreground",children:"هامش الربح"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex justify-between text-sm",children:[p.jsx("span",{children:"الأداء المالي"}),p.jsx("span",{className:a.isProfit?"text-green-600":"text-red-600",children:a.isProfit?"ربح":"خسارة"})]}),p.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:p.jsx("div",{className:"h-3 rounded-full transition-all duration-300 "+(a.isProfit?"bg-green-500":"bg-red-500"),style:{width:`${Math.min(Math.abs(a.profitMargin),100)}%`}})})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[p.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/50 rounded",children:[p.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:"نسبة المصروفات"}),p.jsxs("div",{className:"font-semibold text-blue-700 dark:text-blue-300",children:[t.totalRevenue>0?(a.totalExpenses/t.totalRevenue*100).toFixed(1):"0","%"]})]}),p.jsxs("div",{className:"p-3 bg-purple-50 dark:bg-purple-950/50 rounded",children:[p.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400",children:"كفاءة التكلفة"}),p.jsxs("div",{className:"font-semibold text-purple-700 dark:text-purple-300",children:[a.totalExpenses>0?(t.totalRevenue/a.totalExpenses*100).toFixed(0):"0","%"]})]}),p.jsxs("div",{className:"p-3 bg-teal-50 dark:bg-teal-950/50 rounded",children:[p.jsx("div",{className:"text-xs text-teal-600 dark:text-teal-400",children:"متوسط المعاملة"}),p.jsx("div",{className:"font-semibold text-teal-700 dark:text-teal-300",children:p.jsx(Nh,{amount:e.length>0?t.totalRevenue/e.length:0,currency:l})})]}),p.jsxs("div",{className:"p-3 bg-orange-50 dark:bg-orange-950/50 rounded",children:[p.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:"المبالغ المعلقة"}),p.jsx("div",{className:"font-semibold text-orange-700 dark:text-orange-300",children:p.jsx(Nh,{amount:t.pendingAmount||0,currency:l})})]})]})]})})]})]})]})}()]})}function hx(){const{currency:e}=qt(),{payments:t}=Go(),{expenses:n}=Ch(),{appointments:a}=Wo(),{items:s}=jd(),{patients:r}=cl(),{needs:i,totalValue:l}=Eh(),{labOrders:o}=Th(),{toothTreatments:d}=Ko(),{prescriptions:c}=Nd(),{reportData:u,patientReports:h,appointmentReports:x,financialReports:g,inventoryReports:f,clinicNeedsReports:v,isLoading:y,isExporting:b,error:j,activeReportType:w,currentFilter:N,generateReport:_,generateAllReports:k,setActiveReportType:S,setFilter:D,exportReport:$,clearError:C}=Sh(),[E,T]=ve.useState("overview"),[A,F]=ve.useState("this_month"),[P,O]=ve.useState(""),[R,M]=ve.useState(""),[L,I]=ve.useState(!1),z=(e,t)=>{if("all"===A)return e;const n=new Date;let a,s=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59);switch(A){case"today":a=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0);break;case"this_week":const t=n.getDay();a=new Date(n.getTime()-24*t*60*60*1e3),a.setHours(0,0,0,0);break;case"this_month":a=new Date(n.getFullYear(),n.getMonth(),1,0,0,0);break;case"this_year":a=new Date(n.getFullYear(),0,1,0,0,0);break;case"last_week":const r=new Date(n.getTime()-24*n.getDay()*60*60*1e3);r.setHours(23,59,59,999),s=r,a=new Date(r.getTime()-5184e5),a.setHours(0,0,0,0);break;case"last_month":const i=0===n.getMonth()?11:n.getMonth()-1,l=0===n.getMonth()?n.getFullYear()-1:n.getFullYear();a=new Date(l,i,1,0,0,0),s=new Date(n.getFullYear(),n.getMonth(),0,23,59,59);break;case"last_year":a=new Date(n.getFullYear()-1,0,1,0,0,0),s=new Date(n.getFullYear()-1,11,31,23,59,59);break;case"last_30_days":a=new Date(n.getTime()-2592e6),a.setHours(0,0,0,0);break;case"last_90_days":a=new Date(n.getTime()-7776e6),a.setHours(0,0,0,0);break;case"custom":if(!P||!R)return e;a=new Date(P),s=new Date(R),s.setHours(23,59,59,999);break;default:return e}return e.filter(e=>{const n=new Date(e[t]);return n>=a&&n<=s})},B=z(a,"start_time"),Y=z(t,"payment_date"),V=z(s,"created_at"),q=z(i,"created_at"),U=z(n,"payment_date"),H=Y.filter(e=>{var t;const n=null==(t=e.status)?void 0:t.toLowerCase();return"pending"===n||"معلق"===n||"unpaid"===n||!e.status&&e.amount>0&&!e.amount_paid}),G=H.reduce((e,t)=>{let n=t.amount||0;if(t.tooth_treatment_id){n=t.treatment_total_cost||t.total_amount_due||0}else 0===n&&(t.total_amount_due||0)>0?n=t.total_amount_due:0===n&&(t.remaining_balance||0)>0&&(n=t.remaining_balance);return e+n},0);console.log("🔍 Debug Pending Payments:",{totalPayments:t.length,filteredPayments:Y.length,filteredPendingPayments:H.length,filteredPendingAmount:G,selectedPeriod:A,allPayments:t.map(e=>{var t;return{id:e.id,status:e.status,amount:e.amount,date:e.payment_date,patient:null==(t=e.patient)?void 0:t.full_name}}),filteredPendingDetails:H.map(e=>{var t;let n=e.amount||0;if(e.tooth_treatment_id){n=e.treatment_total_cost||e.total_amount_due||0}else 0===n&&(e.total_amount_due||0)>0?n=e.total_amount_due:0===n&&(e.remaining_balance||0)>0&&(n=e.remaining_balance);return{id:e.id,status:e.status,amount:e.amount,total_amount_due:e.total_amount_due,treatment_total_cost:e.treatment_total_cost,amount_paid:e.amount_paid,remaining_balance:e.remaining_balance,calculatedPendingAmount:n,date:e.payment_date,patient:null==(t=e.patient)?void 0:t.full_name,tooth_treatment_id:e.tooth_treatment_id}})}),ve.useEffect(()=>{console.log("🔄 Loading initial reports..."),C(),k();(()=>{m(this,null,function*(){try{const{loadAppointments:e}=Wo.getState(),{loadPayments:t}=Go.getState(),{loadItems:n}=jd.getState(),{loadPatients:a}=cl.getState(),{loadNeeds:s}=Eh.getState(),{loadLabOrders:r}=Th.getState(),{loadToothTreatments:i}=Ko.getState(),{loadPrescriptions:l}=Nd.getState();console.log("🔄 Loading all data for comprehensive reports..."),yield Promise.all([e(),t(),n(),a(),s(),r(),i(),l()]),console.log("✅ All data loaded successfully for reports")}catch(e){console.error("❌ Error loading data for reports:",e)}})})()},[k,C]),ve.useEffect(()=>{if(j){console.error("❌ Reports error:",j);const e=new CustomEvent("showToast",{detail:{title:"خطأ في التقارير",description:j,type:"error"}});window.dispatchEvent(e)}},[j]);return Ah(["overview"]),ve.useEffect(()=>{const{startAutoRefresh:e,stopAutoRefresh:t}=Sh.getState();return e(1),()=>{t()}},[]),ve.useEffect(()=>{S(E)},[E,S]),p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsx("div",{className:"flex items-center justify-between",children:p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[p.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"التقارير والتحليلات"}),p.jsx(Xh,{isActive:!0})]}),p.jsx("p",{className:"text-muted-foreground",children:"تقارير شاملة ومفصلة لجميع جوانب العيادة - تحديث تلقائي في الوقت الفعلي"})]})}),j&&p.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:p.jsxs("div",{className:"flex items-center",children:[p.jsx(sr,{className:"h-5 w-5 text-red-600 ml-2"}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-sm font-medium text-red-800",children:"خطأ في تحميل التقارير"}),p.jsx("p",{className:"text-sm text-red-700 mt-1",children:j})]}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:C,className:"mr-auto",children:"إغلاق"})]})}),y&&p.jsx("div",{className:"flex items-center justify-center py-12",children:p.jsxs("div",{className:"text-center",children:[p.jsx(mi,{className:"h-8 w-8 animate-spin text-sky-600 mx-auto mb-4"}),p.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل التقارير..."})]})}),p.jsxs(iu,{value:E,onValueChange:e=>m(this,null,function*(){T(e),S(e);try{if("treatments"===e){const{loadToothTreatments:e}=Ko.getState(),{loadPatients:t}=cl.getState();yield Promise.all([e(),t()])}else if("clinicNeeds"===e){const{loadNeeds:e}=Eh.getState();yield e()}else if("inventory"===e){const{loadItems:e}=jd.getState();yield e()}else if("financial"===e){const{loadPayments:e}=Go.getState(),{loadLabOrders:t}=Th.getState();yield Promise.all([e(),t()])}else if("profitLoss"===e){const{loadPayments:e}=Go.getState(),{loadExpenses:t}=Ch.getState(),{loadLabOrders:n}=Th.getState(),{loadNeeds:a}=Eh.getState(),{loadItems:s}=jd.getState();yield Promise.all([e(),t(),n(),a(),s()])}else if("patients"===e){const{loadPatients:e}=cl.getState();yield e()}else if("appointments"===e){const{loadAppointments:e}=Wo.getState();yield e()}"overview"!==e&&(yield _(e))}catch(t){console.error(`❌ Error loading data for ${e} tab:`,t)}}),className:"space-y-6",children:[p.jsxs(lu,{className:"grid w-full grid-cols-7",children:[p.jsxs(ou,{value:"overview",className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(mr,{className:"w-4 h-4"}),p.jsx("span",{children:"التقرير الشامل المفصل"})]}),p.jsxs(ou,{value:"profitLoss",className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ki,{className:"w-4 h-4"}),p.jsx("span",{children:"المالية"})]}),p.jsxs(ou,{value:"patients",className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(Fi,{className:"w-4 h-4"}),p.jsx("span",{children:"المرضى"})]}),p.jsxs(ou,{value:"appointments",className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(hr,{className:"w-4 h-4"}),p.jsx("span",{children:"المواعيد"})]}),p.jsxs(ou,{value:"treatments",className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(yi,{className:"w-4 h-4"}),p.jsx("span",{children:"العلاجات"})]}),p.jsxs(ou,{value:"inventory",className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ti,{className:"w-4 h-4"}),p.jsx("span",{children:"المخزون"})]}),p.jsxs(ou,{value:"clinicNeeds",className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(kr,{className:"w-4 h-4"}),p.jsx("span",{children:"احتياجات العيادة"})]})]}),p.jsx(du,{value:"overview",className:"space-y-6",dir:"rtl",children:p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-3",children:[p.jsx(dr,{className:"w-6 h-6"}),"التقرير الشامل المفصل"]}),p.jsx("p",{className:"text-muted-foreground mt-1",children:"نظرة شاملة على أداء العيادة"})]}),p.jsxs(Qi,{variant:"outline",onClick:()=>m(this,null,function*(){I(!0);try{console.log("🔄 Loading fresh data for comprehensive export...");const{loadAppointments:e}=Wo.getState(),{loadPayments:l}=Go.getState(),{loadExpenses:u}=Ch.getState(),{loadItems:m}=jd.getState(),{loadPatients:p}=cl.getState(),{loadNeeds:h}=Eh.getState(),{loadLabOrders:x}=Th.getState(),{loadToothTreatments:g}=Ko.getState(),{loadPrescriptions:f}=Nd.getState();yield Promise.all([e(),l(),u(),m(),p(),h(),x(),g(),f()]),console.log("✅ All data loaded, starting filtered export..."),yield Gh.exportComprehensiveReport({patients:r,appointments:a,payments:t,inventory:s,treatments:d||[],prescriptions:c||[],labOrders:o||[],clinicNeeds:i||[],expenses:n||[],timePeriod:A,customStartDate:"custom"===A?P:void 0,customEndDate:"custom"===A?R:void 0});let v="تم تصدير التقرير الشامل المفصل بنجاح!";v+=` (${Hh[A]})`;v+=` - ${a.length+t.length+((null==d?void 0:d.length)||0)+((null==c?void 0:c.length)||0)+((null==o?void 0:o.length)||0)+((null==i?void 0:i.length)||0)} سجل إجمالي`,rc.exportSuccess(v)}catch(e){console.error("Error exporting comprehensive report:",e),rc.exportError("فشل في تصدير التقرير الشامل")}finally{I(!1)}}),disabled:L,className:"flex items-center gap-2",children:[p.jsx(Tr,{className:"w-4 h-4"}),L?"جاري التصدير...":"تصدير التقرير"]})]}),p.jsxs(Lo,{className:vd("blue"),children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center gap-3",children:[p.jsx(Or,{className:`w-5 h-5 ${yd("blue")}`}),"فلترة التقرير"]}),p.jsx(Bo,{children:"اختر الفترة الزمنية للتقرير الشامل"})]}),p.jsx(Yo,{className:"space-y-4",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"period",children:"الفترة الزمنية"}),p.jsxs(el,{value:A,onValueChange:e=>F(e),children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر الفترة الزمنية"})}),p.jsx(il,{children:Object.entries(Hh).map(([e,t])=>p.jsx(dl,{value:e,children:t},e))})]})]}),"custom"===A&&p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"startDate",children:"تاريخ البداية"}),p.jsx(Xi,{id:"startDate",type:"date",value:P,onChange:e=>O(e.target.value)})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"endDate",children:"تاريخ النهاية"}),p.jsx(Xi,{id:"endDate",type:"date",value:R,onChange:e=>M(e.target.value)})]})]})]})})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[p.jsx(Lo,{className:vd("blue"),children:p.jsx(Yo,{className:"p-6",children:p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("div",{className:`p-3 rounded-lg ${vd("blue")}`,children:p.jsx(Fi,{className:`w-6 h-6 ${yd("blue")}`})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المرضى"}),p.jsx("p",{className:"text-2xl font-bold",children:r.length})]})]})})}),p.jsx(Lo,{className:vd("purple"),children:p.jsx(Yo,{className:"p-6",children:p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("div",{className:`p-3 rounded-lg ${vd("purple")}`,children:p.jsx(hr,{className:`w-6 h-6 ${yd("purple")}`})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"المواعيد المفلترة"}),p.jsx("p",{className:"text-2xl font-bold",children:B.length})]})]})})}),p.jsx(Lo,{className:vd("green"),children:p.jsx(Yo,{className:"p-6",children:p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("div",{className:`p-3 rounded-lg ${vd("green")}`,children:p.jsx(Er,{className:`w-6 h-6 ${yd("green")}`})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"الإيرادات المفلترة"}),p.jsx("p",{className:"text-xl font-bold",children:p.jsx(Nh,{amount:Y.reduce((e,t)=>e+(t.amount||0),0),currency:e})})]})]})})}),p.jsx(Lo,{className:vd("orange"),children:p.jsx(Yo,{className:"p-6",children:p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("div",{className:`p-3 rounded-lg ${vd("orange")}`,children:p.jsx(ti,{className:`w-6 h-6 ${yd("orange")}`})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"عناصر المخزون المفلترة"}),p.jsx("p",{className:"text-2xl font-bold",children:V.length})]})]})})})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(ki,{className:"w-5 h-5 text-green-500"}),"الملخص المالي"]})}),p.jsxs(Yo,{className:"space-y-4",children:[p.jsxs("div",{className:"flex justify-between items-center p-4 bg-green-50/80 dark:bg-green-950/50 border border-green-200/50 dark:border-green-700/50 rounded-lg backdrop-blur-sm",children:[p.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"الإيرادات المفلترة"}),p.jsx("span",{className:"text-lg font-bold text-green-700 dark:text-green-100",children:p.jsx(Nh,{amount:Y.reduce((e,t)=>e+(t.amount||0),0),currency:e})})]}),p.jsxs("div",{className:"flex justify-between items-center p-4 bg-yellow-50/80 dark:bg-yellow-950/50 border border-yellow-200/50 dark:border-yellow-700/50 rounded-lg backdrop-blur-sm",children:[p.jsx("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"المدفوعات المعلقة المفلترة"}),p.jsx("span",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-100",children:p.jsx(Nh,{amount:G,currency:e})})]}),p.jsxs("div",{className:"flex justify-between items-center p-4 bg-orange-50/80 dark:bg-orange-950/50 border border-orange-200/50 dark:border-orange-700/50 rounded-lg backdrop-blur-sm",children:[p.jsx("span",{className:"text-sm font-medium text-orange-800 dark:text-orange-200",children:"المدفوعات الجزئية المفلترة"}),p.jsx("span",{className:"text-lg font-bold text-orange-700 dark:text-orange-100",children:p.jsx(Nh,{amount:Y.filter(e=>"partial"===e.status).reduce((e,t)=>{const n=Number(t.total_amount_due||t.amount)||0,a=Number(t.amount_paid||t.amount)||0;return e+Math.max(0,n-a)},0),currency:e})})]}),p.jsxs("div",{className:"flex justify-between items-center p-4 bg-red-50/80 dark:bg-red-950/50 border border-red-200/50 dark:border-red-700/50 rounded-lg backdrop-blur-sm",children:[p.jsx("span",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"المصروفات المفلترة"}),p.jsx("span",{className:"text-lg font-bold text-red-700 dark:text-red-100",children:p.jsx(Nh,{amount:U.reduce((e,t)=>e+(t.amount||0),0),currency:e})})]})]})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(nr,{className:"w-5 h-5 text-blue-500"}),"إحصائيات سريعة"]})}),p.jsx(Yo,{className:"space-y-4",children:p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"text-center p-4 bg-blue-50/80 dark:bg-blue-950/50 border border-blue-200/50 dark:border-blue-700/50 rounded-lg backdrop-blur-sm",children:[p.jsx("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-100",children:B.filter(e=>"completed"===e.status).length}),p.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-200 mt-1 font-medium",children:"مواعيد مكتملة مفلترة"})]}),p.jsxs("div",{className:"text-center p-4 bg-purple-50/80 dark:bg-purple-950/50 border border-purple-200/50 dark:border-purple-700/50 rounded-lg backdrop-blur-sm",children:[p.jsx("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-100",children:B.filter(e=>"scheduled"===e.status).length}),p.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-200 mt-1 font-medium",children:"مواعيد مجدولة مفلترة"})]}),p.jsxs("div",{className:"text-center p-4 bg-emerald-50/80 dark:bg-emerald-950/50 border border-emerald-200/50 dark:border-emerald-700/50 rounded-lg backdrop-blur-sm",children:[p.jsx("div",{className:"text-2xl font-bold text-emerald-700 dark:text-emerald-100",children:q.length}),p.jsx("div",{className:"text-xs text-emerald-600 dark:text-emerald-200 mt-1 font-medium",children:"احتياجات العيادة المفلترة"})]}),p.jsxs("div",{className:"text-center p-4 bg-orange-50/80 dark:bg-orange-950/50 border border-orange-200/50 dark:border-orange-700/50 rounded-lg backdrop-blur-sm",children:[p.jsx("div",{className:"text-2xl font-bold text-orange-700 dark:text-orange-100",children:U.length}),p.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-200 mt-1 font-medium",children:"مصروفات مفلترة"})]})]})})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[p.jsx(Lo,{className:vd("cyan"),children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(Pr,{className:`w-6 h-6 ${yd("cyan")}`}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"العلاجات"}),p.jsx("p",{className:"text-xl font-bold",children:(null==d?void 0:d.length)||0})]})]})})}),p.jsx(Lo,{className:vd("indigo"),children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(Pr,{className:`w-6 h-6 ${yd("indigo")}`}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"الوصفات"}),p.jsx("p",{className:"text-xl font-bold",children:(null==c?void 0:c.length)||0})]})]})})}),p.jsx(Lo,{className:vd("purple"),children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(ur,{className:`w-6 h-6 ${yd("purple")}`}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"طلبات المخابر"}),p.jsx("p",{className:"text-xl font-bold",children:(null==o?void 0:o.length)||0})]})]})})}),p.jsx(Lo,{className:vd("gray"),children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(kr,{className:`w-6 h-6 ${yd("gray")}`}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"احتياجات العيادة المفلترة"}),p.jsx("p",{className:"text-xl font-bold",children:q.length})]})]})})})]})]})}),p.jsx(du,{value:"patients",dir:"rtl",children:p.jsx(Lh,{})}),p.jsx(du,{value:"appointments",dir:"rtl",children:p.jsx(zh,{})}),p.jsx(du,{value:"financial",dir:"rtl",children:p.jsx(Qh,{})}),p.jsx(du,{value:"treatments",dir:"rtl",children:p.jsx(nx,{})}),p.jsx(du,{value:"inventory",dir:"rtl",children:p.jsx(Ih,{})}),p.jsx(du,{value:"clinicNeeds",dir:"rtl",children:p.jsx(ix,{})}),p.jsx(du,{value:"profitLoss",dir:"rtl",children:p.jsx(px,{})})]})]})}class xx{static getQuickAccessData(){return m(this,null,function*(){try{const[e,t,n,a,s]=yield Promise.all([this.getRecentPatients(),this.getTodayAppointments(),this.getPendingPayments(),this.getUrgentTreatments(),this.getRecentActivities()]);return{recentPatients:e,todayAppointments:t,pendingPayments:n,urgentTreatments:a,recentActivities:s,quickStats:yield this.getQuickStats()}}catch(e){throw console.error("Error getting quick access data:",e),new Error("فشل في جلب بيانات الوصول السريع")}})}static getRecentPatients(){return m(this,null,function*(){var e,t,n;try{const a=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.patients)?void 0:t.getAll)?void 0:n.call(t))||[];return 0===a.length?[]:a.sort((e,t)=>new Date(t.updated_at||t.created_at).getTime()-new Date(e.updated_at||e.created_at).getTime()).slice(0,5)}catch(a){return console.error("Error getting recent patients:",a),[]}})}static getTodayAppointments(){return m(this,null,function*(){var e,t,n;try{const a=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.appointments)?void 0:t.getAll)?void 0:n.call(t))||[],s=new Date;return a.filter(e=>{const t=new Date(e.start_time);return this.isSameDay(t,s)}).sort((e,t)=>new Date(e.start_time).getTime()-new Date(t.start_time).getTime())}catch(a){return console.error("Error getting today appointments:",a),[]}})}static getPendingPayments(){return m(this,null,function*(){var e,t,n;try{return((yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.payments)?void 0:t.getAll)?void 0:n.call(t))||[]).filter(e=>"pending"===e.status&&e.remaining_balance&&e.remaining_balance>0).sort((e,t)=>new Date(e.payment_date).getTime()-new Date(t.payment_date).getTime()).slice(0,10)}catch(a){return console.error("Error getting pending payments:",a),[]}})}static getUrgentTreatments(){return m(this,null,function*(){var e,t,n;try{const a=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.treatments)?void 0:t.getAll)?void 0:n.call(t))||[],s=new Date;return a.filter(e=>{if("planned"!==e.treatment_status&&"in_progress"!==e.treatment_status)return!1;const t=new Date(e.created_at);return Math.floor((s.getTime()-t.getTime())/864e5)>7}).sort((e,t)=>e.priority!==t.priority?e.priority-t.priority:new Date(e.created_at).getTime()-new Date(t.created_at).getTime()).slice(0,8)}catch(a){return console.error("Error getting urgent treatments:",a),[]}})}static getRecentActivities(){return m(this,null,function*(){var e,t,n,a,s,r,i,l,o;try{const d=[],c=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.patients)?void 0:t.getAll)?void 0:n.call(t))||[];c.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,3).forEach(e=>{d.push({id:`patient_added_${e.id}`,type:"patient_added",title:"مريض جديد",description:`تم إضافة المريض ${e.full_name}`,patientId:e.id,patientName:e.full_name,timestamp:e.created_at,icon:"👤"})});const u=(yield null==(r=null==(s=null==(a=window.electronAPI)?void 0:a.appointments)?void 0:s.getAll)?void 0:r.call(s))||[];u.filter(e=>"completed"===e.status).sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime()).slice(0,3).forEach(e=>{var t,n;d.push({id:`appointment_completed_${e.id}`,type:"appointment_created",title:"موعد مكتمل",description:`تم إكمال موعد ${(null==(t=e.patient)?void 0:t.full_name)||"مريض غير محدد"}`,patientId:e.patient_id,patientName:null==(n=e.patient)?void 0:n.full_name,timestamp:e.updated_at,icon:"📅"})});const m=(yield null==(o=null==(l=null==(i=window.electronAPI)?void 0:i.payments)?void 0:l.getAll)?void 0:o.call(l))||[];return m.filter(e=>"completed"===e.status).sort((e,t)=>new Date(t.payment_date).getTime()-new Date(e.payment_date).getTime()).slice(0,3).forEach(e=>{var t,n;d.push({id:`payment_received_${e.id}`,type:"payment_received",title:"دفعة مستلمة",description:`تم استلام دفعة ${e.amount}$ من ${(null==(t=e.patient)?void 0:t.full_name)||"مريض غير محدد"}`,patientId:e.patient_id,patientName:null==(n=e.patient)?void 0:n.full_name,timestamp:e.payment_date,icon:"💰"})}),d.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()).slice(0,10)}catch(d){return console.error("Error getting recent activities:",d),[]}})}static getQuickStats(){return m(this,null,function*(){var e,t,n,a,s,r,i,l,o;try{const[d,c,u]=yield Promise.all([(null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.patients)?void 0:t.getAll)?void 0:n.call(t))||[],(null==(r=null==(s=null==(a=window.electronAPI)?void 0:a.appointments)?void 0:s.getAll)?void 0:r.call(s))||[],(null==(o=null==(l=null==(i=window.electronAPI)?void 0:i.payments)?void 0:l.getAll)?void 0:o.call(l))||[]]),m=new Date,p=d.length,h=c.filter(e=>{const t=new Date(e.start_time);return this.isSameDay(t,m)}).length,x=u.filter(e=>"pending"===e.status&&e.remaining_balance&&e.remaining_balance>0).length;return{totalPatients:p,todayAppointments:h,pendingPayments:x,urgentAlerts:0}}catch(d){return console.error("Error getting quick stats:",d),{totalPatients:0,todayAppointments:0,pendingPayments:0,urgentAlerts:0}}})}static refreshQuickAccessData(){return m(this,null,function*(){return this.getQuickAccessData()})}static getMostVisitedPatients(){return m(this,null,function*(){var e,t,n,a,s,r;try{const i=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.appointments)?void 0:t.getAll)?void 0:n.call(t))||[],l=(yield null==(r=null==(s=null==(a=window.electronAPI)?void 0:a.patients)?void 0:s.getAll)?void 0:r.call(s))||[],o={};return i.forEach(e=>{e.patient_id&&"completed"===e.status&&(o[e.patient_id]=(o[e.patient_id]||0)+1)}),l.filter(e=>o[e.id]>0).sort((e,t)=>(o[t.id]||0)-(o[e.id]||0)).slice(0,10)}catch(i){return console.error("Error getting most visited patients:",i),[]}})}static getPatientsNeedingFollowUp(){return m(this,null,function*(){var e,t,n,a,s,r;try{const i=(yield null==(n=null==(t=null==(e=window.electronAPI)?void 0:e.appointments)?void 0:t.getAll)?void 0:n.call(t))||[],l=(yield null==(r=null==(s=null==(a=window.electronAPI)?void 0:a.patients)?void 0:s.getAll)?void 0:r.call(s))||[],o=new Date,d={};return i.forEach(e=>{if(e.patient_id&&"completed"===e.status){const t=new Date(e.start_time);(!d[e.patient_id]||t>d[e.patient_id])&&(d[e.patient_id]=t)}}),l.filter(e=>{const t=d[e.id];if(!t)return!1;return Math.floor((o.getTime()-t.getTime())/864e5)>90}).slice(0,10)}catch(i){return console.error("Error getting patients needing follow up:",i),[]}})}static isSameDay(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}}class gx{static performGlobalSearch(e){return m(this,null,function*(){const t=Date.now();try{const n=e.types||["patient","appointment","payment","treatment","prescription"],a=[];n.includes("patient")&&a.push(this.searchPatients(e)),n.includes("appointment")&&a.push(this.searchAppointments(e)),n.includes("payment")&&a.push(this.searchPayments(e)),n.includes("treatment")&&a.push(this.searchTreatments(e)),n.includes("prescription")&&a.push(this.searchPrescriptions(e));const s=yield Promise.all(a),r={patients:n.includes("patient")&&s[n.indexOf("patient")]||[],appointments:n.includes("appointment")&&s[n.indexOf("appointment")]||[],payments:n.includes("payment")&&s[n.indexOf("payment")]||[],treatments:n.includes("treatment")&&s[n.indexOf("treatment")]||[],prescriptions:n.includes("prescription")&&s[n.indexOf("prescription")]||[],totalCount:0,searchTime:Date.now()-t,query:e.query};return r.totalCount=r.patients.length+r.appointments.length+r.payments.length+r.treatments.length+r.prescriptions.length,this.sortResultsByRelevance(r,e),e.limit&&this.limitResults(r,e.limit),r}catch(n){throw console.error("Global search error:",n),new Error("فشل في البحث الشامل")}})}static searchPatients(e){return m(this,null,function*(){var t,n,a;try{return((yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.patients)?void 0:n.search)?void 0:a.call(n,e.query))||[]).map(t=>({id:t.id,type:"patient",title:t.full_name,subtitle:`#${t.serial_number} | ${t.age} سنة | ${"male"===t.gender?"ذكر":"أنثى"}`,description:`📞 ${t.phone||"غير محدد"} | 📧 ${t.email||"غير محدد"}`,relevanceScore:this.calculateRelevanceScore(e.query,[t.full_name,t.serial_number,t.phone||"",t.email||""]),data:t,relatedData:{patientId:t.id}}))}catch(s){return console.error("Search patients error:",s),[]}})}static searchAppointments(e){return m(this,null,function*(){var t,n,a;try{return((yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.appointments)?void 0:n.search)?void 0:a.call(n,e.query))||[]).map(t=>({id:t.id,type:"appointment",title:t.title,subtitle:`${t.patient_name||"مريض غير محدد"} | ${this.formatDate(t.start_time)}`,description:`🕐 ${this.formatTime(t.start_time)} - ${this.formatTime(t.end_time)} | ${this.getStatusText(t.status)}`,relevanceScore:this.calculateRelevanceScore(e.query,[t.title,t.description||"",t.patient_name||"",t.notes||""]),data:t,relatedData:{patientId:t.patient_id,appointmentId:t.id}}))}catch(s){return console.error("Search appointments error:",s),[]}})}static searchPayments(e){return m(this,null,function*(){var t,n,a;try{return((yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.payments)?void 0:n.search)?void 0:a.call(n,e.query))||[]).map(t=>{var n;return{id:t.id,type:"payment",title:`دفعة ${t.amount}$ - ${t.patient_name||"مريض غير محدد"}`,subtitle:`${this.formatDate(t.payment_date)} | ${t.receipt_number||"بدون رقم إيصال"}`,description:`💳 ${"cash"===t.payment_method?"نقدي":"تحويل بنكي"} | ${this.getPaymentStatusText(t.status)}`,relevanceScore:this.calculateRelevanceScore(e.query,[(null==(n=t.patient)?void 0:n.full_name)||"",t.description||"",t.receipt_number||"",t.notes||""]),data:t,relatedData:{patientId:t.patient_id,paymentId:t.id,appointmentId:t.appointment_id}}})}catch(s){return console.error("Search payments error:",s),[]}})}static searchTreatments(e){return m(this,null,function*(){var t,n,a;try{return((yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.treatments)?void 0:n.search)?void 0:a.call(n,e.query))||[]).map(t=>{var n;return{id:t.id,type:"treatment",title:`${ad(t.treatment_type)} - السن ${t.tooth_number}`,subtitle:`${t.patient_name||"مريض غير محدد"} | ${this.getTreatmentStatusText(t.treatment_status)}`,description:`🦷 ${t.tooth_name} | 💰 ${t.cost||0}$`,relevanceScore:this.calculateRelevanceScore(e.query,[ad(t.treatment_type),t.tooth_name,(null==(n=t.patient)?void 0:n.full_name)||"",t.notes||""]),data:t,relatedData:{patientId:t.patient_id,treatmentId:t.id,appointmentId:t.appointment_id}}})}catch(s){return console.error("Search treatments error:",s),[]}})}static searchPrescriptions(e){return m(this,null,function*(){var t,n,a;try{return((yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.prescriptions)?void 0:n.search)?void 0:a.call(n,e.query))||[]).map(t=>{var n,a,s,r;return{id:t.id,type:"prescription",title:`وصفة ${t.patient_name||"مريض غير محدد"}`,subtitle:`${this.formatDate(t.prescription_date)} | ${(null==(n=t.medications)?void 0:n.length)||0} دواء`,description:`💊 ${(null==(a=t.medications)?void 0:a.map(e=>e.medication_name).join(", "))||"لا توجد أدوية"}`,relevanceScore:this.calculateRelevanceScore(e.query,[(null==(s=t.patient)?void 0:s.full_name)||"",t.notes||"",...(null==(r=t.medications)?void 0:r.map(e=>e.medication_name||""))||[]]),data:t,relatedData:{patientId:t.patient_id,appointmentId:t.appointment_id,treatmentId:t.tooth_treatment_id}}})}catch(s){return console.error("Search prescriptions error:",s),[]}})}static calculateRelevanceScore(e,t){const n=e.toLowerCase();let a=0;return t.forEach(e=>{if(e){const t=e.toLowerCase();if(t===n)a+=100;else if(t.startsWith(n))a+=80;else if(t.includes(n))a+=60;else{n.split(" ").forEach(e=>{e.length>2&&t.includes(e)&&(a+=20)})}}}),a}static sortResultsByRelevance(e,t){const n=(e,n)=>"relevance"===t.sortBy?"asc"===t.sortOrder?e.relevanceScore-n.relevanceScore:n.relevanceScore-e.relevanceScore:"name"===t.sortBy?"asc"===t.sortOrder?e.title.localeCompare(n.title):n.title.localeCompare(e.title):0;e.patients.sort(n),e.appointments.sort(n),e.payments.sort(n),e.treatments.sort(n),e.prescriptions.sort(n)}static limitResults(e,t){if(e.totalCount<=t)return;const n=Math.floor(t/5),a=t%5;e.patients=e.patients.slice(0,n+(a>0?1:0)),e.appointments=e.appointments.slice(0,n+(a>1?1:0)),e.payments=e.payments.slice(0,n+(a>2?1:0)),e.treatments=e.treatments.slice(0,n+(a>3?1:0)),e.prescriptions=e.prescriptions.slice(0,n+(a>4?1:0)),e.totalCount=t}static formatDate(e){try{const t=new Date(e);if(isNaN(t.getTime()))return"--";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${n}/${a}/${t.getFullYear()}`}catch(t){return"--"}}static formatTime(e){return new Date(e).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})}static getStatusText(e){return{scheduled:"🟡 مجدول",completed:"🟢 مكتمل",cancelled:"🔴 ملغي",no_show:"⚫ لم يحضر"}[e]||e}static getPaymentStatusText(e){return{completed:"🟢 مكتمل",partial:"🟡 جزئي",pending:"🔴 معلق"}[e]||e}static getTreatmentStatusText(e){return{planned:"🟡 مخطط",in_progress:"🔵 قيد التنفيذ",completed:"🟢 مكتمل",cancelled:"🔴 ملغي"}[e]||e}}const fx=Ne()(Lt((e,t)=>{if("undefined"!=typeof window){const e=()=>{console.log("🔄 Global Store: Data changed, refreshing alerts..."),t().loadAlerts()};["patient-added","patient-updated","patient-deleted","patient-changed","appointment-added","appointment-updated","appointment-deleted","appointment-changed","payment-added","payment-updated","payment-deleted","payment-changed","treatment-added","treatment-updated","treatment-deleted","treatment-changed","prescription-added","prescription-updated","prescription-deleted","prescription-changed","inventory-added","inventory-updated","inventory-deleted","inventory-changed"].forEach(t=>{window.addEventListener(t,e)})}return{globalSearchQuery:"",globalSearchResults:null,isSearching:!1,searchHistory:[],alerts:[],unreadAlertsCount:0,isLoadingAlerts:!1,quickAccessData:null,isLoadingQuickAccess:!1,recentActivities:[],quickActions:[],quickLinks:[],isGlobalLoading:!1,lastSyncTime:null,error:null,showGlobalSearch:!1,showQuickAccess:!0,showAlerts:!0,eventListenersSetup:!1,setGlobalSearchQuery:t=>{e({globalSearchQuery:t})},performGlobalSearch:n=>m(void 0,null,function*(){e({isSearching:!0,error:null});try{const a=Date.now(),s=yield gx.performGlobalSearch(n),r=Date.now()-a;e({globalSearchResults:d(o({},s),{searchTime:r,query:n.query}),isSearching:!1}),n.query.trim()&&t().addToSearchHistory(n.query.trim())}catch(a){console.error("Global search error:",a),e({error:a instanceof Error?a.message:"فشل في البحث الشامل",isSearching:!1})}}),clearSearchResults:()=>{e({globalSearchResults:null,globalSearchQuery:""})},addToSearchHistory:n=>{const{searchHistory:a}=t(),s=[n,...a.filter(e=>e!==n)].slice(0,10);e({searchHistory:s})},clearSearchHistory:()=>{e({searchHistory:[]})},loadAlerts:()=>m(void 0,null,function*(){e({isLoadingAlerts:!0,error:null});try{const t=yield Ho.getAllAlerts(),n=t.filter(e=>!e.isRead&&!e.isDismissed).length;console.log("📊 Loaded alerts:",t.length,"unread:",n),console.log("📋 Alert details:",t.map(e=>({id:e.id,title:e.title,isRead:e.isRead,isDismissed:e.isDismissed}))),e({alerts:t,unreadAlertsCount:n,isLoadingAlerts:!1})}catch(t){console.error("Load alerts error:",t),e({error:t instanceof Error?t.message:"فشل في تحميل التنبيهات",isLoadingAlerts:!1,alerts:[],unreadAlertsCount:0})}}),markAlertAsRead:e=>m(void 0,null,function*(){try{console.log("🏪 GlobalStore: markAlertAsRead called for:",e);const n=t().alerts.find(t=>t.id===e);if(!n)return void console.warn("⚠️ Alert not found in store:",e);console.log("📋 Current alert state:",{id:n.id,title:n.title,isRead:n.isRead}),console.log("🔄 Calling SmartAlertsService.updateAlert..."),yield Ho.updateAlert(e,{isRead:!0}),console.log("✅ SmartAlertsService.updateAlert completed")}catch(n){throw console.error("❌ Mark alert as read error:",n),n}}),dismissAlert:e=>m(void 0,null,function*(){try{yield Ho.updateAlert(e,{isDismissed:!0})}catch(t){console.error("Dismiss alert error:",t)}}),snoozeAlert:(e,t)=>m(void 0,null,function*(){try{yield Ho.updateAlert(e,{snoozeUntil:t})}catch(n){console.error("Snooze alert error:",n)}}),createAlert:e=>m(void 0,null,function*(){try{yield Ho.createAlert(e)}catch(t){console.error("Create alert error:",t)}}),loadQuickAccessData:()=>m(void 0,null,function*(){e({isLoadingQuickAccess:!0,error:null});try{const t=yield xx.getQuickAccessData();e({quickAccessData:t,isLoadingQuickAccess:!1})}catch(t){console.error("Load quick access data error:",t),e({error:t instanceof Error?t.message:"فشل في تحميل بيانات الوصول السريع",isLoadingQuickAccess:!1})}}),refreshQuickAccessData:()=>m(void 0,null,function*(){yield t().loadQuickAccessData()}),addActivity:n=>{const{recentActivities:a}=t(),s=[d(o({},n),{id:`activity_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:(new Date).toISOString()}),...a].slice(0,50);e({recentActivities:s})},loadRecentActivities:()=>m(void 0,null,function*(){var t,n,a;try{const s=(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.activities)?void 0:n.getRecent)?void 0:a.call(n))||[];e({recentActivities:s})}catch(s){console.error("Load recent activities error:",s)}}),executeQuickAction:e=>{const{quickActions:n}=t(),a=n.find(t=>t.id===e);a&&a.action()},addQuickAction:n=>{const{quickActions:a}=t();e({quickActions:[...a,n]})},removeQuickAction:n=>{const{quickActions:a}=t();e({quickActions:a.filter(e=>e.id!==n)})},syncAllData:()=>m(void 0,null,function*(){e({isGlobalLoading:!0});try{yield Promise.all([t().loadAlerts(),t().loadQuickAccessData(),t().loadRecentActivities()]),e({lastSyncTime:(new Date).toISOString(),isGlobalLoading:!1})}catch(n){console.error("Sync all data error:",n),e({error:n instanceof Error?n.message:"Sync failed",isGlobalLoading:!1})}}),clearError:()=>{e({error:null})},toggleGlobalSearch:()=>{e(e=>({showGlobalSearch:!e.showGlobalSearch}))},toggleQuickAccess:()=>{e(e=>({showQuickAccess:!e.showQuickAccess}))},toggleAlerts:()=>{e(e=>({showAlerts:!e.showAlerts}))}}},{name:"globalThis-store"}));function vx({onResultSelect:e,onClose:t,autoFocus:n=!0,placeholder:a="🔍 ابحث في المرضى، المواعيد، الدفعات، العلاجات... (F)"}){const{globalSearchQuery:s,globalSearchResults:r,isSearching:i,searchHistory:l,setGlobalSearchQuery:o,performGlobalSearch:d,clearSearchResults:c,addToSearchHistory:u}=fx(),[h,x]=ve.useState(!1),[g,f]=ve.useState(-1),v=ve.useRef(null),y=ve.useRef(null),b=ve.useRef(null);ve.useEffect(()=>{n&&v.current&&v.current.focus()},[n]),ve.useEffect(()=>{const e=e=>{b.current&&!b.current.contains(e.target)&&N()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const j=e=>m(this,null,function*(){if(o(e),e.trim().length>0){const n={query:e.trim(),sortBy:"relevance",sortOrder:"desc",limit:20};try{yield d(n),x(!0),f(-1),console.log("🔍 Search performed:",e.trim()),console.log("🔍 Search results:",r)}catch(t){console.error("Search error:",t),x(!0)}}else x(!1),c()});ve.useEffect(()=>{const e=setTimeout(()=>{s&&j(s)},300);return()=>clearTimeout(e)},[s]);const w=t=>{u(s),null==e||e(t),N()},N=()=>{x(!1),c(),o(""),null==t||t()},_=e=>{switch(e){case"patient":return p.jsx(Ai,{className:"w-4 h-4 text-blue-500"});case"appointment":return p.jsx(hr,{className:"w-4 h-4 text-purple-500"});case"payment":return p.jsx(Er,{className:"w-4 h-4 text-green-500"});case"treatment":return p.jsx(nr,{className:"w-4 h-4 text-red-500"});case"prescription":return p.jsx(Pr,{className:"w-4 h-4 text-orange-500"});default:return p.jsx(hi,{className:"w-4 h-4 text-gray-500"})}},k=e=>{switch(e){case"patient":return"مريض";case"appointment":return"موعد";case"payment":return"دفعة";case"treatment":return"علاج";case"prescription":return"وصفة";default:return e}},S=(e,t,n)=>0===t.length?null:p.jsxs("div",{children:[p.jsx("div",{className:"px-3 py-2 bg-muted/50",children:p.jsxs("h3",{className:"text-sm font-medium text-muted-foreground",children:[e," (",t.length,")"]})}),t.map((e,t)=>((e,t)=>p.jsx("div",{className:"p-3 cursor-pointer border-r-2 transition-colors "+(g===t?"bg-accent border-r-primary":"hover:bg-muted border-r-transparent"),onClick:()=>w(e),children:p.jsxs("div",{className:"flex items-start gap-3",dir:"rtl",children:[_(e.type),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsx("h4",{className:"font-medium text-sm truncate",children:e.title}),p.jsx(qo,{variant:"outline",className:"text-xs",children:k(e.type)})]}),p.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:e.subtitle}),e.description&&p.jsx("p",{className:"text-xs text-muted-foreground",children:e.description})]}),p.jsx(ir,{className:"w-4 h-4 text-muted-foreground"})]})},e.id))(e,n+t))]});return p.jsxs("div",{ref:b,className:"relative w-full max-w-2xl mx-auto",children:[p.jsxs("div",{className:"relative",children:[p.jsx(hi,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{ref:v,value:s,onChange:e=>o(e.target.value),onKeyDown:e=>{if(!r||!h)return;const t=[...r.patients,...r.appointments,...r.payments,...r.treatments,...r.prescriptions];switch(e.key){case"ArrowDown":e.preventDefault(),f(e=>e<t.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),f(e=>e>0?e-1:-1);break;case"Enter":e.preventDefault(),g>=0&&t[g]&&w(t[g]);break;case"Escape":e.preventDefault(),N()}},placeholder:a,className:"pr-10 pl-10 h-12 text-base",dir:"rtl"}),s&&p.jsx(Qi,{variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",onClick:N,children:p.jsx(Mi,{className:"w-4 h-4"})}),i&&p.jsx("div",{className:"absolute left-10 top-1/2 transform -translate-y-1/2",children:p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})})]}),h&&r&&p.jsx(Lo,{className:"absolute top-full mt-2 w-full max-h-96 overflow-hidden shadow-lg z-50",children:p.jsx(Yo,{className:"p-0",children:r.totalCount>0?p.jsxs("div",{ref:y,className:"max-h-96 overflow-y-auto",children:[p.jsx("div",{className:"px-3 py-2 bg-primary/5 border-b",children:p.jsxs("div",{className:"flex items-center justify-between text-sm",children:[p.jsxs("span",{className:"text-muted-foreground",children:[r.totalCount," نتيجة في ",r.searchTime,"ms"]}),p.jsxs("span",{className:"text-muted-foreground",children:['"',r.query,'"']})]})}),S("المرضى",r.patients,0),r.patients.length>0&&r.appointments.length>0&&p.jsx(ux,{}),S("المواعيد",r.appointments,r.patients.length),(r.patients.length>0||r.appointments.length>0)&&r.payments.length>0&&p.jsx(ux,{}),S("الدفعات",r.payments,r.patients.length+r.appointments.length),(r.patients.length>0||r.appointments.length>0||r.payments.length>0)&&r.treatments.length>0&&p.jsx(ux,{}),S("العلاجات",r.treatments,r.patients.length+r.appointments.length+r.payments.length),(r.patients.length>0||r.appointments.length>0||r.payments.length>0||r.treatments.length>0)&&r.prescriptions.length>0&&p.jsx(ux,{}),S("الوصفات",r.prescriptions,r.patients.length+r.appointments.length+r.payments.length+r.treatments.length)]}):p.jsxs("div",{className:"p-6 text-center text-muted-foreground",children:[p.jsx(hi,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),p.jsxs("p",{children:['لا توجد نتائج للبحث "',s,'"']}),l.length>0&&p.jsxs("div",{className:"mt-4",children:[p.jsx("p",{className:"text-xs mb-2",children:"عمليات البحث الأخيرة:"}),p.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:l.slice(0,5).map((e,t)=>p.jsx(qo,{variant:"outline",className:"cursor-pointer text-xs",onClick:()=>o(e),children:e},t))})]})]})})})]})}function yx(e){try{if(!e)return"غير محدد";const t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"تاريخ غير صحيح";const n=new Date,a=Math.floor((n.getTime()-t.getTime())/1e3);if(a<60)return"منذ لحظات";if(a<3600){return`منذ ${Math.floor(a/60)} دقيقة`}if(a<86400){return`منذ ${Math.floor(a/3600)} ساعة`}if(a<2592e3){return`منذ ${Math.floor(a/86400)} يوم`}return`منذ ${Math.floor(a/2592e3)} شهر`}catch(t){return console.error("Error formatting time distance:",t),"خطأ في التاريخ"}}function bx(e){try{if(!e)return"--";const t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"--";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${n}/${a}/${t.getFullYear()}`}catch(t){return console.error("Error formatting date:",t),"--"}}function jx({maxVisible:e=5,showHeader:t=!0,compact:n=!1,onAlertClick:a,showReadAlerts:s=!1}){const{alerts:r,unreadAlertsCount:i,isLoadingAlerts:l,loadAlerts:o,markAlertAsRead:d}=fx();!function(){const{loadAlerts:e}=fx(),t=ve.useRef(new Map),n=ve.useRef(null),a=ve.useCallback(()=>{console.log("🔄 useRealTimeAlerts: refreshAlerts triggered"),n.current&&(console.log("🔄 useRealTimeAlerts: Clearing previous timeout"),clearTimeout(n.current)),n.current=setTimeout(()=>{console.log("🔄 useRealTimeAlerts: Executing loadAlerts..."),e(),n.current=null},300)},[e]);ve.useEffect(()=>{console.log("🔔 Setting up real-time alerts listeners...");const e=e=>m(this,null,function*(){var t;const n=(null==e?void 0:e.type)||(null==(t=null==e?void 0:e.detail)?void 0:t.event)||"unknown";console.log("📡 Data changed, refreshing alerts...",n),a()}),s=e=>{console.log("🔔 Alerts changed event received:",(null==e?void 0:e.detail)||"no details"),a()},r=e=>{const t=(null==e?void 0:e.detail)||e;console.log("🔔 useRealTimeAlerts: Alert updated event received:",t),console.log("🔄 useRealTimeAlerts: Triggering refreshAlerts..."),a()},i=e=>{const t=(null==e?void 0:e.detail)||e;console.log("🔔 Alert created event received:",t),a()},l=e=>{const t=(null==e?void 0:e.detail)||e;console.log("🔔 Alert deleted event received:",t),a()};t.current.set("handleDataChanged",e),t.current.set("handleAlertsChanged",s),t.current.set("handleAlertUpdated",r),t.current.set("handleAlertCreated",i),t.current.set("handleAlertDeleted",l),Ho.addEventListener("alerts:changed",s),Ho.addEventListener("alert:updated",r),Ho.addEventListener("alert:created",i),Ho.addEventListener("alert:deleted",l),window.addEventListener("alerts:alerts:changed",s),window.addEventListener("alerts:alert:updated",e=>r(e.detail)),window.addEventListener("alerts:alert:created",e=>i(e.detail)),window.addEventListener("alerts:alert:deleted",e=>l(e.detail));const o=["patient-added","patient-updated","patient-deleted","patient-changed","appointment-added","appointment-updated","appointment-deleted","appointment-changed","payment-added","payment-updated","payment-deleted","payment-changed","treatment-added","treatment-updated","treatment-deleted","treatment-changed","prescription-added","prescription-updated","prescription-deleted","prescription-changed","inventory-added","inventory-updated","inventory-deleted","inventory-changed"];return o.forEach(t=>{window.addEventListener(t,e)}),()=>{console.log("🔔 Cleaning up real-time alerts listeners..."),n.current&&(clearTimeout(n.current),n.current=null);const e=t.current;if(e.has("handleAlertsChanged")&&Ho.removeEventListener("alerts:changed",e.get("handleAlertsChanged")),e.has("handleAlertUpdated")&&Ho.removeEventListener("alert:updated",e.get("handleAlertUpdated")),e.has("handleAlertCreated")&&Ho.removeEventListener("alert:created",e.get("handleAlertCreated")),e.has("handleAlertDeleted")&&Ho.removeEventListener("alert:deleted",e.get("handleAlertDeleted")),e.has("handleAlertsChanged")&&window.removeEventListener("alerts:alerts:changed",e.get("handleAlertsChanged")),e.has("handleAlertUpdated")){const t=e.get("handleAlertUpdated");window.removeEventListener("alerts:alert:updated",e=>t(e.detail))}if(e.has("handleAlertCreated")){const t=e.get("handleAlertCreated");window.removeEventListener("alerts:alert:created",e=>t(e.detail))}if(e.has("handleAlertDeleted")){const t=e.get("handleAlertDeleted");window.removeEventListener("alerts:alert:deleted",e=>t(e.detail))}if(e.has("handleDataChanged")){const t=e.get("handleDataChanged");o.forEach(e=>{window.removeEventListener(e,t)})}t.current.clear()}},[a])}();const{isDarkMode:c}=Gt(),{toast:u}=yl(),[h,x]=ve.useState(s);ve.useEffect(()=>{console.log("🔔 SmartAlerts: Initial load"),o();const e=setInterval(()=>{console.log("🔄 SmartAlerts: Periodic refresh (every minute)"),o()},6e4);return()=>{clearInterval(e)}},[o]),ve.useEffect(()=>{x(s)},[s]);const g=r.filter(e=>!e.isDismissed).filter(e=>{if(e.snoozeUntil){return new Date(e.snoozeUntil)<=new Date}return!0}).filter(e=>!!h||!e.isRead).slice(0,e),f=r.filter(e=>e.isRead&&!e.isDismissed).length,v=r.filter(e=>!e.isDismissed).length,y=e=>{switch(e.type){case"appointment":return p.jsx(hr,{className:"w-4 h-4"});case"payment":return p.jsx(Er,{className:"w-4 h-4"});case"treatment":return p.jsx(nr,{className:"w-4 h-4"});case"prescription":return p.jsx(li,{className:"w-4 h-4"});case"follow_up":return p.jsx($i,{className:"w-4 h-4"});case"lab_order":return p.jsx(Pr,{className:"w-4 h-4"});case"inventory":return p.jsx(ti,{className:"w-4 h-4"});default:return p.jsx(cr,{className:"w-4 h-4"})}},b=e=>{switch(e){case"high":return c?"text-red-400 bg-red-900/20 border-red-800/50":"text-red-500 bg-red-50 border-red-200";case"medium":return c?"text-yellow-400 bg-yellow-900/20 border-yellow-800/50":"text-yellow-500 bg-yellow-50 border-yellow-200";case"low":return c?"text-blue-400 bg-blue-900/20 border-blue-800/50":"text-blue-500 bg-blue-50 border-blue-200";default:return c?"text-gray-400 bg-gray-900/20 border-gray-800/50":"text-gray-500 bg-gray-50 border-gray-200"}},j=e=>{switch(e){case"high":return"عاجل";case"medium":return"متوسط";case"low":return"منخفض";default:return e}},w=e=>m(this,null,function*(){e.isRead||(yield d(e.id)),console.log("🔔 Alert clicked:",{title:e.title,description:e.description,type:e.type,priority:e.priority,patientName:e.patientName,relatedData:e.relatedData}),null==a||a(e)}),N=(e,t)=>m(this,null,function*(){t.stopPropagation(),console.log("🔔 Mark as read button clicked for alert:",e);try{console.log("🔄 Calling markAlertAsRead..."),yield d(e),console.log("✅ markAlertAsRead completed successfully"),console.log("📡 Real-time system will handle the update automatically"),u({title:"✅ تم التحديث",description:"تم تحديد الإشعار كمقروء",duration:2e3})}catch(n){console.error("❌ Error marking alert as read:",n),u({title:"❌ خطأ",description:"فشل في تحديث الإشعار",variant:"destructive"})}});return l?p.jsxs(Lo,{className:n?"shadow-sm":"",children:[t&&p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"text-lg flex items-center gap-2",children:[p.jsx(cr,{className:"w-5 h-5"}),"التنبيهات الذكية"]})}),p.jsx(Yo,{children:p.jsx("div",{className:"flex items-center justify-center py-8",children:p.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})})]}):p.jsxs(Lo,{className:n?"shadow-sm":"",children:[t&&p.jsxs(Io,{className:"pb-3",children:[p.jsxs(zo,{className:"text-lg flex items-center gap-2",children:[p.jsx(cr,{className:"w-5 h-5"}),"التنبيهات الذكية",i>0&&p.jsx(qo,{variant:"destructive",className:"text-xs",children:i})]}),p.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["المجموع: ",v," | غير مقروءة: ",i," | مقروءة: ",f]})]}),p.jsx(Yo,{className:t?"":"pt-6",children:0===g.length?p.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[p.jsx(gr,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),p.jsx("p",{className:"text-sm",children:h?0===v?"لا توجد تنبيهات":"لا توجد تنبيهات في هذا العرض":"لا توجد تنبيهات غير مقروءة"}),!h&&f>0&&p.jsxs("p",{className:"text-xs mt-1",children:["يوجد ",f,' تنبيه مقروء - اضغط "عرض المقروءة" لرؤيتها']})]}):p.jsx("div",{className:"space-y-3",children:g.map((e,t)=>p.jsxs("div",{children:[p.jsx("div",{className:"p-3 rounded-lg border cursor-pointer transition-all duration-200 "+(e.isRead?c?"bg-muted/10 border-muted/30 hover:bg-muted/20 hover:border-muted/50":"bg-muted/20 border-muted/40 hover:bg-muted/30 hover:border-muted/60":c?`${b(e.priority)} hover:opacity-90 hover:shadow-md`:`${b(e.priority)} hover:opacity-85 hover:shadow-lg`),onClick:()=>w(e),children:p.jsxs("div",{className:"flex items-start gap-3",dir:"rtl",children:[p.jsx("div",{className:"p-2 rounded-full "+(c?`${b(e.priority)} bg-opacity-20 border border-current border-opacity-30`:`${b(e.priority)} bg-opacity-10 border border-current border-opacity-20`),children:y(e)}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsx("h4",{className:"font-medium text-sm truncate",children:e.title}),p.jsx(qo,{variant:"outline",className:"text-xs",children:j(e.priority)}),!e.isRead&&p.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"})]}),p.jsx("p",{className:"text-xs text-muted-foreground mb-2 line-clamp-2",children:e.description}),e.patientName&&p.jsxs("p",{className:"text-xs font-medium text-primary mb-2",children:["👤 ",e.patientName]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-xs text-muted-foreground",children:yx(e.createdAt)}),e.dueDate&&p.jsxs("span",{className:"text-xs text-muted-foreground",children:["📅 ",bx(e.dueDate)]})]}),!e.isRead&&p.jsx("div",{className:"mt-2",children:p.jsxs(Qi,{size:"sm",variant:"outline",className:"h-6 text-xs",onClick:t=>N(e.id,t),children:[p.jsx(gr,{className:"w-3 h-3 mr-1"}),"تحديد كمقروء"]})})]})]})}),t<g.length-1&&p.jsx(ux,{className:"my-2 "+(c?"bg-muted/30":"")})]},e.id))})})]})}function wx({shortcut:e,className:t,size:n="sm",showArabic:a=!0,arabicKey:s}){return null}function Nx({children:e,shortcut:t,description:n}){return p.jsx(p.Fragment,{children:e})}function _x({onNavigateToPatients:e,onNavigateToAppointments:t,onNavigateToPayments:n,onNavigateToTreatments:a,onAddPatient:s,onAddAppointment:r,onAddPayment:i}){const{quickAccessData:l,isLoadingQuickAccess:o,loadQuickAccessData:d,refreshQuickAccessData:c}=fx();ve.useEffect(()=>{d()},[d]);const u=()=>m(this,null,function*(){yield c()}),{formatAmount:h}=Sa();return o?p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((e,t)=>p.jsx(Lo,{className:"animate-pulse",children:p.jsx(Yo,{className:"pt-6",children:p.jsx("div",{className:"h-20 bg-muted rounded"})})},t))}):l?p.jsxs("div",{className:"space-y-6 rtl-layout",children:[p.jsxs("div",{className:"dashboard-grid-rtl",children:[p.jsx(Lo,{className:"hover:shadow-md transition-shadow cursor-pointer stats-card-rtl",onClick:e,children:p.jsx(Yo,{className:"pt-6 stats-content",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"إجمالي المرضى"}),p.jsx("p",{className:"text-2xl font-bold",children:l.quickStats.totalPatients})]}),p.jsx("div",{className:"p-2 bg-blue-100 rounded-lg stats-icon",children:p.jsx(Fi,{className:"w-6 h-6 text-blue-600"})})]})})}),p.jsx(Lo,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:t,children:p.jsx(Yo,{className:"pt-6",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"مواعيد اليوم"}),p.jsx("p",{className:"text-2xl font-bold",children:l.quickStats.todayAppointments})]}),p.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:p.jsx(hr,{className:"w-6 h-6 text-purple-600"})})]})})}),p.jsx(Lo,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:n,children:p.jsx(Yo,{className:"pt-6",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"دفعات معلقة"}),p.jsx("p",{className:"text-2xl font-bold",children:l.quickStats.pendingPayments})]}),p.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:p.jsx(Er,{className:"w-6 h-6 text-yellow-600"})})]})})}),p.jsx(Lo,{className:"hover:shadow-md transition-shadow",children:p.jsx(Yo,{className:"pt-6",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"تنبيهات عاجلة"}),p.jsx("p",{className:"text-2xl font-bold",children:l.quickStats.urgentAlerts})]}),p.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:p.jsx(sr,{className:"w-6 h-6 text-red-600"})})]})})})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(di,{className:"w-5 h-5"}),"إجراءات سريعة"]})}),p.jsx(Yo,{children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsx(Nx,{shortcut:"A",description:"إضافة مريض جديد",children:p.jsxs(Qi,{onClick:()=>{console.log("🏥 Add Patient button clicked!"),null==s||s()},className:"h-12 justify-between hover:shadow-lg transition-all duration-200 active:scale-95",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx(Fi,{className:"w-4 h-4 mr-2"}),"إضافة مريض جديد"]}),p.jsx(wx,{shortcut:"A",size:"sm"})]})}),p.jsx(Nx,{shortcut:"S",description:"حجز موعد جديد",children:p.jsxs(Qi,{onClick:()=>{console.log("📅 Add Appointment button clicked!"),null==r||r()},variant:"outline",className:"h-12 justify-between hover:shadow-lg transition-all duration-200 active:scale-95",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx(hr,{className:"w-4 h-4 mr-2"}),"حجز موعد جديد"]}),p.jsx(wx,{shortcut:"S",size:"sm"})]})}),p.jsx(Nx,{shortcut:"D",description:"تسجيل دفعة جديدة",children:p.jsxs(Qi,{onClick:()=>{console.log("💰 Add Payment button clicked!"),null==i||i()},variant:"outline",className:"h-12 justify-between hover:shadow-lg transition-all duration-200 active:scale-95",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx(Er,{className:"w-4 h-4 mr-2"}),"تسجيل دفعة جديدة"]}),p.jsx(wx,{shortcut:"D",size:"sm"})]})})]})})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(Fi,{className:"w-5 h-5"}),"المرضى الأخيرون"]}),p.jsxs(Qi,{variant:"ghost",size:"sm",onClick:()=>{console.log("👥 Navigate to Patients clicked!"),null==e||e()},className:"hover:bg-blue-50 hover:text-blue-600 transition-colors",children:[p.jsx(Fr,{className:"w-4 h-4 mr-1"}),"عرض الكل"]})]})}),p.jsx(Yo,{children:0===l.recentPatients.length?p.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[p.jsx(Fi,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),p.jsx("p",{className:"text-sm",children:"لا توجد مرضى حديثون"})]}):p.jsx("div",{className:"space-y-3",children:l.recentPatients.map(e=>p.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:p.jsx(Fi,{className:"w-4 h-4 text-blue-600"})}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium text-sm",children:e.full_name}),p.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",e.serial_number," | ",e.age," سنة"]})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(qo,{variant:"outline",className:"text-xs",children:"male"===e.gender?"ذكر":"أنثى"}),p.jsx(Qi,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:p.jsx(Fr,{className:"w-3 h-3"})})]})]},e.id))})})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(hr,{className:"w-5 h-5"}),"مواعيد اليوم"]}),p.jsxs(Qi,{variant:"ghost",size:"sm",onClick:()=>{console.log("📅 Navigate to Appointments clicked!"),null==t||t()},className:"hover:bg-blue-50 hover:text-blue-600 transition-colors",children:[p.jsx(Fr,{className:"w-4 h-4 mr-1"}),"عرض الكل"]})]})}),p.jsx(Yo,{children:0===l.todayAppointments.length?p.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[p.jsx(hr,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),p.jsx("p",{className:"text-sm",children:"لا توجد مواعيد اليوم"})]}):p.jsx("div",{className:"space-y-3",children:l.todayAppointments.slice(0,5).map(e=>{var t,n;return p.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:p.jsx(hr,{className:"w-4 h-4 text-purple-600"})}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium text-sm",children:e.title}),p.jsx("p",{className:"text-xs text-muted-foreground",children:(null==(t=e.patient)?void 0:t.full_name)||"مريض غير محدد"})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(qo,{variant:"outline",className:"text-xs",children:(n=e.start_time,new Date(n).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"}))}),p.jsx(Qi,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:p.jsx(Fr,{className:"w-3 h-3"})})]})]},e.id)})})})]})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(Er,{className:"w-5 h-5"}),"الدفعات المعلقة"]}),p.jsxs(Qi,{variant:"ghost",size:"sm",onClick:()=>{console.log("💰 Navigate to Payments clicked!"),null==n||n()},className:"hover:bg-blue-50 hover:text-blue-600 transition-colors",children:[p.jsx(Fr,{className:"w-4 h-4 mr-1"}),"عرض الكل"]})]})}),p.jsx(Yo,{children:0===l.pendingPayments.length?p.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[p.jsx(Er,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),p.jsx("p",{className:"text-sm",children:"لا توجد دفعات معلقة"})]}):p.jsx("div",{className:"space-y-3",children:l.pendingPayments.slice(0,5).map(e=>{var t,n;return p.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center",children:p.jsx(Er,{className:"w-4 h-4 text-yellow-600"})}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium text-sm",children:(null==(t=e.patient)?void 0:t.full_name)||"مريض غير محدد"}),p.jsx("p",{className:"text-xs text-muted-foreground",children:(n=e.payment_date,new Date(n).toLocaleDateString("ar-EG"))})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(qo,{variant:"destructive",className:"text-xs",children:h(e.total_amount_due||e.remaining_balance||e.amount||0)}),p.jsx(Qi,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:p.jsx(Fr,{className:"w-3 h-3"})})]})]},e.id)})})})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(nr,{className:"w-5 h-5"}),"العلاجات العاجلة"]}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:a,children:"عرض الكل"})]})}),p.jsx(Yo,{children:0===l.urgentTreatments.length?p.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[p.jsx(nr,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),p.jsx("p",{className:"text-sm",children:"لا توجد علاجات عاجلة"})]}):p.jsx("div",{className:"space-y-3",children:l.urgentTreatments.slice(0,5).map(e=>{var t;return p.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:p.jsx(nr,{className:"w-4 h-4 text-red-600"})}),p.jsxs("div",{children:[p.jsxs("p",{className:"font-medium text-sm",children:[e.treatment_type," - السن ",e.tooth_number]}),p.jsx("p",{className:"text-xs text-muted-foreground",children:(null==(t=e.patient)?void 0:t.full_name)||"مريض غير محدد"})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(qo,{variant:"outline",className:"text-xs",children:"planned"===e.treatment_status?"مخطط":"قيد التنفيذ"}),p.jsx(Qi,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:p.jsx(Fr,{className:"w-3 h-3"})})]})]},e.id)})})})]})]})]}):p.jsx(Lo,{children:p.jsx(Yo,{className:"pt-6",children:p.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[p.jsx(sr,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),p.jsx("p",{children:"فشل في تحميل بيانات الوصول السريع"}),p.jsxs(Qi,{variant:"outline",size:"sm",className:"mt-2",onClick:u,children:[p.jsx(mi,{className:"w-4 h-4 mr-2"}),"إعادة المحاولة"]})]})})})}function kx({onNavigateToPatients:e,onNavigateToAppointments:t,onNavigateToPayments:n,onNavigateToTreatments:a,onAddPatient:s,onAddAppointment:r,onAddPayment:i}){const[l,o]=ve.useState("overview"),[d,c]=ve.useState(!1),{syncAllData:u,isGlobalLoading:h,lastSyncTime:x,unreadAlertsCount:g}=fx();qt();const f=Ud();ve.useEffect(()=>{u()},[u]),ve.useEffect(()=>{const e=e=>{if(e.ctrlKey)return;const t=e.target;if("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||"number"===t.getAttribute("type")||t.closest('[data-prevent-shortcuts="true"]'))return;if("Escape"===e.key&&c(!1),["1","2","3","4"].includes(e.key)){e.preventDefault();const t=["overview","quick-access","alerts","analytics"],n=parseInt(e.key)-1;t[n]&&o(t[n])}const n=$a(e);"a"===n.mappedKey.toLowerCase()?(n.preventDefault(),null==s||s()):"s"===n.mappedKey.toLowerCase()?(n.preventDefault(),null==r||r()):"d"===n.mappedKey.toLowerCase()&&(n.preventDefault(),null==i||i()),"r"===n.mappedKey.toLowerCase()&&(n.preventDefault(),u()),"f"===n.mappedKey.toLowerCase()&&(n.preventDefault(),c(!0)),"r"===n.mappedKey.toLowerCase()&&(n.preventDefault(),u())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[u,s,r,i]);const v=a=>{var s,r,i,l;console.log("Alert clicked:",a),"appointment"===a.type?((null==(s=a.context)?void 0:s.includes("upcoming"))||(null==(r=a.context)?void 0:r.includes("today")))&&(null==t||t()):"payment"===a.type?((null==(i=a.context)?void 0:i.includes("overdue"))||(null==(l=a.context)?void 0:l.includes("pending")))&&(null==n||n()):"patient"===a.type?null==e||e():"inventory"===a.type&&console.log("Navigate to inventory for:",a.title),o("alerts")};ve.useEffect(()=>{const e=e=>{"f"!==e.key&&"F"!==e.key&&"ب"!==e.key||e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),c(!0)),"Escape"===e.key&&d&&c(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d]);return p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("div",{className:"flex items-center gap-3 mb-2",children:p.jsxs("h1",{className:"text-3xl font-bold text-foreground",children:["مرحباً بك في ",f]})}),p.jsx("p",{className:"text-muted-foreground",children:"نظام إدارة سريع ومتكامل - تحديث تلقائي في الوقت الفعلي"}),x&&p.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["آخر تحديث: ",new Date(x).toLocaleString("ar-EG")]})]}),p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsxs(Qi,{variant:"outline",onClick:()=>c(!d),className:"relative",children:[p.jsx(hi,{className:"w-4 h-4 mr-2"}),"بحث شامل",p.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(F)"})]}),p.jsxs(Qi,{variant:"outline",onClick:()=>o("alerts"),className:"relative",children:[p.jsx(cr,{className:"w-4 h-4 mr-2"}),"التنبيهات",g>0&&p.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:g})]}),p.jsxs(Qi,{variant:"outline",onClick:()=>m(this,null,function*(){yield u()}),disabled:h,children:[p.jsx(mi,{className:"w-4 h-4 mr-2 "+(h?"animate-spin":"")}),"تحديث"]})]})]}),d&&p.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-20",onClick:e=>{e.target===e.currentTarget&&c(!1)},children:p.jsx("div",{className:"w-full max-w-2xl mx-4",children:p.jsx(vx,{onResultSelect:s=>{var r;switch(console.log("Selected search result:",s),s.type){case"patient":localStorage.setItem("selectedPatientForDetails",JSON.stringify({patient:s.data,openDetailsModal:!0})),null==e||e();break;case"appointment":localStorage.setItem("selectedAppointmentForDetails",JSON.stringify({appointment:s.data,openDetailsModal:!0})),null==t||t();break;case"payment":localStorage.setItem("selectedPaymentForDetails",JSON.stringify({payment:s.data,openDetailsModal:!0})),null==n||n();break;case"treatment":localStorage.setItem("selectedTreatmentForDetails",JSON.stringify({treatment:s.data,patientId:null==(r=s.relatedData)?void 0:r.patientId,openDetailsModal:!0})),null==a||a();break;case"prescription":localStorage.setItem("selectedPrescriptionForDetails",JSON.stringify({prescription:s.data,openDetailsModal:!0})),null==a||a()}c(!1)},onClose:()=>c(!1),autoFocus:!0})})}),p.jsxs(iu,{value:l,onValueChange:o,className:"space-y-4",children:[p.jsxs(lu,{className:"grid w-full grid-cols-3",children:[p.jsxs(ou,{value:"overview",className:"flex items-center gap-2",children:[p.jsx(Ur,{className:"w-4 h-4"}),"نظرة عامة"]}),p.jsxs(ou,{value:"quick-access",className:"flex items-center gap-2",children:[p.jsx(Li,{className:"w-4 h-4"}),"الوصول السريع"]}),p.jsxs(ou,{value:"alerts",className:"flex items-center gap-2 relative",children:[p.jsx(cr,{className:"w-4 h-4"}),"التنبيهات",g>0&&p.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:g})]})]}),p.jsx(du,{value:"overview",className:"space-y-6",children:p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[p.jsx("div",{className:"lg:col-span-2",children:p.jsx(_x,{onNavigateToPatients:e,onNavigateToAppointments:t,onNavigateToPayments:n,onNavigateToTreatments:a,onAddPatient:s,onAddAppointment:r,onAddPayment:i})}),p.jsx("div",{className:"lg:col-span-1",children:p.jsx(jx,{maxVisible:8,showHeader:!0,compact:!1,onAlertClick:e=>{v(e)}})})]})}),p.jsx(du,{value:"quick-access",className:"space-y-6",children:p.jsx(_x,{onNavigateToPatients:e,onNavigateToAppointments:t,onNavigateToPayments:n,onNavigateToTreatments:a,onAddPatient:s,onAddAppointment:r,onAddPayment:i})}),p.jsx(du,{value:"alerts",className:"space-y-6",children:p.jsx(jx,{maxVisible:20,showHeader:!0,compact:!1,showReadAlerts:!0,onAlertClick:e=>{v(e)}})})]}),p.jsx(jc,{compact:!0})]})}var Sx=["Enter"," "],Dx=["ArrowUp","PageDown","End"],$x=["ArrowDown","PageUp","Home",...Dx],Cx={ltr:[...Sx,"ArrowRight"],rtl:[...Sx,"ArrowLeft"]},Ex={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Tx="Menu",[Ax,Fx,Px]=Z(Tx),[Ox,Rx]=M(Tx,[Px,J,Tc]),Mx=J(),Lx=Tc(),[Ix,zx]=Ox(Tx),[Bx,Yx]=Ox(Tx),Vx=e=>{const{__scopeMenu:t,open:n=!1,children:a,dir:s,onOpenChange:r,modal:i=!0}=e,l=Mx(t),[c,u]=ve.useState(null),m=ve.useRef(!1),h=U(r),x=Q(s);return ve.useEffect(()=>{const e=()=>{m.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>m.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),p.jsx(me,d(o({},l),{children:p.jsx(Ix,{scope:t,open:n,onOpenChange:h,content:c,onContentChange:u,children:p.jsx(Bx,{scope:t,onClose:ve.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:m,dir:x,modal:i,children:a})})}))};Vx.displayName=Tx;var qx=ve.forwardRef((e,t)=>{const n=e,{__scopeMenu:a}=n,s=c(n,["__scopeMenu"]),r=Mx(a);return p.jsx(ee,d(o(o({},r),s),{ref:t}))});qx.displayName="MenuAnchor";var Ux="MenuPortal",[Hx,Gx]=Ox(Ux,{forceMount:void 0}),Wx=e=>{const{__scopeMenu:t,forceMount:n,children:a,container:s}=e,r=zx(Ux,t);return p.jsx(Hx,{scope:t,forceMount:n,children:p.jsx(K,{present:n||r.open,children:p.jsx(ce,{asChild:!0,container:s,children:a})})})};Wx.displayName=Ux;var Kx="MenuContent",[Zx,Qx]=Ox(Kx),Xx=ve.forwardRef((e,t)=>{const n=Gx(Kx,e.__scopeMenu),a=e,{forceMount:s=n.forceMount}=a,r=c(a,["forceMount"]),i=zx(Kx,e.__scopeMenu),l=Yx(Kx,e.__scopeMenu);return p.jsx(Ax.Provider,{scope:e.__scopeMenu,children:p.jsx(K,{present:s||i.open,children:p.jsx(Ax.Slot,{scope:e.__scopeMenu,children:l.modal?p.jsx(Jx,d(o({},r),{ref:t})):p.jsx(eg,d(o({},r),{ref:t}))})})})}),Jx=ve.forwardRef((e,t)=>{const n=zx(Kx,e.__scopeMenu),a=ve.useRef(null),s=z(t,a);return ve.useEffect(()=>{const e=a.current;if(e)return te(e)},[]),p.jsx(ng,d(o({},e),{ref:s,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Y(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)}))}),eg=ve.forwardRef((e,t)=>{const n=zx(Kx,e.__scopeMenu);return p.jsx(ng,d(o({},e),{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)}))}),tg=ue("MenuContent.ScrollLock"),ng=ve.forwardRef((e,t)=>{const n=e,{__scopeMenu:a,loop:s=!1,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:l,disableOutsidePointerEvents:u,onEntryFocus:m,onEscapeKeyDown:h,onPointerDownOutside:x,onFocusOutside:g,onInteractOutside:f,onDismiss:v,disableOutsideScroll:y}=n,b=c(n,["__scopeMenu","loop","trapFocus","onOpenAutoFocus","onCloseAutoFocus","disableOutsidePointerEvents","onEntryFocus","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside","onDismiss","disableOutsideScroll"]),j=zx(Kx,a),w=Yx(Kx,a),N=Mx(a),_=Lx(a),k=Fx(a),[S,D]=ve.useState(null),$=ve.useRef(null),C=z(t,$,j.onContentChange),E=ve.useRef(0),T=ve.useRef(""),A=ve.useRef(0),F=ve.useRef(null),P=ve.useRef("right"),O=ve.useRef(0),R=y?oe:ve.Fragment,M=y?{as:tg,allowPinchZoom:!0}:void 0,L=e=>{var t,n;const a=T.current+e,s=k().filter(e=>!e.disabled),r=document.activeElement,i=null==(t=s.find(e=>e.ref.current===r))?void 0:t.textValue,l=function(e,t,n){const a=t.length>1&&Array.from(t).every(e=>e===t[0]),s=a?t[0]:t,r=n?e.indexOf(n):-1;let i=(l=e,o=Math.max(r,0),l.map((e,t)=>l[(o+t)%l.length]));var l,o;1===s.length&&(i=i.filter(e=>e!==n));const d=i.find(e=>e.toLowerCase().startsWith(s.toLowerCase()));return d!==n?d:void 0}(s.map(e=>e.textValue),a,i),o=null==(n=s.find(e=>e.textValue===l))?void 0:n.ref.current;!function e(t){T.current=t,window.clearTimeout(E.current),""!==t&&(E.current=window.setTimeout(()=>e(""),1e3))}(a),o&&setTimeout(()=>o.focus())};ve.useEffect(()=>()=>window.clearTimeout(E.current),[]),ne();const I=ve.useCallback(e=>{var t,n;return P.current===(null==(t=F.current)?void 0:t.side)&&function(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return function(e,t){const{x:n,y:a}=e;let s=!1;for(let r=0,i=t.length-1;r<t.length;i=r++){const e=t[r],l=t[i],o=e.x,d=e.y,c=l.x,u=l.y;d>a!=u>a&&n<(c-o)*(a-d)/(u-d)+o&&(s=!s)}return s}(n,t)}(e,null==(n=F.current)?void 0:n.area)},[]);return p.jsx(Zx,{scope:a,searchRef:T,onItemEnter:ve.useCallback(e=>{I(e)&&e.preventDefault()},[I]),onItemLeave:ve.useCallback(e=>{var t;I(e)||(null==(t=$.current)||t.focus(),D(null))},[I]),onTriggerLeave:ve.useCallback(e=>{I(e)&&e.preventDefault()},[I]),pointerGraceTimerRef:A,onPointerGraceIntentChange:ve.useCallback(e=>{F.current=e},[]),children:p.jsx(R,d(o({},M),{children:p.jsx(ae,{asChild:!0,trapped:r,onMountAutoFocus:Y(i,e=>{var t;e.preventDefault(),null==(t=$.current)||t.focus({preventScroll:!0})}),onUnmountAutoFocus:l,children:p.jsx(se,{asChild:!0,disableOutsidePointerEvents:u,onEscapeKeyDown:h,onPointerDownOutside:x,onFocusOutside:g,onInteractOutside:f,onDismiss:v,children:p.jsx(zc,d(o({asChild:!0},_),{dir:w.dir,orientation:"vertical",loop:s,currentTabStopId:S,onCurrentTabStopIdChange:D,onEntryFocus:Y(m,e=>{w.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:p.jsx(re,d(o(o({role:"menu","aria-orientation":"vertical","data-state":$g(j.open),"data-radix-menu-content":"",dir:w.dir},N),b),{ref:C,style:o({outline:"none"},b.style),onKeyDown:Y(b.onKeyDown,e=>{const t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,a=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&a&&L(e.key));const s=$.current;if(e.target!==s)return;if(!$x.includes(e.key))return;e.preventDefault();const r=k().filter(e=>!e.disabled).map(e=>e.ref.current);Dx.includes(e.key)&&r.reverse(),function(e){const t=document.activeElement;for(const n of e){if(n===t)return;if(n.focus(),document.activeElement!==t)return}}(r)}),onBlur:Y(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(E.current),T.current="")}),onPointerMove:Y(e.onPointerMove,Tg(e=>{const t=e.target,n=O.current!==e.clientX;if(e.currentTarget.contains(t)&&n){const t=e.clientX>O.current?"right":"left";P.current=t,O.current=e.clientX}}))}))}))})})}))})});Xx.displayName=Kx;var ag=ve.forwardRef((e,t)=>{const n=e,{__scopeMenu:a}=n,s=c(n,["__scopeMenu"]);return p.jsx(q.div,d(o({role:"group"},s),{ref:t}))});ag.displayName="MenuGroup";var sg=ve.forwardRef((e,t)=>{const n=e,{__scopeMenu:a}=n,s=c(n,["__scopeMenu"]);return p.jsx(q.div,d(o({},s),{ref:t}))});sg.displayName="MenuLabel";var rg="MenuItem",ig="menu.itemSelect",lg=ve.forwardRef((e,t)=>{const n=e,{disabled:a=!1,onSelect:s}=n,r=c(n,["disabled","onSelect"]),i=ve.useRef(null),l=Yx(rg,e.__scopeMenu),u=Qx(rg,e.__scopeMenu),m=z(t,i),h=ve.useRef(!1);return p.jsx(og,d(o({},r),{ref:m,disabled:a,onClick:Y(e.onClick,()=>{const e=i.current;if(!a&&e){const t=new CustomEvent(ig,{bubbles:!0,cancelable:!0});e.addEventListener(ig,e=>null==s?void 0:s(e),{once:!0}),de(e,t),t.defaultPrevented?h.current=!1:l.onClose()}}),onPointerDown:t=>{var n;null==(n=e.onPointerDown)||n.call(e,t),h.current=!0},onPointerUp:Y(e.onPointerUp,e=>{var t;h.current||null==(t=e.currentTarget)||t.click()}),onKeyDown:Y(e.onKeyDown,e=>{const t=""!==u.searchRef.current;a||t&&" "===e.key||Sx.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})}))});lg.displayName=rg;var og=ve.forwardRef((e,t)=>{const n=e,{__scopeMenu:a,disabled:s=!1,textValue:r}=n,i=c(n,["__scopeMenu","disabled","textValue"]),l=Qx(rg,a),u=Lx(a),m=ve.useRef(null),h=z(t,m),[x,g]=ve.useState(!1),[f,v]=ve.useState("");return ve.useEffect(()=>{var e;const t=m.current;t&&v((null!=(e=t.textContent)?e:"").trim())},[i.children]),p.jsx(Ax.ItemSlot,{scope:a,disabled:s,textValue:null!=r?r:f,children:p.jsx(Bc,d(o({asChild:!0},u),{focusable:!s,children:p.jsx(q.div,d(o({role:"menuitem","data-highlighted":x?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0},i),{ref:h,onPointerMove:Y(e.onPointerMove,Tg(e=>{if(s)l.onItemLeave(e);else if(l.onItemEnter(e),!e.defaultPrevented){e.currentTarget.focus({preventScroll:!0})}})),onPointerLeave:Y(e.onPointerLeave,Tg(e=>l.onItemLeave(e))),onFocus:Y(e.onFocus,()=>g(!0)),onBlur:Y(e.onBlur,()=>g(!1))}))}))})}),dg=ve.forwardRef((e,t)=>{const n=e,{checked:a=!1,onCheckedChange:s}=n,r=c(n,["checked","onCheckedChange"]);return p.jsx(fg,{scope:e.__scopeMenu,checked:a,children:p.jsx(lg,d(o({role:"menuitemcheckbox","aria-checked":Cg(a)?"mixed":a},r),{ref:t,"data-state":Eg(a),onSelect:Y(r.onSelect,()=>null==s?void 0:s(!!Cg(a)||!a),{checkForDefaultPrevented:!1})}))})});dg.displayName="MenuCheckboxItem";var cg="MenuRadioGroup",[ug,mg]=Ox(cg,{value:void 0,onValueChange:()=>{}}),pg=ve.forwardRef((e,t)=>{const n=e,{value:a,onValueChange:s}=n,r=c(n,["value","onValueChange"]),i=U(s);return p.jsx(ug,{scope:e.__scopeMenu,value:a,onValueChange:i,children:p.jsx(ag,d(o({},r),{ref:t}))})});pg.displayName=cg;var hg="MenuRadioItem",xg=ve.forwardRef((e,t)=>{const n=e,{value:a}=n,s=c(n,["value"]),r=mg(hg,e.__scopeMenu),i=a===r.value;return p.jsx(fg,{scope:e.__scopeMenu,checked:i,children:p.jsx(lg,d(o({role:"menuitemradio","aria-checked":i},s),{ref:t,"data-state":Eg(i),onSelect:Y(s.onSelect,()=>{var e;return null==(e=r.onValueChange)?void 0:e.call(r,a)},{checkForDefaultPrevented:!1})}))})});xg.displayName=hg;var gg="MenuItemIndicator",[fg,vg]=Ox(gg,{checked:!1}),yg=ve.forwardRef((e,t)=>{const n=e,{__scopeMenu:a,forceMount:s}=n,r=c(n,["__scopeMenu","forceMount"]),i=vg(gg,a);return p.jsx(K,{present:s||Cg(i.checked)||!0===i.checked,children:p.jsx(q.span,d(o({},r),{ref:t,"data-state":Eg(i.checked)}))})});yg.displayName=gg;var bg=ve.forwardRef((e,t)=>{const n=e,{__scopeMenu:a}=n,s=c(n,["__scopeMenu"]);return p.jsx(q.div,d(o({role:"separator","aria-orientation":"horizontal"},s),{ref:t}))});bg.displayName="MenuSeparator";var jg=ve.forwardRef((e,t)=>{const n=e,{__scopeMenu:a}=n,s=c(n,["__scopeMenu"]),r=Mx(a);return p.jsx(ie,d(o(o({},r),s),{ref:t}))});jg.displayName="MenuArrow";var[wg,Ng]=Ox("MenuSub"),_g="MenuSubTrigger",kg=ve.forwardRef((e,t)=>{const n=zx(_g,e.__scopeMenu),a=Yx(_g,e.__scopeMenu),s=Ng(_g,e.__scopeMenu),r=Qx(_g,e.__scopeMenu),i=ve.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=r,u={__scopeMenu:e.__scopeMenu},m=ve.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return ve.useEffect(()=>m,[m]),ve.useEffect(()=>{const e=l.current;return()=>{window.clearTimeout(e),c(null)}},[l,c]),p.jsx(qx,d(o({asChild:!0},u),{children:p.jsx(og,d(o({id:s.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":s.contentId,"data-state":$g(n.open)},e),{ref:le(t,s.onTriggerChange),onClick:t=>{var a;null==(a=e.onClick)||a.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Y(e.onPointerMove,Tg(t=>{r.onItemEnter(t),t.defaultPrevented||e.disabled||n.open||i.current||(r.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{n.onOpenChange(!0),m()},100))})),onPointerLeave:Y(e.onPointerLeave,Tg(e=>{var t,a;m();const s=null==(t=n.content)?void 0:t.getBoundingClientRect();if(s){const t=null==(a=n.content)?void 0:a.dataset.side,i="right"===t,o=i?-5:5,d=s[i?"left":"right"],c=s[i?"right":"left"];r.onPointerGraceIntentChange({area:[{x:e.clientX+o,y:e.clientY},{x:d,y:s.top},{x:c,y:s.top},{x:c,y:s.bottom},{x:d,y:s.bottom}],side:t}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>r.onPointerGraceIntentChange(null),300)}else{if(r.onTriggerLeave(e),e.defaultPrevented)return;r.onPointerGraceIntentChange(null)}})),onKeyDown:Y(e.onKeyDown,t=>{var s;const i=""!==r.searchRef.current;e.disabled||i&&" "===t.key||Cx[a.dir].includes(t.key)&&(n.onOpenChange(!0),null==(s=n.content)||s.focus(),t.preventDefault())})}))}))});kg.displayName=_g;var Sg="MenuSubContent",Dg=ve.forwardRef((e,t)=>{const n=Gx(Kx,e.__scopeMenu),a=e,{forceMount:s=n.forceMount}=a,r=c(a,["forceMount"]),i=zx(Kx,e.__scopeMenu),l=Yx(Kx,e.__scopeMenu),u=Ng(Sg,e.__scopeMenu),m=ve.useRef(null),h=z(t,m);return p.jsx(Ax.Provider,{scope:e.__scopeMenu,children:p.jsx(K,{present:s||i.open,children:p.jsx(Ax.Slot,{scope:e.__scopeMenu,children:p.jsx(ng,d(o({id:u.contentId,"aria-labelledby":u.triggerId},r),{ref:h,align:"start",side:"rtl"===l.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;l.isUsingKeyboardRef.current&&(null==(t=m.current)||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:Y(e.onFocusOutside,e=>{e.target!==u.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:Y(e.onEscapeKeyDown,e=>{l.onClose(),e.preventDefault()}),onKeyDown:Y(e.onKeyDown,e=>{var t;const n=e.currentTarget.contains(e.target),a=Ex[l.dir].includes(e.key);n&&a&&(i.onOpenChange(!1),null==(t=u.trigger)||t.focus(),e.preventDefault())})}))})})})});function $g(e){return e?"open":"closed"}function Cg(e){return"indeterminate"===e}function Eg(e){return Cg(e)?"indeterminate":e?"checked":"unchecked"}function Tg(e){return t=>"mouse"===t.pointerType?e(t):void 0}Dg.displayName=Sg;var Ag=Vx,Fg=qx,Pg=Wx,Og=Xx,Rg=ag,Mg=sg,Lg=lg,Ig=dg,zg=pg,Bg=xg,Yg=yg,Vg=bg,qg=jg,Ug=kg,Hg=Dg,Gg="DropdownMenu",[Wg,Kg]=M(Gg,[Rx]),Zg=Rx(),[Qg,Xg]=Wg(Gg),Jg=e=>{const{__scopeDropdownMenu:t,children:n,dir:a,open:s,defaultOpen:r,onOpenChange:i,modal:l=!0}=e,c=Zg(t),u=ve.useRef(null),[m,h]=G({prop:s,defaultProp:null!=r&&r,onChange:i,caller:Gg});return p.jsx(Qg,{scope:t,triggerId:W(),triggerRef:u,contentId:W(),open:m,onOpenChange:h,onOpenToggle:ve.useCallback(()=>h(e=>!e),[h]),modal:l,children:p.jsx(Ag,d(o({},c),{open:m,onOpenChange:h,dir:a,modal:l,children:n}))})};Jg.displayName=Gg;var ef="DropdownMenuTrigger",tf=ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a,disabled:s=!1}=n,r=c(n,["__scopeDropdownMenu","disabled"]),i=Xg(ef,a),l=Zg(a);return p.jsx(Fg,d(o({asChild:!0},l),{children:p.jsx(q.button,d(o({type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":s?"":void 0,disabled:s},r),{ref:le(t,i.triggerRef),onPointerDown:Y(e.onPointerDown,e=>{s||0!==e.button||!1!==e.ctrlKey||(i.onOpenToggle(),i.open||e.preventDefault())}),onKeyDown:Y(e.onKeyDown,e=>{s||(["Enter"," "].includes(e.key)&&i.onOpenToggle(),"ArrowDown"===e.key&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})}))}))});tf.displayName=ef;var nf=e=>{const t=e,{__scopeDropdownMenu:n}=t,a=c(t,["__scopeDropdownMenu"]),s=Zg(n);return p.jsx(Pg,o(o({},s),a))};nf.displayName="DropdownMenuPortal";var af="DropdownMenuContent",sf=ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Xg(af,a),i=Zg(a),l=ve.useRef(!1);return p.jsx(Og,d(o(o({id:r.contentId,"aria-labelledby":r.triggerId},i),s),{ref:t,onCloseAutoFocus:Y(e.onCloseAutoFocus,e=>{var t;l.current||null==(t=r.triggerRef.current)||t.focus(),l.current=!1,e.preventDefault()}),onInteractOutside:Y(e.onInteractOutside,e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,a=2===t.button||n;r.modal&&!a||(l.current=!0)}),style:o(o({},e.style),{"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"})}))});sf.displayName=af;ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Zg(a);return p.jsx(Rg,d(o(o({},r),s),{ref:t}))}).displayName="DropdownMenuGroup";var rf=ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Zg(a);return p.jsx(Mg,d(o(o({},r),s),{ref:t}))});rf.displayName="DropdownMenuLabel";var lf=ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Zg(a);return p.jsx(Lg,d(o(o({},r),s),{ref:t}))});lf.displayName="DropdownMenuItem";var of=ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Zg(a);return p.jsx(Ig,d(o(o({},r),s),{ref:t}))});of.displayName="DropdownMenuCheckboxItem";ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Zg(a);return p.jsx(zg,d(o(o({},r),s),{ref:t}))}).displayName="DropdownMenuRadioGroup";var df=ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Zg(a);return p.jsx(Bg,d(o(o({},r),s),{ref:t}))});df.displayName="DropdownMenuRadioItem";var cf=ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Zg(a);return p.jsx(Yg,d(o(o({},r),s),{ref:t}))});cf.displayName="DropdownMenuItemIndicator";var uf=ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Zg(a);return p.jsx(Vg,d(o(o({},r),s),{ref:t}))});uf.displayName="DropdownMenuSeparator";ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Zg(a);return p.jsx(qg,d(o(o({},r),s),{ref:t}))}).displayName="DropdownMenuArrow";var mf=ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Zg(a);return p.jsx(Ug,d(o(o({},r),s),{ref:t}))});mf.displayName="DropdownMenuSubTrigger";var pf=ve.forwardRef((e,t)=>{const n=e,{__scopeDropdownMenu:a}=n,s=c(n,["__scopeDropdownMenu"]),r=Zg(a);return p.jsx(Hg,d(o(o({},r),s),{ref:t,style:o(o({},e.style),{"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"})}))});pf.displayName="DropdownMenuSubContent";var hf=nf,xf=sf,gf=rf,ff=lf,vf=of,yf=df,bf=cf,jf=uf,wf=mf,Nf=pf;const _f=Jg,kf=tf;ve.forwardRef((e,t)=>{var n=e,{className:a,inset:s,children:r}=n,i=c(n,["className","inset","children"]);return p.jsxs(wf,d(o({ref:t,className:aa("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",a)},i),{children:[r,p.jsx(br,{className:"ml-auto"})]}))}).displayName=wf.displayName;ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(Nf,o({ref:t,className:aa("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",a)},s))}).displayName=Nf.displayName;const Sf=ve.forwardRef((e,t)=>{var n=e,{className:a,sideOffset:s=4}=n,r=c(n,["className","sideOffset"]);return p.jsx(hf,{children:p.jsx(xf,o({ref:t,sideOffset:s,className:aa("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md dark:bg-popover dark:border-border dark:shadow-xl dark:shadow-black/20","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",a)},r))})});Sf.displayName=xf.displayName;const Df=ve.forwardRef((e,t)=>{var n=e,{className:a,inset:s}=n,r=c(n,["className","inset"]);return p.jsx(ff,o({ref:t,className:aa("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0 dark:focus:bg-accent dark:focus:text-accent-foreground hover:bg-accent/50 dark:hover:bg-accent/50",s&&"pl-8",a)},r))});Df.displayName=ff.displayName;ve.forwardRef((e,t)=>{var n=e,{className:a,children:s,checked:r}=n,i=c(n,["className","children","checked"]);return p.jsxs(vf,d(o({ref:t,className:aa("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:r},i),{children:[p.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:p.jsx(bf,{children:p.jsx(fr,{className:"h-4 w-4"})})}),s]}))}).displayName=vf.displayName;ve.forwardRef((e,t)=>{var n=e,{className:a,children:s}=n,r=c(n,["className","children"]);return p.jsxs(yf,d(o({ref:t,className:aa("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a)},r),{children:[p.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:p.jsx(bf,{children:p.jsx(_r,{className:"h-2 w-2 fill-current"})})}),s]}))}).displayName=yf.displayName;ve.forwardRef((e,t)=>{var n=e,{className:a,inset:s}=n,r=c(n,["className","inset"]);return p.jsx(gf,o({ref:t,className:aa("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a)},r))}).displayName=gf.displayName;const $f=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(jf,o({ref:t,className:aa("-mx-1 my-1 h-px bg-muted",a)},s))});$f.displayName=jf.displayName;class Cf{static getPatientIntegratedData(e){return m(this,null,function*(){var t,n,a;try{const s=((yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.patients)?void 0:n.getAll)?void 0:a.call(n))||[]).find(t=>t.id===e);if(!s)throw new Error("المريض غير موجود");const[r,i,l,o,d,c,u]=yield Promise.all([this.getPatientAppointments(e),this.getPatientTreatments(e),this.getPatientPayments(e),this.getPatientPrescriptions(e),this.getPatientLabOrders(e),this.getPatientTimeline(e),this.getPatientTreatmentPlans(e)]);return{patient:s,appointments:r,treatments:i,payments:l,prescriptions:o,labOrders:d,timeline:c,treatmentPlans:u,stats:this.calculatePatientStats({appointments:r,treatments:i,payments:l,prescriptions:o,labOrders:d})}}catch(s){return console.error("خطأ في جلب البيانات المتكاملة للمريض:",s),null}})}static getPatientAppointments(e){return m(this,null,function*(){var t,n,a;try{return(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.appointments)?void 0:n.getByPatient)?void 0:a.call(n,e))||[]}catch(s){return console.error("خطأ في جلب مواعيد المريض:",s),[]}})}static getPatientTreatments(e){return m(this,null,function*(){var t,n,a;try{return(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.toothTreatments)?void 0:n.getByPatient)?void 0:a.call(n,e))||[]}catch(s){return console.error("خطأ في جلب علاجات المريض:",s),[]}})}static getPatientPayments(e){return m(this,null,function*(){var t,n,a;try{return(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.payments)?void 0:n.getByPatient)?void 0:a.call(n,e))||[]}catch(s){return console.error("خطأ في جلب دفعات المريض:",s),[]}})}static getPatientPrescriptions(e){return m(this,null,function*(){var t,n,a;try{return(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.prescriptions)?void 0:n.getByPatient)?void 0:a.call(n,e))||[]}catch(s){return console.error("خطأ في جلب وصفات المريض:",s),[]}})}static getPatientLabOrders(e){return m(this,null,function*(){var t,n,a;try{return(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.labOrders)?void 0:n.getByPatient)?void 0:a.call(n,e))||[]}catch(s){return console.error("خطأ في جلب طلبات المختبر للمريض:",s),[]}})}static getPatientTimeline(e){return m(this,null,function*(){var t,n,a;try{return(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.patientTimeline)?void 0:n.getByPatient)?void 0:a.call(n,e))||[]}catch(s){return console.error("خطأ في جلب الجدول الزمني للمريض:",s),[]}})}static getPatientTreatmentPlans(e){return m(this,null,function*(){var t,n,a;try{return(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.treatmentPlans)?void 0:n.getByPatient)?void 0:a.call(n,e))||[]}catch(s){return console.error("خطأ في جلب خطط العلاج للمريض:",s),[]}})}static calculatePatientStats(e){var t,n;const{appointments:a,treatments:s,payments:r}=e,i=a.length,l=s.filter(e=>"completed"===e.treatment_status).length,o=s.filter(e=>"planned"===e.treatment_status||"in_progress"===e.treatment_status).length;let d=0,c=0;a.forEach(e=>{if(e.cost){const t=r.filter(t=>t.appointment_id===e.id).reduce((e,t)=>e+(t.amount||0),0);c+=e.cost,d+=t}});r.filter(e=>!e.appointment_id).forEach(e=>{d+=e.amount||0,e.total_amount_due&&(c+=e.total_amount_due)});const u=Math.max(0,c-d),m=null==(t=a.filter(e=>"completed"===e.status).sort((e,t)=>new Date(t.start_time).getTime()-new Date(e.start_time).getTime())[0])?void 0:t.start_time,p=null==(n=a.filter(e=>"scheduled"===e.status&&new Date(e.start_time)>new Date).sort((e,t)=>new Date(e.start_time).getTime()-new Date(t.start_time).getTime())[0])?void 0:n.start_time;return{totalAppointments:i,completedTreatments:l,pendingTreatments:o,totalPaid:d,remainingBalance:u,lastVisit:m,nextAppointment:p}}static createTimelineEvent(e){return m(this,null,function*(){var t,n,a;try{return(yield null==(a=null==(n=null==(t=window.electronAPI)?void 0:t.patientTimeline)?void 0:n.create)?void 0:a.call(n,e))||null}catch(s){return console.error("خطأ في إنشاء حدث الجدول الزمني:",s),null}})}static linkPrescriptionToTreatment(e,t){return m(this,null,function*(){var n,a,s;try{return!!(yield null==(s=null==(a=null==(n=window.electronAPI)?void 0:n.prescriptions)?void 0:a.update)?void 0:s.call(a,e,{tooth_treatment_id:t}))}catch(r){return console.error("خطأ في ربط الوصفة بالعلاج:",r),!1}})}static linkLabOrderToTreatment(e,t,n){return m(this,null,function*(){var a,s,r;try{const i={tooth_treatment_id:t};n&&(i.appointment_id=n);return!!(yield null==(r=null==(s=null==(a=window.electronAPI)?void 0:a.labOrders)?void 0:s.update)?void 0:r.call(s,e,i))}catch(i){return console.error("خطأ في ربط طلب المختبر بالعلاج:",i),!1}})}static generatePatientReport(e){return m(this,null,function*(){const t=yield this.getPatientIntegratedData(e);if(!t)throw new Error("لا يمكن جلب بيانات المريض");return{patient:t.patient,summary:t.stats,treatmentHistory:t.treatments,appointmentHistory:t.appointments,financialSummary:{totalPaid:t.stats.totalPaid,remainingBalance:t.stats.remainingBalance,paymentHistory:t.payments},prescriptionHistory:t.prescriptions,labOrderHistory:t.labOrders,timeline:t.timeline,treatmentPlans:t.treatmentPlans,generatedAt:(new Date).toISOString()}})}}function Ef({patients:e,isLoading:t,onEdit:n,onDelete:a,onViewDetails:s,onViewPendingInvoice:r}){const[i,l]=ve.useState(null),[o,d]=ve.useState(null),[c,u]=ve.useState(1),[h,x]=ve.useState(10),{settings:g}=qt(),{toast:f}=yl(),v=e=>m(this,null,function*(){try{f({title:"جاري إعداد التقرير...",description:"يتم تجميع بيانات المريض وإعداد التقرير للتصدير"});const t=yield Cf.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");yield Mh.exportIndividualPatientRecord(t,g),f({title:"تم إنشاء التقرير بنجاح",description:`تم إنشاء سجل المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error exporting patient record:",t),f({title:"خطأ في إنشاء التقرير",description:"فشل في إنشاء سجل المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),y=e=>m(this,null,function*(){try{f({title:"جاري إعداد الطباعة...",description:"يتم تجميع بيانات المريض وإعداد الطباعة المباشرة"});const t=yield Cf.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");const n=Mh.createPatientRecordHTMLForPrint(t,g),a=window.open("","_blank");if(!a)throw new Error("لا يمكن فتح نافذة الطباعة");a.document.write(n),a.document.close(),a.onload=()=>{a.focus(),a.print(),a.close()},f({title:"تم إعداد الطباعة",description:`تم إعداد طباعة سجل المريض ${e.full_name}`})}catch(t){console.error("Error printing patient record:",t),f({title:"خطأ في الطباعة",description:"فشل في إعداد طباعة سجل المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),b=ve.useMemo(()=>{let t=e;i&&o&&(t=[...e].sort((e,t)=>{let n=e[i],a=t[i];return null==n&&null==a?0:null==n?"asc"===o?1:-1:null==a?"asc"===o?-1:1:(n=String(n).toLowerCase(),a=String(a).toLowerCase(),n<a?"asc"===o?-1:1:n>a?"asc"===o?1:-1:0)}));const n=(c-1)*h,a=n+h;return{patients:t.slice(n,a),totalPages:Math.ceil(t.length/h),totalCount:t.length}},[e,i,o,c,h]),j=e=>i!==e?p.jsx(lr,{className:"w-4 h-4 opacity-50"}):"asc"===o?p.jsx(or,{className:"w-4 h-4"}):"desc"===o?p.jsx(rr,{className:"w-4 h-4"}):p.jsx(lr,{className:"w-4 h-4 opacity-50"}),w=({field:e,children:t})=>p.jsx(tc,{className:"cursor-pointer hover:bg-muted/50 select-none text-center",onClick:()=>(e=>{i===e?"asc"===o?d("desc"):"desc"===o?(l(null),d(null)):d("asc"):(l(e),d("asc"))})(e),children:p.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[p.jsx("span",{children:t}),j(e)]})});if(t)return p.jsx("div",{className:"border rounded-lg",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-center",children:"#"}),p.jsx(tc,{className:"text-center",children:"الاسم الكامل للمريض"}),p.jsx(tc,{className:"text-center",children:"الجنس"}),p.jsx(tc,{className:"text-center",children:"العمر"}),p.jsx(tc,{className:"text-center",children:"رقم الهاتف"}),p.jsx(tc,{className:"text-center",children:"حالة المريض"}),p.jsx(tc,{className:"text-center",children:"تاريخ الإضافة"}),p.jsx(tc,{className:"text-center",children:"الاجراءات"})]})}),p.jsx(Jd,{children:[...Array(5)].map((e,t)=>p.jsx(ec,{children:[...Array(8)].map((e,t)=>p.jsx(nc,{children:p.jsx("div",{className:"h-4 bg-muted animate-pulse rounded"})},t))},t))})]})});if(0===e.length)return p.jsx("div",{className:"border rounded-lg",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-center w-12 max-w-12 min-w-12",children:p.jsx("span",{className:"arabic-enhanced font-medium text-xs",children:"#"})}),p.jsx(w,{field:"full_name",children:"الاسم الكامل للمريض"}),p.jsx(w,{field:"gender",children:"الجنس"}),p.jsx(w,{field:"age",children:"العمر"}),p.jsx(w,{field:"phone",children:"رقم الهاتف"}),p.jsx(w,{field:"patient_condition",children:"حالة المريض"}),p.jsx(w,{field:"date_added",children:"تاريخ الإضافة"}),p.jsx(tc,{className:"text-center",children:"الاجراءات"})]})}),p.jsx(Jd,{children:p.jsx(ec,{children:p.jsx(nc,{colSpan:8,className:"text-center py-8",children:p.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[p.jsx(Ai,{className:"w-12 h-12 text-muted-foreground opacity-50"}),p.jsx("p",{className:"text-muted-foreground",children:"لا توجد مرضى"})]})})})})]})});const{patients:N,totalPages:_,totalCount:k}=b,S=(c-1)*h,D=e=>{u(e)};return p.jsxs("div",{className:"space-y-4",children:[p.jsx("div",{className:"border rounded-lg overflow-hidden",children:p.jsx("div",{className:"overflow-x-auto",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{className:"bg-muted/50",children:[p.jsx(tc,{className:"text-center w-12 max-w-12 min-w-12",children:p.jsx("span",{className:"arabic-enhanced font-medium text-xs",children:"#"})}),p.jsx(w,{field:"full_name",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"الاسم الكامل للمريض"})}),p.jsx(w,{field:"gender",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"الجنس"})}),p.jsx(w,{field:"age",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"العمر"})}),p.jsx(w,{field:"phone",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"رقم الهاتف"})}),p.jsx(w,{field:"patient_condition",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"حالة المريض"})}),p.jsx(w,{field:"date_added",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"تاريخ الإضافة"})}),p.jsx(tc,{className:"text-center",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"الاجراءات"})})]})}),p.jsx(Jd,{children:N.map((e,t)=>p.jsxs(ec,{className:"hover:bg-muted/50",children:[p.jsx(nc,{className:"font-medium text-center w-12 max-w-12 min-w-12 text-xs",children:S+t+1}),p.jsx(nc,{className:"font-medium text-center",children:p.jsxs("div",{className:"flex items-center justify-center space-x-2 space-x-reverse",children:[p.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:e.full_name.charAt(0)}),p.jsx("span",{children:e.full_name})]})}),p.jsx(nc,{className:"text-center",children:p.jsx(qo,{variant:"male"===e.gender?"default":"secondary",children:"male"===e.gender?"ذكر":"أنثى"})}),p.jsxs(nc,{className:"text-center",children:[e.age," سنة"]}),p.jsx(nc,{className:"min-w-[120px] text-center table-cell-wrap-truncate-sm",children:e.phone?p.jsx("div",{className:"flex items-center justify-center",children:p.jsxs("button",{onClick:()=>m(this,null,function*(){var t,n;const a=`https://api.whatsapp.com/send/?phone=${e.phone}`;try{if(window.electronAPI&&window.electronAPI.system&&window.electronAPI.system.openExternal)return void(yield window.electronAPI.system.openExternal(a))}catch(s){console.log("Method 1 failed:",s)}try{if(window.electronAPI)return void(yield null==(n=null==(t=window.electronAPI.shell)?void 0:t.openExternal)?void 0:n.call(t,a))}catch(s){console.log("Method 2 failed:",s)}window.open(a,"_blank","noopener,noreferrer")}),className:"text-sm arabic-enhanced text-green-600 hover:text-green-800 hover:underline cursor-pointer transition-colors bg-transparent border-none p-0 flex items-center gap-1",title:"فتح محادثة واتساب",children:[e.phone,p.jsx(Zr,{className:"w-3 h-3 text-green-600"})]})}):p.jsx("span",{className:"text-muted-foreground text-sm arabic-enhanced",children:"غير محدد"})}),p.jsx(nc,{className:"min-w-[150px] text-center",children:p.jsx(qo,{variant:"outline",className:"max-w-[150px] truncate arabic-enhanced",title:e.patient_condition,children:e.patient_condition})}),p.jsx(nc,{className:"text-center",children:p.jsx("span",{className:"text-sm arabic-enhanced",children:ma(e.date_added)})}),p.jsx(nc,{className:"w-auto text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-1",children:[p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-view h-8 px-2 min-w-0",onClick:()=>s(e),title:"عرض تفاصيل المريض",children:[p.jsx(Fr,{className:"w-3 h-3"}),p.jsx("span",{className:"text-xs arabic-enhanced hidden sm:inline ml-1",children:"عرض"})]}),p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-edit h-8 px-2 min-w-0",onClick:()=>n(e),title:"تعديل بيانات المريض",children:[p.jsx(si,{className:"w-3 h-3"}),p.jsx("span",{className:"text-xs arabic-enhanced hidden sm:inline ml-1",children:"تعديل"})]}),p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-delete text-red-600 hover:text-red-700 hover:bg-red-50 h-8 px-2 min-w-0",onClick:()=>a(e.id),title:"حذف المريض",children:[p.jsx(Ni,{className:"w-3 h-3"}),p.jsx("span",{className:"text-xs arabic-enhanced hidden sm:inline ml-1",children:"حذف"})]}),p.jsxs(_f,{children:[p.jsx(kf,{asChild:!0,children:p.jsx(Qi,{variant:"ghost",size:"sm",className:"h-8 px-2 min-w-0",title:"المزيد من الخيارات",children:p.jsx(ei,{className:"w-3 h-3"})})}),p.jsxs(Sf,{align:"end",className:"patient-actions-dropdown",children:[p.jsxs(Df,{onClick:()=>y(e),className:"dropdown-item",children:[p.jsx(ci,{className:"w-4 h-4"}),p.jsx("span",{className:"arabic-enhanced",children:"طباعة مباشرة"})]}),p.jsxs(Df,{onClick:()=>v(e),className:"dropdown-item",children:[p.jsx(Tr,{className:"w-4 h-4"}),p.jsx("span",{className:"arabic-enhanced",children:"تصدير سجل المريض"})]}),p.jsx($f,{}),r&&p.jsxs(Df,{onClick:()=>r(e),className:"dropdown-item",children:[p.jsx(Pr,{className:"w-4 h-4"}),p.jsx("span",{className:"arabic-enhanced",children:"فاتورة المعلقات"})]})]})]})]})})]},e.id))})]})})}),k>0&&p.jsxs("div",{className:"flex items-center justify-between px-2",children:[p.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:p.jsxs("p",{className:"text-sm text-muted-foreground arabic-enhanced",children:["عرض ",(c-1)*h+1," إلى ",Math.min(c*h,k)," من ",k," مريض"]})}),p.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),p.jsxs(el,{value:`${h}`,onValueChange:e=>{x(parseInt(e)),u(1)},children:[p.jsx(al,{className:"h-8 w-[70px]",children:p.jsx(nl,{placeholder:h})}),p.jsx(il,{side:"top",children:[10,20,30,50,100].map(e=>p.jsx(dl,{value:`${e}`,children:e},e))})]})]}),p.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",c," من ",_]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>D(1),disabled:1===c,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),p.jsx(Nr,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>D(c-1),disabled:1===c,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),p.jsx(br,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>D(c+1),disabled:c===_,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),p.jsx(yr,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>D(_),disabled:c===_,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),p.jsx(wr,{className:"h-4 w-4"})]})]})]})]})]})}function Tf(e,t,n){const a=n.filter(t=>t.appointment_id===e),s=a.reduce((e,t)=>e+t.amount,0),r=Math.max(0,t-s),i=function(e,t,n){const a=function(e,t){return e?t.filter(t=>t.appointment_id===e&&("partial"===t.status||"completed"===t.status)).reduce((e,t)=>e+t.amount,0):0}(e,n);return a>=t?"completed":a>0?"partial":"pending"}(e,t,n);return{appointmentPayments:a,totalPaid:s,remainingBalance:r,status:i,appointmentCost:t,paymentCount:a.length}}const Af=Ne()(Lt((e,t)=>({medications:[],selectedMedication:null,isLoading:!1,error:null,searchQuery:"",filteredMedications:[],loadMedications:()=>m(void 0,null,function*(){var n,a;e({isLoading:!0,error:null});try{const s=(yield null==(a=null==(n=window.electronAPI)?void 0:n.medications)?void 0:a.getAll())||[];e({medications:s,filteredMedications:s,isLoading:!1}),t().filterMedications()}catch(s){console.error("Error loading medications:",s),e({error:s instanceof Error?s.message:"Failed to load medications",isLoading:!1})}}),createMedication:n=>m(void 0,null,function*(){var a,s;e({isLoading:!0,error:null});try{const r=yield null==(s=null==(a=window.electronAPI)?void 0:a.medications)?void 0:s.create(n);if(r){const n=[...t().medications,r];e({medications:n,filteredMedications:n,isLoading:!1}),t().filterMedications()}}catch(r){throw console.error("Error creating medication:",r),e({error:r instanceof Error?r.message:"Failed to create medication",isLoading:!1}),r}}),updateMedication:(n,a)=>m(void 0,null,function*(){var s,r;e({isLoading:!0,error:null});try{const i=yield null==(r=null==(s=window.electronAPI)?void 0:s.medications)?void 0:r.update(n,a);if(i){const a=t().medications.map(e=>e.id===n?o(o({},e),i):e);e({medications:a,filteredMedications:a,isLoading:!1}),t().filterMedications()}}catch(i){throw console.error("Error updating medication:",i),e({error:i instanceof Error?i.message:"Failed to update medication",isLoading:!1}),i}}),deleteMedication:n=>m(void 0,null,function*(){var a,s,r;e({isLoading:!0,error:null});try{if(yield null==(s=null==(a=window.electronAPI)?void 0:a.medications)?void 0:s.delete(n)){const a=t().medications.filter(e=>e.id!==n);e({medications:a,filteredMedications:a,selectedMedication:(null==(r=t().selectedMedication)?void 0:r.id)===n?null:t().selectedMedication,isLoading:!1}),t().filterMedications()}}catch(i){throw console.error("Error deleting medication:",i),e({error:i instanceof Error?i.message:"Failed to delete medication",isLoading:!1}),i}}),setSelectedMedication:t=>{e({selectedMedication:t})},setSearchQuery:n=>{e({searchQuery:n}),t().filterMedications()},filterMedications:()=>{const{medications:n,searchQuery:a}=t();if(!a.trim())return void e({filteredMedications:n});const s=n.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())||e.instructions&&e.instructions.toLowerCase().includes(a.toLowerCase()));e({filteredMedications:s})},clearError:()=>{e({error:null})}}),{name:"medication-store"}));function Ff({open:e,onOpenChange:t,editingPrescription:n,preSelectedPatientId:a}){const{createPrescription:s,updatePrescription:r,isLoading:i}=Nd(),{medications:l,loadMedications:c}=Af(),{patients:u,loadPatients:h}=cl(),{appointments:x,loadAppointments:g}=Wo(),[f,v]=ve.useState({patient_id:"",appointment_id:"",prescription_date:(new Date).toISOString().split("T")[0],notes:""}),[y,b]=ve.useState([]),[j,w]=ve.useState({});ve.useEffect(()=>{e&&(c(),h(),g())},[e,c,h,g]),ve.useEffect(()=>{var t;if(e){if(n&&n.id){v({patient_id:n.patient_id||"",appointment_id:n.appointment_id||"",prescription_date:n.prescription_date||(new Date).toISOString().split("T")[0],notes:n.notes||""});const e=(null==(t=n.medications)?void 0:t.map(e=>({medication_id:e.medication_id,dose:e.dose||"",medication_name:e.medication_name})))||[];b(e)}else v({patient_id:a||"",appointment_id:"",prescription_date:(new Date).toISOString().split("T")[0],notes:""}),b([]);w({})}},[e,n]);const N=x.filter(e=>e.patient_id===f.patient_id),_=(e,t)=>{v(n=>d(o({},n),{[e]:t})),"patient_id"===e&&v(e=>d(o({},e),{appointment_id:""})),j[e]&&w(t=>d(o({},t),{[e]:""}))},k=()=>{b(e=>[...e,{medication_id:"",dose:""}])},S=(e,t,n)=>{b(a=>a.map((a,s)=>{if(s===e){const e=d(o({},a),{[t]:n});if("medication_id"===t){const t=l.find(e=>e.id===n);e.medication_name=null==t?void 0:t.name}return e}return a}));const a=[`medication_${e}`,`dose_${e}`];w(e=>{const t=o({},e);return a.forEach(e=>delete t[e]),t})},D=()=>{i||t(!1)};return p.jsx(Ii,{open:e,onOpenChange:D,children:p.jsxs(Yi,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"flex items-center gap-2 text-right",children:[p.jsx(Pr,{className:"w-5 h-5 text-green-600"}),n&&n.id?"تعديل الوصفة الطبية":"إنشاء وصفة طبية جديدة"]}),p.jsx(Hi,{className:"text-right",children:n&&n.id?"قم بتعديل معلومات الوصفة الطبية أدناه":"أدخل معلومات الوصفة الطبية الجديدة أدناه"})]}),p.jsxs("form",{onSubmit:e=>m(this,null,function*(){if(e.preventDefault(),(()=>{const e={};return f.patient_id||(e.patient_id="يجب اختيار مريض"),f.prescription_date||(e.prescription_date="تاريخ الوصفة مطلوب"),0===y.length&&(e.medications="يجب إضافة دواء واحد على الأقل"),y.forEach((t,n)=>{t.medication_id||(e[`medication_${n}`]="يجب اختيار دواء"),t.dose.trim()||(e[`dose_${n}`]="الجرعة مطلوبة")}),w(e),0===Object.keys(e).length})())try{const e={patient_id:f.patient_id,appointment_id:f.appointment_id||void 0,prescription_date:f.prescription_date,notes:f.notes.trim()||void 0,medications:y.map(e=>({medication_id:e.medication_id,dose:e.dose.trim()}))};n&&n.id?(yield r(n.id,e),rc.success("تم تحديث الوصفة الطبية بنجاح")):(yield s(e),rc.success("تم إنشاء الوصفة الطبية بنجاح")),t(!1)}catch(a){console.error("Error saving prescription:",a),rc.error(n&&n.id?"فشل في تحديث الوصفة الطبية":"فشل في إنشاء الوصفة الطبية")}}),className:"space-y-6",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"patient_id",className:"text-right block",children:["المريض ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsxs(el,{value:f.patient_id,onValueChange:e=>_("patient_id",e),children:[p.jsx(al,{className:"text-right bg-background border-input text-foreground "+(j.patient_id?"border-red-500":""),dir:"rtl",children:p.jsx(nl,{placeholder:"اختر مريض",className:"text-muted-foreground"})}),p.jsx(il,{children:u.map(e=>p.jsx(dl,{value:e.id,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Ai,{className:"w-4 h-4"}),e.full_name]})},e.id))})]}),j.patient_id&&p.jsx("p",{className:"text-sm text-red-500 text-right",children:j.patient_id})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"appointment_id",className:"text-right block",children:"الموعد (اختياري)"}),p.jsxs(el,{value:f.appointment_id,onValueChange:e=>_("appointment_id",e),disabled:!f.patient_id,children:[p.jsx(al,{className:"text-right bg-background border-input text-foreground",dir:"rtl",children:p.jsx(nl,{placeholder:f.patient_id?"اختر موعد":"اختر مريض أولاً",className:"text-muted-foreground"})}),p.jsx(il,{children:N.map(e=>p.jsx(dl,{value:e.id,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(hr,{className:"w-4 h-4"}),e.title]})},e.id))})]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"prescription_date",className:"text-right block",children:["تاريخ الوصفة ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx(Xi,{id:"prescription_date",type:"date",value:f.prescription_date,onChange:e=>_("prescription_date",e.target.value),className:"text-right "+(j.prescription_date?"border-red-500":""),dir:"rtl",disabled:i}),j.prescription_date&&p.jsx("p",{className:"text-sm text-red-500 text-right",children:j.prescription_date})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs(Ro,{className:"text-right text-lg font-medium",children:["الأدوية ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsxs(Qi,{type:"button",variant:"outline",size:"sm",onClick:k,disabled:i,children:[p.jsx(di,{className:"w-4 h-4 ml-2"}),"إضافة دواء"]})]}),j.medications&&p.jsx("p",{className:"text-sm text-red-500 text-right",children:j.medications}),p.jsxs("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:[y.map((e,t)=>p.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("span",{className:"text-sm font-medium",children:["دواء ",t+1]}),y.length>1&&p.jsx(Qi,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{b(t=>t.filter((t,n)=>n!==e))})(t),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:p.jsx(Ni,{className:"w-4 h-4"})})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"text-right block text-sm",children:["اسم الدواء ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsxs(el,{value:e.medication_id,onValueChange:e=>S(t,"medication_id",e),children:[p.jsx(al,{className:"text-right bg-background border-input text-foreground "+(j[`medication_${t}`]?"border-red-500":""),dir:"rtl",children:p.jsx(nl,{placeholder:"اختر دواء",className:"text-muted-foreground"})}),p.jsx(il,{children:l.map(e=>p.jsx(dl,{value:e.id,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(li,{className:"w-4 h-4"}),e.name]})},e.id))})]}),j[`medication_${t}`]&&p.jsx("p",{className:"text-sm text-red-500 text-right",children:j[`medication_${t}`]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"text-right block text-sm",children:["الجرعة ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx(Xi,{value:e.dose,onChange:e=>S(t,"dose",e.target.value),placeholder:"مثال: قرص واحد كل 8 ساعات",className:"text-right "+(j[`dose_${t}`]?"border-red-500":""),dir:"rtl",disabled:i}),j[`dose_${t}`]&&p.jsx("p",{className:"text-sm text-red-500 text-right",children:j[`dose_${t}`]})]})]}),e.medication_id&&(()=>{const t=l.find(t=>t.id===e.medication_id);return(null==t?void 0:t.instructions)?p.jsxs("div",{className:"bg-blue-50 p-2 rounded text-sm",children:[p.jsx("span",{className:"font-medium text-blue-800",children:"تعليمات الدواء: "}),p.jsx("span",{className:"text-blue-700",children:t.instructions})]}):null})()]},t)),0===y.length&&p.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-muted-foreground/25 rounded-lg",children:[p.jsx(li,{className:"w-12 h-12 mx-auto mb-2 text-muted-foreground opacity-50"}),p.jsx("p",{className:"text-muted-foreground",children:"لم يتم إضافة أي أدوية بعد"}),p.jsxs(Qi,{type:"button",variant:"outline",size:"sm",onClick:k,className:"mt-2",children:[p.jsx(di,{className:"w-4 h-4 ml-2"}),"إضافة دواء"]})]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"notes",className:"text-right block",children:"ملاحظات إضافية"}),p.jsx(Ji,{id:"notes",value:f.notes,onChange:e=>_("notes",e.target.value),placeholder:"أدخل أي ملاحظات إضافية للوصفة الطبية (اختياري)",className:"text-right min-h-[80px]",dir:"rtl",disabled:i})]}),p.jsxs(qi,{className:"flex justify-end space-x-2 space-x-reverse",children:[p.jsxs(Qi,{type:"button",variant:"outline",onClick:D,disabled:i,children:[p.jsx(Mi,{className:"w-4 h-4 ml-2"}),"إلغاء"]}),p.jsx(Qi,{type:"submit",disabled:i,className:"bg-green-600 hover:bg-green-700 text-white",children:i?p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحفظ..."]}):p.jsxs(p.Fragment,{children:[p.jsx(pi,{className:"w-4 h-4 ml-2"}),n?"تحديث الوصفة":"إنشاء الوصفة"]})})]})]})]})})}const Pf=ve.forwardRef((e,t)=>{var n=e,{checked:a=!1,onCheckedChange:s,disabled:r=!1,className:i,id:l}=n,u=c(n,["checked","onCheckedChange","disabled","className","id"]);const m=()=>{!r&&s&&s(!a)};return p.jsx("button",d(o({ref:t,id:l,type:"button",role:"switch","aria-checked":a,disabled:r,onClick:m,onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),m())},className:aa("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",a?"bg-primary":"bg-input",i)},u),{children:p.jsx("span",{className:aa("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",a?"translate-x-5":"translate-x-0")})}))});Pf.displayName="Switch";class Of{static calculateDateRange(e){const t=new Date,n=t.toISOString().split("T")[0];switch(e.date_range){case"last_month":return{from:new Date(t.getFullYear(),t.getMonth()-1,t.getDate()).toISOString().split("T")[0],to:n};case"last_3_months":return{from:new Date(t.getFullYear(),t.getMonth()-3,t.getDate()).toISOString().split("T")[0],to:n};case"last_6_months":return{from:new Date(t.getFullYear(),t.getMonth()-6,t.getDate()).toISOString().split("T")[0],to:n};case"last_year":return{from:new Date(t.getFullYear()-1,t.getMonth(),t.getDate()).toISOString().split("T")[0],to:n};case"custom":return{from:e.custom_start_date||n,to:e.custom_end_date||n};default:return{from:n,to:n}}}static filterPaymentsByDate(e,t){return e.filter(e=>{const n=e.payment_date;return n>=t.from&&n<=t.to})}static getPatientPendingPayments(e,t,n){return m(this,arguments,function*(e,t,n,a=[],s=[]){var r;try{const i=this.calculateDateRange(t),l=a||[],o=s||[],d=(n||[]).filter(t=>t.patient_id===e&&"pending"===t.status),c=this.filterPaymentsByDate(d,i),u=[];for(const e of c){const t=e.appointment_id?l.find(t=>t.id===e.appointment_id):void 0,n=e.tooth_treatment_id?o.find(t=>t.id===e.tooth_treatment_id):void 0,a=t?o.filter(e=>e.appointment_id===t.id):[],s=n||(1===a.length?a[0]:void 0),i=n?[n]:a,d=e.amount||0;let c,m=d,p=0,h=0;if(e.tooth_treatment_id?(p=e.treatment_total_cost||0,h=e.treatment_remaining_balance||0,m=h>0?h:p):e.appointment_id?(p=e.appointment_total_cost||e.total_amount_due||0,h=e.appointment_remaining_balance||e.remaining_balance||0,m=h>0?h:p):(p=e.total_amount_due||0,h=e.remaining_balance||0,0===d&&p>0?m=p:(0===d&&h>0||h>0)&&(m=h)),null==s?void 0:s.treatment_type){if(c=ad(s.treatment_type),c===s.treatment_type){c={pediatric_pulp_treatment:"معالجة لبية",pulp_therapy:"مداولة لبية",filling_metal:"حشو معدني",filling_cosmetic:"حشو تجميلي",crown_ceramic:"تاج خزفي",extraction_simple:"قلع بسيط"}[s.treatment_type]||s.treatment_type}}else i.length>0&&(c=i.map(e=>{let t=ad(e.treatment_type);if(t===e.treatment_type){t={pediatric_pulp_treatment:"معالجة لبية",pulp_therapy:"مداولة لبية",filling_metal:"حشو معدني",filling_cosmetic:"حشو تجميلي",crown_ceramic:"تاج خزفي",extraction_simple:"قلع بسيط"}[e.treatment_type]||e.treatment_type}return t}).join(", "));let x=e.description;if(x&&(x=x.replace(/\[علاج:[^\]]+\]/g,"").trim(),x=x.replace(/^\s*-\s*/,"").trim(),!x&&c&&(x=c)),!c&&x){const e={pediatric_pulp_treatment:"معالجة لبية","معالجة لبية":"معالجة لبية","علاج عصب":"علاج عصب","حشو":"حشو","تاج":"تاج","قلع":"قلع"};for(const[t,n]of Object.entries(e))if(x.includes(t)){c=n;break}}let g=e.notes;g&&(g=g.replace(/\[علاج:[^\]]+\]/g,"").trim(),g=g.replace(/^\s*-\s*/,"").trim());const f={id:e.id,patient_id:e.patient_id,appointment_id:e.appointment_id,tooth_treatment_id:e.tooth_treatment_id,appointment_date:null==(r=null==t?void 0:t.start_time)?void 0:r.split("T")[0],appointment_title:null==t?void 0:t.title,treatment_type:c,tooth_number:null==s?void 0:s.tooth_number,tooth_name:null==s?void 0:s.tooth_name,amount:this.roundToTwoDecimals(m),description:x,payment_date:e.payment_date,notes:g,discount_amount:this.roundToTwoDecimals(e.discount_amount||0),tax_amount:this.roundToTwoDecimals(e.tax_amount||0),total_amount:this.roundToTwoDecimals(e.total_amount||m),treatment_total_cost:e.treatment_total_cost,treatment_remaining_balance:e.treatment_remaining_balance,appointment_total_cost:e.appointment_total_cost,appointment_remaining_balance:e.appointment_remaining_balance};u.push(f)}return u.sort((e,t)=>new Date(e.payment_date).getTime()-new Date(t.payment_date).getTime())}catch(i){throw console.error("خطأ في جلب المدفوعات المعلقة:",i),new Error("فشل في جلب المدفوعات المعلقة")}})}static calculatePendingPaymentsSummary(e,t,n,a,s){const r=this.roundToTwoDecimals(n.reduce((e,t)=>e+t.amount,0));let i=0;a.apply_discount&&a.discount_value>0&&(i="percentage"===a.discount_type?this.roundToTwoDecimals(r*a.discount_value/100):this.roundToTwoDecimals(Math.min(a.discount_value,r)));const l=this.roundToTwoDecimals(r-i);let o=0;a.include_tax&&a.tax_rate>0&&(o=this.roundToTwoDecimals(l*a.tax_rate/100));const d=this.roundToTwoDecimals(l+o);return{patient_id:e,patient_name:t,total_pending_amount:r,total_items:n.length,items:n,subtotal:r,total_discount:i,total_tax:o,final_total:d,date_range:s}}static roundToTwoDecimals(e){return Math.round(100*(e+Number.EPSILON))/100}static generateInvoiceNumber(){const e=new Date;return`INV-${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}-${String(e.getHours()).padStart(2,"0")+String(e.getMinutes()).padStart(2,"0")}-${Math.floor(1e3*Math.random()).toString().padStart(3,"0")}`}static createComprehensiveInvoiceData(e,t,n,a){return{invoice_number:this.generateInvoiceNumber(),invoice_date:(new Date).toISOString().split("T")[0],patient:e,summary:t,settings:n,clinic_info:a,generated_at:(new Date).toISOString()}}static validateFinancialData(e){const t=this.roundToTwoDecimals(e.items.reduce((e,t)=>e+t.amount,0));if(Math.abs(t-e.subtotal)>.01)return console.error("خطأ في حساب المجموع الفرعي"),!1;const n=this.roundToTwoDecimals(e.subtotal-e.total_discount+e.total_tax);return!(Math.abs(n-e.final_total)>.01)||(console.error("خطأ في حساب المجموع النهائي"),!1)}}function Rf({patient:e,open:t,onOpenChange:n}){const{toast:a}=yl(),{payments:s,updatePayment:r}=Go(),{appointments:i}=Wo(),{toothTreatments:l,loadToothTreatments:c,loadToothTreatmentsByPatient:u}=Ko(),{settings:h}=qt(),[x,g]=ve.useState(!1),[f,v]=ve.useState(null),[y,b]=ve.useState(null);ve.useState(!1);const[j,w]=ve.useState({date_range:"last_3_months"}),[N,_]=ve.useState({apply_discount:!1,discount_type:"percentage",discount_value:0,discount_reason:"",include_tax:!1,tax_rate:0,include_clinic_logo:!0,include_patient_details:!0,include_payment_terms:!0,payment_terms_text:"",footer_notes:"شكراً لثقتكم بنا"}),[k,S]=ve.useState({printerType:"80mm",includeQR:!0,includeBarcode:!0,includeLogo:!0,colorMode:"color",qrType:"text"}),[D,$]=ve.useState(!1),[C,E]=ve.useState(""),[T,A]=ve.useState(""),F=ve.useRef(null),P=()=>{if(!f||!e)return"";const t=O(),n=e.full_name||"غير محدد",a=e.phone||"غير محدد",s=e.id.toString().padStart(4,"0"),r=ma((new Date).toISOString().split("T")[0]),i=(null==h?void 0:h.clinic_name)||"عيادة الأسنان",l=(null==h?void 0:h.doctor_name)||"الطبيب",o=(null==h?void 0:h.clinic_phone)||"غير محدد",d=(null==h?void 0:h.clinic_address)||"غير محدد",c=ca(f.subtotal),u=f.total_discount>0?ca(f.total_discount):"0",m=f.total_tax>0?ca(f.total_tax):"0",p=ca(f.final_total),x=f.items.length;return`🏥 ${i}\n👨‍⚕️ د. ${l}\n📞 ${o}\n📍 ${d}\n\n📋 فاتورة المدفوعات المعلقة\n🔢 رقم الفاتورة: ${t}\n📅 تاريخ الإصدار: ${r}\n📅 فترة الفاتورة: ${`${ma(f.date_range.from)} - ${ma(f.date_range.to)}`}\n\n👤 بيانات المريض:\n🆔 رقم المريض: ${s}\n👤 الاسم: ${n}\n📞 الهاتف: ${a}\n\n📋 تفاصيل العناصر (${x} عنصر):\n${f.items.slice(0,3).map((e,t)=>`${t+1}. ${e.appointment_title||e.treatment_type||e.description} - ${ca(e.amount)}${e.tooth_name?` (🦷 ${e.tooth_name})`:""}`).join("\n")}${f.items.length>3?`\n... و ${f.items.length-3} عنصر إضافي`:""}\n\n💰 ملخص المبالغ:\nالمجموع الفرعي: ${c}\nالخصم: ${u}\nالضريبة: ${m}\n━━━━━━━━━━━━━━━━━━━━\nالمجموع النهائي: ${p}\n\n${N.discount_reason?`💸 سبب الخصم: ${N.discount_reason}\n`:""}${N.notes?`📝 ملاحظات: ${N.notes}\n`:""}\n🙏 شكراً لثقتكم بنا\n⏰ تم الإنشاء: ${(new Date).toLocaleString("ar-EG")}`},O=()=>{if(!f||!e)return"";const t=Date.now().toString();return`INV${e.id.toString().padStart(4,"0")}${f.items.length.toString().padStart(2,"0")}${Math.round(f.final_total).toString().padStart(6,"0")}${t.slice(-4)}`},R=()=>m(this,null,function*(){if(k.includeQR&&f&&e)try{const e=P();if(console.log("QR Code Data:",e),!e)return void console.error("QR Code: لا توجد بيانات للتوليد");const t=yield gt.toDataURL(e,{width:"a4"===k.printerType?120:80,margin:1,color:{dark:"#000000",light:"#FFFFFF"}});console.log("QR Code تم توليده بنجاح:",t.substring(0,50)+"..."),E(t)}catch(t){console.error("خطأ في توليد QR Code:",t)}else console.log("QR Code: شروط التوليد غير مكتملة",{includeQR:k.includeQR,pendingSummary:!!f,patient:!!e})}),M=()=>m(this,null,function*(){if(k.includeBarcode&&f)try{const e=document.createElement("canvas"),t=O();if(console.log("Barcode Data:",t),!t)return void console.error("Barcode: لا توجد بيانات للتوليد");ft(e,t,{format:"CODE128",width:"a4"===k.printerType?2:1,height:"a4"===k.printerType?50:30,displayValue:!0,fontSize:"a4"===k.printerType?12:8,margin:5});const n=e.toDataURL();console.log("Barcode تم توليده بنجاح:",n.substring(0,50)+"..."),A(n)}catch(e){console.error("خطأ في توليد الباركود:",e)}else console.log("Barcode: شروط التوليد غير مكتملة",{includeBarcode:k.includeBarcode,pendingSummary:!!f})});ve.useEffect(()=>{t&&e&&Promise.all([c(),u(e.id)]).then(()=>{L()}).catch(e=>{console.error("خطأ في تحميل البيانات:",e),L()})},[t,e,j]),ve.useEffect(()=>{f&&e&&(R(),M())},[f,k.includeQR,k.includeBarcode,k.printerType]),ve.useEffect(()=>{f&&e&&I()},[N]);const L=()=>m(this,null,function*(){if(e){g(!0);try{const t={payments:!!s&&s.length>0,appointments:!!i&&i.length>0,toothTreatments:!!l&&l.length>0};console.log("حالة البيانات:",t),s&&i&&l||console.warn("بعض البيانات المطلوبة غير متوفرة:",{payments:!!s,appointments:!!i,toothTreatments:!!l});const n=yield Of.getPatientPendingPayments(e.id,j,s||[],i||[],l||[]),a=Of.calculateDateRange(j),r=Of.calculatePendingPaymentsSummary(e.id,e.full_name,n,N,a);if(!Of.validateFinancialData(r))throw new Error("خطأ في حساب البيانات المالية");v(r);const o=Of.createComprehensiveInvoiceData(e,r,N,h);b(o)}catch(t){console.error("خطأ في تحميل المدفوعات المعلقة:",t),a({title:"خطأ",description:"فشل في تحميل المدفوعات المعلقة",variant:"destructive"})}finally{g(!1)}}}),I=()=>{if(!f||!e)return;const t=Of.calculateDateRange(j),n=Of.calculatePendingPaymentsSummary(e.id,e.full_name,f.items,N,t);v(n),y&&b(d(o({},y),{summary:n,settings:N}))},z=(e,t)=>{w(n=>d(o({},n),{[e]:t})),setTimeout(()=>{L()},100)},B=(e,t)=>{_(n=>d(o({},n),{[e]:t}))},Y=()=>m(this,null,function*(){if(y)try{g(!0),yield Mh.exportComprehensivePendingInvoice(y),a({title:"تم بنجاح",description:"تم تصدير الفاتورة كملف PDF",variant:"default"})}catch(e){console.error("خطأ في تصدير PDF:",e),a({title:"خطأ",description:"فشل في تصدير الفاتورة كـ PDF",variant:"destructive"})}finally{g(!1)}else a({title:"خطأ",description:"لا توجد بيانات فاتورة للتصدير",variant:"destructive"})});return e?p.jsx(Ii,{open:t,onOpenChange:n,children:p.jsxs(Yi,{className:"max-w-[95vw] max-h-[95vh] p-0",children:[p.jsx(Vi,{className:"p-4 border-b",children:p.jsxs(Ui,{className:"flex items-center justify-between",children:[p.jsxs("span",{className:"flex items-center gap-2",children:[p.jsx(Pr,{className:"w-5 h-5"}),"فاتورة المدفوعات المعلقة الشاملة"]}),p.jsx(qo,{variant:"outline",className:"text-sm",children:e.full_name})]})}),p.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 h-[calc(95vh-100px)]",children:[p.jsxs("div",{className:"col-span-3 space-y-3",children:[p.jsx(Lo,{className:"p-3",children:p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"text-xs font-medium flex items-center gap-1",children:[p.jsx(Or,{className:"w-3 h-3"}),"فلتر التاريخ"]}),p.jsxs(el,{value:j.date_range,onValueChange:e=>z("date_range",e),children:[p.jsx(al,{className:"h-8 text-xs",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"last_month",children:"آخر شهر"}),p.jsx(dl,{value:"last_3_months",children:"آخر 3 أشهر"}),p.jsx(dl,{value:"last_6_months",children:"آخر 6 أشهر"}),p.jsx(dl,{value:"last_year",children:"آخر سنة"}),p.jsx(dl,{value:"custom",children:"تاريخ مخصص"})]})]}),"custom"===j.date_range&&p.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[p.jsxs("div",{children:[p.jsx(Ro,{className:"text-xs",children:"من"}),p.jsx(Xi,{type:"date",className:"h-8 text-xs",value:j.custom_start_date||"",onChange:e=>z("custom_start_date",e.target.value)})]}),p.jsxs("div",{children:[p.jsx(Ro,{className:"text-xs",children:"إلى"}),p.jsx(Xi,{type:"date",className:"h-8 text-xs",value:j.custom_end_date||"",onChange:e=>z("custom_end_date",e.target.value)})]})]})]})}),p.jsx(Lo,{className:"p-3",children:p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"text-xs font-medium flex items-center gap-1",children:[p.jsx(mr,{className:"w-3 h-3"}),"الخصومات والضرائب"]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx(Ro,{className:"text-xs",children:"تطبيق خصم"}),p.jsx(Pf,{checked:N.apply_discount,onCheckedChange:e=>B("apply_discount",e)})]}),N.apply_discount&&p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[p.jsxs("div",{children:[p.jsx(Ro,{className:"text-xs",children:"نوع الخصم"}),p.jsxs(el,{value:N.discount_type,onValueChange:e=>B("discount_type",e),children:[p.jsx(al,{className:"h-8 text-xs",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"percentage",children:"نسبة مئوية"}),p.jsx(dl,{value:"fixed",children:"مبلغ ثابت"})]})]})]}),p.jsxs("div",{children:[p.jsxs(Ro,{className:"text-xs",children:["قيمة الخصم ","percentage"===N.discount_type?"(%)":"(مبلغ)"]}),p.jsx(Xi,{type:"number",min:"0",step:"1",className:"h-8 text-xs",value:N.discount_value,onChange:e=>{const t=e.target.value;B("discount_value",""===t?0:parseFloat(t)||0)},onBlur:e=>{const t=parseFloat(e.target.value)||0;B("discount_value",t)}})]})]}),p.jsxs("div",{children:[p.jsx(Ro,{className:"text-xs",children:"سبب الخصم"}),p.jsx(Xi,{className:"h-8 text-xs",value:N.discount_reason||"",onChange:e=>B("discount_reason",e.target.value),placeholder:"اختياري"})]})]}),p.jsx(ux,{}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx(Ro,{className:"text-xs",children:"تضمين ضريبة"}),p.jsx(Pf,{checked:N.include_tax,onCheckedChange:e=>B("include_tax",e)})]}),N.include_tax&&p.jsxs("div",{children:[p.jsx(Ro,{className:"text-xs",children:"معدل الضريبة (%)"}),p.jsx(Xi,{type:"number",min:"0",max:"100",step:"1",className:"h-8 text-xs",value:N.tax_rate,onChange:e=>{const t=e.target.value;B("tax_rate",""===t?0:parseFloat(t)||0)},onBlur:e=>{const t=parseFloat(e.target.value)||0;B("tax_rate",t)}})]})]})}),p.jsx(Lo,{className:"p-3",children:p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs(Ro,{className:"text-xs font-medium flex items-center gap-1",children:[p.jsx(xi,{className:"w-3 h-3"}),"إعدادات الطباعة"]}),p.jsxs(Qi,{variant:"ghost",size:"sm",onClick:()=>$(!D),className:"text-xs h-6 px-2",children:[p.jsx(Fr,{className:"w-3 h-3 ml-1"}),D?"إخفاء":"معاينة"]})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{className:"space-y-1",children:[p.jsx(Ro,{className:"text-xs",children:"نوع الطابعة"}),p.jsxs(el,{value:k.printerType,onValueChange:e=>S(t=>d(o({},t),{printerType:e})),children:[p.jsx(al,{className:"h-8 text-xs",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"58mm",children:"حرارية 58mm"}),p.jsx(dl,{value:"80mm",children:"حرارية 80mm"}),p.jsx(dl,{value:"a4",children:"عادية A4"})]})]})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsx(Ro,{className:"text-xs",children:"نمط الألوان"}),p.jsxs(el,{value:k.colorMode,onValueChange:e=>S(t=>d(o({},t),{colorMode:e})),children:[p.jsx(al,{className:"h-8 text-xs",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"color",children:"ملون"}),p.jsx(dl,{value:"bw",children:"أبيض وأسود"})]})]})]})]}),p.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("input",{type:"checkbox",id:"includeLogo",checked:k.includeLogo,onChange:e=>S(t=>d(o({},t),{includeLogo:e.target.checked})),className:"rounded border-gray-300"}),p.jsx(Ro,{htmlFor:"includeLogo",className:"text-xs",children:"تضمين الشعار"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("input",{type:"checkbox",id:"includeQR",checked:k.includeQR,onChange:e=>S(t=>d(o({},t),{includeQR:e.target.checked})),className:"rounded border-gray-300"}),p.jsx(Ro,{htmlFor:"includeQR",className:"text-xs",children:"QR Code"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("input",{type:"checkbox",id:"includeBarcode",checked:k.includeBarcode,onChange:e=>S(t=>d(o({},t),{includeBarcode:e.target.checked})),className:"rounded border-gray-300"}),p.jsx(Ro,{htmlFor:"includeBarcode",className:"text-xs",children:"تضمين الباركود"})]})]}),D&&(k.includeQR||k.includeBarcode)&&p.jsxs("div",{className:"mt-3 p-2 border rounded bg-muted/20",children:[p.jsx(Ro,{className:"text-xs font-medium",children:"معاينة:"}),p.jsxs("div",{className:"flex justify-center gap-4 mt-2",children:[k.includeQR&&p.jsxs("div",{className:"text-center",children:[C?p.jsx("img",{src:C,alt:"QR Code",className:"w-16 h-16 mx-auto border"}):p.jsx("div",{className:"w-16 h-16 mx-auto border flex items-center justify-center bg-gray-100",children:p.jsx("span",{className:"text-xs",children:"QR"})}),p.jsx("p",{className:"text-xs mt-1",children:"QR Code"})]}),k.includeBarcode&&p.jsxs("div",{className:"text-center",children:[T?p.jsx("img",{src:T,alt:"Barcode",className:"h-8 mx-auto border",style:{width:"auto"}}):p.jsx("div",{className:"w-20 h-8 mx-auto border flex items-center justify-center bg-gray-100",children:p.jsx("span",{className:"text-xs",children:"|||"})}),p.jsx("p",{className:"text-xs mt-1",children:"باركود"})]})]})]})]})}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Qi,{onClick:()=>m(this,null,function*(){if(f&&e)try{g(!0);const e=f.items.filter(e=>!e.id.startsWith("unpaid-")).map(e=>m(this,null,function*(){const t=s.find(t=>t.id===e.id);if(!t)return;let n=0,a={status:"completed",payment_date:(new Date).toISOString().split("T")[0],notes:`تم التأكيد عبر الفاتورة الشاملة - ${(new Date).toLocaleDateString("ar-SA")}`};return t.tooth_treatment_id?(n=t.treatment_total_cost||e.amount||0,a=d(o({},a),{amount:n,treatment_total_paid:n,treatment_remaining_balance:0})):t.appointment_id?(n=t.appointment_total_cost||t.total_amount_due||e.amount||0,a=d(o({},a),{amount:n,appointment_total_paid:n,appointment_remaining_balance:0,amount_paid:n,remaining_balance:0})):(n=t.total_amount_due||t.remaining_balance||e.amount||0,a=d(o({},a),{amount:n,amount_paid:n,remaining_balance:0})),r(e.id,a)}));yield Promise.all(e),a({title:"تم بنجاح",description:`تم تأكيد ${e.length} دفعة كمكتملة وتحديث المبالغ المالية`,variant:"default"}),yield L(),v(null),b(null),setTimeout(()=>m(this,null,function*(){try{yield Y()}catch(e){console.error("خطأ في التصدير التلقائي للـ PDF:",e)}}),1e3)}catch(t){console.error("خطأ في تحديث المدفوعات:",t),a({title:"خطأ",description:"فشل في تحديث المدفوعات",variant:"destructive"})}finally{g(!1)}}),disabled:x||!f||0===f.items.length,className:"w-full h-8 text-xs",variant:"default",children:[p.jsx(gr,{className:"w-3 h-3 mr-1"}),"تأكيد دفع الكل"]}),p.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[p.jsxs(Qi,{onClick:()=>m(this,null,function*(){if(!f||!e)return;console.log("بدء الطباعة الحرارية..."),console.log("إعدادات الطباعة:",k),console.log("بيانات المريض:",e.full_name),console.log("ملخص المدفوعات:",f.final_total);let t=C,n=T;if(k.includeQR)try{const e=P();console.log("QR Code Data:",e),e&&(t=yield gt.toDataURL(e,{width:"a4"===k.printerType?120:80,margin:1,color:{dark:"#000000",light:"#FFFFFF"}}),console.log("QR Code تم توليده للطباعة:",t.substring(0,50)+"..."))}catch(s){console.error("خطأ في توليد QR Code للطباعة:",s)}if(k.includeBarcode)try{const e=document.createElement("canvas"),t=O();console.log("Barcode Data:",t),t&&(ft(e,t,{format:"CODE128",width:"a4"===k.printerType?2:1,height:"a4"===k.printerType?50:30,displayValue:!0,fontSize:"a4"===k.printerType?12:8,margin:5}),n=e.toDataURL(),console.log("Barcode تم توليده للطباعة:",n.substring(0,50)+"..."))}catch(s){console.error("خطأ في توليد الباركود للطباعة:",s)}console.log("QR Code للطباعة:",t?"موجود":"غير موجود"),console.log("Barcode للطباعة:",n?"موجود":"غير موجود");const a=window.open("","_blank");if(a){const s=`INV-${Date.now().toString().slice(-6)}`,r=ma((new Date).toISOString().split("T")[0]),i="a4"===k.printerType?"210mm":"58mm"===k.printerType?"58mm":"80mm",l="a4"===k.printerType?"200mm":"58mm"===k.printerType?"54mm":"76mm",o=`\n        <html>\n          <head>\n            <title>فاتورة المدفوعات المعلقة - ${s}</title>\n            <meta charset="UTF-8">\n            <style>\n              @page {\n                size: ${i} auto;\n                margin: 0;\n              }\n              body {\n                font-family: 'Courier New', monospace;\n                direction: rtl;\n                margin: 0;\n                padding: 2mm;\n                font-size: ${"a4"===k.printerType?"12px":"10px"};\n                line-height: 1.2;\n                color: #000;\n                background: white;\n                width: ${l};\n              }\n              .receipt {\n                width: 100%;\n                font-size: 10px;\n              }\n              .header {\n                text-align: center;\n                margin-bottom: 4px;\n                border-bottom: 1px solid #000;\n                padding-bottom: 2px;\n              }\n              .clinic-name {\n                font-size: 12px;\n                font-weight: bold;\n                margin-bottom: 1px;\n              }\n              .doctor-name {\n                font-size: 10px;\n                font-weight: bold;\n              }\n              .contact-info {\n                font-size: 8px;\n                margin: 1px 0;\n              }\n              .receipt-info {\n                margin: 3px 0;\n                font-size: 9px;\n              }\n              .patient-info {\n                margin: 3px 0;\n                padding: 2px 0;\n                border-top: 1px dashed #000;\n                border-bottom: 1px dashed #000;\n              }\n              .items {\n                margin: 3px 0;\n              }\n              .item {\n                margin: 2px 0;\n                padding: 1px 0;\n                border-bottom: 1px dotted #ccc;\n              }\n              .item-header {\n                font-weight: bold;\n                font-size: 9px;\n              }\n              .item-details {\n                font-size: 8px;\n                color: #666;\n                margin: 1px 0;\n              }\n              .item-amount {\n                text-align: left;\n                font-weight: bold;\n              }\n              .totals {\n                margin: 3px 0;\n                border-top: 1px solid #000;\n                padding-top: 2px;\n              }\n              .total-line {\n                display: flex;\n                justify-content: space-between;\n                margin: 1px 0;\n              }\n              .final-total {\n                font-weight: bold;\n                font-size: 11px;\n                border-top: 1px solid #000;\n                padding-top: 2px;\n                margin-top: 2px;\n              }\n              .footer {\n                text-align: center;\n                margin-top: 4px;\n                padding-top: 2px;\n                border-top: 1px dashed #000;\n                font-size: 8px;\n              }\n              .dashed-line {\n                border-top: 1px dashed #000;\n                margin: 2px 0;\n              }\n            </style>\n          </head>\n          <body>\n            <div class="receipt">\n              <div class="header">\n                ${k.includeLogo&&(null==h?void 0:h.clinic_logo)?`\n                  <div style="text-align: center; margin-bottom: 5px;">\n                    <img src="${h.clinic_logo}" alt="شعار العيادة" style="width: ${"a4"===k.printerType?"60px":"40px"}; height: ${"a4"===k.printerType?"60px":"40px"}; border-radius: 50%; border: 1px solid #000;" />\n                  </div>\n                `:""}\n                <div class="clinic-name">${(null==h?void 0:h.clinic_name)||"عيادة الأسنان"}</div>\n                <div class="doctor-name">د. ${(null==h?void 0:h.doctor_name)||"اسم الطبيب"}</div>\n                <div class="contact-info">${(null==h?void 0:h.clinic_phone)||"رقم الهاتف"}</div>\n                <div class="contact-info">${(null==h?void 0:h.clinic_address)||"العنوان"}</div>\n              </div>\n\n              <div class="receipt-info">\n                <div><strong>فاتورة المدفوعات المعلقة</strong></div>\n                <div>رقم الفاتورة: ${s}</div>\n                <div>التاريخ: ${r}</div>\n              </div>\n\n              <div class="patient-info">\n                <div><strong>بيانات المريض:</strong></div>\n                <div>الاسم: ${e.full_name}</div>\n                <div>الهاتف: ${e.phone||"غير محدد"}</div>\n              </div>\n\n              <div class="items">\n                <div><strong>تفاصيل المدفوعات المعلقة:</strong></div>\n                ${f.items.map((e,t)=>`\n                  <div class="item">\n                    <div class="item-header">\n                      ${t+1}. ${e.appointment_title||e.treatment_type||e.description}\n                    </div>\n                    <div class="item-details">\n                      ${e.payment_date?`📅 تاريخ الدفعة: ${ma(e.payment_date)}`:""}\n                      ${e.appointment_date?`<br>📅 تاريخ الموعد: ${ma(e.appointment_date)}`:""}\n                      ${e.treatment_type?`<br>🔧 نوع العلاج: ${e.treatment_type}`:""}\n                      ${e.tooth_name?`<br>🦷 ${e.tooth_name} (${e.tooth_number})`:""}\n                      ${e.doctor_name?`<br>👨‍⚕️ الطبيب: ${e.doctor_name}`:""}\n                      ${e.notes?`<br>📝 ملاحظات: ${e.notes}`:""}\n                      ${e.payment_method?`<br>💳 طريقة الدفع: ${e.payment_method}`:""}\n                      ${e.discount_amount&&e.discount_amount>0?`<br><span style="color: #dc2626;">💰 خصم: ${ca(e.discount_amount)}</span>`:""}\n                    </div>\n                    <div class="item-amount">${ca(e.amount)}</div>\n                  </div>\n                `).join("")}\n              </div>\n\n              \x3c!-- تفاصيل إضافية للفاتورة --\x3e\n              <div class="invoice-details" style="margin: 10px 0; padding: 5px 0; border-top: 1px dashed #000;">\n                <div style="font-size: 9px; color: #666;">\n                  <div>📊 إجمالي العناصر: ${f.items.length}</div>\n                  <div>📅 فترة الفاتورة: ${ma(f.date_range.from)} - ${ma(f.date_range.to)}</div>\n                  ${N.discount_reason?`<div>💸 سبب الخصم: ${N.discount_reason}</div>`:""}\n                  ${N.notes?`<div>📝 ملاحظات: ${N.notes}</div>`:""}\n                </div>\n              </div>\n\n              <div class="totals">\n                <div class="total-line">\n                  <span>المجموع الفرعي:</span>\n                  <span>${ca(f.subtotal)}</span>\n                </div>\n                ${f.total_discount>0?`\n                  <div class="total-line">\n                    <span>الخصم:</span>\n                    <span>-${ca(f.total_discount)}</span>\n                  </div>\n                `:""}\n                ${f.total_tax>0?`\n                  <div class="total-line">\n                    <span>الضريبة:</span>\n                    <span>+${ca(f.total_tax)}</span>\n                  </div>\n                `:""}\n                <div class="total-line final-total">\n                  <span>المجموع النهائي:</span>\n                  <span>${ca(f.final_total)}</span>\n                </div>\n              </div>\n\n              ${k.includeQR?`\n                <div style="text-align: center; margin: 10px 0; border-top: 1px dashed #000; padding-top: 5px;">\n                  ${t?`\n                    <img src="${t}" alt="QR Code" style="width: ${"a4"===k.printerType?"80px":"60px"}; height: ${"a4"===k.printerType?"80px":"60px"}; margin: 0 auto;" />\n                    <div style="font-size: 8px; color: #666; margin-top: 2px;">امسح للتحقق من الفاتورة الكاملة</div>\n                    <div style="font-size: 7px; color: #999; margin-top: 1px;">\n                      يحتوي على: تفاصيل العيادة | بيانات المريض | ${f.items.length} عنصر | المبلغ الإجمالي\n                    </div>\n                    <div style="font-size: 7px; color: #999; margin-top: 1px;">\n                      رقم الفاتورة: ${O()}\n                    </div>\n                  `:`\n                    <div style="border: 1px solid #000; width: ${"a4"===k.printerType?"80px":"60px"}; height: ${"a4"===k.printerType?"80px":"60px"}; margin: 0 auto; display: flex; align-items: center; justify-content: center;">\n                      <div style="font-size: 8px; text-align: center;">QR Code<br/>غير متوفر</div>\n                    </div>\n                  `}\n                </div>\n              `:""}\n\n              ${k.includeBarcode?`\n                <div style="text-align: center; margin: 5px 0;">\n                  ${n?`\n                    <img src="${n}" alt="باركود الفاتورة" style="width: ${"a4"===k.printerType?"120px":"100px"}; height: ${"a4"===k.printerType?"30px":"20px"}; margin: 0 auto;" />\n                    <div style="font-size: 8px; color: #666; margin-top: 2px;">${O()}</div>\n                    <div style="font-size: 7px; color: #999; margin-top: 1px;">\n                      المريض: ${e.id.toString().padStart(4,"0")} | العناصر: ${f.items.length.toString().padStart(2,"0")} | المبلغ: ${Math.round(f.final_total).toString().padStart(6,"0")}\n                    </div>\n                  `:`\n                    <div style="border: 1px solid #000; width: ${"a4"===k.printerType?"120px":"100px"}; height: ${"a4"===k.printerType?"30px":"20px"}; margin: 0 auto; display: flex; align-items: center; justify-content: center;">\n                      <div style="font-size: 8px;">باركود غير متوفر</div>\n                    </div>\n                  `}\n                </div>\n              `:""}\n\n              <div class="footer">\n                <div>شكراً لثقتكم بنا</div>\n                <div class="dashed-line"></div>\n                <div>تم الطباعة: ${(new Date).toLocaleString("ar-EG")}</div>\n              </div>\n            </div>\n          </body>\n        </html>\n      `;a.document.write(o),a.document.close(),a.onload=()=>{setTimeout(()=>{a.print()},1e3)},setTimeout(()=>{a.print()},2e3)}}),disabled:!f,variant:"outline",className:"h-8 text-xs",children:[p.jsx(ci,{className:"w-3 h-3 mr-1"}),"طباعة حرارية"]}),p.jsxs(Qi,{onClick:()=>m(this,null,function*(){var t,n;if(!f||!e)return;let s=e.phone||"";if(s=s.replace(/\D/g,""),!s)return void a({title:"خطأ",description:"رقم هاتف المريض غير متوفر",variant:"destructive"});s.startsWith("963")||(s="963"+s);const r=(null==h?void 0:h.clinic_name)||"عيادة الأسنان",i=(null==h?void 0:h.doctor_name)||"الطبيب",l=`INV-${Date.now().toString().slice(-6)}`,o=ma((new Date).toISOString().split("T")[0]);let d=`🏥 *${r}*\n`;d+=`👨‍⚕️ د. ${i}\n\n`,d+="📋 *فاتورة المدفوعات المعلقة*\n",d+=`🔢 رقم الفاتورة: ${l}\n`,d+=`📅 التاريخ: ${o}\n\n`,d+="👤 *بيانات المريض:*\n",d+=`الاسم: ${e.full_name}\n\n`,d+="💰 *تفاصيل المدفوعات المعلقة:*\n",f.items.forEach((e,t)=>{d+=`\n${t+1}. ${e.appointment_title||e.treatment_type||e.description}\n`,e.payment_date&&(d+=`   📅 تاريخ الدفعة: ${ma(e.payment_date)}\n`),e.appointment_date&&(d+=`   📅 تاريخ الموعد: ${ma(e.appointment_date)}\n`),e.treatment_type&&(d+=`   🔧 ${e.treatment_type}\n`),e.tooth_name&&(d+=`   🦷 ${e.tooth_name} (${e.tooth_number})\n`),d+=`   💵 ${ca(e.amount)}\n`}),d+="\n📊 *ملخص المبالغ:*\n",d+=`المجموع الفرعي: ${ca(f.subtotal)}\n`,f.total_discount>0&&(d+=`الخصم: -${ca(f.total_discount)}\n`),f.total_tax>0&&(d+=`الضريبة: +${ca(f.total_tax)}\n`),d+=`*المجموع النهائي: ${ca(f.final_total)}*\n\n`,d+="🙏 شكراً لثقتكم بنا";const c=`https://wa.me/${s}?text=${encodeURIComponent(d)}`;try{if(window.electronAPI&&window.electronAPI.system&&window.electronAPI.system.openExternal)return yield window.electronAPI.system.openExternal(c),void a({title:"تم بنجاح",description:"تم فتح الواتساب خارجياً لإرسال الفاتورة",variant:"default"})}catch(u){console.log("Method 1 failed:",u)}try{if(window.electronAPI)return yield null==(n=null==(t=window.electronAPI.shell)?void 0:t.openExternal)?void 0:n.call(t,c),void a({title:"تم بنجاح",description:"تم فتح الواتساب خارجياً لإرسال الفاتورة",variant:"default"})}catch(u){console.log("Method 2 failed:",u)}window.open(c,"_blank","noopener,noreferrer"),a({title:"تم بنجاح",description:"تم فتح الواتساب في المتصفح لإرسال الفاتورة",variant:"default"})}),disabled:!f,variant:"outline",className:"h-8 text-xs",children:[p.jsx(Zr,{className:"w-3 h-3 mr-1"}),"واتساب"]})]}),p.jsxs(Qi,{onClick:Y,disabled:!f,variant:"outline",className:"w-full h-8 text-xs",children:[p.jsx(Tr,{className:"w-3 h-3 mr-1"}),"تصدير PDF"]})]})]}),p.jsx("div",{className:"col-span-9 overflow-y-auto",children:x?p.jsx("div",{className:"flex items-center justify-center h-40",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"جاري تحميل المدفوعات المعلقة..."}),p.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"يرجى الانتظار"})]})}):f?p.jsxs("div",{ref:F,className:"space-y-4 p-4",children:[p.jsxs("div",{className:"text-center border-b pb-3",children:[p.jsx("h2",{className:"text-xl font-bold",children:"فاتورة المدفوعات المعلقة الشاملة"}),p.jsxs("div",{className:"flex justify-center gap-4 text-sm text-muted-foreground mt-1",children:[p.jsxs("span",{children:["رقم الفاتورة: ",null==y?void 0:y.invoice_number]}),p.jsxs("span",{children:["تاريخ الإصدار: ",ma((null==y?void 0:y.invoice_date)||"")]})]})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{className:"p-3 border rounded-lg",children:[p.jsx("h3",{className:"text-sm font-medium mb-2",children:"معلومات المريض"}),p.jsxs("div",{className:"text-xs space-y-1",children:[p.jsxs("p",{children:[p.jsx("strong",{children:"الاسم:"})," ",e.full_name]}),p.jsxs("p",{children:[p.jsx("strong",{children:"الهاتف:"})," ",e.phone]}),e.email&&p.jsxs("p",{children:[p.jsx("strong",{children:"الإيميل:"})," ",e.email]})]})]}),p.jsxs("div",{className:"p-3 border rounded-lg",children:[p.jsx("h3",{className:"text-sm font-medium mb-2",children:"معلومات العيادة"}),p.jsxs("div",{className:"text-xs space-y-1",children:[p.jsxs("p",{children:[p.jsx("strong",{children:"اسم العيادة:"})," ",h.clinic_name]}),h.clinic_phone&&p.jsxs("p",{children:[p.jsx("strong",{children:"الهاتف:"})," ",h.clinic_phone]}),h.clinic_address&&p.jsxs("p",{children:[p.jsx("strong",{children:"العنوان:"})," ",h.clinic_address]})]})]})]}),p.jsxs("div",{className:"border rounded-lg p-3",children:[p.jsxs("div",{className:"flex items-center justify-between mb-3",children:[p.jsx("h3",{className:"text-sm font-medium",children:"تفاصيل المدفوعات المعلقة الشاملة"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(qo,{variant:"secondary",className:"text-xs",children:[f.total_items," عنصر"]}),p.jsxs("span",{className:"text-xs text-muted-foreground",children:[ma(f.date_range.from)," - ",ma(f.date_range.to)]})]})]}),p.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:f.items.map((e,t)=>{let n="عام",a="💰",s="دفعة معلقة",r=e.description;return r&&(r=r.replace(/\[علاج:[^\]]+\]/g,"").trim(),r=r.replace(/^\s*-\s*/,"").trim()),e.tooth_treatment_id?(n="علاج",a="🦷",s=e.treatment_type||r||"علاج سن"):e.appointment_id?(n="موعد",a="📅",s=e.appointment_title||r||"موعد طبي"):s=r||"دفعة معلقة",p.jsxs("div",{className:"flex items-center justify-between p-2 border rounded text-xs",children:[p.jsx("div",{className:"flex-1",children:p.jsxs("div",{className:"flex items-start gap-2",children:[p.jsxs("span",{className:"font-medium text-xs",children:[t+1,"."]}),p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsxs(qo,{variant:"علاج"===n?"default":"موعد"===n?"secondary":"outline",className:"text-xs px-1 py-0",children:[a," ",n]}),p.jsx("p",{className:"font-medium text-sm",children:s})]}),p.jsxs("div",{className:"text-xs text-muted-foreground mt-1 space-y-0.5",children:[e.payment_date&&p.jsxs("p",{children:["📅 تاريخ الدفعة: ",ma(e.payment_date)]}),e.appointment_date&&p.jsxs("p",{children:["📅 تاريخ الموعد: ",ma(e.appointment_date)]}),e.tooth_name&&p.jsxs("p",{children:["🦷 ",e.tooth_name," (سن #",e.tooth_number,")"]}),e.treatment_type&&"علاج"===n&&p.jsxs("p",{children:["🔧 نوع العلاج: ",e.treatment_type]}),e.doctor_name&&p.jsxs("p",{children:["👨‍⚕️ الطبيب: ",e.doctor_name]}),e.notes&&p.jsxs("p",{children:["📝 ملاحظات: ",e.notes]})]})]})]})}),p.jsxs("div",{className:"text-left ml-2",children:[p.jsx("p",{className:"font-bold text-sm",children:ca(e.amount)}),e.discount_amount&&e.discount_amount>0&&p.jsxs("p",{className:"text-xs text-red-600",children:["خصم: ",ca(e.discount_amount)]}),"علاج"===n&&e.treatment_remaining_balance&&e.treatment_remaining_balance>0&&p.jsxs("p",{className:"text-xs text-orange-600",children:["متبقي: ",ca(e.treatment_remaining_balance)]})]})]},e.id)})})]}),p.jsxs("div",{className:"border rounded-lg p-3",children:[p.jsxs("h3",{className:"text-sm font-medium mb-3 flex items-center gap-1",children:[p.jsx(Er,{className:"w-4 h-4"}),"ملخص المبالغ"]}),p.jsxs("div",{className:"space-y-2 text-sm",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{children:"المجموع الفرعي:"}),p.jsx("span",{className:"font-medium",children:ca(f.subtotal)})]}),f.total_discount>0&&p.jsxs("div",{className:"flex justify-between text-red-600",children:[p.jsxs("span",{children:["الخصم (","percentage"===N.discount_type?`${N.discount_value}%`:"مبلغ ثابت","):"]}),p.jsxs("span",{className:"font-medium",children:["-",ca(f.total_discount)]})]}),f.total_tax>0&&p.jsxs("div",{className:"flex justify-between text-blue-600",children:[p.jsxs("span",{children:["الضريبة (",N.tax_rate,"%):"]}),p.jsxs("span",{className:"font-medium",children:["+",ca(f.total_tax)]})]}),p.jsx(ux,{}),p.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[p.jsx("span",{children:"المجموع النهائي:"}),p.jsx("span",{className:"text-primary",children:ca(f.final_total)})]})]})]}),N.footer_notes&&p.jsx("div",{className:"border rounded-lg p-3",children:p.jsx("p",{className:"text-center text-sm text-muted-foreground",children:N.footer_notes})})]}):p.jsx("div",{className:"flex items-center justify-center h-40",children:p.jsxs("div",{className:"text-center",children:[p.jsx(sr,{className:"w-12 h-12 text-muted-foreground mx-auto mb-2"}),p.jsx("p",{className:"text-muted-foreground mb-2",children:"لا توجد مدفوعات معلقة للمريض"}),p.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"جرب تغيير فلتر التاريخ أو تفعيل خيارات إضافية"}),p.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[p.jsx("p",{children:'• تأكد من وجود مدفوعات بحالة "معلق" للمريض'}),p.jsx("p",{children:"• جرب توسيع نطاق التاريخ"}),p.jsx("p",{children:'• فعل خيار "المواعيد غير المدفوعة" أو "العلاجات غير المدفوعة"'})]})]})})})]})]})}):null}function Mf({patient:e,open:t,onOpenChange:n,onEdit:a,onNavigateToTreatments:s,onNavigateToPayments:r}){const[i,l]=ve.useState("info"),[o,d]=ve.useState([]),[c,u]=ve.useState([]),[h,x]=ve.useState([]),[g,f]=ve.useState([]),[v,y]=ve.useState([]),[b,j]=ve.useState(!1),[w,N]=ve.useState(!1),[_,k]=ve.useState(!1),[S,D]=ve.useState(!1),[$,C]=ve.useState(!1),[E,T]=ve.useState(!1),[A,F]=ve.useState(!1),[P,O]=ve.useState(!1),{appointments:R}=Wo(),{payments:M}=Go(),{toothTreatments:L,loadToothTreatmentsByPatient:I}=Ko(),{toast:z}=yl(),{settings:B}=qt(),{refreshTreatmentNames:Y}=Jh();if(ve.useEffect(()=>{var n,a,s,r,i,l;if(e&&t){j(!0);const t=R.filter(t=>t.patient_id===e.id);d(t),j(!1),N(!0);const o=M.filter(t=>t.patient_id===e.id);u(o),N(!1),k(!0),I(e.id).then(()=>{const{toothTreatments:t}=Ko.getState(),n=t.filter(t=>t.patient_id===e.id);x(n),k(!1),Y()}).catch(()=>{k(!1)}),D(!0),null==(s=null==(a=null==(n=window.electronAPI)?void 0:n.prescriptions)?void 0:a.getByPatient)||s.call(a,e.id).then(e=>{f(e||[]),D(!1)}).catch(e=>{console.error("Error loading prescriptions:",e),D(!1)}),null==(l=null==(i=null==(r=window.electronAPI)?void 0:r.labOrders)?void 0:i.getByPatient)||l.call(i,e.id).then(e=>{y(e||[])}).catch(()=>{console.error("خطأ في تحميل طلبات المختبر")})}},[e,t,R,M,I]),!e)return null;const V=()=>{e&&s&&(n(!1),s("dental-treatments"),localStorage.setItem("selectedPatientForTreatment",JSON.stringify({selectedPatientId:e.id,patientName:e.full_name,showAddTreatmentGuidance:!0})))};return p.jsxs(Ii,{open:t,onOpenChange:n,children:[p.jsxs(Yi,{className:"max-w-4xl max-h-[90vh] overflow-hidden",dir:"rtl",children:[p.jsx(Vi,{className:"text-right",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"text-right",children:[p.jsxs(Ui,{className:"text-xl arabic-enhanced text-right",children:["تفاصيل المريض - ",e.full_name]}),p.jsx(Hi,{className:"arabic-enhanced text-right",children:"معلومات شاملة عن المريض وسجلاته الطبية"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){if(e)try{z({title:"جاري إعداد التقرير...",description:"يتم تجميع بيانات المريض وإعداد التقرير للطباعة"});const t=yield Cf.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");yield Mh.exportIndividualPatientRecord(t,B),z({title:"تم إنشاء التقرير بنجاح",description:`تم إنشاء سجل المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error printing patient record:",t),z({title:"خطأ في إنشاء التقرير",description:"فشل في إنشاء سجل المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),className:"flex items-center gap-2 text-green-600 hover:text-green-700 hover:bg-green-50",children:[p.jsx(ci,{className:"w-4 h-4"}),"طباعة السجل"]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>O(!0),className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[p.jsx(Pr,{className:"w-4 h-4"}),"فاتورة المعلقات"]}),a&&p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>a(e),className:"flex items-center gap-2",children:[p.jsx(si,{className:"w-4 h-4"}),"تعديل"]})]})]})}),p.jsxs(iu,{value:i,onValueChange:l,className:"flex-1 overflow-hidden",dir:"rtl",children:[p.jsxs(lu,{className:"grid w-full grid-cols-5 rtl-tabs",dir:"rtl",children:[p.jsxs(ou,{value:"info",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[p.jsx(Ai,{className:"w-4 h-4"}),"معلومات المريض"]}),p.jsxs(ou,{value:"treatments",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[p.jsx(nr,{className:"w-4 h-4"}),"العلاجات (",h.length,")"]}),p.jsxs(ou,{value:"appointments",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[p.jsx(hr,{className:"w-4 h-4"}),"المواعيد (",o.length,")"]}),p.jsxs(ou,{value:"payments",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[p.jsx(Er,{className:"w-4 h-4"}),"المدفوعات (",c.length,")"]}),p.jsxs(ou,{value:"prescriptions",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[p.jsx(Pr,{className:"w-4 h-4"}),"الوصفات (",g.length,")"]})]}),p.jsxs("div",{className:"mt-4 overflow-y-auto max-h-[calc(90vh-200px)] dialog-rtl",dir:"rtl",children:[p.jsx(du,{value:"info",className:"space-y-4 dialog-rtl",dir:"rtl",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",dir:"rtl",children:[p.jsxs(Lo,{className:"card-rtl",children:[p.jsx(Io,{className:"card-header",children:p.jsxs(zo,{className:"flex items-center gap-2 text-right",children:[p.jsx(Ai,{className:"w-5 h-5"}),"المعلومات الأساسية"]})}),p.jsxs(Yo,{className:"space-y-3 card-content",dir:"rtl",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsxs(qo,{variant:"outline",children:["#",e.serial_number]}),p.jsx("span",{className:"text-muted-foreground",children:"#:"})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"font-medium",children:e.full_name}),p.jsx("span",{className:"text-muted-foreground",children:"الاسم الكامل:"})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx(qo,{variant:"male"===e.gender?"default":"secondary",children:"male"===e.gender?"ذكر":"أنثى"}),p.jsx("span",{className:"text-muted-foreground",children:"الجنس:"})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsxs("span",{children:[e.age," سنة"]}),p.jsx("span",{className:"text-muted-foreground",children:"العمر:"})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-sm",children:ma(e.date_added||e.created_at)}),p.jsx("span",{className:"text-muted-foreground",children:"تاريخ الإضافة:"})]})]})]}),p.jsxs(Lo,{className:"card-rtl",children:[p.jsx(Io,{className:"card-header",children:p.jsxs(zo,{className:"flex items-center gap-2 text-right",children:[p.jsx(ri,{className:"w-5 h-5"}),"معلومات الاتصال"]})}),p.jsxs(Yo,{className:"space-y-3 card-content",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[e.phone?p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:e.phone}),p.jsx(ri,{className:"w-4 h-4 text-muted-foreground"})]}):p.jsx("span",{className:"text-muted-foreground",children:"غير محدد"}),p.jsx("span",{className:"text-muted-foreground",children:"رقم الهاتف:"})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[e.email?p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-sm",children:e.email}),p.jsx(Wr,{className:"w-4 h-4 text-muted-foreground"})]}):p.jsx("span",{className:"text-muted-foreground",children:"غير محدد"}),p.jsx("span",{className:"text-muted-foreground",children:"البريد الإلكتروني:"})]}),p.jsxs("div",{className:"flex items-start justify-between",children:[e.address?p.jsxs("div",{className:"flex items-start gap-2 max-w-[200px]",children:[p.jsx("span",{className:"text-sm text-right",children:e.address}),p.jsx(Kr,{className:"w-4 h-4 text-muted-foreground mt-0.5"})]}):p.jsx("span",{className:"text-muted-foreground",children:"غير محدد"}),p.jsx("span",{className:"text-muted-foreground",children:"العنوان:"})]})]})]}),p.jsxs(Lo,{className:"md:col-span-2 card-rtl",children:[p.jsx(Io,{className:"card-header",children:p.jsxs(zo,{className:"flex items-center gap-2 text-right",children:[p.jsx(Lr,{className:"w-5 h-5"}),"المعلومات الطبية"]})}),p.jsxs(Yo,{className:"space-y-4 card-content",dir:"rtl",children:[p.jsxs("div",{children:[p.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-right",children:[p.jsx(Pr,{className:"w-4 h-4"}),"حالة المريض"]}),p.jsx("p",{className:"text-sm bg-muted p-3 rounded-md text-right",children:e.patient_condition})]}),e.allergies&&p.jsxs("div",{children:[p.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-orange-600 dark:text-orange-400 text-right",children:[p.jsx(sr,{className:"w-4 h-4"}),"الحساسية"]}),p.jsx("div",{className:"text-sm bg-orange-50 dark:bg-yellow-900 border border-orange-200 dark:border-yellow-600 p-3 rounded-md text-orange-900 dark:text-yellow-100 text-right",children:e.allergies})]}),e.medical_conditions&&p.jsxs("div",{children:[p.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-right",children:[p.jsx(Lr,{className:"w-4 h-4"}),"الحالات الطبية"]}),p.jsx("p",{className:"text-sm bg-muted p-3 rounded-md text-right",children:e.medical_conditions})]}),e.notes&&p.jsxs("div",{children:[p.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-right",children:[p.jsx(Pr,{className:"w-4 h-4"}),"ملاحظات إضافية"]}),p.jsx("p",{className:"text-sm bg-muted p-3 rounded-md text-right",children:e.notes})]})]})]})]})}),p.jsxs(du,{value:"treatments",className:"space-y-4 dialog-rtl",dir:"rtl",children:[p.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[p.jsx("h3",{className:"text-lg font-medium",children:"العلاجات السنية"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(Qi,{onClick:()=>m(this,null,function*(){if(e)try{z({title:"جاري إعداد تقرير العلاجات...",description:"يتم تجميع بيانات علاجات المريض وإعداد التقرير للطباعة"});const t=yield Cf.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");yield Mh.exportPatientTreatments(t,B),z({title:"تم إنشاء تقرير العلاجات بنجاح",description:`تم إنشاء تقرير علاجات المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error printing patient treatments:",t),z({title:"خطأ في إنشاء تقرير العلاجات",description:"فشل في إنشاء تقرير علاجات المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[p.jsx(ci,{className:"w-4 h-4"}),"طباعة العلاجات"]}),p.jsxs(Qi,{onClick:V,className:"flex items-center gap-2",size:"sm",children:[p.jsx(di,{className:"w-4 h-4"}),"إضافة علاج"]})]})]}),_?p.jsx("div",{className:"flex items-center justify-center py-8",children:p.jsx("div",{className:"loading-spinner"})}):0===h.length?p.jsx(Lo,{className:"card-rtl",children:p.jsx(Yo,{className:"pt-6 card-content",dir:"rtl",children:p.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[p.jsx(nr,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),p.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد علاجات"}),p.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم تسجيل أي علاجات سنية لهذا المريض بعد"}),p.jsxs(Qi,{onClick:V,className:"flex items-center gap-2",size:"sm",children:[p.jsx(di,{className:"w-4 h-4"}),"إضافة أول علاج"]})]})})}):p.jsxs(Lo,{className:"card-rtl",children:[p.jsx(Io,{className:"card-header",children:p.jsxs(zo,{className:"flex items-center gap-2 text-foreground text-right",children:[p.jsx(nr,{className:"w-5 h-5"}),"جدول العلاجات"]})}),p.jsxs(Yo,{className:"card-content",dir:"rtl",children:[p.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:p.jsxs("table",{className:"w-full",children:[p.jsx("thead",{className:"bg-muted",children:p.jsxs("tr",{children:[p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"#"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"رقم السن"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"اسم السن"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"العلاج الحالي"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التكلفة"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"الحالة"})]})}),p.jsx("tbody",{className:"bg-background divide-y divide-border",children:h.map((e,t)=>{const n=(e=>{const t=rd.find(t=>t.value===e);if(t){const n={planned:"outline",in_progress:"secondary",completed:"default",cancelled:"destructive"};return{label:t.label,variant:n[e]||"outline"}}return{label:e,variant:"outline"}})(e.treatment_status);return p.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[p.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:t+1}),p.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:e.tooth_number}),p.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:e.tooth_name}),p.jsx("td",{className:"px-4 py-3 text-sm text-foreground",children:ad(e.treatment_type)||"-"}),p.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:e.cost?p.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:ca(e.cost)}):p.jsx("span",{className:"text-muted-foreground",children:"-"})}),p.jsx("td",{className:"px-4 py-3 text-sm",children:p.jsx(qo,{variant:n.variant,children:n.label})})]},e.id)})})]})}),h.some(e=>e.notes)&&p.jsxs("div",{className:"mt-4 space-y-2",children:[p.jsx("h4",{className:"text-sm font-medium text-foreground",children:"تفاصيل إضافية:"}),h.map(e=>e.notes&&p.jsxs("div",{className:"p-3 bg-muted/30 rounded border border-border",children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsxs("span",{className:"text-xs font-medium text-foreground",children:["السن رقم ",e.tooth_number," - ",e.tooth_name]}),p.jsx("span",{className:"text-xs text-muted-foreground",children:ma(e.created_at)})]}),e.notes&&p.jsxs("div",{children:[p.jsx("span",{className:"text-xs text-muted-foreground",children:"ملاحظات: "}),p.jsx("span",{className:"text-xs text-foreground",children:e.notes})]})]},`details-${e.id}`))]})]})]})]}),p.jsxs(du,{value:"appointments",className:"space-y-4 dialog-rtl",dir:"rtl",children:[p.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[p.jsx("h3",{className:"text-lg font-medium",children:"المواعيد"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(Qi,{onClick:()=>m(this,null,function*(){if(e)try{z({title:"جاري إعداد تقرير المواعيد...",description:"يتم تجميع بيانات مواعيد المريض وإعداد التقرير للطباعة"});const t=yield Cf.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");yield Mh.exportPatientAppointments(t,B),z({title:"تم إنشاء تقرير المواعيد بنجاح",description:`تم إنشاء تقرير مواعيد المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error printing patient appointments:",t),z({title:"خطأ في إنشاء تقرير المواعيد",description:"فشل في إنشاء تقرير مواعيد المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[p.jsx(ci,{className:"w-4 h-4"}),"طباعة المواعيد"]}),p.jsxs(Qi,{onClick:()=>{C(!0)},className:"flex items-center gap-2",size:"sm",children:[p.jsx(di,{className:"w-4 h-4"}),"إضافة موعد"]})]})]}),b?p.jsx("div",{className:"flex items-center justify-center py-8",children:p.jsx("div",{className:"loading-spinner"})}):0===o.length?p.jsx(Lo,{className:"card-rtl",children:p.jsx(Yo,{className:"pt-6 card-content",dir:"rtl",children:p.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[p.jsx(hr,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),p.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد مواعيد"}),p.jsx("p",{className:"text-muted-foreground",children:"لم يتم تحديد أي مواعيد لهذا المريض بعد"})]})})}):p.jsxs(Lo,{className:"card-rtl",children:[p.jsx(Io,{className:"card-header",children:p.jsxs(zo,{className:"flex items-center gap-2 text-foreground text-right",children:[p.jsx(hr,{className:"w-5 h-5"}),"جدول المواعيد"]})}),p.jsxs(Yo,{className:"card-content",dir:"rtl",children:[p.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:p.jsxs("table",{className:"w-full",children:[p.jsx("thead",{className:"bg-muted",children:p.jsxs("tr",{children:[p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"#"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"العنوان"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التاريخ"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"الوقت"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التكلفة"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"الحالة"})]})}),p.jsx("tbody",{className:"bg-background divide-y divide-border",children:o.map((e,t)=>{const n=(e=>({scheduled:{label:"مجدول",variant:"default"},completed:{label:"مكتمل",variant:"default"},cancelled:{label:"ملغي",variant:"destructive"},no_show:{label:"لم يحضر",variant:"secondary"}}[e]||{label:e,variant:"outline"}))(e.status);return p.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[p.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:t+1}),p.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:e.title}),p.jsx("td",{className:"px-4 py-3 text-sm text-foreground",children:ma(e.start_time)}),p.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}),p.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:e.cost?p.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:ca(e.cost)}):p.jsx("span",{className:"text-muted-foreground",children:"-"})}),p.jsx("td",{className:"px-4 py-3 text-sm",children:p.jsx(qo,{variant:n.variant,children:n.label})})]},e.id)})})]})}),o.some(e=>e.description)&&p.jsxs("div",{className:"mt-4 space-y-2",children:[p.jsx("h4",{className:"text-sm font-medium text-foreground",children:"تفاصيل إضافية:"}),o.map(e=>e.description&&p.jsxs("div",{className:"p-3 bg-muted/30 rounded border border-border",children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("span",{className:"text-xs font-medium text-foreground",children:e.title}),p.jsxs("span",{className:"text-xs text-muted-foreground",children:[ma(e.start_time)," - ",new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})]})]}),p.jsxs("div",{children:[p.jsx("span",{className:"text-xs text-muted-foreground",children:"الوصف: "}),p.jsx("span",{className:"text-xs text-foreground",children:e.description})]})]},`desc-${e.id}`))]})]})]})]}),p.jsxs(du,{value:"payments",className:"space-y-4 dialog-rtl",dir:"rtl",children:[p.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[p.jsx("h3",{className:"text-lg font-medium",children:"المدفوعات"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(Qi,{onClick:()=>m(this,null,function*(){if(e)try{z({title:"جاري إعداد تقرير المدفوعات...",description:"يتم تجميع بيانات مدفوعات المريض وإعداد التقرير للطباعة"});const t=yield Cf.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");yield Mh.exportPatientPayments(t,B),z({title:"تم إنشاء تقرير المدفوعات بنجاح",description:`تم إنشاء تقرير مدفوعات المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error printing patient payments:",t),z({title:"خطأ في إنشاء تقرير المدفوعات",description:"فشل في إنشاء تقرير مدفوعات المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[p.jsx(ci,{className:"w-4 h-4"}),"طباعة المدفوعات"]}),p.jsxs(Qi,{onClick:()=>{e&&r?(n(!1),r("payments"),localStorage.setItem("selectedPatientForPayment",JSON.stringify({selectedPatientId:e.id,patientName:e.full_name,openAddDialog:!0}))):T(!0)},className:"flex items-center gap-2",size:"sm",children:[p.jsx(di,{className:"w-4 h-4"}),"إضافة دفعة"]})]})]}),w?p.jsx("div",{className:"flex items-center justify-center py-8",children:p.jsx("div",{className:"loading-spinner"})}):0===c.length?p.jsx(Lo,{className:"card-rtl",children:p.jsx(Yo,{className:"pt-6 card-content",dir:"rtl",children:p.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[p.jsx(Er,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),p.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد مدفوعات"}),p.jsx("p",{className:"text-muted-foreground",children:"لم يتم تسجيل أي مدفوعات لهذا المريض بعد"})]})})}):p.jsxs("div",{className:"space-y-4",dir:"rtl",children:[(()=>{!function(e,t,n){const a=t.filter(t=>t.patient_id===e),s=n.filter(t=>t.patient_id===e);let r=0,i=0;s.forEach(e=>{if(e.cost){const t=Tf(e.id,e.cost,a);i+=e.cost,r+=t.totalPaid}}),a.filter(e=>!e.appointment_id&&("partial"===e.status||"completed"===e.status)).forEach(e=>{r+=e.amount,e.total_amount_due&&(i+=e.total_amount_due)});let l=0;s.forEach(e=>{if(e.cost){const t=a.filter(t=>t.appointment_id===e.id&&"partial"===t.status);if(t.length>0){const n=t.reduce((e,t)=>e+t.amount,0);l+=Math.max(0,e.cost-n)}}}),a.filter(e=>!e.appointment_id&&"partial"===e.status).forEach(e=>{e.total_amount_due&&e.amount&&(l+=Math.max(0,e.total_amount_due-e.amount))});const o=a.filter(e=>e.tooth_treatment_id&&"partial"===e.status),d={};o.forEach(e=>{d[e.tooth_treatment_id]||(d[e.tooth_treatment_id]=[]),d[e.tooth_treatment_id].push(e)}),Object.values(d).forEach(e=>{const t=e.reduce((e,t)=>e+t.amount,0),n=e[0].treatment_total_cost||0;n>0&&(l+=Math.max(0,n-t))}),s.length,a.length,s.filter(e=>!!e.cost&&"completed"===Tf(e.id,e.cost,a).status).length}(e.id,M,R);const t=c.filter(e=>e.tooth_treatment_id),n=c.filter(e=>e.appointment_id&&!e.tooth_treatment_id),a=c.filter(e=>!e.appointment_id&&!e.tooth_treatment_id),s=t.reduce((e,t)=>e+(t.treatment_total_cost||0),0),r=t.reduce((e,t)=>e+t.amount,0),i=t.reduce((e,t)=>e+(t.treatment_remaining_balance||0),0),l=n.reduce((e,t)=>e+(t.appointment_total_cost||0),0),o=n.reduce((e,t)=>e+t.amount,0),d=n.reduce((e,t)=>e+(t.appointment_remaining_balance||0),0),u=a.reduce((e,t)=>e+(t.total_amount_due||0),0),m=a.reduce((e,t)=>e+t.amount,0),h=a.reduce((e,t)=>e+(t.remaining_balance||0),0),x=s+l+u,g=r+o+m,f=i+d+h,v=c.filter(e=>"pending"===e.status),y=c.filter(e=>"partial"===e.status),b=c.filter(e=>"completed"===e.status);return p.jsxs(Lo,{className:"bg-gradient-to-r from-primary/5 to-primary/10 border-border card-rtl",children:[p.jsx(Io,{className:"card-header",children:p.jsxs(zo,{className:"flex items-center gap-2 text-primary text-right",children:[p.jsx(Er,{className:"w-5 h-5"}),"ملخص المدفوعات الشامل"]})}),p.jsx(Yo,{className:"card-content",dir:"rtl",children:p.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:p.jsxs("table",{className:"w-full",children:[p.jsx("thead",{className:"bg-muted",children:p.jsxs("tr",{children:[p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"البيان"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"المبلغ"}),p.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التفاصيل"})]})}),p.jsxs("tbody",{className:"bg-background divide-y divide-border",children:[p.jsxs("tr",{children:[p.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:"الإجمالي المطلوب"}),p.jsx("td",{className:"px-4 py-3 text-sm font-bold text-blue-600 dark:text-blue-400",children:ca(x)}),p.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["علاجات: ",ca(s)," | مواعيد: ",ca(l)," | عام: ",ca(u)]})]}),p.jsxs("tr",{children:[p.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:"المبلغ المدفوع"}),p.jsx("td",{className:"px-4 py-3 text-sm font-bold text-green-600 dark:text-green-400",children:ca(g)}),p.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["علاجات: ",ca(r)," | مواعيد: ",ca(o)," | عام: ",ca(m)]})]}),p.jsxs("tr",{className:"bg-muted/50",children:[p.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:"المبلغ المتبقي"}),p.jsxs("td",{className:"px-4 py-3 text-sm font-bold",children:[p.jsx("span",{className:f>0?"text-destructive":"text-green-600 dark:text-green-400",children:ca(f)}),0===f&&p.jsx("span",{className:"mr-2 text-xs text-green-600 dark:text-green-400",children:"✓ مكتمل"})]}),p.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["علاجات: ",ca(i)," | مواعيد: ",ca(d)," | عام: ",ca(h)]})]}),p.jsxs("tr",{children:[p.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:"حالات الدفع"}),p.jsx("td",{className:"px-4 py-3 text-sm",children:p.jsxs("div",{className:"flex gap-2 flex-wrap",children:[p.jsxs(qo,{variant:"secondary",className:"text-xs",children:["مكتمل: ",b.length]}),p.jsxs(qo,{variant:"outline",className:"text-xs",children:["جزئي: ",y.length]}),p.jsxs(qo,{variant:"destructive",className:"text-xs",children:["معلق: ",v.length]})]})}),p.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["إجمالي المدفوعات: ",c.length]})]})]})]})})})]})})(),p.jsxs(Lo,{className:"card-rtl",children:[p.jsx(Io,{className:"card-header",children:p.jsxs(zo,{className:"flex items-center gap-2 text-foreground text-right",children:[p.jsx(Er,{className:"w-5 h-5"}),"تفاصيل المدفوعات الشاملة"]})}),p.jsxs(Yo,{className:"card-content",dir:"rtl",children:[p.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:p.jsxs("table",{className:"w-full",children:[p.jsx("thead",{className:"bg-muted",children:p.jsxs("tr",{children:[p.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"#"}),p.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"النوع"}),p.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"التفاصيل"}),p.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"تاريخ الدفع"}),p.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"المبلغ المدفوع"}),p.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"الإجمالي المطلوب"}),p.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"المتبقي"}),p.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"طريقة الدفع"}),p.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"الحالة"})]})}),p.jsx("tbody",{className:"bg-background divide-y divide-border",children:c.map((e,t)=>{var n,a,s,r;const i=(e=>({completed:{label:"مكتمل",variant:"default"},partial:{label:"جزئي",variant:"outline"},pending:{label:"معلق",variant:"secondary"}}[e]||{label:e,variant:"outline"}))(e.status);let l="عام",o=e.description||"دفعة عامة",d=e.total_amount_due||0,c=e.remaining_balance||0;e.description&&(o=e.description.replace(/\[علاج:[^\]]+\]/g,"").trim(),o=o.replace(/^\s*-\s*/,"").trim());let u=e.notes;if(u&&(u=u.replace(/\[علاج:[^\]]+\]/g,"").trim(),u=u.replace(/^\s*-\s*/,"").trim()),e.tooth_treatment_id){l="علاج";const t=(null==(n=e.tooth_treatment)?void 0:n.treatment_type)?ad(e.tooth_treatment.treatment_type):"علاج سن";o&&"دفعة عامة"!==o||(o=t),(null==(a=e.tooth_treatment)?void 0:a.tooth_name)&&(o+=` - ${e.tooth_treatment.tooth_name}`),d=e.treatment_total_cost||0,c=e.treatment_remaining_balance||0}else e.appointment_id&&(l="موعد",o=(null==(s=e.appointment)?void 0:s.title)||o||"موعد طبي",d=e.appointment_total_cost||e.total_amount_due||0,c=e.appointment_remaining_balance||e.remaining_balance||0);return p.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[p.jsx("td",{className:"px-3 py-2 text-xs text-foreground",children:t+1}),p.jsx("td",{className:"px-3 py-2 text-xs",children:p.jsx(qo,{variant:"علاج"===l?"default":"موعد"===l?"secondary":"outline",className:"text-xs",children:l})}),p.jsxs("td",{className:"px-3 py-2 text-xs text-foreground max-w-32",children:[p.jsx("div",{className:"truncate",title:o,children:o}),(null==(r=e.tooth_treatment)?void 0:r.tooth_number)&&p.jsxs("div",{className:"text-xs text-muted-foreground",children:["سن #",e.tooth_treatment.tooth_number]})]}),p.jsx("td",{className:"px-3 py-2 text-xs text-foreground",children:ma(e.payment_date)}),p.jsx("td",{className:"px-3 py-2 text-xs font-bold text-green-600 dark:text-green-400",children:ca(e.amount)}),p.jsx("td",{className:"px-3 py-2 text-xs text-foreground",children:d>0?ca(d):"-"}),p.jsx("td",{className:"px-3 py-2 text-xs font-medium",children:void 0!==c?p.jsx("span",{className:c>0?"text-destructive":"text-green-600 dark:text-green-400",children:ca(c)}):"-"}),p.jsx("td",{className:"px-3 py-2 text-xs text-muted-foreground",children:"cash"===e.payment_method?"نقداً":"bank_transfer"===e.payment_method?"تحويل بنكي":e.payment_method}),p.jsx("td",{className:"px-3 py-2 text-xs",children:p.jsx(qo,{variant:i.variant,className:"text-xs",children:i.label})})]},e.id)})})]})}),c.some(e=>e.description||e.receipt_number)&&p.jsxs("div",{className:"mt-4 space-y-2",children:[p.jsx("h4",{className:"text-sm font-medium text-foreground",children:"تفاصيل إضافية:"}),c.map(e=>(e.description||e.receipt_number)&&p.jsxs("div",{className:"p-3 bg-muted/30 rounded border border-border",children:[p.jsx("div",{className:"flex items-center justify-between mb-2",children:p.jsxs("span",{className:"text-xs text-muted-foreground",children:[ma(e.payment_date)," - ",ca(e.amount)]})}),e.description&&p.jsxs("div",{className:"mb-1",children:[p.jsx("span",{className:"text-xs text-muted-foreground",children:"الوصف: "}),p.jsx("span",{className:"text-xs text-foreground",children:e.description.replace(/\[علاج:[^\]]+\]/g,"").trim().replace(/^\s*-\s*/,"").trim()})]}),e.receipt_number&&p.jsxs("div",{children:[p.jsx("span",{className:"text-xs text-muted-foreground",children:"رقم الإيصال: "}),p.jsx("span",{className:"text-xs text-foreground",children:e.receipt_number})]})]},`details-${e.id}`))]})]})]})]})]}),p.jsxs(du,{value:"prescriptions",className:"space-y-4 dialog-rtl",dir:"rtl",children:[p.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[p.jsx("h3",{className:"text-lg font-medium",children:"الوصفات الطبية"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(Qi,{onClick:()=>m(this,null,function*(){if(e)try{z({title:"جاري إعداد تقرير الوصفات...",description:"يتم تجميع بيانات وصفات المريض وإعداد التقرير للطباعة"});const t=yield Cf.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");yield Mh.exportPatientPrescriptions(t,B),z({title:"تم إنشاء تقرير الوصفات بنجاح",description:`تم إنشاء تقرير وصفات المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error printing patient prescriptions:",t),z({title:"خطأ في إنشاء تقرير الوصفات",description:"فشل في إنشاء تقرير وصفات المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[p.jsx(ci,{className:"w-4 h-4"}),"طباعة الوصفات"]}),p.jsxs(Qi,{onClick:()=>{F(!0)},className:"flex items-center gap-2",size:"sm",children:[p.jsx(di,{className:"w-4 h-4"}),"إضافة وصفة"]})]})]}),S?p.jsx("div",{className:"flex items-center justify-center py-8",children:p.jsx("div",{className:"loading-spinner"})}):0===g.length?p.jsx(Lo,{className:"card-rtl",children:p.jsx(Yo,{className:"pt-6 card-content",dir:"rtl",children:p.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[p.jsx(Pr,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),p.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد وصفات طبية"}),p.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم إنشاء أي وصفات طبية لهذا المريض بعد"})]})})}):p.jsx("div",{className:"space-y-4",dir:"rtl",children:g.map(e=>p.jsx(Lo,{className:"card-rtl",children:p.jsxs(Yo,{className:"pt-4 card-content",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between mb-3",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Pr,{className:"w-4 h-4 text-blue-500"}),p.jsx("span",{className:"font-medium",children:"وصفة طبية"})]}),p.jsx(qo,{variant:"outline",children:ma(e.prescription_date)})]}),e.tooth_treatment&&p.jsxs("div",{className:"mb-2",children:[p.jsx("span",{className:"text-sm text-muted-foreground",children:"مرتبطة بعلاج: "}),p.jsxs("span",{className:"text-sm font-medium",children:["السن رقم ",e.tooth_treatment.tooth_number," - ",e.tooth_treatment.treatment_type]})]}),e.notes&&p.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:e.notes}),e.medications&&e.medications.length>0&&p.jsxs("div",{className:"space-y-2",children:[p.jsx("h4",{className:"text-sm font-medium",children:"الأدوية:"}),e.medications.map((e,t)=>p.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/30 rounded",children:[p.jsx("span",{className:"text-sm",children:e.medication_name}),e.dose&&p.jsx("span",{className:"text-sm text-muted-foreground",children:e.dose})]},t))]})]})},e.id))})]})]})]})]}),p.jsx(Mo,{isOpen:$,onClose:()=>C(!1),onSave:t=>m(this,null,function*(){try{const{createAppointment:n}=Wo.getState();yield n(t),C(!1);const a=R.filter(t=>t.patient_id===e.id);d(a),z({title:"تم بنجاح",description:"تم إضافة الموعد بنجاح"})}catch(n){console.error("Error saving appointment:",n),z({title:"خطأ",description:"فشل في إضافة الموعد",variant:"destructive"})}}),patients:[e],treatments:[],initialData:void 0,preSelectedPatientId:e.id}),p.jsx(xd,{open:E,onOpenChange:T,preSelectedPatientId:e.id}),p.jsx(Ff,{open:A,onOpenChange:t=>{var n,a,s;F(t),t||(D(!0),null==(s=null==(a=null==(n=window.electronAPI)?void 0:n.prescriptions)?void 0:a.getByPatient)||s.call(a,e.id).then(e=>{f(e||[]),D(!1)}).catch(e=>{console.error("Error reloading prescriptions:",e),D(!1)}))},preSelectedPatientId:e.id}),p.jsx(Rf,{patient:e,open:P,onOpenChange:O})]})}function Lf({isOpen:e,patient:t,onClose:n,onSave:a}){const[s,r]=ve.useState({serial_number:"",full_name:"",gender:"male",age:0,patient_condition:"",allergies:"",medical_conditions:"",email:"",address:"",notes:"",phone:"",date_added:""});ve.useEffect(()=>{if(t){const e=e=>{if(!e)return"";return new Date(e).toISOString().slice(0,16)};r({serial_number:t.serial_number||"",full_name:t.full_name||"",gender:t.gender||"male",age:t.age||0,patient_condition:t.patient_condition||"",allergies:t.allergies||"",medical_conditions:t.medical_conditions||"",email:t.email||"",address:t.address||"",notes:t.notes||"",phone:t.phone||"",date_added:e(t.date_added||t.created_at||"")})}},[t]);const i=e=>{r(d(o({},s),{[e.target.name]:e.target.value}))};return t?p.jsx(Ii,{open:e,onOpenChange:n,children:p.jsxs(Yi,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsx(Ui,{children:"تعديل بيانات المريض"}),p.jsx(Hi,{children:"قم بتعديل معلومات المريض أدناه. الحقول المميزة بـ * مطلوبة."})]}),p.jsxs("form",{onSubmit:e=>{e.preventDefault(),t&&(a(t.id,s),n())},className:"space-y-6",children:[p.jsxs("div",{className:"space-y-4",children:[p.jsx("h3",{className:"text-lg font-medium",children:"الحقول المطلوبة"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-sm font-medium",children:"الاسم الكامل *"}),p.jsx(Xi,{type:"text",name:"full_name",value:s.full_name,onChange:i,required:!0,placeholder:"أدخل الاسم الكامل"})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-sm font-medium",children:"الجنس *"}),p.jsxs(el,{value:s.gender,onValueChange:e=>r(d(o({},s),{gender:e})),children:[p.jsx(al,{className:"bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر الجنس",className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"male",children:"ذكر"}),p.jsx(dl,{value:"female",children:"أنثى"})]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-sm font-medium",children:"العمر *"}),p.jsx(Xi,{type:"number",min:"1",max:"120",name:"age",value:s.age,onChange:i,required:!0,placeholder:"أدخل العمر"})]})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-sm font-medium",children:"تاريخ الإضافة *"}),p.jsx(Xi,{type:"datetime-local",name:"date_added",value:s.date_added,onChange:i,required:!0})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-sm font-medium",children:"رقم الهاتف"}),p.jsx(Xi,{type:"tel",name:"phone",value:s.phone,onChange:i,placeholder:"963987654321"}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"يرجى إدخال رقم الهاتف مع رمز الدولة بدون + أو 00 (مثل: 963987654321)"})]})]})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsx("h3",{className:"text-lg font-medium",children:"الحقول الاختيارية"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-sm font-medium",children:"حالة المريض / التشخيص"}),p.jsx(Ji,{name:"patient_condition",value:s.patient_condition,onChange:i,placeholder:"أدخل وصف الحالة الطبية أو التشخيص",rows:3})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-sm font-medium",children:"الحساسية"}),p.jsx(Xi,{type:"text",name:"allergies",value:s.allergies,onChange:i,placeholder:"أدخل معلومات الحساسية المعروفة"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-sm font-medium",children:"الحالات الطبية / الأمراض"}),p.jsx(Ji,{name:"medical_conditions",value:s.medical_conditions,onChange:i,placeholder:"أدخل الحالات الطبية أو الأمراض المزمنة",rows:2})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-sm font-medium",children:"البريد الإلكتروني"}),p.jsx(Xi,{type:"email",name:"email",value:s.email,onChange:i,placeholder:"أدخل البريد الإلكتروني"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-sm font-medium",children:"العنوان"}),p.jsx(Xi,{type:"text",name:"address",value:s.address,onChange:i,placeholder:"أدخل العنوان الكامل"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:"text-sm font-medium",children:"ملاحظات / تعليقات"}),p.jsx(Ji,{name:"notes",value:s.notes,onChange:i,placeholder:"أدخل أي ملاحظات أو تعليقات إضافية",rows:3})]})]}),p.jsxs(qi,{className:"flex justify-end space-x-4 space-x-reverse",children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:n,children:"إلغاء"}),p.jsx(Qi,{type:"submit",children:"حفظ التغييرات"})]})]})]})}):null}function If({onNavigateToTreatments:e,onNavigateToPayments:t}){wd();const{filteredPatients:n,selectedPatient:a,isLoading:s,error:r,searchQuery:i,setSearchQuery:l,setSelectedPatient:c,deletePatient:u,updatePatient:h,clearError:x,loadPatients:g}=cl(),{loadAppointments:f}=Wo(),{loadPayments:v}=Go(),{toast:y}=yl(),[b,j]=ve.useState(!1),[w,N]=ve.useState(!1),[_,k]=ve.useState(!1),[S,D]=ve.useState(!1),[$,C]=ve.useState(null),[E,T]=ve.useState(null),[A,F]=ve.useState(null),[P,O]=ve.useState(!1),[R,M]=ve.useState(null),[L,I]=ve.useState(!1),[z,B]=ve.useState("all"),[Y,V]=ve.useState("all"),[q,U]=ve.useState({start:"",end:""});ve.useEffect(()=>{g(),f(),v()},[g,f,v]),ve.useEffect(()=>{const e=localStorage.getItem("selectedPatientForDetails");if(e)try{const{patient:t,openDetailsModal:n}=JSON.parse(e);n&&t&&(C(t),N(!0),localStorage.removeItem("selectedPatientForDetails"))}catch(t){console.error("Error parsing search result data:",t),localStorage.removeItem("selectedPatientForDetails")}},[]);const H=e=>{T(e),k(!0)},G=ye.useMemo(()=>{let e=[...n];if("all"!==z&&(e=e.filter(e=>e.gender===z)),"all"!==Y&&(e=e.filter(e=>{if(!e.date_of_birth)return"unknown"===Y;const t=function(e){const t=new Date,n=new Date(e);let a=t.getFullYear()-n.getFullYear();const s=t.getMonth()-n.getMonth();return(s<0||0===s&&t.getDate()<n.getDate())&&a--,a}(e.date_of_birth);switch(Y){case"child":return t<18;case"adult":return t>=18&&t<60;case"senior":return t>=60;case"unknown":return!1;default:return!0}})),q.start&&q.end){const t=new Date(q.start),n=new Date(q.end);n.setHours(23,59,59,999),e=e.filter(e=>{if(!e.date_added)return!1;const a=new Date(e.date_added);return a>=t&&a<=n})}return e},[n,z,Y,q]);return r?p.jsx("div",{className:"flex items-center justify-center h-64",children:p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-destructive mb-4",children:r}),p.jsx(Qi,{onClick:x,children:"Try Again"})]})}):p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-heading-1 text-foreground arabic-enhanced",children:"إدارة المرضى"}),p.jsx("p",{className:"text-body text-muted-foreground mt-2 arabic-enhanced",children:"إدارة معلومات المرضى وسجلاتهم الطبية"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",onClick:()=>m(this,null,function*(){if(0!==G.length)try{yield ic.exportPatientsToExcel(G),rc.exportSuccess(`تم تصدير ${G.length} مريض بنجاح إلى ملف Excel مع التنسيق الجميل!`)}catch(e){console.error("Error exporting patients:",e),rc.exportError("فشل في تصدير بيانات المرضى")}else rc.noDataToExport("لا توجد بيانات مرضى للتصدير")}),children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير"]}),p.jsxs(Qi,{onClick:()=>j(!0),children:[p.jsx(di,{className:"w-4 h-4 ml-2"}),"إضافة مريض جديد"]})]})]}),p.jsx(Lo,{children:p.jsx(Yo,{className:"pt-6",children:p.jsxs("div",{className:"space-y-4",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center gap-4",dir:"rtl",children:[p.jsxs("div",{className:"relative flex-1",children:[p.jsx(hi,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{placeholder:"البحث بالاسم أو الهاتف أو البريد الإلكتروني...",value:i,onChange:e=>l(e.target.value),className:"pr-10 text-right",dir:"rtl"})]}),p.jsx(Md,{open:L,onOpenChange:I,children:p.jsx(Ld,{asChild:!0,children:p.jsxs(Qi,{variant:"outline",size:"sm",children:[p.jsx(Or,{className:"w-4 h-4 mr-2"}),"تصفية",("all"!==z||"all"!==Y||q.start||q.end)&&p.jsx("span",{className:"mr-2 w-2 h-2 bg-primary rounded-full"})]})})}),(i||"all"!==z||"all"!==Y||q.start||q.end)&&p.jsxs(Qi,{variant:"ghost",size:"sm",onClick:()=>{l(""),B("all"),V("all"),U({start:"",end:""}),I(!1)},children:[p.jsx(Mi,{className:"w-4 h-4 mr-2"}),"مسح الكل"]})]}),p.jsx(Md,{open:L,onOpenChange:I,children:p.jsx(Id,{className:"space-y-4",dir:"rtl",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-muted/50 rounded-lg",dir:"rtl",children:[p.jsxs("div",{className:"space-y-2 text-right",children:[p.jsx("label",{className:"text-sm font-medium",children:"الجنس"}),p.jsxs(el,{value:z,onValueChange:B,dir:"rtl",children:[p.jsx(al,{className:"text-right",children:p.jsx(nl,{placeholder:"جميع الأجناس"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الأجناس"}),p.jsx(dl,{value:"male",children:"ذكر"}),p.jsx(dl,{value:"female",children:"أنثى"})]})]})]}),p.jsxs("div",{className:"space-y-2 text-right",children:[p.jsx("label",{className:"text-sm font-medium",children:"الفئة العمرية"}),p.jsxs(el,{value:Y,onValueChange:V,dir:"rtl",children:[p.jsx(al,{className:"text-right",children:p.jsx(nl,{placeholder:"جميع الأعمار"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الأعمار"}),p.jsx(dl,{value:"child",children:"أطفال (أقل من 18)"}),p.jsx(dl,{value:"adult",children:"بالغين (18-59)"}),p.jsx(dl,{value:"senior",children:"كبار السن (60+)"}),p.jsx(dl,{value:"unknown",children:"غير محدد"})]})]})]}),p.jsxs("div",{className:"space-y-2 text-right",children:[p.jsx("label",{className:"text-sm font-medium",children:"تاريخ الإضافة"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Xi,{type:"date",placeholder:"من تاريخ",value:q.start,onChange:e=>U(t=>d(o({},t),{start:e.target.value})),className:"text-right",dir:"rtl"}),p.jsx(Xi,{type:"date",placeholder:"إلى تاريخ",value:q.end,onChange:e=>U(t=>d(o({},t),{end:e.target.value})),className:"text-right",dir:"rtl"})]})]})]})})})]})})}),p.jsx("div",{className:"space-y-6",children:p.jsx(Ef,{patients:G,isLoading:s,onEdit:H,onDelete:e=>m(this,null,function*(){M(e),O(!0)}),onViewDetails:e=>{C(e),N(!0)},onViewPendingInvoice:e=>{F(e),D(!0)}})}),p.jsx(bl,{open:b,onOpenChange:j}),p.jsx(Mf,{patient:$,open:w,onOpenChange:N,onEdit:H,onNavigateToTreatments:e,onNavigateToPayments:t}),p.jsx(Lf,{isOpen:_,patient:E,onClose:()=>{k(!1),T(null)},onSave:(e,t)=>m(this,null,function*(){try{yield h(e,t),k(!1),T(null),y({title:"نجح",description:"تم تحديث بيانات المريض بنجاح"})}catch(n){console.error("Error updating patient:",n),y({title:"خطأ",description:"فشل في تحديث بيانات المريض. يرجى المحاولة مرة أخرى",variant:"destructive"})}})}),p.jsx(Rf,{patient:A,open:S,onOpenChange:e=>{D(e),e||F(null)}}),p.jsx(Gl,{open:P,onOpenChange:O,children:p.jsxs(Zl,{dir:"rtl",children:[p.jsxs(Ql,{children:[p.jsxs(Jl,{className:"flex items-center gap-2",children:[p.jsx(Ni,{className:"w-5 h-5 text-destructive"}),"تأكيد حذف المريض"]}),p.jsxs(eo,{children:["هل أنت متأكد من حذف هذا المريض؟ سيتم حذف جميع البيانات المرتبطة به بما في ذلك المواعيد والمدفوعات.",p.jsx("br",{}),p.jsx("strong",{className:"text-destructive",children:"تحذير: لا يمكن التراجع عن هذا الإجراء!"})]})]}),p.jsxs(Xl,{className:"flex-row-reverse",children:[p.jsxs(to,{onClick:()=>m(this,null,function*(){if(R)try{yield u(R),rc.deleteSuccess("تم حذف المريض بنجاح")}catch(e){rc.deleteError("فشل في حذف المريض")}finally{O(!1),M(null)}}),className:"bg-destructive hover:bg-destructive/90",children:[p.jsx(Ni,{className:"w-4 h-4 ml-2"}),"تأكيد الحذف"]}),p.jsx(no,{children:"إلغاء"})]})]})})]})}function zf(e){var t=function(e,t){if("object"!=bt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=bt(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==bt(t)?t:t+""}function Bf(e,t,n){return(t=zf(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function Vf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yf(Object(n),!0).forEach(function(t){Bf(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yf(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function qf(e,t){if(null==e)return{};var n,a,s=ze(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function Uf(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Hf(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,zf(a.key),a)}}function Gf(e,t,n){return t&&Hf(e.prototype,t),n&&Hf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Wf(e){return(Wf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kf(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Kf=function(){return!!e})()}function Zf(e,t,n){return t=Wf(t),function(e,t){if(t&&("object"==bt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Be(e)}(e,Kf()?Reflect.construct(t,n||[],Wf(e).constructor):t.apply(e,n))}function Qf(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ye(e,t)}function Xf(e){if(Array.isArray(e))return e}function Jf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function ev(e,t){if(e){if("string"==typeof e)return Jf(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jf(e,t):void 0}}function tv(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function nv(e,t){return Xf(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,s,r,i,l=[],o=!0,d=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;o=!1}else for(;!(o=(a=r.call(n)).done)&&(l.push(a.value),l.length!==t);o=!0);}catch(c){d=!0,s=c}finally{try{if(!o&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}(e,t)||ev(e,t)||tv()}function av(e){var t,n,a="";if("string"==typeof e||"number"==typeof e)a+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=av(e[t]))&&(a&&(a+=" "),a+=n);else for(t in e)e[t]&&(a&&(a+=" "),a+=t);return a}function sv(){for(var e,t,n=0,a="";n<arguments.length;)(e=arguments[n++])&&(t=av(e))&&(a&&(a+=" "),a+=t);return a}var rv=function(e,t,n,a,s,r,i,l){if(!e){var o;if(void 0===t)o=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[n,a,s,r,i,l],c=0;(o=new Error(t.replace(/%s/g,function(){return d[c++]}))).name="Invariant Violation"}throw o.framesToPop=1,o}};const iv=be(rv);var lv=function(){};function ov(e,t){return void 0!==e[t]}function dv(e){return"default"+e.charAt(0).toUpperCase()+e.substr(1)}function cv(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!=e&&this.setState(e)}function uv(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!=n?n:null}.bind(this))}function mv(e,t){try{var n=this.props,a=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,a)}finally{this.props=n,this.state=a}}cv.__suppressDeprecationWarning=!0,uv.__suppressDeprecationWarning=!0,mv.__suppressDeprecationWarning=!0;var pv="milliseconds",hv="seconds",xv="minutes",gv="hours",fv="day",vv="week",yv="month",bv="year",jv="decade",wv="century",Nv={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,day:864e5,week:6048e5},_v={month:1,year:12,decade:120,century:1200};function kv(e){return e%4==0&&e%100!=0||e%400==0?29:28}function Sv(e,t,n){switch(e=new Date(e),n){case pv:case hv:case xv:case gv:case fv:case vv:return function(e,t){var n=new Date(+e+t);return function(e,t){var n=e.getTimezoneOffset(),a=t.getTimezoneOffset();return new Date(+t+(a-n)*Nv.minutes)}(e,n)}(e,t*Nv[n]);case yv:case bv:case jv:case wv:return function(e,t){var n=e.getFullYear(),a=e.getMonth(),s=e.getDate(),r=12*n+a+t,i=Math.trunc(r/12),l=r%12,o=Math.min(s,function(e){return[31,kv(e),31,30,31,30,31,31,30,31,30,31]}(i)[l]),d=new Date(e);return d.setFullYear(i),d.setDate(1),d.setMonth(l),d.setDate(o),d}(e,t*_v[n])}throw new TypeError('Invalid units: "'+n+'"')}function Dv(e,t,n){return Sv(e,-t,n)}function $v(e,t,n){switch(e=new Date(e),t){case wv:case jv:case bv:e=Uv(e,0);case yv:e=qv(e,1);case vv:case fv:e=Yv(e,0);case gv:e=Bv(e,0);case xv:e=zv(e,0);case hv:e=Iv(e,0)}return t===jv&&(e=Dv(e,Hv(e)%10,"year")),t===wv&&(e=Dv(e,Hv(e)%100,"year")),t===vv&&(e=Gv(e,0,n)),e}function Cv(e,t,n){switch(e=$v(e=new Date(e),t,n),t){case wv:case jv:case bv:case yv:case vv:(e=Dv(e=Sv(e,1,t),1,fv)).setHours(23,59,59,999);break;case fv:e.setHours(23,59,59,999);break;case gv:case xv:case hv:e=Dv(e=Sv(e,1,t),1,pv)}return e}var Ev=Kv(function(e,t){return e===t}),Tv=Kv(function(e,t){return e!==t}),Av=Kv(function(e,t){return e>t}),Fv=Kv(function(e,t){return e>=t}),Pv=Kv(function(e,t){return e<t}),Ov=Kv(function(e,t){return e<=t});function Rv(){return new Date(Math.min.apply(Math,arguments))}function Mv(){return new Date(Math.max.apply(Math,arguments))}function Lv(e,t,n,a){return a=a||"day",(!t||Fv(e,t,a))&&(!n||Ov(e,n,a))}var Iv=Wv("Milliseconds"),zv=Wv("Seconds"),Bv=Wv("Minutes"),Yv=Wv("Hours"),Vv=Wv("Day"),qv=Wv("Date"),Uv=Wv("Month"),Hv=Wv("FullYear");function Gv(e,t,n){var a=(Vv(e)+7-(n||0))%7;return void 0===t?a:Sv(e,t-a,fv)}function Wv(e){var t=function(e){switch(e){case"Milliseconds":return 36e5;case"Seconds":return 3600;case"Minutes":return 60;case"Hours":return 1;default:return null}}(e);return function(n,a){if(void 0===a)return n["get"+e]();var s=new Date(n);return s["set"+e](a),t&&s["get"+e]()!=a&&("Hours"===e||a>=t&&s.getHours()-n.getHours()<Math.floor(a/t))&&s["set"+e](a+t),s}}function Kv(e){return function(t,n,a){return e(+$v(t,a),+$v(n,a))}}const Zv=Object.freeze(Object.defineProperty({__proto__:null,add:Sv,century:function(e,t){return void 0===t?Hv($v(e,wv)):Sv(e,t+100,bv)},date:qv,day:Vv,decade:function(e,t){return void 0===t?Hv($v(e,jv)):Sv(e,t+10,bv)},diff:function(e,t,n,a){var s,r,i;switch(n){case pv:case hv:case xv:case gv:case fv:case vv:s=t.getTime()-e.getTime();break;case yv:case bv:case jv:case wv:s=12*(Hv(t)-Hv(e))+Uv(t)-Uv(e);break;default:throw new TypeError('Invalid units: "'+n+'"')}switch(n){case pv:r=1;break;case hv:r=1e3;break;case xv:r=6e4;break;case gv:r=36e5;break;case fv:r=864e5;break;case vv:r=6048e5;break;case yv:r=1;break;case bv:r=12;break;case jv:r=120;break;case wv:r=1200;break;default:throw new TypeError('Invalid units: "'+n+'"')}return i=s/r,a?i:Math.round(i)},endOf:Cv,eq:Ev,gt:Av,gte:Fv,hours:Yv,inRange:Lv,lt:Pv,lte:Ov,max:Mv,milliseconds:Iv,min:Rv,minutes:Bv,month:Uv,neq:Tv,seconds:zv,startOf:$v,subtract:Dv,weekday:Gv,year:Hv},Symbol.toStringTag,{value:"Module"}));function Qv(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Xv(e){return function(e){if(Array.isArray(e))return Jf(e)}(e)||Qv(e)||ev(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Jv=Ue,ey=He,ty=Ge,ny=Math.ceil,ay=Math.max;const sy=be(function(e,t,n){t=(n?ey(e,t,n):void 0===t)?1:ay(ty(t),0);var a=null==e?0:e.length;if(!a||t<1)return[];for(var s=0,r=0,i=Array(ny(a/t));s<a;)i[r++]=Jv(e,s,s+=t);return i});function ry(e){return e&&e.ownerDocument||document}function iy(e,t){return function(e){var t=ry(e);return t&&t.defaultView||window}(e).getComputedStyle(e,t)}var ly=/([A-Z])/g;var oy=/^ms-/;function dy(e){return function(e){return e.replace(ly,"-$1").toLowerCase()}(e).replace(oy,"-ms-")}var cy=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function uy(e,t){var n="",a="";if("string"==typeof t)return e.style.getPropertyValue(dy(t))||iy(e).getPropertyValue(dy(t));Object.keys(t).forEach(function(s){var r=t[s];r||0===r?!function(e){return!(!e||!cy.test(e))}(s)?n+=dy(s)+": "+r+";":a+=s+"("+r+") ":e.style.removeProperty(dy(s))}),a&&(n+="transform: "+a+";"),e.style.cssText+=";"+n}function my(e,t){return e.contains?e.contains(t):e.compareDocumentPosition?e===t||!!(16&e.compareDocumentPosition(t)):void 0}function py(e){return"window"in e&&e.window===e?e:"nodeType"in(t=e)&&t.nodeType===document.DOCUMENT_NODE&&e.defaultView||!1;var t}function hy(e){var t="pageXOffset"===e?"scrollLeft":"scrollTop";return function(n,a){var s=py(n);if(void 0===a)return s?s[e]:n[t];s?s.scrollTo(s[e],a):n[t]=a}}const xy=hy("pageXOffset"),gy=hy("pageYOffset");function fy(e){var t=ry(e),n={top:0,left:0,height:0,width:0},a=t&&t.documentElement;return a&&my(a,e)?(void 0!==e.getBoundingClientRect&&(n=e.getBoundingClientRect()),n={top:n.top+gy(a)-(a.clientTop||0),left:n.left+xy(a)-(a.clientLeft||0),width:n.width,height:n.height}):n}var vy=function(e){return!!e&&"offsetParent"in e};function yy(e,t){var n,a={top:0,left:0};if("fixed"===uy(e,"position"))n=e.getBoundingClientRect();else{var s=t||function(e){for(var t=ry(e),n=e&&e.offsetParent;vy(n)&&"HTML"!==n.nodeName&&"static"===uy(n,"position");)n=n.offsetParent;return n||t.documentElement}(e);n=fy(e),"html"!==function(e){return e.nodeName&&e.nodeName.toLowerCase()}(s)&&(a=fy(s));var r=String(uy(s,"borderTopWidth")||0);a.top+=parseInt(r,10)-gy(s)||0;var i=String(uy(s,"borderLeftWidth")||0);a.left+=parseInt(i,10)-xy(s)||0}var l=String(uy(e,"marginTop")||0),o=String(uy(e,"marginLeft")||0);return qe({},n,{top:n.top-a.top-(parseInt(l,10)||0),left:n.left-a.left-(parseInt(o,10)||0)})}const by=!("undefined"==typeof window||!window.document||!window.document.createElement);var jy=(new Date).getTime();var wy="clearTimeout",Ny=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-jy)),a=setTimeout(e,n);return jy=t,a},_y=function(e,t){return e+(e?t[0].toUpperCase()+t.substr(1):t)+"AnimationFrame"};by&&["","webkit","moz","o","ms"].some(function(e){var t=_y(e,"request");return t in window&&(wy=_y(e,"cancel"),Ny=function(e){return window[t](e)}),!!Ny});var ky,Sy=function(e){"function"==typeof window[wy]&&window[wy](e)},Dy=Ny;function $y(e,t){if(!ky){var n=document.body,a=n.matches||n.matchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector;ky=function(e,t){return a.call(e,t)}}return ky(e,t)}var Cy=Function.prototype.bind.call(Function.prototype.call,[].slice);var Ey=!1,Ty=!1;try{var Ay={get passive(){return Ey=!0},get once(){return Ty=Ey=!0}};by&&(window.addEventListener("test",Ay,Ay),window.removeEventListener("test",Ay,!0))}catch(oT){}function Fy(e){const t=function(e){const t=ve.useRef(e);return ve.useEffect(()=>{t.current=e},[e]),t}(e);return ve.useCallback(function(...e){return t.current&&t.current(...e)},[t])}function Py(){return ve.useState(null)}function Oy(e){const t=function(){const e=ve.useRef(!0),t=ve.useRef(()=>e.current);return ve.useEffect(()=>(e.current=!0,()=>{e.current=!1}),[]),t.current}();return[e[0],ve.useCallback(n=>{if(t())return e[1](n)},[t,e[1]])]}var Ry="top",My="bottom",Ly="right",Iy="left",zy="auto",By=[Ry,My,Ly,Iy],Yy="start",Vy="end",qy="viewport",Uy="popper",Hy=By.reduce(function(e,t){return e.concat([t+"-"+Yy,t+"-"+Vy])},[]),Gy=[].concat(By,[zy]).reduce(function(e,t){return e.concat([t,t+"-"+Yy,t+"-"+Vy])},[]),Wy=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Ky(e){return e.split("-")[0]}function Zy(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Qy(e){return e instanceof Zy(e).Element||e instanceof Element}function Xy(e){return e instanceof Zy(e).HTMLElement||e instanceof HTMLElement}function Jy(e){return"undefined"!=typeof ShadowRoot&&(e instanceof Zy(e).ShadowRoot||e instanceof ShadowRoot)}var eb=Math.max,tb=Math.min,nb=Math.round;function ab(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function sb(){return!/^((?!chrome|android).)*safari/i.test(ab())}function rb(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var a=e.getBoundingClientRect(),s=1,r=1;t&&Xy(e)&&(s=e.offsetWidth>0&&nb(a.width)/e.offsetWidth||1,r=e.offsetHeight>0&&nb(a.height)/e.offsetHeight||1);var i=(Qy(e)?Zy(e):window).visualViewport,l=!sb()&&n,o=(a.left+(l&&i?i.offsetLeft:0))/s,d=(a.top+(l&&i?i.offsetTop:0))/r,c=a.width/s,u=a.height/r;return{width:c,height:u,top:d,right:o+c,bottom:d+u,left:o,x:o,y:d}}function ib(e){var t=rb(e),n=e.offsetWidth,a=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:a}}function lb(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&Jy(n)){var a=t;do{if(a&&e.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function ob(e){return e?(e.nodeName||"").toLowerCase():null}function db(e){return Zy(e).getComputedStyle(e)}function cb(e){return["table","td","th"].indexOf(ob(e))>=0}function ub(e){return((Qy(e)?e.ownerDocument:e.document)||window.document).documentElement}function mb(e){return"html"===ob(e)?e:e.assignedSlot||e.parentNode||(Jy(e)?e.host:null)||ub(e)}function pb(e){return Xy(e)&&"fixed"!==db(e).position?e.offsetParent:null}function hb(e){for(var t=Zy(e),n=pb(e);n&&cb(n)&&"static"===db(n).position;)n=pb(n);return n&&("html"===ob(n)||"body"===ob(n)&&"static"===db(n).position)?t:n||function(e){var t=/firefox/i.test(ab());if(/Trident/i.test(ab())&&Xy(e)&&"fixed"===db(e).position)return null;var n=mb(e);for(Jy(n)&&(n=n.host);Xy(n)&&["html","body"].indexOf(ob(n))<0;){var a=db(n);if("none"!==a.transform||"none"!==a.perspective||"paint"===a.contain||-1!==["transform","perspective"].indexOf(a.willChange)||t&&"filter"===a.willChange||t&&a.filter&&"none"!==a.filter)return n;n=n.parentNode}return null}(e)||t}function xb(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function gb(e,t,n){return eb(e,tb(t,n))}function fb(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function vb(e,t){return t.reduce(function(t,n){return t[n]=e,t},{})}const yb={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,a=e.name,s=e.options,r=n.elements.arrow,i=n.modifiersData.popperOffsets,l=Ky(n.placement),o=xb(l),d=[Iy,Ly].indexOf(l)>=0?"height":"width";if(r&&i){var c=function(e,t){return fb("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:vb(e,By))}(s.padding,n),u=ib(r),m="y"===o?Ry:Iy,p="y"===o?My:Ly,h=n.rects.reference[d]+n.rects.reference[o]-i[o]-n.rects.popper[d],x=i[o]-n.rects.reference[o],g=hb(r),f=g?"y"===o?g.clientHeight||0:g.clientWidth||0:0,v=h/2-x/2,y=c[m],b=f-u[d]-c[p],j=f/2-u[d]/2+v,w=gb(y,j,b),N=o;n.modifiersData[a]=((t={})[N]=w,t.centerOffset=w-j,t)}},effect:function(e){var t=e.state,n=e.options.element,a=void 0===n?"[data-popper-arrow]":n;null!=a&&("string"!=typeof a||(a=t.elements.popper.querySelector(a)))&&lb(t.elements.popper,a)&&(t.elements.arrow=a)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function bb(e){return e.split("-")[1]}var jb={top:"auto",right:"auto",bottom:"auto",left:"auto"};function wb(e){var t,n=e.popper,a=e.popperRect,s=e.placement,r=e.variation,i=e.offsets,l=e.position,o=e.gpuAcceleration,d=e.adaptive,c=e.roundOffsets,u=e.isFixed,m=i.x,p=void 0===m?0:m,h=i.y,x=void 0===h?0:h,g="function"==typeof c?c({x:p,y:x}):{x:p,y:x};p=g.x,x=g.y;var f=i.hasOwnProperty("x"),v=i.hasOwnProperty("y"),y=Iy,b=Ry,j=window;if(d){var w=hb(n),N="clientHeight",_="clientWidth";if(w===Zy(n)&&"static"!==db(w=ub(n)).position&&"absolute"===l&&(N="scrollHeight",_="scrollWidth"),s===Ry||(s===Iy||s===Ly)&&r===Vy)b=My,x-=(u&&w===j&&j.visualViewport?j.visualViewport.height:w[N])-a.height,x*=o?1:-1;if(s===Iy||(s===Ry||s===My)&&r===Vy)y=Ly,p-=(u&&w===j&&j.visualViewport?j.visualViewport.width:w[_])-a.width,p*=o?1:-1}var k,S=Object.assign({position:l},d&&jb),D=!0===c?function(e,t){var n=e.x,a=e.y,s=t.devicePixelRatio||1;return{x:nb(n*s)/s||0,y:nb(a*s)/s||0}}({x:p,y:x},Zy(n)):{x:p,y:x};return p=D.x,x=D.y,o?Object.assign({},S,((k={})[b]=v?"0":"",k[y]=f?"0":"",k.transform=(j.devicePixelRatio||1)<=1?"translate("+p+"px, "+x+"px)":"translate3d("+p+"px, "+x+"px, 0)",k)):Object.assign({},S,((t={})[b]=v?x+"px":"",t[y]=f?p+"px":"",t.transform="",t))}const Nb={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,a=n.gpuAcceleration,s=void 0===a||a,r=n.adaptive,i=void 0===r||r,l=n.roundOffsets,o=void 0===l||l,d={placement:Ky(t.placement),variation:bb(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,wb(Object.assign({},d,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:i,roundOffsets:o})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,wb(Object.assign({},d,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:o})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var _b={passive:!0};const kb={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,a=e.options,s=a.scroll,r=void 0===s||s,i=a.resize,l=void 0===i||i,o=Zy(t.elements.popper),d=[].concat(t.scrollParents.reference,t.scrollParents.popper);return r&&d.forEach(function(e){e.addEventListener("scroll",n.update,_b)}),l&&o.addEventListener("resize",n.update,_b),function(){r&&d.forEach(function(e){e.removeEventListener("scroll",n.update,_b)}),l&&o.removeEventListener("resize",n.update,_b)}},data:{}};var Sb={left:"right",right:"left",bottom:"top",top:"bottom"};function Db(e){return e.replace(/left|right|bottom|top/g,function(e){return Sb[e]})}var $b={start:"end",end:"start"};function Cb(e){return e.replace(/start|end/g,function(e){return $b[e]})}function Eb(e){var t=Zy(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function Tb(e){return rb(ub(e)).left+Eb(e).scrollLeft}function Ab(e){var t=db(e),n=t.overflow,a=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+s+a)}function Fb(e){return["html","body","#document"].indexOf(ob(e))>=0?e.ownerDocument.body:Xy(e)&&Ab(e)?e:Fb(mb(e))}function Pb(e,t){var n;void 0===t&&(t=[]);var a=Fb(e),s=a===(null==(n=e.ownerDocument)?void 0:n.body),r=Zy(a),i=s?[r].concat(r.visualViewport||[],Ab(a)?a:[]):a,l=t.concat(i);return s?l:l.concat(Pb(mb(i)))}function Ob(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Rb(e,t,n){return t===qy?Ob(function(e,t){var n=Zy(e),a=ub(e),s=n.visualViewport,r=a.clientWidth,i=a.clientHeight,l=0,o=0;if(s){r=s.width,i=s.height;var d=sb();(d||!d&&"fixed"===t)&&(l=s.offsetLeft,o=s.offsetTop)}return{width:r,height:i,x:l+Tb(e),y:o}}(e,n)):Qy(t)?function(e,t){var n=rb(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):Ob(function(e){var t,n=ub(e),a=Eb(e),s=null==(t=e.ownerDocument)?void 0:t.body,r=eb(n.scrollWidth,n.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),i=eb(n.scrollHeight,n.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),l=-a.scrollLeft+Tb(e),o=-a.scrollTop;return"rtl"===db(s||n).direction&&(l+=eb(n.clientWidth,s?s.clientWidth:0)-r),{width:r,height:i,x:l,y:o}}(ub(e)))}function Mb(e,t,n,a){var s="clippingParents"===t?function(e){var t=Pb(mb(e)),n=["absolute","fixed"].indexOf(db(e).position)>=0&&Xy(e)?hb(e):e;return Qy(n)?t.filter(function(e){return Qy(e)&&lb(e,n)&&"body"!==ob(e)}):[]}(e):[].concat(t),r=[].concat(s,[n]),i=r[0],l=r.reduce(function(t,n){var s=Rb(e,n,a);return t.top=eb(s.top,t.top),t.right=tb(s.right,t.right),t.bottom=tb(s.bottom,t.bottom),t.left=eb(s.left,t.left),t},Rb(e,i,a));return l.width=l.right-l.left,l.height=l.bottom-l.top,l.x=l.left,l.y=l.top,l}function Lb(e){var t,n=e.reference,a=e.element,s=e.placement,r=s?Ky(s):null,i=s?bb(s):null,l=n.x+n.width/2-a.width/2,o=n.y+n.height/2-a.height/2;switch(r){case Ry:t={x:l,y:n.y-a.height};break;case My:t={x:l,y:n.y+n.height};break;case Ly:t={x:n.x+n.width,y:o};break;case Iy:t={x:n.x-a.width,y:o};break;default:t={x:n.x,y:n.y}}var d=r?xb(r):null;if(null!=d){var c="y"===d?"height":"width";switch(i){case Yy:t[d]=t[d]-(n[c]/2-a[c]/2);break;case Vy:t[d]=t[d]+(n[c]/2-a[c]/2)}}return t}function Ib(e,t){void 0===t&&(t={});var n=t,a=n.placement,s=void 0===a?e.placement:a,r=n.strategy,i=void 0===r?e.strategy:r,l=n.boundary,o=void 0===l?"clippingParents":l,d=n.rootBoundary,c=void 0===d?qy:d,u=n.elementContext,m=void 0===u?Uy:u,p=n.altBoundary,h=void 0!==p&&p,x=n.padding,g=void 0===x?0:x,f=fb("number"!=typeof g?g:vb(g,By)),v=m===Uy?"reference":Uy,y=e.rects.popper,b=e.elements[h?v:m],j=Mb(Qy(b)?b:b.contextElement||ub(e.elements.popper),o,c,i),w=rb(e.elements.reference),N=Lb({reference:w,element:y,strategy:"absolute",placement:s}),_=Ob(Object.assign({},y,N)),k=m===Uy?_:w,S={top:j.top-k.top+f.top,bottom:k.bottom-j.bottom+f.bottom,left:j.left-k.left+f.left,right:k.right-j.right+f.right},D=e.modifiersData.offset;if(m===Uy&&D){var $=D[s];Object.keys(S).forEach(function(e){var t=[Ly,My].indexOf(e)>=0?1:-1,n=[Ry,My].indexOf(e)>=0?"y":"x";S[e]+=$[n]*t})}return S}const zb={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,a=e.name;if(!t.modifiersData[a]._skip){for(var s=n.mainAxis,r=void 0===s||s,i=n.altAxis,l=void 0===i||i,o=n.fallbackPlacements,d=n.padding,c=n.boundary,u=n.rootBoundary,m=n.altBoundary,p=n.flipVariations,h=void 0===p||p,x=n.allowedAutoPlacements,g=t.options.placement,f=Ky(g),v=o||(f===g||!h?[Db(g)]:function(e){if(Ky(e)===zy)return[];var t=Db(e);return[Cb(e),t,Cb(t)]}(g)),y=[g].concat(v).reduce(function(e,n){return e.concat(Ky(n)===zy?function(e,t){void 0===t&&(t={});var n=t,a=n.placement,s=n.boundary,r=n.rootBoundary,i=n.padding,l=n.flipVariations,o=n.allowedAutoPlacements,d=void 0===o?Gy:o,c=bb(a),u=c?l?Hy:Hy.filter(function(e){return bb(e)===c}):By,m=u.filter(function(e){return d.indexOf(e)>=0});0===m.length&&(m=u);var p=m.reduce(function(t,n){return t[n]=Ib(e,{placement:n,boundary:s,rootBoundary:r,padding:i})[Ky(n)],t},{});return Object.keys(p).sort(function(e,t){return p[e]-p[t]})}(t,{placement:n,boundary:c,rootBoundary:u,padding:d,flipVariations:h,allowedAutoPlacements:x}):n)},[]),b=t.rects.reference,j=t.rects.popper,w=new Map,N=!0,_=y[0],k=0;k<y.length;k++){var S=y[k],D=Ky(S),$=bb(S)===Yy,C=[Ry,My].indexOf(D)>=0,E=C?"width":"height",T=Ib(t,{placement:S,boundary:c,rootBoundary:u,altBoundary:m,padding:d}),A=C?$?Ly:Iy:$?My:Ry;b[E]>j[E]&&(A=Db(A));var F=Db(A),P=[];if(r&&P.push(T[D]<=0),l&&P.push(T[A]<=0,T[F]<=0),P.every(function(e){return e})){_=S,N=!1;break}w.set(S,P)}if(N)for(var O=function(e){var t=y.find(function(t){var n=w.get(t);if(n)return n.slice(0,e).every(function(e){return e})});if(t)return _=t,"break"},R=h?3:1;R>0;R--){if("break"===O(R))break}t.placement!==_&&(t.modifiersData[a]._skip=!0,t.placement=_,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Bb(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function Yb(e){return[Ry,Ly,My,Iy].some(function(t){return e[t]>=0})}const Vb={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,a=e.name,s=n.offset,r=void 0===s?[0,0]:s,i=Gy.reduce(function(e,n){return e[n]=function(e,t,n){var a=Ky(e),s=[Iy,Ry].indexOf(a)>=0?-1:1,r="function"==typeof n?n(Object.assign({},t,{placement:e})):n,i=r[0],l=r[1];return i=i||0,l=(l||0)*s,[Iy,Ly].indexOf(a)>=0?{x:l,y:i}:{x:i,y:l}}(n,t.rects,r),e},{}),l=i[t.placement],o=l.x,d=l.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=o,t.modifiersData.popperOffsets.y+=d),t.modifiersData[a]=i}};const qb={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,a=e.name,s=n.mainAxis,r=void 0===s||s,i=n.altAxis,l=void 0!==i&&i,o=n.boundary,d=n.rootBoundary,c=n.altBoundary,u=n.padding,m=n.tether,p=void 0===m||m,h=n.tetherOffset,x=void 0===h?0:h,g=Ib(t,{boundary:o,rootBoundary:d,padding:u,altBoundary:c}),f=Ky(t.placement),v=bb(t.placement),y=!v,b=xb(f),j="x"===b?"y":"x",w=t.modifiersData.popperOffsets,N=t.rects.reference,_=t.rects.popper,k="function"==typeof x?x(Object.assign({},t.rects,{placement:t.placement})):x,S="number"==typeof k?{mainAxis:k,altAxis:k}:Object.assign({mainAxis:0,altAxis:0},k),D=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,$={x:0,y:0};if(w){if(r){var C,E="y"===b?Ry:Iy,T="y"===b?My:Ly,A="y"===b?"height":"width",F=w[b],P=F+g[E],O=F-g[T],R=p?-_[A]/2:0,M=v===Yy?N[A]:_[A],L=v===Yy?-_[A]:-N[A],I=t.elements.arrow,z=p&&I?ib(I):{width:0,height:0},B=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Y=B[E],V=B[T],q=gb(0,N[A],z[A]),U=y?N[A]/2-R-q-Y-S.mainAxis:M-q-Y-S.mainAxis,H=y?-N[A]/2+R+q+V+S.mainAxis:L+q+V+S.mainAxis,G=t.elements.arrow&&hb(t.elements.arrow),W=G?"y"===b?G.clientTop||0:G.clientLeft||0:0,K=null!=(C=null==D?void 0:D[b])?C:0,Z=F+H-K,Q=gb(p?tb(P,F+U-K-W):P,F,p?eb(O,Z):O);w[b]=Q,$[b]=Q-F}if(l){var X,J="x"===b?Ry:Iy,ee="x"===b?My:Ly,te=w[j],ne="y"===j?"height":"width",ae=te+g[J],se=te-g[ee],re=-1!==[Ry,Iy].indexOf(f),ie=null!=(X=null==D?void 0:D[j])?X:0,le=re?ae:te-N[ne]-_[ne]-ie+S.altAxis,oe=re?te+N[ne]+_[ne]-ie-S.altAxis:se,de=p&&re?function(e,t,n){var a=gb(e,t,n);return a>n?n:a}(le,te,oe):gb(p?le:ae,te,p?oe:se);w[j]=de,$[j]=de-te}t.modifiersData[a]=$}},requiresIfExists:["offset"]};function Ub(e,t,n){void 0===n&&(n=!1);var a,s,r=Xy(t),i=Xy(t)&&function(e){var t=e.getBoundingClientRect(),n=nb(t.width)/e.offsetWidth||1,a=nb(t.height)/e.offsetHeight||1;return 1!==n||1!==a}(t),l=ub(t),o=rb(e,i,n),d={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(r||!r&&!n)&&(("body"!==ob(t)||Ab(l))&&(d=(a=t)!==Zy(a)&&Xy(a)?{scrollLeft:(s=a).scrollLeft,scrollTop:s.scrollTop}:Eb(a)),Xy(t)?((c=rb(t,!0)).x+=t.clientLeft,c.y+=t.clientTop):l&&(c.x=Tb(l))),{x:o.left+d.scrollLeft-c.x,y:o.top+d.scrollTop-c.y,width:o.width,height:o.height}}function Hb(e){var t=new Map,n=new Set,a=[];function s(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){if(!n.has(e)){var a=t.get(e);a&&s(a)}}),a.push(e)}return e.forEach(function(e){t.set(e.name,e)}),e.forEach(function(e){n.has(e.name)||s(e)}),a}var Gb={placement:"bottom",modifiers:[],strategy:"absolute"};function Wb(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some(function(e){return!(e&&"function"==typeof e.getBoundingClientRect)})}var Kb=function(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,a=void 0===n?[]:n,s=t.defaultOptions,r=void 0===s?Gb:s;return function(e,t,n){void 0===n&&(n=r);var s,i,l={placement:"bottom",orderedModifiers:[],options:Object.assign({},Gb,r),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},o=[],d=!1,c={state:l,setOptions:function(n){var s="function"==typeof n?n(l.options):n;u(),l.options=Object.assign({},r,l.options,s),l.scrollParents={reference:Qy(e)?Pb(e):e.contextElement?Pb(e.contextElement):[],popper:Pb(t)};var i,d,m=function(e){var t=Hb(e);return Wy.reduce(function(e,n){return e.concat(t.filter(function(e){return e.phase===n}))},[])}((i=[].concat(a,l.options.modifiers),d=i.reduce(function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e},{}),Object.keys(d).map(function(e){return d[e]})));return l.orderedModifiers=m.filter(function(e){return e.enabled}),l.orderedModifiers.forEach(function(e){var t=e.name,n=e.options,a=void 0===n?{}:n,s=e.effect;if("function"==typeof s){var r=s({state:l,name:t,instance:c,options:a}),i=function(){};o.push(r||i)}}),c.update()},forceUpdate:function(){if(!d){var e=l.elements,t=e.reference,n=e.popper;if(Wb(t,n)){l.rects={reference:Ub(t,hb(n),"fixed"===l.options.strategy),popper:ib(n)},l.reset=!1,l.placement=l.options.placement,l.orderedModifiers.forEach(function(e){return l.modifiersData[e.name]=Object.assign({},e.data)});for(var a=0;a<l.orderedModifiers.length;a++)if(!0!==l.reset){var s=l.orderedModifiers[a],r=s.fn,i=s.options,o=void 0===i?{}:i,u=s.name;"function"==typeof r&&(l=r({state:l,options:o,name:u,instance:c})||l)}else l.reset=!1,a=-1}}},update:(s=function(){return new Promise(function(e){c.forceUpdate(),e(l)})},function(){return i||(i=new Promise(function(e){Promise.resolve().then(function(){i=void 0,e(s())})})),i}),destroy:function(){u(),d=!0}};if(!Wb(e,t))return c;function u(){o.forEach(function(e){return e()}),o=[]}return c.setOptions(n).then(function(e){!d&&n.onFirstUpdate&&n.onFirstUpdate(e)}),c}}({defaultModifiers:[{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,a=t.rects.reference,s=t.rects.popper,r=t.modifiersData.preventOverflow,i=Ib(t,{elementContext:"reference"}),l=Ib(t,{altBoundary:!0}),o=Bb(i,a),d=Bb(l,s,r),c=Yb(o),u=Yb(d);t.modifiersData[n]={referenceClippingOffsets:o,popperEscapeOffsets:d,isReferenceHidden:c,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":u})}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=Lb({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},Nb,kb,Vb,zb,qb,yb]}),Zb=function(e){return{position:e,top:"0",left:"0",opacity:"0",pointerEvents:"none"}},Qb={name:"applyStyles",enabled:!1},Xb={name:"ariaDescribedBy",enabled:!0,phase:"afterWrite",effect:function(e){var t=e.state;return function(){var e=t.elements,n=e.reference,a=e.popper;if("removeAttribute"in n){var s=(n.getAttribute("aria-describedby")||"").split(",").filter(function(e){return e.trim()!==a.id});s.length?n.setAttribute("aria-describedby",s.join(",")):n.removeAttribute("aria-describedby")}}},fn:function(e){var t,n=e.state.elements,a=n.popper,s=n.reference,r=null==(t=a.getAttribute("role"))?void 0:t.toLowerCase();if(a.id&&"tooltip"===r&&"setAttribute"in s){var i=s.getAttribute("aria-describedby");if(i&&-1!==i.split(",").indexOf(a.id))return;s.setAttribute("aria-describedby",i?i+","+a.id:a.id)}}},Jb=[];function ej(e,t,n,a){return function(e,t,n,a){if(a&&"boolean"!=typeof a&&!Ty){var s=a.once,r=a.capture,i=n;!Ty&&s&&(i=n.__once||function e(a){this.removeEventListener(t,e,r),n.call(this,a)},n.__once=i),e.addEventListener(t,i,Ey?a:r)}e.addEventListener(t,n,a)}(e,t,n,a),function(){!function(e,t,n,a){var s=a&&"boolean"!=typeof a?a.capture:a;e.removeEventListener(t,n,s),n.__once&&e.removeEventListener(t,n.__once,s)}(e,t,n,a)}}const tj=be(function(){});const nj=function(e){return ry(function(e){return e&&"setState"in e?je.findDOMNode(e):null!=e?e:null}(e))};var aj=function(){};var sj,rj=function(e){return e&&("current"in e?e.current:e)};function ij(e){var t,n,a,s,r,i=e.enabled,l=e.enableEvents,o=e.placement,d=e.flip,c=e.offset,u=e.fixed,m=e.containerPadding,p=e.arrowElement,h=e.popperConfig,x=void 0===h?{}:h,g=function(e){var t={};return Array.isArray(e)?(null==e||e.forEach(function(e){t[e.name]=e}),t):e||t}(x.modifiers);return qe({},x,{placement:o,enabled:i,strategy:u?"fixed":x.strategy,modifiers:(r=qe({},g,{eventListeners:{enabled:l},preventOverflow:qe({},g.preventOverflow,{options:m?qe({padding:m},null==(t=g.preventOverflow)?void 0:t.options):null==(n=g.preventOverflow)?void 0:n.options}),offset:{options:qe({offset:c},null==(a=g.offset)?void 0:a.options)},arrow:qe({},g.arrow,{enabled:!!p,options:qe({},null==(s=g.arrow)?void 0:s.options,{element:p})}),flip:qe({enabled:!!d},g.flip)}),void 0===r&&(r={}),Array.isArray(r)?r:Object.keys(r).map(function(e){return r[e].name=e,r[e]}))})}function lj(e){if((!sj&&0!==sj||e)&&by){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),sj=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return sj}var oj=function(e){var t;return"undefined"==typeof document?null:null==e?ry().body:("function"==typeof e&&(e=e()),e&&"current"in e&&(e=e.current),null!=(t=e)&&t.nodeType&&e||null)};function dj(e,t){var n=ve.useState(function(){return oj(e)}),a=n[0],s=n[1];if(!a){var r=oj(e);r&&s(r)}return ve.useEffect(function(){t&&a&&t(a)},[t,a]),ve.useEffect(function(){var t=oj(e);t!==a&&s(t)},[e,a]),a}const cj=e=>e&&"function"!=typeof e?t=>{e.current=t}:e;function uj(e,t){return ve.useMemo(()=>function(e,t){const n=cj(e),a=cj(t);return e=>{n&&n(e),a&&a(e)}}(e,t),[e,t])}var mj=ye.forwardRef(function(e,t){var n=e.flip,a=e.offset,s=e.placement,r=e.containerPadding,i=void 0===r?5:r,l=e.popperConfig,o=void 0===l?{}:l,d=e.transition,c=Py(),u=c[0],m=c[1],p=Py(),h=p[0],x=p[1],g=uj(m,t),f=dj(e.container),v=dj(e.target),y=ve.useState(!e.show),b=y[0],j=y[1],w=function(e,t,n){var a=void 0===n?{}:n,s=a.enabled,r=void 0===s||s,i=a.placement,l=void 0===i?"bottom":i,o=a.strategy,d=void 0===o?"absolute":o,c=a.modifiers,u=void 0===c?Jb:c,m=ze(a,["enabled","placement","strategy","modifiers"]),p=ve.useRef(),h=ve.useCallback(function(){var e;null==(e=p.current)||e.update()},[]),x=ve.useCallback(function(){var e;null==(e=p.current)||e.forceUpdate()},[]),g=Oy(ve.useState({placement:l,update:h,forceUpdate:x,attributes:{},styles:{popper:Zb(d),arrow:{}}})),f=g[0],v=g[1],y=ve.useMemo(function(){return{name:"updateStateModifier",enabled:!0,phase:"write",requires:["computeStyles"],fn:function(e){var t=e.state,n={},a={};Object.keys(t.elements).forEach(function(e){n[e]=t.styles[e],a[e]=t.attributes[e]}),v({state:t,styles:n,attributes:a,update:h,forceUpdate:x,placement:t.placement})}}},[h,x,v]);return ve.useEffect(function(){p.current&&r&&p.current.setOptions({placement:l,strategy:d,modifiers:[].concat(u,[y,Qb])})},[d,l,y,r]),ve.useEffect(function(){if(r&&null!=e&&null!=t)return p.current=Kb(e,t,qe({},m,{placement:l,strategy:d,modifiers:[].concat(u,[Xb,y])})),function(){null!=p.current&&(p.current.destroy(),p.current=void 0,v(function(e){return qe({},e,{attributes:{},styles:{popper:Zb(d)}})}))}},[r,e,t]),f}(v,u,ij({placement:s,enableEvents:!!e.show,containerPadding:i||5,flip:n,offset:a,arrowElement:h,popperConfig:o})),N=w.styles,_=w.attributes,k=ze(w,["styles","attributes"]);e.show?b&&j(!1):e.transition||b||j(!0);var S,D,$,C,E,T,A,F,P,O,R,M,L=e.show||d&&!b;if(S=u,D=e.onHide,$={disabled:!e.rootClose||e.rootCloseDisabled,clickTrigger:e.rootCloseEvent},E=(C=void 0===$?{}:$).disabled,T=C.clickTrigger,A=void 0===T?"click":T,F=ve.useRef(!1),P=D||aj,O=ve.useCallback(function(e){var t,n,a=rj(S);tj(!!a,"RootClose captured a close event but does not have a ref to compare it to. useRootClose(), should be passed a ref that resolves to a DOM node"),F.current=!(a&&(n=e,!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey))&&function(e){return 0===e.button}(e)&&!my(a,null!=(t=null==e.composedPath?void 0:e.composedPath()[0])?t:e.target))},[S]),R=Fy(function(e){F.current||P(e)}),M=Fy(function(e){27===e.keyCode&&P(e)}),ve.useEffect(function(){if(!E&&null!=S){var e=window.event,t=nj(rj(S)),n=ej(t,A,O,!0),a=ej(t,A,function(t){t!==e?R(t):e=void 0}),s=ej(t,"keyup",function(t){t!==e?M(t):e=void 0}),r=[];return"ontouchstart"in t.documentElement&&(r=[].slice.call(t.body.children).map(function(e){return ej(e,"mousemove",aj)})),function(){n(),a(),s(),r.forEach(function(e){return e()})}}},[S,E,A,O,R,M]),!L)return null;var I=e.children(qe({},k,{show:!!e.show,props:qe({},_.popper,{style:N.popper,ref:g}),arrowProps:qe({},_.arrow,{style:N.arrow,ref:x})}));if(d){var z=e.onExit,B=e.onExiting,Y=e.onEnter,V=e.onEntering,q=e.onEntered;I=ye.createElement(d,{in:e.show,appear:!0,onExit:z,onExiting:B,onExited:function(){j(!0),e.onExited&&e.onExited.apply(e,arguments)},onEnter:Y,onEntering:V,onEntered:q},I)}return f?je.createPortal(I,f):null});mj.displayName="Overlay",mj.propTypes={show:We.bool,placement:We.oneOf(Gy),target:We.any,container:We.any,flip:We.bool,children:We.func.isRequired,containerPadding:We.number,popperConfig:We.object,rootClose:We.bool,rootCloseEvent:We.oneOf(["click","mousedown"]),rootCloseDisabled:We.bool,onHide:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var s;return e.rootClose?(s=We.func).isRequired.apply(s,[e].concat(n)):We.func.apply(We,[e].concat(n))},transition:We.elementType,onEnter:We.func,onEntering:We.func,onEntered:We.func,onExit:We.func,onExiting:We.func,onExited:We.func};const pj=mj;function hj(e,t){var n=py(e);return n?n.innerHeight:t?e.clientHeight:fy(e).height}function xj(e,t,n){e.closest&&!n&&e.closest(t);var a=e;do{if($y(a,t))return a;a=a.parentElement}while(a&&a!==n&&a.nodeType===document.ELEMENT_NODE);return null}var gj=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function fj(e,t){return e===t||!(!gj(e)||!gj(t))}function vj(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!fj(e[n],t[n]))return!1;return!0}function yj(e,t){void 0===t&&(t=vj);var n=null;function a(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];if(n&&n.lastThis===this&&t(a,n.lastArgs))return n.lastResult;var r=e.apply(this,a);return n={lastResult:r,lastArgs:a,lastThis:this},r}return a.clear=function(){n=null},a}function bj(e,t){var n=py(e);return n?n.innerWidth:t?e.clientWidth:fy(e).width}function jj(e){return Xf(e)||Qv(e)||ev(e)||tv()}var wj=Ke,Nj=Ze,_j=He,kj=Qe,Sj=Object.prototype,Dj=Sj.hasOwnProperty;const $j=be(wj(function(e,t){e=Object(e);var n=-1,a=t.length,s=a>2?t[2]:void 0;for(s&&_j(t[0],t[1],s)&&(a=1);++n<a;)for(var r=t[n],i=kj(r),l=-1,o=i.length;++l<o;){var d=i[l],c=e[d];(void 0===c||Nj(c,Sj[d])&&!Dj.call(e,d))&&(e[d]=r[d])}return e}));var Cj=Xe,Ej=Je,Tj=et,Aj=tt,Fj=nt,Pj=lt,Oj=at,Rj=st,Mj=rt,Lj=it;const Ij=be(function(e,t,n){var a=Pj(e),s=a||Oj(e)||Lj(e);if(t=Aj(t),null==n){var r=e&&e.constructor;n=s?a?new r:[]:Mj(e)&&Rj(r)?Ej(Fj(e)):{}}return(s?Cj:Tj)(e,function(e,a,s){return t(n,e,a,s)}),n});!function(){var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g}();function zj(e){return e.children}var Bj="PREV",Yj="NEXT",Vj="TODAY",qj="DATE",Uj={MONTH:"month",WEEK:"week",WORK_WEEK:"work_week",DAY:"day",AGENDA:"agenda"},Hj=Object.keys(Uj).map(function(e){return Uj[e]});We.oneOfType([We.string,We.func]),We.any,We.func,We.oneOfType([We.arrayOf(We.oneOf(Hj)),We.objectOf(function(e,t){if(-1!==Hj.indexOf(t)&&"boolean"==typeof e[t])return null;for(var n=arguments.length,a=new Array(n>2?n-2:0),s=2;s<n;s++)a[s-2]=arguments[s];return We.elementType.apply(We,[e,t].concat(a))})]),We.oneOfType([We.oneOf(["overlap","no-overlap"]),We.func]);var Gj={seconds:1e3,minutes:6e4,hours:36e5,day:864e5};function Wj(e,t){var n=$v(e,"month");return $v(n,"week",t.startOfWeek())}function Kj(e,t){var n=Cv(e,"month");return Cv(n,"week",t.startOfWeek())}function Zj(e,t){for(var n=Wj(e,t),a=Kj(e,t),s=[];Ov(n,a,"day");)s.push(n),n=Sv(n,1,"day");return s}function Qj(e,t){var n=$v(e,t);return Ev(n,e)?n:Sv(n,1,t)}function Xj(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"day",a=e,s=[];Ov(a,t,n);)s.push(a),a=Sv(a,1,n);return s}function Jj(e,t){return null==t&&null==e?null:(null==t&&(t=new Date),null==e&&(e=new Date),e=$v(e,"day"),e=Yv(e,Yv(t)),e=Bv(e,Bv(t)),e=zv(e,zv(t)),Iv(e,Iv(t)))}function ew(e){return 0===Yv(e)&&0===Bv(e)&&0===zv(e)&&0===Iv(e)}function tw(e,t,n){return n&&"milliseconds"!==n?Math.round(Math.abs(+$v(e,n)/Gj[n]-+$v(t,n)/Gj[n])):Math.abs(+e-+t)}var nw=We.oneOfType([We.string,We.func]);function aw(e,t,n,a,s){var r="function"==typeof a?a(n,s,e):t.call(e,n,a,s);return iv(null==r||"string"==typeof r,"`localizer format(..)` must return a string, null, or undefined"),r}function sw(e,t,n){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,t+n,0,0)}function rw(e,t){return e.getTimezoneOffset()-t.getTimezoneOffset()}function iw(e,t){return tw(e,t,"minutes")+rw(e,t)}function lw(e){var t=$v(e,"day");return tw(t,e,"minutes")+rw(t,e)}function ow(e,t){return Pv(e,t,"day")}function dw(e,t,n){return Ev(e,t,"minutes")?Fv(t,n,"minutes"):Av(t,n,"minutes")}function cw(e,t){return function(e,t,n,a){return"day"===n&&(n="date"),Math.abs(Zv[n](e,void 0,a)-Zv[n](t,void 0,a))}(e,t,"day")}function uw(e){var t=e.evtA,n=t.start,a=t.end,s=t.allDay,r=e.evtB,i=r.start,l=r.end,o=r.allDay,d=+$v(n,"day")-+$v(i,"day"),c=cw(n,a),u=cw(i,l);return d||u-c||!!o-!!s||+n-+i||+a-+l}function mw(e){var t=e.event,n=t.start,a=t.end,s=e.range,r=s.start,i=s.end,l=$v(n,"day"),o=Ov(l,i,"day"),d=Tv(l,a,"minutes")?Av(a,r,"minutes"):Fv(a,r,"minutes");return o&&d}function pw(e,t){return Ev(e,t,"day")}function hw(e,t){return ew(e)&&ew(t)}var xw=Gf(function e(t){var n=this;Uf(this,e),iv("function"==typeof t.format,"date localizer `format(..)` must be a function"),iv("function"==typeof t.firstOfWeek,"date localizer `firstOfWeek(..)` must be a function"),this.propType=t.propType||nw,this.formats=t.formats,this.format=function(){for(var e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return aw.apply(void 0,[n,t.format].concat(a))},this.startOfWeek=t.firstOfWeek,this.merge=t.merge||Jj,this.inRange=t.inRange||Lv,this.lt=t.lt||Pv,this.lte=t.lte||Ov,this.gt=t.gt||Av,this.gte=t.gte||Fv,this.eq=t.eq||Ev,this.neq=t.neq||Tv,this.startOf=t.startOf||$v,this.endOf=t.endOf||Cv,this.add=t.add||Sv,this.range=t.range||Xj,this.diff=t.diff||tw,this.ceil=t.ceil||Qj,this.min=t.min||Rv,this.max=t.max||Mv,this.minutes=t.minutes||Bv,this.daySpan=t.daySpan||cw,this.firstVisibleDay=t.firstVisibleDay||Wj,this.lastVisibleDay=t.lastVisibleDay||Kj,this.visibleDays=t.visibleDays||Zj,this.getSlotDate=t.getSlotDate||sw,this.getTimezoneOffset=t.getTimezoneOffset||function(e){return e.getTimezoneOffset()},this.getDstOffset=t.getDstOffset||rw,this.getTotalMin=t.getTotalMin||iw,this.getMinutesFromMidnight=t.getMinutesFromMidnight||lw,this.continuesPrior=t.continuesPrior||ow,this.continuesAfter=t.continuesAfter||dw,this.sortEvents=t.sortEvents||uw,this.inEventRange=t.inEventRange||mw,this.isSameDate=t.isSameDate||pw,this.startAndEndAreDateOnly=t.startAndEndAreDateOnly||hw,this.segmentOffset=t.browserTZOffset?t.browserTZOffset():0});function gw(e,t,n,a){var s=Vf(Vf({},e.formats),n);return Vf(Vf({},e),{},{messages:a,startOfWeek:function(){return e.startOfWeek(t)},format:function(n,a){return e.format(n,s[a]||a,t)}})}var fw=function(){function e(){var t;Uf(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Zf(this,e,[].concat(a))).navigate=function(e){t.props.onNavigate(e)},t.view=function(e){t.props.onView(e)},t}return Qf(e,ye.Component),Gf(e,[{key:"render",value:function(){var e=this.props,t=e.localizer.messages,n=e.label;return ye.createElement("div",{className:"rbc-toolbar"},ye.createElement("span",{className:"rbc-btn-group"},ye.createElement("button",{type:"button",onClick:this.navigate.bind(null,Vj)},t.today),ye.createElement("button",{type:"button",onClick:this.navigate.bind(null,Bj)},t.previous),ye.createElement("button",{type:"button",onClick:this.navigate.bind(null,Yj)},t.next)),ye.createElement("span",{className:"rbc-toolbar-label"},n),ye.createElement("span",{className:"rbc-btn-group"},this.viewNamesGroup(t)))}},{key:"viewNamesGroup",value:function(e){var t=this,n=this.props.views,a=this.props.view;if(n.length>1)return n.map(function(n){return ye.createElement("button",{type:"button",key:n,className:sv({"rbc-active":a===n}),onClick:t.view.bind(null,n)},e[n])})}}])}();function vw(e,t){e&&e.apply(null,[].concat(t))}var yw={date:"Date",time:"Time",event:"Event",allDay:"All Day",week:"Week",work_week:"Work Week",day:"Day",month:"Month",previous:"Back",next:"Next",yesterday:"Yesterday",tomorrow:"Tomorrow",today:"Today",agenda:"Agenda",noEventsInRange:"There are no events in this range.",showMore:function(e){return"+".concat(e," more")}};var bw=["style","className","event","selected","isAllDay","onSelect","onDoubleClick","onKeyPress","localizer","continuesPrior","continuesAfter","accessors","getters","children","components","slotStart","slotEnd"],jw=function(){function e(){return Uf(this,e),Zf(this,e,arguments)}return Qf(e,ye.Component),Gf(e,[{key:"render",value:function(){var e=this.props,t=e.style,n=e.className,a=e.event,s=e.selected,r=e.isAllDay,i=e.onSelect,l=e.onDoubleClick,o=e.onKeyPress,d=e.localizer,c=e.continuesPrior,u=e.continuesAfter,m=e.accessors,p=e.getters,h=e.children,x=e.components,g=x.event,f=x.eventWrapper,v=e.slotStart,y=e.slotEnd,b=qf(e,bw);delete b.resizable;var j=m.title(a),w=m.tooltip(a),N=m.end(a),_=m.start(a),k=m.allDay(a),S=r||k||d.diff(_,d.ceil(N,"day"),"day")>1,D=p.eventProp(a,_,N,s),$=ye.createElement("div",{className:"rbc-event-content",title:w||void 0},g?ye.createElement(g,{event:a,continuesPrior:c,continuesAfter:u,title:j,isAllDay:k,localizer:d,slotStart:v,slotEnd:y}):j);return ye.createElement(f,Object.assign({},this.props,{type:"date"}),ye.createElement("div",Object.assign({},b,{style:Vf(Vf({},D.style),t),className:sv("rbc-event",n,D.className,{"rbc-selected":s,"rbc-event-allday":S,"rbc-event-continues-prior":c,"rbc-event-continues-after":u}),onClick:function(e){return i&&i(a,e)},onDoubleClick:function(e){return l&&l(a,e)},onKeyDown:function(e){return o&&o(a,e)}}),"function"==typeof h?h($):$))}}])}();function ww(e,t){return!(!e||null==t)&&ot(e,t)}function Nw(e,t){return(e.right-e.left)/t}function _w(e,t,n,a){var s=Nw(e,a);return n?a-1-Math.floor((t-e.left)/s):Math.floor((t-e.left)/s)}function kw(e){var t,n,a,s=e.containerRef,r=e.accessors,i=e.getters,l=e.selected,o=e.components,d=e.localizer,c=e.position,u=e.show,m=e.events,p=e.slotStart,h=e.slotEnd,x=e.onSelect,g=e.onDoubleClick,f=e.onKeyPress,v=e.handleDragStart,y=e.popperRef,b=e.target,j=e.offset;n=(t={ref:y,callback:u}).ref,a=t.callback,ve.useEffect(function(){var e=function(e){n.current&&!n.current.contains(e.target)&&a()};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}},[n,a]),ve.useLayoutEffect(function(){var e=function(e){var t=e.target,n=e.offset,a=e.container,s=e.box,r=fy(t),i=r.top,l=r.left,o=r.width,d=r.height,c=fy(a),u=c.top,m=c.left,p=c.width,h=c.height,x=fy(s),g=x.width,f=x.height,v=u+h,y=m+p,b=i+f,j=l+g,w=n.x,N=n.y;return{topOffset:b>v?i-f-N:i+N+d,leftOffset:j>y?l+w-g+o:l+w}}({target:b,offset:j,container:s.current,box:y.current}),t=e.topOffset,n=e.leftOffset;y.current.style.top="".concat(t,"px"),y.current.style.left="".concat(n,"px")},[j.x,j.y,b]);var w=c.width,N={minWidth:w+w/2};return ye.createElement("div",{style:N,className:"rbc-overlay",ref:y},ye.createElement("div",{className:"rbc-overlay-header"},d.format(p,"dayHeaderFormat")),m.map(function(e,t){return ye.createElement(jw,{key:t,type:"popup",localizer:d,event:e,getters:i,onSelect:x,accessors:r,components:o,onDoubleClick:g,onKeyPress:f,continuesPrior:d.lt(r.end(e),p,"day"),continuesAfter:d.gte(r.start(e),h,"day"),slotStart:p,slotEnd:h,selected:ww(e,l),draggable:!0,onDragStart:function(){return v(e)},onDragEnd:function(){return u()}})}))}var Sw=ye.forwardRef(function(e,t){return ye.createElement(kw,Object.assign({},e,{popperRef:t}))});function Dw(e){var t=e.containerRef,n=e.popupOffset,a=void 0===n?5:n,s=e.overlay,r=e.accessors,i=e.localizer,l=e.components,o=e.getters,d=e.selected,c=e.handleSelectEvent,u=e.handleDoubleClickEvent,m=e.handleKeyPressEvent,p=e.handleDragStart,h=e.onHide,x=e.overlayDisplay,g=ve.useRef(null);if(!s.position)return null;var f=a;isNaN(a)||(f={x:a,y:a});var v=s.position,y=s.events,b=s.date,j=s.end;return ye.createElement(pj,{rootClose:!0,flip:!0,show:!0,placement:"bottom",onHide:h,target:s.target},function(e){var n=e.props;return ye.createElement(Sw,Object.assign({},n,{containerRef:t,ref:g,target:s.target,offset:f,accessors:r,getters:o,selected:d,components:l,localizer:i,position:v,show:x,events:y,slotStart:b,slotEnd:j,onSelect:c,onDoubleClick:u,onKeyPress:m,handleDragStart:p}))})}Sw.propTypes={accessors:We.object.isRequired,getters:We.object.isRequired,selected:We.object,components:We.object.isRequired,localizer:We.object.isRequired,position:We.object.isRequired,show:We.func.isRequired,events:We.array.isRequired,slotStart:We.instanceOf(Date).isRequired,slotEnd:We.instanceOf(Date),onSelect:We.func,onDoubleClick:We.func,onKeyPress:We.func,handleDragStart:We.func,style:We.object,offset:We.shape({x:We.number,y:We.number})};var $w=ye.forwardRef(function(e,t){return ye.createElement(Dw,Object.assign({},e,{containerRef:t}))});function Cw(e,t){return ej(arguments.length>2&&void 0!==arguments[2]?arguments[2]:document,e,t,{passive:!1})}function Ew(e,t){return!!function(e,t){var n=t.clientX,a=t.clientY;return xj(document.elementFromPoint(n,a),".rbc-event",e)}(e,t)}function Tw(e,t){return!!function(e,t){var n=t.clientX,a=t.clientY;return xj(document.elementFromPoint(n,a),".rbc-show-more",e)}(e,t)}function Aw(e){var t=e;return e.touches&&e.touches.length&&(t=e.touches[0]),{clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY}}$w.propTypes={popupOffset:We.oneOfType([We.number,We.shape({x:We.number,y:We.number})]),overlay:We.shape({position:We.object,events:We.array,date:We.instanceOf(Date),end:We.instanceOf(Date)}),accessors:We.object.isRequired,localizer:We.object.isRequired,components:We.object.isRequired,getters:We.object.isRequired,selected:We.object,handleSelectEvent:We.func,handleDoubleClickEvent:We.func,handleKeyPressEvent:We.func,handleDragStart:We.func,onHide:We.func,overlayDisplay:We.func};var Fw=function(){return Gf(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.global;var a=n.longPressThreshold,s=void 0===a?250:a,r=n.validContainers,i=void 0===r?[]:r;Uf(this,e),this._initialEvent=null,this.selecting=!1,this.isDetached=!1,this.container=t,this.globalMouse=!t||globalThis,this.longPressThreshold=s,this.validContainers=i,this._listeners=Object.create(null),this._handleInitialEvent=this._handleInitialEvent.bind(this),this._handleMoveEvent=this._handleMoveEvent.bind(this),this._handleTerminatingEvent=this._handleTerminatingEvent.bind(this),this._keyListener=this._keyListener.bind(this),this._dropFromOutsideListener=this._dropFromOutsideListener.bind(this),this._dragOverFromOutsideListener=this._dragOverFromOutsideListener.bind(this),this._removeTouchMoveWindowListener=Cw("touchmove",function(){},window),this._removeKeyDownListener=Cw("keydown",this._keyListener),this._removeKeyUpListener=Cw("keyup",this._keyListener),this._removeDropFromOutsideListener=Cw("drop",this._dropFromOutsideListener),this._removeDragOverFromOutsideListener=Cw("dragover",this._dragOverFromOutsideListener),this._addInitialEventListener()},[{key:"on",value:function(e,t){var n=this._listeners[e]||(this._listeners[e]=[]);return n.push(t),{remove:function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}}}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var s;return(this._listeners[e]||[]).forEach(function(e){void 0===s&&(s=e.apply(void 0,n))}),s}},{key:"teardown",value:function(){this._initialEvent=null,this._initialEventData=null,this._selectRect=null,this.selecting=!1,this._lastClickData=null,this.isDetached=!0,this._listeners=Object.create(null),this._removeTouchMoveWindowListener&&this._removeTouchMoveWindowListener(),this._removeInitialEventListener&&this._removeInitialEventListener(),this._removeEndListener&&this._removeEndListener(),this._onEscListener&&this._onEscListener(),this._removeMoveListener&&this._removeMoveListener(),this._removeKeyUpListener&&this._removeKeyUpListener(),this._removeKeyDownListener&&this._removeKeyDownListener(),this._removeDropFromOutsideListener&&this._removeDropFromOutsideListener(),this._removeDragOverFromOutsideListener&&this._removeDragOverFromOutsideListener()}},{key:"isSelected",value:function(e){var t=this._selectRect;return!(!t||!this.selecting)&&Pw(t,Ow(e))}},{key:"filter",value:function(e){return this._selectRect&&this.selecting?e.filter(this.isSelected,this):[]}},{key:"_addLongPressListener",value:function(e,t){var n=this,a=null,s=null,r=null,i=function(t){a=setTimeout(function(){o(),e(t)},n.longPressThreshold),s=Cw("touchmove",function(){return o()}),r=Cw("touchend",function(){return o()})},l=Cw("touchstart",i),o=function(){a&&clearTimeout(a),s&&s(),r&&r(),a=null,s=null,r=null};return t&&i(t),function(){o(),l()}}},{key:"_addInitialEventListener",value:function(){var e=this,t=Cw("mousedown",function(t){e._removeInitialEventListener(),e._handleInitialEvent(t),e._removeInitialEventListener=Cw("mousedown",e._handleInitialEvent)}),n=Cw("touchstart",function(t){e._removeInitialEventListener(),e._removeInitialEventListener=e._addLongPressListener(e._handleInitialEvent,t)});this._removeInitialEventListener=function(){t(),n()}}},{key:"_dropFromOutsideListener",value:function(e){var t=Aw(e),n=t.pageX,a=t.pageY,s=t.clientX,r=t.clientY;this.emit("dropFromOutside",{x:n,y:a,clientX:s,clientY:r}),e.preventDefault()}},{key:"_dragOverFromOutsideListener",value:function(e){var t=Aw(e),n=t.pageX,a=t.pageY,s=t.clientX,r=t.clientY;this.emit("dragOverFromOutside",{x:n,y:a,clientX:s,clientY:r}),e.preventDefault()}},{key:"_handleInitialEvent",value:function(e){if(this._initialEvent=e,!this.isDetached){var t,n=Aw(e),a=n.clientX,s=n.clientY,r=n.pageX,i=n.pageY,l=this.container();if(3!==e.which&&2!==e.button&&(d=a,c=s,!(o=l)||my(o,document.elementFromPoint(d,c)))){var o,d,c;if(!this.globalMouse&&l&&!my(l,e.target)){var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;"object"!==bt(e)&&(e={top:e,left:e,right:e,bottom:e});return e}(0),m=u.top,p=u.left,h=u.bottom,x=u.right;if(!Pw({top:(t=Ow(l)).top-m,left:t.left-p,bottom:t.bottom+h,right:t.right+x},{top:i,left:r}))return}if(!1!==this.emit("beforeSelect",this._initialEventData={isTouch:/^touch/.test(e.type),x:r,y:i,clientX:a,clientY:s}))switch(e.type){case"mousedown":this._removeEndListener=Cw("mouseup",this._handleTerminatingEvent),this._onEscListener=Cw("keydown",this._handleTerminatingEvent),this._removeMoveListener=Cw("mousemove",this._handleMoveEvent);break;case"touchstart":this._handleMoveEvent(e),this._removeEndListener=Cw("touchend",this._handleTerminatingEvent),this._removeMoveListener=Cw("touchmove",this._handleMoveEvent)}}}}},{key:"_isWithinValidContainer",value:function(e){var t=e.target,n=this.validContainers;return!(n&&n.length&&t)||n.some(function(e){return!!t.closest(e)})}},{key:"_handleTerminatingEvent",value:function(e){var t=this.selecting,n=this._selectRect;if(!t&&e.type.includes("key")&&(e=this._initialEvent),this.selecting=!1,this._removeEndListener&&this._removeEndListener(),this._removeMoveListener&&this._removeMoveListener(),this._selectRect=null,this._initialEvent=null,this._initialEventData=null,e){var a=!this.container||my(this.container(),e.target),s=this._isWithinValidContainer(e);return"Escape"!==e.key&&s?!t&&a?this._handleClickEvent(e):t?this.emit("select",n):this.emit("reset"):this.emit("reset")}}},{key:"_handleClickEvent",value:function(e){var t=Aw(e),n=t.pageX,a=t.pageY,s=t.clientX,r=t.clientY,i=(new Date).getTime();return this._lastClickData&&i-this._lastClickData.timestamp<250?(this._lastClickData=null,this.emit("doubleClick",{x:n,y:a,clientX:s,clientY:r})):(this._lastClickData={timestamp:i},this.emit("click",{x:n,y:a,clientX:s,clientY:r}))}},{key:"_handleMoveEvent",value:function(e){if(null!==this._initialEventData&&!this.isDetached){var t=this._initialEventData,n=t.x,a=t.y,s=Aw(e),r=s.pageX,i=s.pageY,l=Math.abs(n-r),o=Math.abs(a-i),d=Math.min(r,n),c=Math.min(i,a),u=this.selecting,m=this.isClick(r,i);(!m||u||l||o)&&(u||m||this.emit("selectStart",this._initialEventData),m||(this.selecting=!0,this._selectRect={top:c,left:d,x:r,y:i,right:d+l,bottom:c+o},this.emit("selecting",this._selectRect)),e.preventDefault())}}},{key:"_keyListener",value:function(e){this.ctrl=e.metaKey||e.ctrlKey}},{key:"isClick",value:function(e,t){var n=this._initialEventData,a=n.x,s=n.y;return!n.isTouch&&Math.abs(e-a)<=5&&Math.abs(t-s)<=5}}])}();function Pw(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=Ow(e),s=a.top,r=a.left,i=a.right,l=void 0===i?r:i,o=a.bottom,d=void 0===o?s:o,c=Ow(t),u=c.top,m=c.left,p=c.right,h=void 0===p?m:p,x=c.bottom;return!(d-n<u||s+n>(void 0===x?u:x)||l-n<m||r+n>h)}function Ow(e){if(!e.getBoundingClientRect)return e;var t=e.getBoundingClientRect(),n=t.left+Rw("left"),a=t.top+Rw("top");return{top:a,left:n,right:(e.offsetWidth||0)+n,bottom:(e.offsetHeight||0)+a}}function Rw(e){return"left"===e?window.pageXOffset||document.body.scrollLeft||0:"top"===e?window.pageYOffset||document.body.scrollTop||0:void 0}var Mw=function(){function e(t,n){var a;return Uf(this,e),(a=Zf(this,e,[t,n])).state={selecting:!1},a.containerRef=ve.createRef(),a}return Qf(e,ye.Component),Gf(e,[{key:"componentDidMount",value:function(){this.props.selectable&&this._selectable()}},{key:"componentWillUnmount",value:function(){this._teardownSelectable()}},{key:"componentDidUpdate",value:function(e){!e.selectable&&this.props.selectable&&this._selectable(),e.selectable&&!this.props.selectable&&this._teardownSelectable()}},{key:"render",value:function(){var e=this.props,t=e.range,n=e.getNow,a=e.getters,s=e.date,r=e.components.dateCellWrapper,i=e.localizer,l=this.state,o=l.selecting,d=l.startIdx,c=l.endIdx,u=n();return ye.createElement("div",{className:"rbc-row-bg",ref:this.containerRef},t.map(function(e,n){var l=o&&n>=d&&n<=c,m=a.dayProp(e),p=m.className,h=m.style;return ye.createElement(r,{key:n,value:e,range:t},ye.createElement("div",{style:h,className:sv("rbc-day-bg",p,l&&"rbc-selected-cell",i.isSameDate(e,u)&&"rbc-today",s&&i.neq(s,e,"month")&&"rbc-off-range-bg")}))}))}},{key:"_selectable",value:function(){var e=this,t=this.containerRef.current,n=this._selector=new Fw(this.props.container,{longPressThreshold:this.props.longPressThreshold}),a=function(n,a){if(!Ew(t,n)&&!Tw(t,n)){var s=Ow(t),r=e.props,i=r.range,l=r.rtl;if(d=s,u=(c=n).x,(m=c.y)>=d.top&&m<=d.bottom&&u>=d.left&&u<=d.right){var o=_w(s,n.x,l,i.length);e._selectSlot({startIdx:o,endIdx:o,action:a,box:n})}}var d,c,u,m;e._initial={},e.setState({selecting:!1})};n.on("selecting",function(a){var s=e.props,r=s.range,i=s.rtl,l=-1,o=-1;if(e.state.selecting||(vw(e.props.onSelectStart,[a]),e._initial={x:a.x,y:a.y}),n.isSelected(t)){var d=Ow(t),c=function(e,t,n,a,s){var r=-1,i=-1,l=a-1,o=Nw(t,a),d=_w(t,n.x,s,a),c=t.top<n.y&&t.bottom>n.y,u=t.top<e.y&&t.bottom>e.y,m=e.y>t.bottom,p=t.top>e.y;return n.top<t.top&&n.bottom>t.bottom&&(r=0,i=l),c&&(p?(r=0,i=d):m&&(r=d,i=l)),u&&(r=i=s?l-Math.floor((e.x-t.left)/o):Math.floor((e.x-t.left)/o),c?d<r?r=d:i=d:e.y<n.y?i=l:r=0),{startIdx:r,endIdx:i}}(e._initial,d,a,r.length,i);l=c.startIdx,o=c.endIdx}e.setState({selecting:!0,startIdx:l,endIdx:o})}),n.on("beforeSelect",function(t){if("ignoreEvents"===e.props.selectable)return!Ew(e.containerRef.current,t)}),n.on("click",function(e){return a(e,"click")}),n.on("doubleClick",function(e){return a(e,"doubleClick")}),n.on("select",function(t){e._selectSlot(Vf(Vf({},e.state),{},{action:"select",bounds:t})),e._initial={},e.setState({selecting:!1}),vw(e.props.onSelectEnd,[e.state])})}},{key:"_teardownSelectable",value:function(){this._selector&&(this._selector.teardown(),this._selector=null)}},{key:"_selectSlot",value:function(e){var t=e.endIdx,n=e.startIdx,a=e.action,s=e.bounds,r=e.box;-1!==t&&-1!==n&&this.props.onSelectSlot&&this.props.onSelectSlot({start:n,end:t,action:a,bounds:s,box:r,resourceId:this.props.resourceId})}}])}(),Lw=(We.object.isRequired,We.object,We.bool,We.object.isRequired,We.object.isRequired,We.object.isRequired,We.object.isRequired,We.func,We.func,We.func,{segments:[],selected:{}}),Iw=function(e,t){var n=e.selected;e.isAllDay;var a=e.accessors,s=e.getters,r=e.onSelect,i=e.onDoubleClick,l=e.onKeyPress,o=e.localizer,d=e.slotMetrics,c=e.components,u=e.resizable,m=d.continuesPrior(t),p=d.continuesAfter(t);return ye.createElement(jw,{event:t,getters:s,localizer:o,accessors:a,components:c,onSelect:r,onDoubleClick:i,onKeyPress:l,continuesPrior:m,continuesAfter:p,slotStart:d.first,slotEnd:d.last,selected:ww(t,n),resizable:u})},zw=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ",s=Math.abs(t)/e*100+"%";return ye.createElement("div",{key:n,className:"rbc-row-segment",style:{WebkitFlexBasis:s,flexBasis:s,maxWidth:s}},a)},Bw=function(){function e(){return Uf(this,e),Zf(this,e,arguments)}return Qf(e,ye.Component),Gf(e,[{key:"render",value:function(){var e=this,t=this.props,n=t.segments,a=t.slotMetrics.slots,s=t.className,r=1;return ye.createElement("div",{className:sv(s,"rbc-row")},n.reduce(function(t,n,s){var i=n.event,l=n.left,o=n.right,d=n.span,c="_lvl_"+s,u=l-r,m=Iw(e.props,i);return u&&t.push(zw(a,u,"".concat(c,"_gap"))),t.push(zw(a,d,c,m)),r=o+1,t},[]))}}])}();function Yw(e){var t=e.dateRange,n=e.unit,a=void 0===n?"day":n,s=e.localizer;return{first:t[0],last:s.add(t[t.length-1],1,a)}}function Vw(e){var t,n,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=[],i=[];for(t=0;t<e.length;t++){for(a=e[t],n=0;n<r.length&&Uw(a,r[n]);n++);n>=s?i.push(a):(r[n]||(r[n]=[])).push(a)}for(t=0;t<r.length;t++)r[t].sort(function(e,t){return e.left-t.left});return{levels:r,extra:i}}function qw(e,t,n,a,s){var r={start:a.start(e),end:a.end(e)},i={start:t,end:n};return s.inEventRange({event:r,range:i})}function Uw(e,t){return t.some(function(t){return t.left<=e.right&&t.right>=e.left})}function Hw(e,t,n,a){var s={start:n.start(e),end:n.end(e),allDay:n.allDay(e)},r={start:n.start(t),end:n.end(t),allDay:n.allDay(t)};return a.sortEvents({evtA:s,evtB:r})}Bw.defaultProps=Vf({},Lw);var Gw=function(e,t){return e.left<=t&&e.right>=t},Ww=function(e,t){return e.filter(function(e){return Gw(e,t)}).map(function(e){return e.event})},Kw=function(){function e(){return Uf(this,e),Zf(this,e,arguments)}return Qf(e,ye.Component),Gf(e,[{key:"render",value:function(){for(var e=this.props,t=e.segments,n=e.slotMetrics.slots,a=Vw(t).levels[0],s=1,r=1,i=[];s<=n;){var l="_lvl_"+s,o=a.filter(function(e){return Gw(e,s)})[0]||{},d=o.event,c=o.left,u=o.right,m=o.span;if(d){var p=Math.max(0,c-r);if(this.canRenderSlotEvent(c,m)){var h=Iw(this.props,d);p&&i.push(zw(n,p,l+"_gap")),i.push(zw(n,m,l,h)),r=s=u+1}else p&&i.push(zw(n,p,l+"_gap")),i.push(zw(n,1,l,this.renderShowMore(t,s))),r=s+=1}else{if(this.getHiddenEventsForSlot(t,s).length>0){var x=s-r;x&&i.push(zw(n,x,l+"_gap")),i.push(zw(n,1,l,this.renderShowMore(t,s))),r=s+=1;continue}s++}}return ye.createElement("div",{className:"rbc-row"},i)}},{key:"getHiddenEventsForSlot",value:function(e,t){var n=Ww(e,t),a=Vw(e).levels[0].filter(function(e){return Gw(e,t)}).map(function(e){return e.event});return n.filter(function(e){return!a.some(function(t){return t===e})})}},{key:"canRenderSlotEvent",value:function(e,t){var n=this.props.segments;return dt(e,e+t).every(function(e){return 1===Ww(n,e).length})}},{key:"renderShowMore",value:function(e,t){var n=this,a=this.props,s=a.localizer,r=a.slotMetrics,i=a.components,l=r.getEventsForSlot(t),o=Ww(e,t),d=o.length;if(null!=i&&i.showMore){var c=i.showMore,u=r.getDateForSlot(t-1);return!!d&&ye.createElement(c,{localizer:s,slotDate:u,slot:t,count:d,events:l,remainingEvents:o})}return!!d&&ye.createElement("button",{type:"button",key:"sm_"+t,className:sv("rbc-button-link","rbc-show-more"),onClick:function(e){return n.showMore(t,e)}},s.messages.showMore(d,o,l))}},{key:"showMore",value:function(e,t){t.preventDefault(),t.stopPropagation(),this.props.onShowMore(e,t.target)}}])}();Kw.defaultProps=Vf({},Lw);var Zw=function(e){var t=e.children;return ye.createElement("div",{className:"rbc-row-content-scroll-container"},t)},Qw=function(e,t){return e[0].range===t[0].range&&e[0].events===t[0].events};function Xw(){return yj(function(e){for(var t=e.range,n=e.events,a=e.maxRows,s=e.minRows,r=e.accessors,i=e.localizer,l=Yw({dateRange:t,localizer:i}),o=l.first,d=l.last,c=n.map(function(e){return function(e,t,n,a){var s=Yw({dateRange:t,localizer:a}),r=s.first,i=s.last,l=a.diff(r,i,"day"),o=a.max(a.startOf(n.start(e),"day"),r),d=a.min(a.ceil(n.end(e),"day"),i),c=ht(t,function(e){return a.isSameDate(e,o)}),u=a.diff(o,d,"day");return u=Math.min(u,l),{event:e,span:u=Math.max(u-a.segmentOffset,1),left:c+1,right:Math.max(c+u,1)}}(e,t,r,i)}),u=Vw(c,Math.max(a-1,1)),m=u.levels,p=u.extra,h=p.length>0?s-1:s;m.length<h;)m.push([]);return{first:o,last:d,levels:m,extra:p,range:t,slots:t.length,clone:function(t){return Xw()(Vf(Vf({},e),t))},getDateForSlot:function(e){return t[e]},getSlotForDate:function(e){return t.find(function(t){return i.isSameDate(t,e)})},getEventsForSlot:function(e){return c.filter(function(t){return function(e,t){return e.left<=t&&e.right>=t}(t,e)}).map(function(e){return e.event})},continuesPrior:function(e){return i.continuesPrior(r.start(e),o)},continuesAfter:function(e){var t=r.start(e),n=r.end(e);return i.continuesAfter(t,n,d)}}},Qw)}var Jw=function(){function e(){var t;Uf(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Zf(this,e,[].concat(a))).handleSelectSlot=function(e){var n=t.props,a=n.range;(0,n.onSelectSlot)(a.slice(e.start,e.end+1),e)},t.handleShowMore=function(e,n){var a,s,r,i=t.props,l=i.range,o=i.onShowMore,d=t.slotMetrics(t.props),c=(a=t.containerRef.current,s=".rbc-row-bg",Cy(a.querySelectorAll(s)))[0];c&&(r=c.children[e-1]),o(d.getEventsForSlot(e),l[e-1],r,e,n)},t.getContainer=function(){var e=t.props.container;return e?e():t.containerRef.current},t.renderHeadingCell=function(e,n){var a=t.props,s=a.renderHeader,r=a.getNow,i=a.localizer;return s({date:e,key:"header_".concat(n),className:sv("rbc-date-cell",i.isSameDate(e,r())&&"rbc-now")})},t.renderDummy=function(){var e=t.props,n=e.className,a=e.range,s=e.renderHeader,r=e.showAllEvents;return ye.createElement("div",{className:n,ref:t.containerRef},ye.createElement("div",{className:sv("rbc-row-content",r&&"rbc-row-content-scrollable")},s&&ye.createElement("div",{className:"rbc-row",ref:t.headingRowRef},a.map(t.renderHeadingCell)),ye.createElement("div",{className:"rbc-row",ref:t.eventRowRef},ye.createElement("div",{className:"rbc-row-segment"},ye.createElement("div",{className:"rbc-event"},ye.createElement("div",{className:"rbc-event-content"}," "))))))},t.containerRef=ve.createRef(),t.headingRowRef=ve.createRef(),t.eventRowRef=ve.createRef(),t.slotMetrics=Xw(),t}return Qf(e,ye.Component),Gf(e,[{key:"getRowLimit",value:function(){var e,t=hj(this.eventRowRef.current),n=null!==(e=this.headingRowRef)&&void 0!==e&&e.current?hj(this.headingRowRef.current):0,a=hj(this.containerRef.current)-n;return Math.max(Math.floor(a/t),1)}},{key:"render",value:function(){var e=this.props,t=e.date,n=e.rtl,a=e.range,s=e.className,r=e.selected,i=e.selectable,l=e.renderForMeasure,o=e.accessors,d=e.getters,c=e.components,u=e.getNow,m=e.renderHeader,p=e.onSelect,h=e.localizer,x=e.onSelectStart,g=e.onSelectEnd,f=e.onDoubleClick,v=e.onKeyPress,y=e.resourceId,b=e.longPressThreshold,j=e.isAllDay,w=e.resizable,N=e.showAllEvents;if(l)return this.renderDummy();var _=this.slotMetrics(this.props),k=_.levels,S=_.extra,D=N?Zw:zj,$=c.weekWrapper,C={selected:r,accessors:o,getters:d,localizer:h,components:c,onSelect:p,onDoubleClick:f,onKeyPress:v,resourceId:y,slotMetrics:_,resizable:w};return ye.createElement("div",{className:s,role:"rowgroup",ref:this.containerRef},ye.createElement(Mw,{localizer:h,date:t,getNow:u,rtl:n,range:a,selectable:i,container:this.getContainer,getters:d,onSelectStart:x,onSelectEnd:g,onSelectSlot:this.handleSelectSlot,components:c,longPressThreshold:b,resourceId:y}),ye.createElement("div",{className:sv("rbc-row-content",N&&"rbc-row-content-scrollable"),role:"row"},m&&ye.createElement("div",{className:"rbc-row ",ref:this.headingRowRef},a.map(this.renderHeadingCell)),ye.createElement(D,null,ye.createElement($,Object.assign({isAllDay:j},C,{rtl:this.props.rtl}),k.map(function(e,t){return ye.createElement(Bw,Object.assign({key:t,segments:e},C))}),!!S.length&&ye.createElement(Kw,Object.assign({segments:S,onShowMore:this.handleShowMore},C))))))}}])}();Jw.defaultProps={minRows:0,maxRows:1/0};var eN=function(e){var t=e.label;return ye.createElement("span",{role:"columnheader","aria-sort":"none"},t)},tN=function(e){var t=e.label,n=e.drilldownView,a=e.onDrillDown;return n?ye.createElement("button",{type:"button",className:"rbc-button-link",onClick:a},t):ye.createElement("span",null,t)},nN=["date","className"],aN=function(){function e(){var t;Uf(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Zf(this,e,[].concat(a))).getContainer=function(){return t.containerRef.current},t.renderWeek=function(e,n){var a=t.props,s=a.events,r=a.components,i=a.selectable,l=a.getNow,o=a.selected,d=a.date,c=a.localizer,u=a.longPressThreshold,m=a.accessors,p=a.getters,h=a.showAllEvents,x=t.state,g=x.needLimitMeasure,f=x.rowLimit,v=function(e,t,n,a,s){return e.filter(function(e){return qw(e,t,n,a,s)})}(Xv(s),e[0],e[e.length-1],m,c),y=function(e,t,n){var a=Xv(e),s=[],r=[];a.forEach(function(e){var a=t.start(e),i=t.end(e);n.daySpan(a,i)>1?s.push(e):r.push(e)});var i=s.sort(function(e,a){return Hw(e,a,t,n)}),l=r.sort(function(e,a){return Hw(e,a,t,n)});return[].concat(Xv(i),Xv(l))}(v,m,c);return ye.createElement(Jw,{key:n,ref:0===n?t.slotRowRef:void 0,container:t.getContainer,className:"rbc-month-row",getNow:l,date:d,range:e,events:y,maxRows:h?1/0:f,selected:o,selectable:i,components:r,accessors:m,getters:p,localizer:c,renderHeader:t.readerDateHeading,renderForMeasure:g,onShowMore:t.handleShowMore,onSelect:t.handleSelectEvent,onDoubleClick:t.handleDoubleClickEvent,onKeyPress:t.handleKeyPressEvent,onSelectSlot:t.handleSelectSlot,longPressThreshold:u,rtl:t.props.rtl,resizable:t.props.resizable,showAllEvents:h})},t.readerDateHeading=function(e){var n=e.date,a=e.className,s=qf(e,nN),r=t.props,i=r.date,l=r.getDrilldownView,o=r.localizer,d=o.neq(i,n,"month"),c=o.isSameDate(n,i),u=l(n),m=o.format(n,"dateFormat"),p=t.props.components.dateHeader||tN;return ye.createElement("div",Object.assign({},s,{className:sv(a,d&&"rbc-off-range",c&&"rbc-current"),role:"cell"}),ye.createElement(p,{label:m,date:n,drilldownView:u,isOffRange:d,onDrillDown:function(e){return t.handleHeadingClick(n,u,e)}}))},t.handleSelectSlot=function(e,n){t._pendingSelection=t._pendingSelection.concat(e),clearTimeout(t._selectTimer),t._selectTimer=setTimeout(function(){return t.selectDates(n)})},t.handleHeadingClick=function(e,n,a){a.preventDefault(),t.clearSelection(),vw(t.props.onDrillDown,[e,n])},t.handleSelectEvent=function(){t.clearSelection();for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];vw(t.props.onSelectEvent,n)},t.handleDoubleClickEvent=function(){t.clearSelection();for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];vw(t.props.onDoubleClickEvent,n)},t.handleKeyPressEvent=function(){t.clearSelection();for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];vw(t.props.onKeyPressEvent,n)},t.handleShowMore=function(e,n,a,s,r){var i=t.props,l=i.popup,o=i.onDrillDown,d=i.onShowMore,c=i.getDrilldownView,u=i.doShowMoreDrillDown;if(t.clearSelection(),l){var m=yy(a,t.containerRef.current);t.setState({overlay:{date:n,events:e,position:m,target:r}})}else u&&vw(o,[n,c(n)||Uj.DAY]);vw(d,[e,n,s])},t.overlayDisplay=function(){t.setState({overlay:null})},t.state={rowLimit:5,needLimitMeasure:!0,date:null},t.containerRef=ve.createRef(),t.slotRowRef=ve.createRef(),t._bgRows=[],t._pendingSelection=[],t}return Qf(e,ye.Component),Gf(e,[{key:"componentDidMount",value:function(){var e,t=this;this.state.needLimitMeasure&&this.measureRowLimit(this.props),window.addEventListener("resize",this._resizeListener=function(){e||Dy(function(){e=!1,t.setState({needLimitMeasure:!0})})},!1)}},{key:"componentDidUpdate",value:function(){this.state.needLimitMeasure&&this.measureRowLimit(this.props)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._resizeListener,!1)}},{key:"render",value:function(){var e=this.props,t=e.date,n=e.localizer,a=e.className,s=n.visibleDays(t,n),r=sy(s,7);return this._weekCount=r.length,ye.createElement("div",{className:sv("rbc-month-view",a),role:"table","aria-label":"Month View",ref:this.containerRef},ye.createElement("div",{className:"rbc-row rbc-month-header",role:"row"},this.renderHeaders(r[0])),r.map(this.renderWeek),this.props.popup&&this.renderOverlay())}},{key:"renderHeaders",value:function(e){var t=this.props,n=t.localizer,a=t.components,s=e[0],r=e[e.length-1],i=a.header||eN;return n.range(s,r,"day").map(function(e,t){return ye.createElement("div",{key:"header_"+t,className:"rbc-header"},ye.createElement(i,{date:e,localizer:n,label:n.format(e,"weekdayFormat")}))})}},{key:"renderOverlay",value:function(){var e,t,n=this,a=null!==(e=null===(t=this.state)||void 0===t?void 0:t.overlay)&&void 0!==e?e:{},s=this.props,r=s.accessors,i=s.localizer,l=s.components,o=s.getters,d=s.selected,c=s.popupOffset,u=s.handleDragStart;return ye.createElement($w,{overlay:a,accessors:r,localizer:i,components:l,getters:o,selected:d,popupOffset:c,ref:this.containerRef,handleKeyPressEvent:this.handleKeyPressEvent,handleSelectEvent:this.handleSelectEvent,handleDoubleClickEvent:this.handleDoubleClickEvent,handleDragStart:u,show:!!a.position,overlayDisplay:this.overlayDisplay,onHide:function(){return n.setState({overlay:null})}})}},{key:"measureRowLimit",value:function(){this.setState({needLimitMeasure:!1,rowLimit:this.slotRowRef.current.getRowLimit()})}},{key:"selectDates",value:function(e){var t=this._pendingSelection.slice();this._pendingSelection=[],t.sort(function(e,t){return+e-+t});var n=new Date(t[0]),a=new Date(t[t.length-1]);a.setDate(t[t.length-1].getDate()+1),vw(this.props.onSelectSlot,{slots:t,start:n,end:a,action:e.action,bounds:e.bounds,box:e.box})}},{key:"clearSelection",value:function(){clearTimeout(this._selectTimer),this._pendingSelection=[]}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.date;return{date:n,needLimitMeasure:e.localizer.neq(n,t.date,"month")}}}])}();aN.range=function(e,t){var n=t.localizer;return{start:n.firstVisibleDay(e,n),end:n.lastVisibleDay(e,n)}},aN.navigate=function(e,t,n){var a=n.localizer;switch(t){case Bj:return a.add(e,-1,"month");case Yj:return a.add(e,1,"month");default:return e}},aN.title=function(e,t){return t.localizer.format(e,"monthHeaderFormat")};var sN=function(e){var t=e.min,n=e.max,a=e.step,s=e.slots,r=e.localizer;return"".concat(+r.startOf(t,"minutes"))+"".concat(+r.startOf(n,"minutes"))+"".concat(a,"-").concat(s)};function rN(e){for(var t=e.min,n=e.max,a=e.step,s=e.timeslots,r=e.localizer,i=sN({start:t,end:n,step:a,timeslots:s,localizer:r}),l=1+r.getTotalMin(t,n),o=r.getMinutesFromMidnight(t),d=Math.ceil((l-1)/(a*s)),c=d*s,u=new Array(d),m=new Array(c),p=0;p<d;p++){u[p]=new Array(s);for(var h=0;h<s;h++){var x=p*s+h,g=x*a;m[x]=u[p][h]=r.getSlotDate(t,o,g)}}var f=m.length*a;function v(e){var n=r.diff(t,e,"minutes")+r.getDstOffset(t,e);return Math.min(n,l)}return m.push(r.getSlotDate(t,o,f)),{groups:u,update:function(e){return sN(e)!==i?rN(e):this},dateIsInGroup:function(e,t){var a=u[t+1];return r.inRange(e,u[t][0],a?a[0]:n,"minutes")},nextSlot:function(e){var t=m[Math.min(m.findIndex(function(t){return t===e||r.eq(t,e)})+1,m.length-1)];return r.eq(t,e)&&(t=r.add(e,a,"minutes")),t},closestSlotToPosition:function(e){var t=Math.min(m.length-1,Math.max(0,Math.floor(e*c)));return m[t]},closestSlotFromPoint:function(e,t){var n=Math.abs(t.top-t.bottom);return this.closestSlotToPosition((e.y-t.top)/n)},closestSlotFromDate:function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r.lt(e,t,"minutes"))return m[0];if(r.gt(e,n,"minutes"))return m[m.length-1];var i=r.diff(t,e,"minutes");return m[(i-i%a)/a+s]},startsBeforeDay:function(e){return r.lt(e,t,"day")},startsAfterDay:function(e){return r.gt(e,n,"day")},startsBefore:function(e){return r.lt(r.merge(t,e),t,"minutes")},startsAfter:function(e){return r.gt(r.merge(n,e),n,"minutes")},getRange:function(e,s,i,l){i||(e=r.min(n,r.max(t,e))),l||(s=r.min(n,r.max(t,s)));var o=v(e),d=v(s),u=d>a*c&&!r.eq(n,s)?(o-a)/(a*c)*100:o/(a*c)*100;return{top:u,height:d/(a*c)*100-u,start:v(e),startDate:e,end:v(s),endDate:s}},getCurrentTimePosition:function(e){return v(e)/(a*c)*100}}}var iN=function(){return Gf(function e(t,n){var a=n.accessors,s=n.slotMetrics;Uf(this,e);var r=s.getRange(a.start(t),a.end(t)),i=r.start,l=r.startDate,o=r.end,d=r.endDate,c=r.top,u=r.height;this.start=i,this.end=o,this.startMs=+l,this.endMs=+d,this.top=c,this.height=u,this.data=t},[{key:"_width",get:function(){return this.rows?100/(this.rows.reduce(function(e,t){return Math.max(e,t.leaves.length+1)},0)+1):this.leaves?(100-this.container._width)/(this.leaves.length+1):this.row._width}},{key:"width",get:function(){var e=this._width,t=Math.min(100,1.7*this._width);if(this.rows)return t;if(this.leaves)return this.leaves.length>0?t:e;var n=this.row.leaves;return n.indexOf(this)===n.length-1?e:t}},{key:"xOffset",get:function(){if(this.rows)return 0;if(this.leaves)return this.container._width;var e=this.row,t=e.leaves,n=e.xOffset,a=e._width;return n+(t.indexOf(this)+1)*a}}])}();function lN(e,t,n){return Math.abs(t.start-e.start)<n||t.start>e.start&&t.start<e.end}function oN(e){for(var t=e.events,n=e.minimumStartDifference,a=e.slotMetrics,s=e.accessors,r=function(e){for(var t=xt(e,["startMs",function(e){return-e.endMs}]),n=[];t.length>0;){var a=t.shift();n.push(a);for(var s=0;s<t.length;s++){var r=t[s];if(!(a.endMs>r.startMs)){if(s>0){var i=t.splice(s,1)[0];n.push(i)}break}}}return n}(t.map(function(e){return new iN(e,{slotMetrics:a,accessors:s})})),i=[],l=function(){var e=r[o],t=i.find(function(t){return t.end>e.start||Math.abs(e.start-t.start)<n});if(!t)return e.rows=[],i.push(e),1;e.container=t;for(var a=null,s=t.rows.length-1;!a&&s>=0;s--)lN(t.rows[s],e,n)&&(a=t.rows[s]);a?(a.leaves.push(e),e.row=a):(e.leaves=[],t.rows.push(e))},o=0;o<r.length;o++)l();return r.map(function(e){return{event:e.data,style:{top:e.top,height:e.height,width:e.width,xOffset:Math.max(0,e.xOffset)}}})}function dN(e,t,n){for(var a=0;a<e.friends.length;++a)if(!(n.indexOf(e.friends[a])>-1)){t=t>e.friends[a].idx?t:e.friends[a].idx,n.push(e.friends[a]);var s=dN(e.friends[a],t,n);t=t>s?t:s}return t}var cN={overlap:oN,"no-overlap":function(e){var t=oN({events:e.events,minimumStartDifference:e.minimumStartDifference,slotMetrics:e.slotMetrics,accessors:e.accessors});t.sort(function(e,t){return e=e.style,t=t.style,e.top!==t.top?e.top>t.top?1:-1:e.height!==t.height?e.top+e.height<t.top+t.height?1:-1:0});for(var n=0;n<t.length;++n)t[n].friends=[],delete t[n].style.left,delete t[n].style.left,delete t[n].idx,delete t[n].size;for(var a=0;a<t.length-1;++a)for(var s=t[a],r=s.style.top,i=s.style.top+s.style.height,l=a+1;l<t.length;++l){var o=t[l],d=o.style.top,c=o.style.top+o.style.height;(d>=r&&c<=i||c>r&&c<=i||d>=r&&d<i)&&(s.friends.push(o),o.friends.push(s))}for(var u=0;u<t.length;++u){for(var m=t[u],p=[],h=0;h<100;++h)p.push(1);for(var x=0;x<m.friends.length;++x)void 0!==m.friends[x].idx&&(p[m.friends[x].idx]=0);m.idx=p.indexOf(1)}for(var g=0;g<t.length;++g){var f;if(!t[g].size){var v=[];f=100/(dN(t[g],0,v)+1),t[g].size=f;for(var y=0;y<v.length;++y)v[y].size=f}}for(var b=0;b<t.length;++b){var j=t[b];j.style.left=j.idx*j.size;for(var w=0,N=0;N<j.friends.length;++N){var _=j.friends[N].idx;w=w>_?w:_}w<=j.idx&&(j.size=100-j.idx*j.size);var k=0===j.idx?0:3;j.style.width="calc(".concat(j.size,"% - ").concat(k,"px)"),j.style.height="calc(".concat(j.style.height,"% - 2px)"),j.style.xOffset="calc(".concat(j.style.left,"% + ").concat(k,"px)")}return t}};var uN=function(){function e(){return Uf(this,e),Zf(this,e,arguments)}return Qf(e,ve.Component),Gf(e,[{key:"render",value:function(){var e=this.props,t=e.renderSlot,n=e.resource,a=e.group,s=e.getters,r=e.components,i=(void 0===r?{}:r).timeSlotWrapper,l=void 0===i?zj:i,o=s?s.slotGroupProp(a):{};return ye.createElement("div",Object.assign({className:"rbc-timeslot-group"},o),a.map(function(e,a){var r=s?s.slotProp(e,n):{};return ye.createElement(l,{key:a,value:e,resource:n},ye.createElement("div",Object.assign({},r,{className:sv("rbc-time-slot",r.className)}),t&&t(e,a)))}))}}])}();function mN(e){return"string"==typeof e?e:e+"%"}function pN(e){var t=e.style,n=e.className,a=e.event,s=e.accessors,r=e.rtl,i=e.selected,l=e.label,o=e.continuesPrior,d=e.continuesAfter,c=e.getters,u=e.onClick,m=e.onDoubleClick,p=e.isBackgroundEvent,h=e.onKeyPress,x=e.components,g=x.event,f=x.eventWrapper,v=s.title(a),y=s.tooltip(a),b=s.end(a),j=s.start(a),w=c.eventProp(a,j,b,i),N=[ye.createElement("div",{key:"1",className:"rbc-event-label"},l),ye.createElement("div",{key:"2",className:"rbc-event-content"},g?ye.createElement(g,{event:a,title:v}):v)],_=t.height,k=t.top,S=t.width,D=t.xOffset,$=Vf(Vf({},w.style),{},Bf({top:mN(k),height:mN(_),width:mN(S)},r?"right":"left",mN(D)));return ye.createElement(f,Object.assign({type:"time"},e),ye.createElement("div",{role:"button",tabIndex:0,onClick:u,onDoubleClick:m,style:$,onKeyDown:h,title:y?("string"==typeof l?l+": ":"")+y:void 0,className:sv(p?"rbc-background-event":"rbc-event",n,w.className,{"rbc-selected":i,"rbc-event-continues-earlier":o,"rbc-event-continues-later":d})},N))}var hN=function(e){var t=e.children,n=e.className,a=e.style,s=e.innerRef;return ye.createElement("div",{className:n,style:a,ref:s},t)},xN=ye.forwardRef(function(e,t){return ye.createElement(hN,Object.assign({},e,{innerRef:t}))}),gN=["dayProp"],fN=["eventContainerWrapper","timeIndicatorWrapper"],vN=function(){function e(){var t;Uf(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Zf(this,e,[].concat(a))).state={selecting:!1,timeIndicatorPosition:null},t.intervalTriggered=!1,t.renderEvents=function(e){var n=e.events,a=e.isBackgroundEvent,s=t.props,r=s.rtl,i=s.selected,l=s.accessors,o=s.localizer,d=s.getters,c=s.components,u=s.step,m=s.timeslots,p=s.dayLayoutAlgorithm,h=s.resizable,x=t.slotMetrics,g=o.messages,f=function(e){e.events,e.minimumStartDifference,e.slotMetrics,e.accessors;var t,n=e.dayLayoutAlgorithm,a=n;return n in cN&&(a=cN[n]),(t=a)&&t.constructor&&t.call&&t.apply?a.apply(this,arguments):[]}({events:n,accessors:l,slotMetrics:x,minimumStartDifference:Math.ceil(u*m/2),dayLayoutAlgorithm:p});return f.map(function(e,n){var s,u,m=e.event,p=e.style,f=l.end(m),v=l.start(m),y=null!==(s=l.eventId(m))&&void 0!==s?s:"evt_"+n,b="eventTimeRangeFormat",j=x.startsBeforeDay(v),w=x.startsAfterDay(f);j?b="eventTimeRangeEndFormat":w&&(b="eventTimeRangeStartFormat"),u=j&&w?g.allDay:o.format({start:v,end:f},b);var N=j||x.startsBefore(v),_=w||x.startsAfter(f);return ye.createElement(pN,{style:p,event:m,label:u,key:y,getters:d,rtl:r,components:c,continuesPrior:N,continuesAfter:_,accessors:l,resource:t.props.resource,selected:ww(m,i),onClick:function(e){return t._select(Vf(Vf(Vf({},m),t.props.resource&&{sourceResource:t.props.resource}),a&&{isBackgroundEvent:!0}),e)},onDoubleClick:function(e){return t._doubleClick(m,e)},isBackgroundEvent:a,onKeyPress:function(e){return t._keyPress(m,e)},resizable:h})})},t._selectable=function(){var e=t.containerRef.current,n=t.props,a=n.longPressThreshold,s=n.localizer,r=t._selector=new Fw(function(){return e},{longPressThreshold:a}),i=function(e){var n=t.props.onSelecting,a=t.state||{},r=l(e),i=r.startDate,o=r.endDate;n&&(s.eq(a.startDate,i,"minutes")&&s.eq(a.endDate,o,"minutes")||!1===n({start:i,end:o,resourceId:t.props.resource}))||t.state.start===r.start&&t.state.end===r.end&&t.state.selecting===r.selecting||t.setState(r)},l=function(n){var a=t.slotMetrics.closestSlotFromPoint(n,Ow(e));t.state.selecting||(t._initialSlot=a);var r=t._initialSlot;s.lte(r,a)?a=t.slotMetrics.nextSlot(a):s.gt(r,a)&&(r=t.slotMetrics.nextSlot(r));var i=t.slotMetrics.getRange(s.min(r,a),s.max(r,a));return Vf(Vf({},i),{},{selecting:!0,top:"".concat(i.top,"%"),height:"".concat(i.height,"%")})},o=function(e,n){if(!Ew(t.containerRef.current,e)){var a=l(e),s=a.startDate,r=a.endDate;t._selectSlot({startDate:s,endDate:r,action:n,box:e})}t.setState({selecting:!1})};r.on("selecting",i),r.on("selectStart",i),r.on("beforeSelect",function(e){if("ignoreEvents"===t.props.selectable)return!Ew(t.containerRef.current,e)}),r.on("click",function(e){return o(e,"click")}),r.on("doubleClick",function(e){return o(e,"doubleClick")}),r.on("select",function(e){t.state.selecting&&(t._selectSlot(Vf(Vf({},t.state),{},{action:"select",bounds:e})),t.setState({selecting:!1}))}),r.on("reset",function(){t.state.selecting&&t.setState({selecting:!1})})},t._teardownSelectable=function(){t._selector&&(t._selector.teardown(),t._selector=null)},t._selectSlot=function(e){for(var n=e.startDate,a=e.endDate,s=e.action,r=e.bounds,i=e.box,l=n,o=[];t.props.localizer.lte(l,a);)o.push(l),l=new Date(+l+60*t.props.step*1e3);vw(t.props.onSelectSlot,{slots:o,start:n,end:a,resourceId:t.props.resource,action:s,bounds:r,box:i})},t._select=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];vw(t.props.onSelectEvent,n)},t._doubleClick=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];vw(t.props.onDoubleClickEvent,n)},t._keyPress=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];vw(t.props.onKeyPressEvent,n)},t.slotMetrics=rN(t.props),t.containerRef=ve.createRef(),t}return Qf(e,ye.Component),Gf(e,[{key:"componentDidMount",value:function(){this.props.selectable&&this._selectable(),this.props.isNow&&this.setTimeIndicatorPositionUpdateInterval()}},{key:"componentWillUnmount",value:function(){this._teardownSelectable(),this.clearTimeIndicatorInterval()}},{key:"componentDidUpdate",value:function(e,t){this.props.selectable&&!e.selectable&&this._selectable(),!this.props.selectable&&e.selectable&&this._teardownSelectable();var n=this.props,a=n.getNow,s=n.isNow,r=n.localizer,i=n.date,l=n.min,o=n.max,d=r.neq(e.getNow(),a(),"minutes");if(e.isNow!==s||d){if(this.clearTimeIndicatorInterval(),s){var c=!d&&r.eq(e.date,i,"minutes")&&t.timeIndicatorPosition===this.state.timeIndicatorPosition;this.setTimeIndicatorPositionUpdateInterval(c)}}else s&&(r.neq(e.min,l,"minutes")||r.neq(e.max,o,"minutes"))&&this.positionTimeIndicator()}},{key:"setTimeIndicatorPositionUpdateInterval",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.intervalTriggered||t||this.positionTimeIndicator(),this._timeIndicatorTimeout=window.setTimeout(function(){e.intervalTriggered=!0,e.positionTimeIndicator(),e.setTimeIndicatorPositionUpdateInterval()},6e4)}},{key:"clearTimeIndicatorInterval",value:function(){this.intervalTriggered=!1,window.clearTimeout(this._timeIndicatorTimeout)}},{key:"positionTimeIndicator",value:function(){var e=this.props,t=e.min,n=e.max,a=(0,e.getNow)();if(a>=t&&a<=n){var s=this.slotMetrics.getCurrentTimePosition(a);this.intervalTriggered=!0,this.setState({timeIndicatorPosition:s})}else this.clearTimeIndicatorInterval()}},{key:"render",value:function(){var e=this.props,t=e.date,n=e.max,a=e.rtl,s=e.isNow,r=e.resource,i=e.accessors,l=e.localizer,o=e.getters,d=o.dayProp,c=qf(o,gN),u=e.components,m=u.eventContainerWrapper,p=u.timeIndicatorWrapper,h=qf(u,fN);this.slotMetrics=this.slotMetrics.update(this.props);var x=this.slotMetrics,g=this.state,f=g.selecting,v=g.top,y=g.height,b={start:g.startDate,end:g.endDate},j=d(n,r),w=j.className,N=j.style,_={className:"rbc-current-time-indicator",style:{top:"".concat(this.state.timeIndicatorPosition,"%")}},k=h.dayColumnWrapper||xN;return ye.createElement(k,{ref:this.containerRef,date:t,style:N,className:sv(w,"rbc-day-slot","rbc-time-column",s&&"rbc-now",s&&"rbc-today",f&&"rbc-slot-selecting"),slotMetrics:x,resource:r},x.groups.map(function(e,t){return ye.createElement(uN,{key:t,group:e,resource:r,getters:c,components:h})}),ye.createElement(m,{localizer:l,resource:r,accessors:i,getters:c,components:h,slotMetrics:x},ye.createElement("div",{className:sv("rbc-events-container",a&&"rtl")},this.renderEvents({events:this.props.backgroundEvents,isBackgroundEvent:!0}),this.renderEvents({events:this.props.events}))),f&&ye.createElement("div",{className:"rbc-slot-selection",style:{top:v,height:y}},ye.createElement("span",null,l.format(b,"selectRangeFormat"))),s&&this.intervalTriggered&&ye.createElement(p,_,ye.createElement("div",_)))}}])}();vN.defaultProps={dragThroughEvents:!0,timeslots:2};var yN=function(e){var t=e.label;return ye.createElement(ye.Fragment,null,t)},bN=function(){function e(){var t;Uf(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Zf(this,e,[].concat(a))).handleHeaderClick=function(e,n,a){a.preventDefault(),vw(t.props.onDrillDown,[e,n])},t.renderRow=function(e){var n=t.props,a=n.events,s=n.rtl,r=n.selectable,i=n.getNow,l=n.range,o=n.getters,d=n.localizer,c=n.accessors,u=n.components,m=n.resizable,p=c.resourceId(e),h=e?a.filter(function(e){return c.resource(e)===p}):a;return ye.createElement(Jw,{isAllDay:!0,rtl:s,getNow:i,minRows:2,maxRows:t.props.allDayMaxRows+1,range:l,events:h,resourceId:p,className:"rbc-allday-cell",selectable:r,selected:t.props.selected,components:u,accessors:c,getters:o,localizer:d,onSelect:t.props.onSelectEvent,onShowMore:t.props.onShowMore,onDoubleClick:t.props.onDoubleClickEvent,onKeyPress:t.props.onKeyPressEvent,onSelectSlot:t.props.onSelectSlot,longPressThreshold:t.props.longPressThreshold,resizable:m})},t}return Qf(e,ye.Component),Gf(e,[{key:"renderHeaderCells",value:function(e){var t=this,n=this.props,a=n.localizer,s=n.getDrilldownView,r=n.getNow,i=n.getters.dayProp,l=n.components.header,o=void 0===l?eN:l,d=r();return e.map(function(e,n){var r=s(e),l=a.format(e,"dayFormat"),c=i(e),u=c.className,m=c.style,p=ye.createElement(o,{date:e,label:l,localizer:a});return ye.createElement("div",{key:n,style:m,className:sv("rbc-header",u,a.isSameDate(e,d)&&"rbc-today")},r?ye.createElement("button",{type:"button",className:"rbc-button-link",onClick:function(n){return t.handleHeaderClick(e,r,n)}},p):ye.createElement("span",null,p))})}},{key:"render",value:function(){var e=this,t=this.props,n=t.width,a=t.rtl,s=t.resources,r=t.range,i=t.events,l=t.getNow,o=t.accessors,d=t.selectable,c=t.components,u=t.getters,m=t.scrollRef,p=t.localizer,h=t.isOverflowing,x=t.components,g=x.timeGutterHeader,f=x.resourceHeader,v=void 0===f?yN:f,y=t.resizable,b={};h&&(b[a?"marginLeft":"marginRight"]="".concat(lj()-1,"px"));var j=s.groupEvents(i);return ye.createElement("div",{style:b,ref:m,className:sv("rbc-time-header",h&&"rbc-overflowing")},ye.createElement("div",{className:"rbc-label rbc-time-header-gutter",style:{width:n,minWidth:n,maxWidth:n}},g&&ye.createElement(g,null)),s.map(function(t,n){var s=nv(t,2),i=s[0],m=s[1];return ye.createElement("div",{className:"rbc-time-header-content",key:i||n},m&&ye.createElement("div",{className:"rbc-row rbc-row-resource",key:"resource_".concat(n)},ye.createElement("div",{className:"rbc-header"},ye.createElement(v,{index:n,label:o.resourceTitle(m),resource:m}))),ye.createElement("div",{className:"rbc-row rbc-time-header-cell".concat(r.length<=1?" rbc-time-header-cell-single-day":"")},e.renderHeaderCells(r)),ye.createElement(Jw,{isAllDay:!0,rtl:a,getNow:l,minRows:2,maxRows:e.props.allDayMaxRows+1,range:r,events:j.get(i)||[],resourceId:m&&i,className:"rbc-allday-cell",selectable:d,selected:e.props.selected,components:c,accessors:o,getters:u,localizer:p,onSelect:e.props.onSelectEvent,onShowMore:e.props.onShowMore,onDoubleClick:e.props.onDoubleClickEvent,onKeyDown:e.props.onKeyPressEvent,onSelectSlot:e.props.onSelectSlot,longPressThreshold:e.props.longPressThreshold,resizable:y}))}))}}])}(),jN=function(){function e(){var t;Uf(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Zf(this,e,[].concat(a))).handleHeaderClick=function(e,n,a){a.preventDefault(),vw(t.props.onDrillDown,[e,n])},t}return Qf(e,ye.Component),Gf(e,[{key:"renderHeaderCells",value:function(e){var t=this,n=this.props,a=n.localizer,s=n.getDrilldownView,r=n.getNow,i=n.getters.dayProp,l=n.components,o=l.header,d=void 0===o?eN:o,c=l.resourceHeader,u=void 0===c?yN:c,m=n.resources,p=n.accessors,h=n.events,x=n.rtl,g=n.selectable,f=n.components,v=n.getters,y=n.resizable,b=r(),j=m.groupEvents(h);return e.map(function(n,l){var o=s(n),c=a.format(n,"dayFormat"),h=i(n),w=h.className,N=h.style,_=ye.createElement(d,{date:n,label:c,localizer:a});return ye.createElement("div",{key:l,className:"rbc-time-header-content rbc-resource-grouping"},ye.createElement("div",{className:"rbc-row rbc-time-header-cell".concat(e.length<=1?" rbc-time-header-cell-single-day":"")},ye.createElement("div",{style:N,className:sv("rbc-header",w,a.isSameDate(n,b)&&"rbc-today")},o?ye.createElement("button",{type:"button",className:"rbc-button-link",onClick:function(e){return t.handleHeaderClick(n,o,e)}},_):ye.createElement("span",null,_))),ye.createElement("div",{className:"rbc-row"},m.map(function(e,t){var s=nv(e,2),r=s[0],i=s[1];return ye.createElement("div",{key:"resource_".concat(r,"_").concat(t),className:sv("rbc-header",w,a.isSameDate(n,b)&&"rbc-today")},ye.createElement(u,{index:t,label:p.resourceTitle(i),resource:i}))})),ye.createElement("div",{className:"rbc-row rbc-m-b-negative-3 rbc-h-full"},m.map(function(e,s){var i=nv(e,2),l=i[0],o=i[1],d=(j.get(l)||[]).filter(function(e){return a.isSameDate(e.start,n)||a.isSameDate(e.end,n)});return ye.createElement(Jw,{key:"resource_".concat(l,"_").concat(s),isAllDay:!0,rtl:x,getNow:r,minRows:2,maxRows:t.props.allDayMaxRows+1,range:[n],events:d,resourceId:o&&l,className:"rbc-allday-cell",selectable:g,selected:t.props.selected,components:f,accessors:p,getters:v,localizer:a,onSelect:t.props.onSelectEvent,onShowMore:t.props.onShowMore,onDoubleClick:t.props.onDoubleClickEvent,onKeyDown:t.props.onKeyPressEvent,onSelectSlot:t.props.onSelectSlot,longPressThreshold:t.props.longPressThreshold,resizable:y})})))})}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.rtl,a=e.range,s=e.scrollRef,r=e.isOverflowing,i=e.components.timeGutterHeader,l={};return r&&(l[n?"marginLeft":"marginRight"]="".concat(lj()-1,"px")),ye.createElement("div",{style:l,ref:s,className:sv("rbc-time-header",r&&"rbc-overflowing")},ye.createElement("div",{className:"rbc-label rbc-time-header-gutter",style:{width:t,minWidth:t,maxWidth:t}},i&&ye.createElement(i,null)),this.renderHeaderCells(a))}}])}();var wN=function(e){var t=e.min,n=e.max,a=e.timeslots,s=e.step,r=e.localizer,i=e.getNow,l=e.resource,o=e.components,d=e.getters,c=e.gutterRef,u=o.timeGutterWrapper,m=ve.useMemo(function(){return function(e){var t=e.min,n=e.max,a=e.localizer;return a.getTimezoneOffset(t)!==a.getTimezoneOffset(n)?{start:a.add(t,-1,"day"),end:a.add(n,-1,"day")}:{start:t,end:n}}({min:t,max:n,localizer:r})},[null==t?void 0:t.toISOString(),null==n?void 0:n.toISOString(),r]),p=m.start,h=m.end,x=nv(ve.useState(rN({min:p,max:h,timeslots:a,step:s,localizer:r})),2),g=x[0],f=x[1];ve.useEffect(function(){g&&f(g.update({min:p,max:h,timeslots:a,step:s,localizer:r}))},[null==p?void 0:p.toISOString(),null==h?void 0:h.toISOString(),a,s]);var v=ve.useCallback(function(e,t){if(t)return null;var n=g.dateIsInGroup(i(),t);return ye.createElement("span",{className:sv("rbc-label",n&&"rbc-now")},r.format(e,"timeGutterFormat"))},[g,r,i]);return ye.createElement(u,{slotMetrics:g},ye.createElement("div",{className:"rbc-time-gutter rbc-time-column",ref:c},g.groups.map(function(e,t){return ye.createElement(uN,{key:t,group:e,resource:l,components:o,renderSlot:v,getters:d})})))},NN=ye.forwardRef(function(e,t){return ye.createElement(wN,Object.assign({gutterRef:t},e))}),_N={};var kN=function(){function e(t){var n;return Uf(this,e),(n=Zf(this,e,[t])).handleScroll=function(e){n.scrollRef.current&&(n.scrollRef.current.scrollLeft=e.target.scrollLeft)},n.handleResize=function(){Sy(n.rafHandle),n.rafHandle=Dy(n.checkOverflow)},n.handleKeyPressEvent=function(){n.clearSelection();for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];vw(n.props.onKeyPressEvent,t)},n.handleSelectEvent=function(){n.clearSelection();for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];vw(n.props.onSelectEvent,t)},n.handleDoubleClickEvent=function(){n.clearSelection();for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];vw(n.props.onDoubleClickEvent,t)},n.handleShowMore=function(e,t,a,s,r){var i=n.props,l=i.popup,o=i.onDrillDown,d=i.onShowMore,c=i.getDrilldownView,u=i.doShowMoreDrillDown;if(n.clearSelection(),l){var m=yy(a,n.containerRef.current);n.setState({overlay:{date:t,events:e,position:Vf(Vf({},m),{},{width:"200px"}),target:r}})}else u&&vw(o,[t,c(t)||Uj.DAY]);vw(d,[e,t,s])},n.handleSelectAllDaySlot=function(e,t){var a=n.props.onSelectSlot,s=new Date(e[0]),r=new Date(e[e.length-1]);r.setDate(e[e.length-1].getDate()+1),vw(a,{slots:e,start:s,end:r,action:t.action,resourceId:t.resourceId})},n.overlayDisplay=function(){n.setState({overlay:null})},n.checkOverflow=function(){if(!n._updatingOverflow){var e=n.contentRef.current;if(null!=e&&e.scrollHeight){var t=e.scrollHeight>e.clientHeight;n.state.isOverflowing!==t&&(n._updatingOverflow=!0,n.setState({isOverflowing:t},function(){n._updatingOverflow=!1}))}}},n.memoizedResources=yj(function(e,t){return function(e,t){return{map:function(n){return e?e.map(function(e,a){return n([t.resourceId(e),e],a)}):[n([_N,null],0)]},groupEvents:function(n){var a=new Map;return e?(n.forEach(function(e){var n=t.resource(e)||_N;if(Array.isArray(n))n.forEach(function(t){var n=a.get(t)||[];n.push(e),a.set(t,n)});else{var s=a.get(n)||[];s.push(e),a.set(n,s)}}),a):(a.set(_N,n),a)}}}(e,t)}),n.state={gutterWidth:void 0,isOverflowing:null},n.scrollRef=ye.createRef(),n.contentRef=ye.createRef(),n.containerRef=ye.createRef(),n._scrollRatio=null,n.gutterRef=ve.createRef(),n}return Qf(e,ve.Component),Gf(e,[{key:"getSnapshotBeforeUpdate",value:function(){return this.checkOverflow(),null}},{key:"componentDidMount",value:function(){null==this.props.width&&this.measureGutter(),this.calculateScroll(),this.applyScroll(),window.addEventListener("resize",this.handleResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),Sy(this.rafHandle),this.measureGutterAnimationFrameRequest&&window.cancelAnimationFrame(this.measureGutterAnimationFrameRequest)}},{key:"componentDidUpdate",value:function(){this.applyScroll()}},{key:"renderDayColumn",value:function(e,t,n,a,s,r,i,l,o,d){var c=this.props,u=c.min,m=c.max,p=(a.get(t)||[]).filter(function(t){return r.inRange(e,i.start(t),i.end(t),"day")}),h=(s.get(t)||[]).filter(function(t){return r.inRange(e,i.start(t),i.end(t),"day")});return ye.createElement(vN,Object.assign({},this.props,{localizer:r,min:r.merge(e,u),max:r.merge(e,m),resource:n&&t,components:l,isNow:r.isSameDate(e,d),key:"".concat(t,"-").concat(e),date:e,events:p,backgroundEvents:h,dayLayoutAlgorithm:o}))}},{key:"renderResourcesFirst",value:function(e,t,n,a,s,r,i,l,o){var d=this;return t.map(function(t){var c=nv(t,2),u=c[0],m=c[1];return e.map(function(e){return d.renderDayColumn(e,u,m,n,a,s,r,l,o,i)})})}},{key:"renderRangeFirst",value:function(e,t,n,a,s,r,i,l,o){var d=this;return e.map(function(e){return ye.createElement("div",{style:{display:"flex",minHeight:"100%",flex:1},key:e},t.map(function(t){var c=nv(t,2),u=c[0],m=c[1];return ye.createElement("div",{style:{flex:1},key:r.resourceId(m)},d.renderDayColumn(e,u,m,n,a,s,r,l,o,i))}))})}},{key:"renderEvents",value:function(e,t,n,a){var s=this.props,r=s.accessors,i=s.localizer,l=s.resourceGroupingLayout,o=s.components,d=s.dayLayoutAlgorithm,c=this.memoizedResources(this.props.resources,r),u=c.groupEvents(t),m=c.groupEvents(n);return l?this.renderRangeFirst(e,c,u,m,i,r,a,o,d):this.renderResourcesFirst(e,c,u,m,i,r,a,o,d)}},{key:"render",value:function(){var e,t=this.props,n=t.events,a=t.backgroundEvents,s=t.range,r=t.width,i=t.rtl,l=t.selected,o=t.getNow,d=t.resources,c=t.components,u=t.accessors,m=t.getters,p=t.localizer,h=t.min,x=t.max,g=t.showMultiDayTimes,f=t.longPressThreshold,v=t.resizable,y=t.resourceGroupingLayout;r=r||this.state.gutterWidth;var b=s[0],j=s[s.length-1];this.slots=s.length;var w=[],N=[],_=[];n.forEach(function(e){if(qw(e,b,j,u,p)){var t=u.start(e),n=u.end(e);u.allDay(e)||p.startAndEndAreDateOnly(t,n)||!g&&!p.isSameDate(t,n)?w.push(e):N.push(e)}}),a.forEach(function(e){qw(e,b,j,u,p)&&_.push(e)}),w.sort(function(e,t){return Hw(e,t,u,p)});var k={range:s,events:w,width:r,rtl:i,getNow:o,localizer:p,selected:l,allDayMaxRows:this.props.showAllEvents?1/0:null!==(e=this.props.allDayMaxRows)&&void 0!==e?e:1/0,resources:this.memoizedResources(d,u),selectable:this.props.selectable,accessors:u,getters:m,components:c,scrollRef:this.scrollRef,isOverflowing:this.state.isOverflowing,longPressThreshold:f,onSelectSlot:this.handleSelectAllDaySlot,onSelectEvent:this.handleSelectEvent,onShowMore:this.handleShowMore,onDoubleClickEvent:this.props.onDoubleClickEvent,onKeyPressEvent:this.props.onKeyPressEvent,onDrillDown:this.props.onDrillDown,getDrilldownView:this.props.getDrilldownView,resizable:v};return ye.createElement("div",{className:sv("rbc-time-view",d&&"rbc-time-view-resources"),ref:this.containerRef},d&&d.length>1&&y?ye.createElement(jN,k):ye.createElement(bN,k),this.props.popup&&this.renderOverlay(),ye.createElement("div",{ref:this.contentRef,className:"rbc-time-content",onScroll:this.handleScroll},ye.createElement(NN,{date:b,ref:this.gutterRef,localizer:p,min:p.merge(b,h),max:p.merge(b,x),step:this.props.step,getNow:this.props.getNow,timeslots:this.props.timeslots,components:c,className:"rbc-time-gutter",getters:m}),this.renderEvents(s,N,_,o())))}},{key:"renderOverlay",value:function(){var e,t,n=this,a=null!==(e=null===(t=this.state)||void 0===t?void 0:t.overlay)&&void 0!==e?e:{},s=this.props,r=s.accessors,i=s.localizer,l=s.components,o=s.getters,d=s.selected,c=s.popupOffset,u=s.handleDragStart;return ye.createElement($w,{overlay:a,accessors:r,localizer:i,components:l,getters:o,selected:d,popupOffset:c,ref:this.containerRef,handleKeyPressEvent:this.handleKeyPressEvent,handleSelectEvent:this.handleSelectEvent,handleDoubleClickEvent:this.handleDoubleClickEvent,handleDragStart:u,show:!!a.position,overlayDisplay:this.overlayDisplay,onHide:function(){return n.setState({overlay:null})}})}},{key:"clearSelection",value:function(){clearTimeout(this._selectTimer),this._pendingSelection=[]}},{key:"measureGutter",value:function(){var e=this;this.measureGutterAnimationFrameRequest&&window.cancelAnimationFrame(this.measureGutterAnimationFrameRequest),this.measureGutterAnimationFrameRequest=window.requestAnimationFrame(function(){var t,n=null!==(t=e.gutterRef)&&void 0!==t&&t.current?bj(e.gutterRef.current):void 0;n&&e.state.gutterWidth!==n&&e.setState({gutterWidth:n})})}},{key:"applyScroll",value:function(){if(null!=this._scrollRatio&&!0===this.props.enableAutoScroll){var e=this.contentRef.current;e.scrollTop=e.scrollHeight*this._scrollRatio,this._scrollRatio=null}}},{key:"calculateScroll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=e.min,n=e.max,a=e.scrollToTime,s=e.localizer,r=s.diff(s.merge(a,t),a,"milliseconds"),i=s.diff(t,n,"milliseconds");this._scrollRatio=r/i}}])}();kN.defaultProps={step:30,timeslots:2,resourceGroupingLayout:!1};var SN=["date","localizer","min","max","scrollToTime","enableAutoScroll"],DN=function(){function e(){return Uf(this,e),Zf(this,e,arguments)}return Qf(e,ye.Component),Gf(e,[{key:"render",value:function(){var t=this.props,n=t.date,a=t.localizer,s=t.min,r=void 0===s?a.startOf(new Date,"day"):s,i=t.max,l=void 0===i?a.endOf(new Date,"day"):i,o=t.scrollToTime,d=void 0===o?a.startOf(new Date,"day"):o,c=t.enableAutoScroll,u=void 0===c||c,m=qf(t,SN),p=e.range(n,{localizer:a});return ye.createElement(kN,Object.assign({},m,{range:p,eventOffset:10,localizer:a,min:r,max:l,scrollToTime:d,enableAutoScroll:u}))}}])}();DN.range=function(e,t){return[t.localizer.startOf(e,"day")]},DN.navigate=function(e,t,n){var a=n.localizer;switch(t){case Bj:return a.add(e,-1,"day");case Yj:return a.add(e,1,"day");default:return e}},DN.title=function(e,t){return t.localizer.format(e,"dayHeaderFormat")};var $N=["date","localizer","min","max","scrollToTime","enableAutoScroll"],CN=function(){function e(){return Uf(this,e),Zf(this,e,arguments)}return Qf(e,ye.Component),Gf(e,[{key:"render",value:function(){var t=this.props,n=t.date,a=t.localizer,s=t.min,r=void 0===s?a.startOf(new Date,"day"):s,i=t.max,l=void 0===i?a.endOf(new Date,"day"):i,o=t.scrollToTime,d=void 0===o?a.startOf(new Date,"day"):o,c=t.enableAutoScroll,u=void 0===c||c,m=qf(t,$N),p=e.range(n,this.props);return ye.createElement(kN,Object.assign({},m,{range:p,eventOffset:15,localizer:a,min:r,max:l,scrollToTime:d,enableAutoScroll:u}))}}])}();CN.defaultProps=kN.defaultProps,CN.navigate=function(e,t,n){var a=n.localizer;switch(t){case Bj:return a.add(e,-1,"week");case Yj:return a.add(e,1,"week");default:return e}},CN.range=function(e,t){var n=t.localizer,a=n.startOfWeek(),s=n.startOf(e,"week",a),r=n.endOf(e,"week",a);return n.range(s,r)},CN.title=function(e,t){var n=t.localizer,a=jj(CN.range(e,{localizer:n})),s=a[0],r=a.slice(1);return n.format({start:s,end:r.pop()},"dayRangeHeaderFormat")};var EN=["date","localizer","min","max","scrollToTime","enableAutoScroll"];function TN(e,t){return CN.range(e,t).filter(function(e){return-1===[6,0].indexOf(e.getDay())})}var AN=function(){function e(){return Uf(this,e),Zf(this,e,arguments)}return Qf(e,ye.Component),Gf(e,[{key:"render",value:function(){var e=this.props,t=e.date,n=e.localizer,a=e.min,s=void 0===a?n.startOf(new Date,"day"):a,r=e.max,i=void 0===r?n.endOf(new Date,"day"):r,l=e.scrollToTime,o=void 0===l?n.startOf(new Date,"day"):l,d=e.enableAutoScroll,c=void 0===d||d,u=qf(e,EN),m=TN(t,this.props);return ye.createElement(kN,Object.assign({},u,{range:m,eventOffset:15,localizer:n,min:s,max:i,scrollToTime:o,enableAutoScroll:c}))}}])}();AN.defaultProps=kN.defaultProps,AN.range=TN,AN.navigate=CN.navigate,AN.title=function(e,t){var n=t.localizer,a=jj(TN(e,{localizer:n})),s=a[0],r=a.slice(1);return n.format({start:s,end:r.pop()},"dayRangeHeaderFormat")};function FN(e){var t=e.accessors,n=e.components,a=e.date,s=e.events,r=e.getters,i=e.length,l=void 0===i?30:i,o=e.localizer,d=e.onDoubleClickEvent,c=e.onSelectEvent,u=e.selected,m=ve.useRef(null),p=ve.useRef(null),h=ve.useRef(null),x=ve.useRef(null),g=ve.useRef(null);ve.useEffect(function(){v()});var f=function(e,a){var s="",r=n.time,i=o.messages.allDay,l=t.end(a),d=t.start(a);return t.allDay(a)||(o.eq(d,l)?i=o.format(d,"agendaTimeFormat"):o.isSameDate(d,l)?i=o.format({start:d,end:l},"agendaTimeRangeFormat"):o.isSameDate(e,d)?i=o.format(d,"agendaTimeFormat"):o.isSameDate(e,l)&&(i=o.format(l,"agendaTimeFormat"))),o.gt(e,d,"day")&&(s="rbc-continues-prior"),o.lt(e,l,"day")&&(s+=" rbc-continues-after"),ye.createElement("span",{className:s.trim()},r?ye.createElement(r,{event:a,day:e,label:i}):i)},v=function(){if(g.current){var e=m.current,t=g.current.firstChild;if(t){var n=x.current.scrollHeight>x.current.clientHeight,a=[],s=a;a=[bj(t.children[0]),bj(t.children[1])],s[0]===a[0]&&s[1]===a[1]||(p.current.style.width=a[0]+"px",h.current.style.width=a[1]+"px"),n?(ut(e,"rbc-header-overflowing"),e.style.marginRight=lj()+"px"):mt(e,"rbc-header-overflowing")}}},y=o.messages,b=o.add(a,l,"day"),j=o.range(a,b,"day");return(s=s.filter(function(e){return qw(e,o.startOf(a,"day"),o.endOf(b,"day"),t,o)})).sort(function(e,n){return+t.start(e)-+t.start(n)}),ye.createElement("div",{className:"rbc-agenda-view"},0!==s.length?ye.createElement(ye.Fragment,null,ye.createElement("table",{ref:m,className:"rbc-agenda-table"},ye.createElement("thead",null,ye.createElement("tr",null,ye.createElement("th",{className:"rbc-header",ref:p},y.date),ye.createElement("th",{className:"rbc-header",ref:h},y.time),ye.createElement("th",{className:"rbc-header"},y.event)))),ye.createElement("div",{className:"rbc-agenda-content",ref:x},ye.createElement("table",{className:"rbc-agenda-table"},ye.createElement("tbody",{ref:g},j.map(function(e,a){return function(e,a,s){var i=n.event,l=n.date;return a=a.filter(function(n){return qw(n,o.startOf(e,"day"),o.endOf(e,"day"),t,o)}),a.map(function(n,m){var p=t.title(n),h=t.end(n),x=t.start(n),g=r.eventProp(n,x,h,ww(n,u)),v=0===m&&o.format(e,"agendaDateFormat"),y=0===m&&ye.createElement("td",{rowSpan:a.length,className:"rbc-agenda-date-cell"},l?ye.createElement(l,{day:e,label:v}):v);return ye.createElement("tr",{key:s+"_"+m,className:g.className,style:g.style},y,ye.createElement("td",{className:"rbc-agenda-time-cell"},f(e,n)),ye.createElement("td",{className:"rbc-agenda-event-cell",onClick:function(e){return c&&c(n,e)},onDoubleClick:function(e){return d&&d(n,e)}},i?ye.createElement(i,{event:n,title:p}):p))},[])}(e,s,a)}))))):ye.createElement("span",{className:"rbc-agenda-empty"},y.noEventsInRange))}FN.range=function(e,t){var n=t.length,a=void 0===n?30:n;return{start:e,end:t.localizer.add(e,a,"day")}},FN.navigate=function(e,t,n){var a=n.length,s=void 0===a?30:a,r=n.localizer;switch(t){case Bj:return r.add(e,-s,"day");case Yj:return r.add(e,s,"day");default:return e}},FN.title=function(e,t){var n=t.length,a=void 0===n?30:n,s=t.localizer,r=s.add(e,a,"day");return s.format({start:e,end:r},"agendaHeaderFormat")};var PN=Bf(Bf(Bf(Bf(Bf({},Uj.MONTH,aN),Uj.WEEK,CN),Uj.WORK_WEEK,AN),Uj.DAY,DN),Uj.AGENDA,FN),ON=["action","date","today"];var RN=function(e){return function(t){return function(e,t){var n=null;return"function"==typeof t?n=t(e):"string"==typeof t&&"object"===bt(e)&&null!=e&&t in e&&(n=e[t]),n}(t,e)}},MN=["view","date","getNow","onNavigate"],LN=["view","toolbar","events","backgroundEvents","resourceGroupingLayout","style","className","elementProps","date","getNow","length","showMultiDayTimes","onShowMore","doShowMoreDrillDown","components","formats","messages","culture"];function IN(e){if(Array.isArray(e))return e;for(var t=[],n=0,a=Object.entries(e);n<a.length;n++){var s=nv(a[n],2),r=s[0];s[1]&&t.push(r)}return t}var zN=function(){function e(){var t;Uf(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Zf(this,e,[].concat(a))).getViews=function(){var e=t.props.views;return Array.isArray(e)?Ij(e,function(e,t){return e[t]=PN[t]},{}):"object"===bt(e)?pt(e,function(e,t){return!0===e?PN[t]:e}):PN},t.getView=function(){return t.getViews()[t.props.view]},t.getDrilldownView=function(e){var n=t.props,a=n.view,s=n.drilldownView,r=n.getDrilldownView;return r?r(e,a,Object.keys(t.getViews())):s},t.handleRangeChange=function(e,n,a){var s=t.props,r=s.onRangeChange,i=s.localizer;r&&n.range&&r(n.range(e,{localizer:i}),a)},t.handleNavigate=function(e,n){var a=t.props,s=a.view,r=a.date,i=a.getNow,l=a.onNavigate,o=qf(a,MN),d=t.getView(),c=i();r=function(e,t){var n=t.action,a=t.date,s=t.today,r=qf(t,ON);switch(e="string"==typeof e?PN[e]:e,n){case Vj:a=s||new Date;break;case qj:break;default:iv(e&&"function"==typeof e.navigate,"Calendar View components must implement a static `.navigate(date, action)` method.s"),a=e.navigate(a,n,r)}return a}(d,Vf(Vf({},o),{},{action:e,date:n||r||c,today:c})),l(r,s,e),t.handleRangeChange(r,d)},t.handleViewChange=function(e){e!==t.props.view&&function(e,t){return-1!==IN(t.views).indexOf(e)}(e,t.props)&&t.props.onView(e);var n=t.getViews();t.handleRangeChange(t.props.date||t.props.getNow(),n[e],e)},t.handleSelectEvent=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];vw(t.props.onSelectEvent,n)},t.handleDoubleClickEvent=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];vw(t.props.onDoubleClickEvent,n)},t.handleKeyPressEvent=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];vw(t.props.onKeyPressEvent,n)},t.handleSelectSlot=function(e){vw(t.props.onSelectSlot,e)},t.handleDrillDown=function(e,n){var a=t.props.onDrillDown;a?a(e,n,t.drilldownView):(n&&t.handleViewChange(n),t.handleNavigate(qj,e))},t.state={context:e.getContext(t.props)},t}return Qf(e,ye.Component),Gf(e,[{key:"render",value:function(){var e=this.props,t=e.view,n=e.toolbar,a=e.events,s=e.backgroundEvents,r=e.resourceGroupingLayout,i=e.style,l=e.className,o=e.elementProps,d=e.date,c=e.getNow,u=e.length,m=e.showMultiDayTimes,p=e.onShowMore,h=e.doShowMoreDrillDown;e.components,e.formats,e.messages,e.culture;var x=qf(e,LN);d=d||c();var g=this.getView(),f=this.state.context,v=f.accessors,y=f.components,b=f.getters,j=f.localizer,w=f.viewNames,N=y.toolbar||fw,_=g.title(d,{localizer:j,length:u});return ye.createElement("div",Object.assign({},o,{className:sv(l,"rbc-calendar",x.rtl&&"rbc-rtl"),style:i}),n&&ye.createElement(N,{date:d,view:t,views:w,label:_,onView:this.handleViewChange,onNavigate:this.handleNavigate,localizer:j}),ye.createElement(g,Object.assign({},x,{events:a,backgroundEvents:s,date:d,getNow:c,length:u,localizer:j,getters:b,components:y,accessors:v,showMultiDayTimes:m,getDrilldownView:this.getDrilldownView,onNavigate:this.handleNavigate,onDrillDown:this.handleDrillDown,onSelectEvent:this.handleSelectEvent,onDoubleClickEvent:this.handleDoubleClickEvent,onKeyPressEvent:this.handleKeyPressEvent,onSelectSlot:this.handleSelectSlot,onShowMore:p,doShowMoreDrillDown:h,resourceGroupingLayout:r})))}}],[{key:"getDerivedStateFromProps",value:function(t){return{context:e.getContext(t)}}},{key:"getContext",value:function(e){var t=e.startAccessor,n=e.endAccessor,a=e.allDayAccessor,s=e.tooltipAccessor,r=e.titleAccessor,i=e.resourceAccessor,l=e.resourceIdAccessor,o=e.resourceTitleAccessor,d=e.eventIdAccessor,c=e.eventPropGetter,u=e.backgroundEventPropGetter,m=e.slotPropGetter,p=e.slotGroupPropGetter,h=e.dayPropGetter,x=e.view,g=e.views,f=e.localizer,v=e.culture,y=e.messages,b=void 0===y?{}:y,j=e.components,w=void 0===j?{}:j,N=e.formats,_=void 0===N?{}:N,k=IN(g);return{viewNames:k,localizer:gw(f,v,_,function(e){return Vf(Vf({},yw),e)}(b)),getters:{eventProp:function(){return c&&c.apply(void 0,arguments)||{}},backgroundEventProp:function(){return u&&u.apply(void 0,arguments)||{}},slotProp:function(){return m&&m.apply(void 0,arguments)||{}},slotGroupProp:function(){return p&&p.apply(void 0,arguments)||{}},dayProp:function(){return h&&h.apply(void 0,arguments)||{}}},components:$j(w[x]||{},ct(w,k),{eventWrapper:zj,backgroundEventWrapper:zj,eventContainerWrapper:zj,dateCellWrapper:zj,weekWrapper:zj,timeSlotWrapper:zj,timeGutterWrapper:zj,timeIndicatorWrapper:zj}),accessors:{start:RN(t),end:RN(n),allDay:RN(a),tooltip:RN(s),title:RN(r),resource:RN(i),resourceId:RN(l),resourceTitle:RN(o),eventId:RN(d)}}}}])}();zN.defaultProps={events:[],backgroundEvents:[],elementProps:{},popup:!1,toolbar:!0,view:Uj.MONTH,views:[Uj.MONTH,Uj.WEEK,Uj.DAY,Uj.AGENDA],step:30,length:30,allDayMaxRows:1/0,doShowMoreDrillDown:!0,drilldownView:Uj.DAY,titleAccessor:"title",tooltipAccessor:"title",allDayAccessor:"allDay",startAccessor:"start",endAccessor:"end",resourceAccessor:"resourceId",resourceIdAccessor:"id",resourceTitleAccessor:"title",eventIdAccessor:"id",longPressThreshold:250,getNow:function(){return new Date},dayLayoutAlgorithm:"overlap"};var BN,YN,VN=function e(t,n,a){void 0===a&&(a=[]);var s,r=t.displayName||t.name||"Component",i=!!(s=t)&&("function"!=typeof s||s.prototype&&s.prototype.isReactComponent),l=Object.keys(n),o=l.map(dv);!i&&a.length&&iv(!1);var d=function(e){function s(){for(var t,s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];(t=e.call.apply(e,[this].concat(r))||this).handlers=Object.create(null),l.forEach(function(e){var a=n[e];t.handlers[a]=function(n){if(t.props[a]){var s;t._notifying=!0;for(var r=arguments.length,i=new Array(r>1?r-1:0),l=1;l<r;l++)i[l-1]=arguments[l];(s=t.props)[a].apply(s,[n].concat(i)),t._notifying=!1}t.unmounted||t.setState(function(t){var a,s=t.values;return{values:qe(Object.create(null),s,(a={},a[e]=n,a))}})}}),a.length&&(t.attachRef=function(e){t.inner=e});var o=Object.create(null);return l.forEach(function(e){o[e]=t.props[dv(e)]}),t.state={values:o,prevProps:{}},t}Ve(s,e);var r=s.prototype;return r.shouldComponentUpdate=function(){return!this._notifying},s.getDerivedStateFromProps=function(e,t){var n=t.values,a=t.prevProps,s={values:qe(Object.create(null),n),prevProps:{}};return l.forEach(function(t){s.prevProps[t]=e[t],!ov(e,t)&&ov(a,t)&&(s.values[t]=e[dv(t)])}),s},r.componentWillUnmount=function(){this.unmounted=!0},r.render=function(){var e=this,n=this.props,a=n.innerRef,s=ze(n,["innerRef"]);o.forEach(function(e){delete s[e]});var r={};return l.forEach(function(t){var n=e.props[t];r[t]=void 0!==n?n:e.state.values[t]}),ye.createElement(t,qe({},s,r,this.handlers,{ref:a||this.attachRef}))},s}(ye.Component);!function(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!=typeof e.getDerivedStateFromProps&&"function"!=typeof t.getSnapshotBeforeUpdate)return e;var n=null,a=null,s=null;if("function"==typeof t.componentWillMount?n="componentWillMount":"function"==typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"==typeof t.componentWillReceiveProps?a="componentWillReceiveProps":"function"==typeof t.UNSAFE_componentWillReceiveProps&&(a="UNSAFE_componentWillReceiveProps"),"function"==typeof t.componentWillUpdate?s="componentWillUpdate":"function"==typeof t.UNSAFE_componentWillUpdate&&(s="UNSAFE_componentWillUpdate"),null!==n||null!==a||null!==s){var r=e.displayName||e.name,i="function"==typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+r+" uses "+i+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==a?"\n  "+a:"")+(null!==s?"\n  "+s:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"==typeof e.getDerivedStateFromProps&&(t.componentWillMount=cv,t.componentWillReceiveProps=uv),"function"==typeof t.getSnapshotBeforeUpdate){if("function"!=typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=mv;var l=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var a=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;l.call(this,e,t,a)}}}(d),d.displayName="Uncontrolled("+r+")",d.propTypes=qe({innerRef:function(){}},function(e){var t={};return Object.keys(e).forEach(function(e){t[dv(e)]=lv}),t}(n)),a.forEach(function(e){d.prototype[e]=function(){var t;return(t=this.inner)[e].apply(t,arguments)}});var c=d;return ye.forwardRef&&((c=ye.forwardRef(function(e,t){return ye.createElement(d,qe({},e,{innerRef:t,__source:{fileName:"/Users/jquense/src/uncontrollable/src/uncontrollable.js",lineNumber:128},__self:this}))})).propTypes=d.propTypes),c.ControlledComponent=t,c.deferControlTo=function(t,a,s){return void 0===a&&(a={}),e(t,qe({},n,a),s)},c}(zN,{view:"onView",date:"onNavigate",selected:"onSelectEvent"}),qN=function(e,t,n){var a=e.start,s=e.end;return n.format(a,"LT",t)+" – "+n.format(s,"LT",t)},UN={dateFormat:"DD",dayFormat:"DD ddd",weekdayFormat:"ddd",selectRangeFormat:qN,eventTimeRangeFormat:qN,eventTimeRangeStartFormat:function(e,t,n){var a=e.start;return n.format(a,"LT",t)+" – "},eventTimeRangeEndFormat:function(e,t,n){var a=e.end;return" – "+n.format(a,"LT",t)},timeGutterFormat:"LT",monthHeaderFormat:"MMMM YYYY",dayHeaderFormat:"dddd MMM DD",dayRangeHeaderFormat:function(e,t,n){var a=e.start,s=e.end;return n.format(a,"MMMM DD",t)+" – "+n.format(s,n.eq(a,s,"month")?"DD":"MMMM DD",t)},agendaHeaderFormat:function(e,t,n){var a=e.start,s=e.end;return n.format(a,"L",t)+" – "+n.format(s,"L",t)},agendaDateFormat:"ddd MMM DD",agendaTimeFormat:"LT",agendaTimeRangeFormat:qN};function HN(e){var t=e?e.toLowerCase():e;return"FullYear"===t?t="year":t||(t=void 0),t}function GN(){return BN.apply(null,arguments)}function WN(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function KN(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function ZN(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function QN(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(ZN(e,t))return!1;return!0}function XN(e){return void 0===e}function JN(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function e_(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function t_(e,t){var n,a=[],s=e.length;for(n=0;n<s;++n)a.push(t(e[n],n));return a}function n_(e,t){for(var n in t)ZN(t,n)&&(e[n]=t[n]);return ZN(t,"toString")&&(e.toString=t.toString),ZN(t,"valueOf")&&(e.valueOf=t.valueOf),e}function a_(e,t,n,a){return _S(e,t,n,a,!0).utc()}function s_(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function r_(e){var t=null,n=!1,a=e._d&&!isNaN(e._d.getTime());return a&&(t=s_(e),n=YN.call(t.parsedDateParts,function(e){return null!=e}),a=t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n),e._strict&&(a=a&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour)),null!=Object.isFrozen&&Object.isFrozen(e)?a:(e._isValid=a,e._isValid)}function i_(e){var t=a_(NaN);return null!=e?n_(s_(t),e):s_(t).userInvalidated=!0,t}YN=Array.prototype.some?Array.prototype.some:function(e){var t,n=Object(this),a=n.length>>>0;for(t=0;t<a;t++)if(t in n&&e.call(this,n[t],t,n))return!0;return!1};var l_=GN.momentProperties=[],o_=!1;function d_(e,t){var n,a,s,r=l_.length;if(XN(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),XN(t._i)||(e._i=t._i),XN(t._f)||(e._f=t._f),XN(t._l)||(e._l=t._l),XN(t._strict)||(e._strict=t._strict),XN(t._tzm)||(e._tzm=t._tzm),XN(t._isUTC)||(e._isUTC=t._isUTC),XN(t._offset)||(e._offset=t._offset),XN(t._pf)||(e._pf=s_(t)),XN(t._locale)||(e._locale=t._locale),r>0)for(n=0;n<r;n++)XN(s=t[a=l_[n]])||(e[a]=s);return e}function c_(e){d_(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===o_&&(o_=!0,GN.updateOffset(this),o_=!1)}function u_(e){return e instanceof c_||null!=e&&null!=e._isAMomentObject}function m_(e){!1===GN.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function p_(e,t){var n=!0;return n_(function(){if(null!=GN.deprecationHandler&&GN.deprecationHandler(null,e),n){var a,s,r,i=[],l=arguments.length;for(s=0;s<l;s++){if(a="","object"==typeof arguments[s]){for(r in a+="\n["+s+"] ",arguments[0])ZN(arguments[0],r)&&(a+=r+": "+arguments[0][r]+", ");a=a.slice(0,-2)}else a=arguments[s];i.push(a)}m_(e+"\nArguments: "+Array.prototype.slice.call(i).join("")+"\n"+(new Error).stack),n=!1}return t.apply(this,arguments)},t)}var h_,x_={};function g_(e,t){null!=GN.deprecationHandler&&GN.deprecationHandler(e,t),x_[e]||(m_(t),x_[e]=!0)}function f_(e){return"undefined"!=typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function v_(e,t){var n,a=n_({},e);for(n in t)ZN(t,n)&&(KN(e[n])&&KN(t[n])?(a[n]={},n_(a[n],e[n]),n_(a[n],t[n])):null!=t[n]?a[n]=t[n]:delete a[n]);for(n in e)ZN(e,n)&&!ZN(t,n)&&KN(e[n])&&(a[n]=n_({},a[n]));return a}function y_(e){null!=e&&this.set(e)}GN.suppressDeprecationWarnings=!1,GN.deprecationHandler=null,h_=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)ZN(e,t)&&n.push(t);return n};function b_(e,t,n){var a=""+Math.abs(e),s=t-a.length;return(e>=0?n?"+":"":"-")+Math.pow(10,Math.max(0,s)).toString().substr(1)+a}var j_=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,w_=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,N_={},__={};function k_(e,t,n,a){var s=a;"string"==typeof a&&(s=function(){return this[a]()}),e&&(__[e]=s),t&&(__[t[0]]=function(){return b_(s.apply(this,arguments),t[1],t[2])}),n&&(__[n]=function(){return this.localeData().ordinal(s.apply(this,arguments),e)})}function S_(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function D_(e,t){return e.isValid()?(t=$_(t,e.localeData()),N_[t]=N_[t]||function(e){var t,n,a=e.match(j_);for(t=0,n=a.length;t<n;t++)__[a[t]]?a[t]=__[a[t]]:a[t]=S_(a[t]);return function(t){var s,r="";for(s=0;s<n;s++)r+=f_(a[s])?a[s].call(t,e):a[s];return r}}(t),N_[t](e)):e.localeData().invalidDate()}function $_(e,t){var n=5;function a(e){return t.longDateFormat(e)||e}for(w_.lastIndex=0;n>=0&&w_.test(e);)e=e.replace(w_,a),w_.lastIndex=0,n-=1;return e}var C_={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function E_(e){return"string"==typeof e?C_[e]||C_[e.toLowerCase()]:void 0}function T_(e){var t,n,a={};for(n in e)ZN(e,n)&&(t=E_(n))&&(a[t]=e[n]);return a}var A_={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};var F_,P_=/\d/,O_=/\d\d/,R_=/\d{3}/,M_=/\d{4}/,L_=/[+-]?\d{6}/,I_=/\d\d?/,z_=/\d\d\d\d?/,B_=/\d\d\d\d\d\d?/,Y_=/\d{1,3}/,V_=/\d{1,4}/,q_=/[+-]?\d{1,6}/,U_=/\d+/,H_=/[+-]?\d+/,G_=/Z|[+-]\d\d:?\d\d/gi,W_=/Z|[+-]\d\d(?::?\d\d)?/gi,K_=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Z_=/^[1-9]\d?/,Q_=/^([1-9]\d|\d)/;function X_(e,t,n){F_[e]=f_(t)?t:function(e,a){return e&&n?n:t}}function J_(e,t){return ZN(F_,e)?F_[e](t._strict,t._locale):new RegExp(ek(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,a,s){return t||n||a||s})))}function ek(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function tk(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function nk(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=tk(t)),n}F_={};var ak={};function sk(e,t){var n,a,s=t;for("string"==typeof e&&(e=[e]),JN(t)&&(s=function(e,n){n[t]=nk(e)}),a=e.length,n=0;n<a;n++)ak[e[n]]=s}function rk(e,t){sk(e,function(e,n,a,s){a._w=a._w||{},t(e,a._w,a,s)})}function ik(e,t,n){null!=t&&ZN(ak,e)&&ak[e](t,n._a,n,e)}function lk(e){return e%4==0&&e%100!=0||e%400==0}var ok=0,dk=1,ck=2,uk=3,mk=4,pk=5,hk=6,xk=7,gk=8;function fk(e){return lk(e)?366:365}k_("Y",0,0,function(){var e=this.year();return e<=9999?b_(e,4):"+"+e}),k_(0,["YY",2],0,function(){return this.year()%100}),k_(0,["YYYY",4],0,"year"),k_(0,["YYYYY",5],0,"year"),k_(0,["YYYYYY",6,!0],0,"year"),X_("Y",H_),X_("YY",I_,O_),X_("YYYY",V_,M_),X_("YYYYY",q_,L_),X_("YYYYYY",q_,L_),sk(["YYYYY","YYYYYY"],ok),sk("YYYY",function(e,t){t[ok]=2===e.length?GN.parseTwoDigitYear(e):nk(e)}),sk("YY",function(e,t){t[ok]=GN.parseTwoDigitYear(e)}),sk("Y",function(e,t){t[ok]=parseInt(e,10)}),GN.parseTwoDigitYear=function(e){return nk(e)+(nk(e)>68?1900:2e3)};var vk,yk=bk("FullYear",!0);function bk(e,t){return function(n){return null!=n?(wk(this,e,n),GN.updateOffset(this,t),this):jk(this,e)}}function jk(e,t){if(!e.isValid())return NaN;var n=e._d,a=e._isUTC;switch(t){case"Milliseconds":return a?n.getUTCMilliseconds():n.getMilliseconds();case"Seconds":return a?n.getUTCSeconds():n.getSeconds();case"Minutes":return a?n.getUTCMinutes():n.getMinutes();case"Hours":return a?n.getUTCHours():n.getHours();case"Date":return a?n.getUTCDate():n.getDate();case"Day":return a?n.getUTCDay():n.getDay();case"Month":return a?n.getUTCMonth():n.getMonth();case"FullYear":return a?n.getUTCFullYear():n.getFullYear();default:return NaN}}function wk(e,t,n){var a,s,r,i,l;if(e.isValid()&&!isNaN(n)){switch(a=e._d,s=e._isUTC,t){case"Milliseconds":return void(s?a.setUTCMilliseconds(n):a.setMilliseconds(n));case"Seconds":return void(s?a.setUTCSeconds(n):a.setSeconds(n));case"Minutes":return void(s?a.setUTCMinutes(n):a.setMinutes(n));case"Hours":return void(s?a.setUTCHours(n):a.setHours(n));case"Date":return void(s?a.setUTCDate(n):a.setDate(n));case"FullYear":break;default:return}r=n,i=e.month(),l=29!==(l=e.date())||1!==i||lk(r)?l:28,s?a.setUTCFullYear(r,i,l):a.setFullYear(r,i,l)}}function Nk(e,t){if(isNaN(e)||isNaN(t))return NaN;var n,a=(t%(n=12)+n)%n;return e+=(t-a)/12,1===a?lk(e)?29:28:31-a%7%2}vk=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},k_("M",["MM",2],"Mo",function(){return this.month()+1}),k_("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),k_("MMMM",0,0,function(e){return this.localeData().months(this,e)}),X_("M",I_,Z_),X_("MM",I_,O_),X_("MMM",function(e,t){return t.monthsShortRegex(e)}),X_("MMMM",function(e,t){return t.monthsRegex(e)}),sk(["M","MM"],function(e,t){t[dk]=nk(e)-1}),sk(["MMM","MMMM"],function(e,t,n,a){var s=n._locale.monthsParse(e,a,n._strict);null!=s?t[dk]=s:s_(n).invalidMonth=e});var _k="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),kk="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Sk=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Dk=K_,$k=K_;function Ck(e,t,n){var a,s,r,i=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],a=0;a<12;++a)r=a_([2e3,a]),this._shortMonthsParse[a]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[a]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(s=vk.call(this._shortMonthsParse,i))?s:null:-1!==(s=vk.call(this._longMonthsParse,i))?s:null:"MMM"===t?-1!==(s=vk.call(this._shortMonthsParse,i))||-1!==(s=vk.call(this._longMonthsParse,i))?s:null:-1!==(s=vk.call(this._longMonthsParse,i))||-1!==(s=vk.call(this._shortMonthsParse,i))?s:null}function Ek(e,t){if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=nk(t);else if(!JN(t=e.localeData().monthsParse(t)))return e;var n=t,a=e.date();return a=a<29?a:Math.min(a,Nk(e.year(),n)),e._isUTC?e._d.setUTCMonth(n,a):e._d.setMonth(n,a),e}function Tk(e){return null!=e?(Ek(this,e),GN.updateOffset(this,!0),this):jk(this,"Month")}function Ak(){function e(e,t){return t.length-e.length}var t,n,a,s,r=[],i=[],l=[];for(t=0;t<12;t++)n=a_([2e3,t]),a=ek(this.monthsShort(n,"")),s=ek(this.months(n,"")),r.push(a),i.push(s),l.push(s),l.push(a);r.sort(e),i.sort(e),l.sort(e),this._monthsRegex=new RegExp("^("+l.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+r.join("|")+")","i")}function Fk(e,t,n,a,s,r,i){var l;return e<100&&e>=0?(l=new Date(e+400,t,n,a,s,r,i),isFinite(l.getFullYear())&&l.setFullYear(e)):l=new Date(e,t,n,a,s,r,i),l}function Pk(e){var t,n;return e<100&&e>=0?((n=Array.prototype.slice.call(arguments))[0]=e+400,t=new Date(Date.UTC.apply(null,n)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function Ok(e,t,n){var a=7+t-n;return-((7+Pk(e,0,a).getUTCDay()-t)%7)+a-1}function Rk(e,t,n,a,s){var r,i,l=1+7*(t-1)+(7+n-a)%7+Ok(e,a,s);return l<=0?i=fk(r=e-1)+l:l>fk(e)?(r=e+1,i=l-fk(e)):(r=e,i=l),{year:r,dayOfYear:i}}function Mk(e,t,n){var a,s,r=Ok(e.year(),t,n),i=Math.floor((e.dayOfYear()-r-1)/7)+1;return i<1?a=i+Lk(s=e.year()-1,t,n):i>Lk(e.year(),t,n)?(a=i-Lk(e.year(),t,n),s=e.year()+1):(s=e.year(),a=i),{week:a,year:s}}function Lk(e,t,n){var a=Ok(e,t,n),s=Ok(e+1,t,n);return(fk(e)-a+s)/7}k_("w",["ww",2],"wo","week"),k_("W",["WW",2],"Wo","isoWeek"),X_("w",I_,Z_),X_("ww",I_,O_),X_("W",I_,Z_),X_("WW",I_,O_),rk(["w","ww","W","WW"],function(e,t,n,a){t[a.substr(0,1)]=nk(e)});function Ik(e,t){return e.slice(t,7).concat(e.slice(0,t))}k_("d",0,"do","day"),k_("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),k_("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),k_("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),k_("e",0,0,"weekday"),k_("E",0,0,"isoWeekday"),X_("d",I_),X_("e",I_),X_("E",I_),X_("dd",function(e,t){return t.weekdaysMinRegex(e)}),X_("ddd",function(e,t){return t.weekdaysShortRegex(e)}),X_("dddd",function(e,t){return t.weekdaysRegex(e)}),rk(["dd","ddd","dddd"],function(e,t,n,a){var s=n._locale.weekdaysParse(e,a,n._strict);null!=s?t.d=s:s_(n).invalidWeekday=e}),rk(["d","e","E"],function(e,t,n,a){t[a]=nk(e)});var zk="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Bk="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Yk="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Vk=K_,qk=K_,Uk=K_;function Hk(e,t,n){var a,s,r,i=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],a=0;a<7;++a)r=a_([2e3,1]).day(a),this._minWeekdaysParse[a]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[a]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[a]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(s=vk.call(this._weekdaysParse,i))?s:null:"ddd"===t?-1!==(s=vk.call(this._shortWeekdaysParse,i))?s:null:-1!==(s=vk.call(this._minWeekdaysParse,i))?s:null:"dddd"===t?-1!==(s=vk.call(this._weekdaysParse,i))||-1!==(s=vk.call(this._shortWeekdaysParse,i))||-1!==(s=vk.call(this._minWeekdaysParse,i))?s:null:"ddd"===t?-1!==(s=vk.call(this._shortWeekdaysParse,i))||-1!==(s=vk.call(this._weekdaysParse,i))||-1!==(s=vk.call(this._minWeekdaysParse,i))?s:null:-1!==(s=vk.call(this._minWeekdaysParse,i))||-1!==(s=vk.call(this._weekdaysParse,i))||-1!==(s=vk.call(this._shortWeekdaysParse,i))?s:null}function Gk(){function e(e,t){return t.length-e.length}var t,n,a,s,r,i=[],l=[],o=[],d=[];for(t=0;t<7;t++)n=a_([2e3,1]).day(t),a=ek(this.weekdaysMin(n,"")),s=ek(this.weekdaysShort(n,"")),r=ek(this.weekdays(n,"")),i.push(a),l.push(s),o.push(r),d.push(a),d.push(s),d.push(r);i.sort(e),l.sort(e),o.sort(e),d.sort(e),this._weekdaysRegex=new RegExp("^("+d.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+i.join("|")+")","i")}function Wk(){return this.hours()%12||12}function Kk(e,t){k_(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Zk(e,t){return t._meridiemParse}k_("H",["HH",2],0,"hour"),k_("h",["hh",2],0,Wk),k_("k",["kk",2],0,function(){return this.hours()||24}),k_("hmm",0,0,function(){return""+Wk.apply(this)+b_(this.minutes(),2)}),k_("hmmss",0,0,function(){return""+Wk.apply(this)+b_(this.minutes(),2)+b_(this.seconds(),2)}),k_("Hmm",0,0,function(){return""+this.hours()+b_(this.minutes(),2)}),k_("Hmmss",0,0,function(){return""+this.hours()+b_(this.minutes(),2)+b_(this.seconds(),2)}),Kk("a",!0),Kk("A",!1),X_("a",Zk),X_("A",Zk),X_("H",I_,Q_),X_("h",I_,Z_),X_("k",I_,Z_),X_("HH",I_,O_),X_("hh",I_,O_),X_("kk",I_,O_),X_("hmm",z_),X_("hmmss",B_),X_("Hmm",z_),X_("Hmmss",B_),sk(["H","HH"],uk),sk(["k","kk"],function(e,t,n){var a=nk(e);t[uk]=24===a?0:a}),sk(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),sk(["h","hh"],function(e,t,n){t[uk]=nk(e),s_(n).bigHour=!0}),sk("hmm",function(e,t,n){var a=e.length-2;t[uk]=nk(e.substr(0,a)),t[mk]=nk(e.substr(a)),s_(n).bigHour=!0}),sk("hmmss",function(e,t,n){var a=e.length-4,s=e.length-2;t[uk]=nk(e.substr(0,a)),t[mk]=nk(e.substr(a,2)),t[pk]=nk(e.substr(s)),s_(n).bigHour=!0}),sk("Hmm",function(e,t,n){var a=e.length-2;t[uk]=nk(e.substr(0,a)),t[mk]=nk(e.substr(a))}),sk("Hmmss",function(e,t,n){var a=e.length-4,s=e.length-2;t[uk]=nk(e.substr(0,a)),t[mk]=nk(e.substr(a,2)),t[pk]=nk(e.substr(s))});var Qk=bk("Hours",!0);var Xk,Jk={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:_k,monthsShort:kk,week:{dow:0,doy:6},weekdays:zk,weekdaysMin:Yk,weekdaysShort:Bk,meridiemParse:/[ap]\.?m?\.?/i},eS={},tS={};function nS(e,t){var n,a=Math.min(e.length,t.length);for(n=0;n<a;n+=1)if(e[n]!==t[n])return n;return a}function aS(e){return e?e.toLowerCase().replace("_","-"):e}function sS(e){var t=null;if(void 0===eS[e]&&"undefined"!=typeof module&&module&&module.exports&&function(e){return!(!e||!e.match("^[^/\\\\]*$"))}(e))try{t=Xk._abbr,require("./locale/"+e),rS(t)}catch(oT){eS[e]=null}return eS[e]}function rS(e,t){var n;return e&&((n=XN(t)?lS(e):iS(e,t))?Xk=n:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),Xk._abbr}function iS(e,t){if(null!==t){var n,a=Jk;if(t.abbr=e,null!=eS[e])g_("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),a=eS[e]._config;else if(null!=t.parentLocale)if(null!=eS[t.parentLocale])a=eS[t.parentLocale]._config;else{if(null==(n=sS(t.parentLocale)))return tS[t.parentLocale]||(tS[t.parentLocale]=[]),tS[t.parentLocale].push({name:e,config:t}),null;a=n._config}return eS[e]=new y_(v_(a,t)),tS[e]&&tS[e].forEach(function(e){iS(e.name,e.config)}),rS(e),eS[e]}return delete eS[e],null}function lS(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Xk;if(!WN(e)){if(t=sS(e))return t;e=[e]}return function(e){for(var t,n,a,s,r=0;r<e.length;){for(t=(s=aS(e[r]).split("-")).length,n=(n=aS(e[r+1]))?n.split("-"):null;t>0;){if(a=sS(s.slice(0,t).join("-")))return a;if(n&&n.length>=t&&nS(s,n)>=t-1)break;t--}r++}return Xk}(e)}function oS(e){var t,n=e._a;return n&&-2===s_(e).overflow&&(t=n[dk]<0||n[dk]>11?dk:n[ck]<1||n[ck]>Nk(n[ok],n[dk])?ck:n[uk]<0||n[uk]>24||24===n[uk]&&(0!==n[mk]||0!==n[pk]||0!==n[hk])?uk:n[mk]<0||n[mk]>59?mk:n[pk]<0||n[pk]>59?pk:n[hk]<0||n[hk]>999?hk:-1,s_(e)._overflowDayOfYear&&(t<ok||t>ck)&&(t=ck),s_(e)._overflowWeeks&&-1===t&&(t=xk),s_(e)._overflowWeekday&&-1===t&&(t=gk),s_(e).overflow=t),e}var dS=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,cS=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,uS=/Z|[+-]\d\d(?::?\d\d)?/,mS=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],pS=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],hS=/^\/?Date\((-?\d+)/i,xS=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,gS={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function fS(e){var t,n,a,s,r,i,l=e._i,o=dS.exec(l)||cS.exec(l),d=mS.length,c=pS.length;if(o){for(s_(e).iso=!0,t=0,n=d;t<n;t++)if(mS[t][1].exec(o[1])){s=mS[t][0],a=!1!==mS[t][2];break}if(null==s)return void(e._isValid=!1);if(o[3]){for(t=0,n=c;t<n;t++)if(pS[t][1].exec(o[3])){r=(o[2]||" ")+pS[t][0];break}if(null==r)return void(e._isValid=!1)}if(!a&&null!=r)return void(e._isValid=!1);if(o[4]){if(!uS.exec(o[4]))return void(e._isValid=!1);i="Z"}e._f=s+(r||"")+(i||""),wS(e)}else e._isValid=!1}function vS(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}function yS(e){var t,n,a,s,r,i,l,o,d=xS.exec(e._i.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(d){if(n=d[4],a=d[3],s=d[2],r=d[5],i=d[6],l=d[7],o=[vS(n),kk.indexOf(a),parseInt(s,10),parseInt(r,10),parseInt(i,10)],l&&o.push(parseInt(l,10)),t=o,!function(e,t,n){return!e||Bk.indexOf(e)===new Date(t[0],t[1],t[2]).getDay()||(s_(n).weekdayMismatch=!0,n._isValid=!1,!1)}(d[1],t,e))return;e._a=t,e._tzm=function(e,t,n){if(e)return gS[e];if(t)return 0;var a=parseInt(n,10),s=a%100;return(a-s)/100*60+s}(d[8],d[9],d[10]),e._d=Pk.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),s_(e).rfc2822=!0}else e._isValid=!1}function bS(e,t,n){return null!=e?e:null!=t?t:n}function jS(e){var t,n,a,s,r,i=[];if(!e._d){for(a=function(e){var t=new Date(GN.now());return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}(e),e._w&&null==e._a[ck]&&null==e._a[dk]&&function(e){var t,n,a,s,r,i,l,o,d;t=e._w,null!=t.GG||null!=t.W||null!=t.E?(r=1,i=4,n=bS(t.GG,e._a[ok],Mk(kS(),1,4).year),a=bS(t.W,1),((s=bS(t.E,1))<1||s>7)&&(o=!0)):(r=e._locale._week.dow,i=e._locale._week.doy,d=Mk(kS(),r,i),n=bS(t.gg,e._a[ok],d.year),a=bS(t.w,d.week),null!=t.d?((s=t.d)<0||s>6)&&(o=!0):null!=t.e?(s=t.e+r,(t.e<0||t.e>6)&&(o=!0)):s=r);a<1||a>Lk(n,r,i)?s_(e)._overflowWeeks=!0:null!=o?s_(e)._overflowWeekday=!0:(l=Rk(n,a,s,r,i),e._a[ok]=l.year,e._dayOfYear=l.dayOfYear)}(e),null!=e._dayOfYear&&(r=bS(e._a[ok],a[ok]),(e._dayOfYear>fk(r)||0===e._dayOfYear)&&(s_(e)._overflowDayOfYear=!0),n=Pk(r,0,e._dayOfYear),e._a[dk]=n.getUTCMonth(),e._a[ck]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=i[t]=a[t];for(;t<7;t++)e._a[t]=i[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[uk]&&0===e._a[mk]&&0===e._a[pk]&&0===e._a[hk]&&(e._nextDay=!0,e._a[uk]=0),e._d=(e._useUTC?Pk:Fk).apply(null,i),s=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[uk]=24),e._w&&void 0!==e._w.d&&e._w.d!==s&&(s_(e).weekdayMismatch=!0)}}function wS(e){if(e._f!==GN.ISO_8601)if(e._f!==GN.RFC_2822){e._a=[],s_(e).empty=!0;var t,n,a,s,r,i,l,o=""+e._i,d=o.length,c=0;for(l=(a=$_(e._f,e._locale).match(j_)||[]).length,t=0;t<l;t++)s=a[t],(n=(o.match(J_(s,e))||[])[0])&&((r=o.substr(0,o.indexOf(n))).length>0&&s_(e).unusedInput.push(r),o=o.slice(o.indexOf(n)+n.length),c+=n.length),__[s]?(n?s_(e).empty=!1:s_(e).unusedTokens.push(s),ik(s,n,e)):e._strict&&!n&&s_(e).unusedTokens.push(s);s_(e).charsLeftOver=d-c,o.length>0&&s_(e).unusedInput.push(o),e._a[uk]<=12&&!0===s_(e).bigHour&&e._a[uk]>0&&(s_(e).bigHour=void 0),s_(e).parsedDateParts=e._a.slice(0),s_(e).meridiem=e._meridiem,e._a[uk]=function(e,t,n){var a;if(null==n)return t;return null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?((a=e.isPM(n))&&t<12&&(t+=12),a||12!==t||(t=0),t):t}(e._locale,e._a[uk],e._meridiem),null!==(i=s_(e).era)&&(e._a[ok]=e._locale.erasConvertYear(i,e._a[ok])),jS(e),oS(e)}else yS(e);else fS(e)}function NS(e){var t=e._i,n=e._f;return e._locale=e._locale||lS(e._l),null===t||void 0===n&&""===t?i_({nullInput:!0}):("string"==typeof t&&(e._i=t=e._locale.preparse(t)),u_(t)?new c_(oS(t)):(e_(t)?e._d=t:WN(n)?function(e){var t,n,a,s,r,i,l=!1,o=e._f.length;if(0===o)return s_(e).invalidFormat=!0,void(e._d=new Date(NaN));for(s=0;s<o;s++)r=0,i=!1,t=d_({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[s],wS(t),r_(t)&&(i=!0),r+=s_(t).charsLeftOver,r+=10*s_(t).unusedTokens.length,s_(t).score=r,l?r<a&&(a=r,n=t):(null==a||r<a||i)&&(a=r,n=t,i&&(l=!0));n_(e,n||t)}(e):n?wS(e):function(e){var t=e._i;XN(t)?e._d=new Date(GN.now()):e_(t)?e._d=new Date(t.valueOf()):"string"==typeof t?function(e){var t=hS.exec(e._i);null===t?(fS(e),!1===e._isValid&&(delete e._isValid,yS(e),!1===e._isValid&&(delete e._isValid,e._strict?e._isValid=!1:GN.createFromInputFallback(e)))):e._d=new Date(+t[1])}(e):WN(t)?(e._a=t_(t.slice(0),function(e){return parseInt(e,10)}),jS(e)):KN(t)?function(e){if(!e._d){var t=T_(e._i),n=void 0===t.day?t.date:t.day;e._a=t_([t.year,t.month,n,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),jS(e)}}(e):JN(t)?e._d=new Date(t):GN.createFromInputFallback(e)}(e),r_(e)||(e._d=null),e))}function _S(e,t,n,a,s){var r,i={};return!0!==t&&!1!==t||(a=t,t=void 0),!0!==n&&!1!==n||(a=n,n=void 0),(KN(e)&&QN(e)||WN(e)&&0===e.length)&&(e=void 0),i._isAMomentObject=!0,i._useUTC=i._isUTC=s,i._l=n,i._i=e,i._f=t,i._strict=a,(r=new c_(oS(NS(i))))._nextDay&&(r.add(1,"d"),r._nextDay=void 0),r}function kS(e,t,n,a){return _S(e,t,n,a,!1)}GN.createFromInputFallback=p_("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),GN.ISO_8601=function(){},GN.RFC_2822=function(){};var SS=p_("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=kS.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:i_()}),DS=p_("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=kS.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:i_()});function $S(e,t){var n,a;if(1===t.length&&WN(t[0])&&(t=t[0]),!t.length)return kS();for(n=t[0],a=1;a<t.length;++a)t[a].isValid()&&!t[a][e](n)||(n=t[a]);return n}var CS=["year","quarter","month","week","day","hour","minute","second","millisecond"];function ES(e){var t=T_(e),n=t.year||0,a=t.quarter||0,s=t.month||0,r=t.week||t.isoWeek||0,i=t.day||0,l=t.hour||0,o=t.minute||0,d=t.second||0,c=t.millisecond||0;this._isValid=function(e){var t,n,a=!1,s=CS.length;for(t in e)if(ZN(e,t)&&(-1===vk.call(CS,t)||null!=e[t]&&isNaN(e[t])))return!1;for(n=0;n<s;++n)if(e[CS[n]]){if(a)return!1;parseFloat(e[CS[n]])!==nk(e[CS[n]])&&(a=!0)}return!0}(t),this._milliseconds=+c+1e3*d+6e4*o+1e3*l*60*60,this._days=+i+7*r,this._months=+s+3*a+12*n,this._data={},this._locale=lS(),this._bubble()}function TS(e){return e instanceof ES}function AS(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function FS(e,t){k_(e,0,0,function(){var e=this.utcOffset(),n="+";return e<0&&(e=-e,n="-"),n+b_(~~(e/60),2)+t+b_(~~e%60,2)})}FS("Z",":"),FS("ZZ",""),X_("Z",W_),X_("ZZ",W_),sk(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=OS(W_,e)});var PS=/([\+\-]|\d\d)/gi;function OS(e,t){var n,a,s=(t||"").match(e);return null===s?null:0===(a=60*(n=((s[s.length-1]||[])+"").match(PS)||["-",0,0])[1]+nk(n[2]))?0:"+"===n[0]?a:-a}function RS(e,t){var n,a;return t._isUTC?(n=t.clone(),a=(u_(e)||e_(e)?e.valueOf():kS(e).valueOf())-n.valueOf(),n._d.setTime(n._d.valueOf()+a),GN.updateOffset(n,!1),n):kS(e).local()}function MS(e){return-Math.round(e._d.getTimezoneOffset())}function LS(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}GN.updateOffset=function(){};var IS=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,zS=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function BS(e,t){var n,a,s,r=e,i=null;return TS(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:JN(e)||!isNaN(+e)?(r={},t?r[t]=+e:r.milliseconds=+e):(i=IS.exec(e))?(n="-"===i[1]?-1:1,r={y:0,d:nk(i[ck])*n,h:nk(i[uk])*n,m:nk(i[mk])*n,s:nk(i[pk])*n,ms:nk(AS(1e3*i[hk]))*n}):(i=zS.exec(e))?(n="-"===i[1]?-1:1,r={y:YS(i[2],n),M:YS(i[3],n),w:YS(i[4],n),d:YS(i[5],n),h:YS(i[6],n),m:YS(i[7],n),s:YS(i[8],n)}):null==r?r={}:"object"==typeof r&&("from"in r||"to"in r)&&(s=function(e,t){var n;if(!e.isValid()||!t.isValid())return{milliseconds:0,months:0};t=RS(t,e),e.isBefore(t)?n=VS(e,t):((n=VS(t,e)).milliseconds=-n.milliseconds,n.months=-n.months);return n}(kS(r.from),kS(r.to)),(r={}).ms=s.milliseconds,r.M=s.months),a=new ES(r),TS(e)&&ZN(e,"_locale")&&(a._locale=e._locale),TS(e)&&ZN(e,"_isValid")&&(a._isValid=e._isValid),a}function YS(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function VS(e,t){var n={};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function qS(e,t){return function(n,a){var s;return null===a||isNaN(+a)||(g_(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),s=n,n=a,a=s),US(this,BS(n,a),e),this}}function US(e,t,n,a){var s=t._milliseconds,r=AS(t._days),i=AS(t._months);e.isValid()&&(a=null==a||a,i&&Ek(e,jk(e,"Month")+i*n),r&&wk(e,"Date",jk(e,"Date")+r*n),s&&e._d.setTime(e._d.valueOf()+s*n),a&&GN.updateOffset(e,r||i))}BS.fn=ES.prototype,BS.invalid=function(){return BS(NaN)};var HS=qS(1,"add"),GS=qS(-1,"subtract");function WS(e){return"string"==typeof e||e instanceof String}function KS(e){return u_(e)||e_(e)||WS(e)||JN(e)||function(e){var t=WN(e),n=!1;t&&(n=0===e.filter(function(t){return!JN(t)&&WS(e)}).length);return t&&n}(e)||function(e){var t,n,a=KN(e)&&!QN(e),s=!1,r=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],i=r.length;for(t=0;t<i;t+=1)n=r[t],s=s||ZN(e,n);return a&&s}(e)||null==e}function ZS(e,t){if(e.date()<t.date())return-ZS(t,e);var n=12*(t.year()-e.year())+(t.month()-e.month()),a=e.clone().add(n,"months");return-(n+(t-a<0?(t-a)/(a-e.clone().add(n-1,"months")):(t-a)/(e.clone().add(n+1,"months")-a)))||0}function QS(e){var t;return void 0===e?this._locale._abbr:(null!=(t=lS(e))&&(this._locale=t),this)}GN.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",GN.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var XS=p_("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function JS(){return this._locale}var eD=1e3,tD=6e4,nD=36e5,aD=126227808e5;function sD(e,t){return(e%t+t)%t}function rD(e,t,n){return e<100&&e>=0?new Date(e+400,t,n)-aD:new Date(e,t,n).valueOf()}function iD(e,t,n){return e<100&&e>=0?Date.UTC(e+400,t,n)-aD:Date.UTC(e,t,n)}function lD(e,t){return t.erasAbbrRegex(e)}function oD(){var e,t,n,a,s,r=[],i=[],l=[],o=[],d=this.eras();for(e=0,t=d.length;e<t;++e)n=ek(d[e].name),a=ek(d[e].abbr),s=ek(d[e].narrow),i.push(n),r.push(a),l.push(s),o.push(n),o.push(a),o.push(s);this._erasRegex=new RegExp("^("+o.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+i.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+r.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+l.join("|")+")","i")}function dD(e,t){k_(0,[e,e.length],0,t)}function cD(e,t,n,a,s){var r;return null==e?Mk(this,a,s).year:(t>(r=Lk(e,a,s))&&(t=r),uD.call(this,e,t,n,a,s))}function uD(e,t,n,a,s){var r=Rk(e,t,n,a,s),i=Pk(r.year,0,r.dayOfYear);return this.year(i.getUTCFullYear()),this.month(i.getUTCMonth()),this.date(i.getUTCDate()),this}k_("N",0,0,"eraAbbr"),k_("NN",0,0,"eraAbbr"),k_("NNN",0,0,"eraAbbr"),k_("NNNN",0,0,"eraName"),k_("NNNNN",0,0,"eraNarrow"),k_("y",["y",1],"yo","eraYear"),k_("y",["yy",2],0,"eraYear"),k_("y",["yyy",3],0,"eraYear"),k_("y",["yyyy",4],0,"eraYear"),X_("N",lD),X_("NN",lD),X_("NNN",lD),X_("NNNN",function(e,t){return t.erasNameRegex(e)}),X_("NNNNN",function(e,t){return t.erasNarrowRegex(e)}),sk(["N","NN","NNN","NNNN","NNNNN"],function(e,t,n,a){var s=n._locale.erasParse(e,a,n._strict);s?s_(n).era=s:s_(n).invalidEra=e}),X_("y",U_),X_("yy",U_),X_("yyy",U_),X_("yyyy",U_),X_("yo",function(e,t){return t._eraYearOrdinalRegex||U_}),sk(["y","yy","yyy","yyyy"],ok),sk(["yo"],function(e,t,n,a){var s;n._locale._eraYearOrdinalRegex&&(s=e.match(n._locale._eraYearOrdinalRegex)),n._locale.eraYearOrdinalParse?t[ok]=n._locale.eraYearOrdinalParse(e,s):t[ok]=parseInt(e,10)}),k_(0,["gg",2],0,function(){return this.weekYear()%100}),k_(0,["GG",2],0,function(){return this.isoWeekYear()%100}),dD("gggg","weekYear"),dD("ggggg","weekYear"),dD("GGGG","isoWeekYear"),dD("GGGGG","isoWeekYear"),X_("G",H_),X_("g",H_),X_("GG",I_,O_),X_("gg",I_,O_),X_("GGGG",V_,M_),X_("gggg",V_,M_),X_("GGGGG",q_,L_),X_("ggggg",q_,L_),rk(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,a){t[a.substr(0,2)]=nk(e)}),rk(["gg","GG"],function(e,t,n,a){t[a]=GN.parseTwoDigitYear(e)}),k_("Q",0,"Qo","quarter"),X_("Q",P_),sk("Q",function(e,t){t[dk]=3*(nk(e)-1)}),k_("D",["DD",2],"Do","date"),X_("D",I_,Z_),X_("DD",I_,O_),X_("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),sk(["D","DD"],ck),sk("Do",function(e,t){t[ck]=nk(e.match(I_)[0])});var mD=bk("Date",!0);k_("DDD",["DDDD",3],"DDDo","dayOfYear"),X_("DDD",Y_),X_("DDDD",R_),sk(["DDD","DDDD"],function(e,t,n){n._dayOfYear=nk(e)}),k_("m",["mm",2],0,"minute"),X_("m",I_,Q_),X_("mm",I_,O_),sk(["m","mm"],mk);var pD=bk("Minutes",!1);k_("s",["ss",2],0,"second"),X_("s",I_,Q_),X_("ss",I_,O_),sk(["s","ss"],pk);var hD,xD,gD=bk("Seconds",!1);for(k_("S",0,0,function(){return~~(this.millisecond()/100)}),k_(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),k_(0,["SSS",3],0,"millisecond"),k_(0,["SSSS",4],0,function(){return 10*this.millisecond()}),k_(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),k_(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),k_(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),k_(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),k_(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),X_("S",Y_,P_),X_("SS",Y_,O_),X_("SSS",Y_,R_),hD="SSSS";hD.length<=9;hD+="S")X_(hD,U_);function fD(e,t){t[hk]=nk(1e3*("0."+e))}for(hD="S";hD.length<=9;hD+="S")sk(hD,fD);xD=bk("Milliseconds",!1),k_("z",0,0,"zoneAbbr"),k_("zz",0,0,"zoneName");var vD=c_.prototype;function yD(e){return e}vD.add=HS,vD.calendar=function(e,t){1===arguments.length&&(arguments[0]?KS(arguments[0])?(e=arguments[0],t=void 0):function(e){var t,n=KN(e)&&!QN(e),a=!1,s=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"];for(t=0;t<s.length;t+=1)a=a||ZN(e,s[t]);return n&&a}(arguments[0])&&(t=arguments[0],e=void 0):(e=void 0,t=void 0));var n=e||kS(),a=RS(n,this).startOf("day"),s=GN.calendarFormat(this,a)||"sameElse",r=t&&(f_(t[s])?t[s].call(this,n):t[s]);return this.format(r||this.localeData().calendar(s,this,kS(n)))},vD.clone=function(){return new c_(this)},vD.diff=function(e,t,n){var a,s,r;if(!this.isValid())return NaN;if(!(a=RS(e,this)).isValid())return NaN;switch(s=6e4*(a.utcOffset()-this.utcOffset()),t=E_(t)){case"year":r=ZS(this,a)/12;break;case"month":r=ZS(this,a);break;case"quarter":r=ZS(this,a)/3;break;case"second":r=(this-a)/1e3;break;case"minute":r=(this-a)/6e4;break;case"hour":r=(this-a)/36e5;break;case"day":r=(this-a-s)/864e5;break;case"week":r=(this-a-s)/6048e5;break;default:r=this-a}return n?r:tk(r)},vD.endOf=function(e){var t,n;if(void 0===(e=E_(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?iD:rD,e){case"year":t=n(this.year()+1,0,1)-1;break;case"quarter":t=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=n(this.year(),this.month()+1,1)-1;break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=n(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=nD-sD(t+(this._isUTC?0:this.utcOffset()*tD),nD)-1;break;case"minute":t=this._d.valueOf(),t+=tD-sD(t,tD)-1;break;case"second":t=this._d.valueOf(),t+=eD-sD(t,eD)-1}return this._d.setTime(t),GN.updateOffset(this,!0),this},vD.format=function(e){e||(e=this.isUtc()?GN.defaultFormatUtc:GN.defaultFormat);var t=D_(this,e);return this.localeData().postformat(t)},vD.from=function(e,t){return this.isValid()&&(u_(e)&&e.isValid()||kS(e).isValid())?BS({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},vD.fromNow=function(e){return this.from(kS(),e)},vD.to=function(e,t){return this.isValid()&&(u_(e)&&e.isValid()||kS(e).isValid())?BS({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},vD.toNow=function(e){return this.to(kS(),e)},vD.get=function(e){return f_(this[e=E_(e)])?this[e]():this},vD.invalidAt=function(){return s_(this).overflow},vD.isAfter=function(e,t){var n=u_(e)?e:kS(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=E_(t)||"millisecond")?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},vD.isBefore=function(e,t){var n=u_(e)?e:kS(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=E_(t)||"millisecond")?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},vD.isBetween=function(e,t,n,a){var s=u_(e)?e:kS(e),r=u_(t)?t:kS(t);return!!(this.isValid()&&s.isValid()&&r.isValid())&&(("("===(a=a||"()")[0]?this.isAfter(s,n):!this.isBefore(s,n))&&(")"===a[1]?this.isBefore(r,n):!this.isAfter(r,n)))},vD.isSame=function(e,t){var n,a=u_(e)?e:kS(e);return!(!this.isValid()||!a.isValid())&&("millisecond"===(t=E_(t)||"millisecond")?this.valueOf()===a.valueOf():(n=a.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},vD.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},vD.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},vD.isValid=function(){return r_(this)},vD.lang=XS,vD.locale=QS,vD.localeData=JS,vD.max=DS,vD.min=SS,vD.parsingFlags=function(){return n_({},s_(this))},vD.set=function(e,t){if("object"==typeof e){var n,a=function(e){var t,n=[];for(t in e)ZN(e,t)&&n.push({unit:t,priority:A_[t]});return n.sort(function(e,t){return e.priority-t.priority}),n}(e=T_(e)),s=a.length;for(n=0;n<s;n++)this[a[n].unit](e[a[n].unit])}else if(f_(this[e=E_(e)]))return this[e](t);return this},vD.startOf=function(e){var t,n;if(void 0===(e=E_(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?iD:rD,e){case"year":t=n(this.year(),0,1);break;case"quarter":t=n(this.year(),this.month()-this.month()%3,1);break;case"month":t=n(this.year(),this.month(),1);break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=n(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=sD(t+(this._isUTC?0:this.utcOffset()*tD),nD);break;case"minute":t=this._d.valueOf(),t-=sD(t,tD);break;case"second":t=this._d.valueOf(),t-=sD(t,eD)}return this._d.setTime(t),GN.updateOffset(this,!0),this},vD.subtract=GS,vD.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},vD.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},vD.toDate=function(){return new Date(this.valueOf())},vD.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||n.year()>9999?D_(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):f_(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",D_(n,"Z")):D_(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},vD.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e,t,n,a="moment",s="";return this.isLocal()||(a=0===this.utcOffset()?"moment.utc":"moment.parseZone",s="Z"),e="["+a+'("]',t=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",n=s+'[")]',this.format(e+t+"-MM-DD[T]HH:mm:ss.SSS"+n)},"undefined"!=typeof Symbol&&null!=Symbol.for&&(vD[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),vD.toJSON=function(){return this.isValid()?this.toISOString():null},vD.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},vD.unix=function(){return Math.floor(this.valueOf()/1e3)},vD.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},vD.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},vD.eraName=function(){var e,t,n,a=this.localeData().eras();for(e=0,t=a.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),a[e].since<=n&&n<=a[e].until)return a[e].name;if(a[e].until<=n&&n<=a[e].since)return a[e].name}return""},vD.eraNarrow=function(){var e,t,n,a=this.localeData().eras();for(e=0,t=a.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),a[e].since<=n&&n<=a[e].until)return a[e].narrow;if(a[e].until<=n&&n<=a[e].since)return a[e].narrow}return""},vD.eraAbbr=function(){var e,t,n,a=this.localeData().eras();for(e=0,t=a.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),a[e].since<=n&&n<=a[e].until)return a[e].abbr;if(a[e].until<=n&&n<=a[e].since)return a[e].abbr}return""},vD.eraYear=function(){var e,t,n,a,s=this.localeData().eras();for(e=0,t=s.length;e<t;++e)if(n=s[e].since<=s[e].until?1:-1,a=this.clone().startOf("day").valueOf(),s[e].since<=a&&a<=s[e].until||s[e].until<=a&&a<=s[e].since)return(this.year()-GN(s[e].since).year())*n+s[e].offset;return this.year()},vD.year=yk,vD.isLeapYear=function(){return lk(this.year())},vD.weekYear=function(e){return cD.call(this,e,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)},vD.isoWeekYear=function(e){return cD.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},vD.quarter=vD.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},vD.month=Tk,vD.daysInMonth=function(){return Nk(this.year(),this.month())},vD.week=vD.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},vD.isoWeek=vD.isoWeeks=function(e){var t=Mk(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},vD.weeksInYear=function(){var e=this.localeData()._week;return Lk(this.year(),e.dow,e.doy)},vD.weeksInWeekYear=function(){var e=this.localeData()._week;return Lk(this.weekYear(),e.dow,e.doy)},vD.isoWeeksInYear=function(){return Lk(this.year(),1,4)},vD.isoWeeksInISOWeekYear=function(){return Lk(this.isoWeekYear(),1,4)},vD.date=mD,vD.day=vD.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t=jk(this,"Day");return null!=e?(e=function(e,t){return"string"!=typeof e?e:isNaN(e)?"number"==typeof(e=t.weekdaysParse(e))?e:null:parseInt(e,10)}(e,this.localeData()),this.add(e-t,"d")):t},vD.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},vD.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=function(e,t){return"string"==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7},vD.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},vD.hour=vD.hours=Qk,vD.minute=vD.minutes=pD,vD.second=vD.seconds=gD,vD.millisecond=vD.milliseconds=xD,vD.utcOffset=function(e,t,n){var a,s=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=OS(W_,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(a=MS(this)),this._offset=e,this._isUTC=!0,null!=a&&this.add(a,"m"),s!==e&&(!t||this._changeInProgress?US(this,BS(e-s,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,GN.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?s:MS(this)},vD.utc=function(e){return this.utcOffset(0,e)},vD.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(MS(this),"m")),this},vD.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=OS(G_,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},vD.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?kS(e).utcOffset():0,(this.utcOffset()-e)%60==0)},vD.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},vD.isLocal=function(){return!!this.isValid()&&!this._isUTC},vD.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},vD.isUtc=LS,vD.isUTC=LS,vD.zoneAbbr=function(){return this._isUTC?"UTC":""},vD.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},vD.dates=p_("dates accessor is deprecated. Use date instead.",mD),vD.months=p_("months accessor is deprecated. Use month instead",Tk),vD.years=p_("years accessor is deprecated. Use year instead",yk),vD.zone=p_("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),vD.isDSTShifted=p_("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!XN(this._isDSTShifted))return this._isDSTShifted;var e,t={};return d_(t,this),(t=NS(t))._a?(e=t._isUTC?a_(t._a):kS(t._a),this._isDSTShifted=this.isValid()&&function(e,t,n){var a,s=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0;for(a=0;a<s;a++)(n&&e[a]!==t[a]||!n&&nk(e[a])!==nk(t[a]))&&i++;return i+r}(t._a,e.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted});var bD=y_.prototype;function jD(e,t,n,a){var s=lS(),r=a_().set(a,t);return s[n](r,e)}function wD(e,t,n){if(JN(e)&&(t=e,e=void 0),e=e||"",null!=t)return jD(e,t,n,"month");var a,s=[];for(a=0;a<12;a++)s[a]=jD(e,a,n,"month");return s}function ND(e,t,n,a){"boolean"==typeof e?(JN(t)&&(n=t,t=void 0),t=t||""):(n=t=e,e=!1,JN(t)&&(n=t,t=void 0),t=t||"");var s,r=lS(),i=e?r._week.dow:0,l=[];if(null!=n)return jD(t,(n+i)%7,a,"day");for(s=0;s<7;s++)l[s]=jD(t,(s+i)%7,a,"day");return l}bD.calendar=function(e,t,n){var a=this._calendar[e]||this._calendar.sameElse;return f_(a)?a.call(t,n):a},bD.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.match(j_).map(function(e){return"MMMM"===e||"MM"===e||"DD"===e||"dddd"===e?e.slice(1):e}).join(""),this._longDateFormat[e])},bD.invalidDate=function(){return this._invalidDate},bD.ordinal=function(e){return this._ordinal.replace("%d",e)},bD.preparse=yD,bD.postformat=yD,bD.relativeTime=function(e,t,n,a){var s=this._relativeTime[n];return f_(s)?s(e,t,n,a):s.replace(/%d/i,e)},bD.pastFuture=function(e,t){var n=this._relativeTime[e>0?"future":"past"];return f_(n)?n(t):n.replace(/%s/i,t)},bD.set=function(e){var t,n;for(n in e)ZN(e,n)&&(f_(t=e[n])?this[n]=t:this["_"+n]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},bD.eras=function(e,t){var n,a,s,r=this._eras||lS("en")._eras;for(n=0,a=r.length;n<a;++n){if("string"==typeof r[n].since)s=GN(r[n].since).startOf("day"),r[n].since=s.valueOf();switch(typeof r[n].until){case"undefined":r[n].until=1/0;break;case"string":s=GN(r[n].until).startOf("day").valueOf(),r[n].until=s.valueOf()}}return r},bD.erasParse=function(e,t,n){var a,s,r,i,l,o=this.eras();for(e=e.toUpperCase(),a=0,s=o.length;a<s;++a)if(r=o[a].name.toUpperCase(),i=o[a].abbr.toUpperCase(),l=o[a].narrow.toUpperCase(),n)switch(t){case"N":case"NN":case"NNN":if(i===e)return o[a];break;case"NNNN":if(r===e)return o[a];break;case"NNNNN":if(l===e)return o[a]}else if([r,i,l].indexOf(e)>=0)return o[a]},bD.erasConvertYear=function(e,t){var n=e.since<=e.until?1:-1;return void 0===t?GN(e.since).year():GN(e.since).year()+(t-e.offset)*n},bD.erasAbbrRegex=function(e){return ZN(this,"_erasAbbrRegex")||oD.call(this),e?this._erasAbbrRegex:this._erasRegex},bD.erasNameRegex=function(e){return ZN(this,"_erasNameRegex")||oD.call(this),e?this._erasNameRegex:this._erasRegex},bD.erasNarrowRegex=function(e){return ZN(this,"_erasNarrowRegex")||oD.call(this),e?this._erasNarrowRegex:this._erasRegex},bD.months=function(e,t){return e?WN(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Sk).test(t)?"format":"standalone"][e.month()]:WN(this._months)?this._months:this._months.standalone},bD.monthsShort=function(e,t){return e?WN(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Sk.test(t)?"format":"standalone"][e.month()]:WN(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},bD.monthsParse=function(e,t,n){var a,s,r;if(this._monthsParseExact)return Ck.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),a=0;a<12;a++){if(s=a_([2e3,a]),n&&!this._longMonthsParse[a]&&(this._longMonthsParse[a]=new RegExp("^"+this.months(s,"").replace(".","")+"$","i"),this._shortMonthsParse[a]=new RegExp("^"+this.monthsShort(s,"").replace(".","")+"$","i")),n||this._monthsParse[a]||(r="^"+this.months(s,"")+"|^"+this.monthsShort(s,""),this._monthsParse[a]=new RegExp(r.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[a].test(e))return a;if(n&&"MMM"===t&&this._shortMonthsParse[a].test(e))return a;if(!n&&this._monthsParse[a].test(e))return a}},bD.monthsRegex=function(e){return this._monthsParseExact?(ZN(this,"_monthsRegex")||Ak.call(this),e?this._monthsStrictRegex:this._monthsRegex):(ZN(this,"_monthsRegex")||(this._monthsRegex=$k),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},bD.monthsShortRegex=function(e){return this._monthsParseExact?(ZN(this,"_monthsRegex")||Ak.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(ZN(this,"_monthsShortRegex")||(this._monthsShortRegex=Dk),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},bD.week=function(e){return Mk(e,this._week.dow,this._week.doy).week},bD.firstDayOfYear=function(){return this._week.doy},bD.firstDayOfWeek=function(){return this._week.dow},bD.weekdays=function(e,t){var n=WN(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(t)?"format":"standalone"];return!0===e?Ik(n,this._week.dow):e?n[e.day()]:n},bD.weekdaysMin=function(e){return!0===e?Ik(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},bD.weekdaysShort=function(e){return!0===e?Ik(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},bD.weekdaysParse=function(e,t,n){var a,s,r;if(this._weekdaysParseExact)return Hk.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),a=0;a<7;a++){if(s=a_([2e3,1]).day(a),n&&!this._fullWeekdaysParse[a]&&(this._fullWeekdaysParse[a]=new RegExp("^"+this.weekdays(s,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[a]=new RegExp("^"+this.weekdaysShort(s,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[a]=new RegExp("^"+this.weekdaysMin(s,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[a]||(r="^"+this.weekdays(s,"")+"|^"+this.weekdaysShort(s,"")+"|^"+this.weekdaysMin(s,""),this._weekdaysParse[a]=new RegExp(r.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[a].test(e))return a;if(n&&"ddd"===t&&this._shortWeekdaysParse[a].test(e))return a;if(n&&"dd"===t&&this._minWeekdaysParse[a].test(e))return a;if(!n&&this._weekdaysParse[a].test(e))return a}},bD.weekdaysRegex=function(e){return this._weekdaysParseExact?(ZN(this,"_weekdaysRegex")||Gk.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(ZN(this,"_weekdaysRegex")||(this._weekdaysRegex=Vk),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},bD.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(ZN(this,"_weekdaysRegex")||Gk.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(ZN(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=qk),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},bD.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(ZN(this,"_weekdaysRegex")||Gk.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(ZN(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Uk),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},bD.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},bD.meridiem=function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},rS("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===nk(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),GN.lang=p_("moment.lang is deprecated. Use moment.locale instead.",rS),GN.langData=p_("moment.langData is deprecated. Use moment.localeData instead.",lS);var _D=Math.abs;function kD(e,t,n,a){var s=BS(t,n);return e._milliseconds+=a*s._milliseconds,e._days+=a*s._days,e._months+=a*s._months,e._bubble()}function SD(e){return e<0?Math.floor(e):Math.ceil(e)}function DD(e){return 4800*e/146097}function $D(e){return 146097*e/4800}function CD(e){return function(){return this.as(e)}}var ED=CD("ms"),TD=CD("s"),AD=CD("m"),FD=CD("h"),PD=CD("d"),OD=CD("w"),RD=CD("M"),MD=CD("Q"),LD=CD("y"),ID=ED;function zD(e){return function(){return this.isValid()?this._data[e]:NaN}}var BD=zD("milliseconds"),YD=zD("seconds"),VD=zD("minutes"),qD=zD("hours"),UD=zD("days"),HD=zD("months"),GD=zD("years");var WD=Math.round,KD={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function ZD(e,t,n,a,s){return s.relativeTime(t||1,!!n,e,a)}var QD=Math.abs;function XD(e){return(e>0)-(e<0)||+e}function JD(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n,a,s,r,i,l,o=QD(this._milliseconds)/1e3,d=QD(this._days),c=QD(this._months),u=this.asSeconds();return u?(e=tk(o/60),t=tk(e/60),o%=60,e%=60,n=tk(c/12),c%=12,a=o?o.toFixed(3).replace(/\.?0+$/,""):"",s=u<0?"-":"",r=XD(this._months)!==XD(u)?"-":"",i=XD(this._days)!==XD(u)?"-":"",l=XD(this._milliseconds)!==XD(u)?"-":"",s+"P"+(n?r+n+"Y":"")+(c?r+c+"M":"")+(d?i+d+"D":"")+(t||e||o?"T":"")+(t?l+t+"H":"")+(e?l+e+"M":"")+(o?l+a+"S":"")):"P0D"}var e$=ES.prototype;function t$({appointments:e,patients:t,isLoading:n,onEdit:a,onDelete:s,onViewPatient:r,onSelectAppointment:i}){yl();const[l,c]=ve.useState("start_time"),[u,m]=ve.useState("desc"),[h,x]=ve.useState(1),[g,f]=ve.useState(10),[v,y]=ve.useState(""),[b,j]=ve.useState("all"),w=ve.useMemo(()=>{const e=new Map;return t.forEach(t=>{e.set(t.id,t)}),e},[t]),N=ve.useMemo(()=>{console.log("📋 AppointmentTable: Processing appointments:",e.length),e.length>0&&console.log("📋 AppointmentTable: First appointment sample:",e[0]);let t=e.map(e=>{var t,n;const a=d(o({},e),{patient:e.patient||w.get(e.patient_id),patient_name:e.patient_name||(null==(t=e.patient)?void 0:t.full_name)||(null==(n=w.get(e.patient_id))?void 0:n.full_name)||"مريض غير معروف"});return"مريض غير معروف"===e.patient_name&&console.log("⚠️ AppointmentTable: Unknown patient for appointment:",{id:e.id,patient_id:e.patient_id,patient_name:e.patient_name,patient:e.patient,patientFromMap:w.get(e.patient_id)}),a});if(v.trim()){const e=v.toLowerCase();t=t.filter(t=>{var n;return t.patient_name.toLowerCase().includes(e)||t.title.toLowerCase().includes(e)||(null==(n=t.description)?void 0:n.toLowerCase().includes(e))})}return"all"!==b&&(t=t.filter(e=>e.status===b)),t},[e,w,v,b]),_=ve.useMemo(()=>[...N].sort((e,t)=>{let n,a;switch(l){case"patient_name":n=e.patient_name.toLowerCase(),a=t.patient_name.toLowerCase();break;case"start_time":n=new Date(e.start_time),a=new Date(t.start_time);break;case"end_time":n=new Date(e.end_time),a=new Date(t.end_time);break;case"status":n=e.status,a=t.status;break;case"title":n=e.title.toLowerCase(),a=t.title.toLowerCase();break;default:return 0}return n<a?"asc"===u?-1:1:n>a?"asc"===u?1:-1:0}),[N,l,u]),k=_.length,S=Math.ceil(k/g),D=(h-1)*g,$=_.slice(D,D+g),C=e=>{x(e)};ye.useEffect(()=>{x(1)},[v,b]);const E=({field:e,children:t,className:n})=>p.jsx(tc,{className:`cursor-pointer hover:bg-muted/50 select-none text-center ${n||""}`,onClick:()=>(e=>{l===e?m("asc"===u?"desc":"asc"):(c(e),m("asc"))})(e),children:p.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[t,l===e?"asc"===u?p.jsx(or,{className:"w-4 h-4"}):p.jsx(rr,{className:"w-4 h-4"}):p.jsx(lr,{className:"w-4 h-4 opacity-50"})]})}),T=e=>{switch(e){case"scheduled":return"مجدول";case"completed":return"مكتمل";case"cancelled":return"ملغي";case"no_show":return"لم يحضر";default:return e}};return n?p.jsx("div",{className:"border rounded-lg",dir:"rtl",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{className:"bg-muted/50",children:[p.jsx(tc,{className:"text-center",children:"#"}),p.jsx(tc,{className:"text-center",children:"اسم المريض"}),p.jsx(tc,{className:"text-center",children:"تاريخ ووقت البداية"}),p.jsx(tc,{className:"text-center",children:"تاريخ ووقت النهاية"}),p.jsx(tc,{className:"text-center",children:"حالة الموعد"}),p.jsx(tc,{className:"text-center",children:"الاجراءات"})]})}),p.jsx(Jd,{children:p.jsx(ec,{children:p.jsx(nc,{colSpan:6,className:"text-center py-8",children:p.jsxs("div",{className:"flex flex-col items-center gap-2",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),p.jsx("p",{className:"text-muted-foreground arabic-enhanced",children:"جاري تحميل المواعيد..."})]})})})})]})}):0===e.length?p.jsx("div",{className:"border rounded-lg",dir:"rtl",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{className:"bg-muted/50",children:[p.jsx(tc,{className:"text-center",children:"#"}),p.jsx(tc,{className:"text-center",children:"اسم المريض"}),p.jsx(tc,{className:"text-center",children:"تاريخ ووقت البداية"}),p.jsx(tc,{className:"text-center",children:"تاريخ ووقت النهاية"}),p.jsx(tc,{className:"text-center",children:"حالة الموعد"}),p.jsx(tc,{className:"text-center",children:"الاجراءات"})]})}),p.jsx(Jd,{children:p.jsx(ec,{children:p.jsx(nc,{colSpan:6,className:"text-center py-8",children:p.jsxs("div",{className:"flex flex-col items-center gap-2",children:[p.jsx(hr,{className:"w-12 h-12 text-muted-foreground opacity-50"}),p.jsx("p",{className:"text-muted-foreground arabic-enhanced",children:"لا توجد مواعيد"})]})})})})]})}):p.jsxs("div",{className:"space-y-4",dir:"rtl",children:[p.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[p.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-1",children:[p.jsxs("div",{className:"relative flex-1 max-w-sm",children:[p.jsx(hi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{placeholder:"البحث في المواعيد...",value:v,onChange:e=>y(e.target.value),className:"pl-10 arabic-enhanced text-right"})]}),p.jsxs(el,{value:b,onValueChange:j,children:[p.jsxs(al,{className:"w-[180px]",children:[p.jsx(Or,{className:"w-4 h-4 mr-2"}),p.jsx(nl,{placeholder:"تصفية حسب الحالة"})]}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الحالات"}),p.jsx(dl,{value:"scheduled",children:"مجدول"}),p.jsx(dl,{value:"completed",children:"مكتمل"}),p.jsx(dl,{value:"cancelled",children:"ملغي"}),p.jsx(dl,{value:"no_show",children:"لم يحضر"})]})]})]}),p.jsxs("div",{className:"text-sm text-muted-foreground arabic-enhanced",children:["إجمالي المواعيد: ",N.length]})]}),p.jsx("div",{className:"border rounded-lg overflow-hidden",children:p.jsx("div",{className:"overflow-x-auto",children:p.jsxs(Qd,{className:"table-center-all w-full",children:[p.jsx(Xd,{children:p.jsxs(ec,{className:"bg-muted/50",children:[p.jsx(tc,{className:"text-center min-w-[80px]",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"#"})}),p.jsx(E,{field:"patient_name",className:"min-w-[180px]",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"اسم المريض"})}),p.jsx(E,{field:"start_time",className:"min-w-[140px]",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"تاريخ ووقت البداية"})}),p.jsx(E,{field:"end_time",className:"min-w-[140px]",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"تاريخ ووقت النهاية"})}),p.jsx(E,{field:"status",className:"min-w-[100px]",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"حالة الموعد"})}),p.jsx(tc,{className:"text-center min-w-[200px]",children:p.jsx("span",{className:"arabic-enhanced font-medium",children:"الاجراءات"})})]})}),p.jsx(Jd,{children:$.map((e,t)=>p.jsxs(ec,{className:"hover:bg-muted/50 cursor-pointer",onClick:()=>null==i?void 0:i(e),children:[p.jsx(nc,{className:"font-medium text-center",children:D+t+1}),p.jsx(nc,{className:"font-medium text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium flex-shrink-0",children:e.patient_name.charAt(0)}),p.jsx("span",{className:"arabic-enhanced",title:e.patient_name,children:e.patient_name})]})}),p.jsx(nc,{className:"text-center",children:p.jsx("div",{className:"text-sm font-medium arabic-enhanced",children:pa(e.start_time)})}),p.jsx(nc,{className:"text-center",children:p.jsx("div",{className:"text-sm font-medium arabic-enhanced",children:pa(e.end_time)})}),p.jsx(nc,{className:"text-center",children:p.jsx(qo,{variant:"outline",className:`${fa(e.status)} arabic-enhanced text-xs whitespace-nowrap`,children:T(e.status)})}),p.jsx(nc,{className:"text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-1 flex-wrap",children:[p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:t=>{t.preventDefault(),t.stopPropagation(),a(e)},children:[p.jsx(si,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:t=>{t.preventDefault(),t.stopPropagation(),s(e.id)},children:[p.jsx(Ni,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]}),(e.patient||w.get(e.patient_id))&&p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-view",onClick:t=>{t.preventDefault(),t.stopPropagation();const n=e.patient||w.get(e.patient_id);n&&r(n)},children:[p.jsx(Fr,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"عرض المريض"})]})]})})]},e.id))})]})})}),k>0&&p.jsxs("div",{className:"flex items-center justify-between px-2",children:[p.jsx("div",{className:"flex items-center gap-2",children:p.jsxs("p",{className:"text-sm text-muted-foreground arabic-enhanced",children:["عرض ",(h-1)*g+1," إلى ",Math.min(h*g,k)," من ",k," موعد"]})}),p.jsxs("div",{className:"flex items-center gap-6 lg:gap-8",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),p.jsxs(el,{value:`${g}`,onValueChange:e=>{f(parseInt(e)),x(1)},children:[p.jsx(al,{className:"h-8 w-[70px]",children:p.jsx(nl,{placeholder:g})}),p.jsx(il,{side:"top",children:[10,20,30,50,100].map(e=>p.jsx(dl,{value:`${e}`,children:e},e))})]})]}),p.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",h," من ",S]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(Qi,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(1),disabled:1===h,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),p.jsx(wr,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(h-1),disabled:1===h,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),p.jsx(yr,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(h+1),disabled:h===S,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),p.jsx(br,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(S),disabled:h===S,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),p.jsx(Nr,{className:"h-4 w-4"})]})]})]})]})]})}function n$({isOpen:e,appointment:t,patient:n,onClose:a,onConfirm:s,isLoading:r=!1}){return t?p.jsx(Ii,{open:e,onOpenChange:a,children:p.jsxs(Yi,{className:"sm:max-w-[425px]",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"flex items-center gap-2 text-destructive arabic-enhanced",children:[p.jsx(sr,{className:"w-5 h-5"}),"تأكيد حذف الموعد"]}),p.jsx(Hi,{className:"text-right arabic-enhanced",children:"هل أنت متأكد من أنك تريد حذف هذا الموعد؟ لا يمكن التراجع عن هذا الإجراء."})]}),p.jsx("div",{className:"py-4 space-y-4",children:p.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(hr,{className:"w-4 h-4 text-muted-foreground"}),p.jsx("span",{className:"font-medium arabic-enhanced",children:"تفاصيل الموعد:"})]}),p.jsxs("div",{className:"space-y-2 text-sm",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Ai,{className:"w-4 h-4 text-muted-foreground"}),p.jsxs("span",{className:"arabic-enhanced",children:["المريض: ",(null==n?void 0:n.full_name)||"غير معروف"]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Sr,{className:"w-4 h-4 text-muted-foreground"}),p.jsxs("span",{children:["التاريخ والوقت: ",pa(t.start_time)]})]}),t.title&&p.jsxs("div",{className:"arabic-enhanced",children:[p.jsx("span",{className:"font-medium",children:"العنوان: "}),p.jsx("span",{children:t.title})]}),t.description&&p.jsxs("div",{className:"arabic-enhanced",children:[p.jsx("span",{className:"font-medium",children:"الوصف: "}),p.jsx("span",{children:t.description})]})]})]})}),p.jsxs(qi,{className:"flex gap-2",children:[p.jsx(Qi,{variant:"outline",onClick:a,disabled:r,className:"arabic-enhanced",children:"إلغاء"}),p.jsx(Qi,{variant:"destructive",onClick:s,disabled:r,className:"arabic-enhanced",children:r?"جاري الحذف...":"حذف الموعد"})]})]})}):null}e$.isValid=function(){return this._isValid},e$.abs=function(){var e=this._data;return this._milliseconds=_D(this._milliseconds),this._days=_D(this._days),this._months=_D(this._months),e.milliseconds=_D(e.milliseconds),e.seconds=_D(e.seconds),e.minutes=_D(e.minutes),e.hours=_D(e.hours),e.months=_D(e.months),e.years=_D(e.years),this},e$.add=function(e,t){return kD(this,e,t,1)},e$.subtract=function(e,t){return kD(this,e,t,-1)},e$.as=function(e){if(!this.isValid())return NaN;var t,n,a=this._milliseconds;if("month"===(e=E_(e))||"quarter"===e||"year"===e)switch(t=this._days+a/864e5,n=this._months+DD(t),e){case"month":return n;case"quarter":return n/3;case"year":return n/12}else switch(t=this._days+Math.round($D(this._months)),e){case"week":return t/7+a/6048e5;case"day":return t+a/864e5;case"hour":return 24*t+a/36e5;case"minute":return 1440*t+a/6e4;case"second":return 86400*t+a/1e3;case"millisecond":return Math.floor(864e5*t)+a;default:throw new Error("Unknown unit "+e)}},e$.asMilliseconds=ED,e$.asSeconds=TD,e$.asMinutes=AD,e$.asHours=FD,e$.asDays=PD,e$.asWeeks=OD,e$.asMonths=RD,e$.asQuarters=MD,e$.asYears=LD,e$.valueOf=ID,e$._bubble=function(){var e,t,n,a,s,r=this._milliseconds,i=this._days,l=this._months,o=this._data;return r>=0&&i>=0&&l>=0||r<=0&&i<=0&&l<=0||(r+=864e5*SD($D(l)+i),i=0,l=0),o.milliseconds=r%1e3,e=tk(r/1e3),o.seconds=e%60,t=tk(e/60),o.minutes=t%60,n=tk(t/60),o.hours=n%24,i+=tk(n/24),l+=s=tk(DD(i)),i-=SD($D(s)),a=tk(l/12),l%=12,o.days=i,o.months=l,o.years=a,this},e$.clone=function(){return BS(this)},e$.get=function(e){return e=E_(e),this.isValid()?this[e+"s"]():NaN},e$.milliseconds=BD,e$.seconds=YD,e$.minutes=VD,e$.hours=qD,e$.days=UD,e$.weeks=function(){return tk(this.days()/7)},e$.months=HD,e$.years=GD,e$.humanize=function(e,t){if(!this.isValid())return this.localeData().invalidDate();var n,a,s=!1,r=KD;return"object"==typeof e&&(t=e,e=!1),"boolean"==typeof e&&(s=e),"object"==typeof t&&(r=Object.assign({},KD,t),null!=t.s&&null==t.ss&&(r.ss=t.s-1)),a=function(e,t,n,a){var s=BS(e).abs(),r=WD(s.as("s")),i=WD(s.as("m")),l=WD(s.as("h")),o=WD(s.as("d")),d=WD(s.as("M")),c=WD(s.as("w")),u=WD(s.as("y")),m=r<=n.ss&&["s",r]||r<n.s&&["ss",r]||i<=1&&["m"]||i<n.m&&["mm",i]||l<=1&&["h"]||l<n.h&&["hh",l]||o<=1&&["d"]||o<n.d&&["dd",o];return null!=n.w&&(m=m||c<=1&&["w"]||c<n.w&&["ww",c]),(m=m||d<=1&&["M"]||d<n.M&&["MM",d]||u<=1&&["y"]||["yy",u])[2]=t,m[3]=+e>0,m[4]=a,ZD.apply(null,m)}(this,!s,r,n=this.localeData()),s&&(a=n.pastFuture(+this,a)),n.postformat(a)},e$.toISOString=JD,e$.toString=JD,e$.toJSON=JD,e$.locale=QS,e$.localeData=JS,e$.toIsoString=p_("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",JD),e$.lang=XS,k_("X",0,0,"unix"),k_("x",0,0,"valueOf"),X_("x",H_),X_("X",/[+-]?\d+(\.\d{1,3})?/),sk("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e))}),sk("x",function(e,t,n){n._d=new Date(nk(e))}),
//! moment.js
GN.version="2.30.1",BN=kS,GN.fn=vD,GN.min=function(){return $S("isBefore",[].slice.call(arguments,0))},GN.max=function(){return $S("isAfter",[].slice.call(arguments,0))},GN.now=function(){return Date.now?Date.now():+new Date},GN.utc=a_,GN.unix=function(e){return kS(1e3*e)},GN.months=function(e,t){return wD(e,t,"months")},GN.isDate=e_,GN.locale=rS,GN.invalid=i_,GN.duration=BS,GN.isMoment=u_,GN.weekdays=function(e,t,n){return ND(e,t,n,"weekdays")},GN.parseZone=function(){return kS.apply(null,arguments).parseZone()},GN.localeData=lS,GN.isDuration=TS,GN.monthsShort=function(e,t){return wD(e,t,"monthsShort")},GN.weekdaysMin=function(e,t,n){return ND(e,t,n,"weekdaysMin")},GN.defineLocale=iS,GN.updateLocale=function(e,t){if(null!=t){var n,a,s=Jk;null!=eS[e]&&null!=eS[e].parentLocale?eS[e].set(v_(eS[e]._config,t)):(null!=(a=sS(e))&&(s=a._config),t=v_(s,t),null==a&&(t.abbr=e),(n=new y_(t)).parentLocale=eS[e],eS[e]=n),rS(e)}else null!=eS[e]&&(null!=eS[e].parentLocale?(eS[e]=eS[e].parentLocale,e===rS()&&rS(e)):null!=eS[e]&&delete eS[e]);return eS[e]},GN.locales=function(){return h_(eS)},GN.weekdaysShort=function(e,t,n){return ND(e,t,n,"weekdaysShort")},GN.normalizeUnits=E_,GN.relativeTimeRounding=function(e){return void 0===e?WD:"function"==typeof e&&(WD=e,!0)},GN.relativeTimeThreshold=function(e,t){return void 0!==KD[e]&&(void 0===t?KD[e]:(KD[e]=t,"s"===e&&(KD.ss=t-1),!0))},GN.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},GN.prototype=vD,GN.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};GN.locale("ar",na),GN.updateLocale("ar",na);const a$=function(e){function t(t,n){var a,s,r=e(t).local(),i=e(n).local();if(!e.tz)return r.toDate().getTimezoneOffset()-i.toDate().getTimezoneOffset();var l=null!==(a=null==r||null===(s=r._z)||void 0===s?void 0:s.name)&&void 0!==a?a:e.tz.guess();return e.tz.zone(l).utcOffset(+r)-e.tz.zone(l).utcOffset(+i)}function n(t,n,a){var s=HN(a);return[s?e(t).startOf(s):e(t),s?e(n).startOf(s):e(n),s]}function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=HN(arguments.length>1?arguments[1]:void 0);return n?e(t).startOf(n).toDate():e(t).toDate()}function s(e,t,a){var s=nv(n(e,t,a),3),r=s[0],i=s[1],l=s[2];return r.isSame(i,l)}function r(e,t,a){var s=nv(n(e,t,a),3),r=s[0],i=s[1],l=s[2];return r.isSameOrBefore(i,l)}function i(t,n,a){var s=HN(a);return e(t).add(n,s).toDate()}function l(t,n){var a=HN(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"day"),s=e(t);return e(n).diff(s,a)}function o(t){return e(t).startOf("month").startOf("week").toDate()}function d(t){return e(t).endOf("month").endOf("week").toDate()}function c(t,n){var a=e(t),s=e(n);return e.duration(s.diff(a)).days()}return new xw({formats:UN,firstOfWeek:function(t){var n=t?e.localeData(t):e.localeData();return n?n.firstDayOfWeek():0},firstVisibleDay:o,lastVisibleDay:d,visibleDays:function(e){for(var t=o(e),n=d(e),a=[];r(t,n);)a.push(t),t=i(t,1,"d");return a},format:function(t,n,a){return(s=e(t),r=a,r?s.locale(r):s).format(n);var s,r},lt:function(e,t,a){var s=nv(n(e,t,a),3),r=s[0],i=s[1],l=s[2];return r.isBefore(i,l)},lte:r,gt:function(e,t,a){var s=nv(n(e,t,a),3),r=s[0],i=s[1],l=s[2];return r.isAfter(i,l)},gte:function(e,t,a){var s=nv(n(e,t,a),3),r=s[0],i=s[1],l=s[2];return r.isSameOrBefore(i,l)},eq:s,neq:function(e,t,n){return!s(e,t,n)},merge:function(t,n){if(!t&&!n)return null;var a=e(n).format("HH:mm:ss"),s=e(t).startOf("day").format("MM/DD/YYYY");return e("".concat(s," ").concat(a),"MM/DD/YYYY HH:mm:ss").toDate()},inRange:function(t,n,a){var s=HN(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"day"),r=e(t),i=e(n),l=e(a);return r.isBetween(i,l,s,"[]")},startOf:a,endOf:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=HN(arguments.length>1?arguments[1]:void 0);return n?e(t).endOf(n).toDate():e(t).toDate()},range:function(t,n){for(var a=HN(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"day"),s=e(t).toDate(),l=[];r(s,n);)l.push(s),s=i(s,1,a);return l},add:i,diff:l,ceil:function(e,t){var n=HN(t),r=a(e,n);return s(r,e)?r:i(r,1,n)},min:function(t,n){var a=e(t),s=e(n);return e.min(a,s).toDate()},max:function(t,n){var a=e(t),s=e(n);return e.max(a,s).toDate()},minutes:function(t){return e(t).minutes()},getSlotDate:function(t,n,a){return e(t).startOf("day").minute(n+a).toDate()},getTimezoneOffset:function(t){return e(t).toDate().getTimezoneOffset()},getDstOffset:t,getTotalMin:function(e,t){return l(e,t,"minutes")},getMinutesFromMidnight:function(n){var a=e(n).startOf("day");return e(n).diff(a,"minutes")+function(n){return t(e(n).startOf("day"),n)}(n)},continuesPrior:function(t,n){var a=e(t),s=e(n);return a.isBefore(s,"day")},continuesAfter:function(t,n,a){var s=e(n),r=e(a);return s.isSameOrAfter(r,"minutes")},sortEvents:function(e){var t=e.evtA,n=t.start,s=t.end,r=t.allDay,i=e.evtB,l=i.start,o=i.end,d=i.allDay,u=+a(n,"day")-+a(l,"day"),m=c(n,s),p=c(l,o);return u||p-m||!!d-!!r||+n-+l||+s-+o},inEventRange:function(t){var n=t.event,a=n.start,s=n.end,r=t.range,i=r.start,l=r.end,o=e(a).startOf("day"),d=e(s),c=e(i),u=e(l),m=o.isSameOrBefore(u,"day"),p=!o.isSame(d,"minutes")?d.isAfter(c,"minutes"):d.isSameOrAfter(c,"minutes");return m&&p},isSameDate:function(t,n){var a=e(t),s=e(n);return a.isSame(s,"day")},daySpan:c,browserTZOffset:function(){var t=new Date,n=/-/.test(t.toString())?"-":"",a=t.getTimezoneOffset(),s=Number("".concat(n).concat(Math.abs(a)));return e().utcOffset()>s?1:0}})}
//! moment.js
//! version : 2.30.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
(GN),s$=e=>{switch(e){case"scheduled":return"مجدول";case"completed":return"مكتمل";case"cancelled":return"ملغي";case"no_show":return"لم يحضر";default:return e}};function r$(){var e;wd(),_d();const{appointments:t,calendarEvents:n,selectedAppointment:a,calendarView:s,selectedDate:r,setSelectedAppointment:i,setCalendarView:l,setSelectedDate:c,loadAppointments:u,deleteAppointment:h,updateAppointment:x,createAppointment:g}=Wo(),{patients:f,loadPatients:v}=cl(),{toast:y}=yl(),[b,j]=ve.useState(!1),[w,N]=ve.useState(!1),[_,k]=ve.useState(null),[S,D]=ve.useState(!1),[$,C]=ve.useState(!1),[E,T]=ve.useState(null),[A,F]=ve.useState(null),[P,O]=ve.useState(""),[R,M]=ve.useState(!1),[L,I]=ve.useState("all"),[z,B]=ve.useState("all"),[Y,V]=ve.useState({start:"",end:""});ve.useEffect(()=>{u(),v()},[u,v]),ve.useEffect(()=>{const e=localStorage.getItem("selectedAppointmentForDetails");if(e)try{const{appointment:t,openDetailsModal:n}=JSON.parse(e);n&&t&&(i(t),j(!0),localStorage.removeItem("selectedAppointmentForDetails"))}catch(t){console.error("Error parsing search result data:",t),localStorage.removeItem("selectedAppointmentForDetails")}},[]);const q=ye.useMemo(()=>{let e=[...t];if(P.trim()){const t=P.toLowerCase();e=e.filter(e=>{var n,a,s,r;const i=(null==(a=null==(n=e.patient)?void 0:n.full_name)?void 0:a.toLowerCase())||"",l=(null==(s=e.title)?void 0:s.toLowerCase())||"",o=(null==(r=e.description)?void 0:r.toLowerCase())||"";return i.includes(t)||l.includes(t)||o.includes(t)})}if("all"!==L&&(e=e.filter(e=>e.status===L)),"all"!==z&&(e=e.filter(e=>e.patient_id===z)),Y.start&&Y.end){const t=new Date(Y.start),n=new Date(Y.end);n.setHours(23,59,59,999),e=e.filter(e=>{const a=new Date(e.start_time);return a>=t&&a<=n})}return e},[t,P,L,z,Y]),U=ve.useCallback(e=>{i(e.resource)},[i]),H=ve.useCallback(e=>{console.log("Selected slot:",e);const t=e.start||new Date,n=t.toTimeString().slice(0,5);F({date:t,time:n}),i(null),j(!0)},[]),G=ve.useCallback(e=>{c(e)},[c]),W=ve.useCallback(e=>{l(e)},[l]);return p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-heading-1 text-foreground arabic-enhanced",children:"إدارة المواعيد"}),p.jsx("p",{className:"text-body text-muted-foreground mt-2 arabic-enhanced",children:"جدولة ومتابعة مواعيد المرضى"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",onClick:()=>m(this,null,function*(){if(0!==q.length)try{yield ic.exportAppointmentsToExcel(q),rc.exportSuccess(`تم تصدير ${q.length} موعد بنجاح إلى ملف Excel مع التنسيق الجميل!`)}catch(e){console.error("Error exporting appointments:",e),rc.exportError("فشل في تصدير بيانات المواعيد")}else rc.noDataToExport("لا توجد بيانات مواعيد للتصدير")}),children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير"]}),p.jsxs(Qi,{onClick:()=>{i(null),j(!0)},children:[p.jsx(di,{className:"w-4 h-4 mr-2"}),"موعد جديد"]})]})]}),p.jsx(Lo,{children:p.jsx(Yo,{className:"pt-6",children:p.jsxs("div",{className:"space-y-4",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center gap-4",dir:"rtl",children:[p.jsxs("div",{className:"relative flex-1",children:[p.jsx(hi,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{placeholder:"البحث في المواعيد (اسم المريض، العنوان، الوصف)...",value:P,onChange:e=>O(e.target.value),className:"pr-10 text-right",dir:"rtl"})]}),p.jsx(Md,{open:R,onOpenChange:M,children:p.jsx(Ld,{asChild:!0,children:p.jsxs(Qi,{variant:"outline",size:"sm",children:[p.jsx(Or,{className:"w-4 h-4 mr-2"}),"تصفية",("all"!==L||"all"!==z||Y.start||Y.end)&&p.jsx("span",{className:"mr-2 w-2 h-2 bg-primary rounded-full"})]})})}),(P||"all"!==L||"all"!==z||Y.start||Y.end)&&p.jsxs(Qi,{variant:"ghost",size:"sm",onClick:()=>{O(""),I("all"),B("all"),V({start:"",end:""}),M(!1)},children:[p.jsx(Mi,{className:"w-4 h-4 mr-2"}),"مسح الكل"]})]}),p.jsx(Md,{open:R,onOpenChange:M,children:p.jsx(Id,{className:"space-y-4",dir:"rtl",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-muted/50 rounded-lg",dir:"rtl",children:[p.jsxs("div",{className:"space-y-2 text-right",children:[p.jsx("label",{className:"text-sm font-medium",children:"حالة الموعد"}),p.jsxs(el,{value:L,onValueChange:I,dir:"rtl",children:[p.jsx(al,{className:"text-right",children:p.jsx(nl,{placeholder:"جميع الحالات"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الحالات"}),p.jsx(dl,{value:"scheduled",children:"مجدول"}),p.jsx(dl,{value:"completed",children:"مكتمل"}),p.jsx(dl,{value:"cancelled",children:"ملغي"}),p.jsx(dl,{value:"no_show",children:"لم يحضر"})]})]})]}),p.jsxs("div",{className:"space-y-2 text-right",children:[p.jsx("label",{className:"text-sm font-medium",children:"المريض"}),p.jsxs(el,{value:z,onValueChange:B,dir:"rtl",children:[p.jsx(al,{className:"text-right",children:p.jsx(nl,{placeholder:"جميع المرضى"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع المرضى"}),f.map(e=>p.jsx(dl,{value:e.id,children:e.full_name},e.id))]})]})]}),p.jsxs("div",{className:"space-y-2 text-right",children:[p.jsx("label",{className:"text-sm font-medium",children:"من تاريخ"}),p.jsx(Xi,{type:"date",value:Y.start,onChange:e=>V(t=>d(o({},t),{start:e.target.value})),className:"text-right",dir:"rtl"})]}),p.jsxs("div",{className:"space-y-2 text-right",children:[p.jsx("label",{className:"text-sm font-medium",children:"إلى تاريخ"}),p.jsx(Xi,{type:"date",value:Y.end,onChange:e=>V(t=>d(o({},t),{end:e.target.value})),className:"text-right",dir:"rtl"})]})]})})})]})})}),p.jsxs("div",{className:"space-y-6",children:[p.jsx("div",{className:"w-full",children:p.jsxs(iu,{defaultValue:"table",className:"w-full",children:[p.jsxs(lu,{className:"grid w-full grid-cols-2",children:[p.jsxs(ou,{value:"calendar",className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(hr,{className:"w-4 h-4"}),p.jsx("span",{className:"arabic-enhanced",children:"عرض التقويم"})]}),p.jsxs(ou,{value:"table",className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(ji,{className:"w-4 h-4"}),p.jsx("span",{className:"arabic-enhanced",children:"عرض الجدول"})]})]}),p.jsx(du,{value:"calendar",className:"mt-6",children:p.jsx(Lo,{children:p.jsx(Yo,{className:"p-6",children:p.jsxs("div",{style:{height:"600px"},children:[p.jsx("style",{children:"\n                      .rbc-event {\n                        border-radius: 6px !important;\n                        border: none !important;\n                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;\n                      }\n                      .rbc-event:hover {\n                        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15) !important;\n                        transform: translateY(-1px);\n                        transition: all 0.2s ease;\n                      }\n                      .rbc-event-content {\n                        padding: 2px 4px !important;\n                      }\n                      .rbc-month-view .rbc-event {\n                        margin: 1px !important;\n                      }\n                      .rbc-agenda-view .rbc-event {\n                        border-radius: 4px !important;\n                      }\n                    "}),p.jsx(VN,{localizer:a$,events:n,startAccessor:"start",endAccessor:"end",view:s,onView:W,date:r,onNavigate:G,onSelectEvent:U,onSelectSlot:H,selectable:!0,eventPropGetter:e=>{const t=e.resource;let n="#3174ad";switch(null==t?void 0:t.status){case"completed":n="#10b981";break;case"cancelled":n="#ef4444";break;case"no_show":n="#6b7280";break;default:n="#3b82f6"}return{style:{backgroundColor:n,borderRadius:"6px",opacity:.9,color:"white",border:"0px",display:"block",fontSize:"12px",fontWeight:"500",padding:"2px 6px",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},components:{toolbar:({label:e,onNavigate:t,onView:n})=>p.jsxs("div",{className:"flex items-center justify-between mb-4 p-4 bg-card rounded-lg border",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Qi,{variant:"outline",size:"sm",onClick:()=>t("NEXT"),children:p.jsx(br,{className:"w-4 h-4"})}),p.jsx(Qi,{variant:"outline",size:"sm",onClick:()=>t("TODAY"),className:"arabic-enhanced",children:"اليوم"}),p.jsx(Qi,{variant:"outline",size:"sm",onClick:()=>t("PREV"),children:p.jsx(yr,{className:"w-4 h-4"})})]}),p.jsx("h2",{className:"text-lg font-semibold arabic-enhanced",children:e}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Qi,{variant:"month"===s?"default":"outline",size:"sm",onClick:()=>n("month"),className:"arabic-enhanced",children:"شهر"}),p.jsx(Qi,{variant:"week"===s?"default":"outline",size:"sm",onClick:()=>n("week"),className:"arabic-enhanced",children:"أسبوع"}),p.jsx(Qi,{variant:"day"===s?"default":"outline",size:"sm",onClick:()=>n("day"),className:"arabic-enhanced",children:"يوم"}),p.jsx(Qi,{variant:"agenda"===s?"default":"outline",size:"sm",onClick:()=>n("agenda"),className:"arabic-enhanced",children:"جدول أعمال"})]})]}),event:({event:e})=>{var t;const n=e.resource,a=(null==(t=null==n?void 0:n.patient)?void 0:t.full_name)||(null==n?void 0:n.patient_name)||(null==n?void 0:n.patient_name)||"مريض غير معروف",s="مريض محذوف"===a,r=new Date((null==n?void 0:n.start_time)||e.start).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1});return p.jsxs("div",{className:"w-full h-full flex flex-col justify-center items-center text-center p-1",dir:"rtl",children:[p.jsxs("div",{className:"font-medium text-xs truncate w-full flex items-center justify-center gap-1 "+(s?"opacity-60":""),title:`${a} - ${s$((null==n?void 0:n.status)||"scheduled")}`,children:[p.jsx("span",{className:"text-xs",children:(e=>{switch(e){case"completed":return"✓";case"cancelled":return"✗";case"no_show":return"⚠";default:return"●"}})((null==n?void 0:n.status)||"scheduled")}),p.jsx("span",{className:"truncate",children:a})]}),p.jsx("div",{className:"text-xs opacity-90",title:r,children:r})]})}},step:30,timeslots:2,min:new Date(2024,0,1,8,0),max:new Date(2024,0,1,18,0)})]})})})}),p.jsx(du,{value:"table",className:"mt-6",children:p.jsx(t$,{appointments:q,patients:f,isLoading:S,onEdit:e=>{i(e),j(!0)},onDelete:e=>{k(e),N(!0)},onViewPatient:e=>{console.log("View patient:",e),T(e),C(!0)},onSelectAppointment:e=>{i(e)}})})]})}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[a&&p.jsxs(Lo,{children:[p.jsx(Io,{className:"pb-3",children:p.jsx(zo,{className:"text-lg arabic-enhanced",children:"تفاصيل الموعد"})}),p.jsxs(Yo,{className:"space-y-3",dir:"rtl",children:[p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("h4",{className:"font-medium mb-1 arabic-enhanced text-sm",children:a.title}),p.jsxs("div",{className:"space-y-1",children:[p.jsxs("div",{className:"flex items-center text-xs gap-2",children:[p.jsx(Sr,{className:"w-3 h-3 text-muted-foreground"}),p.jsx("span",{children:pa(a.start_time)})]}),p.jsxs("div",{className:"flex items-center text-xs gap-2",children:[p.jsx(Ai,{className:"w-3 h-3 text-muted-foreground"}),p.jsx("span",{className:"arabic-enhanced",children:null==(e=a.patient)?void 0:e.full_name})]})]})]}),p.jsx("div",{className:"flex flex-col gap-2 ml-3",children:p.jsx(qo,{className:`${fa(a.status)} text-xs`,children:s$(a.status)})})]}),(a.description||a.treatment||a.cost)&&p.jsxs("div",{className:"grid grid-cols-1 gap-2 pt-2 border-t",children:[a.description&&p.jsxs("div",{children:[p.jsx("span",{className:"text-xs font-medium arabic-enhanced",children:"الوصف: "}),p.jsx("span",{className:"text-xs text-muted-foreground arabic-enhanced",children:a.description})]}),a.treatment&&p.jsxs("div",{children:[p.jsx("span",{className:"text-xs font-medium arabic-enhanced",children:"العلاج: "}),p.jsx("span",{className:"text-xs text-muted-foreground arabic-enhanced",children:a.treatment.name})]}),a.cost&&p.jsxs("div",{children:[p.jsx("span",{className:"text-xs font-medium arabic-enhanced",children:"التكلفة: "}),p.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.cost," $"]})]})]}),p.jsxs("div",{className:"flex gap-2 pt-2",children:[p.jsx(Qi,{className:"flex-1 arabic-enhanced",size:"sm",onClick:()=>{j(!0)},children:"تعديل"}),p.jsx(Qi,{variant:"outline",className:"flex-1 arabic-enhanced",size:"sm",disabled:S||"completed"===(null==a?void 0:a.status),onClick:()=>m(this,null,function*(){if(a){D(!0);try{yield x(a.id,{status:"completed"});const e=d(o({},a),{status:"completed"});i(e),y({title:"نجح",description:"تم تحديد الموعد كمكتمل",variant:"default"})}catch(e){console.error("Error updating appointment:",e),y({title:"خطأ",description:"حدث خطأ أثناء تحديث الموعد",variant:"destructive"})}finally{D(!1)}}}),children:S?"جاري...":"completed"===(null==a?void 0:a.status)?"مكتمل ✓":"مكتمل"})]})]})]}),p.jsxs(Lo,{children:[p.jsxs(Io,{className:"pb-3",children:[p.jsx(zo,{className:"text-lg arabic-enhanced",children:"جدول اليوم"}),p.jsx(Bo,{className:"text-sm arabic-enhanced",children:ma(new Date)})]}),p.jsx(Yo,{dir:"rtl",children:p.jsxs("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:[q.filter(e=>(new Date).toDateString()===new Date(e.start_time).toDateString()).slice(0,5).map(e=>{var t,n;return p.jsxs("div",{className:"flex items-center justify-between p-2 rounded border cursor-pointer hover:bg-muted/50 gap-2",onClick:()=>i(e),children:[p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("p",{className:"text-xs font-medium arabic-enhanced truncate",title:(null==(t=e.patient)?void 0:t.full_name)||e.patient_name||"مريض غير معروف",children:(null==(n=e.patient)?void 0:n.full_name)||e.patient_name||"مريض غير معروف"}),p.jsx("p",{className:"text-xs text-muted-foreground",children:ha(e.start_time)})]}),p.jsx(qo,{variant:"outline",className:`${fa(e.status)} whitespace-nowrap flex-shrink-0 text-xs`,children:s$(e.status)})]},e.id)}),0===t.filter(e=>(new Date).toDateString()===new Date(e.start_time).toDateString()).length&&p.jsx("p",{className:"text-xs text-muted-foreground text-center py-4 arabic-enhanced",children:"لا توجد مواعيد اليوم"})]})})]}),p.jsxs(Lo,{children:[p.jsxs(Io,{className:"pb-3",children:[p.jsx(zo,{className:"text-lg arabic-enhanced",children:"جدول الغد"}),p.jsx(Bo,{className:"text-sm arabic-enhanced",children:ma(new Date(Date.now()+864e5))})]}),p.jsx(Yo,{dir:"rtl",children:p.jsxs("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:[q.filter(e=>new Date(Date.now()+864e5).toDateString()===new Date(e.start_time).toDateString()).slice(0,5).map(e=>{var t,n;return p.jsxs("div",{className:"flex items-center justify-between p-2 rounded border cursor-pointer hover:bg-muted/50 gap-2",onClick:()=>i(e),children:[p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("p",{className:"text-xs font-medium arabic-enhanced truncate",title:(null==(t=e.patient)?void 0:t.full_name)||e.patient_name||"مريض غير معروف",children:(null==(n=e.patient)?void 0:n.full_name)||e.patient_name||"مريض غير معروف"}),p.jsx("p",{className:"text-xs text-muted-foreground",children:ha(e.start_time)})]}),p.jsx(qo,{variant:"outline",className:`${fa(e.status)} whitespace-nowrap flex-shrink-0 text-xs`,children:s$(e.status)})]},e.id)}),0===t.filter(e=>new Date(Date.now()+864e5).toDateString()===new Date(e.start_time).toDateString()).length&&p.jsx("p",{className:"text-xs text-muted-foreground text-center py-4 arabic-enhanced",children:"لا توجد مواعيد غداً"})]})})]})]})]}),p.jsx(Mo,{isOpen:b,onClose:()=>{j(!1),F(null)},onSave:e=>m(this,null,function*(){try{a?(console.log("🔄 Updating appointment:",{id:a.id,data:e}),yield x(a.id,e),console.log("✅ Appointment updated successfully"),y({title:"نجح",description:"تم تحديث الموعد بنجاح",variant:"default"})):(console.log("➕ Creating new appointment:",e),yield g(e),console.log("✅ Appointment created successfully"),y({title:"نجح",description:"تم إضافة الموعد بنجاح",variant:"default"})),j(!1),i(null),F(null)}catch(t){console.error("❌ Error saving appointment:",t),y({title:"خطأ",description:"حدث خطأ أثناء حفظ الموعد",variant:"destructive"})}}),patients:f,treatments:[],selectedDate:null==A?void 0:A.date,selectedTime:null==A?void 0:A.time,initialData:a}),p.jsx(n$,{isOpen:w,appointment:_&&t.find(e=>e.id===_)||null,patient:_&&f.find(e=>{var n;return e.id===(null==(n=t.find(e=>e.id===_))?void 0:n.patient_id)})||null,onClose:()=>{N(!1),k(null)},onConfirm:()=>m(this,null,function*(){if(_){D(!0);try{yield h(_),y({title:"نجح",description:"تم حذف الموعد بنجاح",variant:"default"}),N(!1),k(null)}catch(e){console.error("Error deleting appointment:",e),y({title:"خطأ",description:"حدث خطأ أثناء حذف الموعد",variant:"destructive"})}finally{D(!1)}}}),isLoading:S}),p.jsx(Mf,{open:$,patient:E,onOpenChange:e=>{C(e),e||T(null)}})]})}const i$=Ne()(Lt((e,t)=>({labs:[],selectedLab:null,isLoading:!1,error:null,searchQuery:"",filteredLabs:[],loadLabs:()=>m(void 0,null,function*(){var t,n;e({isLoading:!0,error:null});try{const a=(yield null==(n=null==(t=window.electronAPI)?void 0:t.labs)?void 0:n.getAll())||[];e({labs:a,filteredLabs:a,isLoading:!1})}catch(a){e({error:a instanceof Error?a.message:"Failed to load labs",isLoading:!1})}}),createLab:n=>m(void 0,null,function*(){var a,s;console.log("🔍 [DEBUG] labStore.createLab() called with data:",n),e({isLoading:!0,error:null});try{console.log("📡 [DEBUG] Calling window.electronAPI.labs.create...");const r=yield null==(s=null==(a=window.electronAPI)?void 0:a.labs)?void 0:s.create(n);if(console.log("📨 [DEBUG] Received response from electronAPI:",r),r){const{labs:n}=t();console.log("📊 [DEBUG] Current labs count before adding:",n.length);const a=[...n,r];console.log("📊 [DEBUG] Updated labs count after adding:",a.length),e({labs:a,isLoading:!1}),console.log("✅ [DEBUG] Store state updated successfully"),t().filterLabs(),console.log("✅ [DEBUG] Labs filtered successfully")}else console.warn("⚠️ [DEBUG] No lab returned from electronAPI")}catch(r){throw console.error("❌ [DEBUG] Error in labStore.createLab:",r),e({error:r instanceof Error?r.message:"Failed to create lab",isLoading:!1}),r}}),updateLab:(n,a)=>m(void 0,null,function*(){var s,r,i;e({isLoading:!0,error:null});try{const l=yield null==(r=null==(s=window.electronAPI)?void 0:s.labs)?void 0:r.update(n,a);if(l){const{labs:a}=t(),s=a.map(e=>e.id===n?l:e);e({labs:s,selectedLab:(null==(i=t().selectedLab)?void 0:i.id)===n?l:t().selectedLab,isLoading:!1}),t().filterLabs()}}catch(l){throw console.error("Error updating lab:",l),e({error:l instanceof Error?l.message:"Failed to update lab",isLoading:!1}),l}}),deleteLab:n=>m(void 0,null,function*(){var a,s,r;e({isLoading:!0,error:null});try{if(yield null==(s=null==(a=window.electronAPI)?void 0:a.labs)?void 0:s.delete(n)){const{labs:a}=t(),s=a.filter(e=>e.id!==n);e({labs:s,selectedLab:(null==(r=t().selectedLab)?void 0:r.id)===n?null:t().selectedLab,isLoading:!1}),t().filterLabs()}}catch(i){throw console.error("Error deleting lab:",i),e({error:i instanceof Error?i.message:"Failed to delete lab",isLoading:!1}),i}}),setSelectedLab:t=>e({selectedLab:t}),setSearchQuery:n=>{e({searchQuery:n}),t().filterLabs()},filterLabs:()=>{const{labs:n,searchQuery:a}=t();if(!a.trim())return void e({filteredLabs:n});const s=n.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())||e.contact_info&&e.contact_info.toLowerCase().includes(a.toLowerCase())||e.address&&e.address.toLowerCase().includes(a.toLowerCase()));e({filteredLabs:s})},clearError:()=>e({error:null})}),{name:"lab-store"}));function l$({labs:e,onEdit:t,onDelete:n,searchQuery:a}){const{isLoading:s}=i$(),{getOrdersByLab:r}=Th(),i=e.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())||e.contact_info&&e.contact_info.toLowerCase().includes(a.toLowerCase())||e.address&&e.address.toLowerCase().includes(a.toLowerCase()));return s?p.jsx("div",{className:"flex items-center justify-center py-8",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),p.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل المختبرات..."})]})}):0===i.length?p.jsxs("div",{className:"text-center py-8",children:[p.jsx(ur,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),p.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:a?"لا توجد نتائج":"لا توجد مختبرات"}),p.jsx("p",{className:"text-muted-foreground",children:a?`لم يتم العثور على مختبرات تطابق "${a}"`:"لم يتم إضافة أي مختبرات بعد"})]}):p.jsx("div",{className:"rounded-md border",dir:"rtl",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-center",children:"#"}),p.jsx(tc,{className:"text-center",children:"اسم المختبر"}),p.jsx(tc,{className:"text-center",children:"معلومات الاتصال"}),p.jsx(tc,{className:"text-center",children:"العنوان"}),p.jsx(tc,{className:"text-center",children:"عدد الطلبات"}),p.jsx(tc,{className:"text-center",children:"تاريخ الإضافة"}),p.jsx(tc,{className:"text-center w-[100px]",children:"الإجراءات"})]})}),p.jsx(Jd,{children:i.map((e,a)=>{return p.jsxs(ec,{className:"hover:bg-muted/50",children:[p.jsx(nc,{className:"font-medium text-center",children:a+1}),p.jsx(nc,{className:"font-medium text-center table-cell-wrap-truncate-md",children:p.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.name,p.jsx(ur,{className:"h-4 w-4 text-blue-600"})]})}),p.jsx(nc,{className:"text-center table-cell-wrap-truncate-sm",children:e.contact_info?p.jsx("div",{className:"flex items-center justify-center",children:p.jsxs("button",{onClick:()=>m(this,null,function*(){var t,n,a;const s=`https://api.whatsapp.com/send/?phone=${(null==(t=e.contact_info)?void 0:t.replace(/[^\d]/g,""))||""}`;try{if(window.electronAPI&&window.electronAPI.system&&window.electronAPI.system.openExternal)return void(yield window.electronAPI.system.openExternal(s))}catch(r){console.log("Method 1 failed:",r)}try{if(window.electronAPI)return void(yield null==(a=null==(n=window.electronAPI.shell)?void 0:n.openExternal)?void 0:a.call(n,s))}catch(r){console.log("Method 2 failed:",r)}window.open(s,"_blank","noopener,noreferrer")}),className:"text-sm text-green-600 hover:text-green-700 hover:underline transition-colors cursor-pointer flex items-center gap-1",children:[e.contact_info,p.jsx(Zr,{className:"h-3 w-3"})]})}):p.jsx("span",{className:"text-muted-foreground text-sm",children:"غير محدد"})}),p.jsx(nc,{className:"text-center",children:e.address?p.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[p.jsx("span",{className:"text-sm",children:e.address}),p.jsx(Kr,{className:"h-4 w-4 text-orange-600"})]}):p.jsx("span",{className:"text-muted-foreground text-sm",children:"غير محدد"})}),p.jsx(nc,{className:"text-center",children:p.jsx("div",{className:"flex justify-center",children:p.jsxs(qo,{variant:"secondary",className:"flex items-center gap-1 w-fit",children:[(s=e.id,r(s).length),p.jsx(wi,{className:"h-3 w-3"})]})})}),p.jsx(nc,{className:"text-sm text-muted-foreground text-center",children:ma(e.created_at)}),p.jsx(nc,{className:"min-w-[140px] text-center",children:p.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:()=>(e=>{t(e)})(e),children:[p.jsx(si,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:()=>(e=>{const t=r(e.id);t.length>0?rc.warning(`لا يمكن حذف المختبر "${e.name}" لأنه يحتوي على ${t.length} طلب`):n(e)})(e),children:[p.jsx(Ni,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]})]})})]},e.id);var s})})]})})}function o$({open:e,onOpenChange:t,editingLab:n}){const{createLab:a,updateLab:s,isLoading:r}=i$(),[i,l]=ve.useState({name:"",contact_info:"",address:""}),[c,u]=ve.useState({});ve.useEffect(()=>{e&&(l(n?{name:n.name||"",contact_info:n.contact_info||"",address:n.address||""}:{name:"",contact_info:"",address:""}),u({}))},[e,n]);const h=(e,t)=>{l(n=>d(o({},n),{[e]:t})),c[e]&&u(t=>d(o({},t),{[e]:""}))};return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"sm:max-w-[500px]",dir:"rtl",children:[p.jsxs(Vi,{className:"text-right",dir:"rtl",children:[p.jsxs(Ui,{className:"flex items-center gap-2 justify-end text-right",children:[p.jsx("span",{children:n?"تعديل المختبر":"إضافة مختبر جديد"}),p.jsx(ur,{className:"h-5 w-5 text-blue-600"})]}),p.jsx(Hi,{className:"text-right",children:n?"قم بتعديل معلومات المختبر أدناه":"أدخل معلومات المختبر الجديد أدناه"})]}),p.jsxs("form",{onSubmit:e=>m(this,null,function*(){if(console.log("🔍 [DEBUG] AddLabDialog.handleSubmit() called"),e.preventDefault(),console.log("📝 [DEBUG] Form data before validation:",i),(()=>{const e={};return i.name.trim()?i.name.trim().length<2&&(e.name="اسم المختبر يجب أن يكون على الأقل حرفين"):e.name="اسم المختبر مطلوب",i.contact_info&&i.contact_info.trim().length<5&&(e.contact_info="معلومات الاتصال يجب أن تكون على الأقل 5 أحرف"),i.address&&i.address.trim().length<5&&(e.address="العنوان يجب أن يكون على الأقل 5 أحرف"),u(e),0===Object.keys(e).length})()){console.log("✅ [DEBUG] Form validation passed");try{const e={name:i.name.trim(),contact_info:i.contact_info.trim()||void 0,address:i.address.trim()||void 0};console.log("📤 [DEBUG] Prepared lab data for submission:",e),n?(console.log("🔄 [DEBUG] Updating existing lab with ID:",n.id),yield s(n.id,e),rc.success("تم تحديث المختبر بنجاح")):(console.log("➕ [DEBUG] Creating new lab"),yield a(e),console.log("✅ [DEBUG] Lab created successfully"),rc.success("تم إضافة المختبر بنجاح")),console.log("🚪 [DEBUG] Closing dialog"),t(!1)}catch(r){console.error("❌ [DEBUG] Error in AddLabDialog.handleSubmit:",r),console.error("❌ [DEBUG] Error stack:",r.stack),rc.error(n?"فشل في تحديث المختبر":"فشل في إضافة المختبر")}}else console.log("❌ [DEBUG] Form validation failed")}),className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"name",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(ur,{className:"h-4 w-4 text-blue-600"}),p.jsx("span",{children:"اسم المختبر *"})]}),p.jsx(Xi,{id:"name",value:i.name,onChange:e=>h("name",e.target.value),placeholder:"أدخل اسم المختبر",className:"text-right "+(c.name?"border-destructive":""),disabled:r,dir:"rtl"}),c.name&&p.jsx("p",{className:"text-sm text-destructive text-right",children:c.name})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"contact_info",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(ri,{className:"h-4 w-4 text-green-600"}),p.jsx("span",{children:"معلومات الاتصال"})]}),p.jsx(Xi,{id:"contact_info",value:i.contact_info,onChange:e=>h("contact_info",e.target.value),placeholder:"رقم الهاتف أو البريد الإلكتروني",className:"text-right "+(c.contact_info?"border-destructive":""),disabled:r,dir:"rtl"}),c.contact_info&&p.jsx("p",{className:"text-sm text-destructive text-right",children:c.contact_info})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"address",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(Kr,{className:"h-4 w-4 text-orange-600"}),p.jsx("span",{children:"العنوان"})]}),p.jsx(Ji,{id:"address",value:i.address,onChange:e=>h("address",e.target.value),placeholder:"عنوان المختبر",className:"text-right "+(c.address?"border-destructive":""),disabled:r,rows:3,dir:"rtl"}),c.address&&p.jsx("p",{className:"text-sm text-destructive text-right",children:c.address})]}),p.jsxs(qi,{className:"flex flex-row-reverse gap-2 pt-4",dir:"rtl",children:[p.jsx(Qi,{type:"submit",disabled:r,className:"min-w-[100px]",children:r?p.jsxs(p.Fragment,{children:[p.jsx(Hr,{className:"w-4 h-4 ml-2 animate-spin"}),n?"جاري التحديث...":"جاري الإضافة..."]}):n?"تحديث":"إضافة"}),p.jsx(Qi,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:r,children:"إلغاء"})]})]})]})})}function d$({open:e,onOpenChange:t,lab:n}){const{deleteLab:a,isLoading:s}=i$(),{getOrdersByLab:r}=Th();if(!n)return null;const i=r(n.id),l=i.length>0;return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"sm:max-w-[500px]",dir:"rtl",children:[p.jsxs(Vi,{dir:"rtl",children:[p.jsxs(Ui,{className:"flex items-center gap-2 text-destructive text-right",children:[p.jsx(sr,{className:"h-5 w-5"}),"تأكيد حذف المختبر"]}),p.jsx(Hi,{className:"text-right",children:"هذا الإجراء لا يمكن التراجع عنه. سيتم حذف المختبر نهائياً من النظام."})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(ur,{className:"h-4 w-4 text-blue-600"}),p.jsx("span",{className:"font-semibold",children:"اسم المختبر:"}),p.jsx("span",{children:n.name})]}),n.contact_info&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"font-semibold",children:"معلومات الاتصال:"}),p.jsx("span",{className:"text-sm",children:n.contact_info})]}),n.address&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"font-semibold",children:"العنوان:"}),p.jsx("span",{className:"text-sm",children:n.address})]})]}),l&&p.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:[p.jsxs("div",{className:"flex items-center gap-2 text-destructive mb-2",children:[p.jsx(sr,{className:"h-4 w-4"}),p.jsx("span",{className:"font-semibold",children:"تحذير مهم"})]}),p.jsx("p",{className:"text-sm text-destructive mb-3",children:"هذا المختبر يحتوي على طلبات مرتبطة به. حذف المختبر سيؤدي إلى حذف جميع الطلبات المرتبطة به أيضاً."}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Qr,{className:"h-4 w-4 text-destructive"}),p.jsx("span",{className:"text-sm font-medium",children:"عدد الطلبات المرتبطة:"}),p.jsxs(qo,{variant:"destructive",className:"text-xs",children:[i.length," طلب"]})]})]}),p.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:p.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[p.jsx("strong",{children:"هل أنت متأكد من رغبتك في حذف هذا المختبر؟"}),l&&p.jsxs("span",{className:"block mt-1",children:["سيتم حذف جميع الطلبات المرتبطة بهذا المختبر (",i.length," طلب)."]})]})})]}),p.jsxs(qi,{className:"gap-2",dir:"rtl",children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:s,children:"إلغاء"}),p.jsx(Qi,{type:"button",variant:"destructive",onClick:()=>m(this,null,function*(){try{yield a(n.id),rc.success(`تم حذف المختبر "${n.name}" بنجاح`),t(!1)}catch(e){console.error("Error deleting lab:",e),rc.error("فشل في حذف المختبر")}}),disabled:s,className:"min-w-[100px]",children:s?p.jsxs(p.Fragment,{children:[p.jsx(Hr,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري الحذف..."]}):p.jsxs(p.Fragment,{children:[p.jsx(sr,{className:"w-4 h-4 ml-2"}),"حذف نهائياً"]})})]})]})})}function c$({labOrders:e,onEdit:t,onDelete:n,onView:a}){const{isLoading:s}=Th(),{labs:r}=i$(),i=(e,t)=>{if(null==t?void 0:t.name)return t.name;const n=r.find(t=>t.id===e);return n?n.name:`مختبر غير محدد (${e.substring(0,8)}...)`},l=e=>{switch(e){case"معلق":return p.jsxs(qo,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[p.jsx(Sr,{className:"w-3 h-3 mr-1"}),"معلق"]});case"مكتمل":return p.jsxs(qo,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[p.jsx(gr,{className:"w-3 h-3 mr-1"}),"مكتمل"]});case"ملغي":return p.jsxs(qo,{variant:"destructive",children:[p.jsx(Ri,{className:"w-3 h-3 mr-1"}),"ملغي"]});default:return p.jsx(qo,{variant:"outline",children:e})}},o=(e,t=0)=>{const n=e-t,a=e>0?Math.round(t/e*100):0;return n<=0?p.jsxs("div",{className:"flex flex-col items-center gap-1",children:[p.jsx(qo,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"مدفوع بالكامل"}),p.jsx("span",{className:"text-xs text-green-600",children:"100%"})]}):t>0?p.jsxs("div",{className:"flex flex-col items-center gap-1",children:[p.jsx(qo,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"مدفوع جزئياً"}),p.jsxs("span",{className:"text-xs text-yellow-600",children:[a,"%"]})]}):p.jsxs("div",{className:"flex flex-col items-center gap-1",children:[p.jsx(qo,{variant:"secondary",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:"غير مدفوع"}),p.jsx("span",{className:"text-xs text-red-600",children:"0%"})]})};return s?p.jsx("div",{className:"flex items-center justify-center py-8",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),p.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل طلبات المختبرات..."})]})}):0===e.length?p.jsxs("div",{className:"text-center py-8",children:[p.jsx(wi,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),p.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"لا توجد طلبات مختبرات"}),p.jsx("p",{className:"text-muted-foreground",children:"لم يتم إضافة أي طلبات مختبرات بعد"})]}):p.jsx("div",{className:"rounded-md border",dir:"rtl",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-center w-[60px]",children:"رقم"}),p.jsx(tc,{className:"text-center",children:"اسم المختبر"}),p.jsx(tc,{className:"text-center",children:"اسم الخدمة"}),p.jsx(tc,{className:"text-center",children:"التكلفة"}),p.jsx(tc,{className:"text-center",children:"المدفوع"}),p.jsx(tc,{className:"text-center",children:"تاريخ الطلب"}),p.jsx(tc,{className:"text-center",children:"الحالة"}),p.jsx(tc,{className:"text-center",children:"حالة الدفع"}),p.jsx(tc,{className:"text-center w-[120px]",children:"الإجراءات"})]})}),p.jsx(Jd,{children:e.map((e,s)=>p.jsxs(ec,{className:"hover:bg-muted/50",children:[p.jsx(nc,{className:"font-medium text-center",children:s+1}),p.jsx(nc,{className:"text-center",children:p.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[p.jsxs("div",{className:"flex flex-col text-center",children:[p.jsx("span",{className:"font-medium",children:i(e.lab_id,e.lab)}),i(e.lab_id,e.lab).includes("مختبر غير محدد")&&p.jsx("span",{className:"text-xs text-muted-foreground",children:"المختبر قد يكون محذوفاً"})]}),p.jsx(ur,{className:"h-4 w-4 text-blue-600"})]})}),p.jsx(nc,{className:"text-center",children:p.jsx("span",{children:e.service_name})}),p.jsx(nc,{className:"text-center",children:p.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[p.jsx("span",{className:"font-semibold",children:ca(e.cost)}),p.jsx(Er,{className:"h-4 w-4 text-green-600"})]})}),p.jsxs(nc,{className:"text-center",children:[p.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[p.jsx("span",{className:"font-semibold text-blue-600",children:ca(e.paid_amount||0)}),p.jsx($r,{className:"h-4 w-4 text-blue-600"})]}),e.remaining_balance&&e.remaining_balance>0&&p.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:["متبقي: ",ca(e.remaining_balance)]})]}),p.jsx(nc,{className:"text-center",children:p.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[p.jsx("span",{className:"text-sm",children:ma(e.order_date)}),p.jsx(hr,{className:"h-4 w-4 text-gray-600"})]})}),p.jsx(nc,{className:"text-center",children:l(e.status)}),p.jsx(nc,{className:"text-center",children:o(e.cost,e.paid_amount)}),p.jsx(nc,{className:"min-w-[180px] text-center",children:p.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[a&&p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-view",onClick:()=>a(e),children:[p.jsx(Fr,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"عرض"})]}),p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:()=>t(e),children:[p.jsx(si,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),p.jsxs(Qi,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:()=>n(e),children:[p.jsx(Ni,{className:"w-4 h-4 ml-1"}),p.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]})]})})]},e.id))})]})})}function u$({open:e,onOpenChange:t,editingOrder:n}){const{labs:a}=i$(),{patients:s}=cl(),{createLabOrder:r,updateLabOrder:i,isLoading:l}=Th(),[c,u]=ve.useState({lab_id:"",patient_id:"",appointment_id:"",tooth_treatment_id:"",tooth_number:"",service_name:"",cost:"",order_date:"",expected_delivery_date:"",actual_delivery_date:"",status:"معلق",notes:"",paid_amount:"",priority:"1",lab_instructions:"",material_type:"",color_shade:""}),[h,x]=ve.useState({});ve.useEffect(()=>{var t,a,s,r;if(e){if(n)u({lab_id:n.lab_id||"",patient_id:n.patient_id||"none",appointment_id:n.appointment_id||"",tooth_treatment_id:n.tooth_treatment_id||"",tooth_number:(null==(t=n.tooth_number)?void 0:t.toString())||"",service_name:n.service_name||"",cost:(null==(a=n.cost)?void 0:a.toString())||"",order_date:n.order_date||"",expected_delivery_date:n.expected_delivery_date||"",actual_delivery_date:n.actual_delivery_date||"",status:n.status||"معلق",notes:n.notes||"",paid_amount:(null==(s=n.paid_amount)?void 0:s.toString())||"0",priority:(null==(r=n.priority)?void 0:r.toString())||"1",lab_instructions:n.lab_instructions||"",material_type:n.material_type||"",color_shade:n.color_shade||""});else{const e=(new Date).toISOString().split("T")[0];u({lab_id:"",patient_id:"none",appointment_id:"",tooth_treatment_id:"",tooth_number:"",service_name:"",cost:"",order_date:e,expected_delivery_date:"",actual_delivery_date:"",status:"معلق",notes:"",paid_amount:"0",priority:"1",lab_instructions:"",material_type:"",color_shade:""})}x({})}},[e,n]);const g=(e,t)=>{u(n=>d(o({},n),{[e]:t})),h[e]&&x(t=>d(o({},t),{[e]:""}))};return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[p.jsxs(Vi,{className:"text-right",dir:"rtl",children:[p.jsxs(Ui,{className:"flex items-center gap-2 justify-end text-right",children:[p.jsx("span",{children:n?"تعديل طلب المختبر":"إضافة طلب مختبر جديد"}),p.jsx(Qr,{className:"h-5 w-5 text-purple-600"})]}),p.jsx(Hi,{className:"text-right",children:n?"قم بتعديل معلومات طلب المختبر أدناه":"أدخل معلومات طلب المختبر الجديد أدناه"})]}),p.jsxs("form",{onSubmit:e=>m(this,null,function*(){if(e.preventDefault(),(()=>{const e={};if(c.lab_id||(e.lab_id="يجب اختيار المختبر"),c.service_name.trim()?c.service_name.trim().length<2&&(e.service_name="اسم الخدمة يجب أن يكون على الأقل حرفين"):e.service_name="اسم الخدمة/التحليل مطلوب",c.cost.trim()){const t=parseFloat(c.cost);(isNaN(t)||t<=0)&&(e.cost="التكلفة يجب أن تكون رقم موجب")}else e.cost="التكلفة مطلوبة";if(c.order_date||(e.order_date="تاريخ الطلب مطلوب"),c.paid_amount.trim()){const t=parseFloat(c.paid_amount),n=parseFloat(c.cost);isNaN(t)||t<0?e.paid_amount="المبلغ المدفوع يجب أن يكون رقم غير سالب":!isNaN(n)&&t>n&&(e.paid_amount="المبلغ المدفوع لا يمكن أن يكون أكبر من التكلفة الإجمالية")}return x(e),0===Object.keys(e).length})())try{const e=parseFloat(c.cost),a=parseFloat(c.paid_amount)||0,s=e-a,l={lab_id:c.lab_id,patient_id:"none"===c.patient_id?void 0:c.patient_id||void 0,appointment_id:c.appointment_id||void 0,tooth_treatment_id:c.tooth_treatment_id||void 0,tooth_number:c.tooth_number?parseInt(c.tooth_number):void 0,service_name:c.service_name.trim(),cost:e,order_date:c.order_date,expected_delivery_date:c.expected_delivery_date||void 0,actual_delivery_date:c.actual_delivery_date||void 0,status:c.status,notes:c.notes.trim()||void 0,paid_amount:a,remaining_balance:s,priority:parseInt(c.priority)||1,lab_instructions:c.lab_instructions.trim()||void 0,material_type:c.material_type.trim()||void 0,color_shade:c.color_shade.trim()||void 0};n?(yield i(n.id,l),rc.success("تم تحديث طلب المختبر بنجاح")):(yield r(l),rc.success("تم إضافة طلب المختبر بنجاح")),t(!1)}catch(a){console.error("Error saving lab order:",a),rc.error(n?"فشل في تحديث طلب المختبر":"فشل في إضافة طلب المختبر")}}),className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"lab_id",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(ur,{className:"h-4 w-4 text-blue-600"}),p.jsx("span",{children:"المختبر *"})]}),p.jsxs(el,{value:c.lab_id,onValueChange:e=>g("lab_id",e),disabled:l,dir:"rtl",children:[p.jsx(al,{className:"text-right bg-background border-input text-foreground "+(h.lab_id?"border-destructive":""),children:p.jsx(nl,{placeholder:"اختر المختبر",className:"text-muted-foreground"})}),p.jsx(il,{children:a.map(e=>p.jsx(dl,{value:e.id,children:e.name},e.id))})]}),h.lab_id&&p.jsx("p",{className:"text-sm text-destructive text-right",children:h.lab_id})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"patient_id",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(Ai,{className:"h-4 w-4 text-green-600"}),p.jsx("span",{children:"المريض (اختياري)"})]}),p.jsxs(el,{value:c.patient_id,onValueChange:e=>g("patient_id",e),disabled:l,dir:"rtl",children:[p.jsx(al,{className:"text-right bg-background border-input text-foreground",children:p.jsx(nl,{placeholder:"اختر المريض (اختياري)",className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"none",children:"بدون مريض محدد"}),s.map(e=>p.jsx(dl,{value:e.id,children:e.full_name},e.id))]})]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"service_name",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(Qr,{className:"h-4 w-4 text-purple-600"}),p.jsx("span",{children:"اسم الخدمة *"})]}),p.jsx(Xi,{id:"service_name",value:c.service_name,onChange:e=>g("service_name",e.target.value),placeholder:"مثال: تحليل دم شامل، أشعة بانوراما، إلخ",className:"text-right "+(h.service_name?"border-destructive":""),disabled:l,dir:"rtl"}),h.service_name&&p.jsx("p",{className:"text-sm text-destructive text-right",children:h.service_name})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"cost",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(Er,{className:"h-4 w-4 text-green-600"}),p.jsx("span",{children:"التكلفة *"})]}),p.jsx(Xi,{id:"cost",type:"number",step:"1",min:"0",value:c.cost,onChange:e=>g("cost",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;g("cost",t.toString())},placeholder:"0.00",className:"text-right "+(h.cost?"border-destructive":""),disabled:l,dir:"rtl"}),h.cost&&p.jsx("p",{className:"text-sm text-destructive text-right",children:h.cost})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"paid_amount",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx($r,{className:"h-4 w-4 text-blue-600"}),p.jsx("span",{children:"المبلغ المدفوع"})]}),p.jsx(Xi,{id:"paid_amount",type:"number",step:"1",min:"0",value:c.paid_amount,onChange:e=>g("paid_amount",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;g("paid_amount",t.toString())},placeholder:"0.00",className:"text-right "+(h.paid_amount?"border-destructive":""),disabled:l,dir:"rtl"}),h.paid_amount&&p.jsx("p",{className:"text-sm text-destructive text-right",children:h.paid_amount})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(mr,{className:"h-4 w-4 text-orange-600"}),p.jsx("span",{children:"المبلغ المتبقي"})]}),p.jsx("div",{className:"h-10 px-3 py-2 border rounded-md bg-muted flex items-center justify-end",children:p.jsx("span",{className:"text-sm font-medium",children:ca((parseFloat(c.cost)||0)-(parseFloat(c.paid_amount)||0))})})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"order_date",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(hr,{className:"h-4 w-4 text-blue-600"}),p.jsx("span",{children:"تاريخ الطلب *"})]}),p.jsx(Xi,{id:"order_date",type:"date",value:c.order_date,onChange:e=>g("order_date",e.target.value),className:"text-right "+(h.order_date?"border-destructive":""),disabled:l,dir:"rtl"}),h.order_date&&p.jsx("p",{className:"text-sm text-destructive text-right",children:h.order_date})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"status",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(Qr,{className:"h-4 w-4 text-purple-600"}),p.jsx("span",{children:"الحالة *"})]}),p.jsxs(el,{value:c.status,onValueChange:e=>g("status",e),disabled:l,dir:"rtl",children:[p.jsx(al,{className:"text-right bg-background border-input text-foreground",children:p.jsx(nl,{className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"معلق",children:"معلق"}),p.jsx(dl,{value:"مكتمل",children:"مكتمل"}),p.jsx(dl,{value:"ملغي",children:"ملغي"})]})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"expected_delivery_date",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(hr,{className:"h-4 w-4 text-orange-600"}),p.jsx("span",{children:"تاريخ التسليم المتوقع"})]}),p.jsx(Xi,{id:"expected_delivery_date",type:"date",value:c.expected_delivery_date,onChange:e=>g("expected_delivery_date",e.target.value),className:"text-right",disabled:l,dir:"rtl"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"actual_delivery_date",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(hr,{className:"h-4 w-4 text-green-600"}),p.jsx("span",{children:"تاريخ التسليم الفعلي"})]}),p.jsx(Xi,{id:"actual_delivery_date",type:"date",value:c.actual_delivery_date,onChange:e=>g("actual_delivery_date",e.target.value),className:"text-right",disabled:l,dir:"rtl"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"priority",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(mr,{className:"h-4 w-4 text-red-600"}),p.jsx("span",{children:"الأولوية"})]}),p.jsxs(el,{value:c.priority,onValueChange:e=>g("priority",e),disabled:l,dir:"rtl",children:[p.jsx(al,{className:"text-right bg-background border-input text-foreground",children:p.jsx(nl,{className:"text-muted-foreground"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"1",children:"عالية (1)"}),p.jsx(dl,{value:"2",children:"متوسطة (2)"}),p.jsx(dl,{value:"3",children:"منخفضة (3)"})]})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"material_type",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(ur,{className:"h-4 w-4 text-purple-600"}),p.jsx("span",{children:"نوع المادة"})]}),p.jsx(Xi,{id:"material_type",value:c.material_type,onChange:e=>g("material_type",e.target.value),placeholder:"مثال: زيركونيا، بورسلين، أكريل",className:"text-right",disabled:l,dir:"rtl"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"color_shade",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(Qr,{className:"h-4 w-4 text-blue-600"}),p.jsx("span",{children:"درجة اللون"})]}),p.jsx(Xi,{id:"color_shade",value:c.color_shade,onChange:e=>g("color_shade",e.target.value),placeholder:"مثال: A1، B2، C3",className:"text-right",disabled:l,dir:"rtl"})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"lab_instructions",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(Pr,{className:"h-4 w-4 text-indigo-600"}),p.jsx("span",{children:"تعليمات للمختبر"})]}),p.jsx(Ji,{id:"lab_instructions",value:c.lab_instructions,onChange:e=>g("lab_instructions",e.target.value),placeholder:"تعليمات خاصة للمختبر...",className:"text-right min-h-[80px] resize-none",disabled:l,dir:"rtl"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"notes",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[p.jsx(Pr,{className:"h-4 w-4 text-gray-600"}),p.jsx("span",{children:"ملاحظات"})]}),p.jsx(Ji,{id:"notes",value:c.notes,onChange:e=>g("notes",e.target.value),placeholder:"أي ملاحظات إضافية حول الطلب...",disabled:l,rows:3,className:"text-right",dir:"rtl"})]}),p.jsxs(qi,{className:"flex flex-row-reverse gap-2 pt-4",dir:"rtl",children:[p.jsx(Qi,{type:"submit",disabled:l,className:"min-w-[100px]",children:l?p.jsxs(p.Fragment,{children:[p.jsx(Hr,{className:"w-4 h-4 ml-2 animate-spin"}),n?"جاري التحديث...":"جاري الإضافة..."]}):n?"تحديث":"إضافة"}),p.jsx(Qi,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:l,children:"إلغاء"})]})]})]})})}function m$({open:e,onOpenChange:t,labOrder:n}){var a;const{deleteLabOrder:s,isLoading:r}=Th();if(!n)return null;return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"sm:max-w-[500px]",dir:"rtl",children:[p.jsxs(Vi,{dir:"rtl",children:[p.jsxs(Ui,{className:"flex items-center gap-2 text-destructive text-right",children:[p.jsx(sr,{className:"h-5 w-5"}),"تأكيد حذف طلب المختبر"]}),p.jsx(Hi,{className:"text-right",children:"هذا الإجراء لا يمكن التراجع عنه. سيتم حذف طلب المختبر نهائياً من النظام."})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(ur,{className:"h-4 w-4 text-blue-600"}),p.jsx("span",{className:"font-semibold",children:"المختبر:"}),p.jsx("span",{children:(null==(a=n.lab)?void 0:a.name)||"غير محدد"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Qr,{className:"h-4 w-4 text-purple-600"}),p.jsx("span",{className:"font-semibold",children:"اسم الخدمة:"}),p.jsx("span",{children:n.service_name})]}),n.patient&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Ai,{className:"h-4 w-4 text-green-600"}),p.jsx("span",{className:"font-semibold",children:"المريض:"}),p.jsx("span",{children:n.patient.full_name})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Er,{className:"h-4 w-4 text-green-600"}),p.jsx("span",{className:"font-semibold",children:"التكلفة:"}),p.jsx("span",{className:"font-bold",children:ca(n.cost)})]}),n.paid_amount&&n.paid_amount>0&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Er,{className:"h-4 w-4 text-blue-600"}),p.jsx("span",{className:"font-semibold",children:"المبلغ المدفوع:"}),p.jsx("span",{className:"font-bold",children:ca(n.paid_amount)})]}),n.remaining_balance&&n.remaining_balance>0&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Er,{className:"h-4 w-4 text-red-600"}),p.jsx("span",{className:"font-semibold",children:"المبلغ المتبقي:"}),p.jsx("span",{className:"font-bold text-red-600",children:ca(n.remaining_balance)})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(hr,{className:"h-4 w-4 text-gray-600"}),p.jsx("span",{className:"font-semibold",children:"تاريخ الطلب:"}),p.jsx("span",{children:ma(n.order_date)})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"font-semibold",children:"الحالة:"}),(e=>{switch(e){case"معلق":return p.jsx(qo,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"معلق"});case"مكتمل":return p.jsx(qo,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"مكتمل"});case"ملغي":return p.jsx(qo,{variant:"destructive",children:"ملغي"});default:return p.jsx(qo,{variant:"outline",children:e})}})(n.status)]}),n.notes&&p.jsxs("div",{className:"space-y-1",children:[p.jsx("span",{className:"font-semibold",children:"الملاحظات:"}),p.jsx("p",{className:"text-sm text-muted-foreground bg-background p-2 rounded border",children:n.notes})]})]}),n.paid_amount&&n.paid_amount>0&&p.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[p.jsxs("div",{className:"flex items-center gap-2 text-yellow-800 dark:text-yellow-200 mb-2",children:[p.jsx(sr,{className:"h-4 w-4"}),p.jsx("span",{className:"font-semibold",children:"تحذير"})]}),p.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:["هذا الطلب يحتوي على مدفوعات بقيمة ",ca(n.paid_amount),". حذف الطلب لن يؤثر على سجلات المدفوعات الأخرى في النظام."]})]}),p.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:p.jsxs("p",{className:"text-sm text-red-800 dark:text-red-200",children:[p.jsx("strong",{children:"هل أنت متأكد من رغبتك في حذف طلب المختبر هذا؟"}),p.jsx("span",{className:"block mt-1",children:"سيتم حذف جميع المعلومات المرتبطة بهذا الطلب نهائياً."})]})})]}),p.jsxs(qi,{className:"gap-2",dir:"rtl",children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:r,children:"إلغاء"}),p.jsx(Qi,{type:"button",variant:"destructive",onClick:()=>m(this,null,function*(){try{yield s(n.id),rc.success("تم حذف طلب المختبر بنجاح"),t(!1)}catch(e){console.error("Error deleting lab order:",e),rc.error("فشل في حذف طلب المختبر")}}),disabled:r,className:"min-w-[100px]",children:r?p.jsxs(p.Fragment,{children:[p.jsx(Hr,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري الحذف..."]}):p.jsxs(p.Fragment,{children:[p.jsx(sr,{className:"w-4 h-4 ml-2"}),"حذف نهائياً"]})})]})]})})}function p$(){const{labs:e,loadLabs:t,isLoading:n}=i$(),{labOrders:a,filteredLabOrders:s,totalOrders:r,totalCost:i,totalPaid:l,totalRemaining:c,pendingOrders:u,completedOrders:h,cancelledOrders:x,loadLabOrders:g,setSearchQuery:f,setStatusFilter:v,setLabFilter:y,setDateRangeFilter:b,clearFilters:j,isLoading:w}=Th(),{patients:N,loadPatients:_}=cl(),k=Bd({data:a,dateField:"order_date",initialFilter:{preset:"all",startDate:"",endDate:""}}),[S,D]=ve.useState(""),[$,C]=ve.useState("all"),[E,T]=ve.useState("all"),[A,F]=ve.useState({start:"",end:""}),[P,O]=ve.useState(!1),[R,M]=ve.useState(!1),[L,I]=ve.useState(!1),[z,B]=ve.useState(!1),[Y,V]=ve.useState(!1),[q,U]=ve.useState(null),[H,G]=ve.useState(null),[W,K]=ve.useState(null),[Z,Q]=ve.useState(null),[X,J]=ve.useState("orders");wd(),ve.useEffect(()=>{(()=>{m(this,null,function*(){try{yield t(),yield g(),yield _()}catch(e){console.error("Error loading data:",e)}})})()},[t,g,_]),ve.useEffect(()=>{"orders"===X&&f(S)},[S,X,f]),ve.useEffect(()=>{v($)},[$,v]),ve.useEffect(()=>{y(E)},[E,y]),ve.useEffect(()=>{b(A)},[A,b]);return p.jsxs("div",{className:"space-y-6 p-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",dir:"rtl",children:[p.jsxs("div",{className:"text-right",children:[p.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"إدارة المختبرات"}),p.jsx("p",{className:"text-muted-foreground",children:"إدارة المختبرات وطلبات التحاليل والفحوصات"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){try{yield Promise.all([t(),g(),_()]),rc.success("تم تحديث البيانات بنجاح")}catch(e){rc.error("فشل في تحديث البيانات")}}),disabled:n||w,children:[p.jsx(mi,{className:"w-4 h-4 mr-2 "+(n||w?"animate-spin":"")}),"تحديث"]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>m(this,null,function*(){try{let t="";if("orders"===X){t=["رقم الطلب","اسم المختبر","اسم الخدمة/التحليل","اسم المريض","التكلفة","المبلغ المدفوع","المبلغ المتبقي","تاريخ الطلب","الحالة","الملاحظات"].join(",")+"\n",s.forEach((e,n)=>{var a,s;const r=[n+1,`"${(null==(a=e.lab)?void 0:a.name)||"غير محدد"}"`,`"${e.service_name}"`,`"${(null==(s=e.patient)?void 0:s.full_name)||"غير محدد"}"`,e.cost,e.paid_amount||0,e.remaining_balance||0,ma(e.order_date),`"${e.status}"`,`"${e.notes||""}"`];t+=r.join(",")+"\n"})}else{t=["اسم المختبر","معلومات الاتصال","العنوان","عدد الطلبات","تاريخ الإضافة"].join(",")+"\n",e.forEach(e=>{const n=a.filter(t=>t.lab_id===e.id).length,s=[`"${e.name}"`,`"${e.contact_info||""}"`,`"${e.address||""}"`,n,ma(e.created_at)];t+=s.join(",")+"\n"})}"orders"===X?yield ic.exportLabsToExcel(e,s):yield ic.exportLabsToExcel(e,a),rc.success("تم تصدير البيانات بنجاح إلى ملف Excel مع التنسيق الجميل")}catch(t){console.error("Export error:",t),rc.error("فشل في تصدير البيانات")}}),children:[p.jsx(Tr,{className:"w-4 h-4 mr-2"}),"تصدير اكسل"]})]})]}),p.jsx(zd,{value:k.timeFilter,onChange:k.handleFilterChange,onClear:k.resetFilter,title:"فلترة زمنية - طلبات المختبرات",defaultOpen:!1}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",dir:"rtl",children:[p.jsxs(Lo,{className:vd("blue"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"إجمالي الطلبات":"الطلبات المفلترة"}),p.jsx(Qr,{className:`h-4 w-4 ${yd("blue")}`})]}),p.jsxs(Yo,{className:"text-right",children:[p.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?a.length:k.filteredData.length}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"طلبات إجمالية":"طلبات في الفترة المحددة"}),k.trend&&p.jsx("div",{className:"text-xs flex items-center mt-1 "+(k.trend.isPositive?"text-green-600":"text-red-600"),children:p.jsxs("span",{children:[Math.abs(k.trend.changePercent),"% من الفترة السابقة"]})})]})]}),p.jsxs(Lo,{className:vd("green"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"إجمالي التكلفة":"التكلفة المفلترة"}),p.jsx(Er,{className:`h-4 w-4 ${yd("green")}`})]}),p.jsxs(Yo,{className:"text-right",children:[p.jsx("div",{className:"text-2xl font-bold text-foreground",children:ca("all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?i:k.filteredData.reduce((e,t)=>e+(t.cost||0),0))}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"تكلفة جميع الطلبات":"تكلفة الطلبات في الفترة المحددة"}),k.trend&&p.jsx("div",{className:"text-xs flex items-center mt-1 "+(k.trend.isPositive?"text-green-600":"text-red-600"),children:p.jsxs("span",{children:[Math.abs(k.trend.changePercent),"% من الفترة السابقة"]})})]})]}),p.jsxs(Lo,{className:vd("purple"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"إجمالي الدفعات":"الدفعات المفلترة"}),p.jsx(gr,{className:`h-4 w-4 ${yd("purple")}`})]}),p.jsxs(Yo,{className:"text-right",children:[p.jsx("div",{className:"text-2xl font-bold text-foreground",children:ca("all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?l:k.filteredData.reduce((e,t)=>e+(t.paid_amount||0),0))}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"جميع الدفعات المسجلة":"دفعات في الفترة المحددة"})]})]}),p.jsxs(Lo,{className:vd("orange"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"الدفعات المتبقية":"المتبقية المفلترة"}),p.jsx(sr,{className:`h-4 w-4 ${yd("orange")}`})]}),p.jsxs(Yo,{className:"text-right",children:[p.jsx("div",{className:"text-2xl font-bold text-foreground",children:ca("all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?c:k.filteredData.reduce((e,t)=>e+(t.remaining_balance||0),0))}),p.jsx("p",{className:"text-xs text-muted-foreground",children:`${"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?a.filter(e=>(e.remaining_balance||0)>0).length:k.filteredData.filter(e=>(e.remaining_balance||0)>0).length} طلب غير مكتمل الدفع`})]})]}),p.jsxs(Lo,{className:vd("yellow"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"طلبات معلقة":"طلبات معلقة مفلترة"}),p.jsx(Sr,{className:`h-4 w-4 ${yd("yellow")}`})]}),p.jsxs(Yo,{className:"text-right",children:[p.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?u:k.filteredData.filter(e=>"معلق"===e.status).length}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"في انتظار الإنجاز":"معلقة في الفترة المحددة"})]})]}),p.jsxs(Lo,{className:vd("emerald"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[p.jsx(zo,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"طلبات مكتملة":"طلبات مكتملة مفلترة"}),p.jsx(gr,{className:`h-4 w-4 ${yd("emerald")}`})]}),p.jsxs(Yo,{className:"text-right",children:[p.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?h:k.filteredData.filter(e=>"مكتمل"===e.status).length}),p.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===k.timeFilter.preset||!k.timeFilter.startDate&&!k.timeFilter.endDate?"تم إنجازها بنجاح":"مكتملة في الفترة المحددة"})]})]})]}),p.jsxs(iu,{value:X,onValueChange:J,className:"space-y-4",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",dir:"rtl",children:[p.jsxs(lu,{className:"grid w-fit grid-cols-2",children:[p.jsxs(ou,{value:"orders",className:"flex items-center gap-2",children:[p.jsx(Qr,{className:"w-4 h-4"}),"طلبات المختبرات"]}),p.jsxs(ou,{value:"labs",className:"flex items-center gap-2",children:[p.jsx(ur,{className:"w-4 h-4"}),"إدارة المختبرات"]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:["orders"===X&&p.jsxs(Qi,{onClick:()=>{K(null),I(!0)},children:[p.jsx(di,{className:"w-4 h-4 mr-2"}),"طلب جديد"]}),"labs"===X&&p.jsxs(Qi,{onClick:()=>{U(null),M(!0)},children:[p.jsx(di,{className:"w-4 h-4 mr-2"}),"مختبر جديد"]})]})]}),p.jsxs("div",{className:"space-y-4",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center gap-4",dir:"rtl",children:[p.jsxs("div",{className:"relative flex-1",children:[p.jsx(hi,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{placeholder:"orders"===X?"البحث في طلبات المختبرات...":"البحث في المختبرات...",value:S,onChange:e=>D(e.target.value),className:"pr-10 text-right",dir:"rtl"})]}),"orders"===X&&p.jsx(Md,{open:P,onOpenChange:O,children:p.jsx(Ld,{asChild:!0,children:p.jsxs(Qi,{variant:"outline",size:"sm",children:[p.jsx(Or,{className:"w-4 h-4 mr-2"}),"تصفية",p.jsx(vr,{className:"w-4 h-4 ml-2 transition-transform "+(P?"rotate-180":"")})]})})}),($||E||A.start||A.end)&&p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>{D(""),C("all"),T("all"),F({start:"",end:""}),j()},children:[p.jsx(Mi,{className:"w-4 h-4 mr-2"}),"مسح التصفية"]})]}),"orders"===X&&p.jsx(Md,{open:P,onOpenChange:O,children:p.jsx(Id,{className:"space-y-4",dir:"rtl",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-muted/50 rounded-lg",dir:"rtl",children:[p.jsxs("div",{className:"space-y-2 text-right",children:[p.jsx("label",{className:"text-sm font-medium",children:"الحالة"}),p.jsxs(el,{value:$,onValueChange:C,dir:"rtl",children:[p.jsx(al,{className:"text-right",children:p.jsx(nl,{placeholder:"جميع الحالات"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الحالات"}),p.jsx(dl,{value:"معلق",children:"معلق"}),p.jsx(dl,{value:"مكتمل",children:"مكتمل"}),p.jsx(dl,{value:"ملغي",children:"ملغي"})]})]})]}),p.jsxs("div",{className:"space-y-2 text-right",children:[p.jsx("label",{className:"text-sm font-medium",children:"المختبر"}),p.jsxs(el,{value:E,onValueChange:T,dir:"rtl",children:[p.jsx(al,{className:"text-right",children:p.jsx(nl,{placeholder:"جميع المختبرات"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع المختبرات"}),e.map(e=>p.jsx(dl,{value:e.id,children:e.name},e.id))]})]})]}),p.jsxs("div",{className:"space-y-2 text-right",children:[p.jsx("label",{className:"text-sm font-medium",children:"من تاريخ"}),p.jsx(Xi,{type:"date",value:A.start,onChange:e=>F(t=>d(o({},t),{start:e.target.value})),className:"text-right",dir:"rtl"})]}),p.jsxs("div",{className:"space-y-2 text-right",children:[p.jsx("label",{className:"text-sm font-medium",children:"إلى تاريخ"}),p.jsx(Xi,{type:"date",value:A.end,onChange:e=>F(t=>d(o({},t),{end:e.target.value})),className:"text-right",dir:"rtl"})]})]})})})]}),p.jsx(du,{value:"orders",className:"space-y-4",dir:"rtl",children:p.jsxs(Lo,{children:[p.jsxs(Io,{dir:"rtl",children:[p.jsxs(zo,{className:"flex items-center gap-2 text-right",children:[p.jsx(Qr,{className:"w-5 h-5"}),"طلبات المختبرات"]}),p.jsx(Bo,{className:"text-right",children:"إدارة جميع طلبات التحاليل والفحوصات المرسلة للمختبرات"})]}),p.jsx(Yo,{children:p.jsx(c$,{labOrders:s,onEdit:e=>{K(e),I(!0)},onDelete:e=>{Q(e),V(!0)}})})]})}),p.jsx(du,{value:"labs",className:"space-y-4",dir:"rtl",children:p.jsxs(Lo,{children:[p.jsxs(Io,{dir:"rtl",children:[p.jsxs(zo,{className:"flex items-center gap-2 text-right",children:[p.jsx(ur,{className:"w-5 h-5"}),"إدارة المختبرات"]}),p.jsx(Bo,{className:"text-right",children:"إدارة معلومات المختبرات المتعاونة"})]}),p.jsx(Yo,{children:p.jsx(l$,{labs:e,onEdit:e=>{U(e),M(!0)},onDelete:e=>{G(e),B(!0)},searchQuery:S})})]})})]}),p.jsx(o$,{open:R,onOpenChange:()=>{M(!1),U(null)},editingLab:q}),p.jsx(d$,{open:z,onOpenChange:()=>{B(!1),G(null)},lab:H}),p.jsx(u$,{open:L,onOpenChange:()=>{I(!1),K(null)},editingOrder:W}),p.jsx(m$,{open:Y,onOpenChange:()=>{V(!1),Q(null)},labOrder:Z})]})}function h$({medications:e,onEdit:t,onDelete:n,searchQuery:a}){const{isLoading:s}=Af(),r=e.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())||e.instructions&&e.instructions.toLowerCase().includes(a.toLowerCase()));return s?p.jsx("div",{className:"flex items-center justify-center py-8",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),p.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل الأدوية..."})]})}):0===r.length?p.jsxs("div",{className:"text-center py-8",children:[p.jsx(li,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground opacity-50"}),p.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد أدوية"}),p.jsx("p",{className:"text-muted-foreground mb-4",children:a?"لم يتم العثور على أدوية تطابق البحث":"لم يتم إضافة أي أدوية بعد"}),!a&&p.jsxs(Qi,{onClick:()=>t({}),children:[p.jsx(li,{className:"w-4 h-4 ml-2"}),"إضافة دواء جديد"]})]}):p.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-center",children:"#"}),p.jsx(tc,{className:"text-center",children:"اسم الدواء"}),p.jsx(tc,{className:"text-center",children:"التعليمات"}),p.jsx(tc,{className:"text-center",children:"تاريخ الإضافة"}),p.jsx(tc,{className:"text-center w-[100px]",children:"الإجراءات"})]})}),p.jsx(Jd,{children:r.map((e,a)=>p.jsxs(ec,{className:"hover:bg-muted/50",children:[p.jsx(nc,{className:"font-medium text-center",children:a+1}),p.jsx(nc,{className:"text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p.jsx(li,{className:"w-4 h-4 text-blue-600"}),p.jsx("span",{className:"font-medium",children:e.name})]})}),p.jsx(nc,{className:"text-center",children:p.jsx("div",{className:"max-w-xs mx-auto",children:e.instructions?p.jsx("div",{className:"text-sm text-muted-foreground",title:e.instructions,children:e.instructions}):p.jsx("span",{className:"text-muted-foreground italic",children:"لا توجد تعليمات"})})}),p.jsx(nc,{className:"text-center",children:p.jsx("div",{className:"text-sm",children:ma(e.created_at)})}),p.jsx(nc,{className:"text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-1",children:[p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>(e=>{t(e)})(e),className:"action-btn-edit action-btn-icon",title:"تعديل الدواء",children:p.jsx(si,{className:"w-4 h-4"})}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>(e=>{n(e)})(e),className:"action-btn-delete action-btn-icon",title:"حذف الدواء",children:p.jsx(Ni,{className:"w-4 h-4"})})]})})]},e.id))})]}),p.jsx("div",{className:"border-t bg-muted/30 px-4 py-3",children:p.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsxs("span",{children:["إجمالي الأدوية: ",r.length]}),a&&p.jsxs("span",{children:["نتائج البحث: ",r.length," من ",e.length]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(li,{className:"w-4 h-4"}),p.jsx("span",{children:"قاعدة بيانات الأدوية"})]})]})})]})}function x$({open:e,onOpenChange:t,editingMedication:n}){const{createMedication:a,updateMedication:s,isLoading:r}=Af(),[i,l]=ve.useState({name:"",instructions:""}),[c,u]=ve.useState({});ve.useEffect(()=>{e&&(l(n?{name:n.name||"",instructions:n.instructions||""}:{name:"",instructions:""}),u({}))},[e,n]);const h=(e,t)=>{l(n=>d(o({},n),{[e]:t})),c[e]&&u(t=>d(o({},t),{[e]:""}))},x=()=>{r||t(!1)};return p.jsx(Ii,{open:e,onOpenChange:x,children:p.jsxs(Yi,{className:"sm:max-w-[500px]",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"flex items-center gap-2 text-right",children:[p.jsx(li,{className:"w-5 h-5 text-blue-600"}),n?"تعديل الدواء":"إضافة دواء جديد"]}),p.jsx(Hi,{className:"text-right",children:n?"قم بتعديل معلومات الدواء أدناه":"أدخل معلومات الدواء الجديد أدناه"})]}),p.jsxs("form",{onSubmit:e=>m(this,null,function*(){if(e.preventDefault(),(()=>{const e={};return i.name.trim()?i.name.trim().length<2&&(e.name="اسم الدواء يجب أن يكون على الأقل حرفين"):e.name="اسم الدواء مطلوب",u(e),0===Object.keys(e).length})())try{const e={name:i.name.trim(),instructions:i.instructions.trim()||void 0};n&&n.id?(yield s(n.id,e),rc.success("تم تحديث الدواء بنجاح")):(yield a(e),rc.success("تم إضافة الدواء بنجاح")),t(!1)}catch(r){console.error("Error saving medication:",r),rc.error(n?"فشل في تحديث الدواء":"فشل في إضافة الدواء")}}),className:"space-y-4",children:[p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"name",className:"text-right block",children:["اسم الدواء ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx(Xi,{id:"name",value:i.name,onChange:e=>h("name",e.target.value),placeholder:"أدخل اسم الدواء",className:"text-right "+(c.name?"border-red-500":""),dir:"rtl",disabled:r}),c.name&&p.jsx("p",{className:"text-sm text-red-500 text-right",children:c.name})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"instructions",className:"text-right block",children:"تعليمات الاستخدام"}),p.jsx(Ji,{id:"instructions",value:i.instructions,onChange:e=>h("instructions",e.target.value),placeholder:"أدخل تعليمات استخدام الدواء (اختياري)",className:"text-right min-h-[100px]",dir:"rtl",disabled:r}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"مثال: قرص واحد كل 8 ساعات بعد الأكل"})]})]}),p.jsxs(qi,{className:"flex justify-end space-x-2 space-x-reverse",children:[p.jsxs(Qi,{type:"button",variant:"outline",onClick:x,disabled:r,children:[p.jsx(Mi,{className:"w-4 h-4 ml-2"}),"إلغاء"]}),p.jsx(Qi,{type:"submit",disabled:r,className:"bg-blue-600 hover:bg-blue-700 text-white",children:r?p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحفظ..."]}):p.jsxs(p.Fragment,{children:[p.jsx(pi,{className:"w-4 h-4 ml-2"}),n?"تحديث":"إضافة"]})})]})]})]})})}function g$({open:e,onOpenChange:t,medication:n}){const{deleteMedication:a,isLoading:s}=Af();return n?p.jsx(Gl,{open:e,onOpenChange:()=>{s||t(!1)},children:p.jsxs(Zl,{dir:"rtl",className:"sm:max-w-[425px]",children:[p.jsxs(Ql,{children:[p.jsxs(Jl,{className:"flex items-center gap-2 text-right",children:[p.jsx(sr,{className:"w-5 h-5 text-red-600"}),"تأكيد حذف الدواء"]}),p.jsxs(eo,{className:"text-right space-y-2",children:[p.jsx("div",{children:"هل أنت متأكد من أنك تريد حذف الدواء التالي؟"}),p.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx(Ni,{className:"w-4 h-4 text-red-600"}),p.jsx("span",{className:"font-medium",children:n.name})]}),n.instructions&&p.jsxs("div",{className:"text-sm text-muted-foreground",children:["التعليمات: ",n.instructions]})]}),p.jsx("div",{className:"text-red-600 font-medium",children:"⚠️ تحذير: هذا الإجراء لا يمكن التراجع عنه"}),p.jsx("div",{className:"text-sm text-muted-foreground",children:"سيتم حذف الدواء نهائياً من النظام. إذا كان هذا الدواء مرتبط بوصفات طبية موجودة، فقد يؤثر ذلك على سجلات المرضى."})]})]}),p.jsxs(Xl,{className:"flex justify-end space-x-2 space-x-reverse",children:[p.jsx(no,{disabled:s,children:"إلغاء"}),p.jsx(to,{onClick:()=>m(this,null,function*(){if(n)try{yield a(n.id),rc.success("تم حذف الدواء بنجاح"),t(!1)}catch(e){console.error("Error deleting medication:",e),rc.error("فشل في حذف الدواء")}}),disabled:s,className:"bg-red-600 hover:bg-red-700 text-white",children:s?p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحذف..."]}):p.jsxs(p.Fragment,{children:[p.jsx(Ni,{className:"w-4 h-4 ml-2"}),"حذف نهائي"]})})]})]})}):null}var[f$,v$]=M("Tooltip",[J]),y$=J(),b$="TooltipProvider",j$=700,w$="tooltip.open",[N$,_$]=f$(b$),k$=e=>{const{__scopeTooltip:t,delayDuration:n=j$,skipDelayDuration:a=300,disableHoverableContent:s=!1,children:r}=e,i=ve.useRef(!0),l=ve.useRef(!1),o=ve.useRef(0);return ve.useEffect(()=>{const e=o.current;return()=>window.clearTimeout(e)},[]),p.jsx(N$,{scope:t,isOpenDelayedRef:i,delayDuration:n,onOpen:ve.useCallback(()=>{window.clearTimeout(o.current),i.current=!1},[]),onClose:ve.useCallback(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(()=>i.current=!0,a)},[a]),isPointerInTransitRef:l,onPointerInTransitChange:ve.useCallback(e=>{l.current=e},[]),disableHoverableContent:s,children:r})};k$.displayName=b$;var S$="Tooltip",[D$,$$]=f$(S$),C$=e=>{const{__scopeTooltip:t,children:n,open:a,defaultOpen:s,onOpenChange:r,disableHoverableContent:i,delayDuration:l}=e,c=_$(S$,e.__scopeTooltip),u=y$(t),[m,h]=ve.useState(null),x=W(),g=ve.useRef(0),f=null!=i?i:c.disableHoverableContent,v=null!=l?l:c.delayDuration,y=ve.useRef(!1),[b,j]=G({prop:a,defaultProp:null!=s&&s,onChange:e=>{e?(c.onOpen(),document.dispatchEvent(new CustomEvent(w$))):c.onClose(),null==r||r(e)},caller:S$}),w=ve.useMemo(()=>b?y.current?"delayed-open":"instant-open":"closed",[b]),N=ve.useCallback(()=>{window.clearTimeout(g.current),g.current=0,y.current=!1,j(!0)},[j]),_=ve.useCallback(()=>{window.clearTimeout(g.current),g.current=0,j(!1)},[j]),k=ve.useCallback(()=>{window.clearTimeout(g.current),g.current=window.setTimeout(()=>{y.current=!0,j(!0),g.current=0},v)},[v,j]);return ve.useEffect(()=>()=>{g.current&&(window.clearTimeout(g.current),g.current=0)},[]),p.jsx(me,d(o({},u),{children:p.jsx(D$,{scope:t,contentId:x,open:b,stateAttribute:w,trigger:m,onTriggerChange:h,onTriggerEnter:ve.useCallback(()=>{c.isOpenDelayedRef.current?k():N()},[c.isOpenDelayedRef,k,N]),onTriggerLeave:ve.useCallback(()=>{f?_():(window.clearTimeout(g.current),g.current=0)},[_,f]),onOpen:N,onClose:_,disableHoverableContent:f,children:n})}))};C$.displayName=S$;var E$="TooltipTrigger",T$=ve.forwardRef((e,t)=>{const n=e,{__scopeTooltip:a}=n,s=c(n,["__scopeTooltip"]),r=$$(E$,a),i=_$(E$,a),l=y$(a),u=ve.useRef(null),m=z(t,u,r.onTriggerChange),h=ve.useRef(!1),x=ve.useRef(!1),g=ve.useCallback(()=>h.current=!1,[]);return ve.useEffect(()=>()=>document.removeEventListener("pointerup",g),[g]),p.jsx(ee,d(o({asChild:!0},l),{children:p.jsx(q.button,d(o({"aria-describedby":r.open?r.contentId:void 0,"data-state":r.stateAttribute},s),{ref:m,onPointerMove:Y(e.onPointerMove,e=>{"touch"!==e.pointerType&&(x.current||i.isPointerInTransitRef.current||(r.onTriggerEnter(),x.current=!0))}),onPointerLeave:Y(e.onPointerLeave,()=>{r.onTriggerLeave(),x.current=!1}),onPointerDown:Y(e.onPointerDown,()=>{r.open&&r.onClose(),h.current=!0,document.addEventListener("pointerup",g,{once:!0})}),onFocus:Y(e.onFocus,()=>{h.current||r.onOpen()}),onBlur:Y(e.onBlur,r.onClose),onClick:Y(e.onClick,r.onClose)}))}))});T$.displayName=E$;var A$="TooltipPortal",[F$,P$]=f$(A$,{forceMount:void 0}),O$=e=>{const{__scopeTooltip:t,forceMount:n,children:a,container:s}=e,r=$$(A$,t);return p.jsx(F$,{scope:t,forceMount:n,children:p.jsx(K,{present:n||r.open,children:p.jsx(ce,{asChild:!0,container:s,children:a})})})};O$.displayName=A$;var R$="TooltipContent",M$=ve.forwardRef((e,t)=>{const n=P$(R$,e.__scopeTooltip),a=e,{forceMount:s=n.forceMount,side:r="top"}=a,i=c(a,["forceMount","side"]),l=$$(R$,e.__scopeTooltip);return p.jsx(K,{present:s||l.open,children:l.disableHoverableContent?p.jsx(Y$,d(o({side:r},i),{ref:t})):p.jsx(L$,d(o({side:r},i),{ref:t}))})}),L$=ve.forwardRef((e,t)=>{const n=$$(R$,e.__scopeTooltip),a=_$(R$,e.__scopeTooltip),s=ve.useRef(null),r=z(t,s),[i,l]=ve.useState(null),{trigger:c,onClose:u}=n,m=s.current,{onPointerInTransitChange:h}=a,x=ve.useCallback(()=>{l(null),h(!1)},[h]),g=ve.useCallback((e,t)=>{const n=e.currentTarget,a={x:e.clientX,y:e.clientY},s=function(e,t,n=5){const a=[];switch(t){case"top":a.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":a.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":a.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":a.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n})}return a}(a,function(e,t){const n=Math.abs(t.top-e.y),a=Math.abs(t.bottom-e.y),s=Math.abs(t.right-e.x),r=Math.abs(t.left-e.x);switch(Math.min(n,a,s,r)){case r:return"left";case s:return"right";case n:return"top";case a:return"bottom";default:throw new Error("unreachable")}}(a,n.getBoundingClientRect())),r=function(e){const t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),function(e){if(e.length<=1)return e.slice();const t=[];for(let a=0;a<e.length;a++){const n=e[a];for(;t.length>=2;){const e=t[t.length-1],a=t[t.length-2];if(!((e.x-a.x)*(n.y-a.y)>=(e.y-a.y)*(n.x-a.x)))break;t.pop()}t.push(n)}t.pop();const n=[];for(let a=e.length-1;a>=0;a--){const t=e[a];for(;n.length>=2;){const e=n[n.length-1],a=n[n.length-2];if(!((e.x-a.x)*(t.y-a.y)>=(e.y-a.y)*(t.x-a.x)))break;n.pop()}n.push(t)}return n.pop(),1===t.length&&1===n.length&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}(t)}([...s,...function(e){const{top:t,right:n,bottom:a,left:s}=e;return[{x:s,y:t},{x:n,y:t},{x:n,y:a},{x:s,y:a}]}(t.getBoundingClientRect())]);l(r),h(!0)},[h]);return ve.useEffect(()=>()=>x(),[x]),ve.useEffect(()=>{if(c&&m){const e=e=>g(e,m),t=e=>g(e,c);return c.addEventListener("pointerleave",e),m.addEventListener("pointerleave",t),()=>{c.removeEventListener("pointerleave",e),m.removeEventListener("pointerleave",t)}}},[c,m,g,x]),ve.useEffect(()=>{if(i){const e=e=>{const t=e.target,n={x:e.clientX,y:e.clientY},a=(null==c?void 0:c.contains(t))||(null==m?void 0:m.contains(t)),s=!function(e,t){const{x:n,y:a}=e;let s=!1;for(let r=0,i=t.length-1;r<t.length;i=r++){const e=t[r],l=t[i],o=e.x,d=e.y,c=l.x,u=l.y;d>a!=u>a&&n<(c-o)*(a-d)/(u-d)+o&&(s=!s)}return s}(n,i);a?x():s&&(x(),u())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[c,m,i,u,x]),p.jsx(Y$,d(o({},e),{ref:r}))}),[I$,z$]=f$(S$,{isInside:!1}),B$=V("TooltipContent"),Y$=ve.forwardRef((e,t)=>{const n=e,{__scopeTooltip:a,children:s,"aria-label":r,onEscapeKeyDown:i,onPointerDownOutside:l}=n,u=c(n,["__scopeTooltip","children","aria-label","onEscapeKeyDown","onPointerDownOutside"]),m=$$(R$,a),h=y$(a),{onClose:x}=m;return ve.useEffect(()=>(document.addEventListener(w$,x),()=>document.removeEventListener(w$,x)),[x]),ve.useEffect(()=>{if(m.trigger){const e=e=>{const t=e.target;(null==t?void 0:t.contains(m.trigger))&&x()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[m.trigger,x]),p.jsx(se,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:l,onFocusOutside:e=>e.preventDefault(),onDismiss:x,children:p.jsxs(re,d(o(o({"data-state":m.stateAttribute},h),u),{ref:t,style:o(o({},u.style),{"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"}),children:[p.jsx(B$,{children:s}),p.jsx(I$,{scope:a,isInside:!0,children:p.jsx(pe,{id:m.contentId,role:"tooltip",children:r||s})})]}))})});M$.displayName=R$;var V$="TooltipArrow";ve.forwardRef((e,t)=>{const n=e,{__scopeTooltip:a}=n,s=c(n,["__scopeTooltip"]),r=y$(a);return z$(V$,a).isInside?null:p.jsx(ie,d(o(o({},r),s),{ref:t}))}).displayName=V$;var q$=O$,U$=M$;const H$=k$,G$=C$,W$=T$,K$=ve.forwardRef((e,t)=>{var n=e,{className:a,sideOffset:s=4}=n,r=c(n,["className","sideOffset"]);return p.jsx(q$,{children:p.jsx(U$,o({ref:t,sideOffset:s,className:aa("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",a)},r))})});function Z$({open:e,onOpenChange:t,prescription:n}){var a,s,r;const{settings:i,loadSettings:l}=qt(),c=Ud(),u=Hd(),h=Gd();Wd();const x=ve.useRef(null);ve.useEffect(()=>{e&&!i&&l()},[e,i,l]);const[g,f]=ve.useState({printerType:"80mm",includeQR:!0,includeBarcode:!0,includeLogo:!0,colorMode:"color",qrType:"text"}),[v,y]=ve.useState(!0),[b,j]=ve.useState(""),[w,N]=ve.useState(""),_=()=>m(this,null,function*(){try{const e=(()=>{var e,t,a;const s=`PRX-${n.id.slice(-6)}`,r=(null==(e=n.patient)?void 0:e.full_name)||"غير محدد",i=ma(n.prescription_date),l=(null==(t=n.medications)?void 0:t.length)||0;return`🏥 ${c}\n${u?`👨‍⚕️ د. ${u}`:""}\n📋 وصفة طبية رقم: ${s}\n👤 المريض: ${r}\n📅 التاريخ: ${i}\n💊 عدد الأدوية: ${l}\n${(null==(a=n.medications)?void 0:a.map((e,t)=>`${t+1}. ${e.medication_name} - ${e.dose}`).join("\n"))||""}\n${n.notes?`📝 ملاحظات: ${n.notes}`:""}\n\nشكراً لثقتكم بنا 🙏`})(),t=yield gt.toDataURL(e,{width:150,margin:1,color:{dark:"#000000",light:"#FFFFFF"}});j(t)}catch(e){console.error("Error generating QR code:",e)}});ve.useEffect(()=>{e&&(g.includeQR&&_(),g.includeBarcode&&(()=>{try{const e=document.createElement("canvas"),t=k();ft(e,t,{format:"CODE128",width:2,height:40,displayValue:!1,margin:0}),N(e.toDataURL())}catch(e){console.error("Error generating barcode:",e)}})())},[e,g.includeQR,g.includeBarcode,n,i]);const k=()=>{var e;return`PRX${new Date(n.prescription_date).getTime().toString().slice(-8)}${n.patient_id.slice(-4)}${((null==(e=n.medications)?void 0:e.length)||0).toString().padStart(2,"0")}`},S=()=>{if(x.current){const e=window.open("","_blank");if(e){const t="color"===g.colorMode,a="a4"===g.printerType?"210mm":g.printerType;e.document.write(`\n          <html>\n            <head>\n              <title>وصفة طبية - ${n.id.slice(-6)}</title>\n              <style>\n                body {\n                  font-family: 'Arial', 'Tahoma', sans-serif;\n                  direction: rtl;\n                  margin: 0;\n                  padding: 0;\n                  font-size: ${"a4"===g.printerType?"14px":"12px"};\n                  line-height: 1.4;\n                  color: #000;\n                  background: white;\n                }\n\n                .receipt {\n                  width: ${"a4"===a?"100%":a};\n                  max-width: ${"a4"===a?"210mm":a};\n                  margin: 0 auto;\n                  background: white;\n                  font-size: ${"a4"===g.printerType?"12px":"11px"};\n                  padding: ${"a4"===g.printerType?"20px":"0"};\n                }\n\n                .header {\n                  text-align: center;\n                  margin-bottom: 15px;\n                  border-bottom: 2px solid #000;\n                  padding-bottom: 10px;\n                }\n\n                .clinic-logo {\n                  width: ${"a4"===g.printerType?"60px":"45px"};\n                  height: ${"a4"===g.printerType?"60px":"45px"};\n                  margin: 0 auto 6px;\n                  border-radius: 50%;\n                  overflow: hidden;\n                  border: 2px solid #e0e0e0;\n                  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n                  flex-shrink: 0;\n                }\n\n                .clinic-logo img {\n                  width: 100%;\n                  height: 100%;\n                  object-fit: cover;\n                  border-radius: 50%;\n                  max-width: ${"a4"===g.printerType?"60px":"45px"};\n                  max-height: ${"a4"===g.printerType?"60px":"45px"};\n                }\n\n                .clinic-name {\n                  font-size: ${"a4"===g.printerType?"18px":"16px"};\n                  font-weight: bold;\n                  margin-bottom: 5px;\n                  color: ${t?"#2563eb":"#000"};\n                }\n\n                .doctor-name {\n                  font-size: ${"a4"===g.printerType?"14px":"12px"};\n                  font-weight: bold;\n                  margin-bottom: 3px;\n                  color: ${t?"#059669":"#000"};\n                }\n\n                .prescription-title {\n                  font-size: ${"a4"===g.printerType?"16px":"14px"};\n                  font-weight: bold;\n                  margin: 10px 0;\n                  text-decoration: underline;\n                  color: ${t?"#dc2626":"#000"};\n                }\n\n                .section {\n                  margin: 10px 0;\n                  padding: 5px 0;\n                }\n\n                .patient-info {\n                  border: 2px solid #000;\n                  padding: 10px;\n                  margin: 10px 0;\n                  background: ${t?"#f8fafc":"white"};\n                }\n\n                .medications-list {\n                  border: 2px solid #000;\n                  padding: 10px;\n                  margin: 10px 0;\n                  background: ${t?"#fefce8":"white"};\n                }\n\n                .medication-item {\n                  margin: 8px 0;\n                  padding: 5px 0;\n                  border-bottom: 1px dotted #666;\n                }\n\n                .medication-item:last-child {\n                  border-bottom: none;\n                }\n\n                .medication-name {\n                  font-weight: bold;\n                  font-size: ${"a4"===g.printerType?"13px":"11px"};\n                  color: ${t?"#1e40af":"#000"};\n                }\n\n                .medication-dose {\n                  font-size: ${"a4"===g.printerType?"11px":"10px"};\n                  color: #333;\n                  margin-top: 2px;\n                }\n\n                .separator {\n                  text-align: center;\n                  margin: 10px 0;\n                  font-size: 12px;\n                }\n\n                .footer {\n                  text-align: center;\n                  margin-top: 15px;\n                  padding-top: 10px;\n                  border-top: 1px solid #000;\n                  font-size: ${"a4"===g.printerType?"10px":"9px"};\n                }\n\n                .bottom-section {\n                  display: flex;\n                  justify-content: space-between;\n                  align-items: flex-start;\n                  margin: 15px 0;\n                  gap: 20px;\n                  flex-wrap: wrap;\n                }\n\n                .qr-section, .barcode-section {\n                  text-align: center;\n                  margin: 10px 0;\n                  flex: 1;\n                  min-width: 100px;\n                }\n\n                .signature-section {\n                  flex: 1;\n                  min-width: 120px;\n                  text-align: center;\n                }\n\n                .signature-line {\n                  width: ${"a4"===g.printerType?"120px":"100px"};\n                  height: 1px;\n                  border-bottom: 1px solid #333;\n                  margin: 0 auto 4px;\n                }\n\n                .signature-label {\n                  font-size: ${"a4"===g.printerType?"11px":"9px"};\n                  color: #666;\n                  margin-bottom: 6px;\n                }\n\n                .stamp-area {\n                  width: ${"a4"===g.printerType?"90px":"70px"};\n                  height: ${"a4"===g.printerType?"70px":"55px"};\n                  border: 2px dashed #999;\n                  border-radius: 50%;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  margin: 0 auto;\n                  background: rgba(0,0,0,0.02);\n                }\n\n                .stamp-placeholder {\n                  font-size: ${"a4"===g.printerType?"10px":"8px"};\n                  color: #999;\n                  text-align: center;\n                  line-height: 1.2;\n                }\n\n                .notes {\n                  border: 2px solid #000;\n                  padding: 10px;\n                  margin: 10px 0;\n                  font-style: italic;\n                  background: ${t?"#fef3c7":"white"};\n                }\n\n                @media print {\n                  body { margin: 0; }\n                  .receipt { box-shadow: none; }\n                }\n\n                @media screen {\n                  body {\n                    padding: 20px;\n                    background: #f5f5f5;\n                  }\n\n                  .receipt {\n                    max-width: ${"a4"===g.printerType?"600px":"320px"};\n                    box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n                    border-radius: 12px;\n                    overflow: hidden;\n                    background: white;\n                    margin: 0 auto;\n                  }\n                }\n              </style>\n            </head>\n            <body>\n              ${x.current.innerHTML}\n            </body>\n          </html>\n        `),e.document.close(),e.print()}}};return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"flex items-center gap-2 text-right",children:[p.jsx(Pr,{className:"w-5 h-5 text-green-600"}),"طباعة الوصفة الطبية"]}),p.jsxs(Hi,{className:"text-right",children:["معاينة وطباعة الوصفة الطبية للمريض ",null==(a=n.patient)?void 0:a.full_name]})]}),p.jsxs("div",{className:"border-t bg-muted/30 p-4 space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("h3",{className:"text-sm font-medium flex items-center",children:[p.jsx(xi,{className:"w-4 h-4 ml-2"}),"إعدادات الطباعة"]}),p.jsxs(Qi,{variant:"ghost",size:"sm",onClick:()=>y(!v),className:"text-xs",children:[p.jsx(Fr,{className:"w-3 h-3 ml-1"}),v?"إخفاء المعاينة":"معاينة"]})]}),p.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[p.jsxs("div",{className:"space-y-1",children:[p.jsx("label",{className:"text-xs font-medium",children:"نوع الطابعة"}),p.jsxs(el,{value:g.printerType,onValueChange:e=>f(t=>d(o({},t),{printerType:e})),children:[p.jsx(al,{className:"h-8 text-xs",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"58mm",children:"حرارية 58mm"}),p.jsx(dl,{value:"80mm",children:"حرارية 80mm"}),p.jsx(dl,{value:"a4",children:"عادية A4"})]})]})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsx("label",{className:"text-xs font-medium",children:"نمط الألوان"}),p.jsxs(el,{value:g.colorMode,onValueChange:e=>f(t=>d(o({},t),{colorMode:e})),children:[p.jsx(al,{className:"h-8 text-xs",children:p.jsx(nl,{})}),p.jsxs(il,{children:[p.jsx(dl,{value:"color",children:"ملون"}),p.jsx(dl,{value:"bw",children:"أبيض وأسود"})]})]})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("input",{type:"checkbox",id:"includeLogo",checked:g.includeLogo,onChange:e=>f(t=>d(o({},t),{includeLogo:e.target.checked})),className:"rounded border-gray-300"}),p.jsx("label",{htmlFor:"includeLogo",className:"text-xs font-medium",children:"تضمين الشعار"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("input",{type:"checkbox",id:"includeQR",checked:g.includeQR,onChange:e=>f(t=>d(o({},t),{includeQR:e.target.checked})),className:"rounded border-gray-300"}),p.jsx("label",{htmlFor:"includeQR",className:"text-xs font-medium",children:"QR Code"})]})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("input",{type:"checkbox",id:"includeBarcode",checked:g.includeBarcode,onChange:e=>f(t=>d(o({},t),{includeBarcode:e.target.checked})),className:"rounded border-gray-300"}),p.jsx("label",{htmlFor:"includeBarcode",className:"text-xs font-medium",children:"تضمين الباركود"})]})]}),v&&p.jsx("div",{className:"border rounded-lg p-4 bg-gray-50 max-h-96 overflow-y-auto",children:p.jsxs("div",{ref:x,className:"receipt bg-white p-4 mx-auto",style:{maxWidth:"a4"===g.printerType?"600px":"320px",fontFamily:"Arial, Tahoma, sans-serif",direction:"rtl"},children:[p.jsxs("div",{className:"header text-center mb-4 pb-3 border-b-2 border-black",children:[g.includeLogo&&h&&""!==h.trim()&&p.jsx("div",{className:"clinic-logo mb-3",style:{width:"a4"===g.printerType?"60px":"45px",height:"a4"===g.printerType?"60px":"45px",margin:"0 auto 8px",borderRadius:"50%",overflow:"hidden",border:"2px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",flexShrink:0},children:p.jsx("img",{src:h,alt:"شعار العيادة",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%",maxWidth:"a4"===g.printerType?"60px":"45px",maxHeight:"a4"===g.printerType?"60px":"45px"},onError:e=>{console.log("Prescription logo failed to load:",h),e.currentTarget.style.display="none"}})}),c&&p.jsx("div",{className:"clinic-name text-lg font-bold mb-2 text-blue-600",children:c}),u&&p.jsxs("div",{className:"doctor-name text-sm font-bold mb-1 text-green-600",children:["د. ",u]}),p.jsx("div",{className:"prescription-title text-base font-bold mt-3 text-red-600 underline",children:"وصفة طبية"})]}),p.jsxs("div",{className:"section mb-3",children:[p.jsxs("div",{className:"text-sm text-center",children:[p.jsx("strong",{children:"رقم الوصفة:"})," PRX-",n.id.slice(-6)]}),p.jsxs("div",{className:"text-sm text-center",children:[p.jsx("strong",{children:"التاريخ:"})," ",ma(n.prescription_date)]})]}),p.jsxs("div",{className:"patient-info border-2 border-black p-3 mb-3 bg-blue-50",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx(Ai,{className:"w-4 h-4 text-blue-600"}),p.jsx("span",{className:"font-bold",children:"معلومات المريض"})]}),p.jsxs("div",{className:"text-sm",children:[p.jsx("strong",{children:"الاسم:"})," ",(null==(s=n.patient)?void 0:s.full_name)||"غير محدد"]}),n.appointment&&p.jsxs("div",{className:"text-sm mt-1",children:[p.jsx("strong",{children:"الموعد:"})," ",n.appointment.title]})]}),p.jsxs("div",{className:"medications-list border-2 border-black p-3 mb-3 bg-yellow-50",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[p.jsx(li,{className:"w-4 h-4 text-orange-600"}),p.jsxs("span",{className:"font-bold",children:["الأدوية الموصوفة (",(null==(r=n.medications)?void 0:r.length)||0,")"]})]}),n.medications&&n.medications.length>0?n.medications.map((e,t)=>p.jsxs("div",{className:"medication-item mb-2 pb-2 border-b border-dotted border-gray-400 last:border-b-0",children:[p.jsxs("div",{className:"medication-name font-bold text-blue-800",children:[t+1,". ",e.medication_name]}),e.dose&&p.jsxs("div",{className:"medication-dose text-sm text-gray-600 mt-1",children:["الجرعة: ",e.dose]})]},t)):p.jsx("div",{className:"text-sm text-gray-500 italic",children:"لا توجد أدوية موصوفة"})]}),n.notes&&p.jsxs("div",{className:"notes border-2 border-black p-3 mb-3 bg-yellow-100",children:[p.jsx("div",{className:"font-bold mb-2",children:"ملاحظات الطبيب:"}),p.jsx("div",{className:"text-sm italic",children:n.notes})]}),p.jsxs("div",{className:"bottom-section flex justify-between items-start mb-4 gap-4 flex-wrap",children:[g.includeQR&&p.jsxs("div",{className:"qr-section text-center flex-1 min-w-[100px]",children:[b?p.jsx("img",{src:b,alt:"رمز QR للوصفة الطبية",style:{width:"a4"===g.printerType?"100px":"80px",height:"a4"===g.printerType?"100px":"80px",margin:"0 auto"}}):p.jsx("div",{className:"qr-placeholder bg-gray-200 p-4 text-sm",children:"رمز QR"}),p.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"امسح الرمز لعرض تفاصيل الوصفة"})]}),p.jsxs("div",{className:"signature-section text-center flex-1 min-w-[120px]",children:[p.jsxs("div",{className:"signature-box mb-3",children:[p.jsx("div",{className:"signature-line mx-auto mb-2",style:{width:"a4"===g.printerType?"120px":"100px",height:"1px",borderBottom:"1px solid #333"}}),p.jsx("div",{className:"signature-label text-gray-600 mb-3",style:{fontSize:"a4"===g.printerType?"11px":"9px"},children:"توقيع الطبيب"})]}),p.jsx("div",{className:"stamp-box",children:p.jsx("div",{className:"stamp-area border-2 border-dashed border-gray-400 rounded-full flex items-center justify-center mx-auto bg-gray-50",style:{width:"a4"===g.printerType?"90px":"70px",height:"a4"===g.printerType?"70px":"55px"},children:p.jsx("div",{className:"stamp-placeholder text-gray-500 text-center leading-tight",style:{fontSize:"a4"===g.printerType?"10px":"8px"},children:"ختم العيادة"})})})]})]}),g.includeBarcode&&p.jsxs("div",{className:"barcode-section text-center mb-3",children:[w?p.jsx("img",{src:w,alt:"باركود الوصفة الطبية",style:{width:"a4"===g.printerType?"120px":"100px",height:"a4"===g.printerType?"30px":"20px",margin:"0 auto"}}):p.jsx("div",{className:"barcode-placeholder bg-gray-200 p-2 text-xs",children:k()}),p.jsx("div",{className:"text-xs text-gray-600 mt-1",children:k()})]}),p.jsxs("div",{className:"footer text-center mt-4 pt-3 border-t border-black text-xs",children:[p.jsx("div",{className:"mb-1",children:"شكراً لثقتكم بنا"}),p.jsxs("div",{children:["تاريخ الطباعة: ",ma((new Date).toISOString())]}),c&&p.jsx("div",{className:"mt-1 font-bold",children:c})]})]})}),p.jsxs(qi,{className:"flex justify-end space-x-2 space-x-reverse",children:[p.jsx(Qi,{variant:"outline",onClick:()=>t(!1),children:"إغلاق"}),p.jsxs(Qi,{variant:"outline",onClick:()=>{S()},children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تحميل PDF"]}),p.jsxs(Qi,{variant:"outline",onClick:()=>{if(x.current){const e=window.open("","_blank");e&&(e.document.write(`\n          <html>\n            <head>\n              <title>وصفة طبية - ${n.id.slice(-6)}</title>\n              <style>\n                @page {\n                  size: 80mm auto;\n                  margin: 0;\n                }\n                body {\n                  font-family: 'Arial', 'Tahoma', sans-serif;\n                  direction: rtl;\n                  margin: 0;\n                  padding: 2mm;\n                  font-size: 11px;\n                  line-height: 1.3;\n                  color: #000;\n                  background: white;\n                  width: 76mm;\n                }\n                .receipt {\n                  width: 100%;\n                  font-size: 11px;\n                }\n                .header {\n                  text-align: center;\n                  margin-bottom: 6px;\n                  border-bottom: 2px solid #000;\n                  padding-bottom: 4px;\n                }\n                .clinic-logo {\n                  width: 40px;\n                  height: 40px;\n                  margin: 0 auto 3px;\n                  border-radius: 50%;\n                  overflow: hidden;\n                  border: 1px solid #000;\n                  flex-shrink: 0;\n                }\n                .clinic-logo img {\n                  width: 100%;\n                  height: 100%;\n                  object-fit: cover;\n                  border-radius: 50%;\n                  max-width: 40px;\n                  max-height: 40px;\n                }\n                .clinic-name {\n                  font-size: 14px;\n                  font-weight: bold;\n                  margin-bottom: 2px;\n                }\n                .doctor-name {\n                  font-size: 11px;\n                  font-weight: bold;\n                  margin-bottom: 1px;\n                }\n                .prescription-title {\n                  font-size: 12px;\n                  font-weight: bold;\n                  margin: 4px 0;\n                  text-decoration: underline;\n                }\n                .section {\n                  margin: 4px 0;\n                  padding: 2px 0;\n                }\n                .patient-info {\n                  border: 1px solid #000;\n                  padding: 3px;\n                  margin: 4px 0;\n                }\n                .medications-list {\n                  border: 1px solid #000;\n                  padding: 3px;\n                  margin: 4px 0;\n                }\n                .medication-item {\n                  margin: 2px 0;\n                  padding: 2px 0;\n                  border-bottom: 1px dotted #666;\n                }\n                .medication-item:last-child {\n                  border-bottom: none;\n                }\n                .medication-name {\n                  font-weight: bold;\n                  font-size: 11px;\n                }\n                .medication-dose {\n                  font-size: 10px;\n                  color: #333;\n                  margin-top: 1px;\n                }\n                .separator {\n                  text-align: center;\n                  margin: 4px 0;\n                  font-size: 10px;\n                }\n                .footer {\n                  text-align: center;\n                  margin-top: 6px;\n                  padding-top: 4px;\n                  border-top: 1px solid #000;\n                  font-size: 9px;\n                }\n                .bottom-section {\n                  display: flex;\n                  justify-content: space-between;\n                  align-items: flex-start;\n                  margin: 6px 0;\n                  gap: 8px;\n                  flex-wrap: wrap;\n                }\n                .qr-section, .barcode-section {\n                  text-align: center;\n                  margin: 4px 0;\n                  flex: 1;\n                  min-width: 60px;\n                }\n                .signature-section {\n                  flex: 1;\n                  min-width: 80px;\n                  text-align: center;\n                }\n                .signature-line {\n                  width: 60px;\n                  height: 1px;\n                  border-bottom: 1px solid #000;\n                  margin: 0 auto 2px;\n                }\n                .signature-label {\n                  font-size: 7px;\n                  margin-bottom: 3px;\n                }\n                .stamp-area {\n                  width: 45px;\n                  height: 35px;\n                  border: 1px dashed #000;\n                  border-radius: 50%;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  margin: 0 auto;\n                  background: rgba(0,0,0,0.02);\n                }\n                .stamp-placeholder {\n                  font-size: 6px;\n                  text-align: center;\n                  line-height: 1.1;\n                }\n                .notes {\n                  border: 1px solid #000;\n                  padding: 3px;\n                  margin: 4px 0;\n                  font-style: italic;\n                }\n              </style>\n            </head>\n            <body>\n              ${x.current.innerHTML}\n            </body>\n          </html>\n        `),e.document.close(),e.print())}},className:"bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-200",children:[p.jsx(ci,{className:"w-4 h-4 ml-2"}),"طباعة حرارية"]}),p.jsxs(Qi,{onClick:S,className:"bg-green-600 hover:bg-green-700 text-white",children:[p.jsx(ci,{className:"w-4 h-4 ml-2"}),"طباعة ذكية"]})]})]})})}function Q$({open:e,onOpenChange:t,prescription:n,onEdit:a,onPrint:s}){var r,i,l;if(!n)return null;return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"flex items-center gap-2 text-right",children:[p.jsx(Pr,{className:"w-5 h-5 text-green-600"}),"تفاصيل الوصفة الطبية"]}),p.jsxs(Hi,{className:"text-right",children:["عرض تفاصيل الوصفة الطبية للمريض ",null==(r=n.patient)?void 0:r.full_name]})]}),p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs(Lo,{children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"flex items-center gap-2 text-right text-lg",children:[p.jsx(Pr,{className:"w-5 h-5 text-green-600"}),"معلومات الوصفة"]})}),p.jsx(Yo,{className:"space-y-4",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"رقم الوصفة:"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(qo,{variant:"outline",className:"font-mono",children:["PRX-",n.id.slice(-6)]}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>{const e=`PRX-${n.id.slice(-6)}`;navigator.clipboard.writeText(e)},className:"h-6 w-6 p-0",title:"نسخ رقم الوصفة",children:p.jsx(Dr,{className:"w-3 h-3"})})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(hr,{className:"w-4 h-4 text-purple-600"}),p.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"تاريخ الوصفة:"}),p.jsx("span",{className:"text-sm font-medium",children:ma(n.prescription_date)})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Sr,{className:"w-4 h-4 text-blue-600"}),p.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"تاريخ الإنشاء:"}),p.jsx("span",{className:"text-sm",children:ma(n.created_at)})]}),n.updated_at!==n.created_at&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Sr,{className:"w-4 h-4 text-orange-600"}),p.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"آخر تحديث:"}),p.jsx("span",{className:"text-sm",children:ma(n.updated_at)})]})]})]})})]}),p.jsxs(Lo,{children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"flex items-center gap-2 text-right text-lg",children:[p.jsx(Ai,{className:"w-5 h-5 text-blue-600"}),"معلومات المريض"]})}),p.jsx(Yo,{children:p.jsxs("div",{className:"space-y-3",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(Ai,{className:"w-4 h-4 text-blue-600"}),p.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"اسم المريض:"}),p.jsx("span",{className:"font-medium text-lg",children:(null==(i=n.patient)?void 0:i.full_name)||"غير محدد"})]}),n.appointment&&p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(hr,{className:"w-4 h-4 text-green-600"}),p.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"الموعد المرتبط:"}),p.jsx(qo,{variant:"secondary",className:"font-medium",children:n.appointment.title})]})]})})]}),p.jsxs(Lo,{children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"flex items-center gap-2 text-right text-lg",children:[p.jsx(li,{className:"w-5 h-5 text-orange-600"}),"الأدوية الموصوفة (",(null==(l=n.medications)?void 0:l.length)||0,")"]})}),p.jsx(Yo,{children:n.medications&&n.medications.length>0?p.jsx("div",{className:"space-y-3",children:n.medications.map((e,t)=>p.jsx("div",{className:"border rounded-lg p-4 bg-gradient-to-r from-orange-50 to-yellow-50 dark:from-orange-950/20 dark:to-yellow-950/20",children:p.jsx("div",{className:"flex items-start justify-between",children:p.jsxs("div",{className:"space-y-2 flex-1",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(qo,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center p-0 font-bold",children:t+1}),p.jsx("h4",{className:"font-bold text-lg text-orange-800 dark:text-orange-200",children:e.medication_name})]}),e.dose&&p.jsxs("div",{className:"flex items-center gap-2 mr-10",children:[p.jsx(li,{className:"w-4 h-4 text-orange-600"}),p.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"الجرعة:"}),p.jsx("span",{className:"font-medium text-orange-700 dark:text-orange-300",children:e.dose})]}),e.medication_instructions&&p.jsx("div",{className:"mr-10 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-md border-r-4 border-blue-400",children:p.jsxs("div",{className:"flex items-start gap-2",children:[p.jsx(yi,{className:"w-4 h-4 text-blue-600 mt-0.5"}),p.jsxs("div",{children:[p.jsx("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"تعليمات الاستخدام:"}),p.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:e.medication_instructions})]})]})})]})})},t))}):p.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[p.jsx(li,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),p.jsx("p",{children:"لا توجد أدوية موصوفة في هذه الوصفة"})]})})]}),n.notes&&p.jsxs(Lo,{children:[p.jsx(Io,{className:"pb-3",children:p.jsxs(zo,{className:"flex items-center gap-2 text-right text-lg",children:[p.jsx(Pr,{className:"w-5 h-5 text-purple-600"}),"ملاحظات الطبيب"]})}),p.jsx(Yo,{children:p.jsx("div",{className:"p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg border-r-4 border-purple-400",children:p.jsx("p",{className:"text-purple-800 dark:text-purple-200 leading-relaxed",children:n.notes})})})]})]}),p.jsxs(qi,{className:"flex justify-end space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",onClick:()=>t(!1),children:[p.jsx(Mi,{className:"w-4 h-4 ml-2"}),"إغلاق"]}),s&&p.jsxs(Qi,{variant:"outline",onClick:()=>{s&&s(n)},children:[p.jsx(ci,{className:"w-4 h-4 ml-2"}),"طباعة"]}),a&&p.jsxs(Qi,{onClick:()=>{a&&(a(n),t(!1))},className:"bg-blue-600 hover:bg-blue-700 text-white",children:[p.jsx(si,{className:"w-4 h-4 ml-2"}),"تعديل الوصفة"]})]})]})})}function X$({prescriptions:e,onEdit:t,onDelete:n}){const{isLoading:a}=Nd(),[s,r]=ve.useState(!1),[i,l]=ve.useState(null),[o,d]=ve.useState(!1),[c,u]=ve.useState(null),m=e=>{l(e),r(!0)};return a?p.jsx("div",{className:"flex items-center justify-center py-8",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),p.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل الوصفات الطبية..."})]})}):0===e.length?p.jsxs("div",{className:"text-center py-8",children:[p.jsx(Pr,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground opacity-50"}),p.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد وصفات طبية"}),p.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم إنشاء أي وصفات طبية بعد"}),p.jsxs(Qi,{onClick:()=>t(null),children:[p.jsx(Pr,{className:"w-4 h-4 ml-2"}),"إنشاء وصفة طبية جديدة"]})]}):p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-center w-[60px]",children:"رقم"}),p.jsx(tc,{className:"text-center",children:"اسم المريض"}),p.jsx(tc,{className:"text-center",children:"الموعد"}),p.jsx(tc,{className:"text-center",children:"عدد الأدوية"}),p.jsx(tc,{className:"text-center",children:"تاريخ الوصفة"}),p.jsx(tc,{className:"text-center",children:"ملاحظات"}),p.jsx(tc,{className:"text-center w-[120px]",children:"الإجراءات"})]})}),p.jsx(Jd,{children:e.map((e,a)=>{var s,r;return p.jsxs(ec,{className:"hover:bg-muted/50",children:[p.jsx(nc,{className:"font-medium text-center",children:a+1}),p.jsx(nc,{className:"text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p.jsx(Ai,{className:"w-4 h-4 text-blue-600"}),p.jsx("span",{className:"font-medium",children:(null==(s=e.patient)?void 0:s.full_name)||"غير محدد"})]})}),p.jsx(nc,{className:"text-center",children:e.appointment?p.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p.jsx(hr,{className:"w-4 h-4 text-green-600"}),p.jsx("span",{className:"text-sm",children:e.appointment.title})]}):p.jsx("span",{className:"text-muted-foreground italic",children:"لا يوجد موعد"})}),p.jsx(nc,{className:"text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p.jsx(li,{className:"w-4 h-4 text-purple-600"}),p.jsxs(qo,{variant:"secondary",children:[(null==(r=e.medications)?void 0:r.length)||0," دواء"]})]})}),p.jsx(nc,{className:"text-center",children:p.jsx("div",{className:"text-sm",children:ma(e.prescription_date)})}),p.jsx(nc,{className:"text-center",children:p.jsx("div",{className:"max-w-xs mx-auto",children:e.notes?p.jsx(H$,{children:p.jsxs(G$,{children:[p.jsx(W$,{asChild:!0,children:p.jsx("div",{className:"text-sm text-muted-foreground cursor-help",children:e.notes})}),p.jsx(K$,{children:p.jsx("p",{className:"max-w-xs",children:e.notes})})]})}):p.jsx("span",{className:"text-muted-foreground italic",children:"لا توجد ملاحظات"})})}),p.jsx(nc,{className:"text-center",children:p.jsxs("div",{className:"flex items-center justify-center gap-1",children:[p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>(e=>{u(e),d(!0)})(e),className:"action-btn-view action-btn-icon",title:"عرض التفاصيل",children:p.jsx(Fr,{className:"w-4 h-4"})}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>m(e),className:"action-btn-print action-btn-icon",title:"طباعة الوصفة",children:p.jsx(ci,{className:"w-4 h-4"})}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>(e=>{t(e)})(e),className:"action-btn-warning action-btn-icon",title:"تعديل الوصفة",children:p.jsx(si,{className:"w-4 h-4"})}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>(e=>{n(e)})(e),className:"action-btn-delete action-btn-icon",title:"حذف الوصفة",children:p.jsx(Ni,{className:"w-4 h-4"})})]})})]},e.id)})})]}),p.jsx("div",{className:"border-t bg-muted/30 px-4 py-3",children:p.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsxs("span",{children:["إجمالي الوصفات: ",e.length]}),p.jsxs("span",{children:["إجمالي الأدوية: ",e.reduce((e,t)=>{var n;return e+((null==(n=t.medications)?void 0:n.length)||0)},0)]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Pr,{className:"w-4 h-4"}),p.jsx("span",{children:"سجل الوصفات الطبية"})]})]})})]}),i&&p.jsx(Z$,{open:s,onOpenChange:r,prescription:i}),c&&p.jsx(Q$,{open:o,onOpenChange:d,prescription:c,onEdit:e=>{d(!1),t(e)},onPrint:e=>{d(!1),m(e)}})]})}function J$({open:e,onOpenChange:t,prescription:n}){var a,s;const{deletePrescription:r,isLoading:i}=Nd();return n?p.jsx(Gl,{open:e,onOpenChange:()=>{i||t(!1)},children:p.jsxs(Zl,{dir:"rtl",className:"sm:max-w-[500px]",children:[p.jsxs(Ql,{children:[p.jsxs(Jl,{className:"flex items-center gap-2 text-right",children:[p.jsx(sr,{className:"w-5 h-5 text-red-600"}),"تأكيد حذف الوصفة الطبية"]}),p.jsxs(eo,{className:"text-right space-y-4",children:[p.jsx("div",{children:"هل أنت متأكد من أنك تريد حذف الوصفة الطبية التالية؟"}),p.jsxs("div",{className:"bg-muted p-4 rounded-md space-y-3",children:[p.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[p.jsx(Pr,{className:"w-4 h-4 text-red-600"}),p.jsx("span",{className:"font-medium",children:"تفاصيل الوصفة الطبية"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Ai,{className:"w-4 h-4 text-blue-600"}),p.jsxs("span",{className:"text-sm",children:[p.jsx("span",{className:"font-medium",children:"المريض: "}),(null==(a=n.patient)?void 0:a.full_name)||"غير محدد"]})]}),n.appointment&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(hr,{className:"w-4 h-4 text-green-600"}),p.jsxs("span",{className:"text-sm",children:[p.jsx("span",{className:"font-medium",children:"الموعد: "}),n.appointment.title]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(hr,{className:"w-4 h-4 text-purple-600"}),p.jsxs("span",{className:"text-sm",children:[p.jsx("span",{className:"font-medium",children:"تاريخ الوصفة: "}),ma(n.prescription_date)]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(li,{className:"w-4 h-4 text-orange-600"}),p.jsxs("span",{className:"text-sm font-medium",children:["الأدوية (",(null==(s=n.medications)?void 0:s.length)||0,"):"]})]}),n.medications&&n.medications.length>0?p.jsx("div",{className:"space-y-1 mr-6",children:n.medications.map((e,t)=>p.jsxs("div",{className:"text-sm bg-white p-2 rounded border",children:[p.jsx("div",{className:"font-medium",children:e.medication_name}),e.dose&&p.jsxs("div",{className:"text-muted-foreground text-xs",children:["الجرعة: ",e.dose]})]},t))}):p.jsx("div",{className:"text-sm text-muted-foreground mr-6",children:"لا توجد أدوية مرفقة"})]}),n.notes&&p.jsxs("div",{className:"space-y-1",children:[p.jsx("span",{className:"text-sm font-medium",children:"الملاحظات:"}),p.jsx("div",{className:"text-sm text-muted-foreground bg-white p-2 rounded border",children:n.notes})]})]}),p.jsx("div",{className:"text-red-600 font-medium",children:"⚠️ تحذير: هذا الإجراء لا يمكن التراجع عنه"}),p.jsx("div",{className:"text-sm text-muted-foreground",children:"سيتم حذف الوصفة الطبية نهائياً من النظام مع جميع الأدوية المرفقة بها. هذا قد يؤثر على السجل الطبي للمريض."})]})]}),p.jsxs(Xl,{className:"flex justify-end space-x-2 space-x-reverse",children:[p.jsx(no,{disabled:i,children:"إلغاء"}),p.jsx(to,{onClick:()=>m(this,null,function*(){if(n)try{yield r(n.id),rc.success("تم حذف الوصفة الطبية بنجاح"),t(!1)}catch(e){console.error("Error deleting prescription:",e),rc.error("فشل في حذف الوصفة الطبية")}}),disabled:i,className:"bg-red-600 hover:bg-red-700 text-white",children:i?p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحذف..."]}):p.jsxs(p.Fragment,{children:[p.jsx(Ni,{className:"w-4 h-4 ml-2"}),"حذف نهائي"]})})]})]})}):null}function eC(){const{medications:e,loadMedications:t,isLoading:n}=Af(),{prescriptions:a,filteredPrescriptions:s,totalPrescriptions:r,recentPrescriptions:i,loadPrescriptions:l,setSearchQuery:c,setPatientFilter:u,setDateRangeFilter:h,clearFilters:x,isLoading:g}=Nd(),{patients:f,loadPatients:v}=cl(),y=Bd({data:a,dateField:"prescription_date",initialFilter:{preset:"all",startDate:"",endDate:""}}),[b,j]=ve.useState("prescriptions"),[w,N]=ve.useState(""),[_,k]=ve.useState(!1),[S,D]=ve.useState(!1),[$,C]=ve.useState(!1),[E,T]=ve.useState(null),[A,F]=ve.useState(null),[P,O]=ve.useState(!1),[R,M]=ve.useState(!1),[L,I]=ve.useState(null),[z,B]=ve.useState(null),[Y,V]=ve.useState("all"),[q,U]=ve.useState({start:"",end:""});wd(),ve.useEffect(()=>{t(),l(),v()},[t,l,v]);const H=(e,t)=>{const n=d(o({},q),{[e]:t});U(n),h(n)};return p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",dir:"rtl",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-3xl font-bold text-foreground text-right",children:"الأدوية والوصفات الطبية"}),p.jsx("p",{className:"text-muted-foreground mt-2 text-right",children:"إدارة الأدوية والوصفات الطبية للمرضى"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(Qi,{variant:"outline",onClick:()=>m(this,null,function*(){try{yield Promise.all([t(),l(),v()]),rc.success("تم تحديث البيانات بنجاح")}catch(e){rc.error("فشل في تحديث البيانات")}}),disabled:n||g,children:[p.jsx(mi,{className:"w-4 h-4 ml-2 "+(n||g?"animate-spin":"")}),"تحديث"]}),p.jsxs(Qi,{onClick:"medications"===b?()=>{T(null),D(!0)}:()=>{I(null),O(!0)},children:[p.jsx(di,{className:"w-4 h-4 ml-2"}),"medications"===b?"إضافة دواء":"إضافة وصفة طبية"]})]})]}),p.jsx(zd,{value:y.timeFilter,onChange:y.handleFilterChange,onClear:y.resetFilter,title:"فلترة زمنية - الوصفات الطبية",defaultOpen:!1}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",dir:"rtl",children:[p.jsxs(Lo,{className:vd("blue"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-right",children:"إجمالي الأدوية"}),p.jsx(li,{className:yd("blue")})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-right",children:e.length}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"الأدوية المتاحة في النظام"})]})]}),p.jsxs(Lo,{className:vd("green"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-right",children:"all"===y.timeFilter.preset||!y.timeFilter.startDate&&!y.timeFilter.endDate?"إجمالي الوصفات":"الوصفات المفلترة"}),p.jsx(Pr,{className:yd("green")})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-right",children:"all"===y.timeFilter.preset||!y.timeFilter.startDate&&!y.timeFilter.endDate?a.length:y.filteredData.length}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"all"===y.timeFilter.preset||!y.timeFilter.startDate&&!y.timeFilter.endDate?"وصفات إجمالية":"وصفات في الفترة المحددة"}),y.trend&&p.jsx("div",{className:"text-xs flex items-center mt-1 "+(y.trend.isPositive?"text-green-600":"text-red-600"),children:p.jsxs("span",{children:[Math.abs(y.trend.changePercent),"% من الفترة السابقة"]})})]})]}),p.jsxs(Lo,{className:vd("purple"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-right",children:"الوصفات الحديثة"}),p.jsx(Sr,{className:yd("purple")})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-right",children:i}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"آخر 30 يوماً"})]})]}),p.jsxs(Lo,{className:vd("yellow"),children:[p.jsxs(Io,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[p.jsx(zo,{className:"text-sm font-medium text-right",children:"المرضى النشطون"}),p.jsx(gr,{className:yd("yellow")})]}),p.jsxs(Yo,{children:[p.jsx("div",{className:"text-2xl font-bold text-right",children:f.length}),p.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"المرضى المسجلون"})]})]})]}),p.jsxs(Lo,{children:[p.jsx(Io,{dir:"rtl",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx(zo,{className:"text-right",children:"البحث والفلاتر"}),p.jsx(Bo,{className:"text-right",children:"البحث في الأدوية والوصفات الطبية"})]}),p.jsxs(Qi,{variant:"outline",onClick:()=>k(!_),children:[p.jsx(Or,{className:"w-4 h-4 ml-2"}),_?"إخفاء الفلاتر":"إظهار الفلاتر",p.jsx(vr,{className:"w-4 h-4 mr-2 transition-transform "+(_?"rotate-180":"")})]})]})}),p.jsx(Yo,{children:p.jsxs("div",{className:"space-y-4",dir:"rtl",children:[p.jsxs("div",{className:"relative",children:[p.jsx(hi,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{placeholder:"medications"===b?"البحث في الأدوية...":"البحث في الوصفات الطبية...",value:w,onChange:e=>{N(e.target.value),"prescriptions"===b&&c(e.target.value)},className:"pr-10 text-right",dir:"rtl"}),w&&p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>{N(""),"prescriptions"===b&&c("")},className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",children:p.jsx(Mi,{className:"w-3 h-3"})})]}),"prescriptions"===b&&p.jsx(Md,{open:_,onOpenChange:k,children:p.jsxs(Id,{className:"space-y-4",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium text-right block mb-2",children:"فلترة حسب المريض"}),p.jsxs(el,{value:Y,onValueChange:e=>{V(e),u(e)},children:[p.jsx(al,{className:"text-right",dir:"rtl",children:p.jsx(nl,{placeholder:"اختر مريض"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع المرضى"}),f.map(e=>p.jsx(dl,{value:e.id,children:e.full_name},e.id))]})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium text-right block mb-2",children:"من تاريخ"}),p.jsx(Xi,{type:"date",value:q.start,onChange:e=>H("start",e.target.value),className:"text-right",dir:"rtl"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-medium text-right block mb-2",children:"إلى تاريخ"}),p.jsx(Xi,{type:"date",value:q.end,onChange:e=>H("end",e.target.value),className:"text-right",dir:"rtl"})]})]}),p.jsx("div",{className:"flex justify-end",children:p.jsxs(Qi,{variant:"outline",onClick:()=>{V("all"),U({start:"",end:""}),c(""),x()},children:[p.jsx(Mi,{className:"w-4 h-4 ml-2"}),"مسح الفلاتر"]})})]})})]})})]}),p.jsxs(iu,{value:b,onValueChange:j,className:"space-y-4",dir:"rtl",children:[p.jsx("div",{className:"flex items-center justify-between",dir:"rtl",children:p.jsxs(lu,{className:"grid w-fit grid-cols-2",children:[p.jsxs(ou,{value:"prescriptions",className:"flex items-center gap-2",children:[p.jsx(Pr,{className:"w-4 h-4"}),"الوصفات الطبية"]}),p.jsxs(ou,{value:"medications",className:"flex items-center gap-2",children:[p.jsx(li,{className:"w-4 h-4"}),"إدارة الأدوية"]})]})}),p.jsx(du,{value:"prescriptions",className:"space-y-4",dir:"rtl",children:p.jsxs(Lo,{children:[p.jsxs(Io,{dir:"rtl",children:[p.jsxs(zo,{className:"flex items-center gap-2 text-right",children:[p.jsx(Pr,{className:"w-5 h-5"}),"الوصفات الطبية"]}),p.jsx(Bo,{className:"text-right",children:"إدارة جميع الوصفات الطبية للمرضى"})]}),p.jsx(Yo,{children:p.jsx(X$,{prescriptions:s,onEdit:e=>{I(e),O(!0)},onDelete:e=>{B(e),M(!0)}})})]})}),p.jsx(du,{value:"medications",className:"space-y-4",dir:"rtl",children:p.jsxs(Lo,{children:[p.jsxs(Io,{dir:"rtl",children:[p.jsxs(zo,{className:"flex items-center gap-2 text-right",children:[p.jsx(li,{className:"w-5 h-5"}),"إدارة الأدوية"]}),p.jsx(Bo,{className:"text-right",children:"إدارة معلومات الأدوية المتاحة"})]}),p.jsx(Yo,{children:p.jsx(h$,{medications:e,onEdit:e=>{T(e),D(!0)},onDelete:e=>{F(e),C(!0)},searchQuery:w})})]})})]}),p.jsx(x$,{open:S,onOpenChange:()=>{D(!1),T(null)},editingMedication:E}),p.jsx(g$,{open:$,onOpenChange:()=>{C(!1),F(null)},medication:A}),p.jsx(Ff,{open:P,onOpenChange:()=>{O(!1),I(null)},editingPrescription:L}),p.jsx(J$,{open:R,onOpenChange:()=>{M(!1),B(null)},prescription:z})]})}K$.displayName=U$.displayName;const tC=ve.forwardRef((e,t)=>{var n=e,{id:a,checked:s=!1,onCheckedChange:r,disabled:i=!1,className:l=""}=n,d=c(n,["id","checked","onCheckedChange","disabled","className"]);return p.jsxs("div",{className:"relative inline-flex items-center",children:[p.jsx("input",o({ref:t,id:a,type:"checkbox",checked:s,onChange:e=>{r&&r(e.target.checked)},disabled:i,className:"sr-only"},d)),p.jsx("div",{className:`\n            w-5 h-5 border-2 rounded-md cursor-pointer transition-all duration-200 shadow-sm\n            ${s?"bg-blue-600 border-blue-600 text-white shadow-blue-200":"bg-white border-gray-400 hover:border-blue-400 hover:shadow-md"}\n            ${i?"opacity-50 cursor-not-allowed":""}\n            flex items-center justify-center\n            ${l}\n          `,onClick:()=>!i&&r&&r(!s),children:s&&p.jsx(fr,{className:"w-4 h-4 text-white font-bold"})})]})});function nC({patientId:e,onToothClick:t,selectedTooth:n,selectedTeeth:a=[],isMultiSelectMode:s=!1,className:r,isPrimaryTeeth:i=!1,onPrimaryTeethChange:l}){const{toothTreatments:o,toothTreatmentImages:d,loadToothTreatmentsByPatient:c,loadToothTreatmentImagesByTooth:u,loadAllToothTreatmentImagesByPatient:h}=Ko();Gt();const[x,g]=ve.useState(null),[f,v]=ve.useState(!1),[y,b]=ve.useState(0),j=l?i:f,w=l||v;ve.useEffect(()=>{e&&(c(e),h(e))},[e,c,h]);const N=()=>m(this,null,function*(){e&&(yield Promise.all([c(e),h(e)]),b(e=>e+1))});ve.useEffect(()=>{"undefined"!=typeof window&&(window.forceToothColorUpdate=N().triggerToothColorUpdate=()=>{window.dispatchEvent(new CustomEvent("tooth-color-update",{detail:{type:"manual-trigger",timestamp:Date.now()}}))})},[e]),ve.useEffect(()=>{},[d]),ve.useEffect(()=>{b(e=>e+1)},[o]),ve.useEffect(()=>{const e=()=>{b(e=>e+1)},t=e=>m(this,null,function*(){yield N()});return window.addEventListener("treatment-updated",e),window.addEventListener("treatment-changed",e),window.addEventListener("tooth-color-update",t),window.addEventListener("treatments-loaded",e),()=>{window.removeEventListener("treatment-updated",e),window.removeEventListener("treatment-changed",e),window.removeEventListener("tooth-color-update",t),window.removeEventListener("treatments-loaded",e)}},[e]);const _=j?Qo:Zo,k=_.filter(e=>"upper"===e.position),S=_.filter(e=>"lower"===e.position),D=t=>o.filter(n=>n.patient_id===e&&n.tooth_number===t).sort((e,t)=>e.priority-t.priority),$=s=>{const r=Xo(s,j),i=(e=>{const t=D(e);return{total:t.length,completed:t.filter(e=>"completed"===e.treatment_status).length,inProgress:t.filter(e=>"in_progress"===e.treatment_status).length,planned:t.filter(e=>"planned"===e.treatment_status).length,treatments:t}})(s),l=(e=>{const t=D(e);if(0===t.length)return"#22c55e";if(t.every(e=>"completed"===e.treatment_status))return"#22c55e";const n=t.find(e=>"in_progress"===e.treatment_status)||t.find(e=>"planned"===e.treatment_status)||t[0];return(null==n?void 0:n.treatment_color)||"#22c55e"})(s),o=(t=>e?d.filter(n=>n.tooth_number===t&&n.patient_id===e).length:0)(s),c=n===s,u=a.includes(s),m=x===s;return r?p.jsxs(G$,{children:[p.jsx(W$,{asChild:!0,children:p.jsxs(Qi,{variant:"outline",className:aa("relative h-16 w-16 p-1 transition-all duration-200 border-2 overflow-hidden","flex flex-col items-center justify-center text-xs font-medium",c&&"ring-2 ring-blue-500 ring-offset-2",u&&"ring-2 ring-orange-500 ring-offset-2 border-orange-400",m&&"scale-105 shadow-lg"),style:{borderColor:l,color:"#000000",textShadow:"0 0 2px rgba(255,255,255,0.8)"},onClick:e=>{const n=e.ctrlKey||e.metaKey;t(s,n)},onMouseEnter:()=>g(s),onMouseLeave:()=>g(null),children:[p.jsx("div",{className:"absolute inset-0",children:0===i.total?p.jsx("div",{className:"w-full h-full",style:{backgroundColor:c?l:m?l+"40":l+"20"}}):1===i.total?(()=>{const e="completed"===i.treatments[0].treatment_status?l:i.treatments[0].treatment_color;return p.jsx("div",{className:"w-full h-full",style:{backgroundColor:e,opacity:c?.95:m?.85:"completed"===i.treatments[0].treatment_status?.8:"in_progress"===i.treatments[0].treatment_status?.75:.7}})})():2===i.total?i.treatments.every(e=>"completed"===e.treatment_status)?p.jsx("div",{className:"w-full h-full",style:{backgroundColor:l,opacity:c?.95:m?.85:.8}}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 border-b-2 border-white/50",style:{backgroundColor:"completed"===i.treatments[0].treatment_status?l:i.treatments[0].treatment_color,opacity:c?.95:m?.85:"completed"===i.treatments[0].treatment_status?.8:"in_progress"===i.treatments[0].treatment_status?.75:.7}}),p.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1/2",style:{backgroundColor:"completed"===i.treatments[1].treatment_status?l:i.treatments[1].treatment_color,opacity:c?.95:m?.85:"completed"===i.treatments[1].treatment_status?.8:"in_progress"===i.treatments[1].treatment_status?.75:.7}})]}):3===i.total?i.treatments.every(e=>"completed"===e.treatment_status)?p.jsx("div",{className:"w-full h-full",style:{backgroundColor:l,opacity:c?.95:m?.85:.8}}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 border-b-2 border-white/50",style:{backgroundColor:"completed"===i.treatments[0].treatment_status?l:i.treatments[0].treatment_color,opacity:c?.95:m?.85:"completed"===i.treatments[0].treatment_status?.8:"in_progress"===i.treatments[0].treatment_status?.75:.7}}),p.jsx("div",{className:"absolute bottom-0 left-0 w-1/2 h-1/2 border-r-2 border-white/50",style:{backgroundColor:"completed"===i.treatments[1].treatment_status?l:i.treatments[1].treatment_color,opacity:c?.95:m?.85:"completed"===i.treatments[1].treatment_status?.8:"in_progress"===i.treatments[1].treatment_status?.75:.7}}),p.jsx("div",{className:"absolute bottom-0 right-0 w-1/2 h-1/2",style:{backgroundColor:"completed"===i.treatments[2].treatment_status?l:i.treatments[2].treatment_color,opacity:c?.95:m?.85:"completed"===i.treatments[2].treatment_status?.8:"in_progress"===i.treatments[2].treatment_status?.75:.7}})]}):i.treatments.every(e=>"completed"===e.treatment_status)?p.jsx("div",{className:"w-full h-full",style:{backgroundColor:l,opacity:c?.95:m?.85:.8}}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"absolute top-0 left-0 w-1/2 h-1/2 border-r-2 border-b-2 border-white/50",style:{backgroundColor:"completed"===i.treatments[0].treatment_status?l:i.treatments[0].treatment_color,opacity:c?.95:m?.85:"completed"===i.treatments[0].treatment_status?.8:"in_progress"===i.treatments[0].treatment_status?.75:.7}}),p.jsx("div",{className:"absolute top-0 right-0 w-1/2 h-1/2 border-b-2 border-white/50",style:{backgroundColor:"completed"===i.treatments[1].treatment_status?l:i.treatments[1].treatment_color,opacity:c?.95:m?.85:"completed"===i.treatments[1].treatment_status?.8:"in_progress"===i.treatments[1].treatment_status?.75:.7}}),p.jsx("div",{className:"absolute bottom-0 left-0 w-1/2 h-1/2 border-r-2 border-white/50",style:{backgroundColor:"completed"===i.treatments[2].treatment_status?l:i.treatments[2].treatment_color,opacity:c?.95:m?.85:"completed"===i.treatments[2].treatment_status?.8:"in_progress"===i.treatments[2].treatment_status?.75:.7}}),p.jsx("div",{className:"absolute bottom-0 right-0 w-1/2 h-1/2",style:{backgroundColor:"completed"===i.treatments[3].treatment_status?l:i.treatments[3].treatment_color,opacity:c?.95:m?.85:"completed"===i.treatments[3].treatment_status?.8:"in_progress"===i.treatments[3].treatment_status?.75:.7}})]})}),p.jsx("div",{className:"relative z-10 text-xs font-bold mb-1 px-1 rounded",style:{backgroundColor:"rgba(255,255,255,0.95)",color:"#000000",textShadow:"none"},children:s}),p.jsx("div",{className:"relative z-10",children:p.jsx("div",{className:"w-6 h-6 rounded-sm border-2 border-white flex items-center justify-center text-xs font-bold",style:{backgroundColor:i.total>0?"rgba(255,255,255,0.95)":"rgba(255,255,255,0.7)",color:i.total>0?"#1f2937":"#6b7280",textShadow:"none"},children:i.total>0?i.total:"✓"})}),o>0&&p.jsx("div",{className:"absolute -top-2 -left-2 z-20",children:p.jsx("div",{className:(o>9?"w-7 h-6 px-1":"w-6 h-6")+" rounded-full border-2 border-white bg-blue-600 flex items-center justify-center text-white font-bold shadow-lg transition-transform duration-200 hover:scale-110",style:{fontSize:o>9?"10px":"12px",fontWeight:"800",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.4), 0 2px 4px rgba(0,0,0,0.3)",background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",minWidth:"24px"},children:o>99?"99+":o})}),i.inProgress>0&&p.jsx("div",{className:"absolute -bottom-1 -left-1 z-20",children:p.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full border border-white"})})]})}),p.jsx(K$,{side:"top",className:"max-w-xs",children:p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"font-semibold",children:["السن رقم ",s," - ",r.arabicName]}),i.total>0?p.jsxs("div",{className:"space-y-1",children:[p.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[p.jsx(qr,{className:"w-3 h-3"}),p.jsxs("span",{children:[i.total," علاج مسجل"]})]}),p.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.completed>0&&p.jsxs(qo,{variant:"secondary",className:"text-xs bg-green-100 text-green-800",children:[p.jsx(gr,{className:"w-2 h-2 ml-1"}),i.completed," مكتمل"]}),i.inProgress>0&&p.jsxs(qo,{variant:"secondary",className:"text-xs bg-yellow-100 text-yellow-800",children:[p.jsx(nr,{className:"w-2 h-2 ml-1"}),i.inProgress," قيد التنفيذ"]}),i.planned>0&&p.jsxs(qo,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-800",children:[p.jsx(Sr,{className:"w-2 h-2 ml-1"}),i.planned," مخطط"]})]}),p.jsxs("div",{className:"space-y-1 mt-2",children:[i.treatments.slice(0,3).map((e,t)=>{var n,a;return p.jsxs("div",{className:"text-xs flex items-center gap-2 p-1 rounded bg-gray-50 dark:bg-gray-700",children:[p.jsx("div",{className:"w-2.5 h-2.5 rounded-full border border-white/50",style:{backgroundColor:e.treatment_color,opacity:"completed"===e.treatment_status?1:"in_progress"===e.treatment_status?.8:.6}}),p.jsxs("span",{className:"font-medium text-blue-600",children:["#",e.priority]}),p.jsx("span",{className:"flex-1",children:(null==(n=nd(e.treatment_type))?void 0:n.label)||e.treatment_type}),p.jsx(qo,{variant:"outline",className:"text-xs px-1 py-0",style:{borderColor:e.treatment_color,color:e.treatment_color},children:null==(a=rd.find(t=>t.value===e.treatment_status))?void 0:a.label})]},e.id)}),i.total>3&&p.jsxs("div",{className:"text-xs text-muted-foreground text-center",children:["و ",i.total-3," علاج آخر... انقر لعرض الكل"]})]})]}):p.jsx("div",{className:"text-sm text-muted-foreground",children:"لا توجد علاجات مسجلة"}),o>0&&p.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-1 rounded",children:["📷 ",o," صورة"]})]})})]},s):null};return p.jsx(H$,{children:p.jsxs(Lo,{className:aa("w-full",r),id:"dental-chart-section",children:[p.jsx(Io,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(nr,{className:"w-5 h-5 text-blue-600"}),"مخطط الأسنان التفاعلي"]}),p.jsx(Bo,{children:"انقر على أي سن لعرض وإدارة العلاجات المتعددة"})]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx(Ro,{htmlFor:"teeth-type",className:"text-sm font-medium",children:"أسنان لبنية"}),p.jsx(tC,{id:"teeth-type",checked:j,onCheckedChange:w})]})]})}),p.jsxs(Yo,{className:"space-y-6 bg-card dark:bg-card",children:[p.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-4",children:ed.slice(0,6).map(e=>p.jsxs(qo,{variant:"secondary",className:"text-xs",style:{backgroundColor:e.color+"20",color:e.color,borderColor:e.color+"40"},children:[p.jsx("span",{className:"ml-1",children:e.icon}),e.label]},e.value))}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("div",{className:"text-center text-sm font-medium text-muted-foreground",children:j?"الفك العلوي اللبني":"الفك العلوي"}),p.jsx("div",{className:"grid gap-1 justify-center "+(j?"grid-cols-10":"grid-cols-16"),children:k.map(e=>$(e.number))})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("div",{className:"text-center text-sm font-medium text-muted-foreground",children:j?"الفك السفلي اللبني":"الفك السفلي"}),p.jsx("div",{className:"grid gap-1 justify-center "+(j?"grid-cols-10":"grid-cols-16"),children:S.map(e=>$(e.number))})]}),p.jsxs("div",{className:"text-center space-y-2",children:[p.jsx("div",{className:"text-xs text-muted-foreground",children:"انقر على أي سن لعرض تفاصيل العلاج وإدارة العلاجات المتعددة"}),p.jsxs("div",{className:"flex justify-center gap-4 text-xs text-muted-foreground",children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("div",{className:"w-3 h-3 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs",children:"#"}),p.jsx("span",{children:"عدد العلاجات"})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),p.jsx("span",{children:"قيد التنفيذ"})]})]})]})]})]},`dental-chart-${y}`)})}tC.displayName="Checkbox";const aC=[{value:"drilling",label:"حفر السن",description:"فتح السن والوصول للعصب"},{value:"nerve_extraction",label:"سحب العصب",description:"إزالة العصب المصاب"},{value:"canal_cleaning",label:"تنظيف القنوات",description:"تنظيف وتطهير قنوات الجذر"},{value:"canal_shaping",label:"تشكيل القنوات",description:"توسيع وتشكيل قنوات الجذر"},{value:"medication",label:"وضع الدواء",description:"وضع مضاد حيوي داخل القنوات"},{value:"filling",label:"حشو القنوات",description:"حشو نهائي لقنوات الجذر"},{value:"crown_prep",label:"تحضير للتاج",description:"تحضير السن لوضع التاج"},{value:"final_restoration",label:"الترميم النهائي",description:"وضع الحشوة أو التاج النهائي"}],sC=[{value:"cavity_prep",label:"تحضير التجويف",description:"إزالة التسوس وتحضير السن"},{value:"base_placement",label:"وضع القاعدة",description:"وضع مادة القاعدة الواقية"},{value:"filling_placement",label:"وضع الحشوة",description:"وضع مادة الحشو"},{value:"polishing",label:"تلميع",description:"تلميع وتنعيم الحشوة"},{value:"bite_adjustment",label:"تعديل العضة",description:"تعديل ارتفاع الحشوة"}],rC=[{value:"tooth_prep",label:"تحضير السن",description:"برد وتشكيل السن"},{value:"impression",label:"أخذ الطبعة",description:"أخذ طبعة للسن المحضر"},{value:"temp_crown",label:"تاج مؤقت",description:"وضع تاج مؤقت"},{value:"try_in",label:"تجربة التاج",description:"تجربة التاج النهائي"},{value:"cementation",label:"تثبيت التاج",description:"تثبيت التاج بالإسمنت"},{value:"final_adjustment",label:"التعديل النهائي",description:"تعديل العضة والتلميع"},{value:"initial_impression",label:"الطبعة الأولية",description:"أخذ طبعة أولية للفكين"},{value:"final_impression",label:"الطبعة النهائية",description:"أخذ طبعة نهائية دقيقة"},{value:"bite_registration",label:"تسجيل العضة",description:"تحديد العلاقة بين الفكين"},{value:"try_in_wax",label:"تجربة الشمع",description:"تجربة الأسنان على الشمع"},{value:"denture_delivery",label:"تسليم الجهاز",description:"تسليم الجهاز المتحرك النهائي"},{value:"denture_adjustment",label:"تعديل الجهاز",description:"تعديل وضبط الجهاز المتحرك"},{value:"follow_up_denture",label:"متابعة الجهاز",description:"فحص ومتابعة الجهاز المتحرك"},{value:"implant_impression",label:"طبعة الزرعة",description:"أخذ طبعة للزرعة المدفونة"},{value:"abutment_placement",label:"وضع الدعامة",description:"تركيب دعامة فوق الزرعة"},{value:"implant_crown_try",label:"تجربة تاج الزرعة",description:"تجربة التاج فوق الزرعة"},{value:"implant_crown_delivery",label:"تسليم تاج الزرعة",description:"تثبيت التاج النهائي فوق الزرعة"},{value:"post_space_prep",label:"تحضير مجرى الوتد",description:"تحضير مجرى الوتد في الجذر"},{value:"post_impression",label:"طبعة الوتد",description:"أخذ طبعة لمجرى الوتد"},{value:"post_try_in",label:"تجربة الوتد",description:"تجربة القلب والوتد"},{value:"post_cementation",label:"تثبيت الوتد",description:"تثبيت القلب والوتد بالإسمنت"},{value:"veneer_prep",label:"تحضير الفينير",description:"برد طفيف للسطح الأمامي"},{value:"veneer_impression",label:"طبعة الفينير",description:"أخذ طبعة للأسنان المحضرة"},{value:"veneer_try_in",label:"تجربة الفينير",description:"تجربة قشور الفينير"},{value:"veneer_bonding",label:"لصق الفينير",description:"لصق قشور الفينير نهائياً"}],iC=[{value:"consultation",label:"استشارة",description:"فحص وتقييم الحالة"},{value:"anesthesia",label:"تخدير",description:"تخدير موضعي"},{value:"extraction",label:"القلع",description:"قلع السن"},{value:"suturing",label:"خياطة",description:"خياطة الجرح إذا لزم"},{value:"follow_up",label:"متابعة",description:"فحص الشفاء"},{value:"suture_removal",label:"إزالة الخيوط",description:"إزالة الخيوط الجراحية"}],lC=[{value:"scaling",label:"تنظيف فوق اللثة",description:"إزالة الجير فوق خط اللثة"},{value:"root_planing",label:"تنظيف تحت اللثة",description:"تنظيف الجذور تحت اللثة"},{value:"polishing",label:"تلميع",description:"تلميع الأسنان"},{value:"fluoride",label:"فلورايد",description:"تطبيق الفلورايد"},{value:"maintenance",label:"صيانة دورية",description:"تنظيف دوري للمتابعة"}],oC=[{value:"examination",label:"فحص",description:"فحص أسنان الطفل"},{value:"cleaning",label:"تنظيف",description:"تنظيف أسنان الطفل"},{value:"fluoride_treatment",label:"علاج بالفلورايد",description:"تطبيق الفلورايد الوقائي"},{value:"sealant",label:"مادة سادة",description:"وضع مادة سادة للشقوق"},{value:"pulp_treatment",label:"علاج العصب",description:"علاج عصب سن لبني"},{value:"space_maintainer",label:"حافظ مسافة",description:"وضع جهاز حافظ المسافة"}],dC=[{value:"consultation",label:"استشارة تجميلية",description:"تقييم الحالة التجميلية"},{value:"teeth_whitening",label:"تبييض الأسنان",description:"جلسة تبييض"},{value:"veneer_prep",label:"تحضير للقشرة",description:"تحضير السن للقشرة التجميلية"},{value:"veneer_placement",label:"وضع القشرة",description:"تثبيت القشرة التجميلية"},{value:"polishing",label:"تلميع تجميلي",description:"تلميع وتنعيم نهائي"}];function cC({session:e,isEditing:t,availableSessionTypes:n,onEdit:a,onCancelEdit:s,onSave:r,onDelete:i,getStatusBadgeColor:l,getStatusText:c,isDarkMode:u}){var m;const[h,x]=ve.useState({session_type:e.session_type,session_title:e.session_title,session_description:e.session_description,session_date:e.session_date,session_status:e.session_status,duration_minutes:e.duration_minutes,notes:e.notes}),g=()=>{r(h)},f=()=>{x({session_type:e.session_type,session_title:e.session_title,session_description:e.session_description,session_date:e.session_date,session_status:e.session_status,duration_minutes:e.duration_minutes,cost:e.cost,notes:e.notes}),s()};return t?p.jsx(Lo,{className:aa("border-2 transition-all duration-200",u?"border-yellow-600 bg-yellow-900/20":"border-yellow-400 bg-yellow-50"),children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("h4",{className:"font-medium text-foreground",children:["تعديل الجلسة #",e.session_number]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsxs(Qi,{size:"sm",variant:"outline",onClick:f,children:[p.jsx(Mi,{className:"w-4 h-4 ml-1"}),"إلغاء"]}),p.jsxs(Qi,{size:"sm",onClick:g,children:[p.jsx(pi,{className:"w-4 h-4 ml-1"}),"حفظ"]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"edit_session_type",children:"نوع الجلسة"}),p.jsxs(el,{value:h.session_type||"",onValueChange:e=>{const t=n.find(t=>t.value===e);x(n=>d(o({},n),{session_type:e,session_title:(null==t?void 0:t.label)||n.session_title}))},children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر نوع الجلسة"})}),p.jsx(il,{children:n.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{children:[p.jsx("div",{className:"font-medium",children:e.label}),e.description&&p.jsx("div",{className:"text-sm text-muted-foreground",children:e.description})]})},e.value))})]})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"edit_session_title",children:"عنوان الجلسة"}),p.jsx(Xi,{id:"edit_session_title",value:h.session_title||"",onChange:e=>x(t=>d(o({},t),{session_title:e.target.value}))})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"edit_session_date",children:"تاريخ الجلسة"}),p.jsx(Xi,{id:"edit_session_date",type:"date",value:h.session_date||"",onChange:e=>x(t=>d(o({},t),{session_date:e.target.value}))})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"edit_session_status",children:"حالة الجلسة"}),p.jsxs(el,{value:h.session_status||"",onValueChange:e=>x(t=>d(o({},t),{session_status:e})),children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر حالة الجلسة"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"planned",children:"مخططة"}),p.jsx(dl,{value:"completed",children:"مكتملة"}),p.jsx(dl,{value:"cancelled",children:"ملغية"})]})]})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"edit_duration",children:"مدة الجلسة (دقيقة)"}),p.jsx(Xi,{id:"edit_duration",type:"number",value:h.duration_minutes||30,onChange:e=>x(t=>d(o({},t),{duration_minutes:parseInt(e.target.value)||30}))})]})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"edit_session_description",children:"وصف الجلسة"}),p.jsx(Ji,{id:"edit_session_description",value:h.session_description||"",onChange:e=>x(t=>d(o({},t),{session_description:e.target.value})),rows:3})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"edit_notes",children:"ملاحظات"}),p.jsx(Ji,{id:"edit_notes",value:h.notes||"",onChange:e=>x(t=>d(o({},t),{notes:e.target.value})),rows:2})]})]})})}):p.jsx(Lo,{className:aa("transition-all duration-200 hover:shadow-md",u?"bg-gray-800/50 hover:bg-gray-800/70":"bg-white hover:bg-gray-50"),children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[p.jsx("span",{className:aa("flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold",u?"bg-blue-600 text-white":"bg-blue-100 text-blue-800"),children:e.session_number}),p.jsxs("div",{children:[p.jsx("h4",{className:"font-medium text-foreground",children:e.session_title}),p.jsx("p",{className:"text-sm text-muted-foreground",children:(null==(m=n.find(t=>t.value===e.session_type))?void 0:m.label)||e.session_type})]}),p.jsx(qo,{className:l(e.session_status),children:c(e.session_status)})]}),p.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(hr,{className:"w-4 h-4"}),(e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return"--";const n=t.getDate(),a=t.getMonth()+1,s=t.getFullYear(),r=n.toString().padStart(2,"0");return`${r}/${a.toString().padStart(2,"0")}/${s}`}catch(t){return console.warn("Error formatting date:",t),"--"}})(e.session_date)]}),e.duration_minutes&&p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx(Sr,{className:"w-4 h-4"}),e.duration_minutes," دقيقة"]}),e.cost&&e.cost>0&&p.jsxs("div",{className:"font-medium text-green-600",children:["$",e.cost]})]}),e.session_description&&p.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:e.session_description}),e.notes&&p.jsxs("div",{className:aa("text-xs p-2 rounded border-r-4",u?"bg-gray-700/50 border-gray-600 text-gray-300":"bg-gray-50 border-gray-300 text-gray-600"),children:[p.jsx("strong",{children:"ملاحظات:"})," ",e.notes]})]}),p.jsxs("div",{className:"flex gap-1 ml-4",children:[p.jsx(Qi,{size:"sm",variant:"ghost",onClick:a,className:"h-8 w-8 p-0",children:p.jsx(si,{className:"w-4 h-4"})}),p.jsx(Qi,{size:"sm",variant:"ghost",onClick:i,className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:p.jsx(Ni,{className:"w-4 h-4"})})]})]})})})}function uC({treatment:e,sessions:t,onAddSession:n,onUpdateSession:a,onDeleteSession:s}){const{isDarkMode:r}=Gt(),[i,l]=ve.useState(!1),[c,u]=ve.useState(null),[h,x]=ve.useState({tooth_treatment_id:e.id,session_date:(new Date).toISOString().split("T")[0],session_status:"planned",duration_minutes:30}),g=(e=>{switch(e.toLowerCase()){case"علاج العصب":case"endodontic":return aC;case"ترميمي/تحفظي":case"restorative":return sC;case"تركيبات":case"prosthetic":return rC;case"جراحي":case"surgical":return iC;case"لثة":case"periodontal":return lC;case"أطفال":case"pediatric":return oC;case"تجميلي":case"cosmetic":return dC;default:return[{value:"consultation",label:"استشارة",description:"استشارة وفحص"},{value:"treatment",label:"علاج",description:"جلسة علاج"},{value:"follow_up",label:"متابعة",description:"جلسة متابعة"}]}})(e.treatment_category),f=(e,t)=>m(this,null,function*(){try{yield a(e,t),u(null),rc.success("تم تحديث الجلسة بنجاح")}catch(n){rc.error("فشل في تحديث الجلسة")}}),v=e=>m(this,null,function*(){if(window.confirm("هل أنت متأكد من حذف هذه الجلسة؟"))try{yield s(e),rc.success("تم حذف الجلسة بنجاح")}catch(t){rc.error("فشل في حذف الجلسة")}}),y=e=>{switch(e){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"planned":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},b=e=>{switch(e){case"completed":return"مكتملة";case"planned":return"مخططة";case"cancelled":return"ملغية";default:return e}};return p.jsxs("div",{className:"space-y-4",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["جلسات العلاج (",t.length,")"]}),p.jsxs(Qi,{onClick:()=>l(!0),size:"sm",className:aa("action-btn-sessions sessions-selected","bg-blue-600 hover:bg-blue-700 text-white"),children:[p.jsx(di,{className:"w-4 h-4 ml-2"}),"إضافة جلسة"]})]}),p.jsx("div",{className:"space-y-3",children:t.map(e=>p.jsx(cC,{session:e,isEditing:c===e.id,availableSessionTypes:g,onEdit:()=>u(e.id),onCancelEdit:()=>u(null),onSave:t=>f(e.id,t),onDelete:()=>v(e.id),getStatusBadgeColor:y,getStatusText:b,isDarkMode:r},e.id))}),i&&p.jsxs(Lo,{className:aa("border-2 border-dashed transition-all duration-200",r?"border-blue-600 bg-gray-800/50":"border-blue-300 bg-blue-50/50"),children:[p.jsx(Io,{children:p.jsx(zo,{className:"text-lg text-foreground",children:"إضافة جلسة جديدة"})}),p.jsxs(Yo,{className:"space-y-4",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"session_type",children:"نوع الجلسة *"}),p.jsxs(el,{value:h.session_type||"",onValueChange:e=>{const t=g.find(t=>t.value===e);x(n=>d(o({},n),{session_type:e,session_title:(null==t?void 0:t.label)||""}))},children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر نوع الجلسة"})}),p.jsx(il,{children:g.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{children:[p.jsx("div",{className:"font-medium",children:e.label}),e.description&&p.jsx("div",{className:"text-sm text-muted-foreground",children:e.description})]})},e.value))})]})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"session_title",children:"عنوان الجلسة *"}),p.jsx(Xi,{id:"session_title",value:h.session_title||"",onChange:e=>x(t=>d(o({},t),{session_title:e.target.value})),placeholder:"عنوان الجلسة"})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"session_date",children:"تاريخ الجلسة *"}),p.jsx(Xi,{id:"session_date",type:"date",value:h.session_date||"",onChange:e=>x(t=>d(o({},t),{session_date:e.target.value}))})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"duration_minutes",children:"مدة الجلسة (دقيقة)"}),p.jsx(Xi,{id:"duration_minutes",type:"number",value:h.duration_minutes||30,onChange:e=>x(t=>d(o({},t),{duration_minutes:parseInt(e.target.value)||30})),placeholder:"30"})]})]}),p.jsxs("div",{children:[p.jsx(Ro,{htmlFor:"session_description",children:"وصف الجلسة"}),p.jsx(Ji,{id:"session_description",value:h.session_description||"",onChange:e=>x(t=>d(o({},t),{session_description:e.target.value})),placeholder:"وصف ما تم عمله في الجلسة...",rows:3})]}),p.jsxs("div",{className:"flex gap-2 justify-end",children:[p.jsxs(Qi,{variant:"outline",onClick:()=>{l(!1),x({tooth_treatment_id:e.id,session_date:(new Date).toISOString().split("T")[0],session_status:"planned",duration_minutes:30})},children:[p.jsx(Mi,{className:"w-4 h-4 ml-2"}),"إلغاء"]}),p.jsxs(Qi,{onClick:()=>m(this,null,function*(){if(h.session_type&&h.session_title&&h.session_date)try{yield n(h),x({tooth_treatment_id:e.id,session_date:(new Date).toISOString().split("T")[0],session_status:"planned",duration_minutes:30,cost:0}),l(!1),rc.success("تم إضافة الجلسة بنجاح")}catch(t){rc.error("فشل في إضافة الجلسة")}else rc.error("يرجى ملء جميع الحقول المطلوبة")}),children:[p.jsx(pi,{className:"w-4 h-4 ml-2"}),"حفظ الجلسة"]})]})]})]}),0===t.length&&!i&&p.jsx(Lo,{className:aa("text-center py-8",r?"bg-gray-800/50":"bg-gray-50"),children:p.jsxs(Yo,{children:[p.jsx(hr,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),p.jsx("p",{className:"text-muted-foreground",children:"لا توجد جلسات مسجلة لهذا العلاج"}),p.jsxs(Qi,{onClick:()=>l(!0),className:"mt-4 action-btn-sessions sessions-outline",variant:"outline",children:[p.jsx(di,{className:"w-4 h-4 ml-2"}),"إضافة أول جلسة"]})]})})]})}function mC({patientId:e,toothNumber:t,toothName:n,treatments:a,onAddTreatment:s,onUpdateTreatment:r,onDeleteTreatment:i,onReorderTreatments:l,onSessionStatsUpdate:c,onTreatmentUpdate:u}){const{isDarkMode:h}=Gt(),{createPayment:x,updatePayment:g,getPaymentsByPatient:f}=Go(),{patients:v}=cl(),{labs:y,loadLabs:b}=i$(),{createLabOrder:j,updateLabOrder:w,deleteLabOrder:N,getLabOrdersByTreatment:_}=Th(),[k,S]=ve.useState(!1),[D,$]=ve.useState(null),[C,E]=ve.useState(""),[T,A]=ve.useState(!1),[F,P]=ve.useState(null),[O,R]=ve.useState(""),[M,L]=ve.useState(0);ve.useState(""),ve.useState(0);const[I,z]=ve.useState({patient_id:e,tooth_number:t,tooth_name:n,treatment_status:"planned",cost:0,start_date:(new Date).toISOString().split("T")[0]}),[B,Y]=ve.useState({}),[V,q]=ve.useState(null);ve.useEffect(()=>{b()},[b]);const U=[...a].sort((e,t)=>e.priority-t.priority),H=e=>{switch(e){case"planned":return p.jsx(Sr,{className:"w-4 h-4 text-blue-500"});case"in_progress":return p.jsx(oi,{className:"w-4 h-4 text-yellow-500"});case"completed":return p.jsx(gr,{className:"w-4 h-4 text-green-500"});case"cancelled":return p.jsx(Ri,{className:"w-4 h-4 text-gray-500"});default:return p.jsx(ar,{className:"w-4 h-4 text-gray-400"})}},G=e=>{const t=rd.find(t=>t.value===e);return(null==t?void 0:t.color)||"#6b7280"},W=a=>m(this,null,function*(){if(console.log("💰 [DEBUG] createPendingPaymentForTreatment called:",{treatmentId:a,cost:I.cost,patientId:e}),!a)throw console.error("❌ [DEBUG] Cannot create payment - missing treatment ID"),new Error("معرف العلاج مطلوب لإنشاء الدفعة");if(!I.cost||I.cost<=0)console.log("⚠️ [DEBUG] Skipping payment creation - no cost specified");else try{const s=v.find(t=>t.id===e);if(!s)throw new Error("لم يتم العثور على بيانات المريض");const r=nd(I.treatment_type),i=`علاج ${(null==r?void 0:r.label)||I.treatment_type} - سن ${n||t}`,l={patient_id:e,tooth_treatment_id:a,amount:0,payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:i,status:"pending",notes:`دفعة معلقة للمريض: ${s.full_name} - السن: ${n} - العلاج: ${(null==r?void 0:r.label)||I.treatment_type}`,total_amount_due:I.cost,amount_paid:0,remaining_balance:I.cost,treatment_total_cost:I.cost,treatment_total_paid:0,treatment_remaining_balance:I.cost};console.log("💰 [DEBUG] Creating payment with data:",l),yield x(l),console.log("✅ [DEBUG] Payment created successfully for treatment:",a),rc.success("تم إنشاء دفعة معلقة في جدول المدفوعات")}catch(s){console.error("❌ [DEBUG] Payment creation failed:",s);const e=s instanceof Error?s.message:"خطأ غير معروف";throw rc.error(`فشل في إنشاء الدفعة المعلقة: ${e}`),s}}),K=a=>m(this,null,function*(){if(!a)throw new Error("معرف العلاج مطلوب لإنشاء طلب المختبر");if(O&&!(M<=0))try{const s=v.find(t=>t.id===e),r=nd(I.treatment_type);if(!s)throw new Error("لم يتم العثور على بيانات المريض");const i={lab_id:O,patient_id:e,tooth_treatment_id:a,tooth_number:t,service_name:`${(null==r?void 0:r.label)||"علاج تعويضات"} - السن ${t}`,cost:M,order_date:(new Date).toISOString().split("T")[0],status:"معلق",notes:`طلب مخبر للمريض: ${s.full_name} - السن: ${n} - العلاج: ${(null==r?void 0:r.label)||I.treatment_type}`,paid_amount:0,remaining_balance:M};yield j(i);_(a).length>0?rc.success("تم إنشاء طلب المختبر وربطه بالعلاج بنجاح"):rc.warning("تم إنشاء طلب المختبر ولكن قد تحتاج لإعادة تحميل الصفحة للتحقق من الربط")}catch(s){console.error("❌ [DEBUG] Lab order creation failed:",s);const e=s instanceof Error?s.message:"خطأ غير معروف";throw rc.error(`فشل في إنشاء طلب المختبر: ${e}`),s}}),Z=(e,t)=>m(this,null,function*(){try{console.log("🦷 MultipleToothTreatments: Updating treatment:",e,t),yield r(e,t),console.log("🦷 MultipleToothTreatments: onUpdateTreatment completed"),$(null),null==u||u(),console.log("🦷 MultipleToothTreatments: Treatment updated successfully"),rc.success("تم تحديث العلاج بنجاح")}catch(n){console.error("🦷 MultipleToothTreatments: Error updating treatment:",n),n&&"object"==typeof n&&"message"in n&&console.error("🦷 MultipleToothTreatments: Error message:",n.message),rc.error("فشل في تحديث العلاج")}}),Q=e=>m(this,null,function*(){P(e),A(!0)}),X=e=>m(this,null,function*(){if(0===e)return;const t=[...U],n=t[e];t[e]=t[e-1],t[e-1]=n;const a=t.map(e=>e.id);yield l(a)}),J=e=>m(this,null,function*(){if(e===U.length-1)return;const t=[...U],n=t[e];t[e]=t[e+1],t[e+1]=n;const a=t.map(e=>e.id);yield l(a)}),ee=C?td(C):Jo,te=(e=>{if("التعويضات"!==C)return e;return{groups:{crowns:e.filter(e=>e.value.includes("crown")&&!e.value.includes("implant")),bridges:e.filter(e=>e.value.includes("bridge")),dentures:e.filter(e=>e.value.includes("denture")),implants:e.filter(e=>e.value.includes("implant")),posts:e.filter(e=>e.value.includes("post")||e.value.includes("core")),veneers:e.filter(e=>e.value.includes("veneer"))},isGrouped:!0}})(ee),ne=e=>m(this,null,function*(){try{const t=yield window.electronAPI.treatmentSessions.getByTreatment(e);Y(n=>d(o({},n),{[e]:t}))}catch(t){console.error("Error loading treatment sessions:",t),rc.error("فشل في تحميل جلسات العلاج")}}),ae=(e,t)=>m(this,null,function*(){try{yield window.electronAPI.treatmentSessions.create(t),yield ne(e),null==c||c(),rc.success("تم إضافة الجلسة بنجاح")}catch(n){console.error("Error adding session:",n),rc.error("فشل في إضافة الجلسة")}}),se=(e,t,n)=>m(this,null,function*(){try{yield window.electronAPI.treatmentSessions.update(t,n),yield ne(e),null==c||c(),rc.success("تم تحديث الجلسة بنجاح")}catch(a){console.error("Error updating session:",a),rc.error("فشل في تحديث الجلسة")}}),re=(e,t)=>m(this,null,function*(){try{yield window.electronAPI.treatmentSessions.delete(t),yield ne(e),null==c||c(),rc.success("تم حذف الجلسة بنجاح")}catch(n){console.error("Error deleting session:",n),rc.error("فشل في حذف الجلسة")}});return ve.useEffect(()=>{V&&ne(V)},[V]),p.jsxs("div",{className:"space-y-4",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs("h3",{className:"text-lg font-semibold",children:["علاجات السن رقم ",t]}),p.jsx("p",{className:"text-sm text-muted-foreground",children:n})]}),p.jsxs(Qi,{onClick:()=>S(!0),className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[p.jsx(di,{className:"w-4 h-4 ml-2"}),"إضافة علاج"]})]}),p.jsx("div",{className:"space-y-3",children:0===U.length?p.jsx(Lo,{children:p.jsx(Yo,{className:"p-6 text-center",children:p.jsx("p",{className:"text-muted-foreground",children:"لا توجد علاجات مسجلة لهذا السن"})})}):U.map((e,t)=>{var n,a,s,r;return p.jsxs(Lo,{className:"relative",children:[p.jsx(Io,{className:"pb-3",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:["#",e.priority]}),p.jsxs("div",{className:"flex flex-col gap-1",children:[p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>X(t),disabled:0===t,className:"h-6 w-6 p-0",children:p.jsx(or,{className:"w-3 h-3"})}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>J(t),disabled:t===U.length-1,className:"h-6 w-6 p-0",children:p.jsx(rr,{className:"w-3 h-3"})})]})]}),p.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-white",style:{backgroundColor:e.treatment_color}}),p.jsxs("div",{children:[p.jsx(zo,{className:"text-base",children:(null==(n=nd(e.treatment_type))?void 0:n.label)||e.treatment_type}),p.jsx(Bo,{children:null==(r=e.treatment_category,a=ed.find(e=>e.value===r))?void 0:a.label})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(qo,{variant:"secondary",style:{backgroundColor:G(e.treatment_status)+"20",color:G(e.treatment_status)},children:[H(e.treatment_status),p.jsx("span",{className:"mr-1",children:null==(s=rd.find(t=>t.value===e.treatment_status))?void 0:s.label})]}),p.jsxs(Qi,{variant:V===e.id?"default":"outline",size:"sm",onClick:()=>q(V===e.id?null:e.id),className:aa("action-btn-sessions gap-1.5",V===e.id?"sessions-selected bg-blue-600 hover:bg-blue-700 text-white shadow-md":"sessions-outline border-blue-200 text-blue-700 dark:border-blue-700 dark:text-blue-300"),title:"إدارة جلسات العلاج",children:[p.jsx(hr,{className:"w-4 h-4"}),p.jsx("span",{className:"text-xs font-medium",children:"الجلسات"})]}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>$(e.id),children:p.jsx(si,{className:"w-4 h-4"})}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>Q(e.id),className:"text-red-600 hover:text-red-700",children:p.jsx(Ni,{className:"w-4 h-4"})})]})]})}),p.jsxs(Yo,{className:"pt-0",children:[p.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.cost&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Er,{className:"w-4 h-4 text-muted-foreground"}),p.jsxs("span",{children:["$",e.cost]})]}),e.start_date&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(hr,{className:"w-4 h-4 text-muted-foreground"}),p.jsx("span",{children:ma(e.start_date)})]}),e.completion_date&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(gr,{className:"w-4 h-4 text-green-500"}),p.jsx("span",{children:ma(e.completion_date)})]})]}),e.notes&&p.jsx("p",{className:"text-sm text-muted-foreground mt-2 p-2 bg-muted rounded",children:e.notes})]})]},e.id)})}),D&&p.jsxs(Lo,{className:aa("border-2 shadow-lg !border-solid",h?"!border-orange-800/50 bg-orange-950/20 shadow-orange-900/20":"!border-orange-200 bg-orange-50/50 shadow-orange-100/50"),children:[p.jsx(Io,{className:aa("border-b",h?"border-orange-800/30":"border-orange-200/50"),children:p.jsx(zo,{className:aa("text-lg",h?"text-orange-200":"text-orange-900"),children:"تعديل العلاج"})}),p.jsx(Yo,{className:"space-y-4",children:(()=>{const e=a.find(e=>e.id===D);return e?p.jsx(pC,{treatment:e,onSave:Z,onCancel:()=>$(null)}):null})()})]}),V&&p.jsxs(Lo,{className:aa("border-2 shadow-lg",h?"border-blue-800/50 bg-blue-950/20 shadow-blue-900/20":"border-blue-200 bg-blue-50/50 shadow-blue-100/50"),children:[p.jsxs(Io,{className:aa("border-b",h?"border-blue-800/30":"border-blue-200/50"),children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx(zo,{className:aa("text-lg",h?"text-blue-200":"text-blue-900"),children:"إدارة جلسات العلاج"}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>q(null),children:p.jsx(Mi,{className:"w-4 h-4"})})]}),p.jsx(Bo,{children:(()=>{var e;const t=a.find(e=>e.id===V);return t?`${(null==(e=nd(t.treatment_type))?void 0:e.label)||t.treatment_type}`:""})()})]}),p.jsx(Yo,{className:"p-6",children:(()=>{const e=a.find(e=>e.id===V);return e?p.jsx(uC,{treatment:e,sessions:B[V]||[],onAddSession:e=>ae(V,e),onUpdateSession:(e,t)=>se(V,e,t),onDeleteSession:e=>re(V,e)}):null})()})]}),k&&p.jsxs(Lo,{className:aa("border-2 shadow-lg",h?"border-blue-800/50 bg-blue-950/20 shadow-blue-900/20":"border-blue-200 bg-blue-50/50 shadow-blue-100/50"),children:[p.jsx(Io,{className:aa("border-b",h?"border-blue-800/30":"border-blue-200/50"),children:p.jsx(zo,{className:aa("text-lg",h?"text-blue-200":"text-blue-900"),children:"إضافة علاج جديد"})}),p.jsxs(Yo,{className:aa("space-y-4 p-6",h?"bg-blue-950/10":"bg-blue-50/30"),children:[p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:aa("font-medium",h?"text-blue-200":"text-blue-800"),children:"تصنيف العلاج"}),p.jsxs(el,{value:C,onValueChange:e=>{E(e),z(t=>d(o({},t),{treatment_category:e}))},children:[p.jsx(al,{className:aa("border-2 transition-colors",h?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500"),children:p.jsx(nl,{placeholder:"اختر التصنيف"})}),p.jsx(il,{children:ed.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:e.icon}),p.jsx("span",{children:e.label})]})},e.value))})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:aa("font-medium",h?"text-blue-200":"text-blue-800"),children:"نوع العلاج"}),p.jsxs(el,{value:I.treatment_type||"",onValueChange:e=>z(t=>d(o({},t),{treatment_type:e})),disabled:!C,children:[p.jsx(al,{className:aa("border-2 transition-colors",!C&&"opacity-50 cursor-not-allowed",h?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500"),children:p.jsx(nl,{placeholder:"اختر نوع العلاج"})}),p.jsx(il,{className:"max-h-80",children:"التعويضات"===C&&te.isGrouped?p.jsxs(p.Fragment,{children:[te.groups.crowns.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-purple-600 dark:text-purple-400",children:"👑 التيجان"}),te.groups.crowns.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value)),p.jsx(ol,{})]}),te.groups.bridges.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-orange-600 dark:text-orange-400",children:"🌉 الجسور"}),te.groups.bridges.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value)),p.jsx(ol,{})]}),te.groups.dentures.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-blue-600 dark:text-blue-400",children:"🦷 الأجهزة المتحركة"}),te.groups.dentures.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value)),p.jsx(ol,{})]}),te.groups.implants.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:"🔩 تعويضات الزرعات"}),te.groups.implants.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value)),p.jsx(ol,{})]}),te.groups.posts.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:"🔧 القلوب والأوتاد"}),te.groups.posts.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value)),p.jsx(ol,{})]}),te.groups.veneers.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-pink-600 dark:text-pink-400",children:"✨ الفينير"}),te.groups.veneers.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value))]})]}):ee.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value))})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:aa("font-medium",h?"text-blue-200":"text-blue-800"),children:"حالة العلاج"}),p.jsxs(el,{value:I.treatment_status||"planned",onValueChange:e=>{z(t=>d(o({},t),{treatment_status:e})),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("tooth-color-update",{detail:{type:"status-preview-new",newStatus:e,timestamp:Date.now()}}))},children:[p.jsx(al,{className:aa("border-2 transition-colors",h?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500"),children:p.jsx(nl,{})}),p.jsx(il,{children:rd.map(e=>p.jsx(dl,{value:e.value,children:e.label},e.value))})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:aa("font-medium",h?"text-blue-200":"text-blue-800"),children:"التكلفة ($)"}),p.jsx(Xi,{type:"number",min:"0",step:"1",value:I.cost||"",onChange:e=>{const t=e.target.value;z(e=>d(o({},e),{cost:""===t?0:parseFloat(t)||0}))},onBlur:e=>{const t=parseFloat(e.target.value)||0;z(e=>d(o({},e),{cost:t}))},placeholder:"0.00",className:aa("border-2 transition-colors",h?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500")}),I.cost&&I.cost>0&&p.jsx("p",{className:aa("text-xs",h?"text-blue-300":"text-blue-600"),children:"💡 سيتم إنشاء دفعة معلقة في جدول المدفوعات"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:aa("font-medium",h?"text-blue-200":"text-blue-800"),children:"تاريخ العلاج"}),p.jsx(Xi,{type:"date",value:I.start_date||"",onChange:e=>z(t=>d(o({},t),{start_date:e.target.value})),className:aa("border-2 transition-colors",h?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500")})]})]}),"التعويضات"===C&&p.jsxs("div",{className:aa("grid grid-cols-1 md:grid-cols-2 gap-4 p-5 rounded-xl border-2 shadow-sm transition-all duration-200",h?"bg-gradient-to-br from-purple-950/40 to-purple-900/30 border-purple-700/50 shadow-purple-900/20":"bg-gradient-to-br from-purple-50 to-purple-100/60 border-purple-300/70 shadow-purple-200/30"),children:[p.jsx("div",{className:"md:col-span-2 mb-3",children:p.jsxs("div",{className:aa("flex items-center gap-3 text-sm font-semibold",h?"text-purple-200":"text-purple-800"),children:[p.jsx("div",{className:aa("w-8 h-8 rounded-lg flex items-center justify-center text-lg",h?"bg-purple-800/50 text-purple-200":"bg-purple-200/80 text-purple-800"),children:"🏭"}),p.jsx("span",{children:"إعدادات المخبر"})]})}),p.jsxs("div",{className:"space-y-3",children:[p.jsx(Ro,{className:aa("font-medium flex items-center gap-2 text-sm",h?"text-purple-100":"text-purple-900"),children:"🏭 اختيار المخبر"}),p.jsxs(el,{value:O,onValueChange:R,children:[p.jsx(al,{className:aa("border-2 transition-all duration-200 h-11",h?"border-purple-700/50 bg-purple-950/40 hover:border-purple-600 focus:border-purple-500 text-purple-100":"border-purple-300/70 bg-white hover:border-purple-400 focus:border-purple-500 text-purple-900"),children:p.jsx(nl,{placeholder:"اختر المخبر"})}),p.jsx(il,{className:aa(h?"bg-purple-950 border-purple-700":"bg-white border-purple-200"),children:y.map(e=>p.jsx(dl,{value:e.id,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:"🏭"}),p.jsx("span",{children:e.name})]})},e.id))})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx(Ro,{className:aa("font-medium flex items-center gap-2 text-sm",h?"text-purple-100":"text-purple-900"),children:"💰 تكلفة المخبر ($)"}),p.jsx(Xi,{type:"number",min:"0",step:"1",value:M||"",onChange:e=>{const t=e.target.value;L(""===t?0:parseFloat(t)||0)},onBlur:e=>{const t=parseFloat(e.target.value)||0;L(t)},placeholder:"0.00",className:aa("border-2 transition-all duration-200 h-11",h?"border-purple-700/50 bg-purple-950/40 hover:border-purple-600 focus:border-purple-500 text-purple-100 placeholder:text-purple-400":"border-purple-300/70 bg-white hover:border-purple-400 focus:border-purple-500 text-purple-900 placeholder:text-purple-500")}),M>0&&p.jsxs("div",{className:aa("flex items-center gap-2 p-2 rounded-lg text-xs",h?"bg-purple-900/30 text-purple-200 border border-purple-700/30":"bg-purple-100/60 text-purple-700 border border-purple-200/50"),children:[p.jsx("span",{className:"text-sm",children:"🏭"}),p.jsx("span",{children:"سيتم إنشاء طلب مخبر تلقائياً"})]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:aa("font-medium",h?"text-blue-200":"text-blue-800"),children:"ملاحظات"}),p.jsx(Ji,{value:I.notes||"",onChange:e=>z(t=>d(o({},t),{notes:e.target.value})),placeholder:"أدخل أي ملاحظات إضافية...",rows:3,className:aa("border-2 transition-colors resize-none",h?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500")})]}),p.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-blue-200/50 dark:border-blue-800/30",children:[p.jsxs(Qi,{variant:"outline",onClick:()=>{S(!1),E(""),z({patient_id:e,tooth_number:t,tooth_name:n,treatment_status:"planned",cost:0,start_date:(new Date).toISOString().split("T")[0]})},className:aa("border-2 transition-all duration-200",h?"border-gray-600 text-gray-300 hover:border-gray-500 hover:bg-gray-800":"border-gray-300 text-gray-700 hover:border-gray-400 hover:bg-gray-50"),children:[p.jsx(Mi,{className:"w-4 h-4 ml-2"}),"إلغاء"]}),p.jsxs(Qi,{onClick:()=>m(this,null,function*(){var a;if(!I.treatment_type||!I.treatment_category)return void rc.error("يرجى اختيار نوع العلاج والتصنيف");if("التعويضات"===I.treatment_category&&M>0&&!O)return void rc.error("يرجى اختيار المختبر عند إدخال تكلفة المختبر للتعويضات");let r=null;try{console.log("🚀 [DEBUG] Starting treatment creation process:",{treatmentType:I.treatment_type,category:I.treatment_category,cost:I.cost,isProsthetic:"التعويضات"===I.treatment_category,hasLabData:!!O&&M>0});const c=d(o({},I),{treatment_color:(null==(a=nd(I.treatment_type))?void 0:a.color)||"#22c55e"}),u=yield s(c);if(!u)throw new Error("فشل في إنشاء العلاج");if(r=u.id,console.log("✅ [DEBUG] Treatment created successfully:",r),I.cost&&I.cost>0){console.log("💰 [DEBUG] Creating payment for treatment:",r);try{yield W(r),console.log("✅ [DEBUG] Payment created successfully for treatment:",r)}catch(i){console.error("❌ [DEBUG] Payment creation failed:",i),rc.warning("تم إنشاء العلاج ولكن فشل في إنشاء الدفعة")}}if("التعويضات"===I.treatment_category&&O&&M>0)try{yield K(r)}catch(l){rc.warning("تم إنشاء العلاج والدفعة ولكن فشل في إنشاء طلب المختبر")}z({patient_id:e,tooth_number:t,tooth_name:n,treatment_status:"planned",cost:0,start_date:(new Date).toISOString().split("T")[0]}),E(""),R(""),L(0),S(!1),rc.success("تم إضافة العلاج بنجاح مع جميع المكونات المطلوبة")}catch(c){rc.error("فشل في إضافة العلاج - يرجى المحاولة مرة أخرى")}}),className:aa("transition-all duration-200 shadow-lg",h?"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-900/30":"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-500/30"),children:[p.jsx(pi,{className:"w-4 h-4 ml-2"}),"حفظ العلاج"]})]})]})]}),p.jsx(Gl,{open:T,onOpenChange:A,children:p.jsxs(Zl,{className:"max-w-md",dir:"rtl",children:[p.jsx(Ql,{children:p.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[p.jsx("div",{className:"flex-shrink-0",children:p.jsx(sr,{className:"w-8 h-8 text-destructive"})}),p.jsxs("div",{children:[p.jsx(Jl,{children:"هل أنت متأكد من حذف هذا العلاج؟"}),p.jsx(eo,{children:"هذا الإجراء لا يمكن التراجع عنه. سيتم حذف العلاج وجميع البيانات المرتبطة به نهائياً."})]})]})}),F&&(()=>{var e;const s=a.find(e=>e.id===F);return s?p.jsxs("div",{className:"my-4",children:[p.jsxs("div",{className:"bg-muted/50 border border-border rounded-lg p-4",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[p.jsx(Ni,{className:"w-5 h-5 text-destructive"}),p.jsxs("div",{children:[p.jsx("h4",{className:"font-medium text-foreground",children:(null==(e=nd(s.treatment_type))?void 0:e.label)||s.treatment_type}),p.jsxs("p",{className:"text-sm text-muted-foreground",children:["السن: ",n," (#",t,")"]})]})]}),s.notes&&p.jsxs("div",{className:"text-sm text-muted-foreground",children:[p.jsx("strong",{children:"الملاحظات:"})," ",s.notes]})]}),p.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 mt-4",children:p.jsxs("div",{className:"flex",children:[p.jsx(sr,{className:"w-5 h-5 text-destructive mt-0.5 ml-2"}),p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-medium text-destructive",children:"تحذير مهم"}),p.jsx("p",{className:"text-sm text-destructive/80 mt-1",children:"سيتم حذف جميع البيانات المرتبطة بهذا العلاج بما في ذلك:"}),p.jsxs("ul",{className:"text-sm text-destructive/80 mt-2 list-disc list-inside",children:[p.jsx("li",{children:"جلسات العلاج المسجلة"}),p.jsx("li",{children:"المدفوعات المرتبطة"}),p.jsx("li",{children:"طلبات المختبر (إن وجدت)"}),p.jsx("li",{children:"الصور والملفات المرفقة"})]})]})]})})]}):null})(),p.jsxs(Xl,{className:"flex justify-end space-x-3 space-x-reverse",children:[p.jsx(no,{children:"إلغاء"}),p.jsxs(to,{onClick:()=>m(this,null,function*(){if(F)try{yield i(F),rc.success("تم حذف العلاج بنجاح"),A(!1),P(null)}catch(e){rc.error("فشل في حذف العلاج")}}),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[p.jsx(Ni,{className:"w-4 h-4 ml-2"}),"تأكيد الحذف"]})]})]})})]})}function pC({treatment:e,onSave:t,onCancel:n}){const{isDarkMode:a}=Gt(),{createPayment:s,updatePayment:r,getPaymentsByPatient:i}=Go(),{patients:l}=cl(),{labs:c,loadLabs:u}=i$(),{createLabOrder:h,getLabOrdersByTreatment:x,updateLabOrder:g,deleteLabOrder:f,loadLabOrders:v}=Th(),[y,b]=ve.useState({treatment_type:e.treatment_type,treatment_category:e.treatment_category,treatment_status:e.treatment_status,cost:e.cost,start_date:e.start_date,completion_date:e.completion_date,notes:e.notes}),[j,w]=ve.useState(e.treatment_category||""),[N]=ve.useState(e.cost||0),[_,k]=ve.useState(""),[S,D]=ve.useState(0),[$,C]=ve.useState(!1);ve.useState(!1);const E=t=>m(this,null,function*(){var n,a;try{const r=(yield null==(a=null==(n=window.electronAPI)?void 0:n.labOrders)?void 0:a.getAll())||[],i=r.find(e=>e.tooth_treatment_id===t);if(i)return i;const l=r.find(t=>!t.tooth_treatment_id&&t.patient_id===e.patient_id);if(l)try{return yield g(l.id,{tooth_treatment_id:t,tooth_number:e.tooth_number}),d(o({},l),{tooth_treatment_id:t})}catch(s){return l}return null}catch(r){return null}}),T=()=>m(this,null,function*(){if("التعويضات"===e.treatment_category){const t=yield E(e.id);t?(k(t.lab_id||""),D(t.cost||0),rc.success("تم إعادة تحميل بيانات المختبر")):(k(""),D(0),rc.info("لا يوجد طلب مختبر لهذا العلاج"))}else rc.info("هذا العلاج ليس من فئة التعويضات")});ve.useEffect(()=>{(()=>{m(this,null,function*(){try{if(C(!1),yield u(),w(e.treatment_category||""),"التعويضات"===e.treatment_category){const t=yield E(e.id);t?(k(t.lab_id||""),D(t.cost||0)):(k(""),D(0))}else k(""),D(0);C(!0)}catch(t){k(""),D(0),C(!0)}})})()},[e.id,e.treatment_category,u]),ve.useEffect(()=>{"التعويضات"!==j&&(k(""),D(0))},[j]),ve.useEffect(()=>{console.log("🔍 Lab values changed:",{selectedLab:_,labCost:S,isLabDataLoaded:$,treatmentId:e.id,category:e.treatment_category})},[_,S,$,e.id,e.treatment_category]);const A=j?td(j):[],F=(e=>{if("التعويضات"!==j)return e;return{groups:{crowns:e.filter(e=>e.value.includes("crown")&&!e.value.includes("implant")),bridges:e.filter(e=>e.value.includes("bridge")),dentures:e.filter(e=>e.value.includes("denture")),implants:e.filter(e=>e.value.includes("implant")),posts:e.filter(e=>e.value.includes("post")||e.value.includes("core")),veneers:e.filter(e=>e.value.includes("veneer"))},isGrouped:!0}})(A),P=()=>m(this,null,function*(){try{if(!l.find(t=>t.id===e.patient_id))return void rc.error("لم يتم العثور على بيانات المريض");const t=i(e.patient_id).filter(t=>t.tooth_treatment_id===e.id),n=nd(y.treatment_type),a=`علاج ${(null==n?void 0:n.label)||y.treatment_type} - سن ${e.tooth_name||e.tooth_number}`;if(t.length>0){const n=t.reduce((e,t)=>e+t.amount,0),s=y.cost||0,i=Math.max(0,s-n);let l;l=s<=0||i<=0&&n>0?"completed":n>0?"partial":"pending";for(const o of t){const t={tooth_treatment_id:e.id,description:a,notes:`دفعة لعلاج سن ${e.tooth_name||e.tooth_number} (تم تعديل التكلفة)`,total_amount_due:s,remaining_balance:i,treatment_total_cost:s,treatment_total_paid:n,treatment_remaining_balance:i,status:l};yield r(o.id,t)}rc.success("تم تحديث المدفوعات المرتبطة بالعلاج")}else if((y.cost||0)>0){const t={patient_id:e.patient_id,tooth_treatment_id:e.id,amount:0,payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:a,status:"pending",notes:`دفعة معلقة لعلاج سن ${e.tooth_name||e.tooth_number} (تم تعديل التكلفة)`,total_amount_due:y.cost||0,amount_paid:0,remaining_balance:y.cost||0,treatment_total_cost:y.cost||0,treatment_total_paid:0,treatment_remaining_balance:y.cost||0};yield s(t),rc.success("تم إنشاء دفعة معلقة في جدول المدفوعات")}}catch(t){console.error("خطأ في تحديث المدفوعات:",t),rc.error("فشل في تحديث المدفوعات")}});return p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"تصنيف العلاج"}),p.jsxs(el,{value:j,onValueChange:e=>{w(e),b(t=>d(o({},t),{treatment_category:e}))},children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر التصنيف"})}),p.jsx(il,{children:ed.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:e.icon}),p.jsx("span",{children:e.label})]})},e.value))})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"نوع العلاج"}),p.jsxs(el,{value:y.treatment_type||"",onValueChange:e=>b(t=>d(o({},t),{treatment_type:e})),disabled:!j,children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر نوع العلاج"})}),p.jsx(il,{className:"max-h-80",children:"التعويضات"===j&&F.isGrouped?p.jsxs(p.Fragment,{children:[F.groups.crowns.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-purple-600 dark:text-purple-400",children:"👑 التيجان"}),F.groups.crowns.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value)),p.jsx(ol,{})]}),F.groups.bridges.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-orange-600 dark:text-orange-400",children:"🌉 الجسور"}),F.groups.bridges.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value)),p.jsx(ol,{})]}),F.groups.dentures.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-blue-600 dark:text-blue-400",children:"🦷 الأجهزة المتحركة"}),F.groups.dentures.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value)),p.jsx(ol,{})]}),F.groups.implants.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:"🔩 تعويضات الزرعات"}),F.groups.implants.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value)),p.jsx(ol,{})]}),F.groups.posts.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:"🔧 القلوب والأوتاد"}),F.groups.posts.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value)),p.jsx(ol,{})]}),F.groups.veneers.length>0&&p.jsxs(tl,{children:[p.jsx(ll,{className:"flex items-center gap-2 text-pink-600 dark:text-pink-400",children:"✨ الفينير"}),F.groups.veneers.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value))]})]}):A.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value))})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"حالة العلاج"}),p.jsxs(el,{value:y.treatment_status||"planned",onValueChange:t=>{b(e=>d(o({},e),{treatment_status:t,completion_date:"completed"!==t||e.completion_date?e.completion_date:(new Date).toISOString().split("T")[0]})),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("tooth-color-update",{detail:{type:"status-preview",treatmentId:e.id,newStatus:t,timestamp:Date.now()}}))},children:[p.jsx(al,{children:p.jsx(nl,{})}),p.jsx(il,{children:rd.map(e=>p.jsx(dl,{value:e.value,children:e.label},e.value))})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{className:aa("font-medium",a?"text-orange-200":"text-orange-800"),children:"التكلفة ($)"}),p.jsx(Xi,{type:"number",min:"0",step:"1",value:y.cost||"",onChange:e=>{e.stopPropagation();const t=e.target.value;b(e=>d(o({},e),{cost:""===t?0:parseFloat(t)||0}))},onBlur:e=>{e.stopPropagation();const t=parseFloat(e.target.value)||0;b(e=>d(o({},e),{cost:t}))},onInput:e=>{e.stopPropagation(),e.nativeEvent&&e.nativeEvent.stopImmediatePropagation&&e.nativeEvent.stopImmediatePropagation()},onKeyDown:e=>{if("Escape"===e.key)return e.preventDefault(),void b(e=>d(o({},e),{cost:0}));["Backspace","Delete","Tab","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","."].includes(e.key)||e.key>="0"&&e.key<="9"||e.ctrlKey&&["a","c","v","x","z"].includes(e.key.toLowerCase())||e.preventDefault()},onFocus:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation()},placeholder:"0.00","data-prevent-shortcuts":"true",className:aa("border-2 transition-colors",a?"border-orange-800/50 bg-orange-950/30 hover:border-orange-700 focus:border-orange-600":"border-orange-200 bg-white hover:border-orange-300 focus:border-orange-500")}),y.cost&&y.cost>0&&y.cost!==N&&p.jsx("p",{className:aa("text-xs",a?"text-orange-300":"text-orange-600"),children:"💡 سيتم إنشاء دفعة معلقة عند تعديل التكلفة"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"تاريخ العلاج"}),p.jsx(Xi,{type:"date",value:y.start_date||"",onChange:e=>b(t=>d(o({},t),{start_date:e.target.value})),onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key)return e.preventDefault(),void e.stopPropagation()},onFocus:e=>e.stopPropagation(),onClick:e=>e.stopPropagation(),"data-prevent-shortcuts":"true"})]})]}),("التعويضات"===j||"التعويضات"===e.treatment_category)&&p.jsxs("div",{className:aa("grid grid-cols-1 md:grid-cols-2 gap-4 p-5 rounded-xl border-2 shadow-sm transition-all duration-200",a?"bg-gradient-to-br from-purple-950/30 to-purple-900/20 border-purple-700/40 shadow-purple-900/10":"bg-gradient-to-br from-purple-50 to-purple-100/50 border-purple-300/60 shadow-purple-200/20"),children:[p.jsx("div",{className:"md:col-span-2 mb-2",children:p.jsxs("div",{className:aa("flex items-center gap-3 text-sm font-semibold",a?"text-purple-200":"text-purple-800"),children:[p.jsx("div",{className:aa("w-8 h-8 rounded-lg flex items-center justify-center text-lg",a?"bg-purple-800/40 text-purple-200":"bg-purple-200/60 text-purple-700"),children:"🏭"}),p.jsx("span",{children:"معلومات المخبر"}),p.jsx("button",{type:"button",onClick:T,className:aa("text-xs px-2 py-1 rounded hover:scale-105 transition-all",a?"bg-purple-700/50 text-purple-200 hover:bg-purple-600/50":"bg-purple-200 text-purple-700 hover:bg-purple-300"),title:"إعادة تحميل بيانات المخبر وربط الطلبات غير المرتبطة",children:"🔄"}),p.jsx("button",{type:"button",onClick:()=>m(this,null,function*(){(yield linkUnlinkedLabOrder(e.id))?yield T():rc.info("لا توجد طلبات مخبر غير مرتبطة لهذا المريض")}),className:aa("text-xs px-2 py-1 rounded hover:scale-105 transition-all",a?"bg-blue-700/50 text-blue-200 hover:bg-blue-600/50":"bg-blue-200 text-blue-700 hover:bg-blue-300"),title:"ربط طلبات المخبر غير المرتبطة",children:"🔗"}),p.jsx("div",{className:aa("h-px flex-1 ml-2",a?"bg-purple-700/30":"bg-purple-300/50")})]})}),p.jsxs("div",{className:"space-y-3",children:[p.jsxs(Ro,{className:aa("font-medium flex items-center gap-2 text-sm",a?"text-purple-100":"text-purple-900"),children:["🏭 اختيار المخبر",!$&&p.jsx("span",{className:"text-xs animate-pulse",children:"⏳ جاري التحميل..."})]}),p.jsxs(el,{value:_,onValueChange:k,children:[p.jsx(al,{className:aa("border-2 transition-all duration-200 h-11",a?"border-purple-700/50 bg-purple-950/40 hover:border-purple-600 focus:border-purple-500 text-purple-100":"border-purple-300/70 bg-white hover:border-purple-400 focus:border-purple-500 text-purple-900"),children:p.jsx(nl,{placeholder:"اختر المخبر"})}),p.jsx(il,{className:aa(a?"bg-purple-950 border-purple-700":"bg-white border-purple-200"),children:c.map(e=>p.jsx(dl,{value:e.id,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:"🏭"}),p.jsx("span",{children:e.name})]})},e.id))})]},`lab-select-${e.id}-${_}`)]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx(Ro,{className:aa("font-medium flex items-center gap-2 text-sm",a?"text-purple-100":"text-purple-900"),children:"💰 تكلفة المخبر ($)"}),p.jsx(Xi,{type:"number",min:"0",step:"1",value:S||"",onChange:e=>{e.stopPropagation();const t=e.target.value;D(""===t?0:parseFloat(t)||0)},onBlur:e=>{e.stopPropagation();const t=parseFloat(e.target.value)||0;D(t)},onInput:e=>{e.stopPropagation(),e.nativeEvent&&e.nativeEvent.stopImmediatePropagation&&e.nativeEvent.stopImmediatePropagation()},onKeyDown:e=>{if("Escape"===e.key)return e.preventDefault(),void D(0);["Backspace","Delete","Tab","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","."].includes(e.key)||e.key>="0"&&e.key<="9"||e.ctrlKey&&["a","c","v","x","z"].includes(e.key.toLowerCase())||e.preventDefault()},placeholder:"0.00",className:aa("border-2 transition-all duration-200 h-11",a?"border-purple-700/50 bg-purple-950/40 hover:border-purple-600 focus:border-purple-500 text-purple-100 placeholder:text-purple-400":"border-purple-300/70 bg-white hover:border-purple-400 focus:border-purple-500 text-purple-900 placeholder:text-purple-500")},`lab-cost-${e.id}-${S}`),S>0&&p.jsxs("div",{className:aa("flex items-center gap-2 text-xs p-2 rounded-lg",a?"bg-purple-800/30 text-purple-200 border border-purple-700/30":"bg-purple-100/70 text-purple-700 border border-purple-200/50"),children:[p.jsx("span",{className:"text-sm",children:"✨"}),p.jsx("span",{children:"سيتم تحديث طلب المخبر تلقائياً"})]})]})]}),"completed"===y.treatment_status&&p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"تاريخ الإنجاز"}),p.jsx(Xi,{type:"date",value:y.completion_date||"",onChange:e=>b(t=>d(o({},t),{completion_date:e.target.value})),onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key)return e.preventDefault(),void e.stopPropagation()},onFocus:e=>e.stopPropagation(),onClick:e=>e.stopPropagation(),"data-prevent-shortcuts":"true"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"ملاحظات"}),p.jsx(Ji,{value:y.notes||"",onChange:e=>b(t=>d(o({},t),{notes:e.target.value})),placeholder:"أدخل أي ملاحظات إضافية...",rows:3,onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key)return e.preventDefault(),void e.stopPropagation()},onFocus:e=>e.stopPropagation(),onClick:e=>e.stopPropagation(),"data-prevent-shortcuts":"true"})]}),p.jsxs("div",{className:"flex justify-end gap-2",children:[p.jsxs(Qi,{variant:"outline",onClick:n,children:[p.jsx(Mi,{className:"w-4 h-4 ml-2"}),"إلغاء"]}),p.jsxs(Qi,{onClick:()=>m(this,null,function*(){var a;if(y.treatment_type)if("التعويضات"===j&&S>0&&!_)rc.error("يرجى اختيار المخبر عند إدخال تكلفة المخبر");else try{const r=d(o({},y),{treatment_color:(null==(a=nd(y.treatment_type))?void 0:a.color)||e.treatment_color});yield t(e.id,r);const i=y.cost||0;if(i!==(N||0)&&(yield P()),"التعويضات"===j)if(S>0&&_){const t=yield E(e.id),n=nd(y.treatment_type),a=`${(null==n?void 0:n.label)||y.treatment_type||"علاج تعويضات"} - السن ${e.tooth_number}`;if(t)try{yield g(t.id,{lab_id:_,cost:S,service_name:a,remaining_balance:S-(t.paid_amount||0)}),rc.success("تم تحديث طلب المختبر بنجاح")}catch(s){rc.error("فشل في تحديث طلب المختبر")}else try{yield h({lab_id:_,patient_id:e.patient_id,tooth_treatment_id:e.id,tooth_number:e.tooth_number,service_name:a,cost:S,order_date:(new Date).toISOString().split("T")[0],status:"معلق",paid_amount:0,remaining_balance:S}),rc.success("تم إنشاء طلب المختبر بنجاح")}catch(s){rc.error("فشل في إنشاء طلب المختبر")}}else{const t=yield E(e.id);if(t)try{yield f(t.id),rc.info("تم حذف طلب المختبر")}catch(s){rc.error("فشل في حذف طلب المختبر")}}else{const t=yield E(e.id);if(t)try{yield f(t.id),rc.info("تم حذف طلب المختبر لتغيير تصنيف العلاج")}catch(s){rc.error("فشل في حذف طلب المختبر")}}n()}catch(s){console.error("Error updating treatment:",s),rc.error("فشل في حفظ التغييرات")}else rc.error("يرجى اختيار نوع العلاج")}),className:"bg-orange-600 hover:bg-orange-700",children:[p.jsx(pi,{className:"w-4 h-4 ml-2"}),"حفظ التغييرات"]})]})]})}const hC=({imagePath:e,alt:t="Dental image",className:n="",onLoad:a,onError:s})=>{const{isDarkMode:r}=Gt(),[i,l]=ve.useState(null),[o,d]=ve.useState(!0),[c,u]=ve.useState(!1);return ve.useEffect(()=>{let t=!0;return m(void 0,null,function*(){if(!e)return u(!0),void d(!1);try{if(d(!0),u(!1),window.electronAPI&&window.electronAPI.files&&window.electronAPI.files.getDentalImage){console.log("Loading dental image:",e);const n=yield window.electronAPI.files.getDentalImage(e);t&&(l(n),d(!1),null==a||a())}else console.warn("Electron API not available for image loading"),t&&(u(!0),d(!1),null==s||s())}catch(n){console.error("Error loading dental image:",n),t&&(u(!0),d(!1),null==s||s())}}),()=>{t=!1}},[e,a,s]),o?p.jsx("div",{className:aa("flex items-center justify-center",r?"bg-gray-800":"bg-gray-100",n),children:p.jsx("div",{className:"animate-pulse",children:p.jsx(zr,{className:aa("w-6 h-6",r?"text-gray-500":"text-gray-400")})})}):c||!i?p.jsx("div",{className:aa("flex items-center justify-center",r?"bg-gray-800":"bg-gray-100",n),children:p.jsxs("div",{className:aa("text-center",r?"text-gray-500":"text-gray-400"),children:[p.jsx(zr,{className:"w-6 h-6 mx-auto mb-1"}),p.jsx("div",{className:"text-xs",children:"فشل في تحميل الصورة"})]})}):p.jsx("img",{src:i,alt:t,className:n,onLoad:a,onError:()=>{u(!0),null==s||s()}})};function xC({open:e,onOpenChange:t,patientId:n,toothNumber:a,isPrimaryTeeth:s=!1,onSessionStatsUpdate:r,onTreatmentUpdate:i}){const{patients:l}=cl(),{toothTreatments:o,images:d,toothTreatmentImages:c,loadToothTreatmentsByTooth:u,loadImagesByTreatment:h,loadToothTreatmentImagesByTooth:x,loadAllToothTreatmentImagesByPatient:g,createToothTreatment:f,updateToothTreatment:v,deleteToothTreatment:y,reorderToothTreatments:b,createToothTreatmentImage:j,deleteToothTreatmentImage:w,clearImages:N,clearToothTreatmentImages:_}=Ko(),{isDarkMode:k}=Gt(),[S,D]=ve.useState(!1),[$,C]=ve.useState("treatments"),[E,T]=ve.useState([]),[A,F]=ve.useState(""),[P,O]=ve.useState(!1),[R,M]=ve.useState(""),L=l.find(e=>e.id===n),I=a?Xo(a,s):null,z=(o||[]).filter(e=>e.patient_id===n&&e.tooth_number===a);ve.useEffect(()=>{e&&n&&a&&(u(n,a),x(n,a),N())},[e,n,a,u,x,N]),ve.useEffect(()=>{const t=()=>m(this,null,function*(){e&&n&&a&&(yield u(n,a))});return window.addEventListener("tooth-color-update",t),()=>{window.removeEventListener("tooth-color-update",t)}},[e,n,a,u]);const B=e=>{window.electronAPI&&window.electronAPI.files&&window.electronAPI.files.openImagePreview?window.electronAPI.files.openImagePreview(e):window.open(`file://${e}`,"_blank")},Y=e=>{const t=(c||[]).filter(t=>t.tooth_treatment_id===e&&t.tooth_number===a&&t.patient_id===n);return{beforeImages:t.filter(e=>"before"===e.image_type),afterImages:t.filter(e=>"after"===e.image_type)}},V=()=>z.filter(e=>{const{beforeImages:t,afterImages:n}=Y(e.id);return t.length>0&&n.length>0}),q=(e,t)=>m(this,null,function*(){try{if(window.electronAPI&&window.electronAPI.files&&window.electronAPI.files.uploadDentalImage){const s=yield e.arrayBuffer(),r=Date.now(),i=e.name.split(".").pop()||"jpg",l=`${e.name.split(".")[0]}_${r}.${i}`,o=yield window.electronAPI.files.uploadDentalImage(s,l,n,a||0,t,(null==L?void 0:L.full_name)||"Unknown_Patient",(null==I?void 0:I.arabicName)||`Tooth_${a}`);return console.log("Image uploaded successfully:",o),o}return console.warn("Electron API not available, using public/upload fallback"),yield U(e,t)}catch(s){throw console.error("Error uploading image:",s),new Error("فشل في رفع الصورة")}}),U=(e,t)=>m(this,null,function*(){try{const s=new FileReader;return new Promise((r,i)=>{s.onload=()=>m(this,null,function*(){try{const i=s.result;if(window.electronAPI&&window.electronAPI.files&&window.electronAPI.files.saveDentalImage){const s=Date.now(),l=e.name.split(".").pop()||"jpg",o=`${e.name.split(".")[0]}_${s}.${l}`,d=yield window.electronAPI.files.saveDentalImage(i,o,n,a||0,t,(null==L?void 0:L.full_name)||"Unknown_Patient",(null==I?void 0:I.arabicName)||`Tooth_${a}`);console.log("Image saved via Electron API:",d),r(d)}else{const n=Date.now(),s=e.name.split(".").pop()||"jpg",i=((null==L?void 0:L.full_name)||"Unknown_Patient").replace(/[^a-zA-Z0-9\u0600-\u06FF\s]/g,"").replace(/\s+/g,"_"),l=(((null==I?void 0:I.arabicName)||`Tooth_${a}`).replace(/[^a-zA-Z0-9\u0600-\u06FF\s]/g,"").replace(/\s+/g,"_"),`${e.name.split(".")[0]}_${n}.${s}`),o=`dental_images/${i}/${t||"other"}/${l}`;console.log("Using fallback path:",o),r(o)}}catch(l){console.error("Error in saveImageToPublicUpload:",l),i(l)}}),s.onerror=()=>{console.error("Error reading file"),i(new Error("فشل في قراءة الملف"))},s.readAsDataURL(e)})}catch(s){throw console.error("Error in saveImageToPublicUpload:",s),new Error("فشل في حفظ الصورة")}}),H=e=>m(this,null,function*(){if(window.confirm("هل أنت متأكد من حذف هذه الصورة؟"))try{D(!0),yield w(e),yield g(n),rc.success("تم حذف الصورة بنجاح")}catch(t){rc.error("فشل في حذف الصورة"),console.error("Error deleting image:",t)}finally{D(!1)}});if(!I)return null;const G={total:z.length,completed:z.filter(e=>"completed"===e.treatment_status).length,inProgress:z.filter(e=>"in_progress"===e.treatment_status).length,planned:z.filter(e=>"planned"===e.treatment_status).length,cancelled:z.filter(e=>"cancelled"===e.treatment_status).length};return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"flex items-center gap-3 text-right",children:[p.jsx("div",{className:"w-8 h-8 rounded-lg border-2 border-white shadow-md flex items-center justify-center",style:{backgroundColor:(()=>{if(0===z.length)return"#22c55e";if(z.every(e=>"completed"===e.treatment_status))return"#22c55e";const e=[...z].sort((e,t)=>e.priority-t.priority),t=e.find(e=>"in_progress"===e.treatment_status)||e.find(e=>"planned"===e.treatment_status)||e[0];return(null==t?void 0:t.treatment_color)||"#22c55e"})()},children:p.jsx("span",{className:"text-white font-bold text-sm",children:a})}),p.jsxs("div",{children:[p.jsxs("h2",{className:"text-xl font-bold",children:["تفاصيل السن رقم ",a]}),p.jsx("p",{className:"text-base text-muted-foreground",children:I.arabicName})]}),G.total>0&&p.jsxs(qo,{variant:"secondary",className:"mr-auto",children:[p.jsx(qr,{className:"w-4 h-4 ml-1"}),G.total," علاج"]})]}),p.jsxs(Hi,{className:"text-right",children:["المريض: ",null==L?void 0:L.full_name]}),G.total>0&&p.jsxs("div",{className:"flex gap-2 mt-2",children:[G.completed>0&&p.jsxs(qo,{variant:"secondary",className:"bg-green-100 text-green-800",children:[p.jsx(gr,{className:"w-3 h-3 ml-1"}),G.completed," مكتمل"]}),G.inProgress>0&&p.jsxs(qo,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:[p.jsx(nr,{className:"w-3 h-3 ml-1"}),G.inProgress," قيد التنفيذ"]}),G.planned>0&&p.jsxs(qo,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:[p.jsx(Sr,{className:"w-3 h-3 ml-1"}),G.planned," مخطط"]}),G.cancelled>0&&p.jsxs(qo,{variant:"secondary",className:"bg-gray-100 text-gray-800",children:[p.jsx(ar,{className:"w-3 h-3 ml-1"}),G.cancelled," ملغي"]})]})]}),p.jsxs(iu,{value:$,onValueChange:C,className:"w-full",dir:"rtl",children:[p.jsxs(lu,{className:"grid w-full grid-cols-3",children:[p.jsxs(ou,{value:"treatments",className:"flex items-center gap-2",children:[p.jsx(vi,{className:"w-4 h-4"}),"العلاجات النشطة"]}),p.jsxs(ou,{value:"completed",className:"flex items-center gap-2",children:[p.jsx(gr,{className:"w-4 h-4"}),"العلاجات المكتملة (",G.completed,")"]}),p.jsxs(ou,{value:"images",className:"flex items-center gap-2",children:[p.jsx(xr,{className:"w-4 h-4"}),"الصور (",(c||[]).filter(e=>e.tooth_number===a&&e.patient_id===n).length,")"]})]}),p.jsx(du,{value:"treatments",className:"space-y-4",dir:"rtl",children:p.jsx(mC,{patientId:n,toothNumber:a,toothName:I.arabicName,treatments:z.filter(e=>"completed"!==e.treatment_status),onAddTreatment:e=>m(this,null,function*(){try{D(!0);const t=yield f(e);return rc.success("تم إضافة العلاج بنجاح"),null==i||i(),t}catch(t){return rc.error("فشل في إضافة العلاج"),console.error("Error adding treatment:",t),null}finally{D(!1)}}),onUpdateTreatment:(e,t)=>m(this,null,function*(){try{if(D(!0),console.log("🦷 Dialog: Updating treatment:",e,t),yield v(e,t),console.log("🦷 Dialog: Treatment updated in store"),a)try{yield u(n,a),console.log("🦷 Dialog: Tooth treatments reloaded")}catch(s){console.warn("🦷 Dialog: Failed to reload tooth treatments, but update was successful:",s)}return null==i||i(),console.log("🦷 Dialog: Treatment updated successfully"),rc.success("تم تحديث العلاج بنجاح"),Promise.resolve()}catch(r){throw console.error("🦷 Dialog: Error updating treatment:",r),rc.error("فشل في تحديث العلاج"),r}finally{D(!1)}}),onDeleteTreatment:e=>m(this,null,function*(){try{D(!0),yield y(e),rc.success("تم حذف العلاج بنجاح"),null==i||i()}catch(t){rc.error("فشل في حذف العلاج"),console.error("Error deleting treatment:",t)}finally{D(!1)}}),onReorderTreatments:e=>m(this,null,function*(){if(a)try{D(!0);const t=o.filter(e=>e.patient_id===n&&e.tooth_number===a);console.log("Reordering treatments:",{patientId:n,toothNumber:a,treatmentIds:e,currentTreatments:t.map(e=>({id:e.id,priority:e.priority}))}),yield b(n,a,e),yield u(n,a),rc.success("تم إعادة ترتيب العلاجات بنجاح")}catch(t){rc.error("فشل في إعادة ترتيب العلاجات"),console.error("Error reordering treatments:",t),yield u(n,a)}finally{D(!1)}}),onSessionStatsUpdate:r,onTreatmentUpdate:i})}),p.jsx(du,{value:"completed",className:"space-y-4",dir:"rtl",children:p.jsxs(Lo,{children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(gr,{className:aa("w-5 h-5",k?"text-green-400":"text-green-600")}),"العلاجات المكتملة"]}),p.jsx(Bo,{children:"جميع العلاجات التي تم إكمالها لهذا السن"})]}),p.jsx(Yo,{children:0===z.filter(e=>"completed"===e.treatment_status).length?p.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[p.jsx(gr,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد علاجات مكتملة لهذا السن"}),p.jsx("p",{className:"text-sm",children:"العلاجات المكتملة ستظهر هنا"})]}):p.jsx("div",{className:"space-y-3",children:z.filter(e=>"completed"===e.treatment_status).sort((e,t)=>e.priority-t.priority).map(e=>{var t;return p.jsx(Lo,{className:aa("transition-all duration-200 hover:shadow-md",k?"border-green-700/50 bg-green-950/30 hover:bg-green-950/40":"border-green-200 bg-green-50 hover:bg-green-100/50"),children:p.jsxs(Yo,{className:"p-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:aa("w-4 h-4 rounded-full border",k?"border-white/30":"border-white/50"),style:{backgroundColor:e.treatment_color}}),p.jsxs("div",{children:[p.jsx("h4",{className:aa("font-medium",k?"text-green-200":"text-green-800"),children:(null==(t=nd(e.treatment_type))?void 0:t.label)||e.treatment_type}),p.jsxs("p",{className:aa("text-sm",k?"text-green-300":"text-green-600"),children:["الأولوية: ",e.priority]})]})]}),p.jsxs("div",{className:"text-right",children:[p.jsxs(qo,{variant:"secondary",className:aa("transition-colors",k?"bg-green-900/50 text-green-200 border-green-700/50":"bg-green-100 text-green-800 border-green-200"),children:[p.jsx(gr,{className:"w-3 h-3 ml-1"}),"مكتمل"]}),e.completion_date&&p.jsxs("p",{className:aa("text-xs mt-1",k?"text-green-300":"text-green-600"),children:["تاريخ الإكمال: ",(()=>{const t=new Date(e.completion_date);return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`})()]})]})]}),e.notes&&p.jsxs("div",{className:aa("mt-3 p-3 rounded-lg text-sm transition-colors",k?"bg-green-900/30 text-green-200 border border-green-700/30":"bg-green-100 text-green-700 border border-green-200"),children:[p.jsx("strong",{children:"ملاحظات:"})," ",e.notes]}),e.cost&&p.jsx("div",{className:aa("mt-3 p-3 rounded-lg text-sm font-medium transition-colors",k?"bg-blue-900/30 text-blue-200 border border-blue-700/30":"bg-blue-50 text-blue-700 border border-blue-200"),children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{children:"التكلفة:"}),p.jsx(Nh,{amount:e.cost,className:"font-semibold"})]})})]})},e.id)})})})]})}),p.jsxs(du,{value:"images",className:"space-y-4",dir:"rtl",children:[p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(Di,{className:"w-5 h-5"}),"رفع صور جديدة"]})}),p.jsxs(Yo,{className:"space-y-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"treatment-select",children:"ربط الصور بعلاج محدد (اختياري)"}),p.jsxs(el,{value:A,onValueChange:F,children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر علاج لربط الصور به (أو اتركه فارغاً)"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"none",children:"بدون ربط بعلاج محدد"}),(o||[]).filter(e=>e.patient_id===n&&e.tooth_number===a).map(e=>{var t;return p.jsxs(dl,{value:e.id,children:[(null==(t=nd(e.treatment_type))?void 0:t.label)||e.treatment_type," - ","completed"===e.treatment_status?"مكتمل":"in_progress"===e.treatment_status?"قيد التنفيذ":"planned"===e.treatment_status?"مخطط":"ملغي"]},e.id)})]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"اختر نوع الصورة لرفعها"}),p.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:id.map(e=>p.jsx(Qi,{variant:"outline",className:"image-type-button h-auto p-4 flex flex-col items-center gap-2 min-h-[80px] border-2 border-dashed hover:border-solid transition-all duration-200",asChild:!0,children:p.jsxs("label",{htmlFor:`image-upload-${e.value}`,className:"cursor-pointer w-full h-full flex flex-col items-center justify-center gap-2",children:[p.jsx("span",{className:"text-2xl",children:e.icon}),p.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:e.label}),p.jsx("input",{id:`image-upload-${e.value}`,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:t=>((e,t)=>{const n=Array.from(e.target.files||[]).map(e=>({file:e,type:t,treatmentId:A&&"none"!==A?A:void 0}));T(e=>[...e,...n]),e.target.value=""})(t,e.value)})]})},e.value))})]}),E.length>0&&p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-medium",children:"الصور المحددة للرفع:"}),p.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:E.map((e,t)=>{var n,a;return p.jsxs("div",{className:"selected-image-preview relative group",children:[p.jsxs("div",{className:"relative",children:[p.jsx("img",{src:URL.createObjectURL(e.file),alt:`Preview ${t+1}`,className:"w-full h-24 object-cover rounded-lg border-2 border-dashed border-gray-300"}),p.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded-lg"}),p.jsx(Qi,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 w-6 h-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>(e=>{T(t=>t.filter((t,n)=>n!==e))})(t),children:p.jsx(Mi,{className:"w-3 h-3"})})]}),p.jsxs("div",{className:"mt-1 text-xs text-center",children:[p.jsxs("div",{className:"flex items-center justify-center gap-1",children:[p.jsx("span",{children:null==(n=id.find(t=>t.value===e.type))?void 0:n.icon}),p.jsx("span",{children:null==(a=id.find(t=>t.value===e.type))?void 0:a.label})]}),e.treatmentId&&p.jsxs("div",{className:"text-blue-600 mt-1",children:["مربوط بعلاج: ",(()=>{var t;const n=(o||[]).find(t=>t.id===e.treatmentId);return n?(null==(t=nd(n.treatment_type))?void 0:t.label)||n.treatment_type:"علاج"})()]})]})]},t)})})]}),E.length>0&&p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"الصور المحددة للرفع:"}),p.jsx("div",{className:"flex flex-wrap gap-2",children:E.map((e,t)=>p.jsxs("div",{className:"relative",children:[p.jsxs(qo,{variant:"outline",className:"pr-6",children:[e.file.name," (",e.type,")",e.treatmentId&&p.jsxs("span",{className:"text-blue-600 ml-1",children:["- ",(()=>{var t;const n=(o||[]).find(t=>t.id===e.treatmentId);return n?(null==(t=nd(n.treatment_type))?void 0:t.label)||n.treatment_type:"علاج"})()]})]}),p.jsx(Qi,{size:"sm",variant:"ghost",className:"absolute -top-1 -right-1 h-4 w-4 p-0",onClick:()=>T(e=>e.filter((e,n)=>n!==t)),children:p.jsx(Mi,{className:"h-3 w-3"})})]},t))}),p.jsxs(Qi,{onClick:()=>m(this,null,function*(){if(0!==E.length)try{D(!0);for(const e of E){const t=yield q(e.file,e.type),s={tooth_treatment_id:e.treatmentId||null,patient_id:n,tooth_number:a,image_path:t,image_type:e.type,description:`${e.type} - السن رقم ${a}`,taken_date:(new Date).toISOString()};yield j(s)}T([]),yield g(n),rc.success("تم حفظ الصور بنجاح")}catch(e){rc.error("فشل في حفظ الصور"),console.error("Error saving images:",e)}finally{D(!1)}}),disabled:S,className:"w-full",children:[p.jsx(Di,{className:"w-4 h-4 ml-2"}),"حفظ الصور (",E.length,")"]})]})]})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs(zo,{className:"flex items-center gap-2 justify-between",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Fr,{className:"w-5 h-5"}),"الصور المحفوظة (",(c||[]).filter(e=>e.tooth_number===a&&e.patient_id===n).length,")"]}),V().length>0&&p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>O(!P),className:"flex items-center gap-2",children:[p.jsx(Rr,{className:"w-4 h-4"}),P?"إخفاء المقارنة":"مقارنة"]})]})}),p.jsxs(Yo,{children:[P&&V().length>0&&p.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-green-50 dark:from-gray-900 dark:to-gray-800 rounded-lg border border-blue-200 dark:border-gray-700 shadow-sm",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[p.jsx(Rr,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),p.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100",children:"مقارنة الصور"})]}),p.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 mb-4",children:[p.jsx(Ro,{htmlFor:"comparison-treatment",className:"text-sm font-medium text-gray-700 dark:text-gray-200 whitespace-nowrap",children:"اختر العلاج للمقارنة:"}),p.jsxs(el,{value:R,onValueChange:M,children:[p.jsx(al,{className:"w-full sm:w-64 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-500 text-gray-900 dark:text-gray-100",children:p.jsx(nl,{placeholder:"اختر العلاج..."})}),p.jsx(il,{className:"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-500",children:V().map(e=>{var t;return p.jsx(dl,{value:e.id,className:"text-gray-900 dark:text-gray-100 dark:hover:bg-gray-600",children:(null==(t=nd(e.treatment_type))?void 0:t.label)||e.treatment_type},e.id)})})]})]}),!R&&p.jsx("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600",children:p.jsxs("div",{className:"text-gray-500 dark:text-gray-400",children:[p.jsx(Rr,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),p.jsx("p",{className:"text-sm",children:"اختر علاجاً من القائمة أعلاه لعرض المقارنة"})]})}),R&&p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:(()=>{const{beforeImages:e,afterImages:t}=Y(R);return z.find(e=>e.id===R),p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"space-y-3",children:[p.jsxs("h4",{className:"font-medium text-center text-green-700 dark:text-green-300 flex items-center justify-center gap-2 bg-green-100 dark:bg-green-900/50 py-2 px-4 rounded-lg",children:[p.jsx("span",{className:"w-3 h-3 bg-green-500 dark:bg-green-400 rounded-full shadow-sm"}),"قبل العلاج"]}),p.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.map(e=>p.jsxs("div",{className:"relative group",children:[p.jsxs("div",{className:"relative overflow-hidden rounded-lg border-2 border-green-300 dark:border-green-600 shadow-md hover:shadow-lg transition-shadow",children:[p.jsx(hC,{imagePath:e.image_path,alt:"قبل العلاج",className:"w-full h-48 object-cover"}),p.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:p.jsx(Qi,{variant:"secondary",size:"sm",className:"w-8 h-8 p-0 bg-black/80 hover:bg-black/95 text-white border-2 border-white/30 hover:border-white/80 rounded-full backdrop-blur-sm shadow-lg transition-all duration-300",onClick:()=>B(e.image_path),children:p.jsx(Fr,{className:"w-4 h-4"})})})]}),e.taken_date&&p.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 text-center mt-1 bg-white dark:bg-gray-700 rounded px-2 py-1 shadow-sm",children:new Date(e.taken_date).toLocaleDateString("en-GB")})]},e.id))})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsxs("h4",{className:"font-medium text-center text-blue-700 dark:text-blue-300 flex items-center justify-center gap-2 bg-blue-100 dark:bg-blue-900/50 py-2 px-4 rounded-lg",children:[p.jsx("span",{className:"w-3 h-3 bg-blue-500 dark:bg-blue-400 rounded-full shadow-sm"}),"بعد العلاج"]}),p.jsx("div",{className:"grid grid-cols-1 gap-3",children:t.map(e=>p.jsxs("div",{className:"relative group",children:[p.jsxs("div",{className:"relative overflow-hidden rounded-lg border-2 border-blue-300 dark:border-blue-600 shadow-md hover:shadow-lg transition-shadow",children:[p.jsx(hC,{imagePath:e.image_path,alt:"بعد العلاج",className:"w-full h-48 object-cover"}),p.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:p.jsx(Qi,{variant:"secondary",size:"sm",className:"w-8 h-8 p-0 bg-black/80 hover:bg-black/95 text-white border-2 border-white/30 hover:border-white/80 rounded-full backdrop-blur-sm shadow-lg transition-all duration-300",onClick:()=>B(e.image_path),children:p.jsx(Fr,{className:"w-4 h-4"})})})]}),e.taken_date&&p.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 text-center mt-1 bg-white dark:bg-gray-700 rounded px-2 py-1 shadow-sm",children:new Date(e.taken_date).toLocaleDateString("en-GB")})]},e.id))})]})]})})()}),R&&p.jsx("div",{className:"mt-4 p-3 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm",children:p.jsxs("p",{className:"text-sm text-center text-gray-700 dark:text-gray-200",children:[p.jsx("strong",{className:"text-gray-900 dark:text-white",children:"العلاج:"})," ",(()=>{var e;const t=z.find(e=>e.id===R);return t?(null==(e=nd(t.treatment_type))?void 0:e.label)||t.treatment_type:""})()]})})]}),0===(c||[]).filter(e=>e.tooth_number===a&&e.patient_id===n).length?p.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[p.jsx(xr,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),p.jsx("p",{children:"لا توجد صور محفوظة لهذا السن"}),p.jsx("p",{className:"text-sm",children:"قم برفع صور جديدة باستخدام النموذج أعلاه"})]}):p.jsxs("div",{className:"space-y-6",children:[z.map(e=>{var t;const s=(c||[]).filter(t=>t.tooth_treatment_id===e.id&&t.tooth_number===a&&t.patient_id===n);return 0===s.length?null:p.jsxs(Lo,{className:"treatment-images-card border-2 border-blue-200 dark:border-blue-700",children:[p.jsx(Io,{className:"pb-3 bg-blue-50 dark:bg-blue-900/20",children:p.jsxs(zo,{className:"text-sm flex items-center gap-2",children:[p.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),p.jsx("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:(null==(t=nd(e.treatment_type))?void 0:t.label)||e.treatment_type}),p.jsxs(qo,{variant:"secondary",className:"mr-auto bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300",children:[s.length," صورة"]})]})}),p.jsx(Yo,{className:"space-y-4",children:id.map(e=>{const t=s.filter(t=>t.image_type===e.value);return 0===t.length?null:p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[p.jsx("span",{className:"image-type-icon",children:e.icon}),p.jsx("span",{className:"image-type-label",children:e.label}),p.jsx(qo,{variant:"outline",className:"text-xs",children:t.length})]}),p.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:t.map(t=>p.jsxs("div",{className:"saved-image-card group relative bg-card border border-border rounded-lg p-2 hover:shadow-lg transition-all duration-300",children:[p.jsxs("div",{className:"relative overflow-hidden rounded-lg border border-border",children:[p.jsx(hC,{imagePath:t.image_path,alt:t.description||e.label,className:"w-full h-24 object-cover transition-transform group-hover:scale-105"}),p.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all"}),p.jsxs("div",{className:"absolute top-2 right-2 flex flex-row items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[p.jsx(Qi,{variant:"secondary",size:"sm",className:"w-8 h-8 p-0 bg-black/80 hover:bg-black/95 text-white border-2 border-white/30 hover:border-white/80 rounded-full backdrop-blur-sm shadow-lg transition-all duration-300",onClick:()=>B(t.image_path),children:p.jsx(Fr,{className:"w-4 h-4"})}),p.jsx(Qi,{variant:"destructive",size:"sm",className:"w-8 h-8 p-0 bg-red-500/90 hover:bg-red-500 dark:bg-red-600/90 dark:hover:bg-red-600 rounded-full shadow-lg transition-all duration-300",onClick:()=>H(t.id),children:p.jsx(Ni,{className:"w-4 h-4"})})]})]}),p.jsx("div",{className:"mt-2 space-y-1",children:t.taken_date&&p.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 text-center bg-white dark:bg-gray-700 rounded px-2 py-1 shadow-sm",children:new Date(t.taken_date).toLocaleDateString("en-GB")})})]},t.id))})]},e.value)})})]},e.id)}),(()=>{const e=(c||[]).filter(e=>!e.tooth_treatment_id&&e.tooth_number===a&&e.patient_id===n);return 0===e.length?null:p.jsxs(Lo,{className:"unassociated-images-card border-2 border-gray-200 dark:border-gray-600",children:[p.jsx(Io,{className:"pb-3 bg-gray-50 dark:bg-gray-800",children:p.jsxs(zo,{className:"text-sm flex items-center gap-2",children:[p.jsx("span",{className:"w-3 h-3 bg-gray-500 rounded-full"}),p.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"صور غير مرتبطة بعلاج محدد"}),p.jsxs(qo,{variant:"secondary",className:"mr-auto",children:[e.length," صورة"]})]})}),p.jsx(Yo,{className:"space-y-4",children:id.map(t=>{const n=e.filter(e=>e.image_type===t.value);return 0===n.length?null:p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[p.jsx("span",{className:"image-type-icon",children:t.icon}),p.jsx("span",{className:"image-type-label",children:t.label}),p.jsx(qo,{variant:"outline",className:"text-xs",children:n.length})]}),p.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:n.map(e=>p.jsxs("div",{className:"saved-image-card group relative bg-card border border-border rounded-lg p-2 hover:shadow-lg transition-all duration-300",children:[p.jsxs("div",{className:"relative overflow-hidden rounded-lg border border-border",children:[p.jsx(hC,{imagePath:e.image_path,alt:e.description||t.label,className:"w-full h-24 object-cover transition-transform group-hover:scale-105"}),p.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all"}),p.jsxs("div",{className:"absolute top-2 right-2 flex flex-row items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[p.jsx(Qi,{variant:"secondary",size:"sm",className:"w-8 h-8 p-0 bg-black/80 hover:bg-black/95 text-white border-2 border-white/30 hover:border-white/80 rounded-full backdrop-blur-sm shadow-lg transition-all duration-300",onClick:()=>B(e.image_path),children:p.jsx(Fr,{className:"w-4 h-4"})}),p.jsx(Qi,{variant:"destructive",size:"sm",className:"w-8 h-8 p-0 bg-red-500/90 hover:bg-red-500 dark:bg-red-600/90 dark:hover:bg-red-600 rounded-full shadow-lg transition-all duration-300",onClick:()=>H(e.id),children:p.jsx(Ni,{className:"w-4 h-4"})})]})]}),p.jsx("div",{className:"mt-2 space-y-1",children:e.taken_date&&p.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 text-center bg-white dark:bg-gray-700 rounded px-2 py-1 shadow-sm",children:new Date(e.taken_date).toLocaleDateString("en-GB")})})]},e.id))})]},t.value)})})]})})()]})]})]})]})]})]})})}function gC({patients:e,selectedPatientId:t,onPatientSelect:n,getPatientTreatmentCount:a,getLastTreatmentDate:s,getPatientImagesCount:r,isLoading:i=!1,isCompact:l=!1}){var o;const[d,c]=ve.useState(null),[u,m]=ve.useState(null),[h,x]=ve.useState(1),[g,f]=ve.useState(l?5:10),[v,y]=ve.useState(!1),b=ve.useMemo(()=>l&&t&&!v?e.filter(e=>e.id===t):e,[e,l,t,v]),j=ve.useMemo(()=>{let e=b;d&&u&&(e=[...b].sort((e,t)=>{let n=e[d],a=t[d];return null==n&&null==a?0:null==n?"asc"===u?1:-1:null==a?"asc"===u?-1:1:(n=String(n).toLowerCase(),a=String(a).toLowerCase(),n<a?"asc"===u?-1:1:n>a?"asc"===u?1:-1:0)}));const t=(h-1)*g,n=t+g;return{patients:e.slice(t,n),totalPages:Math.ceil(e.length/g),totalCount:e.length}},[b,d,u,h,g]),w=e=>d!==e?p.jsx(lr,{className:"w-4 h-4 opacity-50"}):"asc"===u?p.jsx(or,{className:"w-4 h-4"}):"desc"===u?p.jsx(rr,{className:"w-4 h-4"}):p.jsx(lr,{className:"w-4 h-4 opacity-50"}),N=({field:e,children:t})=>p.jsx(tc,{className:"cursor-pointer hover:bg-muted/50 select-none text-center",onClick:()=>(e=>{d===e?"asc"===u?m("desc"):"desc"===u?(c(null),m(null)):m("asc"):(c(e),m("asc"))})(e),children:p.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[p.jsx("span",{children:t}),w(e)]})});if(i)return p.jsx("div",{className:"border rounded-lg",children:p.jsxs(Qd,{className:"table-center-all",children:[p.jsx(Xd,{children:p.jsxs(ec,{className:"bg-muted/50",children:[p.jsx(tc,{className:"text-center w-16",children:"#"}),p.jsx(tc,{className:"text-center",children:"اسم المريض"}),p.jsx(tc,{className:"text-center",children:"الجنس"}),p.jsx(tc,{className:"text-center",children:"العمر"}),p.jsx(tc,{className:"text-center",children:"رقم الهاتف"}),p.jsx(tc,{className:"text-center",children:"عدد العلاجات"}),p.jsx(tc,{className:"text-center",children:"آخر زيارة"}),p.jsx(tc,{className:"text-center",children:"الإجراءات"})]})}),p.jsx(Jd,{children:[...Array(5)].map((e,t)=>p.jsx(ec,{children:[...Array(8)].map((e,t)=>p.jsx(nc,{children:p.jsx("div",{className:"h-4 bg-muted animate-pulse rounded"})},t))},t))})]})});if(0===e.length)return p.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[p.jsx(Ai,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),p.jsx("p",{children:"لا توجد مرضى مطابقين لبحثك"})]});const{patients:_,totalPages:k,totalCount:S}=j,D=(h-1)*g,$=e=>{x(e)};return p.jsxs("div",{className:"space-y-4",children:[p.jsx("div",{className:"bg-muted/30 dark:bg-muted/50 px-4 py-2 border border-border rounded-t-lg",children:p.jsxs("div",{className:"flex items-center justify-between text-sm",children:[p.jsxs("span",{className:"text-muted-foreground",children:["عرض ",_.length," من أصل ",S," مريض"]}),p.jsxs("div",{className:"flex items-center gap-3",children:[t&&p.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:["المريض المحدد: ",null==(o=e.find(e=>e.id===t))?void 0:o.full_name]}),l&&t&&p.jsx(Qi,{variant:"outline",size:"sm",onClick:()=>y(!v),className:"text-xs",children:v?"إخفاء المرضى الآخرين":"عرض جميع المرضى"})]})]})}),p.jsx("div",{className:"border border-border rounded-b-lg overflow-hidden bg-card dark:bg-card",children:p.jsx("div",{className:"overflow-x-auto bg-card dark:bg-card",children:p.jsxs(Qd,{className:"table-center-all bg-card dark:bg-card",children:[p.jsx(Xd,{className:"bg-muted/50 dark:bg-muted/70",children:p.jsxs(ec,{className:"bg-muted/50 dark:bg-muted/70 border-b border-border hover:bg-muted/50 dark:hover:bg-muted/70",children:[p.jsx(tc,{className:"text-center w-16 text-foreground",children:p.jsx("span",{className:"font-medium",children:"#"})}),p.jsx(N,{field:"full_name",children:p.jsx("span",{className:"font-medium",children:"اسم المريض"})}),p.jsx(N,{field:"gender",children:p.jsx("span",{className:"font-medium",children:"الجنس"})}),p.jsx(N,{field:"age",children:p.jsx("span",{className:"font-medium",children:"العمر"})}),p.jsx(N,{field:"phone",children:p.jsx("span",{className:"font-medium",children:"رقم الهاتف"})}),p.jsx(tc,{className:"text-center text-foreground",children:p.jsx("span",{className:"font-medium",children:"عدد العلاجات"})}),p.jsx(tc,{className:"text-center text-foreground",children:p.jsx("span",{className:"font-medium",children:"آخر زيارة"})}),p.jsx(tc,{className:"text-center text-foreground",children:p.jsx("span",{className:"font-medium",children:"الإجراءات"})})]})}),p.jsx(Jd,{className:"bg-card dark:bg-card",children:_.map((e,i)=>{var l;return p.jsxs(ec,{className:"hover:bg-muted/50 dark:hover:bg-muted/70 transition-colors border-b border-border "+(t===e.id?"bg-blue-100/30 dark:bg-blue-900/20 border-blue-300/50 dark:border-blue-600/50":"bg-card dark:bg-card"),children:[p.jsx(nc,{className:"font-medium text-muted-foreground",children:D+i+1}),p.jsx(nc,{className:"font-medium table-cell-wrap-truncate-md",children:p.jsxs("div",{className:"flex items-center justify-center space-x-2 space-x-reverse",children:[p.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:e.full_name.charAt(0)}),p.jsx("span",{className:"text-foreground",children:e.full_name})]})}),p.jsx(nc,{children:p.jsx(qo,{variant:"male"===e.gender?"default":"secondary",children:"male"===e.gender?"ذكر":"أنثى"})}),p.jsx(nc,{children:p.jsxs("div",{className:"flex items-center justify-center gap-1",children:[p.jsx(hr,{className:"w-3 h-3 text-muted-foreground"}),p.jsxs("span",{className:"text-foreground",children:[e.age," سنة"]})]})}),p.jsx(nc,{className:"table-cell-wrap-truncate-sm",children:e.phone?p.jsxs("a",{href:`https://wa.me/${null==(l=e.phone)?void 0:l.replace(/\D/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 dark:text-green-400 hover:underline flex items-center justify-center gap-1",children:[p.jsx(ri,{className:"w-3 h-3"}),e.phone]}):p.jsx("span",{className:"text-muted-foreground",children:"غير محدد"})}),p.jsx(nc,{children:p.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p.jsxs(qo,{variant:"outline",className:"bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-600",children:[p.jsx(nr,{className:"w-3 h-3 ml-1"}),a(e.id)," علاج"]}),r&&r(e.id)>0&&p.jsxs(qo,{variant:"outline",className:"bg-green-50 dark:bg-green-900 text-green-700 dark:text-green-300 border-green-200 dark:border-green-600",children:[p.jsx(xr,{className:"w-3 h-3 ml-1"}),r(e.id)," صورة"]})]})}),p.jsx(nc,{children:s(e.id)?p.jsx("span",{className:"text-xs text-muted-foreground",children:ma(s(e.id))}):p.jsx("span",{className:"text-xs text-muted-foreground",children:"لا توجد زيارات"})}),p.jsx(nc,{children:p.jsx(Qi,{size:"sm",variant:t===e.id?"default":"outline",onClick:()=>n(e.id),className:"text-xs "+(t===e.id?"bg-primary text-primary-foreground":"border-border hover:bg-muted"),children:t===e.id?"محدد":"اختيار"})})]},e.id)})})]})})}),S>g&&p.jsxs("div",{className:"flex items-center justify-between px-2 py-2 bg-background dark:bg-card border border-border rounded-lg",children:[p.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:p.jsxs("p",{className:"text-sm text-muted-foreground",children:["عرض ",(h-1)*g+1," إلى ",Math.min(h*g,S)," من ",S," مريض"]})}),p.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsx("p",{className:"text-sm font-medium text-foreground",children:"عدد الصفوف لكل صفحة"}),p.jsxs(el,{value:`${g}`,onValueChange:e=>{f(parseInt(e)),x(1)},children:[p.jsx(al,{className:"h-8 w-[70px] border-border",children:p.jsx(nl,{placeholder:g})}),p.jsx(il,{side:"top",children:[5,10,15,20].map(e=>p.jsx(dl,{value:`${e}`,children:e},e))})]})]}),p.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium text-foreground",children:["صفحة ",h," من ",k]}),p.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[p.jsxs(Qi,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>$(1),disabled:1===h,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),p.jsx(Nr,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>$(h-1),disabled:1===h,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),p.jsx(br,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>$(h+1),disabled:h===k,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),p.jsx(yr,{className:"h-4 w-4"})]}),p.jsxs(Qi,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>$(k),disabled:h===k,children:[p.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),p.jsx(wr,{className:"h-4 w-4"})]})]})]})]})]})}function fC({open:e,onOpenChange:t,patientId:n,selectedTeeth:a,onAddTreatments:s}){Gt();const{labs:r,loadLabs:i}=i$(),{createPayment:l}=Go(),{createLabOrder:c}=Th(),{patients:u}=cl(),[h,x]=ve.useState(""),[g,f]=ve.useState(""),[v,y]=ve.useState(0),[b,j]=ve.useState(!1),[w,N]=ve.useState({patient_id:n,treatment_status:"planned",cost:0,start_date:(new Date).toISOString().split("T")[0]});ve.useEffect(()=>{e&&i()},[e,i]);const _=(e,t)=>m(this,null,function*(){if(console.log("💰 [DEBUG] createPendingPaymentForTreatment called:",{treatmentId:e,cost:w.cost,patientId:n,toothNumber:t}),!e)throw console.error("❌ [DEBUG] Cannot create payment - missing treatment ID"),new Error("معرف العلاج مطلوب لإنشاء الدفعة");if(!w.cost||w.cost<=0)console.log("⚠️ [DEBUG] Skipping payment creation - no cost specified");else try{const a=u.find(e=>e.id===n);if(!a)throw new Error("لم يتم العثور على بيانات المريض");const s=nd(w.treatment_type),r=`${(null==s?void 0:s.label)||w.treatment_type} - السن ${t}`,i={patient_id:n,tooth_treatment_id:e,amount:0,payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:r,status:"pending",notes:`دفعة معلقة للمريض: ${a.full_name} - السن ${t} - العلاج: ${(null==s?void 0:s.label)||w.treatment_type}`,total_amount_due:w.cost,amount_paid:0,remaining_balance:w.cost,treatment_total_cost:w.cost,treatment_total_paid:0,treatment_remaining_balance:w.cost};console.log("💰 [DEBUG] Creating payment with data:",i),yield l(i),console.log("✅ [DEBUG] Payment created successfully for treatment:",e)}catch(a){console.error("❌ [DEBUG] Payment creation failed:",a);const e=a instanceof Error?a.message:"خطأ غير معروف";throw rc.error(`فشل في إنشاء الدفعة المعلقة للسن ${t}: ${e}`),a}}),k=(e,t)=>m(this,null,function*(){console.log("🧪 [DEBUG] createLabOrderForTreatment called:",{treatmentId:e,labCost:v,selectedLab:g,patientId:n,toothNumber:t});try{const a=u.find(e=>e.id===n),s=nd(w.treatment_type);if(!a)throw new Error("لم يتم العثور على بيانات المريض");const r={lab_id:g,patient_id:n,tooth_treatment_id:e,tooth_number:t,service_name:`${(null==s?void 0:s.label)||"علاج تعويضات"} - السن ${t}`,cost:v,order_date:(new Date).toISOString().split("T")[0],status:"معلق",notes:`طلب مخبر للمريض: ${a.full_name} - السن ${t} - العلاج: ${(null==s?void 0:s.label)||w.treatment_type}`,paid_amount:0,remaining_balance:v};yield c(r),console.log("✅ [DEBUG] Lab order created successfully for treatment:",e)}catch(a){console.error("❌ [DEBUG] Lab order creation failed:",a);const e=a instanceof Error?a.message:"خطأ غير معروف";throw rc.error(`فشل في إنشاء طلب المختبر للسن ${t}: ${e}`),a}}),S=()=>{N({patient_id:n,treatment_status:"planned",cost:0,start_date:(new Date).toISOString().split("T")[0]}),x(""),f(""),y(0)},D=h?td(h):[];return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"flex items-center gap-2 text-xl",children:[p.jsx(nr,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),"إضافة علاج للأسنان المحددة"]}),p.jsxs(Hi,{children:["إضافة نفس العلاج لجميع الأسنان المحددة (",a.length," سن)"]})]}),p.jsxs("div",{className:"space-y-6",children:[p.jsxs(Lo,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[p.jsx(Io,{className:"pb-3",children:p.jsx(zo,{className:"text-sm text-blue-700 dark:text-blue-300",children:"الأسنان المحددة"})}),p.jsx(Yo,{className:"pt-0",children:p.jsx("div",{className:"flex flex-wrap gap-2",children:a.sort((e,t)=>e-t).map(e=>p.jsxs(qo,{variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",children:["السن ",e]},e))})})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"تصنيف العلاج"}),p.jsxs(el,{value:h,onValueChange:e=>{x(e),N(t=>d(o({},t),{treatment_category:e,treatment_type:""}))},children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر تصنيف العلاج"})}),p.jsx(il,{children:ed.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{children:e.icon}),p.jsx("span",{children:e.label})]})},e.value))})]})]}),h&&p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"نوع العلاج"}),p.jsxs(el,{value:w.treatment_type||"",onValueChange:e=>{const t=nd(e);N(n=>d(o({},n),{treatment_type:e,treatment_color:(null==t?void 0:t.color)||"#22c55e"}))},children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر نوع العلاج"})}),p.jsx(il,{children:D.map(e=>p.jsx(dl,{value:e.value,children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),p.jsx("span",{children:e.label})]})},e.value))})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"التكلفة"}),p.jsx(Xi,{type:"number",min:"0",step:"0.01",value:w.cost||"",onChange:e=>N(t=>d(o({},t),{cost:parseFloat(e.target.value)||0})),placeholder:"0.00"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"تاريخ البدء"}),p.jsx(Xi,{type:"date",value:w.start_date||"",onChange:e=>N(t=>d(o({},t),{start_date:e.target.value}))})]})]}),"التعويضات"===w.treatment_category&&p.jsxs(Lo,{className:"bg-purple-50 dark:bg-purple-950/20 border-purple-200 dark:border-purple-800",children:[p.jsx(Io,{className:"pb-3",children:p.jsx(zo,{className:"text-sm text-purple-700 dark:text-purple-300",children:"معلومات المختبر"})}),p.jsx(Yo,{className:"space-y-4",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"المختبر"}),p.jsxs(el,{value:g,onValueChange:f,children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر المختبر"})}),p.jsx(il,{children:r.map(e=>p.jsx(dl,{value:e.id,children:e.name},e.id))})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"تكلفة المختبر"}),p.jsx(Xi,{type:"number",min:"0",step:"0.01",value:v||"",onChange:e=>y(parseFloat(e.target.value)||0),placeholder:"0.00"})]})]})})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{children:"ملاحظات"}),p.jsx(Ji,{value:w.notes||"",onChange:e=>N(t=>d(o({},t),{notes:e.target.value})),placeholder:"ملاحظات إضافية...",rows:3})]}),p.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[p.jsx(Qi,{variant:"outline",onClick:()=>t(!1),disabled:b,children:"إلغاء"}),p.jsx(Qi,{onClick:()=>m(this,null,function*(){if(w.treatment_type&&w.treatment_category)if("التعويضات"===w.treatment_category&&v>0&&!g)rc.error("يرجى اختيار المختبر عند إدخال تكلفة المختبر للتعويضات");else{j(!0);try{let l=0,c=0,u=0;for(const t of a)try{console.log(`🦷 [DEBUG] Processing tooth ${t}`);const a=d(o({},w),{patient_id:n,tooth_number:t,tooth_name:`السن ${t}`,treatment_type:w.treatment_type,treatment_category:w.treatment_category,treatment_color:w.treatment_color||"#22c55e",treatment_status:w.treatment_status||"planned",cost:w.cost||0,start_date:w.start_date,notes:w.notes,priority:1}),i=yield s([a]);if(!(i&&i.length>0))throw new Error(`فشل في إنشاء العلاج للسن ${t}`);{const n=i[0].id;if(l++,console.log(`✅ [DEBUG] Treatment created successfully for tooth ${t}:`,n),w.cost&&w.cost>0){console.log(`💰 [DEBUG] Creating payment for tooth ${t}`);try{yield _(n,t),c++,console.log(`✅ [DEBUG] Payment created successfully for tooth ${t}`)}catch(e){console.error(`❌ [DEBUG] Payment creation failed for tooth ${t}:`,e),rc.warning(`تم إنشاء العلاج للسن ${t} ولكن فشل في إنشاء الدفعة`)}}if("التعويضات"===w.treatment_category&&g&&v>0){console.log(`🧪 [DEBUG] Creating lab order for tooth ${t}`);try{yield k(n,t),u++,console.log(`✅ [DEBUG] Lab order created successfully for tooth ${t}`)}catch(r){console.error(`❌ [DEBUG] Lab order creation failed for tooth ${t}:`,r),rc.warning(`تم إنشاء العلاج والدفعة للسن ${t} ولكن فشل في إنشاء طلب المختبر`)}}}}catch(i){console.error(`❌ [DEBUG] Failed to process tooth ${t}:`,i),rc.error(`فشل في معالجة السن ${t}`)}if(l>0){let e=`تم إضافة العلاج بنجاح لـ ${l} سن`;c>0&&(e+=` مع ${c} دفعة معلقة`),u>0&&(e+=` و ${u} طلب مختبر`),rc.success(e)}l===a.length?(S(),t(!1)):rc.warning(`تم معالجة ${l} من أصل ${a.length} أسنان بنجاح`)}catch(l){console.error("Error adding multiple treatments:",l),rc.error("فشل في إضافة العلاجات")}finally{j(!1)}}else rc.error("يرجى اختيار نوع العلاج والتصنيف")}),disabled:b||!w.treatment_type,className:"bg-blue-600 hover:bg-blue-700 text-white",children:b?"جاري الإضافة...":`إضافة العلاج لـ ${a.length} سن`})]})]})]})})}function vC(){var e;yl();const{patients:t,loadPatients:n}=cl(),{toothTreatments:a,toothTreatmentImages:s,loadToothTreatments:r,loadAllToothTreatmentImages:i,loadToothTreatmentsByPatient:l,loadAllToothTreatmentImagesByPatient:c,createToothTreatment:u}=Ko(),{prescriptions:h,loadPrescriptions:x}=Nd();qt();const[g,f]=ve.useState(""),[v,y]=ve.useState(null),[b,j]=ve.useState([]),[w,N]=ve.useState(!1),[_,k]=ve.useState(!1),[S,D]=ve.useState(!1),[$,C]=ve.useState(!1),[E,T]=ve.useState(null),[A,F]=ve.useState(""),[P,O]=ve.useState(!1),[R,M]=ve.useState(!1),[L,I]=ve.useState(!1),[z,B]=ve.useState({});wd(),ve.useEffect(()=>{n(),x(),r(),i()},[n,x,r,i]),ve.useEffect(()=>{(()=>{try{const e=localStorage.getItem("selectedPatientForTreatment");if(e){const n=JSON.parse(e);console.log("Found pre-selected patient for treatment:",n);const a=n.selectedPatientId,s=n.patientName,r=n.showAddTreatmentGuidance;localStorage.removeItem("selectedPatientForTreatment");const i=()=>m(this,null,function*(){console.log("Attempting to select patient:",a),console.log("Available patients:",t.length),s&&(F(s),rc.success(`تم تحديد المريض: ${s}`),r&&setTimeout(()=>{rc.info("اختر السن المراد علاجه من الرسم البياني أدناه لإضافة علاج جديد",void 0,{duration:5e3})},1e3)),f(a),console.log("Patient selected:",a),l(a),loadImages();const e=yield U(a);B(t=>d(o({},t),{[a]:e})),setTimeout(()=>{const e=document.getElementById("dental-chart-section");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},500)});t.length>0?i():setTimeout(i,200)}}catch(e){console.error("Error reading pre-selected patient for treatment:",e)}})()},[t.length]),ve.useEffect(()=>{const e=localStorage.getItem("selectedTreatmentForDetails");if(e)try{const{treatment:t,patientId:n,openDetailsModal:a}=JSON.parse(e);a&&t&&n&&(f(n),l(n),U(n).then(e=>{B(t=>d(o({},t),{[n]:e}))}),y(t.tooth_number),k(!0),localStorage.removeItem("selectedTreatmentForDetails"))}catch(n){console.error("Error parsing search result data:",n),localStorage.removeItem("selectedTreatmentForDetails")}const t=localStorage.getItem("selectedPrescriptionForDetails");if(t)try{const{prescription:e,openDetailsModal:n}=JSON.parse(t);n&&e&&(T(e),C(!0),localStorage.removeItem("selectedPrescriptionForDetails"))}catch(n){console.error("Error parsing prescription search result data:",n),localStorage.removeItem("selectedPrescriptionForDetails")}},[]);const Y=t.filter(e=>{var t;return e.full_name.toLowerCase().includes(A.toLowerCase())||(null==(t=e.phone)?void 0:t.includes(A))||e.serial_number.includes(A)}),V=t.find(e=>e.id===g),q=h.filter(e=>e.patient_id===g),U=e=>m(this,null,function*(){try{const t=yield window.electronAPI.toothTreatments.getByPatient(e);let n=[];for(const e of t){const t=yield window.electronAPI.treatmentSessions.getByTreatment(e.id);n=[...n,...t]}return{total:n.length,completed:n.filter(e=>"completed"===e.session_status).length,planned:n.filter(e=>"planned"===e.session_status).length,cancelled:n.filter(e=>"cancelled"===e.session_status).length}}catch(t){return console.error("Error getting patient session stats:",t),{total:0,completed:0,planned:0,cancelled:0}}}),H=()=>m(this,null,function*(){if(g){const e=yield U(g);B(t=>d(o({},t),{[g]:e}))}}),G=e=>s.filter(t=>t.patient_id===e).length,W=e=>{N(!0),y(null),j(t=>{if(t.includes(e)){const n=t.filter(t=>t!==e);return 0===n.length&&N(!1),n}return[...t,e]})},K=()=>{j([]),N(!1)};return p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-3",children:[p.jsx(yi,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"}),"العلاجات السنية"]}),p.jsx("p",{className:"text-muted-foreground mt-2",children:"إدارة شاملة للعلاجات السنية مع مخطط الأسنان التفاعلي"})]}),p.jsx("div",{className:"flex gap-2",children:p.jsxs(Qi,{onClick:()=>m(this,null,function*(){M(!0);try{if(yield Promise.all([n(),x(),r(),i()]),g){yield Promise.all([l(g),c(g)]);const e=yield U(g);B(t=>d(o({},t),{[g]:e}))}rc.success("تم تحديث البيانات بنجاح")}catch(e){rc.error("حدث خطأ أثناء تحديث البيانات")}finally{M(!1)}}),disabled:R,variant:"outline",children:[p.jsx(mi,{className:"w-4 h-4 ml-2 "+(R?"animate-spin":"")}),"تحديث البيانات"]})})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[p.jsx(Lo,{children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg",children:p.jsx(Ai,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المرضى"}),p.jsx("p",{className:"text-2xl font-bold text-foreground",children:t.length})]})]})})}),p.jsx(Lo,{children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900 rounded-lg",children:p.jsx(nr,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي العلاجات"}),p.jsx("p",{className:"text-2xl font-bold text-foreground",children:a.length})]})]})})}),p.jsx(Lo,{children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900 rounded-lg",children:p.jsx(xr,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي الصور"}),p.jsx("p",{className:"text-2xl font-bold text-foreground",children:s.length})]})]})})}),p.jsx(Lo,{children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900 rounded-lg",children:p.jsx(Pr,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-muted-foreground",children:"الوصفات الطبية"}),p.jsx("p",{className:"text-2xl font-bold text-foreground",children:h.length})]})]})})})]}),p.jsxs(Lo,{children:[p.jsxs(Io,{children:[p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(Ai,{className:"w-5 h-5"}),"اختيار المريض"]}),p.jsx(Bo,{children:"ابحث واختر المريض لعرض مخطط الأسنان والعلاجات"})]}),p.jsxs(Yo,{className:"space-y-4",children:[p.jsxs("div",{className:"relative",children:[p.jsx(hi,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{placeholder:"البحث السريع: اسم المريض، رقم الهاتف، أو #...",value:A,onChange:e=>F(e.target.value),className:"pr-10",autoComplete:"off"}),A&&p.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:p.jsxs(qo,{variant:"secondary",className:"text-xs",children:[Y.length," نتيجة"]})})]}),p.jsx(gC,{patients:Y,selectedPatientId:g,onPatientSelect:e=>m(this,null,function*(){if(f(e),y(null),j([]),N(!1),e){yield l(e),c(e);const t=yield U(e);B(n=>d(o({},n),{[e]:t})),setTimeout(()=>{const e=document.getElementById("dental-chart-section");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)}}),getPatientTreatmentCount:e=>a.filter(t=>t.patient_id===e).length,getLastTreatmentDate:e=>{const t=a.filter(t=>t.patient_id===e);if(0===t.length)return null;return t.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())[0].created_at},getPatientImagesCount:G,isLoading:R,isCompact:!!V}),V&&p.jsx(Lo,{className:"bg-muted/30 dark:bg-muted/20 border-border",children:p.jsxs(Yo,{className:"pt-4 bg-muted/30 dark:bg-muted/20",children:[p.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Ai,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),p.jsx("span",{className:"font-medium text-foreground",children:V.full_name})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-muted-foreground",children:"الجنس:"}),p.jsx(qo,{variant:"secondary",children:"male"===V.gender?"ذكر":"أنثى"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(hr,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),p.jsxs("span",{className:"text-foreground",children:[V.age," سنة"]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(ri,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),p.jsx("a",{href:`https://wa.me/${null==(e=V.phone)?void 0:e.replace(/\D/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 dark:text-green-400 hover:underline",children:V.phone})]})]}),(()=>{const e=(e=>{const t=a.filter(t=>t.patient_id===e);return{total:t.length,completed:t.filter(e=>"completed"===e.treatment_status).length,inProgress:t.filter(e=>"in_progress"===e.treatment_status).length,planned:t.filter(e=>"planned"===e.treatment_status).length}})(g),t=G(g),n=z[g]||{total:0,completed:0,planned:0,cancelled:0};return p.jsxs("div",{className:"border-t border-border pt-4 space-y-4",children:[p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"إحصائيات العلاجات"}),p.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[p.jsx("div",{className:"flex items-center gap-2",children:p.jsxs(qo,{variant:"outline",className:"bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300",children:[p.jsx(nr,{className:"w-3 h-3 ml-1"}),e.total," إجمالي"]})}),p.jsx("div",{className:"flex items-center gap-2",children:p.jsxs(qo,{variant:"outline",className:"bg-green-50 dark:bg-green-900 text-green-700 dark:text-green-300",children:["✓ ",e.completed," مكتمل"]})}),p.jsx("div",{className:"flex items-center gap-2",children:p.jsxs(qo,{variant:"outline",className:"bg-orange-50 dark:bg-orange-900 text-orange-700 dark:text-orange-300",children:["⏳ ",e.inProgress," قيد التنفيذ"]})}),p.jsx("div",{className:"flex items-center gap-2",children:p.jsxs(qo,{variant:"outline",className:"bg-gray-50 dark:bg-gray-900 text-gray-700 dark:text-gray-300",children:["📋 ",e.planned," مخطط"]})}),p.jsx("div",{className:"flex items-center gap-2",children:p.jsxs(qo,{variant:"outline",className:"bg-purple-50 dark:bg-purple-900 text-purple-700 dark:text-purple-300",children:[p.jsx(xr,{className:"w-3 h-3 ml-1"}),t," صورة"]})})]})]}),p.jsxs("div",{children:[p.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"إحصائيات الجلسات"}),p.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[p.jsx("div",{className:"flex items-center gap-2",children:p.jsxs(qo,{variant:"outline",className:"bg-indigo-50 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300",children:[p.jsx(hr,{className:"w-3 h-3 ml-1"}),n.total," إجمالي"]})}),p.jsx("div",{className:"flex items-center gap-2",children:p.jsxs(qo,{variant:"outline",className:"bg-emerald-50 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-300",children:["✅ ",n.completed," مكتملة"]})}),p.jsx("div",{className:"flex items-center gap-2",children:p.jsxs(qo,{variant:"outline",className:"bg-amber-50 dark:bg-amber-900 text-amber-700 dark:text-amber-300",children:["📅 ",n.planned," مخططة"]})}),p.jsx("div",{className:"flex items-center gap-2",children:p.jsxs(qo,{variant:"outline",className:"bg-red-50 dark:bg-red-900 text-red-700 dark:text-red-300",children:["❌ ",n.cancelled," ملغية"]})})]})]})]})})()]})})]})]}),V&&p.jsx(Lo,{className:"mb-4",children:p.jsx(Yo,{className:"p-4",children:p.jsx("div",{className:"flex items-center justify-between",children:p.jsxs("div",{children:[p.jsx("h3",{className:"font-semibold",children:"نظام العلاجات المتعددة"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"النظام المحسن: يدعم عدة علاجات للسن الواحد مع الألوان العالمية"})]})})})}),V&&w&&b.length>0&&p.jsx(Lo,{className:"bg-orange-50 dark:bg-orange-950/20 border-orange-200 dark:border-orange-800",children:p.jsx(Yo,{className:"p-4",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500"}),p.jsxs("span",{className:"text-sm font-medium text-orange-700 dark:text-orange-300",children:["تم تحديد ",b.length," سن"]})]}),p.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["الأسنان المحددة: ",b.sort((e,t)=>e-t).join(", ")]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Qi,{size:"sm",onClick:()=>{0!==b.length?D(!0):rc.warning("يرجى تحديد أسنان أولاً")},className:"bg-orange-600 hover:bg-orange-700 text-white",children:"إضافة علاج للأسنان المحددة"}),p.jsx(Qi,{size:"sm",variant:"outline",onClick:K,className:"border-orange-300 text-orange-700 hover:bg-orange-100 dark:border-orange-700 dark:text-orange-300 dark:hover:bg-orange-900/20",children:"إلغاء التحديد"})]})]})})}),V&&!w&&p.jsx(Lo,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:p.jsx(Yo,{className:"p-3",children:p.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-700 dark:text-blue-300",children:[p.jsx(Br,{className:"w-4 h-4"}),p.jsxs("span",{children:[p.jsx("strong",{children:"نصيحة:"})," اضغط CTRL + النقر لتحديد عدة أسنان وإضافة نفس العلاج لها"]})]})})}),V&&p.jsx("div",{id:"dental-chart-section",children:p.jsx(nC,{patientId:g,onToothClick:(e,t=!1)=>{g?t?W(e):(j([]),N(!1),y(e),k(!0)):rc.warning("يرجى اختيار مريض أولاً")},selectedTooth:v,selectedTeeth:b,isMultiSelectMode:w,isPrimaryTeeth:P,onPrimaryTeethChange:O})}),V&&q.length>0&&p.jsxs(Lo,{className:"bg-card dark:bg-card border-border",children:[p.jsx(Io,{className:"bg-card dark:bg-card",children:p.jsxs(zo,{className:"flex items-center gap-2 text-foreground",children:[p.jsx(Pr,{className:"w-5 h-5"}),"الوصفات الطبية"]})}),p.jsx(Yo,{className:"bg-card dark:bg-card",children:p.jsx("div",{className:"space-y-2",children:q.map(e=>p.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-colors",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"font-medium",children:["وصفة طبية - ",ma(e.prescription_date)]}),e.notes&&p.jsx("div",{className:"text-sm text-muted-foreground",children:e.notes})]}),p.jsxs(Qi,{variant:"outline",size:"sm",onClick:()=>(e=>{T(e),C(!0)})(e),children:[p.jsx(ci,{className:"w-4 h-4 ml-2"}),"طباعة"]})]},e.id))})})]}),!V&&!L&&p.jsx(Lo,{children:p.jsxs(Yo,{className:"text-center py-12",children:[p.jsx(yi,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground opacity-50"}),p.jsx("h3",{className:"text-lg font-medium mb-2",children:"اختر مريض لبدء العلاج"}),p.jsx("p",{className:"text-muted-foreground",children:"استخدم البحث أعلاه لاختيار مريض وعرض مخطط الأسنان التفاعلي"})]})}),p.jsx(xC,{open:_,onOpenChange:e=>m(this,null,function*(){k(e),!e&&g&&(l(g),c(g),yield H())}),patientId:g,toothNumber:v,isPrimaryTeeth:P,onSessionStatsUpdate:H,onTreatmentUpdate:()=>m(this,null,function*(){g&&(yield Promise.all([l(g),c(g)]),y(e=>e),setTimeout(()=>{y(e=>e)},100))})}),E&&p.jsx(Z$,{open:$,onOpenChange:C,prescription:E}),p.jsx(fC,{open:S,onOpenChange:D,patientId:g,selectedTeeth:b,onAddTreatments:e=>m(this,null,function*(){try{M(!0);const t=[];for(const n of e){const e=yield u(n);e&&t.push(e)}return g&&(yield Promise.all([l(g),c(g)])),K(),t}catch(t){throw console.error("Error adding multiple treatments:",t),rc.error("فشل في إضافة العلاجات"),t}finally{M(!1)}})})]})}const yC=({open:e,onOpenChange:t,editingNeed:n})=>{const{createNeed:a,updateNeed:s,isLoading:r,categories:i,suppliers:l,getNextSerialNumber:c}=Eh(),{toast:u}=yl(),[h,x]=ve.useState({need_name:"",quantity:1,price:0,description:"",category:"",priority:"medium",status:"pending",supplier:"",notes:""}),[g,f]=ve.useState({});ve.useEffect(()=>{x(n?{need_name:n.need_name,quantity:n.quantity,price:n.price,description:n.description||"",category:n.category||"",priority:n.priority,status:n.status,supplier:n.supplier||"",notes:n.notes||""}:{need_name:"",quantity:1,price:0,description:"",category:"",priority:"medium",status:"pending",supplier:"",notes:""}),f({})},[n,e]);const v=(e,t)=>{x(n=>d(o({},n),{[e]:t})),g[e]&&f(t=>d(o({},t),{[e]:""}))};return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"sm:max-w-[600px]",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsx(Ui,{children:n?"تعديل الاحتياج":"إضافة احتياج جديد"}),p.jsx(Hi,{children:n?"قم بتعديل بيانات الاحتياج":"أدخل بيانات الاحتياج الجديد للعيادة"})]}),p.jsxs("form",{onSubmit:e=>m(void 0,null,function*(){if(e.preventDefault(),(()=>{const e={};return h.need_name.trim()||(e.need_name="اسم الاحتياج مطلوب"),h.quantity<=0&&(e.quantity="الكمية يجب أن تكون أكبر من صفر"),h.price<0&&(e.price="السعر لا يمكن أن يكون سالباً"),f(e),0===Object.keys(e).length})())try{if(n){const e=d(o({},h),{serial_number:n.serial_number});yield s(n.id,e),u({title:"تم التحديث بنجاح",description:"تم تحديث الاحتياج بنجاح"})}else{const e=d(o({},h),{serial_number:c()});yield a(e),u({title:"تم الإنشاء بنجاح",description:"تم إنشاء الاحتياج الجديد بنجاح"})}t(!1)}catch(r){u({title:"خطأ",description:"حدث خطأ أثناء حفظ الاحتياج",variant:"destructive"})}}),className:"space-y-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"need_name",children:"اسم الاحتياج *"}),p.jsx(Xi,{id:"need_name",value:h.need_name,onChange:e=>v("need_name",e.target.value),placeholder:"أدخل اسم الاحتياج",className:g.need_name?"border-red-500":""}),g.need_name&&p.jsx("p",{className:"text-sm text-red-500",children:g.need_name})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"quantity",children:"الكمية"}),p.jsx(Xi,{id:"quantity",type:"number",min:"1",value:h.quantity,onChange:e=>{const t=e.target.value;v("quantity",""===t?1:parseInt(t)||1)},onBlur:e=>{const t=parseInt(e.target.value)||1;v("quantity",t)},className:g.quantity?"border-red-500":""}),g.quantity&&p.jsx("p",{className:"text-sm text-red-500",children:g.quantity})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"price",children:"السعر"}),p.jsx(Xi,{id:"price",type:"number",min:"0",step:"1",value:h.price,onChange:e=>{const t=e.target.value;v("price",""===t?0:parseFloat(t)||0)},onBlur:e=>{const t=parseFloat(e.target.value)||0;v("price",t)},className:g.price?"border-red-500":""}),g.price&&p.jsx("p",{className:"text-sm text-red-500",children:g.price})]})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"category",children:"الفئة"}),p.jsxs(el,{value:h.category,onValueChange:e=>v("category",e),children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر الفئة"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"أدوات طبية",children:"أدوات طبية"}),p.jsx(dl,{value:"مواد استهلاكية",children:"مواد استهلاكية"}),p.jsx(dl,{value:"أجهزة",children:"أجهزة"}),p.jsx(dl,{value:"أثاث",children:"أثاث"}),p.jsx(dl,{value:"مواد تنظيف",children:"مواد تنظيف"}),p.jsx(dl,{value:"أخرى",children:"أخرى"}),i.filter(e=>!["أدوات طبية","مواد استهلاكية","أجهزة","أثاث","مواد تنظيف","أخرى"].includes(e)).map(e=>p.jsx(dl,{value:e,children:e},e))]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"priority",children:"الأولوية"}),p.jsxs(el,{value:h.priority,onValueChange:e=>v("priority",e),children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر الأولوية"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"urgent",children:"عاجل"}),p.jsx(dl,{value:"high",children:"عالي"}),p.jsx(dl,{value:"medium",children:"متوسط"}),p.jsx(dl,{value:"low",children:"منخفض"})]})]})]})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"status",children:"الحالة"}),p.jsxs(el,{value:h.status,onValueChange:e=>v("status",e),children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر الحالة"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"pending",children:"معلق"}),p.jsx(dl,{value:"ordered",children:"مطلوب"}),p.jsx(dl,{value:"received",children:"مستلم"}),p.jsx(dl,{value:"cancelled",children:"ملغي"})]})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"supplier",children:"المورد"}),p.jsx(Xi,{id:"supplier",value:h.supplier,onChange:e=>v("supplier",e.target.value),placeholder:"اسم المورد (اختياري)"})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"description",children:"الوصف"}),p.jsx(Ji,{id:"description",value:h.description,onChange:e=>v("description",e.target.value),placeholder:"وصف تفصيلي للاحتياج (اختياري)",rows:3})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"notes",children:"ملاحظات"}),p.jsx(Ji,{id:"notes",value:h.notes,onChange:e=>v("notes",e.target.value),placeholder:"ملاحظات إضافية (اختياري)",rows:2})]}),p.jsxs(qi,{children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:()=>t(!1),children:"إلغاء"}),p.jsx(Qi,{type:"submit",disabled:r,children:r?"جاري الحفظ...":n?"تحديث":"إضافة"})]})]})]})})},bC=({open:e,onOpenChange:t,need:n})=>{const{deleteNeed:a,isLoading:s}=Eh(),{toast:r}=yl();return n?p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"sm:max-w-[425px]",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"flex items-center gap-2 text-red-600",children:[p.jsx(sr,{className:"w-5 h-5"}),"تأكيد الحذف"]}),p.jsx(Hi,{children:"هل أنت متأكد من حذف هذا الاحتياج؟ لا يمكن التراجع عن هذا الإجراء."})]}),p.jsx("div",{className:"py-4",children:p.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"font-medium",children:"#:"}),p.jsx("span",{children:n.serial_number})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"font-medium",children:"اسم الاحتياج:"}),p.jsx("span",{children:n.need_name})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"font-medium",children:"الكمية:"}),p.jsx("span",{children:n.quantity})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"font-medium",children:"السعر:"}),p.jsx("span",{children:ca(n.price)})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{className:"font-medium",children:"الإجمالي:"}),p.jsx("span",{className:"font-bold",children:ca(n.price*n.quantity)})]})]})}),p.jsxs(qi,{children:[p.jsx(Qi,{variant:"outline",onClick:()=>t(!1),children:"إلغاء"}),p.jsx(Qi,{variant:"destructive",onClick:()=>m(void 0,null,function*(){if(n)try{yield a(n.id),r({title:"تم الحذف بنجاح",description:"تم حذف الاحتياج بنجاح"}),t(!1)}catch(e){r({title:"خطأ",description:"حدث خطأ أثناء حذف الاحتياج",variant:"destructive"})}}),disabled:s,children:s?"جاري الحذف...":"حذف"})]})]})}):null},jC=({needs:e,onEdit:t,onDelete:n,onReceiveAndDelete:a,isLoading:s=!1})=>{const r=e=>{const t={pending:{label:"معلق",variant:"secondary",icon:Sr},ordered:{label:"مطلوب",variant:"default",icon:fi},received:{label:"مستلم",variant:"default",icon:gr},cancelled:{label:"ملغي",variant:"destructive",icon:sr}}[e];if(!t)return null;const n=t.icon;return p.jsxs(qo,{variant:t.variant,className:"flex items-center gap-1 w-fit",children:[p.jsx(n,{className:"w-3 h-3"}),t.label]})},i=e=>{const t={low:{label:"منخفض",variant:"secondary",color:"bg-gray-100 text-gray-800"},medium:{label:"متوسط",variant:"default",color:"bg-blue-100 text-blue-800"},high:{label:"عالي",variant:"default",color:"bg-orange-100 text-orange-800"},urgent:{label:"عاجل",variant:"destructive",color:"bg-red-100 text-red-800"}}[e];return t?p.jsx(qo,{variant:t.variant,className:`${t.color} w-fit`,children:t.label}):null};return s?p.jsxs("div",{className:"text-center py-8",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),p.jsx("p",{className:"mt-2 text-muted-foreground",children:"جاري التحميل..."})]}):0===e.length?p.jsxs("div",{className:"text-center py-12",children:[p.jsx(ti,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"لا توجد احتياجات"}),p.jsx("p",{className:"text-muted-foreground",children:"لم يتم العثور على أي احتياجات مطابقة للبحث"})]}):p.jsx("div",{className:"rounded-md border",dir:"rtl",children:p.jsxs(Qd,{children:[p.jsx(Xd,{children:p.jsxs(ec,{children:[p.jsx(tc,{className:"text-center",children:"#"}),p.jsx(tc,{className:"text-right",children:"اسم الاحتياج"}),p.jsx(tc,{className:"text-right",children:"الكمية"}),p.jsx(tc,{className:"text-right",children:"السعر"}),p.jsx(tc,{className:"text-right",children:"الإجمالي"}),p.jsx(tc,{className:"text-right",children:"الفئة"}),p.jsx(tc,{className:"text-right",children:"الأولوية"}),p.jsx(tc,{className:"text-right",children:"الحالة"}),p.jsx(tc,{className:"text-right",children:"المورد"}),p.jsx(tc,{className:"text-right",children:"الإجراءات"})]})}),p.jsx(Jd,{children:e.map((e,s)=>p.jsxs(ec,{className:"hover:bg-muted/50",children:[p.jsx(nc,{className:"font-medium text-center",children:p.jsx("span",{className:"text-sm text-muted-foreground",children:s+1})}),p.jsx(nc,{children:p.jsxs("div",{children:[p.jsx("div",{className:"font-medium",children:e.need_name}),e.description&&p.jsx("div",{className:"text-sm text-muted-foreground mt-1 max-w-xs truncate",children:e.description})]})}),p.jsx(nc,{children:p.jsx("span",{className:"font-medium",children:e.quantity})}),p.jsx(nc,{children:p.jsx("span",{className:"font-medium",children:ca(e.price)})}),p.jsx(nc,{children:p.jsx("span",{className:"font-bold text-primary",children:ca(e.price*e.quantity)})}),p.jsx(nc,{children:e.category&&p.jsx(qo,{variant:"outline",className:"w-fit",children:e.category})}),p.jsx(nc,{children:i(e.priority)}),p.jsx(nc,{children:r(e.status)}),p.jsx(nc,{children:e.supplier&&p.jsx("span",{className:"text-sm",children:e.supplier})}),p.jsx(nc,{children:p.jsxs("div",{className:"flex items-center gap-2",children:["received"!==e.status&&p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>a(e),className:"h-8 w-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",title:"تأكيد الاستلام وتحديث الحالة إلى مستلم",children:p.jsx(fr,{className:"h-4 w-4"})}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>t(e),className:"h-8 w-8 p-0",children:p.jsx(si,{className:"h-4 w-4"})}),p.jsx(Qi,{variant:"ghost",size:"sm",onClick:()=>n(e),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:p.jsx(Ni,{className:"h-4 w-4"})})]})})]},e.id))})]})})},wC=({searchQuery:e,onSearchChange:t,filters:n,onFilterChange:a,categories:s,suppliers:r,onClearFilters:i})=>{const l=e||n.category||n.priority||n.status;return p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs(zo,{className:"flex items-center gap-2",children:[p.jsx(Or,{className:"w-5 h-5"}),"البحث والتصفية"]}),l&&p.jsxs(Qi,{variant:"outline",size:"sm",onClick:i,className:"flex items-center gap-1",children:[p.jsx(Mi,{className:"w-3 h-3"}),"مسح الفلاتر"]})]})}),p.jsxs(Yo,{children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[p.jsxs("div",{className:"relative",children:[p.jsx(hi,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),p.jsx(Xi,{placeholder:"البحث في الاحتياجات...",value:e,onChange:e=>t(e.target.value),className:"pr-10"})]}),p.jsxs(el,{value:n.category||"all",onValueChange:e=>a("category",e),children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"الفئة"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الفئات"}),p.jsx(dl,{value:"أدوات طبية",children:"أدوات طبية"}),p.jsx(dl,{value:"مواد استهلاكية",children:"مواد استهلاكية"}),p.jsx(dl,{value:"أجهزة",children:"أجهزة"}),p.jsx(dl,{value:"أثاث",children:"أثاث"}),p.jsx(dl,{value:"مواد تنظيف",children:"مواد تنظيف"}),p.jsx(dl,{value:"أخرى",children:"أخرى"}),s.filter(e=>!["أدوات طبية","مواد استهلاكية","أجهزة","أثاث","مواد تنظيف","أخرى"].includes(e)).map(e=>p.jsx(dl,{value:e,children:e},e))]})]}),p.jsxs(el,{value:n.priority||"all",onValueChange:e=>a("priority",e),children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"الأولوية"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الأولويات"}),p.jsx(dl,{value:"urgent",children:"عاجل"}),p.jsx(dl,{value:"high",children:"عالي"}),p.jsx(dl,{value:"medium",children:"متوسط"}),p.jsx(dl,{value:"low",children:"منخفض"})]})]}),p.jsxs(el,{value:n.status||"all",onValueChange:e=>a("status",e),children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"الحالة"})}),p.jsxs(il,{children:[p.jsx(dl,{value:"all",children:"جميع الحالات"}),p.jsx(dl,{value:"pending",children:"معلق"}),p.jsx(dl,{value:"ordered",children:"مطلوب"}),p.jsx(dl,{value:"received",children:"مستلم"}),p.jsx(dl,{value:"cancelled",children:"ملغي"})]})]})]}),l&&p.jsx("div",{className:"mt-4 p-3 bg-muted/50 rounded-lg",children:p.jsxs("div",{className:"text-sm text-muted-foreground",children:["الفلاتر النشطة:",e&&p.jsxs("span",{className:"inline-block bg-primary/10 text-primary px-2 py-1 rounded mr-2 text-xs",children:['البحث: "',e,'"']}),n.category&&"all"!==n.category&&p.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2 text-xs",children:["الفئة: ",n.category]}),n.priority&&"all"!==n.priority&&p.jsxs("span",{className:"inline-block bg-orange-100 text-orange-800 px-2 py-1 rounded mr-2 text-xs",children:["الأولوية: ",NC(n.priority)]}),n.status&&"all"!==n.status&&p.jsxs("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded mr-2 text-xs",children:["الحالة: ",_C(n.status)]})]})})]})]})},NC=e=>({low:"منخفض",medium:"متوسط",high:"عالي",urgent:"عاجل"}[e]||e),_C=e=>({pending:"معلق",ordered:"مطلوب",received:"مستلم",cancelled:"ملغي"}[e]||e),kC=()=>{const{needs:e,filteredNeeds:t,isLoading:n,error:a,searchQuery:s,filters:r,categories:i,suppliers:l,totalNeeds:c,totalValue:u,pendingCount:h,orderedCount:x,receivedCount:g,urgentCount:f,loadNeeds:v,deleteNeed:y,updateNeed:b,setSearchQuery:j,setFilters:w,clearError:N}=Eh(),{toast:_}=yl(),[k,S]=ve.useState(!1),[D,$]=ve.useState(!1),[C,E]=ve.useState(null),[T,A]=ve.useState(null);ve.useEffect(()=>{v()},[v]);const F=({title:e,value:t,icon:n,color:a="blue"})=>p.jsx(Lo,{className:vd(a),children:p.jsx(Yo,{className:"p-6",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:e}),p.jsx("p",{className:"text-2xl font-bold text-foreground",children:t})]}),p.jsx("div",{className:`text-2xl ${yd(a)}`,children:n})]})})});return a?p.jsx("div",{className:"p-6",children:p.jsx(Lo,{children:p.jsx(Yo,{className:"pt-6",children:p.jsxs("div",{className:"text-center text-red-600",children:[p.jsxs("p",{children:["حدث خطأ: ",a]}),p.jsx(Qi,{onClick:N,className:"mt-2",children:"إعادة المحاولة"})]})})})}):p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[p.jsx(kr,{className:"w-8 h-8 text-primary"}),"احتياجات العيادة"]}),p.jsx("p",{className:"text-muted-foreground mt-1",children:"إدارة احتياجات ومتطلبات العيادة"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(Qi,{variant:"outline",onClick:()=>m(void 0,null,function*(){if(0!==t.length)try{yield ic.exportClinicNeedsToCSV(t,`احتياجات_العيادة_${(new Date).toISOString().split("T")[0]}`),rc.exportSuccess(`تم تصدير ${t.length} احتياج بنجاح إلى ملف Excel مع التنسيق الجميل!`)}catch(e){console.error("Error exporting clinic needs:",e),rc.exportError("فشل في تصدير بيانات الاحتياجات")}else rc.noDataToExport("لا توجد بيانات احتياجات للتصدير")}),children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير"]}),p.jsxs(Qi,{onClick:()=>{E(null),S(!0)},className:"flex items-center gap-2",children:[p.jsx(di,{className:"w-4 h-4"}),"إضافة احتياج جديد"]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[p.jsx(F,{title:"إجمالي المواد",value:c,icon:p.jsx(ti,{}),color:"blue"}),p.jsx(F,{title:"إجمالي السعر",value:ca(u),icon:p.jsx(Er,{}),color:"green"}),p.jsx(F,{title:"معلق",value:h,icon:p.jsx(Sr,{}),color:"yellow"}),p.jsx(F,{title:"عاجل",value:f,icon:p.jsx(sr,{}),color:"red"})]}),p.jsx(wC,{searchQuery:s,onSearchChange:j,filters:r,onFilterChange:(e,t)=>{w(d(o({},r),{[e]:"all"===t?void 0:t}))},categories:i,suppliers:l,onClearFilters:()=>{j(""),w({})}}),p.jsxs(Lo,{children:[p.jsxs(Io,{children:[p.jsx(zo,{children:"قائمة الاحتياجات"}),p.jsx(Bo,{children:"عرض جميع احتياجات العيادة مع إمكانية التعديل والحذف"})]}),p.jsx(Yo,{children:p.jsx(jC,{needs:t,onEdit:e=>{E(e),S(!0)},onDelete:e=>{A(e),$(!0)},onReceiveAndDelete:e=>m(void 0,null,function*(){try{const t={serial_number:e.serial_number,need_name:e.need_name,quantity:e.quantity,price:e.price,description:e.description,category:e.category,priority:e.priority,status:"received",supplier:e.supplier,notes:e.notes};yield b(e.id,t),_({title:"تم تأكيد الاستلام",description:`تم تأكيد استلام "${e.need_name}" وتحديث حالته إلى مستلم`})}catch(t){_({title:"خطأ",description:"حدث خطأ أثناء تأكيد الاستلام",variant:"destructive"})}}),isLoading:n})})]}),p.jsx(yC,{open:k,onOpenChange:()=>{S(!1),E(null)},editingNeed:C}),p.jsx(bC,{open:D,onOpenChange:()=>{$(!1),A(null)},need:T})]})},SC=({open:e,onOpenChange:t,editingExpense:n})=>{const{createExpense:a,updateExpense:s,isLoading:r,categories:i,vendors:l}=Ch(),{currentCurrency:c,formatAmount:u,getCurrencySymbol:h}=Sa(),{toast:x}=yl(),[g,f]=ve.useState({expense_name:"",amount:"",expense_type:"",category:"",description:"",payment_method:"",payment_date:"",due_date:"",is_recurring:!1,recurring_frequency:"",recurring_end_date:"",status:"pending",receipt_number:"",vendor:"",notes:""}),[v,y]=ve.useState({});ve.useEffect(()=>{var e,t,a,s;f(n?{expense_name:n.expense_name||"",amount:(null==(e=n.amount)?void 0:e.toString())||"",expense_type:n.expense_type||"",category:n.category||"",description:n.description||"",payment_method:n.payment_method||"",payment_date:(null==(t=n.payment_date)?void 0:t.split("T")[0])||"",due_date:(null==(a=n.due_date)?void 0:a.split("T")[0])||"",is_recurring:n.is_recurring||!1,recurring_frequency:n.recurring_frequency||"",recurring_end_date:(null==(s=n.recurring_end_date)?void 0:s.split("T")[0])||"",status:n.status||"pending",receipt_number:n.receipt_number||"",vendor:n.vendor||"",notes:n.notes||""}:{expense_name:"",amount:"",expense_type:"",category:"",description:"",payment_method:"",payment_date:(new Date).toISOString().split("T")[0],due_date:"",is_recurring:!1,recurring_frequency:"",recurring_end_date:"",status:"pending",receipt_number:"",vendor:"",notes:""}),y({})},[n,e]);const b=(e,t)=>{f(n=>d(o({},n),{[e]:t})),v[e]&&y(t=>d(o({},t),{[e]:""}))};return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"flex items-center gap-2",children:[p.jsx(ui,{className:"w-5 h-5 text-primary"}),n?"تعديل المصروف":"إضافة مصروف جديد"]}),p.jsx(Hi,{children:n?"تعديل بيانات المصروف":"إضافة مصروف جديد للعيادة"})]}),p.jsxs("form",{onSubmit:e=>m(void 0,null,function*(){if(e.preventDefault(),(()=>{const e={};return g.expense_name.trim()||(e.expense_name="اسم المصروف مطلوب"),(!g.amount||parseFloat(g.amount)<=0)&&(e.amount="المبلغ مطلوب ويجب أن يكون أكبر من صفر"),g.expense_type||(e.expense_type="نوع المصروف مطلوب"),g.payment_method||(e.payment_method="طريقة الدفع مطلوبة"),g.payment_date||(e.payment_date="تاريخ الدفع مطلوب"),g.is_recurring&&!g.recurring_frequency&&(e.recurring_frequency="تكرار المصروف مطلوب للمصروفات المتكررة"),y(e),0===Object.keys(e).length})())try{const e=d(o({},g),{amount:parseFloat(g.amount),payment_date:new Date(g.payment_date).toISOString(),due_date:g.due_date?new Date(g.due_date).toISOString():void 0,recurring_end_date:g.recurring_end_date?new Date(g.recurring_end_date).toISOString():void 0});n?(yield s(n.id,e),x({title:"تم التحديث بنجاح",description:"تم تحديث المصروف بنجاح"})):(yield a(e),x({title:"تم الإضافة بنجاح",description:"تم إضافة المصروف بنجاح"})),t(!1)}catch(r){x({title:"خطأ",description:n?"فشل في تحديث المصروف":"فشل في إضافة المصروف",variant:"destructive"})}}),className:"space-y-4",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"expense_name",children:"اسم المصروف *"}),p.jsx(Xi,{id:"expense_name",value:g.expense_name,onChange:e=>b("expense_name",e.target.value),placeholder:"مثال: راتب السكرتيرة",className:v.expense_name?"border-destructive":""}),v.expense_name&&p.jsx("p",{className:"text-sm text-destructive",children:v.expense_name})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs(Ro,{htmlFor:"amount",children:["المبلغ (",h(),") *"]}),p.jsxs("div",{className:"relative",children:[p.jsx(Er,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),p.jsx(Xi,{id:"amount",type:"number",step:"1",min:"0",value:g.amount,onChange:e=>b("amount",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;b("amount",t.toString())},placeholder:"0.00",className:"pl-10 "+(v.amount?"border-destructive":"")})]}),v.amount&&p.jsx("p",{className:"text-sm text-destructive",children:v.amount})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"expense_type",children:"نوع المصروف *"}),p.jsxs(el,{value:g.expense_type,onValueChange:e=>b("expense_type",e),children:[p.jsx(al,{className:v.expense_type?"border-destructive":"",children:p.jsx(nl,{placeholder:"اختر نوع المصروف"})}),p.jsx(il,{children:[{value:"salary",label:"راتب"},{value:"utilities",label:"مرافق (كهرباء، مياه، غاز)"},{value:"rent",label:"إيجار"},{value:"maintenance",label:"صيانة"},{value:"supplies",label:"مستلزمات"},{value:"insurance",label:"تأمين"},{value:"other",label:"أخرى"}].map(e=>p.jsx(dl,{value:e.value,children:e.label},e.value))})]}),v.expense_type&&p.jsx("p",{className:"text-sm text-destructive",children:v.expense_type})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"category",children:"الفئة"}),p.jsx(Xi,{id:"category",value:g.category,onChange:e=>b("category",e.target.value),placeholder:"مثال: مصروفات إدارية",list:"categories"}),p.jsx("datalist",{id:"categories",children:i.map(e=>p.jsx("option",{value:e},e))})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"description",children:"الوصف"}),p.jsx(Ji,{id:"description",value:g.description,onChange:e=>b("description",e.target.value),placeholder:"وصف تفصيلي للمصروف",rows:3})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"payment_method",children:"طريقة الدفع *"}),p.jsxs(el,{value:g.payment_method,onValueChange:e=>b("payment_method",e),children:[p.jsx(al,{className:v.payment_method?"border-destructive":"",children:p.jsx(nl,{placeholder:"اختر طريقة الدفع"})}),p.jsx(il,{children:[{value:"cash",label:"نقدي"},{value:"bank_transfer",label:"تحويل بنكي"},{value:"check",label:"شيك"},{value:"credit_card",label:"بطاقة ائتمان"}].map(e=>p.jsx(dl,{value:e.value,children:e.label},e.value))})]}),v.payment_method&&p.jsx("p",{className:"text-sm text-destructive",children:v.payment_method})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"status",children:"الحالة"}),p.jsxs(el,{value:g.status,onValueChange:e=>b("status",e),children:[p.jsx(al,{children:p.jsx(nl,{placeholder:"اختر الحالة"})}),p.jsx(il,{children:[{value:"pending",label:"معلق"},{value:"paid",label:"مدفوع"},{value:"overdue",label:"متأخر"},{value:"cancelled",label:"ملغي"}].map(e=>p.jsx(dl,{value:e.value,children:e.label},e.value))})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"payment_date",children:"تاريخ الدفع *"}),p.jsxs("div",{className:"relative",children:[p.jsx(hr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),p.jsx(Xi,{id:"payment_date",type:"date",value:g.payment_date,onChange:e=>b("payment_date",e.target.value),className:"pl-10 "+(v.payment_date?"border-destructive":"")})]}),v.payment_date&&p.jsx("p",{className:"text-sm text-destructive",children:v.payment_date})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"due_date",children:"تاريخ الاستحقاق"}),p.jsxs("div",{className:"relative",children:[p.jsx(hr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),p.jsx(Xi,{id:"due_date",type:"date",value:g.due_date,onChange:e=>b("due_date",e.target.value),className:"pl-10"})]})]})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx(tC,{id:"is_recurring",checked:g.is_recurring,onCheckedChange:e=>b("is_recurring",e)}),p.jsx(Ro,{htmlFor:"is_recurring",children:"مصروف متكرر"})]}),g.is_recurring&&p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"recurring_frequency",children:"تكرار المصروف *"}),p.jsxs(el,{value:g.recurring_frequency,onValueChange:e=>b("recurring_frequency",e),children:[p.jsx(al,{className:v.recurring_frequency?"border-destructive":"",children:p.jsx(nl,{placeholder:"اختر التكرار"})}),p.jsx(il,{children:[{value:"daily",label:"يومي"},{value:"weekly",label:"أسبوعي"},{value:"monthly",label:"شهري"},{value:"quarterly",label:"ربع سنوي"},{value:"yearly",label:"سنوي"}].map(e=>p.jsx(dl,{value:e.value,children:e.label},e.value))})]}),v.recurring_frequency&&p.jsx("p",{className:"text-sm text-destructive",children:v.recurring_frequency})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"recurring_end_date",children:"تاريخ انتهاء التكرار"}),p.jsx(Xi,{id:"recurring_end_date",type:"date",value:g.recurring_end_date,onChange:e=>b("recurring_end_date",e.target.value)})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"receipt_number",children:"رقم الإيصال"}),p.jsx(Xi,{id:"receipt_number",value:g.receipt_number,onChange:e=>b("receipt_number",e.target.value),placeholder:"رقم الإيصال أو الفاتورة"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"vendor",children:"المورد/الجهة"}),p.jsx(Xi,{id:"vendor",value:g.vendor,onChange:e=>b("vendor",e.target.value),placeholder:"اسم المورد أو الجهة",list:"vendors"}),p.jsx("datalist",{id:"vendors",children:l.map(e=>p.jsx("option",{value:e},e))})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(Ro,{htmlFor:"notes",children:"ملاحظات"}),p.jsx(Ji,{id:"notes",value:g.notes,onChange:e=>b("notes",e.target.value),placeholder:"ملاحظات إضافية",rows:3})]}),p.jsxs(qi,{className:"gap-2",children:[p.jsx(Qi,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:r,children:"إلغاء"}),p.jsxs(Qi,{type:"submit",disabled:r,children:[r&&p.jsx(Hr,{className:"w-4 h-4 mr-2 animate-spin"}),n?"تحديث":"إضافة"]})]})]})]})})},DC=({open:e,onOpenChange:t,expense:n})=>{const{deleteExpense:a,isLoading:s}=Ch();Sa();const{toast:r}=yl();if(!n)return null;return p.jsx(Ii,{open:e,onOpenChange:t,children:p.jsxs(Yi,{className:"max-w-md",dir:"rtl",children:[p.jsxs(Vi,{children:[p.jsxs(Ui,{className:"flex items-center gap-2 text-destructive",children:[p.jsx(sr,{className:"w-5 h-5"}),"تأكيد حذف المصروف"]}),p.jsx(Hi,{children:"هل أنت متأكد من حذف هذا المصروف؟ لا يمكن التراجع عن هذا الإجراء."})]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg space-y-3",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(ui,{className:"w-4 h-4 text-muted-foreground"}),p.jsx("span",{className:"font-semibold text-foreground",children:n.expense_name})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground",children:"المبلغ:"}),p.jsx("span",{className:"font-medium text-foreground mr-2",children:p.jsx(Nh,{amount:n.amount})})]}),p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground",children:"النوع:"}),p.jsx("span",{className:"font-medium text-foreground mr-2",children:(l=n.expense_type,{salary:"راتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"}[l]||l)})]}),p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),p.jsx("span",{className:"font-medium text-foreground mr-2",children:(i=n.status,{pending:"معلق",paid:"مدفوع",overdue:"متأخر",cancelled:"ملغي"}[i]||i)})]}),p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground",children:"التاريخ:"}),p.jsx("span",{className:"font-medium text-foreground mr-2",children:new Date(n.payment_date).toLocaleDateString("ar-SA")})]})]}),n.description&&p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground text-sm",children:"الوصف:"}),p.jsx("p",{className:"text-sm text-foreground mt-1",children:n.description})]}),n.vendor&&p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground text-sm",children:"المورد:"}),p.jsx("span",{className:"text-sm text-foreground mr-2",children:n.vendor})]}),n.receipt_number&&p.jsxs("div",{children:[p.jsx("span",{className:"text-muted-foreground text-sm",children:"رقم الإيصال:"}),p.jsx("span",{className:"text-sm text-foreground mr-2",children:n.receipt_number})]}),n.is_recurring&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded",children:"مصروف متكرر"}),n.recurring_frequency&&p.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",n.recurring_frequency,")"]})]})]}),p.jsx("div",{className:"bg-destructive/10 border border-destructive/20 p-3 rounded-lg",children:p.jsxs("div",{className:"flex items-start gap-2",children:[p.jsx(sr,{className:"w-4 h-4 text-destructive mt-0.5 flex-shrink-0"}),p.jsxs("div",{className:"text-sm",children:[p.jsx("p",{className:"font-medium text-destructive mb-1",children:"تحذير:"}),p.jsx("p",{className:"text-destructive/80",children:"سيتم حذف هذا المصروف نهائياً من النظام. إذا كان هذا مصروف متكرر، فسيتم حذف جميع التكرارات المستقبلية أيضاً."})]})]})})]}),p.jsxs(qi,{className:"gap-2",children:[p.jsx(Qi,{variant:"outline",onClick:()=>t(!1),disabled:s,children:"إلغاء"}),p.jsxs(Qi,{variant:"destructive",onClick:()=>m(void 0,null,function*(){if(n)try{yield a(n.id),r({title:"تم الحذف بنجاح",description:"تم حذف المصروف بنجاح"}),t(!1)}catch(e){r({title:"خطأ في الحذف",description:"فشل في حذف المصروف. يرجى المحاولة مرة أخرى.",variant:"destructive"})}}),disabled:s,children:[s&&p.jsx(Hr,{className:"w-4 h-4 mr-2 animate-spin"}),"حذف المصروف"]})]})]})});var i,l},$C=()=>{const{expenses:e,filteredExpenses:t,isLoading:n,error:a,searchQuery:s,filters:r,categories:i,vendors:l,expenseTypes:o,analytics:d,loadExpenses:c,deleteExpense:u,updateExpense:h,setSearchQuery:x,setFilters:g,clearError:f}=Ch();Sa();const{toast:v}=yl(),[y,b]=ve.useState(!1),[j,w]=ve.useState(!1),[N,_]=ve.useState(null),[k,S]=ve.useState(null);ve.useEffect(()=>{c()},[c]);return a?p.jsx("div",{className:"flex items-center justify-center h-64",children:p.jsxs("div",{className:"text-center",children:[p.jsx(sr,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"خطأ في تحميل البيانات"}),p.jsx("p",{className:"text-muted-foreground mb-4",children:a}),p.jsx(Qi,{onClick:()=>{f(),c()},children:"إعادة المحاولة"})]})}):p.jsxs("div",{className:"space-y-6",dir:"rtl",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[p.jsx(ui,{className:"w-8 h-8 text-primary"}),"مصروفات العيادة"]}),p.jsx("p",{className:"text-muted-foreground mt-1",children:"إدارة المصروفات التشغيلية للعيادة"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs(Qi,{variant:"outline",onClick:()=>m(void 0,null,function*(){try{if(0===t.length)return void rc.noDataToExport("لا توجد بيانات مصروفات للتصدير");yield ic.exportClinicExpensesToExcel(t),rc.exportSuccess(`تم تصدير ${t.length} مصروف بنجاح إلى ملف Excel مع التنسيق الجميل!`)}catch(e){console.error("Error exporting clinic expenses:",e),rc.exportError("فشل في تصدير بيانات المصروفات")}}),disabled:0===t.length,children:[p.jsx(Tr,{className:"w-4 h-4 ml-2"}),"تصدير"]}),p.jsxs(Qi,{onClick:()=>b(!0),children:[p.jsx(di,{className:"w-4 h-4 ml-2"}),"إضافة مصروف"]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[p.jsx(CC,{title:"إجمالي المصروفات",value:p.jsx(Nh,{amount:d.totalAmount}),icon:p.jsx(Er,{}),color:"blue"}),p.jsx(CC,{title:"المدفوع",value:p.jsx(Nh,{amount:d.paidAmount}),icon:p.jsx($r,{}),color:"green"}),p.jsx(CC,{title:"المعلق",value:p.jsx(Nh,{amount:d.pendingAmount}),icon:p.jsx(Sr,{}),color:"yellow"}),p.jsx(CC,{title:"المتأخر",value:p.jsx(Nh,{amount:d.overdueAmount}),icon:p.jsx(sr,{}),color:"red"})]}),p.jsxs(Lo,{children:[p.jsx(Io,{children:p.jsx(zo,{children:"البحث والفلاتر"})}),p.jsx(Yo,{children:p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("input",{type:"text",placeholder:"البحث في المصروفات...",value:s,onChange:e=>{x(e.target.value)},className:"flex-1 px-3 py-2 border border-border rounded-md bg-background text-foreground"}),p.jsx(Qi,{variant:"outline",onClick:()=>{g({status:"",expenseType:"",category:"",vendor:"",isRecurring:null,dateRange:{start:"",end:""}}),x("")},children:"مسح الفلاتر"})]})})]}),p.jsxs(Lo,{children:[p.jsxs(Io,{children:[p.jsx(zo,{children:"قائمة المصروفات"}),p.jsx(Bo,{children:"عرض جميع مصروفات العيادة مع إمكانية التعديل والحذف"})]}),p.jsx(Yo,{children:n?p.jsx("div",{className:"flex items-center justify-center h-32",children:p.jsx("div",{className:"text-muted-foreground",children:"جاري التحميل..."})}):0===t.length?p.jsxs("div",{className:"text-center py-8",children:[p.jsx(ui,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"لا توجد مصروفات"}),p.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم العثور على أي مصروفات. ابدأ بإضافة مصروف جديد."}),p.jsxs(Qi,{onClick:()=>b(!0),children:[p.jsx(di,{className:"w-4 h-4 ml-2"}),"إضافة مصروف جديد"]})]}):p.jsx("div",{className:"space-y-4",children:t.map(e=>p.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg bg-card",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("h4",{className:"font-semibold text-foreground",children:e.expense_name}),p.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.expense_type," • ",e.status," • ",p.jsx(Nh,{amount:e.amount})]}),e.description&&p.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]}),p.jsxs("div",{className:"flex items-center gap-2",children:["pending"===e.status&&p.jsx(Qi,{size:"sm",variant:"outline",onClick:()=>(e=>m(void 0,null,function*(){try{yield h(e.id,{status:"paid"}),v({title:"تم تحديث الحالة",description:"تم تحديث حالة المصروف إلى مدفوع بنجاح"})}catch(t){v({title:"خطأ",description:"فشل في تحديث حالة المصروف",variant:"destructive"})}}))(e),children:"تحديد كمدفوع"}),p.jsx(Qi,{size:"sm",variant:"outline",onClick:()=>(e=>{_(e),b(!0)})(e),children:"تعديل"}),p.jsx(Qi,{size:"sm",variant:"destructive",onClick:()=>(e=>{S(e),w(!0)})(e),children:"حذف"})]})]},e.id))})})]}),p.jsx(SC,{open:y,onOpenChange:()=>{b(!1),_(null)},editingExpense:N}),p.jsx(DC,{open:j,onOpenChange:()=>{w(!1),S(null)},expense:k})]})},CC=({title:e,value:t,icon:n,color:a})=>{const s=vd(),r=yd();return p.jsx(Lo,{className:s.card,children:p.jsx(Yo,{className:"p-6",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:e}),p.jsx("p",{className:"text-2xl font-bold text-foreground",children:t})]}),p.jsx("div",{className:`${r.container} ${{blue:"text-blue-600 dark:text-blue-400",green:"text-green-600 dark:text-green-400",yellow:"text-yellow-600 dark:text-yellow-400",red:"text-red-600 dark:text-red-400"}[a]}`,children:n})]})})})};function EC({variant:e="ghost",size:t="icon",showLabel:n=!1}){const{isDarkMode:a,toggleDarkMode:s}=Gt();return p.jsxs(Qi,{variant:e,size:t,onClick:s,className:"transition-all duration-200",title:a?"تبديل إلى الوضع الفاتح":"تبديل إلى الوضع المظلم",children:[a?p.jsx(bi,{className:"h-4 w-4"}):p.jsx(Jr,{className:"h-4 w-4"}),n&&p.jsx("span",{className:"ml-2",children:a?"فاتح":"مظلم"})]})}const TC=b,AC=y,FC=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(h,d(o({className:aa("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a)},s),{ref:t}))});FC.displayName=h.displayName;const PC=Ki("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),OC=ve.forwardRef((e,t)=>{var n=e,{side:a="right",className:s,children:r}=n,i=c(n,["side","className","children"]);return p.jsxs(AC,{children:[p.jsx(FC,{}),p.jsxs(x,d(o({ref:t,dir:"rtl",className:aa(PC({side:a}),s)},i),{children:[p.jsxs(g,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-all duration-200 hover:opacity-100 hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[p.jsx(Mi,{className:"h-4 w-4"}),p.jsx("span",{className:"sr-only",children:"إغلاق"})]}),r]}))]})});OC.displayName=x.displayName;const RC=e=>{var t=e,{className:n}=t,a=c(t,["className"]);return p.jsx("div",o({className:aa("flex flex-col space-y-2 text-center sm:text-right",n)},a))};RC.displayName="SheetHeader";const MC=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(f,o({ref:t,className:aa("text-lg font-semibold text-foreground",a)},s))});MC.displayName=f.displayName;const LC=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(v,o({ref:t,className:aa("text-sm text-muted-foreground",a)},s))});function IC(e){var t=e,{className:n}=t,a=c(t,["className"]);return p.jsx("div",o({className:aa("animate-pulse rounded-md bg-primary/10",n)},a))}LC.displayName=v.displayName;const zC=ve.createContext(null);function BC(){const e=ve.useContext(zC);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const YC=ve.forwardRef((e,t)=>{var n=e,{defaultOpen:a=!0,open:s,onOpenChange:r,className:i,style:l,children:u}=n,m=c(n,["defaultOpen","open","onOpenChange","className","style","children"]);const h=function(){const[e,t]=ve.useState(void 0);return ve.useEffect(()=>{const e=window.matchMedia("(max-width: 767px)"),n=()=>{t(window.innerWidth<768)};return e.addEventListener("change",n),t(window.innerWidth<768),()=>e.removeEventListener("change",n)},[]),!!e}(),[x,g]=ve.useState(!1),[f,v]=ve.useState(a),y=null!=s?s:f,b=ve.useCallback(e=>{const t="function"==typeof e?e(y):e;r?r(t):v(t),document.cookie=`sidebar_state=${t}; path=/; max-age=604800`},[r,y]),j=ve.useCallback(()=>h?g(e=>!e):b(e=>!e),[h,b,g]);ve.useEffect(()=>{const e=e=>{const t=e.target,n="INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||"number"===t.getAttribute("type")||t.closest('[data-prevent-shortcuts="true"]')||t.closest('[data-no-globalThis-shortcuts="true"]')||t.hasAttribute("data-prevent-shortcuts")||t.hasAttribute("data-no-globalThis-shortcuts");"b"!==e.key||n||e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),j())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[j]);const w=y?"expanded":"collapsed",N=ve.useMemo(()=>({state:w,open:y,setOpen:b,isMobile:h,openMobile:x,setOpenMobile:g,toggleSidebar:j}),[w,y,b,h,x,g,j]);return p.jsx(zC.Provider,{value:N,children:p.jsx(H$,{delayDuration:0,children:p.jsx("div",d(o({style:o({"--sidebar-width":"16rem","--sidebar-width-icon":"3rem"},l),className:aa("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",i),ref:t},m),{children:u}))})})});YC.displayName="SidebarProvider";const VC=ve.forwardRef((e,t)=>{var n=e,{side:a="left",variant:s="sidebar",collapsible:r="offcanvas",className:i,children:l}=n,u=c(n,["side","variant","collapsible","className","children"]);const{isMobile:m,state:h,openMobile:x,setOpenMobile:g}=BC();return"none"===r?p.jsx("div",d(o({className:aa("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",i),ref:t},u),{children:l})):m?p.jsx(TC,d(o({open:x,onOpenChange:g},u),{children:p.jsxs(OC,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":"18rem"},side:a,children:[p.jsxs(RC,{className:"sr-only",children:[p.jsx(MC,{children:"Sidebar"}),p.jsx(LC,{children:"Displays the mobile sidebar."})]}),p.jsx("div",{className:"flex h-full w-full flex-col",children:l})]})})):p.jsxs("div",{ref:t,className:"group peer hidden text-sidebar-foreground md:block","data-state":h,"data-collapsible":"collapsed"===h?r:"","data-variant":s,"data-side":a,children:[p.jsx("div",{className:aa("relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180","floating"===s||"inset"===s?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),p.jsx("div",d(o({className:aa("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex","left"===a?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]","floating"===s||"inset"===s?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",i)},u),{children:p.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:l})}))]})});VC.displayName="Sidebar";const qC=ve.forwardRef((e,t)=>{var n=e,{className:a,onClick:s}=n,r=c(n,["className","onClick"]);const{toggleSidebar:i}=BC();return p.jsxs(Qi,d(o({ref:t,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:aa("h-7 w-7",a),onClick:e=>{null==s||s(e),i()}},r),{children:[p.jsx(ai,{}),p.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]}))});qC.displayName="SidebarTrigger";const UC=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);const{toggleSidebar:r}=BC();return p.jsx("button",o({ref:t,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:r,title:"Toggle Sidebar",className:aa("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",a)},s))});UC.displayName="SidebarRail";const HC=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("main",o({ref:t,className:aa("relative flex w-full flex-1 flex-col bg-background","md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",a)},s))});HC.displayName="SidebarInset";ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(Xi,o({ref:t,"data-sidebar":"input",className:aa("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",a)},s))}).displayName="SidebarInput";const GC=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,"data-sidebar":"header",className:aa("flex flex-col gap-2 p-2",a)},s))});GC.displayName="SidebarHeader";const WC=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,"data-sidebar":"footer",className:aa("flex flex-col gap-2 p-2",a)},s))});WC.displayName="SidebarFooter";ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(ux,o({ref:t,"data-sidebar":"separator",className:aa("mx-2 w-auto bg-sidebar-border",a)},s))}).displayName="SidebarSeparator";const KC=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,"data-sidebar":"content",className:aa("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",a)},s))});KC.displayName="SidebarContent";const ZC=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,"data-sidebar":"group",className:aa("relative flex w-full min-w-0 flex-col p-2",a)},s))});ZC.displayName="SidebarGroup";const QC=ve.forwardRef((e,t)=>{var n=e,{className:a,asChild:s=!1}=n,r=c(n,["className","asChild"]);const i=s?j:"div";return p.jsx(i,o({ref:t,"data-sidebar":"group-label",className:aa("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",a)},r))});QC.displayName="SidebarGroupLabel";ve.forwardRef((e,t)=>{var n=e,{className:a,asChild:s=!1}=n,r=c(n,["className","asChild"]);const i=s?j:"button";return p.jsx(i,o({ref:t,"data-sidebar":"group-action",className:aa("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",a)},r))}).displayName="SidebarGroupAction";const XC=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,"data-sidebar":"group-content",className:aa("w-full text-sm",a)},s))});XC.displayName="SidebarGroupContent";const JC=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("ul",o({ref:t,"data-sidebar":"menu",className:aa("flex w-full min-w-0 flex-col gap-1",a)},s))});JC.displayName="SidebarMenu";const eE=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("li",o({ref:t,"data-sidebar":"menu-item",className:aa("group/menu-item relative",a)},s))});eE.displayName="SidebarMenuItem";const tE=Ki("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),nE=ve.forwardRef((e,t)=>{var n=e,{asChild:a=!1,isActive:s=!1,variant:r="default",size:i="default",tooltip:l,className:d}=n,u=c(n,["asChild","isActive","variant","size","tooltip","className"]);const m=a?j:"button",{isMobile:h,state:x}=BC(),g=p.jsx(m,o({ref:t,"data-sidebar":"menu-button","data-size":i,"data-active":s,className:aa(tE({variant:r,size:i}),d)},u));return l?("string"==typeof l&&(l={children:l}),p.jsxs(G$,{children:[p.jsx(W$,{asChild:!0,children:g}),p.jsx(K$,o({side:"right",align:"center",hidden:"collapsed"!==x||h},l))]})):g});nE.displayName="SidebarMenuButton";ve.forwardRef((e,t)=>{var n=e,{className:a,asChild:s=!1,showOnHover:r=!1}=n,i=c(n,["className","asChild","showOnHover"]);const l=s?j:"button";return p.jsx(l,o({ref:t,"data-sidebar":"menu-action",className:aa("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",a)},i))}).displayName="SidebarMenuAction";ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("div",o({ref:t,"data-sidebar":"menu-badge",className:aa("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",a)},s))}).displayName="SidebarMenuBadge";ve.forwardRef((e,t)=>{var n=e,{className:a,showIcon:s=!1}=n,r=c(n,["className","showIcon"]);const i=ve.useMemo(()=>`${Math.floor(40*Math.random())+50}%`,[]);return p.jsxs("div",d(o({ref:t,"data-sidebar":"menu-skeleton",className:aa("flex h-8 items-center gap-2 rounded-md px-2",a)},r),{children:[s&&p.jsx(IC,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),p.jsx(IC,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":i}})]}))}).displayName="SidebarMenuSkeleton";ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("ul",o({ref:t,"data-sidebar":"menu-sub",className:aa("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",a)},s))}).displayName="SidebarMenuSub";ve.forwardRef((e,t)=>{var n=c(e,[]);return p.jsx("li",o({ref:t},n))}).displayName="SidebarMenuSubItem";ve.forwardRef((e,t)=>{var n=e,{asChild:a=!1,size:s="md",isActive:r,className:i}=n,l=c(n,["asChild","size","isActive","className"]);const d=a?j:"a";return p.jsx(d,o({ref:t,"data-sidebar":"menu-sub-button","data-size":s,"data-active":r,className:aa("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground","sm"===s&&"text-xs","md"===s&&"text-sm","group-data-[collapsible=icon]:hidden",i)},l))}).displayName="SidebarMenuSubButton";const aE=[{title:"لوحة التحكم",url:"dashboard",icon:Ur},{title:"المرضى",url:"patients",icon:Fi},{title:"المواعيد",url:"appointments",icon:hr},{title:"المدفوعات",url:"payments",icon:$r},{title:"المخزون",url:"inventory",icon:ti},{title:"المختبرات",url:"labs",icon:Qr},{title:"الأدوية والوصفات",url:"medications",icon:li},{title:"العلاجات السنية",url:"dental-treatments",icon:Lr},{title:"احتياجات العيادة",url:"clinic-needs",icon:kr},{title:"مصروفات العيادة",url:"expenses",icon:ui},{title:"التقارير",url:"reports",icon:dr},{title:"الإعدادات",url:"settings",icon:xi}];function sE(e){var t=e,{activeTab:n,onTabChange:a}=t,s=c(t,["activeTab","onTabChange"]);qt();const r=Ud(),i=Hd(),l=Gd();return p.jsxs(VC,d(o({collapsible:"offcanvas",side:"right",className:"border-l border-border/40 shadow-lg rtl-layout"},s),{children:[p.jsx(GC,{className:"border-b border-border/40 bg-gradient-to-l from-background to-accent/10",children:p.jsx(JC,{children:p.jsx(eE,{children:p.jsx(nE,{size:"lg",asChild:!0,children:p.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-accent/30 transition-colors duration-200 flex-rtl",children:[p.jsx("div",{className:"flex aspect-square size-12 items-center justify-center rounded-lg bg-gradient-to-br from-sky-500 to-sky-600 text-white shadow-lg overflow-hidden",children:l&&""!==l.trim()?p.jsx("img",{src:l,alt:"شعار العيادة",className:"w-full h-full object-cover rounded-lg",onError:e=>{console.error("Sidebar header logo failed to load:",l),e.currentTarget.style.display="none";const t=e.currentTarget.parentElement;if(t){const e=document.createElement("div");e.innerHTML='<svg class="size-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',t.appendChild(e)}}}):p.jsx(yi,{className:"size-6"})}),p.jsxs("div",{className:"grid flex-1 text-right leading-tight",children:[p.jsx("span",{className:"truncate font-bold text-xl text-foreground",children:r}),p.jsx("span",{className:"truncate text-sm text-muted-foreground font-medium",children:"نظام إدارة العيادة"})]})]})})})})}),p.jsx(KC,{className:"px-3 py-3",children:p.jsxs(ZC,{className:"space-y-1",children:[p.jsx(QC,{className:"text-sm font-bold text-muted-foreground uppercase tracking-wider px-2 py-2 text-right",children:"القائمة الرئيسية"}),p.jsx(XC,{children:p.jsx(JC,{className:"space-y-1 nav-rtl",children:aE.map(e=>p.jsx(eE,{children:p.jsxs(nE,{isActive:n===e.url,onClick:()=>a(e.url),className:"flex items-center gap-3 w-full text-right justify-start hover:bg-accent/50 transition-colors duration-200 py-2 px-3 text-base nav-item",children:[p.jsx(e.icon,{className:"size-5 text-sky-600 dark:text-sky-400 nav-icon"}),p.jsx("span",{className:"font-semibold text-sm",children:e.title})]})},e.title))})})]})}),p.jsx(WC,{className:"border-t border-border/40 bg-gradient-to-r from-background to-accent/10",children:p.jsx(JC,{children:p.jsx(eE,{children:p.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg",children:[p.jsx("div",{className:"flex aspect-square size-8 items-center justify-center rounded-full bg-gradient-to-br from-sky-500 to-sky-600 text-white overflow-hidden",children:l&&""!==l.trim()?p.jsx("img",{src:l,alt:"شعار العيادة",className:"w-full h-full object-cover rounded-full",onError:e=>{console.error("Sidebar footer logo failed to load:",l),e.currentTarget.style.display="none";const t=e.currentTarget.parentElement;if(t){const e=document.createElement("div");e.innerHTML='<svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>',t.appendChild(e)}}}):p.jsx(Ei,{className:"size-4"})}),p.jsxs("div",{className:"grid flex-1 text-right leading-tight",children:[p.jsxs("span",{className:"truncate font-semibold text-sm",children:["د. ",i]}),p.jsx("span",{className:"truncate text-xs text-muted-foreground",children:r})]})]})})})}),p.jsx(UC,{})]}))}function rE(){const[e,t]=ve.useState(new Date);ve.useEffect(()=>{const e=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(e)},[]);return p.jsxs("div",{className:"flex items-center gap-2 font-mono",children:[p.jsx("span",{className:"text-xs",children:"📅"}),p.jsx("span",{children:(e=>{const t=e.getDate(),n=e.getMonth()+1,a=e.getFullYear(),s=e.getHours(),r=e.getMinutes(),i=e.getSeconds();return`${`${t.toString().padStart(2,"0")}/${n.toString().padStart(2,"0")}/${a}`} - ${`${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}`})(e)})]})}var iE="ToastProvider",[lE,oE,dE]=Z("Toast"),[cE,uE]=M("Toast",[dE]),[mE,pE]=cE(iE),hE=e=>{const{__scopeToast:t,label:n="Notification",duration:a=5e3,swipeDirection:s="right",swipeThreshold:r=50,children:i}=e,[l,o]=ve.useState(null),[d,c]=ve.useState(0),u=ve.useRef(!1),m=ve.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${iE}\`. Expected non-empty \`string\`.`),p.jsx(lE.Provider,{scope:t,children:p.jsx(mE,{scope:t,label:n,duration:a,swipeDirection:s,swipeThreshold:r,toastCount:d,viewport:l,onViewportChange:o,onToastAdd:ve.useCallback(()=>c(e=>e+1),[]),onToastRemove:ve.useCallback(()=>c(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:u,isClosePausedRef:m,children:i})})};hE.displayName=iE;var xE="ToastViewport",gE=["F8"],fE="toast.viewportPause",vE="toast.viewportResume",yE=ve.forwardRef((e,t)=>{const n=e,{__scopeToast:a,hotkey:s=gE,label:r="Notifications ({hotkey})"}=n,i=c(n,["__scopeToast","hotkey","label"]),l=pE(xE,a),u=oE(a),m=ve.useRef(null),h=ve.useRef(null),x=ve.useRef(null),g=ve.useRef(null),f=z(t,g,l.onViewportChange),v=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),y=l.toastCount>0;ve.useEffect(()=>{const e=e=>{var t;0!==s.length&&s.every(t=>e[t]||e.code===t)&&(null==(t=g.current)||t.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]),ve.useEffect(()=>{const e=m.current,t=g.current;if(y&&e&&t){const n=()=>{if(!l.isClosePausedRef.current){const e=new CustomEvent(fE);t.dispatchEvent(e),l.isClosePausedRef.current=!0}},a=()=>{if(l.isClosePausedRef.current){const e=new CustomEvent(vE);t.dispatchEvent(e),l.isClosePausedRef.current=!1}},s=t=>{!e.contains(t.relatedTarget)&&a()},r=()=>{e.contains(document.activeElement)||a()};return e.addEventListener("focusin",n),e.addEventListener("focusout",s),e.addEventListener("pointermove",n),e.addEventListener("pointerleave",r),window.addEventListener("blur",n),window.addEventListener("focus",a),()=>{e.removeEventListener("focusin",n),e.removeEventListener("focusout",s),e.removeEventListener("pointermove",n),e.removeEventListener("pointerleave",r),window.removeEventListener("blur",n),window.removeEventListener("focus",a)}}},[y,l.isClosePausedRef]);const b=ve.useCallback(({tabbingDirection:e})=>{const t=u().map(t=>{const n=t.ref.current,a=[n,...LE(n)];return"forwards"===e?a:a.reverse()});return("forwards"===e?t.reverse():t).flat()},[u]);return ve.useEffect(()=>{const e=g.current;if(e){const t=t=>{var n,a,s;const r=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!r){const r=document.activeElement,i=t.shiftKey;if(t.target===e&&i)return void(null==(n=h.current)||n.focus());const l=b({tabbingDirection:i?"backwards":"forwards"}),o=l.findIndex(e=>e===r);IE(l.slice(o+1))?t.preventDefault():i?null==(a=h.current)||a.focus():null==(s=x.current)||s.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}},[u,b]),p.jsxs(he,{ref:m,role:"region","aria-label":r.replace("{hotkey}",v),tabIndex:-1,style:{pointerEvents:y?void 0:"none"},children:[y&&p.jsx(jE,{ref:h,onFocusFromOutsideViewport:()=>{IE(b({tabbingDirection:"forwards"}))}}),p.jsx(lE.Slot,{scope:a,children:p.jsx(q.ol,d(o({tabIndex:-1},i),{ref:f}))}),y&&p.jsx(jE,{ref:x,onFocusFromOutsideViewport:()=>{IE(b({tabbingDirection:"backwards"}))}})]})});yE.displayName=xE;var bE="ToastFocusProxy",jE=ve.forwardRef((e,t)=>{const n=e,{__scopeToast:a,onFocusFromOutsideViewport:s}=n,r=c(n,["__scopeToast","onFocusFromOutsideViewport"]),i=pE(bE,a);return p.jsx(xe,d(o({"aria-hidden":!0,tabIndex:0},r),{ref:t,style:{position:"fixed"},onFocus:e=>{var t;const n=e.relatedTarget;!(null==(t=i.viewport)?void 0:t.contains(n))&&s()}}))});jE.displayName=bE;var wE="Toast",NE=ve.forwardRef((e,t)=>{const n=e,{forceMount:a,open:s,defaultOpen:r,onOpenChange:i}=n,l=c(n,["forceMount","open","defaultOpen","onOpenChange"]),[u,m]=G({prop:s,defaultProp:null==r||r,onChange:i,caller:wE});return p.jsx(K,{present:a||u,children:p.jsx(SE,d(o({open:u},l),{ref:t,onClose:()=>m(!1),onPause:U(e.onPause),onResume:U(e.onResume),onSwipeStart:Y(e.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Y(e.onSwipeMove,e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${n}px`)}),onSwipeCancel:Y(e.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Y(e.onSwipeEnd,e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${n}px`),m(!1)})}))})});NE.displayName=wE;var[_E,kE]=cE(wE,{onClose(){}}),SE=ve.forwardRef((e,t)=>{const n=e,{__scopeToast:a,type:s="foreground",duration:r,open:i,onClose:l,onEscapeKeyDown:u,onPause:m,onResume:h,onSwipeStart:x,onSwipeMove:g,onSwipeCancel:f,onSwipeEnd:v}=n,y=c(n,["__scopeToast","type","duration","open","onClose","onEscapeKeyDown","onPause","onResume","onSwipeStart","onSwipeMove","onSwipeCancel","onSwipeEnd"]),b=pE(wE,a),[j,w]=ve.useState(null),N=z(t,e=>w(e)),_=ve.useRef(null),k=ve.useRef(null),S=r||b.duration,D=ve.useRef(0),$=ve.useRef(S),C=ve.useRef(0),{onToastAdd:E,onToastRemove:T}=b,A=U(()=>{var e;(null==j?void 0:j.contains(document.activeElement))&&(null==(e=b.viewport)||e.focus()),l()}),F=ve.useCallback(e=>{e&&e!==1/0&&(window.clearTimeout(C.current),D.current=(new Date).getTime(),C.current=window.setTimeout(A,e))},[A]);ve.useEffect(()=>{const e=b.viewport;if(e){const t=()=>{F($.current),null==h||h()},n=()=>{const e=(new Date).getTime()-D.current;$.current=$.current-e,window.clearTimeout(C.current),null==m||m()};return e.addEventListener(fE,n),e.addEventListener(vE,t),()=>{e.removeEventListener(fE,n),e.removeEventListener(vE,t)}}},[b.viewport,S,m,h,F]),ve.useEffect(()=>{i&&!b.isClosePausedRef.current&&F(S)},[i,S,b.isClosePausedRef,F]),ve.useEffect(()=>(E(),()=>T()),[E,T]);const P=ve.useMemo(()=>j?OE(j):null,[j]);return b.viewport?p.jsxs(p.Fragment,{children:[P&&p.jsx(DE,{__scopeToast:a,role:"status","aria-live":"foreground"===s?"assertive":"polite","aria-atomic":!0,children:P}),p.jsx(_E,{scope:a,onClose:A,children:fe.createPortal(p.jsx(lE.ItemSlot,{scope:a,children:p.jsx(ge,{asChild:!0,onEscapeKeyDown:Y(u,()=>{b.isFocusedToastEscapeKeyDownRef.current||A(),b.isFocusedToastEscapeKeyDownRef.current=!1}),children:p.jsx(q.li,d(o({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":b.swipeDirection},y),{ref:N,style:o({userSelect:"none",touchAction:"none"},e.style),onKeyDown:Y(e.onKeyDown,e=>{"Escape"===e.key&&(null==u||u(e.nativeEvent),e.nativeEvent.defaultPrevented||(b.isFocusedToastEscapeKeyDownRef.current=!0,A()))}),onPointerDown:Y(e.onPointerDown,e=>{0===e.button&&(_.current={x:e.clientX,y:e.clientY})}),onPointerMove:Y(e.onPointerMove,e=>{if(!_.current)return;const t=e.clientX-_.current.x,n=e.clientY-_.current.y,a=Boolean(k.current),s=["left","right"].includes(b.swipeDirection),r=["left","up"].includes(b.swipeDirection)?Math.min:Math.max,i=s?r(0,t):0,l=s?0:r(0,n),o="touch"===e.pointerType?10:2,d={x:i,y:l},c={originalEvent:e,delta:d};a?(k.current=d,RE("toast.swipeMove",g,c,{discrete:!1})):ME(d,b.swipeDirection,o)?(k.current=d,RE("toast.swipeStart",x,c,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>o||Math.abs(n)>o)&&(_.current=null)}),onPointerUp:Y(e.onPointerUp,e=>{const t=k.current,n=e.target;if(n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),k.current=null,_.current=null,t){const n=e.currentTarget,a={originalEvent:e,delta:t};ME(t,b.swipeDirection,b.swipeThreshold)?RE("toast.swipeEnd",v,a,{discrete:!0}):RE("toast.swipeCancel",f,a,{discrete:!0}),n.addEventListener("click",e=>e.preventDefault(),{once:!0})}})}))})}),b.viewport)})]}):null}),DE=e=>{const t=e,{__scopeToast:n,children:a}=t,s=c(t,["__scopeToast","children"]),r=pE(wE,n),[i,l]=ve.useState(!1),[u,m]=ve.useState(!1);return function(e=()=>{}){const t=U(e);H(()=>{let e=0,n=0;return e=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(n)}},[t])}(()=>l(!0)),ve.useEffect(()=>{const e=window.setTimeout(()=>m(!0),1e3);return()=>window.clearTimeout(e)},[]),u?null:p.jsx(ce,{asChild:!0,children:p.jsx(xe,d(o({},s),{children:i&&p.jsxs(p.Fragment,{children:[r.label," ",a]})}))})},$E=ve.forwardRef((e,t)=>{const n=e,{__scopeToast:a}=n,s=c(n,["__scopeToast"]);return p.jsx(q.div,d(o({},s),{ref:t}))});$E.displayName="ToastTitle";var CE=ve.forwardRef((e,t)=>{const n=e,{__scopeToast:a}=n,s=c(n,["__scopeToast"]);return p.jsx(q.div,d(o({},s),{ref:t}))});CE.displayName="ToastDescription";var EE="ToastAction",TE=ve.forwardRef((e,t)=>{const n=e,{altText:a}=n,s=c(n,["altText"]);return a.trim()?p.jsx(PE,{altText:a,asChild:!0,children:p.jsx(FE,d(o({},s),{ref:t}))}):(console.error(`Invalid prop \`altText\` supplied to \`${EE}\`. Expected non-empty \`string\`.`),null)});TE.displayName=EE;var AE="ToastClose",FE=ve.forwardRef((e,t)=>{const n=e,{__scopeToast:a}=n,s=c(n,["__scopeToast"]),r=kE(AE,a);return p.jsx(PE,{asChild:!0,children:p.jsx(q.button,d(o({type:"button"},s),{ref:t,onClick:Y(e.onClick,r.onClose)}))})});FE.displayName=AE;var PE=ve.forwardRef((e,t)=>{const n=e,{__scopeToast:a,altText:s}=n,r=c(n,["__scopeToast","altText"]);return p.jsx(q.div,d(o({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":s||void 0},r),{ref:t}))});function OE(e){const t=[];return Array.from(e.childNodes).forEach(e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const n=e.ariaHidden||e.hidden||"none"===e.style.display,a=""===e.dataset.radixToastAnnounceExclude;if(!n)if(a){const n=e.dataset.radixToastAnnounceAlt;n&&t.push(n)}else t.push(...OE(e))}}),t}function RE(e,t,n,{discrete:a}){const s=n.originalEvent.currentTarget,r=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&s.addEventListener(e,t,{once:!0}),a?de(s,r):s.dispatchEvent(r)}var ME=(e,t,n=0)=>{const a=Math.abs(e.x),s=Math.abs(e.y),r=a>s;return"left"===t||"right"===t?r&&a>n:!r&&s>n};function LE(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function IE(e){const t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}var zE=yE,BE=NE,YE=$E,VE=CE,qE=TE,UE=FE;const HE=hE,GE=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(zE,o({ref:t,className:aa("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:left-0 sm:top-auto sm:flex-col md:max-w-[420px]",a)},s))});GE.displayName=zE.displayName;const WE=Ki("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 space-x-reverse overflow-hidden rounded-md border p-4 pl-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-left-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full dark:shadow-xl dark:shadow-black/20",{variants:{variant:{default:"border bg-background text-foreground dark:bg-card dark:border-border dark:text-card-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground dark:border-destructive dark:bg-destructive dark:text-destructive-foreground",success:"border-green-200 bg-green-50 text-green-800 dark:border-green-800 dark:bg-green-900/20 dark:text-green-400",warning:"border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-800 dark:bg-amber-900/20 dark:text-amber-400",info:"border-blue-200 bg-blue-50 text-blue-800 dark:border-blue-800 dark:bg-blue-900/20 dark:text-blue-400"}},defaultVariants:{variant:"default"}}),KE=ve.forwardRef((e,t)=>{var n=e,{className:a,variant:s}=n,r=c(n,["className","variant"]);return p.jsx(BE,o({ref:t,dir:"rtl",className:aa(WE({variant:s}),a)},r))});KE.displayName=BE.displayName;ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(qE,o({ref:t,className:aa("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",a)},s))}).displayName=qE.displayName;const ZE=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(UE,d(o({ref:t,className:aa("absolute left-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",a),"toast-close":""},s),{children:p.jsx(Mi,{className:"h-4 w-4"})}))});ZE.displayName=UE.displayName;const QE=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(YE,o({ref:t,className:aa("text-sm font-semibold [&+div]:text-xs",a)},s))});QE.displayName=YE.displayName;const XE=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx(VE,o({ref:t,className:aa("text-sm opacity-90",a)},s))});function JE(){const{toasts:e}=yl();return p.jsxs(HE,{children:[e.map(function(e){var t=e,{id:n,title:a,description:s,action:r}=t,i=c(t,["id","title","description","action"]);return p.jsxs(KE,d(o({},i),{children:[p.jsxs("div",{className:"grid gap-1",children:[a&&p.jsx(QE,{children:a}),s&&p.jsx(XE,{children:s})]}),r,p.jsx(ZE,{})]}),n)}),p.jsx(GE,{})]})}XE.displayName=VE.displayName;const eT=ve.forwardRef((e,t)=>{var n=c(e,[]);return p.jsx("nav",o({ref:t,"aria-label":"breadcrumb"},n))});eT.displayName="Breadcrumb";const tT=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("ol",o({ref:t,className:aa("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",a)},s))});tT.displayName="BreadcrumbList";const nT=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("li",o({ref:t,className:aa("inline-flex items-center gap-1.5",a)},s))});nT.displayName="BreadcrumbItem";const aT=ve.forwardRef((e,t)=>{var n=e,{asChild:a,className:s}=n,r=c(n,["asChild","className"]);const i=a?j:"a";return p.jsx(i,o({ref:t,className:aa("transition-colors hover:text-foreground",s)},r))});aT.displayName="BreadcrumbLink";const sT=ve.forwardRef((e,t)=>{var n=e,{className:a}=n,s=c(n,["className"]);return p.jsx("span",o({ref:t,role:"link","aria-disabled":"true","aria-current":"page",className:aa("font-normal text-foreground",a)},s))});sT.displayName="BreadcrumbPage";const rT=e=>{var t=e,{children:n,className:a}=t,s=c(t,["children","className"]);return p.jsx("li",d(o({role:"presentation","aria-hidden":"true",className:aa("[&>svg]:size-3.5",a)},s),{children:null!=n?n:p.jsx(br,{})}))};rT.displayName="BreadcrumbSeparator";function iT(){Gt();const{toast:e}=yl();ve.useEffect(()=>{const e=e=>{const t=e.target,a="INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||"number"===t.getAttribute("type")||t.closest('[data-prevent-shortcuts="true"]')||t.closest('[data-no-globalThis-shortcuts="true"]')||t.hasAttribute("data-prevent-shortcuts")||t.hasAttribute("data-no-globalThis-shortcuts");if(e.ctrlKey&&"F1"!==e.key)return;const r=e.altKey;if(a&&!r)return;const l=$a(e);"0"===l.mappedKey?(l.preventDefault(),n("dashboard")):"1"===l.mappedKey?(l.preventDefault(),n("patients")):"2"===l.mappedKey?(l.preventDefault(),n("appointments")):"3"===l.mappedKey?(l.preventDefault(),n("payments")):"4"===l.mappedKey?(l.preventDefault(),n("inventory")):"5"===l.mappedKey?(l.preventDefault(),n("labs")):"6"===l.mappedKey?(l.preventDefault(),n("medications")):"7"===l.mappedKey?(l.preventDefault(),n("dental-treatments")):"8"===l.mappedKey?(l.preventDefault(),n("clinic-needs")):"9"===l.mappedKey&&(l.preventDefault(),n("reports")),"a"===l.mappedKey.toLowerCase()?(l.preventDefault(),s(!0)):"s"===l.mappedKey.toLowerCase()?(l.preventDefault(),o(!0)):"d"===l.mappedKey.toLowerCase()&&(l.preventDefault(),i(!0)),"r"===l.mappedKey.toLowerCase()&&(l.preventDefault(),window.location.reload()),"F1"===e.key&&(e.preventDefault(),n("settings"))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);const[t,n]=ve.useState("dashboard"),[a,s]=ve.useState(!1),[r,i]=ve.useState(!1),[l,o]=ve.useState(!1),[d,c]=ve.useState(!1),[u,h]=ve.useState(!1),[x,g]=ve.useState(null),f=(t,n="success")=>{e({title:"success"===n?"نجح":"خطأ",description:t,variant:"error"===n?"destructive":"default"})},{loadPatients:v,patients:y}=At(),{appointments:b,isLoading:j,error:w,loadAppointments:N,createAppointment:_,updateAppointment:k,deleteAppointment:S}=Ft(),{loadSettings:D}=Pt();ve.useEffect(()=>{(()=>{m(this,null,function*(){console.log("🚀 Initializing demo app"),yield D(),v(),N()})})()},[v,N,D]);return p.jsxs(YC,{children:[p.jsx(sE,{activeTab:t,onTabChange:n}),p.jsxs(HC,{children:[p.jsxs("header",{className:"flex h-16 shrink-0 items-center gap-2 transition-[width,height] ease-linear group-has-[[data-collapsible=icon]]/sidebar-wrapper:h-12 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b border-border/40 rtl-layout",children:[p.jsx("div",{className:"flex items-center gap-2 px-4",children:p.jsx(eT,{children:p.jsxs(tT,{className:"flex-rtl",children:[p.jsx(nT,{className:"hidden md:block",children:p.jsx(aT,{href:"#",className:"text-muted-foreground hover:text-foreground transition-colors duration-200",children:"🦷 نظام إدارة العيادة السنية - نسخة تجريبية"})}),p.jsx(rT,{className:"hidden md:block"}),p.jsx(nT,{children:p.jsx(sT,{className:"font-semibold text-sky-600 dark:text-sky-400",children:{dashboard:"لوحة التحكم",patients:"المرضى",appointments:"المواعيد",payments:"المدفوعات",inventory:"المخزون",labs:"المختبرات",medications:"الأدوية والوصفات","dental-treatments":"العلاجات السنية","clinic-needs":"احتياجات العيادة",expenses:"مصروفات العيادة",reports:"التقارير",settings:"الإعدادات"}[t]||"لوحة التحكم"})})]})})}),p.jsxs("div",{className:"ml-auto-rtl flex items-center gap-3 px-4 space-x-3-rtl",children:[p.jsx(qC,{}),p.jsx(ux,{orientation:"vertical",className:"mx-2 h-4"}),p.jsx(fd,{}),p.jsx(EC,{}),p.jsx("div",{className:"text-sm text-muted-foreground bg-accent/30 px-3 py-1 rounded-full",children:p.jsx(rE,{})})]})]}),p.jsx("div",{className:"flex flex-1 flex-col gap-4 p-10 pt-4 max-w-full overflow-hidden relative rtl-layout",children:p.jsx("div",{className:"w-full max-w-none content-wrapper",children:(()=>{switch(t){case"patients":return p.jsx(If,{onNavigateToTreatments:n,onNavigateToPayments:n});case"appointments":return p.jsx(r$,{});case"payments":return p.jsx(lc,{});case"inventory":return p.jsx(_h,{});case"labs":return p.jsx(p$,{});case"medications":return p.jsx(eC,{});case"dental-treatments":return p.jsx(vC,{});case"clinic-needs":return p.jsx(kC,{});case"expenses":return p.jsx($C,{});case"reports":return p.jsx(hx,{});case"settings":return p.jsx(Nc,{});default:return p.jsx(kx,{onNavigateToPatients:()=>n("patients"),onNavigateToAppointments:()=>n("appointments"),onNavigateToPayments:()=>n("payments"),onNavigateToTreatments:()=>n("dental-treatments"),onAddPatient:()=>s(!0),onAddAppointment:()=>o(!0),onAddPayment:()=>i(!0)})}})()})})]}),p.jsx(bl,{open:a,onOpenChange:s}),p.jsx(Mo,{isOpen:l,onClose:()=>o(!1),onSave:e=>m(this,null,function*(){try{yield _(e),o(!1),f("تم إضافة الموعد الجديد بنجاح","success")}catch(t){console.error("Error creating appointment:",t),f("فشل في إضافة الموعد. يرجى المحاولة مرة أخرى","error")}}),patients:y,treatments:[]}),d&&x&&p.jsx(Mo,{isOpen:d,onClose:()=>{c(!1),g(null)},onSave:e=>m(this,null,function*(){try{yield k(x.id,e),c(!1),g(null),f("تم تحديث الموعد بنجاح","success")}catch(t){console.error("Error updating appointment:",t),f("فشل في تحديث الموعد. يرجى المحاولة مرة أخرى","error")}}),patients:y,treatments:[],initialData:x}),u&&x&&p.jsx(Ao,{isOpen:u,patient:null,appointment:x,onClose:()=>{h(!1),g(null)},onConfirm:()=>m(this,null,function*(){if(x)try{yield S(x.id),h(!1),g(null),f("تم حذف الموعد بنجاح","success")}catch(e){console.error("Error deleting appointment:",e),f("فشل في حذف الموعد. يرجى المحاولة مرة أخرى","error")}}),isLoading:j}),p.jsx(xd,{open:r,onOpenChange:i}),p.jsx(JE,{})]})}function lT(){return p.jsx(Ht,{children:p.jsx(ka,{children:p.jsx(iT,{})})})}console.log("🚀 Starting Dental Clinic Demo App..."),wt.createRoot(document.getElementById("root")).render(p.jsx(ye.StrictMode,{children:p.jsx(lT,{})})),console.log("✅ Demo App initialized successfully");export{Bf as _};
