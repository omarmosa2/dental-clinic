# ๐๏ธ ุญู ูุดููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงููุณุฎุฉ ุงููุบููุฉ (EXE)

## ๐ ููุฎุต ุงููุดููุฉ

ูุงู ุงูุชุทุจูู ูุนูู ุจุดูู ูุซุงูู ูู ูุถุน ุงูุชุทููุฑ (`npm run electron:dev`) ูููู ูุดู ูู ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุนูุฏ ุงูุชุบููู ูููู EXE (`npm run dist:win`).

## ๐ ุงูุฃุณุจุงุจ ุงูุฌุฐุฑูุฉ ุงูููุชุดูุฉ

### 1. **ุชุถุงุฑุจ ูู ูุณุงุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช**
- `main.js`: ุงุณุชุฎุฏู `app.getPath('userData')`
- `databaseService.js`: ุงุณุชุฎุฏู `process.execPath` directory
- ูุฐุง ุฃุฏู ุฅูู ุฅูุดุงุก ููุงุนุฏ ุจูุงูุงุช ูู ููุงูุน ูุฎุชููุฉ

### 2. **ููู schema.sql ุบูุฑ ูุชุงุญ ูู ุงููุณุฎุฉ ุงููุบููุฉ**
- ุงููุณุงุฑ ุงููุณุจู `../database/schema.sql` ูุง ูุนูู ูู ุงูุจูุฆุฉ ุงููุบููุฉ
- ูููุงุช `src/database/` ูู ุชูู ูุถููุฉ ูู ุฅุนุฏุงุฏุงุช ุงูุชุบููู

### 3. **ุนุฏู ุชุถููู ูููุงุช ุงููุตุฏุฑ ูู ุงูุชุบููู**
- ุฅุนุฏุงุฏุงุช `electron-builder` ูู ุชุชุถูู ูุฌูุฏุงุช `src/`

## โ ุงูุญููู ุงููุทุจูุฉ

### 1. **ุชูุญูุฏ ูุณุงุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช**

**ูู `src/services/databaseService.js`:**
```javascript
// ูุจู ุงูุฅุตูุงุญ
const appDir = process.execPath ? require('path').dirname(process.execPath) : process.cwd()
dbPath = join(appDir, 'dental_clinic.db')

// ุจุนุฏ ุงูุฅุตูุงุญ
const { app } = require('electron')
dbPath = join(app.getPath('userData'), 'dental_clinic.db')
```

### 2. **ุฅุตูุงุญ ูุฑุงุกุฉ ููู schema.sql**

**ุฅุถุงูุฉ ูุณุงุฑุงุช ูุชุนุฏุฏุฉ ููุจุญุซ:**
```javascript
const possiblePaths = [
  join(__dirname, '../database/schema.sql'), // Development
  join(process.resourcesPath || '', 'database/schema.sql'), // extraResources
  join(process.resourcesPath || '', 'src/database/schema.sql'), // Packaged
  // ูุณุงุฑุงุช ุฅุถุงููุฉ ููุชูุงูู
]
```

### 3. **ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช electron-builder**

**ูู `package.json`:**
```json
{
  "build": {
    "files": [
      "dist/**/*",
      "electron/**/*",
      "src/database/**/*",  // โ ุฅุถุงูุฉ ุฌุฏูุฏุฉ
      "src/services/**/*",  // โ ุฅุถุงูุฉ ุฌุฏูุฏุฉ
      "node_modules/**/*",
      "package.json"
    ],
    "extraResources": [
      {
        "from": "assets",
        "to": "assets"
      },
      {
        "from": "src/database",  // โ ุฅุถุงูุฉ ุฌุฏูุฏุฉ
        "to": "database"
      }
    ]
  }
}
```

### 4. **ุฅุถุงูุฉ ุชุดุฎูุต ุดุงูู**

**IPC Handler ุฌุฏูุฏ ูู `main.js`:**
```javascript
ipcMain.handle('database:getStatus', async () => {
  try {
    const testQuery = databaseService.db.prepare('SELECT COUNT(*) as count FROM sqlite_master WHERE type="table"')
    const result = testQuery.get()
    
    return {
      connected: true,
      tablesCount: result.count,
      dbPath: databaseService.db.name,
      isOpen: databaseService.isOpen()
    }
  } catch (error) {
    return { connected: false, error: error.message }
  }
})
```

**ูููู ุชุดุฎูุต ูู React:**
- `src/components/DatabaseDiagnostics.tsx`
- ูุถุงู ุฅูู ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช ุชุญุช ุชุจููุจ "ุชุดุฎูุต ุงููุธุงู"

### 5. **ุชุญุณููุงุช ุฅุถุงููุฉ**

**ูู `main.js`:**
- ุฅูุดุงุก ูุฌูุฏ userData ุฅุฐุง ูู ููู ููุฌูุฏุงู
- ูุญุต ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุนุฏ ุงูุชููุฆุฉ
- logging ูุญุณู ููุชุดุฎูุต

**ูู `databaseService.js`:**
- ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ
- fallback schema ูุญุณู
- ุชุญูู ูู ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐งช ููููุฉ ุงุฎุชุจุงุฑ ุงูุญู

### 1. **ูู ูุถุน ุงูุชุทููุฑ:**
```bash
npm run electron:dev
```

### 2. **ูู ุงููุณุฎุฉ ุงููุบููุฉ:**
```bash
npm run dist:win
```

### 3. **ูุญุต ุงูุชุดุฎูุต:**
1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุฐูุจ ุฅูู ุงูุฅุนุฏุงุฏุงุช
3. ุงุฎุชุฑ ุชุจููุจ "ุชุดุฎูุต ุงููุธุงู"
4. ุชุญูู ูู ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

โ **ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุนูู ูู ููุง ุงูุจูุฆุชูู**
โ **ูุณุงุฑ ููุญุฏ ููุงุนุฏุฉ ุงูุจูุงูุงุช**
โ **ุชููุฆุฉ schema ูุงุฌุญุฉ**
โ **ุชุดุฎูุต ุดุงูู ูุชุงุญ**
โ **ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุณูุฉ**

## ๐ง ููุงุญุธุงุช ุชูููุฉ

### ูุณุงุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- **ุงูุชุทููุฑ:** `%APPDATA%/dental-clinic/dental_clinic.db`
- **ุงูุฅูุชุงุฌ:** `%APPDATA%/dental-clinic/dental_clinic.db`

### ูููุงุช schema:
- **ุงูุชุทููุฑ:** `src/database/schema.sql`
- **ุงูุฅูุชุงุฌ:** `resources/database/schema.sql`

### Fallback Schema:
- ูุชู ุงุณุชุฎุฏุงูู ุฅุฐุง ูุดู ุชุญููู ููู schema.sql
- ูุญุชูู ุนูู ุฌููุน ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ

## ๐ ุฎุทูุงุช ุงูุชุดุบูู ุงูููุงุฆูุฉ

1. **ุจูุงุก ุงูุชุทุจูู:**
   ```bash
   npm run build
   ```

2. **ุฅูุดุงุก ุงููุณุฎุฉ ุงููุบููุฉ:**
   ```bash
   npm run dist:win
   ```

3. **ุชุดุบูู ูุงุฎุชุจุงุฑ:**
   - ุชุดุบูู ููู EXE
   - ูุญุต ุชุจููุจ ุงูุชุดุฎูุต
   - ุงุฎุชุจุงุฑ ุงูุนูููุงุช ุงูุฃุณุงุณูุฉ

## ๐ง ุฅุตูุงุญ ุฎุทุฃ SQL ุงูุฅุถุงูู

**ุงููุดููุฉ:** ุฎุทุฃ ูู ุงุณุชุนูุงู SQL: `no such column: 'table'`

**ุงูุณุจุจ:** ุงุณุชุฎุฏุงู ุนูุงูุงุช ุงูุชุจุงุณ ูุฒุฏูุฌุฉ ุจุฏูุงู ูู ููุฑุฏุฉ ููููู ุงููุตูุฉ

**ุงูุญู:**
```javascript
// ูุจู ุงูุฅุตูุงุญ โ
WHERE type="table"

// ุจุนุฏ ุงูุฅุตูุงุญ โ
WHERE type='table'
```

**ุงููููุงุช ุงูููุตูุญุฉ:**
- `electron/main.js` (ุณุทุฑ 334 ู 1261)

## ๐ ุงูุชูุซูู ุงูุฅุถุงูู

- ุฌููุน ุงูุชุบููุฑุงุช ููุซูุฉ ูู ุงูููุฏ
- Logging ูุญุณู ูุณูููุฉ ุงูุชุดุฎูุต
- ูููู ุชุดุฎูุต ูุชุงุญ ูููุณุชุฎุฏู ุงูููุงุฆู
